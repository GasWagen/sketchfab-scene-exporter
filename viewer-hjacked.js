alert(“TEST!”);
function fif(k){ // ?.osg, -> ?.osg,fif(?),
 console.log("Upping "+k);
 if(k.osg){window.osg = k.osg;}
}

webpackJsonp([48],Array(242).concat([function(t,e,i){"use strict";var r=i(243),n=i(224),a=i(244),s=i(245),o=i(219),u=i(246),h=i(250),l=i(234),c=i(252),d=i(253),p=i(240),f=i(254),g=s.Loader.extend({getSource:function(t){return{src:{type:"code",obj:window.nunjucksPrecompiled[t]},path:t}}}),m=new s.Environment([new g],{autoescape:!0});m.addFilter("log",function(t){return console.log("[Nunjucks] : ",t),t}),m.addFilter("urlize",d),m.addFilter("best_fit",c),m.addFilter("iterable",function(t){return Array.isArray(t)?t:[t]}),m.addFilter("slugify",function(t){return t.replace(/[^\w\s-]+/g,"").trim().toLowerCase().replace(/[-\s]+/g,"-")}),m.addFilter("call_macro_by_name",function(t){var e=this.ctx[t],i=Array.prototype.slice.call(arguments,1);if(!e)throw new Error('Missing macro "'+t+'"');return e.apply(this,i)}),m.addFilter("user_profile_filled",function(t){return"avatar-blue"!==t.avatars.name&&"avatar-orange"!==t.avatars.name&&"avatar-grey"!==t.avatars.name&&(t.biography||t.tagline||t.city||t.country)&&(t.website||t.twitterUsername||t.linkedinUsername||t.facebookUsername)}),m.addFilter("print_suggestion_verb",function(t,e){var i="";return 0===t&&(i=e.displayName+" is a <b>popular</b> user"),10===t&&(i="You <b>liked</b> their models :"),20===t&&(i="You share a common <b>skill</b> :"),30===t&&(i="You share a common <b>interest</b> :"),40===t&&(i="Your profiles are similar."),s.runtime.markSafe(i)}),m.addFilter("print_suggestion_target",function(t,e){if(0===e)return"";if(10===e){var i=[];return t.forEach(function(t){var e=n('<a href="/models/'+t.uid+'">'+t.name+"</a>");i.push(n("<div>").append(e).html())}),s.runtime.markSafe(i.join(", "))}return 20===e?t.name:30===e?t.name:40===e?"":void 0});var v;m.addFilter("skill_slug_to_name",function(t){return v||(v=new h,v.fetch({immediate:!0})),v.findWhere({slug:t}).get("name")});var _;m.addFilter("category_uid_to_name",function(t){_||(_=new u,_.fetch({immediate:!0}));var e=_.findWhere({uid:t}),i=e.get("name");return e.get("parent")&&(i=_.findWhere({uid:e.get("parent")}).get("name ")+"/"+i),i}),m.addFilter("underscorify",function(t){return t.replace(/([A-Z])/g,"_$1").toLowerCase()}),m.addFilter("image_container",function(t,e,i,r,a,o){var u=m.getFilter("best_fit")(t,e,i),h="",l=u?{backgroundImage:"url("+u+")"}:{},c=n("<div/>").attr("class","image-container").css({width:r?"100%":e});return o?(h=n("<div/>").attr("class","model-card-placeholder")[0].outerHTML,c.attr("data-background",u)):c.css(l),s.runtime.markSafe(h+c.append(n("<div/>").css({paddingTop:i/e*100+"%"}))[0].outerHTML)}),m.addFilter("query_string",function(t,e){var i=document.createElement("a");return i.href=t,Object.keys(e).length&&(i.search="?"+p.craft(p.reset(i.search,e))),i.href}),m.addFilter("first_n",function(t,e){return t.slice(0,e)}),m.addFilter("fill_null",function(t,e){for(var i=t.slice();i.length<e;)i.push(null);return i}),m.addFilter("prettify_text",function(t,e){var i=m.getFilter("striptags")(t),r=m.getFilter("urlize")(i,e);return r}),m.addFilter("paragraphy",function(t){var e=t.match(/.+/g);return e?s.runtime.markSafe(e.map(function(t){return"<p>"+t+"</p>"}).join("")):t}),m.addFilter("striptags",function(t){return s.runtime.markSafe(r.sanitize(t,{ALLOWED_TAGS:[]}))}),m.addFilter("humanize_number",function(t){var e=parseFloat(t),i=[3,6,9,12,15],r=["k","M","B","T","P"];if(!e)return t;var n=0>e?"-":"",a=Math.abs(e);if(1e3>a)return e;for(var s=0,o=i.length;o>s;++s)if(a<1e3*Math.pow(10,i[s])){var u=a/Math.pow(10,i[s]),h=Math.floor(u);return u!==h?n+u.toString(10).substr(0,u.toString(10).indexOf(".")+2)+r[s]:n+h+r[s]}return 0>e?"1000- P":"1000+ P"}),m.addFilter("pluralize",function(t,e,i){return void 0===e&&(e=""),void 0===i&&(i="s"),1===t?e:i}),m.addFilter("merge",function(t,e){return o.extend({},t,e)}),m.addFilter("json_data",function(t){return JSON.stringify(t).replace(/<\//g,"<\\/")}),m.addFilter("format_date",function(t,e){var i;return i="full"===e?"YYYY/MM/DD HH:mm":"L",a.utc(t).format(i)}),m.addFilter("max",function(t){return Math.max.apply(Math,t)}),m.addFilter("min",function(t){return Math.min.apply(Math,t)}),m.addFilter("time_ago",function(t){return f.timeAgo(a.utc(t).toDate())}),m.addFilter("seconds_to_duration",function(t){return a.utc(1e3*parseFloat(t)).format("mm:ss")}),m.addFilter("can_upgrade_to_pro",function(t){return new l(t).canUpgradeToPro()}),m.addFilter("can_protect_models",function(t){return new l(t).canProtectModels()});var b=m.getFilter("trim");m.addFilter("trim",function(t){return null===t?"":b(t)}),t.exports={get:function(t,e){var i=function(e){return m.render(t+".jinja",e)};return e?i(e):i},getFromString:function(t,e){var i=function(e){return m.renderString(t,e)};return e?i(e):i},getFromMacro:function(t,e,i){Array.isArray(t)&&(i=e,e=t[1],t=t[0]);var r=function(i){return m.renderString(["{%- from source import "+e+" -%}","{{ "+e+"("+i.map(function(t,e){return"parameters[ "+e+" ]"}).join(",")+") }}"].join("\n"),{source:t+".jinja",parameters:i})};return i?r(i):r},equal:function(){var t,e,i;return"object"==typeof arguments[1]?(t=arguments[0],e=arguments[1],i=Array.prototype.slice.call(arguments,2)):(t=arguments[0],e={},i=Array.prototype.slice.call(arguments,1)),equal.apply(void 0,[this.getFromString(t,e)].concat(i))}}},function(t,e,i){var r,n;!function(a,s){"use strict";r=s,n="function"==typeof r?r.call(e,i,e,t):r,!(void 0!==n&&(t.exports=n))}(this,function(){"use strict";var t={};return t.sanitize=function(t,e){var i=["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"],r=!0,n=["accept","action","align","alt","autocomplete","bgcolor","border","checked","cite","class","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","novalidate","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","azimuth","baseline-shift","bias","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dy","dy","direction","display","divisor","dur","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","front-weight","image-rendering","in","in2","k1","k2","k3","k4","kerning","letter-spacing","lighting-color","local","marker-end","marker-mid","marker-start","max","mask","mode","min","operator","opacity","order","overflow","paint-order","path","points","r","rx","ry","radius","restart","scale","seed","shape-rendering","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","transform","text-anchor","text-decoration","text-rendering","u1","u2","viewbox","visibility","word-spacing","wrap","writing-mode","x","x1","x2","y","y1","y2","z","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space"],a=!1,s=!1,o=!1,u=!0,h=!0,l=["a","abbr","acronym","address","article","aside","b","bdi","bdo","big","blink","blockquote","caption","center","cite","code","col","dd","del","details","dfn","dir","div","dl","dt","em","figcaption","figure","footer","h1","h2","h3","h4","h5","h6","header","i","ins","kbd","label","legend","li","main","mark","marquee","nav","ol","output","p","pre","q","rp","rt","ruby","s","samp","section","small","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","time","tr","tt","u","ul","var"],c=function(t){t.ALLOWED_ATTR?n=t.ALLOWED_ATTR:null,t.ALLOWED_TAGS?i=t.ALLOWED_TAGS:null,t.ALLOW_DATA_ATTR?r=t.ALLOW_DATA_ATTR:null,t.SAFE_FOR_JQUERY?o=t.SAFE_FOR_JQUERY:null,t.WHOLE_DOCUMENT?a=t.WHOLE_DOCUMENT:null,t.RETURN_DOM?s=t.RETURN_DOM:null,t.SANITIZE_DOM?u=t.SANITIZE_DOM:null,t.KEEP_CONTENT?h=t.KEEP_CONTENT:null,t.ADD_ATTR?n=n.concat(t.ADD_ATTR):null,t.ADD_TAGS?i=i.concat(t.ADD_TAGS):null,h?i.push("#text"):null},d=function(t){var e=document.implementation.createHTMLDocument("");e.body.parentNode.removeChild(e.body.parentNode.firstElementChild),e.body.outerHTML=t,null===e.body&&(e.body.innerHTML=t);var i=a?e.body.parentNode:e.body;if(!(e.body instanceof HTMLBodyElement&&e.body instanceof HTMLHtmlElement)){var r=document.implementation.createHTMLDocument("");i=a?r.getElementsByTagName.call(e,"html")[0]:r.getElementsByTagName.call(e,"body")[0]}return i},p=function(t){return document.createNodeIterator(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,function(){return NodeFilter.FILTER_ACCEPT},!1)},f=function(t){return t instanceof Text?!1:t.children&&!(t.children instanceof HTMLCollection)||t.attributes instanceof NodeList||"string"!=typeof t.nodeName||"string"!=typeof t.textContent||"number"!=typeof t.nodeType||"number"!=typeof t.COMMENT_NODE||"function"!=typeof t.setAttribute||"function"!=typeof t.cloneNode||"function"!=typeof t.removeAttributeNode||"function"!=typeof t.insertAdjacentHTML||"function"!=typeof t.attributes.item?!0:!1},g=function(t){if(f(t)){try{t.parentNode.removeChild(t)}catch(e){t.outerHTML=""}return!0}if(t.nodeType===t.COMMENT_NODE||-1===i.indexOf(t.nodeName.toLowerCase())){if(h&&t.insertAdjacentHTML&&t.nodeName.toLowerCase&&-1!==l.indexOf(t.nodeName.toLowerCase()))try{t.insertAdjacentHTML("AfterEnd",t.innerHTML)}catch(e){}return t.parentNode.removeChild(t),!0}return o&&!t.firstElementChild&&(t.textContent=t.textContent.replace(/</g,"&lt;")),!1},m=function(t){var e,i,a=/^(\w+script|data):/gi,s=t.cloneNode(!0);if(t.attributes)for(var o=t.attributes.length-1;o>=0;o--)e=s.attributes[o],i=!1,t.removeAttribute(t.attributes[o].name),e instanceof Attr&&(u&&("id"===e.name&&window[e.value]&&(i=!0),"name"===e.name&&document[e.value]&&(i=!0)),!(n.indexOf(e.name.toLowerCase())>-1||r&&e.name.match(/^data-[\w-]+/i))||e.value.replace(/[\x00-\x20]/g,"").match(a)&&("src"!==e.name||0!==e.value.indexOf("data:")||"IMG"!==e.ownerElement.nodeName)||i||t.setAttribute(e.name,e.value))},v=function(t){for(var e,i=p(t);e=i.nextNode();)g(e)||(e.content instanceof DocumentFragment&&v(e.content),m(e))};e?c(e):null;var _=d(t);if("undefined"==typeof _)return"";for(var b,x=p(_);b=x.nextNode();)g(b)||(b.content instanceof DocumentFragment&&v(b.content),m(b));return s?_:a?_.outerHTML:_.innerHTML},t})},function(t,e,i){var r,n;//! moment.js
//! version : 2.2.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(function(i){function a(t,e){return function(i){return d(t.call(this,i),e)}}function s(t,e){return function(i){return this.lang().ordinal(t.call(this,i),e)}}function o(){}function u(t){l(this,t)}function h(t){var e=t.years||t.year||t.y||0,i=t.months||t.month||t.M||0,r=t.weeks||t.week||t.w||0,n=t.days||t.day||t.d||0,a=t.hours||t.hour||t.h||0,s=t.minutes||t.minute||t.m||0,o=t.seconds||t.second||t.s||0,u=t.milliseconds||t.millisecond||t.ms||0;this._input=t,this._milliseconds=+u+1e3*o+6e4*s+36e5*a,this._days=+n+7*r,this._months=+i+12*e,this._data={},this._bubble()}function l(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function c(t){return 0>t?Math.ceil(t):Math.floor(t)}function d(t,e){for(var i=t+"";i.length<e;)i="0"+i;return i}function p(t,e,i,r){var n,a,s=e._milliseconds,o=e._days,u=e._months;s&&t._d.setTime(+t._d+s*i),(o||u)&&(n=t.minute(),a=t.hour()),o&&t.date(t.date()+o*i),u&&t.month(t.month()+u*i),s&&!r&&G.updateOffset(t),(o||u)&&(t.minute(n),t.hour(a))}function f(t){return"[object Array]"===Object.prototype.toString.call(t)}function g(t,e){var i,r=Math.min(t.length,e.length),n=Math.abs(t.length-e.length),a=0;for(i=0;r>i;i++)~~t[i]!==~~e[i]&&a++;return a+n}function m(t){return t?dt[t]||t.toLowerCase().replace(/(.)s$/,"$1"):t}function v(t,e){return e.abbr=t,W[t]||(W[t]=new o),W[t].set(e),W[t]}function _(t){delete W[t]}function b(t){if(!t)return G.fn._lang;if(!W[t]&&Q)try{!function(){var t=new Error('Cannot find module "./lang"');throw t.code="MODULE_NOT_FOUND",t}()}catch(e){return G.fn._lang}return W[t]||G.fn._lang}function x(t){return t.match(/\[.*\]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function A(t){var e,i,r=t.match(X);for(e=0,i=r.length;i>e;e++)mt[r[e]]?r[e]=mt[r[e]]:r[e]=x(r[e]);return function(n){var a="";for(e=0;i>e;e++)a+=r[e]instanceof Function?r[e].call(n,t):r[e];return a}}function y(t,e){return e=S(e,t.lang()),pt[e]||(pt[e]=A(e)),pt[e](t)}function S(t,e){function i(t){return e.longDateFormat(t)||t}for(var r=5;r--&&(K.lastIndex=0,K.test(t));)t=t.replace(K,i);return t}function C(t,e){switch(t){case"DDDD":return $;case"YYYY":return tt;case"YYYYY":return et;case"S":case"SS":case"SSS":case"DDD":return Z;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return it;case"a":case"A":return b(e._l)._meridiemParse;case"X":return at;case"Z":case"ZZ":return rt;case"T":return nt;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return J;default:return new RegExp(t.replace("\\",""))}}function w(t){var e=(rt.exec(t)||[])[0],i=(e+"").match(ht)||["-",0,0],r=+(60*i[1])+~~i[2];return"+"===i[0]?-r:r}function T(t,e,i){var r,n=i._a;switch(t){case"M":case"MM":null!=e&&(n[1]=~~e-1);break;case"MMM":case"MMMM":r=b(i._l).monthsParse(e),null!=r?n[1]=r:i._isValid=!1;break;case"D":case"DD":null!=e&&(n[2]=~~e);break;case"DDD":case"DDDD":null!=e&&(n[1]=0,n[2]=~~e);break;case"YY":n[0]=~~e+(~~e>68?1900:2e3);break;case"YYYY":case"YYYYY":n[0]=~~e;break;case"a":case"A":i._isPm=b(i._l).isPM(e);break;case"H":case"HH":case"h":case"hh":n[3]=~~e;break;case"m":case"mm":n[4]=~~e;break;case"s":case"ss":n[5]=~~e;break;case"S":case"SS":case"SSS":n[6]=~~(1e3*("0."+e));break;case"X":i._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=w(e)}null==e&&(i._isValid=!1)}function M(t){var e,i,r,n=[];if(!t._d){for(r=k(t),e=0;3>e&&null==t._a[e];++e)t._a[e]=n[e]=r[e];for(;7>e;e++)t._a[e]=n[e]=null==t._a[e]?2===e?1:0:t._a[e];n[3]+=~~((t._tzm||0)/60),n[4]+=~~((t._tzm||0)%60),i=new Date(0),t._useUTC?(i.setUTCFullYear(n[0],n[1],n[2]),i.setUTCHours(n[3],n[4],n[5],n[6])):(i.setFullYear(n[0],n[1],n[2]),i.setHours(n[3],n[4],n[5],n[6])),t._d=i}}function E(t){var e=t._i;t._d||(t._a=[e.years||e.year||e.y,e.months||e.month||e.M,e.days||e.day||e.d,e.hours||e.hour||e.h,e.minutes||e.minute||e.m,e.seconds||e.second||e.s,e.milliseconds||e.millisecond||e.ms],M(t))}function k(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function I(t){var e,i,r,n=b(t._l),a=""+t._i;for(r=S(t._f,n).match(X),t._a=[],e=0;e<r.length;e++)i=(C(r[e],t).exec(a)||[])[0],i&&(a=a.slice(a.indexOf(i)+i.length)),mt[r[e]]&&T(r[e],i,t);a&&(t._il=a),t._isPm&&t._a[3]<12&&(t._a[3]+=12),t._isPm===!1&&12===t._a[3]&&(t._a[3]=0),M(t)}function N(t){var e,i,r,n,a,s=99;for(n=0;n<t._f.length;n++)e=l({},t),e._f=t._f[n],I(e),i=new u(e),a=g(e._a,i.toArray()),i._il&&(a+=i._il.length),s>a&&(s=a,r=i);l(t,r)}function R(t){var e,i=t._i,r=st.exec(i);if(r){for(t._f="YYYY-MM-DD"+(r[2]||" "),e=0;4>e;e++)if(ut[e][1].exec(i)){t._f+=ut[e][0];break}rt.exec(i)&&(t._f+=" Z"),I(t)}else t._d=new Date(i)}function F(t){var e=t._i,r=Y.exec(e);e===i?t._d=new Date:r?t._d=new Date(+r[1]):"string"==typeof e?R(t):f(e)?(t._a=e.slice(0),M(t)):e instanceof Date?t._d=new Date(+e):"object"==typeof e?E(t):t._d=new Date(e)}function P(t,e,i,r,n){return n.relativeTime(e||1,!!i,t,r)}function D(t,e,i){var r=H(Math.abs(t)/1e3),n=H(r/60),a=H(n/60),s=H(a/24),o=H(s/365),u=45>r&&["s",r]||1===n&&["m"]||45>n&&["mm",n]||1===a&&["h"]||22>a&&["hh",a]||1===s&&["d"]||25>=s&&["dd",s]||45>=s&&["M"]||345>s&&["MM",H(s/30)]||1===o&&["y"]||["yy",o];return u[2]=e,u[3]=t>0,u[4]=i,P.apply({},u)}function L(t,e,i){var r,n=i-e,a=i-t.day();return a>n&&(a-=7),n-7>a&&(a+=7),r=G(t).add("d",a),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function O(t){var e=t._i,i=t._f;return null===e||""===e?null:("string"==typeof e&&(t._i=e=b().preparse(e)),G.isMoment(e)?(t=l({},e),t._d=new Date(+e._d)):i?f(i)?N(t):I(t):F(t),new u(t))}function V(t,e){G.fn[t]=G.fn[t+"s"]=function(t){var i=this._isUTC?"UTC":"";return null!=t?(this._d["set"+i+e](t),G.updateOffset(this),this):this._d["get"+i+e]()}}function B(t){G.duration.fn[t]=function(){return this._data[t]}}function U(t,e){G.duration.fn["as"+t]=function(){return+this/e}}for(var G,z,j="2.2.1",H=Math.round,W={},Q="undefined"!=typeof t&&t.exports,Y=/^\/?Date\((\-?\d+)/i,q=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,X=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,K=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,J=/\d\d?/,Z=/\d{1,3}/,$=/\d{3}/,tt=/\d{1,4}/,et=/[+\-]?\d{1,6}/,it=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,rt=/Z|[\+\-]\d\d:?\d\d/i,nt=/T/i,at=/[\+\-]?\d+(\.\d{1,3})?/,st=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,ot="YYYY-MM-DDTHH:mm:ssZ",ut=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ht=/([\+\-]|\d\d)/gi,lt="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),ct={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},dt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",W:"isoweek",M:"month",y:"year"},pt={},ft="DDD w W M D d".split(" "),gt="M D H h m s w W".split(" "),mt={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return d(this.year()%100,2)},YYYY:function(){return d(this.year(),4)},YYYYY:function(){return d(this.year(),5)},gg:function(){return d(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return d(this.weekYear(),5)},GG:function(){return d(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return d(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return d(~~(this.milliseconds()/10),2)},SSS:function(){return d(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+d(~~(t/60),2)+":"+d(~~t%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+d(~~(10*t/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};ft.length;)z=ft.pop(),mt[z+"o"]=s(mt[z],z);for(;gt.length;)z=gt.pop(),mt[z+z]=a(mt[z],2);for(mt.DDDD=a(mt.DDD,3),l(o.prototype,{set:function(t){var e,i;for(i in t)e=t[i],"function"==typeof e?this[i]=e:this["_"+i]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,i,r;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(i=G.utc([2e3,e]),r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[e]=new RegExp(r.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,i,r;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(i=G([2e3,1]).day(e),r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[e]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,i){return t>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var i=this._calendar[t];return"function"==typeof i?i.apply(e):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,i,r){var n=this._relativeTime[i];return"function"==typeof n?n(t,e,i,r):n.replace(/%d/i,t)},pastFuture:function(t,e){var i=this._relativeTime[t>0?"future":"past"];return"function"==typeof i?i(e):i.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return L(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}}),G=function(t,e,i){return O({_i:t,_f:e,_l:i,_isUTC:!1})},G.utc=function(t,e,i){return O({_useUTC:!0,_isUTC:!0,_l:i,_i:t,_f:e}).utc()},G.unix=function(t){return G(1e3*t)},G.duration=function(t,e){var i,r,n=G.isDuration(t),a="number"==typeof t,s=n?t._input:a?{}:t,o=q.exec(t);return a?e?s[e]=t:s.milliseconds=t:o&&(i="-"===o[1]?-1:1,s={y:0,d:~~o[2]*i,h:~~o[3]*i,m:~~o[4]*i,s:~~o[5]*i,ms:~~o[6]*i}),r=new h(s),n&&t.hasOwnProperty("_lang")&&(r._lang=t._lang),r},G.version=j,G.defaultFormat=ot,G.updateOffset=function(){},G.lang=function(t,e){return t?(t=t.toLowerCase(),t=t.replace("_","-"),e?v(t,e):null===e?(_(t),t="en"):W[t]||b(t),void(G.duration.fn._lang=G.fn._lang=b(t))):G.fn._lang._abbr},G.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),b(t)},G.isMoment=function(t){return t instanceof u},G.isDuration=function(t){return t instanceof h},l(G.fn=u.prototype,{clone:function(){return G(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return y(G(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return null==this._isValid&&(this._a?this._isValid=!g(this._a,(this._isUTC?G.utc(this._a):G(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},invalidAt:function(){var t,e=this._a,i=(this._isUTC?G.utc(this._a):G(this._a)).toArray();for(t=6;t>=0&&e[t]===i[t];--t);return t},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=y(this,t||G.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var i;return i="string"==typeof t?G.duration(+e,t):G.duration(t,e),p(this,i,1),this},subtract:function(t,e){var i;return i="string"==typeof t?G.duration(+e,t):G.duration(t,e),p(this,i,-1),this},diff:function(t,e,i){var r,n,a=this._isUTC?G(t).zone(this._offset||0):G(t).local(),s=6e4*(this.zone()-a.zone());return e=m(e),"year"===e||"month"===e?(r=432e5*(this.daysInMonth()+a.daysInMonth()),n=12*(this.year()-a.year())+(this.month()-a.month()),n+=(this-G(this).startOf("month")-(a-G(a).startOf("month")))/r,n-=6e4*(this.zone()-G(this).startOf("month").zone()-(a.zone()-G(a).startOf("month").zone()))/r,"year"===e&&(n/=12)):(r=this-a,n="second"===e?r/1e3:"minute"===e?r/6e4:"hour"===e?r/36e5:"day"===e?(r-s)/864e5:"week"===e?(r-s)/6048e5:r),i?n:c(n)},from:function(t,e){return G.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(G(),t)},calendar:function(){var t=this.diff(G().zone(this.zone()).startOf("day"),"days",!0),e=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";return this.format(this.lang().calendar(e,this))},isLeapYear:function(){var t=this.year();return t%4===0&&t%100!==0||t%400===0},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?"string"==typeof t&&(t=this.lang().weekdaysParse(t),"number"!=typeof t)?this:this.add({d:t-e}):e},month:function(t){var e,i=this._isUTC?"UTC":"";return null!=t?"string"==typeof t&&(t=this.lang().monthsParse(t),"number"!=typeof t)?this:(e=this.date(),this.date(1),this._d["set"+i+"Month"](t),this.date(Math.min(e,this.daysInMonth())),G.updateOffset(this),this):this._d["get"+i+"Month"]()},startOf:function(t){switch(t=m(t)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoweek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoweek"===t&&this.isoWeekday(1),this},endOf:function(t){return t=m(t),this.startOf(t).add("isoweek"===t?"week":t,1).subtract("ms",1)},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+G(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+G(t).startOf(e)},isSame:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)===+G(t).startOf(e)},min:function(t){return t=G.apply(null,arguments),this>t?this:t},max:function(t){return t=G.apply(null,arguments),t>this?this:t},zone:function(t){var e=this._offset||0;return null==t?this._isUTC?e:this._d.getTimezoneOffset():("string"==typeof t&&(t=w(t)),Math.abs(t)<16&&(t=60*t),this._offset=t,this._isUTC=!0,e!==t&&p(this,G.duration(e-t,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},hasAlignedHourOffset:function(t){return t=t?G(t).zone():0,(this.zone()-t)%60===0},daysInMonth:function(){return G.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(t){var e=H((G(this).startOf("day")-G(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},weekYear:function(t){var e=L(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)},isoWeekYear:function(t){var e=L(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=L(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},get:function(t){return t=m(t),this[t.toLowerCase()]()},set:function(t,e){t=m(t),this[t.toLowerCase()](e)},lang:function(t){return t===i?this._lang:(this._lang=b(t),this)}}),z=0;z<lt.length;z++)V(lt[z].toLowerCase().replace(/s$/,""),lt[z]);V("year","FullYear"),G.fn.days=G.fn.day,G.fn.months=G.fn.month,G.fn.weeks=G.fn.week,G.fn.isoWeeks=G.fn.isoWeek,G.fn.toJSON=G.fn.toISOString,l(G.duration.fn=h.prototype,{_bubble:function(){var t,e,i,r,n=this._milliseconds,a=this._days,s=this._months,o=this._data;o.milliseconds=n%1e3,t=c(n/1e3),o.seconds=t%60,e=c(t/60),o.minutes=e%60,i=c(e/60),o.hours=i%24,a+=c(i/24),o.days=a%30,s+=c(a/30),o.months=s%12,r=c(s/12),o.years=r},weeks:function(){return c(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*~~(this._months/12)},humanize:function(t){var e=+this,i=D(e,!t,this.lang());return t&&(i=this.lang().pastFuture(e,i)),this.lang().postformat(i)},add:function(t,e){var i=G.duration(t,e);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(t,e){var i=G.duration(t,e);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(t){return t=m(t),this[t.toLowerCase()+"s"]()},as:function(t){return t=m(t),this["as"+t.charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:G.fn.lang});for(z in ct)ct.hasOwnProperty(z)&&(U(z,ct[z]),B(z.toLowerCase()));U("Weeks",6048e5),G.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},G.lang("en",{ordinal:function(t){var e=t%10,i=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+i}}),G.lang("en"),Q&&(t.exports=G),"undefined"==typeof ender&&(this.moment=G),r=[],n=function(){return G}.apply(e,r),!(n!==i&&(t.exports=n))}).call(this)},function(t,e,i){var r;!function(){var n={};!function(){"use strict";function t(e,i,r){var n=function(){};n.prototype=e.prototype;var a=new n,s=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;r=r||{};for(var o in r){var u=r[o],h=a[o];"function"==typeof h&&"function"==typeof u&&s.test(u)?a[o]=function(t,e){return function(){var i=this.parent;this.parent=e;var r=t.apply(this,arguments);return this.parent=i,r}}(u,h):a[o]=u}a.typename=i;var l=function(){a.init&&a.init.apply(this,arguments)};return l.prototype=a,l.prototype.constructor=l,l.extend=function(e,i){return"object"==typeof e&&(i=e,e="anonymous"),t(l,e,i)},l}n.object=t(Object,"Object",{})}(),function(){"use strict";var t=Array.prototype,e=Object.prototype,i={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},r=/[&"'<>]/g,a=function(t){return i[t]},s=n.lib={};s.withPrettyErrors=function(t,e,i){try{return i()}catch(r){if(r.Update||(r=new s.TemplateError(r)),r.Update(t),!e){var n=r;r=new Error(n.message),r.name=n.name}throw r}},s.TemplateError=function(t,e,i){var r=this;return t instanceof Error?(r=t,t=t.name+": "+t.message):Error.captureStackTrace&&Error.captureStackTrace(r),r.name="Template render error",r.message=t,r.lineno=e,r.colno=i,r.firstUpdate=!0,r.Update=function(t){var e="("+(t||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?e+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(e+=" [Line "+this.lineno+"]")),e+="\n ",this.firstUpdate&&(e+=" "),this.message=e+(this.message||""),this.firstUpdate=!1,this},r},s.TemplateError.prototype=Error.prototype,s.escape=function(t){return t.replace(r,a)},s.isFunction=function(t){return"[object Function]"===e.toString.call(t)},s.isArray=Array.isArray||function(t){return"[object Array]"===e.toString.call(t)},s.isString=function(t){return"[object String]"===e.toString.call(t)},s.isObject=function(t){return"[object Object]"===e.toString.call(t)},s.groupBy=function(t,e){for(var i={},r=s.isFunction(e)?e:function(t){return t[e]},n=0;n<t.length;n++){var a=t[n],o=r(a,n);(i[o]||(i[o]=[])).push(a)}return i},s.toArray=function(t){return Array.prototype.slice.call(t)},s.without=function(t){var e=[];if(!t)return e;for(var i=-1,r=t.length,n=s.toArray(arguments).slice(1);++i<r;)-1===s.indexOf(n,t[i])&&e.push(t[i]);return e},s.extend=function(t,e){for(var i in e)t[i]=e[i];return t},s.repeat=function(t,e){for(var i="",r=0;e>r;r++)i+=t;return i},s.each=function(e,i,r){if(null!=e)if(t.each&&e.each===t.each)e.forEach(i,r);else if(e.length===+e.length)for(var n=0,a=e.length;a>n;n++)i.call(r,e[n],n,e)},s.map=function(e,i){var r=[];if(null==e)return r;if(t.map&&e.map===t.map)return e.map(i);for(var n=0;n<e.length;n++)r[r.length]=i(e[n],n);return e.length===+e.length&&(r.length=e.length),r},s.asyncIter=function(t,e,i){function r(){n++,n<t.length?e(t[n],n,r,i):i()}var n=-1;r()},s.asyncFor=function(t,e,i){function r(){o++;var s=n[o];a>o?e(s,t[s],o,a,r):i()}var n=s.keys(t),a=n.length,o=-1;r()},s.indexOf=Array.prototype.indexOf?function(t,e,i){return Array.prototype.indexOf.call(t,e,i)}:function(t,e,i){var r=this.length>>>0;for(i=+i||0,Math.abs(i)===1/0&&(i=0),0>i&&(i+=r,0>i&&(i=0));r>i;i++)if(t[i]===e)return i;return-1},Array.prototype.map||(Array.prototype.map=function(){throw new Error("map is unimplemented for this js engine")}),s.keys=function(t){if(Object.prototype.keys)return t.keys();var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}}(),function(){"use strict";function t(t,e,i){t instanceof e&&i.push(t),t instanceof s&&t.findAll(e,i)}function e(t,n){function a(t,e,r){for(var n=t.split("\n"),a=0;a<n.length;a++){if(n[a]&&(r&&a>0||!r))for(var s=0;e>s;s++)i.print(" ");a===n.length-1?i.print(n[a]):i.puts(n[a])}}if(n=n||0,a(t.typename+": ",n),t instanceof u)a("\n"),r.each(t.children,function(t){e(t,n+2)});else if(t instanceof it)a(t.extName+"."+t.prop),a("\n"),t.args&&e(t.args,n+2),t.contentArgs&&r.each(t.contentArgs,function(t){e(t,n+2)});else{var o=null,h=null;if(t.iterFields(function(t,e){t instanceof s?(o=o||{},o[e]=t):(h=h||{},h[e]=t)}),h?a(i.inspect(h,!0,null)+"\n",null,!0):a("\n"),o)for(var l in o)e(o[l],n+2)}}var i=n.util,r=n.lib,a=n.object,s=a.extend("Node",{init:function(t,e){this.lineno=t,this.colno=e;for(var i=this.fields,r=0,n=i.length;n>r;r++){var a=i[r],s=arguments[r+2];void 0===s&&(s=null),this[a]=s}},findAll:function(e,i){if(i=i||[],this instanceof u)for(var r=this.children,n=0,a=r.length;a>n;n++)t(r[n],e,i);else for(var s=this.fields,n=0,a=s.length;a>n;n++)t(this[s[n]],e,i);return i},iterFields:function(t){r.each(this.fields,function(e){t(this[e],e)},this)}}),o=s.extend("Value",{fields:["value"]}),u=s.extend("NodeList",{fields:["children"],init:function(t,e,i){this.parent(t,e,i||[])},addChild:function(t){this.children.push(t)}}),h=u.extend("Root"),l=o.extend("Literal"),c=o.extend("Symbol"),d=u.extend("Group"),p=u.extend("Array"),f=s.extend("Pair",{fields:["key","value"]}),g=u.extend("Dict"),m=s.extend("LookupVal",{fields:["target","val"]}),v=s.extend("If",{fields:["cond","body","else_"]}),_=v.extend("IfAsync"),b=s.extend("InlineIf",{fields:["cond","body","else_"]}),x=s.extend("For",{fields:["arr","name","body","else_"]}),A=x.extend("AsyncEach"),y=x.extend("AsyncAll"),S=s.extend("Macro",{fields:["name","args","body"]}),C=S.extend("Caller"),w=s.extend("Import",{fields:["template","target","withContext"]}),T=s.extend("FromImport",{fields:["template","names","withContext"],init:function(t,e,i,r,n){this.parent(t,e,i,r||new u,n)}}),M=s.extend("FunCall",{fields:["name","args"]}),E=M.extend("Filter"),k=E.extend("FilterAsync",{fields:["name","args","symbol"]}),I=g.extend("KeywordArgs"),N=s.extend("Block",{fields:["name","body"]}),R=s.extend("Super",{fields:["blockName","symbol"]}),F=s.extend("TemplateRef",{fields:["template"]}),P=F.extend("Extends"),D=F.extend("Include"),L=s.extend("Set",{fields:["targets","value"]}),O=u.extend("Output"),V=l.extend("TemplateData"),B=s.extend("UnaryOp",{fields:["target"]}),U=s.extend("BinOp",{fields:["left","right"]}),G=U.extend("In"),z=U.extend("Or"),j=U.extend("And"),H=B.extend("Not"),W=U.extend("Add"),Q=U.extend("Sub"),Y=U.extend("Mul"),q=U.extend("Div"),X=U.extend("FloorDiv"),K=U.extend("Mod"),J=U.extend("Pow"),Z=B.extend("Neg"),$=B.extend("Pos"),tt=s.extend("Compare",{fields:["expr","ops"]}),et=s.extend("CompareOperand",{fields:["expr","type"]}),it=(s.extend("CustomTag",{init:function(t,e,i){this.lineno=t,this.colno=e,this.name=i}}),s.extend("CallExtension",{fields:["extName","prop","args","contentArgs"],init:function(t,e,i,r){this.extName=t._name||t,this.prop=e,this.args=i||new u,this.contentArgs=r||[],this.autoescape=t.autoescape}})),rt=it.extend("CallExtensionAsync");n.nodes={Node:s,Root:h,NodeList:u,Value:o,Literal:l,Symbol:c,Group:d,Array:p,Pair:f,Dict:g,Output:O,TemplateData:V,If:v,IfAsync:_,InlineIf:b,For:x,AsyncEach:A,AsyncAll:y,Macro:S,Caller:C,Import:w,FromImport:T,FunCall:M,Filter:E,FilterAsync:k,KeywordArgs:I,Block:N,Super:R,Extends:P,Include:D,Set:L,LookupVal:m,BinOp:U,In:G,Or:z,And:j,Not:H,Add:W,Sub:Q,Mul:Y,Div:q,FloorDiv:X,Mod:K,Pow:J,Neg:Z,Pos:$,Compare:tt,CompareOperand:et,CallExtension:it,CallExtensionAsync:rt,printNodes:e}}(),function(){"use strict";function t(t,e,n){return function(){var a,s=r(arguments),o=i(arguments);if(s>t.length){a=Array.prototype.slice.call(arguments,0,t.length);for(var u=Array.prototype.slice.call(arguments,a.length,s),h=0;h<u.length;h++)h<e.length&&(o[e[h]]=u[h]);a.push(o)}else if(s<t.length){a=Array.prototype.slice.call(arguments,0,s);for(var h=s;h<t.length;h++){var l=t[h];a.push(o[l]),delete o[l]}a.push(o)}else a=arguments;return n.apply(this,a)}}function e(t){return t.__keywords=!0,t}function i(t){var e=t.length;if(e){var i=t[e-1];if(i&&i.hasOwnProperty("__keywords"))return i}return{}}function r(t){var e=t.length;if(0===e)return 0;var i=t[e-1];return i&&i.hasOwnProperty("__keywords")?e-1:e}function a(t){return"string"!=typeof t?t:void(this.val=t)}function s(t,e){return t instanceof a?new a(e):e.toString()}function o(t){var e=typeof t;return"string"===e?new a(t):"function"!==e?t:function(){var e=t.apply(this,arguments);return"string"==typeof e?new a(e):e}}function u(t,e){return t=void 0!==t&&null!==t?t:"",e&&"string"==typeof t&&(t=g.escape(t)),t}function h(t,e){return t=t||{},"function"==typeof t[e]?function(){return t[e].apply(t,arguments)}:t[e]}function l(t,e,i){if(!t)throw new Error("Unable to call `"+e+"`, which is undefined or falsey");if("function"!=typeof t)throw new Error("Unable to call `"+e+"`, which is not a function");return t.apply(this,i)}function c(t,e,i){var r=e.lookup(i);return void 0!==r&&null!==r?r:t.lookup(i)}function d(t,e,i){return t.lineno?t:new g.TemplateError(t,e,i)}function p(t,e,i,r){if(g.isArray(t)){var n=t.length;g.asyncIter(t,function(t,r,a){switch(e){case 1:i(t,r,n,a);break;case 2:i(t[0],t[1],r,n,a);break;case 3:i(t[0],t[1],t[2],r,n,a);break;default:t.push(r,a),i.apply(this,t)}},r)}else g.asyncFor(t,function(t,e,r,n,a){i(t,e,r,n,a)},r)}function f(t,e,i,r){function n(t,e){o++,s[t]=e,o===a&&r(null,s.join(""))}var a,s,o=0;if(g.isArray(t))if(a=t.length,s=new Array(a),0===a)r(null,"");else for(var u=0;u<t.length;u++){var h=t[u];switch(e){case 1:i(h,u,a,n);break;case 2:i(h[0],h[1],u,a,n);break;case 3:i(h[0],h[1],h[2],u,a,n);break;default:h.push(u,n),i.apply(this,h)}}else{var l=g.keys(t);if(a=l.length,s=new Array(a),0===a)r(null,"");else for(var u=0;u<l.length;u++){var c=l[u];i(c,t[c],u,a,n)}}}var g=n.lib,m=n.object,v=m.extend({init:function(t){this.variables={},this.parent=t},set:function(t,e,i){var r=t.split("."),n=this.variables,a=this;if(i){if(a=this.resolve(r[0]))return void a.set(t,e);a=this}for(var s=0;s<r.length-1;s++){var o=r[s];n[o]||(n[o]={}),n=n[o]}n[r[r.length-1]]=e},get:function(t){var e=this.variables[t];return void 0!==e&&null!==e?e:null},lookup:function(t){var e=this.parent,i=this.variables[t];return void 0!==i&&null!==i?i:e&&e.lookup(t)},resolve:function(t){var e=this.parent,i=this.variables[t];return void 0!==i&&null!==i?this:e&&e.resolve(t)},push:function(){return new v(this)},pop:function(){return this.parent}});a.prototype=Object.create(String.prototype),a.prototype.valueOf=function(){return this.val},a.prototype.toString=function(){return this.val},n.runtime={Frame:v,makeMacro:t,makeKeywordArgs:e,numArgs:r,suppressValue:u,memberLookup:h,contextOrFrameLookup:c,callWrap:l,handleError:d,isArray:g.isArray,keys:g.keys,SafeString:a,copySafeness:s,markSafe:o,asyncEach:p,asyncAll:f}}(),function(){"use strict";function t(t,e,i,r){return{type:t,value:e,lineno:i,colno:r}}function e(t,e){this.str=t,this.index=0,this.len=t.length,this.lineno=0,this.colno=0,this.in_code=!1,e=e||{};var i=e.tags||{};this.tags={BLOCK_START:i.blockStart||o,BLOCK_END:i.blockEnd||u,VARIABLE_START:i.variableStart||h,VARIABLE_END:i.variableEnd||l,COMMENT_START:i.commentStart||c,COMMENT_END:i.commentEnd||d},this.trimBlocks=!!e.trimBlocks,this.lstripBlocks=!!e.lstripBlocks}var i=n.lib,r=" \n	\r ",a="()[]{}%*-+/#,:|.<>=!",s="0123456789",o="{%",u="%}",h="{{",l="}}",c="{#",d="#}",p="string",f="whitespace",g="data",m="block-start",v="block-end",_="variable-start",b="variable-end",x="comment",A="left-paren",y="right-paren",S="left-bracket",C="right-bracket",w="left-curly",T="right-curly",M="operator",E="comma",k="colon",I="pipe",N="int",R="float",F="boolean",P="symbol",D="special",L="regex";e.prototype.nextToken=function(){var e,n=this.lineno,o=this.colno;if(this.in_code){var u=this.current();if(this.is_finished())return null;if('"'===u||"'"===u)return t(p,this.parseString(u),n,o);if(e=this._extract(r))return t(f,e,n,o);if((e=this._extractString(this.tags.BLOCK_END))||(e=this._extractString("-"+this.tags.BLOCK_END)))return this.in_code=!1,this.trimBlocks&&(u=this.current(),"\n"===u&&this.forward()),t(v,e,n,o);if(e=this._extractString(this.tags.VARIABLE_END))return this.in_code=!1,t(b,e,n,o);if("r"===u&&"/"===this.str.charAt(this.index+1)){this.forwardN(2);for(var h="";!this.is_finished();){if("/"===this.current()&&"\\"!==this.previous()){this.forward();break}h+=this.current(),this.forward()}for(var l=["g","i","m","y"],c="";!this.is_finished();){var d=-1!==l.indexOf(this.current());if(!d)break;c+=this.current(),this.forward()}return t(L,{body:h,flags:c},n,o)}if(-1!==a.indexOf(u)){this.forward();var D,O=["==","!=","<=",">=","//","**"],V=u+this.current();switch(-1!==i.indexOf(O,V)&&(this.forward(),u=V),u){case"(":D=A;break;case")":D=y;break;case"[":D=S;break;case"]":D=C;break;case"{":D=w;break;case"}":D=T;break;case",":D=E;break;case":":D=k;break;case"|":D=I;break;default:D=M}return t(D,u,n,o)}if(e=this._extractUntil(r+a),e.match(/^[-+]?[0-9]+$/)){if("."===this.current()){this.forward();var B=this._extract(s);return t(R,e+"."+B,n,o)}return t(N,e,n,o)}if(e.match(/^(true|false)$/))return t(F,e,n,o);if(e)return t(P,e,n,o);throw new Error("Unexpected value while parsing: "+e)}var U=this.tags.BLOCK_START.charAt(0)+this.tags.VARIABLE_START.charAt(0)+this.tags.COMMENT_START.charAt(0)+this.tags.COMMENT_END.charAt(0);
if(this.is_finished())return null;if((e=this._extractString(this.tags.BLOCK_START+"-"))||(e=this._extractString(this.tags.BLOCK_START)))return this.in_code=!0,t(m,e,n,o);if(e=this._extractString(this.tags.VARIABLE_START))return this.in_code=!0,t(_,e,n,o);e="";var G,z=!1;for(this._matches(this.tags.COMMENT_START)&&(z=!0,e=this._extractString(this.tags.COMMENT_START));null!==(G=this._extractUntil(U));){if(e+=G,(this._matches(this.tags.BLOCK_START)||this._matches(this.tags.VARIABLE_START)||this._matches(this.tags.COMMENT_START))&&!z){if(this.lstripBlocks&&this._matches(this.tags.BLOCK_START)&&this.colno>0&&this.colno<=e.length){var j=e.slice(-this.colno);if(/^\s+$/.test(j)&&(e=e.slice(0,-this.colno),!e.length))return this.nextToken()}break}if(this._matches(this.tags.COMMENT_END)){if(!z)throw new Error("unexpected end of comment");e+=this._extractString(this.tags.COMMENT_END);break}e+=this.current(),this.forward()}if(null===G&&z)throw new Error("expected end of comment, got end of file");return t(z?x:g,e,n,o)},e.prototype.parseString=function(t){this.forward();for(var e=(this.lineno,this.colno,"");!this.is_finished()&&this.current()!==t;){var i=this.current();if("\\"===i){switch(this.forward(),this.current()){case"n":e+="\n";break;case"t":e+="	";break;case"r":e+="\r";break;default:e+=this.current()}this.forward()}else e+=i,this.forward()}return this.forward(),e},e.prototype._matches=function(t){if(this.index+t.length>this.len)return null;var e=this.str.slice(this.index,this.index+t.length);return e===t},e.prototype._extractString=function(t){return this._matches(t)?(this.index+=t.length,t):null},e.prototype._extractUntil=function(t){return this._extractMatching(!0,t||"")},e.prototype._extract=function(t){return this._extractMatching(!1,t)},e.prototype._extractMatching=function(t,e){if(this.is_finished())return null;var i=e.indexOf(this.current());if(t&&-1===i||!t&&-1!==i){var r=this.current();this.forward();for(var n=e.indexOf(this.current());(t&&-1===n||!t&&-1!==n)&&!this.is_finished();)r+=this.current(),this.forward(),n=e.indexOf(this.current());return r}return""},e.prototype.is_finished=function(){return this.index>=this.len},e.prototype.forwardN=function(t){for(var e=0;t>e;e++)this.forward()},e.prototype.forward=function(){this.index++,"\n"===this.previous()?(this.lineno++,this.colno=0):this.colno++},e.prototype.back=function(){if(this.index--,"\n"===this.current()){this.lineno--;var t=this.src.lastIndexOf("\n",this.index-1);-1===t?this.colno=this.index:this.colno=this.index-t}else this.colno--},e.prototype.current=function(){return this.is_finished()?"":this.str.charAt(this.index)},e.prototype.previous=function(){return this.str.charAt(this.index-1)},n.lexer={lex:function(t,i){return new e(t,i)},TOKEN_STRING:p,TOKEN_WHITESPACE:f,TOKEN_DATA:g,TOKEN_BLOCK_START:m,TOKEN_BLOCK_END:v,TOKEN_VARIABLE_START:_,TOKEN_VARIABLE_END:b,TOKEN_COMMENT:x,TOKEN_LEFT_PAREN:A,TOKEN_RIGHT_PAREN:y,TOKEN_LEFT_BRACKET:S,TOKEN_RIGHT_BRACKET:C,TOKEN_LEFT_CURLY:w,TOKEN_RIGHT_CURLY:T,TOKEN_OPERATOR:M,TOKEN_COMMA:E,TOKEN_COLON:k,TOKEN_PIPE:I,TOKEN_INT:N,TOKEN_FLOAT:R,TOKEN_BOOLEAN:F,TOKEN_SYMBOL:P,TOKEN_SPECIAL:D,TOKEN_REGEX:L}}(),function(){"use strict";var t=n.lexer,e=n.nodes,i=n.object,r=n.lib,a=i.extend({init:function(t){this.tokens=t,this.peeked=null,this.breakOnBlocks=null,this.dropLeadingWhitespace=!1,this.extensions=[]},nextToken:function(e){var i;if(this.peeked){if(e||this.peeked.type!==t.TOKEN_WHITESPACE)return i=this.peeked,this.peeked=null,i;this.peeked=null}if(i=this.tokens.nextToken(),!e)for(;i&&i.type===t.TOKEN_WHITESPACE;)i=this.tokens.nextToken();return i},peekToken:function(){return this.peeked=this.peeked||this.nextToken(),this.peeked},pushToken:function(t){if(this.peeked)throw new Error("pushToken: can only push one token on between reads");this.peeked=t},fail:function(t,e,i){if((void 0===e||void 0===i)&&this.peekToken()){var n=this.peekToken();e=n.lineno,i=n.colno}throw void 0!==e&&(e+=1),void 0!==i&&(i+=1),new r.TemplateError(t,e,i)},skip:function(t){var e=this.nextToken();return e&&e.type===t?!0:(this.pushToken(e),!1)},expect:function(t){var e=this.nextToken();return e.type!==t&&this.fail("expected "+t+", got "+e.type,e.lineno,e.colno),e},skipValue:function(t,e){var i=this.nextToken();return i&&i.type===t&&i.value===e?!0:(this.pushToken(i),!1)},skipWhitespace:function(){return this.skip(t.TOKEN_WHITESPACE)},skipSymbol:function(e){return this.skipValue(t.TOKEN_SYMBOL,e)},advanceAfterBlockEnd:function(e){if(!e){var i=this.peekToken();i||this.fail("unexpected end of file"),i.type!==t.TOKEN_SYMBOL&&this.fail("advanceAfterBlockEnd: expected symbol token or explicit name to be passed"),e=this.nextToken().value}var i=this.nextToken();i&&i.type===t.TOKEN_BLOCK_END?"-"===i.value.charAt(0)&&(this.dropLeadingWhitespace=!0):this.fail("expected block end in "+e+" statement")},advanceAfterVariableEnd:function(){this.skip(t.TOKEN_VARIABLE_END)||this.fail("expected variable end")},parseFor:function(){var i,r,n=this.peekToken();this.skipSymbol("for")?(i=new e.For(n.lineno,n.colno),r="endfor"):this.skipSymbol("asyncEach")?(i=new e.AsyncEach(n.lineno,n.colno),r="endeach"):this.skipSymbol("asyncAll")?(i=new e.AsyncAll(n.lineno,n.colno),r="endall"):this.fail("parseFor: expected for{Async}",n.lineno,n.colno),i.name=this.parsePrimary(),i.name instanceof e.Symbol||this.fail("parseFor: variable name expected for loop");var a=this.peekToken().type;if(a===t.TOKEN_COMMA){var s=i.name;for(i.name=new e.Array(s.lineno,s.colno),i.name.addChild(s);this.skip(t.TOKEN_COMMA);){var o=this.parsePrimary();i.name.addChild(o)}}return this.skipSymbol("in")||this.fail('parseFor: expected "in" keyword for loop',n.lineno,n.colno),i.arr=this.parseExpression(),this.advanceAfterBlockEnd(n.value),i.body=this.parseUntilBlocks(r,"else"),this.skipSymbol("else")&&(this.advanceAfterBlockEnd("else"),i.else_=this.parseUntilBlocks(r)),this.advanceAfterBlockEnd(),i},parseMacro:function(){var t=this.peekToken();this.skipSymbol("macro")||this.fail("expected macro");var i=this.parsePrimary(!0),r=this.parseSignature(),n=new e.Macro(t.lineno,t.colno,i,r);return this.advanceAfterBlockEnd(t.value),n.body=this.parseUntilBlocks("endmacro"),this.advanceAfterBlockEnd(),n},parseCall:function(){var t=this.peekToken();this.skipSymbol("call")||this.fail("expected call");var i=this.parseSignature(!0)||new e.NodeList,r=this.parsePrimary();this.advanceAfterBlockEnd(t.value);var n=this.parseUntilBlocks("endcall");this.advanceAfterBlockEnd();var a=new e.Symbol(t.lineno,t.colno,"caller"),s=new e.Caller(t.lineno,t.colno,a,i,n),o=r.args.children;o[o.length-1]instanceof e.KeywordArgs||o.push(new e.KeywordArgs);var u=o[o.length-1];return u.addChild(new e.Pair(t.lineno,t.colno,a,s)),new e.Output(t.lineno,t.colno,[r])},parseWithContext:function(){var t=this.peekToken(),e=null;return this.skipSymbol("with")?e=!0:this.skipSymbol("without")&&(e=!1),null!==e&&(this.skipSymbol("context")||this.fail("parseFrom: expected context after with/without",t.lineno,t.colno)),e},parseImport:function(){var t=this.peekToken();this.skipSymbol("import")||this.fail("parseImport: expected import",t.lineno,t.colno);var i=this.parseExpression();this.skipSymbol("as")||this.fail('parseImport: expected "as" keyword',t.lineno,t.colno);var r=this.parsePrimary(),n=this.parseWithContext(),a=new e.Import(t.lineno,t.colno,i,r,n);return this.advanceAfterBlockEnd(t.value),a},parseFrom:function(){var i=this.peekToken();this.skipSymbol("from")||this.fail("parseFrom: expected from");var r=this.parsePrimary();this.skipSymbol("import")||this.fail("parseFrom: expected import",i.lineno,i.colno);for(var n,a=new e.NodeList;;){var s=this.peekToken();if(s.type===t.TOKEN_BLOCK_END){a.children.length||this.fail("parseFrom: Expected at least one import name",i.lineno,i.colno),"-"===s.value.charAt(0)&&(this.dropLeadingWhitespace=!0),this.nextToken();break}a.children.length>0&&!this.skip(t.TOKEN_COMMA)&&this.fail("parseFrom: expected comma",i.lineno,i.colno);var o=this.parsePrimary();if("_"===o.value.charAt(0)&&this.fail("parseFrom: names starting with an underscore cannot be imported",o.lineno,o.colno),this.skipSymbol("as")){var u=this.parsePrimary();a.addChild(new e.Pair(o.lineno,o.colno,o,u))}else a.addChild(o);n=this.parseWithContext()}return new e.FromImport(i.lineno,i.colno,r,a,n)},parseBlock:function(){var t=this.peekToken();this.skipSymbol("block")||this.fail("parseBlock: expected block",t.lineno,t.colno);var i=new e.Block(t.lineno,t.colno);return i.name=this.parsePrimary(),i.name instanceof e.Symbol||this.fail("parseBlock: variable name expected",t.lineno,t.colno),this.advanceAfterBlockEnd(t.value),i.body=this.parseUntilBlocks("endblock"),this.peekToken()||this.fail("parseBlock: expected endblock, got end of file"),this.advanceAfterBlockEnd(),i},parseTemplateRef:function(t,e){var i=this.peekToken();this.skipSymbol(t)||this.fail("parseTemplateRef: expected "+t);var r=new e(i.lineno,i.colno);return r.template=this.parseExpression(),this.advanceAfterBlockEnd(i.value),r},parseExtends:function(){return this.parseTemplateRef("extends",e.Extends)},parseInclude:function(){return this.parseTemplateRef("include",e.Include)},parseIf:function(){var t,i=this.peekToken();this.skipSymbol("if")||this.skipSymbol("elif")?t=new e.If(i.lineno,i.colno):this.skipSymbol("ifAsync")?t=new e.IfAsync(i.lineno,i.colno):this.fail("parseIf: expected if or elif",i.lineno,i.colno),t.cond=this.parseExpression(),this.advanceAfterBlockEnd(i.value),t.body=this.parseUntilBlocks("elif","else","endif");var r=this.peekToken();switch(r&&r.value){case"elif":t.else_=this.parseIf();break;case"else":this.advanceAfterBlockEnd(),t.else_=this.parseUntilBlocks("endif"),this.advanceAfterBlockEnd();break;case"endif":t.else_=null,this.advanceAfterBlockEnd();break;default:this.fail("parseIf: expected endif, else, or endif, got end of file")}return t},parseSet:function(){var i=this.peekToken();this.skipSymbol("set")||this.fail("parseSet: expected set",i.lineno,i.colno);for(var r,n=new e.Set(i.lineno,i.colno,[]);(r=this.parsePrimary())&&(n.targets.push(r),this.skip(t.TOKEN_COMMA)););return this.skipValue(t.TOKEN_OPERATOR,"=")||this.fail("parseSet: expected = in set tag",i.lineno,i.colno),n.value=this.parseExpression(),this.advanceAfterBlockEnd(i.value),n},parseStatement:function(){var i,n=this.peekToken();if(n.type!==t.TOKEN_SYMBOL&&this.fail("tag name expected",n.lineno,n.colno),this.breakOnBlocks&&-1!==r.indexOf(this.breakOnBlocks,n.value))return null;switch(n.value){case"raw":return this.parseRaw();case"if":case"ifAsync":return this.parseIf();case"for":case"asyncEach":case"asyncAll":return this.parseFor();case"block":return this.parseBlock();case"extends":return this.parseExtends();case"include":return this.parseInclude();case"set":return this.parseSet();case"macro":return this.parseMacro();case"call":return this.parseCall();case"import":return this.parseImport();case"from":return this.parseFrom();default:if(this.extensions.length)for(var a=0;a<this.extensions.length;a++){var s=this.extensions[a];if(-1!==r.indexOf(s.tags||[],n.value))return s.parse(this,e,t)}this.fail("unknown block tag: "+n.value,n.lineno,n.colno)}return i},parseRaw:function(){this.advanceAfterBlockEnd();for(var i="",r=this.peekToken();;){var n=this.nextToken(!0);if(n||this.fail("expected endraw, got end of file"),n.type===t.TOKEN_BLOCK_START){var a=null,s=this.nextToken(!0);if(s.type===t.TOKEN_WHITESPACE&&(a=s,s=this.nextToken()),s.type===t.TOKEN_SYMBOL&&"endraw"===s.value){this.advanceAfterBlockEnd(s.value);break}i+=n.value,a&&(i+=a.value),i+=s.value}else i+=n.type===t.TOKEN_STRING?'"'+n.value+'"':n.value}var o=new e.Output(r.lineno,r.colno,[new e.TemplateData(r.lineno,r.colno,i)]);return o},parsePostfix:function(i){for(var r=this.peekToken();r;){if(r.type===t.TOKEN_LEFT_PAREN)i=new e.FunCall(r.lineno,r.colno,i,this.parseSignature());else if(r.type===t.TOKEN_LEFT_BRACKET){var n=this.parseAggregate();n.children.length>1&&this.fail("invalid index"),i=new e.LookupVal(r.lineno,r.colno,i,n.children[0])}else{if(r.type!==t.TOKEN_OPERATOR||"."!==r.value)break;this.nextToken();var a=this.nextToken();a.type!==t.TOKEN_SYMBOL&&this.fail("expected name as lookup value, got "+a.value,a.lineno,a.colno);var n=new e.Literal(a.lineno,a.colno,a.value);i=new e.LookupVal(r.lineno,r.colno,i,n)}r=this.peekToken()}return i},parseExpression:function(){var t=this.parseInlineIf();return t},parseInlineIf:function(){var t=this.parseOr();if(this.skipSymbol("if")){var i=this.parseOr(),r=t;t=new e.InlineIf(t.lineno,t.colno),t.body=r,t.cond=i,this.skipSymbol("else")?t.else_=this.parseOr():t.else_=null}return t},parseOr:function(){for(var t=this.parseAnd();this.skipSymbol("or");){var i=this.parseAnd();t=new e.Or(t.lineno,t.colno,t,i)}return t},parseAnd:function(){for(var t=this.parseNot();this.skipSymbol("and");){var i=this.parseNot();t=new e.And(t.lineno,t.colno,t,i)}return t},parseNot:function(){var t=this.peekToken();return this.skipSymbol("not")?new e.Not(t.lineno,t.colno,this.parseNot()):this.parseIn()},parseIn:function(){for(var i=this.parseCompare();;){var r=this.nextToken();if(!r)break;var n=r.type===t.TOKEN_SYMBOL&&"not"===r.value;if(n||this.pushToken(r),!this.skipSymbol("in")){n&&this.pushToken(r);break}var a=this.parseCompare();i=new e.In(i.lineno,i.colno,i,a),n&&(i=new e.Not(i.lineno,i.colno,i))}return i},parseCompare:function(){for(var t=["==","!=","<",">","<=",">="],i=this.parseAdd(),n=[];;){var a=this.nextToken();if(!a)break;if(-1===r.indexOf(t,a.value)){this.pushToken(a);break}n.push(new e.CompareOperand(a.lineno,a.colno,this.parseAdd(),a.value))}return n.length?new e.Compare(n[0].lineno,n[0].colno,i,n):i},parseAdd:function(){for(var i=this.parseSub();this.skipValue(t.TOKEN_OPERATOR,"+");){var r=this.parseSub();i=new e.Add(i.lineno,i.colno,i,r)}return i},parseSub:function(){for(var i=this.parseMul();this.skipValue(t.TOKEN_OPERATOR,"-");){var r=this.parseMul();i=new e.Sub(i.lineno,i.colno,i,r)}return i},parseMul:function(){for(var i=this.parseDiv();this.skipValue(t.TOKEN_OPERATOR,"*");){var r=this.parseDiv();i=new e.Mul(i.lineno,i.colno,i,r)}return i},parseDiv:function(){for(var i=this.parseFloorDiv();this.skipValue(t.TOKEN_OPERATOR,"/");){var r=this.parseFloorDiv();i=new e.Div(i.lineno,i.colno,i,r)}return i},parseFloorDiv:function(){for(var i=this.parseMod();this.skipValue(t.TOKEN_OPERATOR,"//");){var r=this.parseMod();i=new e.FloorDiv(i.lineno,i.colno,i,r)}return i},parseMod:function(){for(var i=this.parsePow();this.skipValue(t.TOKEN_OPERATOR,"%");){var r=this.parsePow();i=new e.Mod(i.lineno,i.colno,i,r)}return i},parsePow:function(){for(var i=this.parseUnary();this.skipValue(t.TOKEN_OPERATOR,"**");){var r=this.parseUnary();i=new e.Pow(i.lineno,i.colno,i,r)}return i},parseUnary:function(i){var r,n=this.peekToken();return r=this.skipValue(t.TOKEN_OPERATOR,"-")?new e.Neg(n.lineno,n.colno,this.parseUnary(!0)):this.skipValue(t.TOKEN_OPERATOR,"+")?new e.Pos(n.lineno,n.colno,this.parseUnary(!0)):this.parsePrimary(),i||(r=this.parseFilter(r)),r},parsePrimary:function(i){var r=this.nextToken(),n=null,a=null;return r?r.type===t.TOKEN_STRING?n=r.value:r.type===t.TOKEN_INT?n=parseInt(r.value,10):r.type===t.TOKEN_FLOAT?n=parseFloat(r.value):r.type===t.TOKEN_BOOLEAN?"true"===r.value?n=!0:"false"===r.value?n=!1:this.fail("invalid boolean: "+r.value,r.lineno,r.colno):r.type===t.TOKEN_REGEX&&(n=new RegExp(r.value.body,r.value.flags)):this.fail("expected expression, got end of file"),null!==n?a=new e.Literal(r.lineno,r.colno,n):r.type===t.TOKEN_SYMBOL?(a=new e.Symbol(r.lineno,r.colno,r.value),i||(a=this.parsePostfix(a))):(this.pushToken(r),a=this.parseAggregate()),a?a:void this.fail("unexpected token: "+r.value,r.lineno,r.colno)},parseFilter:function(i){for(;this.skip(t.TOKEN_PIPE);){for(var r=this.expect(t.TOKEN_SYMBOL),n=r.value;this.skipValue(t.TOKEN_OPERATOR,".");)n+="."+this.expect(t.TOKEN_SYMBOL).value;if(i=new e.Filter(r.lineno,r.colno,new e.Symbol(r.lineno,r.colno,n),new e.NodeList(r.lineno,r.colno,[i])),this.peekToken().type===t.TOKEN_LEFT_PAREN){var a=this.parsePostfix(i);i.args.children=i.args.children.concat(a.args.children)}}return i},parseAggregate:function(){var i,r=this.nextToken();switch(r.type){case t.TOKEN_LEFT_PAREN:i=new e.Group(r.lineno,r.colno);break;case t.TOKEN_LEFT_BRACKET:i=new e.Array(r.lineno,r.colno);break;case t.TOKEN_LEFT_CURLY:i=new e.Dict(r.lineno,r.colno);break;default:return null}for(;;){var n=this.peekToken().type;if(n===t.TOKEN_RIGHT_PAREN||n===t.TOKEN_RIGHT_BRACKET||n===t.TOKEN_RIGHT_CURLY){this.nextToken();break}if(i.children.length>0&&(this.skip(t.TOKEN_COMMA)||this.fail("parseAggregate: expected comma after expression",r.lineno,r.colno)),i instanceof e.Dict){var a=this.parsePrimary();this.skip(t.TOKEN_COLON)||this.fail("parseAggregate: expected colon after dict key",r.lineno,r.colno);var s=this.parseExpression();i.addChild(new e.Pair(a.lineno,a.colno,a,s))}else{var o=this.parseExpression();i.addChild(o)}}return i},parseSignature:function(i,r){var n=this.peekToken();if(!r&&n.type!==t.TOKEN_LEFT_PAREN){if(i)return null;this.fail("expected arguments",n.lineno,n.colno)}n.type===t.TOKEN_LEFT_PAREN&&(n=this.nextToken());for(var a=new e.NodeList(n.lineno,n.colno),s=new e.KeywordArgs(n.lineno,n.colno),o=!1;;){if(n=this.peekToken(),!r&&n.type===t.TOKEN_RIGHT_PAREN){this.nextToken();break}if(r&&n.type===t.TOKEN_BLOCK_END)break;if(o&&!this.skip(t.TOKEN_COMMA))this.fail("parseSignature: expected comma after expression",n.lineno,n.colno);else{var u=this.parseExpression();this.skipValue(t.TOKEN_OPERATOR,"=")?s.addChild(new e.Pair(u.lineno,u.colno,u,this.parseExpression())):a.addChild(u)}o=!0}return s.children.length&&a.addChild(s),a},parseUntilBlocks:function(){var t=this.breakOnBlocks;this.breakOnBlocks=r.toArray(arguments);var e=this.parse();return this.breakOnBlocks=t,e},parseNodes:function(){for(var i,r=[];i=this.nextToken();)if(i.type===t.TOKEN_DATA){var n=i.value,a=this.peekToken(),s=a&&a.value;this.dropLeadingWhitespace&&(n=n.replace(/^\s*/,""),this.dropLeadingWhitespace=!1),a&&a.type===t.TOKEN_BLOCK_START&&"-"===s.charAt(s.length-1)&&(n=n.replace(/\s*$/,"")),r.push(new e.Output(i.lineno,i.colno,[new e.TemplateData(i.lineno,i.colno,n)]))}else if(i.type===t.TOKEN_BLOCK_START){var o=this.parseStatement();if(!o)break;r.push(o)}else if(i.type===t.TOKEN_VARIABLE_START){var u=this.parseExpression();this.advanceAfterVariableEnd(),r.push(new e.Output(i.lineno,i.colno,[u]))}else i.type!==t.TOKEN_COMMENT&&this.fail("Unexpected token at top-level: "+i.type,i.lineno,i.colno);return r},parse:function(){return new e.NodeList(0,0,this.parseNodes())},parseAsRoot:function(){return new e.Root(0,0,this.parseNodes())}});n.parser={parse:function(e,i,r){var n=new a(t.lex(e,r));return void 0!==i&&(n.extensions=i),n.parseAsRoot()}}}(),function(){"use strict";function t(){return"hole_"+p++}function e(t,e){for(var i=null,r=0;r<t.length;r++){var n=e(t[r]);n!==t[r]&&(i||(i=t.slice()),i[r]=n)}return i||t}function i(t,r,n){if(!(t instanceof c.Node))return t;if(!n){var a=r(t);if(a&&a!==t)return a}if(t instanceof c.NodeList){var s=e(t.children,function(t){return i(t,r,n)});s!==t.children&&(t=new c[t.typename](t.lineno,t.colno,s))}else if(t instanceof c.CallExtension){var o=i(t.args,r,n),u=e(t.contentArgs,function(t){return i(t,r,n)});(o!==t.args||u!==t.contentArgs)&&(t=new c[t.typename](t.extName,t.prop,o,u))}else{var h=t.fields.map(function(e){return t[e]}),l=e(h,function(t){return i(t,r,n)});l!==h&&(t=new c[t.typename](t.lineno,t.colno),l.forEach(function(e,i){t[t.fields[i]]=e}))}return n?r(t)||t:t}function r(t,e){return i(t,e,!0)}function a(e,i,n){var a=[],s=r(n?e[n]:e,function(e){if(e instanceof c.Block)return e;if(e instanceof c.Filter&&-1!==d.indexOf(i,e.name.value)||e instanceof c.CallExtensionAsync){var r=new c.Symbol(e.lineno,e.colno,t());return a.push(new c.FilterAsync(e.lineno,e.colno,e.name,e.args,r)),r}});return n?e[n]=s:e=s,a.length?(a.push(e),new c.NodeList(e.lineno,e.colno,a)):e}function s(t,e){return r(t,function(t){return t instanceof c.Output?a(t,e):t instanceof c.For?a(t,e,"arr"):t instanceof c.If?a(t,e,"cond"):t instanceof c.CallExtension?a(t,e,"args"):void 0})}function o(e){return i(e,function(e){if(e instanceof c.Block){var r=!1,n=t();e.body=i(e.body,function(t){return t instanceof c.FunCall&&"super"===t.name.value?(r=!0,new c.Symbol(t.lineno,t.colno,n)):void 0}),r&&e.body.children.unshift(new c.Super(0,0,e.name,new c.Symbol(0,0,n)))}})}function u(t){return r(t,function(t){if(t instanceof c.If||t instanceof c.For){var e=!1;if(i(t,function(t){return t instanceof c.FilterAsync||t instanceof c.IfAsync||t instanceof c.AsyncEach||t instanceof c.AsyncAll||t instanceof c.CallExtensionAsync?(e=!0,t):void 0}),e){if(t instanceof c.If)return new c.IfAsync(t.lineno,t.colno,t.cond,t.body,t.else_);if(t instanceof c.For)return new c.AsyncEach(t.lineno,t.colno,t.arr,t.name,t.body,t.else_)}}})}function h(t,e){return u(o(s(t,e)))}function l(t,e,i){return h(t,e||[])}var c=n.nodes,d=n.lib,p=0;n.transformer={transform:l}}(),function(){"use strict";function t(t){return function(e,i){this.compile(e.left,i),this.emit(t),this.compile(e.right,i)}}var e=n.lib,i=n.parser,r=n.transformer,a=n.nodes,s=n.object,o=n.runtime.Frame,u={"==":"==","!=":"!=","<":"<",">":">","<=":"<=",">=":">="},h=s.extend({init:function(t){this.templateName=t,this.codebuf=[],this.lastId=0,this.buffer=null,this.bufferStack=[],this.isChild=!1,this.scopeClosers=""},fail:function(t,i,r){throw void 0!==i&&(i+=1),void 0!==r&&(r+=1),new e.TemplateError(t,i,r)},pushBufferId:function(t){this.bufferStack.push(this.buffer),this.buffer=t,this.emit("var "+this.buffer+' = "";')},popBufferId:function(){this.buffer=this.bufferStack.pop()},emit:function(t){this.codebuf.push(t)},emitLine:function(t){this.emit(t+"\n")},emitLines:function(){e.each(e.toArray(arguments),function(t){this.emitLine(t)},this)},emitFuncBegin:function(t){this.buffer="output",this.scopeClosers="",this.emitLine("function "+t+"(env, context, frame, runtime, cb) {"),this.emitLine("var lineno = null;"),this.emitLine("var colno = null;"),this.emitLine("var "+this.buffer+' = "";'),this.emitLine("try {")},emitFuncEnd:function(t){t||this.emitLine("cb(null, "+this.buffer+");"),this.closeScopeLevels(),this.emitLine("} catch (e) {"),this.emitLine("  cb(runtime.handleError(e, lineno, colno));"),this.emitLine("}"),this.emitLine("}"),this.buffer=null},addScopeLevel:function(){this.scopeClosers+="})"},closeScopeLevels:function(){this.emitLine(this.scopeClosers+";"),this.scopeClosers=""},withScopedSyntax:function(t){var e=this.scopeClosers;this.scopeClosers="",t.call(this),this.closeScopeLevels(),this.scopeClosers=e},makeCallback:function(t){var e=this.tmpid();return"function("+e+(t?","+t:"")+") {\nif("+e+") { cb("+e+"); return; }"},tmpid:function(){return this.lastId++,"t_"+this.lastId},_templateName:function(){return null==this.templateName?"undefined":JSON.stringify(this.templateName)},_bufferAppend:function(t){this.emit(this.buffer+" += runtime.suppressValue("),t.call(this),this.emit(", env.opts.autoescape);\n")},_compileChildren:function(t,e){for(var i=t.children,r=0,n=i.length;n>r;r++)this.compile(i[r],e)},_compileAggregate:function(t,e,i,r){i&&this.emit(i);for(var n=0;n<t.children.length;n++)n>0&&this.emit(","),this.compile(t.children[n],e);r&&this.emit(r)},_compileExpression:function(t,e){this.assertType(t,a.Literal,a.Symbol,a.Group,a.Array,a.Dict,a.FunCall,a.Caller,a.Filter,a.LookupVal,a.Compare,a.InlineIf,a.In,a.And,a.Or,a.Not,a.Add,a.Sub,a.Mul,a.Div,a.FloorDiv,a.Mod,a.Pow,a.Neg,a.Pos,a.Compare,a.NodeList),this.compile(t,e)},assertType:function(t){for(var i=e.toArray(arguments).slice(1),r=!1,n=0;n<i.length;n++)t instanceof i[n]&&(r=!0);r||this.fail("assertType: invalid type: "+t.typename,t.lineno,t.colno)},compileCallExtension:function(t,i,r){var n=(t.extName,t.args),s=t.contentArgs,o="boolean"==typeof t.autoescape?t.autoescape:!0;if(r||this.emit(this.buffer+" += runtime.suppressValue("),this.emit('env.getExtension("'+t.extName+'")["'+t.prop+'"]('),this.emit("context"),(n||s)&&this.emit(","),n&&(n instanceof a.NodeList||this.fail("compileCallExtension: arguments must be a NodeList, use `parser.parseSignature`"),e.each(n.children,function(t,e){this._compileExpression(t,i),(e!==n.children.length-1||s.length)&&this.emit(",")},this)),s.length&&e.each(s,function(t,e){if(e>0&&this.emit(","),t){var r=this.tmpid();this.emitLine("function(cb) {"),this.emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}"),this.pushBufferId(r),this.withScopedSyntax(function(){this.compile(t,i),this.emitLine("cb(null, "+r+");")}),this.popBufferId(),this.emitLine("return "+r+";"),this.emitLine("}")}else this.emit("null")},this),r){var u=this.tmpid();this.emitLine(", "+this.makeCallback(u)),this.emitLine(this.buffer+" += runtime.suppressValue("+u+", "+o+" && env.opts.autoescape);"),this.addScopeLevel()}else this.emit(")"),this.emit(", "+o+" && env.opts.autoescape);\n")},compileCallExtensionAsync:function(t,e){this.compileCallExtension(t,e,!0)},compileNodeList:function(t,e){this._compileChildren(t,e)},compileLiteral:function(t,e){if("string"==typeof t.value){var i=t.value.replace(/\\/g,"\\\\");i=i.replace(/"/g,'\\"'),i=i.replace(/\n/g,"\\n"),i=i.replace(/\r/g,"\\r"),i=i.replace(/\t/g,"\\t"),this.emit('"'+i+'"')}else this.emit(t.value.toString())},compileSymbol:function(t,e){var i,r=t.value;(i=e.lookup(r))?this.emit(i):this.emit('runtime.contextOrFrameLookup(context, frame, "'+r+'")')},compileGroup:function(t,e){this._compileAggregate(t,e,"(",")")},compileArray:function(t,e){this._compileAggregate(t,e,"[","]")},compileDict:function(t,e){this._compileAggregate(t,e,"{","}")},compilePair:function(t,e){var i=t.key,r=t.value;i instanceof a.Symbol?i=new a.Literal(i.lineno,i.colno,i.value):i instanceof a.Literal&&"string"==typeof i.value||this.fail("compilePair: Dict keys must be strings or names",i.lineno,i.colno),this.compile(i,e),this.emit(": "),this._compileExpression(r,e)},compileInlineIf:function(t,e){this.emit("("),this.compile(t.cond,e),this.emit("?"),this.compile(t.body,e),this.emit(":"),null!==t.else_?this.compile(t.else_,e):this.emit('""'),this.emit(")")},compileIn:function(t,e){this.emit("("),this.compile(t.right,e),this.emit(".indexOf("),this.compile(t.left,e),this.emit(") !== -1)")},compileOr:t(" || "),compileAnd:t(" && "),compileAdd:t(" + "),compileSub:t(" - "),compileMul:t(" * "),compileDiv:t(" / "),compileMod:t(" % "),compileNot:function(t,e){this.emit("!"),this.compile(t.target,e)},compileFloorDiv:function(t,e){this.emit("Math.floor("),this.compile(t.left,e),this.emit(" / "),this.compile(t.right,e),this.emit(")")},compilePow:function(t,e){this.emit("Math.pow("),this.compile(t.left,e),this.emit(", "),this.compile(t.right,e),this.emit(")")},compileNeg:function(t,e){this.emit("-"),this.compile(t.target,e)},compilePos:function(t,e){this.emit("+"),this.compile(t.target,e)},compileCompare:function(t,e){this.compile(t.expr,e);for(var i=0;i<t.ops.length;i++){var r=t.ops[i];this.emit(" "+u[r.type]+" "),this.compile(r.expr,e)}},compileLookupVal:function(t,e){this.emit("runtime.memberLookup(("),this._compileExpression(t.target,e),this.emit("),"),this._compileExpression(t.val,e),this.emit(", env.opts.autoescape)")},_getNodeName:function(t){switch(t.typename){case"Symbol":return t.value;case"FunCall":return"the return value of ("+this._getNodeName(t.name)+")";case"LookupVal":return this._getNodeName(t.target)+'["'+this._getNodeName(t.val)+'"]';case"Literal":return t.value.toString().substr(0,10);default:return"--expression--"}},compileFunCall:function(t,e){this.emit("(lineno = "+t.lineno+", colno = "+t.colno+", "),this.emit("runtime.callWrap("),this._compileExpression(t.name,e),this.emit(', "'+this._getNodeName(t.name).replace(/"/g,'\\"')+'", '),this._compileAggregate(t.args,e,"[","])"),this.emit(")")},compileFilter:function(t,e){var i=t.name;this.assertType(i,a.Symbol),this.emit('env.getFilter("'+i.value+'").call(context, '),this._compileAggregate(t.args,e),this.emit(")")},compileFilterAsync:function(t,e){var i=t.name;this.assertType(i,a.Symbol);var r=t.symbol.value;e.set(r,r),this.emit('env.getFilter("'+i.value+'").call(context, '),this._compileAggregate(t.args,e),this.emitLine(", "+this.makeCallback(r)),this.addScopeLevel()},compileKeywordArgs:function(t,i){var r=[];e.each(t.children,function(t){r.push(t.key.value)}),this.emit("runtime.makeKeywordArgs("),this.compileDict(t,i),this.emit(")")},compileSet:function(t,i){var r=[];e.each(t.targets,function(t){var e=t.value,n=i.lookup(e);(null===n||void 0===n)&&(n=this.tmpid(),this.emitLine("var "+n+";")),r.push(n)},this),this.emit(r.join(" = ")+" = "),this._compileExpression(t.value,i),this.emitLine(";"),e.each(t.targets,function(t,e){var i=r[e],n=t.value;this.emitLine('frame.set("'+n+'", '+i+", true);"),this.emitLine("if(!frame.parent) {"),this.emitLine('context.setVariable("'+n+'", '+i+");"),"_"!==n.charAt(0)&&this.emitLine('context.addExport("'+n+'");'),this.emitLine("}")},this)},compileIf:function(t,e,i){this.emit("if("),this._compileExpression(t.cond,e),this.emitLine(") {"),this.withScopedSyntax(function(){this.compile(t.body,e),i&&this.emit("cb()")}),t.else_?(this.emitLine("}\nelse {"),this.withScopedSyntax(function(){this.compile(t.else_,e),i&&this.emit("cb()")})):i&&(this.emitLine("}\nelse {"),this.emit("cb()")),this.emitLine("}")},compileIfAsync:function(t,e){this.emit("(function(cb) {"),this.compileIf(t,e,!0),this.emit("})(function() {"),this.addScopeLevel()},emitLoopBindings:function(t,e,i,r){var n={index:i+" + 1",index0:i,revindex:r+" - "+i,revindex0:r+" - "+i+" - 1",first:i+" === 0",last:i+" === "+r+" - 1",length:r};for(var a in n)this.emitLine('frame.set("loop.'+a+'", '+n[a]+");")},compileFor:function(t,e){var i=this.tmpid(),r=this.tmpid(),n=this.tmpid();if(e=e.push(),this.emitLine("frame = frame.push();"),this.emit("var "+n+" = "),this._compileExpression(t.arr,e),this.emitLine(";"),this.emit("if("+n+") {"),t.name instanceof a.Array){this.emitLine("var "+i+";"),this.emitLine("if(runtime.isArray("+n+")) {"),this.emitLine("var "+r+" = "+n+".length;"),this.emitLine("for("+i+"=0; "+i+" < "+n+".length; "+i+"++) {");for(var s=0;s<t.name.children.length;s++){var o=this.tmpid();this.emitLine("var "+o+" = "+n+"["+i+"]["+s+"]"),this.emitLine('frame.set("'+t.name.children[s].value+'", '+n+"["+i+"]["+s+"]);"),e.set(t.name.children[s].value,o)}this.emitLoopBindings(t,n,i,r),this.withScopedSyntax(function(){this.compile(t.body,e)}),this.emitLine("}"),this.emitLine("} else {");var u=t.name.children[0],h=t.name.children[1],l=this.tmpid(),c=this.tmpid();e.set(u.value,l),e.set(h.value,c),this.emitLine(i+" = -1;"),this.emitLine("var "+r+" = runtime.keys("+n+").length;"),this.emitLine("for(var "+l+" in "+n+") {"),this.emitLine(i+"++;"),this.emitLine("var "+c+" = "+n+"["+l+"];"),this.emitLine('frame.set("'+u.value+'", '+l+");"),this.emitLine('frame.set("'+h.value+'", '+c+");"),this.emitLoopBindings(t,n,i,r),this.withScopedSyntax(function(){this.compile(t.body,e)}),this.emitLine("}"),this.emitLine("}")}else{var c=this.tmpid();e.set(t.name.value,c),this.emitLine("var "+r+" = "+n+".length;"),this.emitLine("for(var "+i+"=0; "+i+" < "+n+".length; "+i+"++) {"),this.emitLine("var "+c+" = "+n+"["+i+"];"),this.emitLine('frame.set("'+t.name.value+'", '+c+");"),this.emitLoopBindings(t,n,i,r),this.withScopedSyntax(function(){this.compile(t.body,e)}),this.emitLine("}")}this.emitLine("}"),t.else_&&(this.emitLine("if (!"+r+") {"),this.compile(t.else_,e),this.emitLine("}")),this.emitLine("frame = frame.pop();")},_compileAsyncLoop:function(t,i,r){var n=this.tmpid(),s=this.tmpid(),o=this.tmpid(),u=r?"asyncAll":"asyncEach";if(i=i.push(),this.emitLine("frame = frame.push();"),this.emit("var "+o+" = "),this._compileExpression(t.arr,i),this.emitLine(";"),t.name instanceof a.Array)this.emit("runtime."+u+"("+o+", "+t.name.children.length+", function("),e.each(t.name.children,function(t){this.emit(t.value+",")},this),this.emit(n+","+s+",next) {"),e.each(t.name.children,function(t){var e=t.value;i.set(e,e),this.emitLine('frame.set("'+e+'", '+e+");");
},this);else{var h=t.name.value;this.emitLine("runtime."+u+"("+o+", 1, function("+h+", "+n+", "+s+",next) {"),this.emitLine('frame.set("'+h+'", '+h+");"),i.set(h,h)}this.emitLoopBindings(t,o,n,s),this.withScopedSyntax(function(){var e;r&&(e=this.tmpid(),this.pushBufferId(e)),this.compile(t.body,i),this.emitLine("next("+n+(e?","+e:"")+");"),r&&this.popBufferId()});var l=this.tmpid();this.emitLine("}, "+this.makeCallback(l)),this.addScopeLevel(),r&&this.emitLine(this.buffer+" += "+l+";"),t.else_&&(this.emitLine("if (!"+o+".length) {"),this.compile(t.else_,i),this.emitLine("}")),this.emitLine("frame = frame.pop();")},compileAsyncEach:function(t,e){this._compileAsyncLoop(t,e)},compileAsyncAll:function(t,e){this._compileAsyncLoop(t,e,!0)},_compileMacro:function(t,i){var r=[],n=null,s="macro_"+this.tmpid();e.each(t.args.children,function(e,i){i===t.args.children.length-1&&e instanceof a.Dict?n=e:(this.assertType(e,a.Symbol),r.push(e))},this);var o=e.map(r,function(t){return"l_"+t.value});o.push("kwargs");var u=e.map(r,function(t){return'"'+t.value+'"'}),h=e.map(n&&n.children||[],function(t){return'"'+t.key.value+'"'});i=i.push(),this.emitLines("var "+s+" = runtime.makeMacro(","["+u.join(", ")+"], ","["+h.join(", ")+"], ","function ("+o.join(", ")+") {","frame = frame.push();","kwargs = kwargs || {};",'if (kwargs.hasOwnProperty("caller")) {','frame.set("caller", kwargs.caller); }'),e.each(r,function(t){this.emitLine('frame.set("'+t.value+'", l_'+t.value+");"),i.set(t.value,"l_"+t.value)},this),n&&e.each(n.children,function(t){var e=t.key.value;this.emit('frame.set("'+e+'", kwargs.hasOwnProperty("'+e+'") ? kwargs["'+e+'"] : '),this._compileExpression(t.value,i),this.emitLine(");")},this);var l=this.tmpid();return this.pushBufferId(l),this.withScopedSyntax(function(){this.compile(t.body,i)}),i=i.pop(),this.emitLine("frame = frame.pop();"),this.emitLine("return new runtime.SafeString("+l+");"),this.emitLine("});"),this.popBufferId(),s},compileMacro:function(t,e){var i=this._compileMacro(t,e),r=t.name.value;e.set(r,i),e.parent?this.emitLine('frame.set("'+r+'", '+i+");"):("_"!==t.name.value.charAt(0)&&this.emitLine('context.addExport("'+r+'");'),this.emitLine('context.setVariable("'+r+'", '+i+");"))},compileCaller:function(t,e){this.emit("(function (){");var i=this._compileMacro(t,e);this.emit("return "+i+";})()")},compileImport:function(t,e){var i=this.tmpid(),r=t.target.value;this.emit("env.getTemplate("),this._compileExpression(t.template,e),this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(i)),this.addScopeLevel(),this.emitLine(i+".getExported("+(t.withContext?"context.getVariables(), frame.push(), ":"")+this.makeCallback(i)),this.addScopeLevel(),e.set(r,i),e.parent?this.emitLine('frame.set("'+r+'", '+i+");"):this.emitLine('context.setVariable("'+r+'", '+i+");")},compileFromImport:function(t,i){var r=this.tmpid();this.emit("env.getTemplate("),this._compileExpression(t.template,i),this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(r)),this.addScopeLevel(),this.emitLine(r+".getExported("+(t.withContext?"context.getVariables(), frame.push(), ":"")+this.makeCallback(r)),this.addScopeLevel(),e.each(t.names.children,function(t){var e,n,s=this.tmpid();t instanceof a.Pair?(e=t.key.value,n=t.value.value):(e=t.value,n=e),this.emitLine("if("+r+'.hasOwnProperty("'+e+'")) {'),this.emitLine("var "+s+" = "+r+"."+e+";"),this.emitLine("} else {"),this.emitLine("cb(new Error(\"cannot import '"+e+"'\")); return;"),this.emitLine("}"),i.set(n,s),i.parent?this.emitLine('frame.set("'+n+'", '+s+");"):this.emitLine('context.setVariable("'+n+'", '+s+");")},this)},compileBlock:function(t,e){if(!this.isChild){var i=this.tmpid();this.emitLine('context.getBlock("'+t.name.value+'")(env, context, frame, runtime, '+this.makeCallback(i)),this.emitLine(this.buffer+" += "+i+";"),this.addScopeLevel()}},compileSuper:function(t,e){var i=t.blockName.value,r=t.symbol.value;this.emitLine('context.getSuper(env, "'+i+'", b_'+i+", frame, runtime, "+this.makeCallback(r)),this.emitLine(r+" = runtime.markSafe("+r+");"),this.addScopeLevel(),e.set(r,r)},compileExtends:function(t,e){this.isChild&&this.fail("compileExtends: cannot extend multiple times",t.template.lineno,t.template.colno);var i=this.tmpid();this.emit("env.getTemplate("),this._compileExpression(t.template,e),this.emitLine(", true, "+this._templateName()+", "+this.makeCallback("parentTemplate")),this.emitLine("for(var "+i+" in parentTemplate.blocks) {"),this.emitLine("context.addBlock("+i+", parentTemplate.blocks["+i+"]);"),this.emitLine("}"),this.addScopeLevel(),this.isChild=!0},compileInclude:function(t,e){var i=this.tmpid(),r=this.tmpid();this.emit("env.getTemplate("),this._compileExpression(t.template,e),this.emitLine(", false, "+this._templateName()+", "+this.makeCallback(i)),this.addScopeLevel(),this.emitLine(i+".render(context.getVariables(), frame.push(), "+this.makeCallback(r)),this.emitLine(this.buffer+" += "+r),this.addScopeLevel()},compileTemplateData:function(t,e){this.compileLiteral(t,e)},compileOutput:function(t,e){for(var i=t.children,r=0,n=i.length;n>r;r++)i[r]instanceof a.TemplateData?i[r].value&&(this.emit(this.buffer+" += "),this.compileLiteral(i[r],e),this.emitLine(";")):(this.emit(this.buffer+" += runtime.suppressValue("),this.compile(i[r],e),this.emit(", env.opts.autoescape);\n"))},compileRoot:function(t,e){e&&this.fail("compileRoot: root node can't have frame"),e=new o,this.emitFuncBegin("root"),this._compileChildren(t,e),this.isChild&&this.emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);"),this.emitFuncEnd(this.isChild),this.isChild=!1;for(var i=t.findAll(a.Block),r=0;r<i.length;r++){var n=i[r],s=n.name.value;this.emitFuncBegin("b_"+s);var u=new o;this.compile(n.body,u),this.emitFuncEnd()}this.emitLine("return {");for(var r=0;r<i.length;r++){var n=i[r],s="b_"+n.name.value;this.emitLine(s+": "+s+",")}this.emitLine("root: root\n};")},compile:function(t,e){var i=this["compile"+t.typename];i?i.call(this,t,e):this.fail("compile: Cannot compile node: "+t.typename,t.lineno,t.colno)},getCode:function(){return this.codebuf.join("")}});n.compiler={compile:function(t,e,n,a,s){var o=new h(a);if(n&&n.length)for(var u=0;u<n.length;u++)"preprocess"in n[u]&&(t=n[u].preprocess(t,a));return o.compile(r.transform(i.parse(t,n,s),e,a)),o.getCode()},Compiler:h}}(),function(){"use strict";var t=n.lib,e=n.runtime,i={abs:function(t){return Math.abs(t)},batch:function(t,e,i){for(var r=[],n=[],a=0;a<t.length;a++)a%e===0&&n.length&&(r.push(n),n=[]),n.push(t[a]);if(n.length){if(i)for(var a=n.length;e>a;a++)n.push(i);r.push(n)}return r},capitalize:function(t){var i=t.toLowerCase();return e.copySafeness(t,i.charAt(0).toUpperCase()+i.slice(1))},center:function(i,r){if(r=r||80,i.length>=r)return i;var n=r-i.length,a=t.repeat(" ",n/2-n%2),s=t.repeat(" ",n/2);return e.copySafeness(i,a+i+s)},"default":function(t,e){return t?t:e},dictsort:function(e,i,r){if(!t.isObject(e))throw new t.TemplateError("dictsort filter: val must be an object");var n=[];for(var a in e)n.push([a,e[a]]);var s;if(void 0===r||"key"===r)s=0;else{if("value"!==r)throw new t.TemplateError("dictsort filter: You can only sort by either key or value");s=1}return n.sort(function(e,r){var n=e[s],a=r[s];return i||(t.isString(n)&&(n=n.toUpperCase()),t.isString(a)&&(a=a.toUpperCase())),n>a?1:n===a?0:-1}),n},escape:function(i){return"string"==typeof i||i instanceof e.SafeString?t.escape(i):i},safe:function(t){return e.markSafe(t)},first:function(t){return t[0]},groupby:function(e,i){return t.groupBy(e,i)},indent:function(i,r,n){r=r||4;for(var a="",s=i.split("\n"),o=t.repeat(" ",r),u=0;u<s.length;u++)a+=0!==u||n?o+s[u]+"\n":s[u]+"\n";return e.copySafeness(i,a)},join:function(e,i,r){return i=i||"",r&&(e=t.map(e,function(t){return t[r]})),e.join(i)},last:function(t){return t[t.length-1]},length:function(t){var i=t;return t instanceof e.SafeString&&(i=t.valueOf()),void 0!==i?i.length:0},list:function(e){if(t.isString(e))return e.split("");if(t.isObject(e)){var i=[];if(Object.keys)i=Object.keys(e);else for(var r in e)i.push(r);return t.map(i,function(t){return{key:t,value:e[t]}})}if(t.isArray(e))return e;throw new t.TemplateError("list filter: type not iterable")},lower:function(t){return t.toLowerCase()},random:function(t){return t[Math.floor(Math.random()*t.length)]},rejectattr:function(t,e){return t.filter(function(t){return!t[e]})},selectattr:function(t,e){return t.filter(function(t){return!!t[e]})},replace:function(t,i,r,n){if(i instanceof RegExp)return t.replace(i,r);var a=t,s=a,o=1;for(a=a.replace(i,r);s!==a&&!(o>=n);)s=a,a=a.replace(i,r),o++;return e.copySafeness(t,a)},reverse:function(r){var n;return n=t.isString(r)?i.list(r):t.map(r,function(t){return t}),n.reverse(),t.isString(r)?e.copySafeness(r,n.join("")):n},round:function(t,e,i){e=e||0;var r,n=Math.pow(10,e);return r="ceil"===i?Math.ceil:"floor"===i?Math.floor:Math.round,r(t*n)/n},slice:function(t,e,i){for(var r=Math.floor(t.length/e),n=t.length%e,a=0,s=[],o=0;e>o;o++){var u=a+o*r;n>o&&a++;var h=a+(o+1)*r,l=t.slice(u,h);i&&o>=n&&l.push(i),s.push(l)}return s},sort:function(e,i,r,n){return e=t.map(e,function(t){return t}),e.sort(function(e,a){var s,o;return n?(s=e[n],o=a[n]):(s=e,o=a),!r&&t.isString(s)&&t.isString(o)&&(s=s.toLowerCase(),o=o.toLowerCase()),o>s?i?1:-1:s>o?i?-1:1:0}),e},string:function(t){return e.copySafeness(t,t)},title:function(t){for(var r=t.split(" "),n=0;n<r.length;n++)r[n]=i.capitalize(r[n]);return e.copySafeness(t,r.join(" "))},trim:function(t){return e.copySafeness(t,t.replace(/^\s*|\s*$/g,""))},truncate:function(t,i,r,n){var a=t;if(i=i||255,t.length<=i)return t;if(r)t=t.substring(0,i);else{var s=t.lastIndexOf(" ",i);-1===s&&(s=i),t=t.substring(0,s)}return t+=void 0!==n&&null!==n?n:"...",e.copySafeness(a,t)},upper:function(t){return t.toUpperCase()},urlencode:function(e){var i=encodeURIComponent;if(t.isString(e))return i(e);var r;if(t.isArray(e))r=e.map(function(t){return i(t[0])+"="+i(t[1])});else{r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(i(n)+"="+i(e[n]))}return r.join("&")},urlize:function(t,e,i){isNaN(e)&&(e=1/0);var r=i===!0?' rel="nofollow"':"",n=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,a=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,s=/^https?:\/\/.*$/,o=/^www\./,u=/\.(?:org|net|com)(?:\:|\/|$)/,h=t.split(/\s+/).filter(function(t){return t&&t.length}).map(function(t){var i=t.match(n),h=i&&i[1]||t;return s.test(h)?'<a href="'+h+'"'+r+">"+h.substr(0,e)+"</a>":o.test(h)?'<a href="http://'+h+'"'+r+">"+h.substr(0,e)+"</a>":a.test(h)?'<a href="mailto:'+h+'">'+h+"</a>":u.test(h)?'<a href="http://'+h+'"'+r+">"+h.substr(0,e)+"</a>":t});return h.join(" ")},wordcount:function(t){var e=t?t.match(/\w+/g):null;return e?e.length:null},"float":function(t,e){var i=parseFloat(t);return isNaN(i)?e:i},"int":function(t,e){var i=parseInt(t,10);return isNaN(i)?e:i}};i.d=i["default"],i.e=i.escape,n.filters=i}(),function(){"use strict";function t(t){var e=-1;return{current:null,reset:function(){e=-1,this.current=null},next:function(){return e++,e>=t.length&&(e=0),this.current=t[e],this.current}}}function e(t){t=t||",";var e=!0;return function(){var i=e?"":t;return e=!1,i}}var i={range:function(t,e,i){e?i||(i=1):(e=t,t=0,i=1);for(var r=[],n=t;e>n;n+=i)r.push(n);return r},cycler:function(){return t(Array.prototype.slice.call(arguments))},joiner:function(t){return e(t)}};n.globals=i}(),function(){"use strict";var t=n.path,e=n.object,i=n.lib,r=e.extend({on:function(t,e){this.listeners=this.listeners||{},this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)},emit:function(t){var e=Array.prototype.slice.call(arguments,1);this.listeners&&this.listeners[t]&&i.each(this.listeners[t],function(t){t.apply(null,e)})},resolve:function(e,i){return t.resolve(t.dirname(e),i)},isRelative:function(t){return 0===t.indexOf("./")||0===t.indexOf("../")}});n.loader=r}(),function(){"use strict";var t=n.loader,e=t.extend({init:function(t,e){this.precompiled=window.nunjucksPrecompiled||{},this.baseURL=t||"",this.neverUpdate=e},getSource:function(t){if(this.precompiled[t])return{src:{type:"code",obj:this.precompiled[t]},path:t};var e=this.fetch(this.baseURL+"/"+t);return e?{src:e,path:t,noCache:!this.neverUpdate}:null},fetch:function(t,e){var i,r,n=!0;return window.XMLHttpRequest?i=new XMLHttpRequest:window.ActiveXObject&&(i=new ActiveXObject("Microsoft.XMLHTTP")),i.onreadystatechange=function(){4!==i.readyState||0!==i.status&&200!==i.status||!n||(n=!1,r=i.responseText)},t+=(-1===t.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),i.open("GET",t,!1),i.send(),r}});n["web-loaders"]={WebLoader:e}}(),function(){"undefined"==typeof window||window!==this?n.loaders=n["node-loaders"]:n.loaders=n["web-loaders"]}(),function(){"use strict";var t=n.path,e=n.lib,i=n.object,r=(n.lexer,n.compiler),a=n.filters,s=n.loaders,o=n.runtime,u=n.globals,h=o.Frame,l=i.extend({init:function(t,i){var i=this.opts=i||{};this.opts.dev=!!i.dev,this.opts.autoescape=!!i.autoescape,this.opts.trimBlocks=!!i.trimBlocks,this.opts.lstripBlocks=!!i.lstripBlocks,t?this.loaders=e.isArray(t)?t:[t]:s.FileSystemLoader?this.loaders=[new s.FileSystemLoader("views")]:this.loaders=[new s.WebLoader("/views")],this.initCache(),this.filters={},this.asyncFilters=[],this.extensions={},this.extensionsList=[];for(var r in a)this.addFilter(r,a[r])},initCache:function(){e.each(this.loaders,function(t){t.cache={},"function"==typeof t.on&&t.on("update",function(e){t.cache[e]=null})})},addExtension:function(t,e){e._name=t,this.extensions[t]=e,this.extensionsList.push(e)},getExtension:function(t){return this.extensions[t]},addGlobal:function(t,e){u[t]=e},addFilter:function(t,e,i){var r=e;i&&this.asyncFilters.push(t),this.filters[t]=r},getFilter:function(t){if(!this.filters[t])throw new Error("filter not found: "+t);return this.filters[t]},resolveTemplate:function(t,e,i){var r=t.isRelative&&e?t.isRelative(i):!1;return r&&t.resolve?t.resolve(e,i):i},getTemplate:function(t,i,r,n){var a=this,s=null;if(t&&t.raw&&(t=t.raw),e.isFunction(r)&&(n=r,r=null,i=i||!1),e.isFunction(i)&&(n=i,i=!1),"string"!=typeof t)throw new Error("template names must be a string: "+t);for(var o=0;o<this.loaders.length;o++){var u=this.resolveTemplate(this.loaders[o],r,t);if(s=this.loaders[o].cache[u])break}if(!s){var h;return e.asyncIter(this.loaders,function(e,i,n,s){function o(t){t?(t.loader=e,s(t)):n()}t=a.resolveTemplate(e,r,t),e.async?e.getSource(t,function(t,e){if(t)throw t;o(e)}):o(e.getSource(t))},function(e){if(e){var r=new d(e.src,this,e.path,i);e.noCache||(e.loader.cache[t]=r),n?n(null,r):h=r}else{var a=new Error("template not found: "+t);if(!n)throw a;n(a)}}.bind(this)),h}return i&&s.compile(),n?void n(null,s):s},express:function(e){function i(e,i){if(this.name=e,this.path=e,this.defaultEngine=i.defaultEngine,this.ext=t.extname(e),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}var r=this;i.prototype.render=function(t,e){r.render(this.name,t,e)},e.set("view",i)},render:function(t,i,r){e.isFunction(i)&&(r=i,i=null);var n=null;return this.getTemplate(t,function(t,e){if(t&&r)r(t);else{if(t)throw t;e.render(i,r||function(t,e){if(t)throw t;n=e})}}),n},renderString:function(t,i,r,n){e.isFunction(r)&&(n=r,r={}),r=r||{};var a=new d(t,this,r.path);return a.render(i,n)}}),c=i.extend({init:function(t,e){this.ctx=t,this.blocks={},this.exported=[];for(var i in e)this.addBlock(i,e[i])},lookup:function(t){return t in u&&!(t in this.ctx)?u[t]:this.ctx[t]},setVariable:function(t,e){this.ctx[t]=e},getVariables:function(){return this.ctx},addBlock:function(t,e){this.blocks[t]=this.blocks[t]||[],this.blocks[t].push(e)},getBlock:function(t){if(!this.blocks[t])throw new Error('unknown block "'+t+'"');return this.blocks[t][0]},getSuper:function(t,i,r,n,a,s){var o=e.indexOf(this.blocks[i]||[],r),u=this.blocks[i][o+1],h=this;if(-1===o||!u)throw new Error('no super block available for "'+i+'"');u(t,h,n,a,s)},addExport:function(t){this.exported.push(t)},getExported:function(){for(var t={},e=0;e<this.exported.length;e++){var i=this.exported[e];t[i]=this.ctx[i]}return t}}),d=i.extend({init:function(t,i,r,n){if(this.env=i||new l,e.isObject(t))switch(t.type){case"code":this.tmplProps=t.obj;break;case"string":this.tmplStr=t.obj}else{if(!e.isString(t))throw new Error("src must be a string or an object describing the source");this.tmplStr=t}this.path=r,n?e.withPrettyErrors(this.path,this.env.dev,this._compile.bind(this)):this.compiled=!1},render:function(t,i,r){return"function"==typeof t?(r=t,t={}):"function"==typeof i&&(r=i,i=null),e.withPrettyErrors(this.path,this.env.dev,function(){try{this.compile()}catch(e){if(r)return r(e);throw e}var n=new c(t||{},this.blocks),a=null;return this.rootRenderFunc(this.env,n,i||new h,o,r||function(t,e){if(t)throw t;a=e}),a}.bind(this))},getExported:function(t,e,i){"function"==typeof t&&(i=t,t={}),"function"==typeof e&&(i=e,e=null);try{this.compile()}catch(r){if(i)return i(r);throw r}var n=new c(t||{},this.blocks);this.rootRenderFunc(this.env,n,e||new h,o,function(){i(null,n.getExported())})},compile:function(){this.compiled||this._compile()},_compile:function(){var t;if(this.tmplProps)t=this.tmplProps;else{var e=r.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts),i=new Function(e);t=i()}this.blocks=this._getBlocks(t),this.rootRenderFunc=t.root,this.compiled=!0},_getBlocks:function(t){var e={};for(var i in t)"b_"===i.slice(0,2)&&(e[i.slice(2)]=t[i]);return e}});n.environment={Environment:l,Template:d}}();var a,s=n.lib,o=n.environment,u=n.compiler,h=n.parser,l=n.lexer,c=n.runtime,d=n.loader,p=n.loaders,f=n.precompile;a={},a.Environment=o.Environment,a.Template=o.Template,a.Loader=d,a.FileSystemLoader=p.FileSystemLoader,a.WebLoader=p.WebLoader,a.compiler=u,a.parser=h,a.lexer=l,a.runtime=c;var g;a.configure=function(t,e){e=e||{},s.isObject(t)&&(e=t,t=null);var i="watch"in e?!e.watch:!1,r=p.FileSystemLoader||p.WebLoader;return g=new o.Environment(new r(t,i),e),e&&e.express&&g.express(e.express),g},a.compile=function(t,e,i,r){return g||a.configure(),new a.Template(t,e,i,r)},a.render=function(t,e,i){return g||a.configure(),g.render(t,e,i)},a.renderString=function(t,e,i){return g||a.configure(),g.renderString(t,e,i)},f&&(a.precompile=f.precompile,a.precompileString=f.precompileString),a.require=function(t){return n[t]},r=function(){return a}.call(e,i,e,t),!(void 0!==r&&(t.exports=r))}()},function(t,e,i){"use strict";var r=i(219),n=i(247),a=i(248);t.exports=a.extend({model:n,url:"/i/categories",getTree:function(){var t=this.toJSON(),e=[];return r.each(t,function(t){t.children.length&&e.push({children:t.children,value:t.uid,label:t.name})}),r.each(e,function(t){var e=t.children.slice();r.each(e,function(e,i){if("string"==typeof e){var r=this.get(e).toJSON(),n={value:r.uid,label:r.name};r.children.length&&(n.children=r.children),t.children.splice(i,1,n)}}.bind(this))}.bind(this)),e}})},function(t,e,i){"use strict";var r=i(239);t.exports=r.extend({})},function(t,e,i){"use strict";var r=i(219),n=i(235),a=i(249);t.exports=n.Collection.extend({backend:a,constructor:function(){this.options=arguments[1]||{},n.Collection.apply(this,arguments)},initialize:function(){this.options.backend&&(this.backend=this.options.backend),this.backend&&(this.__proto={},r.each(this.backend,function(t,e){"function"==typeof t?(this[e]&&(this.__proto[e]=this[e]),this[e]=t.bind(this)):this[e]=t}.bind(this))),n.Collection.prototype.initialize.apply(this,arguments)},add:function(){var t=n.Collection.prototype.add.apply(this,arguments);return this.trigger("afterAdd",this.models),t},set:function(){var t=n.Collection.prototype.set.apply(this,arguments);return this.trigger("afterAdd",this.models),t},loadMore:function(t){var e=this.options.offset||0,i=this.options.count||10;return this.options.offset=e+i,this.options.maxOffset&&this.options.offset>=this.options.maxOffset?void 0:this.fetch(r.extend({},{remove:!1},t))},decorateUri:function(){},url:function(){var t=r.result(this,"domain"),e=r.result(this,"endpoint"),i=t+e,n=this.decorateUri(i);return n},sync:function(t,e,i){var r=i.success,a=i.revision;return a===!0&&(a=Date.now()),i.success=function(t){t.__skfbRevision=a,this.pendingRevision===a&&(this.revision=this.pendingRevision,this.trigger("revision",this.revision)),(void 0===a||this.revision<=a)&&r(t)}.bind(this),n.Collection.prototype.sync.call(this,t,e,i)},fetch:function(t){var e=t?t.revision:Date.now(),i=n.Collection.prototype.fetch;return(!this.pendingRevision||e>this.pendingRevision)&&(this.pendingRevision=e),this.trigger("revisionStart",e),i.apply(this,arguments)},reset:function(t,e){if(this.options.continuous){var i="function"==typeof this.parse?this.parse(t):t;return this.refresh(i,e)}return n.Collection.prototype.reset.apply(this,arguments)},refresh:function(t,e){var i;this.each(function(t){t._remove=!0}),r.each(t,function(t){i=this.get(t[this.model.prototype.idAttribute]),i?(i.set(t),delete i._remove):this.add(t)},this);var a=this.filter(function(t){return t._remove});r.each(a,function(t){this.remove(t)},this),n.Collection.prototype.reset.call(this,r.map(t,function(t){return this.get(t.uid)},this),{silent:!0}),this.trigger("refresh",e)}})},function(t,e){"use strict";t.exports={name:"internal",domain:"/i",parse:function(t){return t.results}}},function(t,e,i){"use strict";var r=i(251),n=i(248);t.exports=n.extend({model:r,url:"/i/skills"})},247,function(t,e){"use strict";t.exports=function(t,e,i){return t&&0!==t.images.length?1===t.images.length?t.images[0].url:t.images.reduce(function(t,r){var n=Math.abs(e-t.width),a=Math.abs(i-t.height),s=n+a,o=Math.abs(e-r.width),u=Math.abs(i-r.height),h=o+u;return(t.width<e||t.height<i)&&(s+=e*i),(r.width<e||r.height<i)&&(h+=e*i),h>s?t:r}).url:""}},function(t,e,i){"use strict";var r=i(245),n=new RegExp("(\\s+|')","g"),a=new RegExp("^([^\\w@]*)((?:.|\r|\n)*?)((?:[^\\w._-]|&gt;|&lt;|&amp|&quot)*)$"),s=new RegExp("^https?://"),o=new RegExp("^\\S+@[a-zA-Z0-9._-]+\\.[a-zA-Z0-9._-]+$"),u=new RegExp("(^www\\.)|(\\.(com|net|org)$)"),h=new RegExp("(@[a-zA-Z0-9._-]+)"),l=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},c=function(t,e,i,c){var d=Array.prototype.slice.call(arguments,0);if(d.length&&d[d.length-1].__keywords){var p=d.pop(),f=d[1],g=d[2],m=d[3];e=f||p.trim_url_limit,i=g||p.nofollow,c=m||p.target}null==i&&(i=!0);var v=function(t){return t=t.replace(/^(https?:\/\/)?(www\.)?/,""),null==e?t:t.length<=e?t:t.substr(0,e)+"..."};"string"==typeof t&&(t=l(t));var _=t.split(n),b=i?' rel="nofollow"':"",x=c?' target="'+c+'"':"";return r.runtime.markSafe(_.map(function(t){var e=t.match(a);if(null===e)return t;e=e.slice(1);var i=e[0],r=e[1],n=e[2];return r.match(s)?i+'<a href="'+r+'"'+b+x+">"+v(r)+"</a>"+n:r.match(o)&&-1===r.indexOf(":")?i+'<a href="mailto:'+r+'">'+r+"</a>"+n:r.match(u)?i+'<a href="http://'+r+'"'+b+x+">"+v(r)+"</a>"+n:r.match(h)?i+'<a href="https://'+window.location.host+"/"+r.substring(1)+'"'+b+x+">"+v(r)+"</a>"+n:t}).join(""))};t.exports=c},function(t,e){"use strict";var i=["a","e","i","o","u","h"],r=function(t,e){var r,n,a,s;0>t?(r="in ",n=""):(r="",n=" ago");var o=Math.abs(t);return 1!==o?(a=o.toString(),s="s"):(a=-1!==i.indexOf(e[0])?"an ":"a ",s=""),r+a+" "+e+s+n},n={1e3:function(t){return r(t,"second")},6e4:function(t){return r(t,"minute")},36e5:function(t){return r(t,"hour")},864e5:function(t){return r(t,"day")},6048e5:function(t){return r(t,"week")},24192e5:function(t){return r(t,"month")},290304e5:function(t){return r(t,"year")}};t.exports={timeAgo:function(t){var e=(new Date).getTime(),i=t.getTime(),r=e-i,a=null;Object.keys(n).forEach(function(t){t=parseInt(t),(null===a||t>a&&Math.floor(r/t)>=1)&&(a=t)});var s=Math.floor(r/a);return n[a](s)}}},,,function(t,e,i){"use strict";var r=i(224),n=i(219),a=i(258),s=i(259),o=[];t.exports=a.extend({parent:"body",events:n.extend({},a.prototype.events,{"click .popup-overlay":"close",'click [data-action="close"]':"close"}),initialize:function(){if(a.prototype.initialize.apply(this,arguments),this.options=n.defaults(this.options||{},{cleanOnClose:!0}),r(this.options.el)[0]!==r(this.el)[0]){if(!this.template)throw new Error("You cannot use this class without specifying an element during instanciation");this.setElement(n.result(this,"template"))}this.onKeyDown=this.onKeyDown.bind(this),this.lazyResize=n.debounce(this.center,50),this.resizeHandler=function(){r.each(o,function(t,e){e.lazyResize()})}.bind(this)},delegateEvents:function(){a.prototype.delegateEvents.apply(this,arguments),r(window).on("resize",this.resizeHandler),document.addEventListener("keydown",this.onKeyDown,!0)},undelegateEvents:function(){a.prototype.undelegateEvents.apply(this,arguments),r(window).off("resize",this.resizeHandler),document.removeEventListener("keydown",this.onKeyDown,!0)},open:function(t){if(-1!==o.indexOf(this))return this.$el.removeClass("hidden"),this.setElement(this.$el),this;o.unshift(this);var e=r(n.result(this,"parent"));return e.append(this.$el),this.setElement(this.$el),t?this:(this.$el.addClass("hidden"),this.center(),window.requestAnimationFrame(function(){this.$el.removeClass("hidden")}.bind(this)),this.autofocus(),this.center(),this)},onKeyDown:function(t){27===t.keyCode&&0!==o.length&&(o[0].close(),t.stopImmediatePropagation(),t.stopPropagation())},close:function(){return-1===o.indexOf(this)?this:this.$el.closest(".inline-popup").length>0?this:(-1!==o.indexOf(this)&&o.splice(o.indexOf(this),1),this.$el.addClass("hidden"),this.options.cleanOnClose&&s(this.$el,this.remove.bind(this)),this)},replaceWith:function(t){return this.close(),t.open(),t},center:function(){var t=this.$(".popup"),e=this.$(".popup-overlay"),i=r(window).width(),n=r(window).height(),a=r(document).height(),s=t.width(),o=t.height(),u=r(document).scrollTop(),h=n/2-o/2+u,l=i/2-s/2;o>n&&(h+=(o-n)/2),e.width(i),e.height(a),t.css({left:l,top:h});var c=l+s/2+"px",d=h+o/2+"px",p=c+" "+d;document.getElementsByClassName("popup-container")[0].style.perspectiveOrigin=p},resize:function(t){var e=this.$(".popup");return t.width&&e.width(t.width),t.height&&e.height(t.height),this},autofocus:function(){var t=window.scrollX,e=window.scrollY;this.$el.find(".form-input:visible").length>0?(this.$el.find(".form-input").eq(0).focus(),window.scrollTo(t,e)):(this.$el.find(".btn-primary, .submit").focus(),window.scrollTo(t,e))},remove:function(){return this.undelegateEvents(),a.prototype.remove.apply(this,arguments)}})},,function(t,e,i){"use strict";var r=i(224),n=i(219),a=n.find({WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},function(t,e){return e in document.body.style});t.exports=function(t,e){setTimeout(function(){r(t).one(a,e)})}},,function(t,e){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/layouts/popup.jinja"]=function(){function t(t,e,i,r,n){var a=null,s=null,o="";try{o+='<div class="popup-container',r.contextOrFrameLookup(e,i,"popupNeedsLoading")&&(o+=" popup-loading"),o+=" ",o+=r.suppressValue(r.contextOrFrameLookup(e,i,"popupClass"),t.opts.autoescape),o+='">\n\n    <div class="popup-overlay">\n    </div>\n\n    <form class="popup" method="post"',r.contextOrFrameLookup(e,i,"allowAutocomplete")||(o+=' autocomplete="off"'),o+=" ",r.contextOrFrameLookup(e,i,"popupAction")&&(o+='action="',o+=r.suppressValue(r.contextOrFrameLookup(e,i,"popupAction"),t.opts.autoescape),o+='"'),o+=">\n\n        ",r.contextOrFrameLookup(e,i,"allowAutocomplete")||(o+="\n            ",o+='\n            <input type="text" style="display:none" />\n            <input type="password" style="display:none" />\n        '),o+='\n\n        <input type="hidden" name="csrfmiddlewaretoken" value="',o+=r.suppressValue(r.contextOrFrameLookup(e,i,"csrf_token"),t.opts.autoescape),o+='" />\n\n        <header class="popup-header">\n\n            ',e.getBlock("popup_header")(t,e,i,r,function(a,s){return a?void n(a):(o+=s,o+='\n\n            <div class="popup-actions">\n                ',r.contextOrFrameLookup(e,i,"popupClosable")&&(o+='\n                    <a class="popup-close" data-action="close">\n                        <i class="fa fa-times"></i>\n                    </a>\n                '),o+='\n            </div>\n\n        </header>\n\n        <div class="popup-content">\n\n            <div class="popup-content-overlay">\n            </div>\n\n            ',void e.getBlock("popup_content")(t,e,i,r,function(a,s){return a?void n(a):(o+=s,o+='\n        </div>\n\n        <footer class="popup-footer">\n            ',void e.getBlock("popup_footer")(t,e,i,r,function(t,e){return t?void n(t):(o+=e,o+="\n        </footer>\n\n    </form>\n\n</div>\n",void n(null,o))}))}))})}catch(u){n(r.handleError(u,a,s))}}function e(t,e,i,r,n){var a=null,s=null,o="";try{o+='\n                <div class="popup-title">\n                    ',o+=r.suppressValue(r.contextOrFrameLookup(e,i,"popupTitle"),t.opts.autoescape),o+="\n                </div>\n            ",n(null,o)}catch(u){n(r.handleError(u,a,s))}}function i(t,e,i,r,n){var a=null,s=null,o="";try{o+="\n            ",n(null,o)}catch(u){n(r.handleError(u,a,s))}}function r(t,e,i,r,n){var a=null,s=null,o="";try{o+="\n            ",n(null,o)}catch(u){n(r.handleError(u,a,s))}}return{b_popup_header:e,b_popup_content:i,b_popup_footer:r,root:t}}()}()},,,,,,function(t,e,i){"use strict";var r=i(224),n=i(219),a=i(242),s=i(257);i(268),t.exports=s.extend({template:function(){return a.get("skfb_front/popups/message",{title:this.options.title,text:this.options.text,buttons:this.options.buttons,safe:this.options.safe,popupClass:this.options.popupClass})},events:n.extend({},s.prototype.events,{"reset form":"cancel","submit form":"continue"}),initialize:function(){s.prototype.initialize.apply(this,arguments),this.deferred=r.Deferred(),this.promise=this.deferred.promise()},"continue":function(){this.deferred.resolve()},cancel:function(){this.deferred.reject()},then:function(){return this.promise.then.apply(this,arguments)}})},function(t,e,i){i(261),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/popups/message.jinja"]=function(){function t(t,e,i,r,n){var a=null,s=null,o="";try{t.getTemplate("skfb_front/layouts/popup.jinja",!0,"skfb_front/popups/message.jinja",function(a,s){if(a)return void n(a);for(var u in s.blocks)e.addBlock(u,s.blocks[u]);o+="\n\n";var h;if(h=r.contextOrFrameLookup(e,i,"title"),i.set("popupTitle",h,!0),i.parent||(e.setVariable("popupTitle",h),e.addExport("popupTitle")),o+="\n\n",!r.contextOrFrameLookup(e,i,"popupClass")){o+="\n    ";var l;l="popup-message",i.set("popupClass",l,!0),i.parent||(e.setVariable("popupClass",l),e.addExport("popupClass")),o+="\n"}o+="\n\n",o+="\n\n",o+="\n",s.rootRenderFunc(t,e,i,r,n)})}catch(u){n(r.handleError(u,a,s))}}function e(t,e,i,r,n){var a=null,s=null,o="";try{o+="\n\n    ",r.contextOrFrameLookup(e,i,"safe")?(o+="\n        ",o+=r.suppressValue(t.getFilter("safe").call(e,r.contextOrFrameLookup(e,i,"text")),t.opts.autoescape),o+="\n    "):(o+="\n        ",o+=r.suppressValue(r.contextOrFrameLookup(e,i,"text"),t.opts.autoescape),o+="\n    "),o+="\n\n",n(null,o)}catch(u){n(r.handleError(u,a,s))}}function i(t,e,i,r,n){var a=null,s=null,o="";try{o+='\n    <div class="actions">\n\n        ',o+="\n        ",o+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"cancel",t.opts.autoescape)&&(o+='\n            <button class="button btn-medium btn-tertiary cancel',r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"cancelClass",t.opts.autoescape)&&(o+=" ",o+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"cancelClass",t.opts.autoescape),t.opts.autoescape)),o+='" type="reset">',o+=r.suppressValue(t.getFilter("default").call(e,r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"cancelLabel",t.opts.autoescape),"Cancel"),t.opts.autoescape),
o+="</button>\n        "),o+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"continue",t.opts.autoescape)&&(o+='\n            <button class="button btn-medium btn-primary submit',r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"continueClass",t.opts.autoescape)&&(o+=" ",o+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"continueClass",t.opts.autoescape),t.opts.autoescape)),o+='" type="submit">',o+=r.suppressValue(t.getFilter("default").call(e,r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"continueLabel",t.opts.autoescape),"Continue"),t.opts.autoescape),o+="</button>\n        "),o+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"ok",t.opts.autoescape)&&(o+='\n            <button class="button btn-medium btn-primary submit',r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"okClass",t.opts.autoescape)&&(o+=" ",o+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"okClass",t.opts.autoescape),t.opts.autoescape)),o+='" type="submit">',o+=r.suppressValue(t.getFilter("default").call(e,r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"okLabel",t.opts.autoescape),"OK"),t.opts.autoescape),o+="</button>\n        "),o+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"delete",t.opts.autoescape)&&(o+='\n            <button class="button btn-medium btn-danger submit',r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"deleteClass",t.opts.autoescape)&&(o+=" ",o+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"deleteClass",t.opts.autoescape),t.opts.autoescape)),o+='" type="submit">',o+=r.suppressValue(t.getFilter("default").call(e,r.memberLookup(r.contextOrFrameLookup(e,i,"buttons"),"deleteLabel",t.opts.autoescape),"Delete"),t.opts.autoescape),o+="</button>\n        "),o+="\n\n    </div>\n",n(null,o)}catch(u){n(r.handleError(u,a,s))}}return{b_popup_content:e,b_popup_footer:i,root:t}}()}()},,,,,,,function(t,e){/*! jQuery UI - v1.10.4 - 2014-04-02
	* http://jqueryui.com
	* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.accordion.js, jquery.ui.autocomplete.js, jquery.ui.button.js, jquery.ui.datepicker.js, jquery.ui.dialog.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.effect.js, jquery.ui.effect-blind.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-explode.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-pulsate.js, jquery.ui.effect-scale.js, jquery.ui.effect-shake.js, jquery.ui.effect-slide.js, jquery.ui.effect-transfer.js, jquery.ui.menu.js, jquery.ui.progressbar.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.slider.js, jquery.ui.sortable.js, jquery.ui.spinner.js, jquery.ui.tabs.js, jquery.ui.tooltip.js
	* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */
!function(t,e){function i(e,i){var n,a,s,o=e.nodeName.toLowerCase();return"area"===o?(n=e.parentNode,a=n.name,e.href&&a&&"map"===n.nodeName.toLowerCase()?(s=t("img[usemap=#"+a+"]")[0],!!s&&r(s)):!1):(/input|select|textarea|button|object/.test(o)?!e.disabled:"a"===o?e.href||i:i)&&r(e)}function r(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var n=0,a=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(i,r){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),r&&r.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length)for(var r,n,a=t(this[0]);a.length&&a[0]!==document;){if(r=a.css("position"),("absolute"===r||"relative"===r||"fixed"===r)&&(n=parseInt(a.css("zIndex"),10),!isNaN(n)&&0!==n))return n;a=a.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){a.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,r){return!!t.data(e,r[3])},focusable:function(e){return i(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var r=t.attr(e,"tabindex"),n=isNaN(r);return(n||r>=0)&&i(e,!n)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(i,r){function n(e,i,r,n){return t.each(a,function(){i-=parseFloat(t.css(e,"padding"+this))||0,r&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),n&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var a="Width"===r?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+r]=function(i){return i===e?o["inner"+r].call(this):this.each(function(){t(this).css(s,n(this,i)+"px")})},t.fn["outer"+r]=function(e,i){return"number"!=typeof e?o["outer"+r].call(this,e):this.each(function(){t(this).css(s,n(this,e,!0,i)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,i,r){var n,a=t.ui[e].prototype;for(n in r)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,r[n]])},call:function(t,e,i){var r,n=t.plugins[e];if(n&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(r=0;r<n.length;r++)t.options[n[r][0]]&&n[r][1].apply(t.element,i)}},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var r=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[r]>0?!0:(e[r]=1,n=e[r]>0,e[r]=0,n)}})}(jQuery),function(t,e){var i=0,r=Array.prototype.slice,n=t.cleanData;t.cleanData=function(e){for(var i,r=0;null!=(i=e[r]);r++)try{t(i).triggerHandler("remove")}catch(a){}n(e)},t.widget=function(e,i,r){var n,a,s,o,u={},h=e.split(".")[0];e=e.split(".")[1],n=h+"-"+e,r||(r=i,i=t.Widget),t.expr[":"][n.toLowerCase()]=function(e){return!!t.data(e,n)},t[h]=t[h]||{},a=t[h][e],s=t[h][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new s(t,e)},t.extend(s,a,{version:r.version,_proto:t.extend({},r),_childConstructors:[]}),o=new i,o.options=t.widget.extend({},o.options),t.each(r,function(e,r){return t.isFunction(r)?void(u[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},n=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,a=this._superApply;return this._super=t,this._superApply=n,e=r.apply(this,arguments),this._super=i,this._superApply=a,e}}()):void(u[e]=r)}),s.prototype=t.widget.extend(o,{widgetEventPrefix:a?o.widgetEventPrefix||e:e},u,{constructor:s,namespace:h,widgetName:e,widgetFullName:n}),a?(t.each(a._childConstructors,function(e,i){var r=i.prototype;t.widget(r.namespace+"."+r.widgetName,s,i._proto)}),delete a._childConstructors):i._childConstructors.push(s),t.widget.bridge(e,s)},t.widget.extend=function(i){for(var n,a,s=r.call(arguments,1),o=0,u=s.length;u>o;o++)for(n in s[o])a=s[o][n],s[o].hasOwnProperty(n)&&a!==e&&(t.isPlainObject(a)?i[n]=t.isPlainObject(i[n])?t.widget.extend({},i[n],a):t.widget.extend({},a):i[n]=a);return i},t.widget.bridge=function(i,n){var a=n.prototype.widgetFullName||i;t.fn[i]=function(s){var o="string"==typeof s,u=r.call(arguments,1),h=this;return s=!o&&u.length?t.widget.extend.apply(null,[s].concat(u)):s,o?this.each(function(){var r,n=t.data(this,a);return n?t.isFunction(n[s])&&"_"!==s.charAt(0)?(r=n[s].apply(n,u),r!==n&&r!==e?(h=r&&r.jquery?h.pushStack(r.get()):r,!1):void 0):t.error("no such method '"+s+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+s+"'")}):this.each(function(){var e=t.data(this,a);e?e.option(s||{})._init():t.data(this,a,new n(s,this))}),h}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,r){r=t(r||this.defaultElement||this)[0],this.element=t(r),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),r!==this&&(t.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===r&&this.destroy()}}),this.document=t(r.style?r.ownerDocument:r.document||r),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,r){var n,a,s,o=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(o={},n=i.split("."),i=n.shift(),n.length){for(a=o[i]=t.widget.extend({},this.options[i]),s=0;s<n.length-1;s++)a[n[s]]=a[n[s]]||{},a=a[n[s]];if(i=n.pop(),1===arguments.length)return a[i]===e?null:a[i];a[i]=r}else{if(1===arguments.length)return this.options[i]===e?null:this.options[i];o[i]=r}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,i,r){var n,a=this;"boolean"!=typeof e&&(r=i,i=e,e=!1),r?(i=n=t(i),this.bindings=this.bindings.add(i)):(r=i,i=this.element,n=this.widget()),t.each(r,function(r,s){function o(){return e||a.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof s?a[s]:s).apply(a,arguments):void 0}"string"!=typeof s&&(o.guid=s.guid=s.guid||o.guid||t.guid++);var u=r.match(/^(\w+)\s*(.*)$/),h=u[1]+a.eventNamespace,l=u[2];l?n.delegate(l,h,o):i.bind(h,o)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?r[t]:t).apply(r,arguments)}var r=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,r){var n,a,s=this.options[e];if(r=r||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,r),!(t.isFunction(s)&&s.apply(this.element[0],[i].concat(r))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(r,n,a){"string"==typeof n&&(n={effect:n});var s,o=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),s=!t.isEmptyObject(n),n.complete=a,n.delay&&r.delay(n.delay),s&&t.effects&&t.effects.effect[o]?r[e](n):o!==e&&r[o]?r[o](n.duration,n.easing,a):r.queue(function(i){t(this)[e](),a&&a.call(r[0]),i()})}})}(jQuery),function(t,e){var i=!1;t(document).mouseup(function(){i=!1}),t.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!i){this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var r=this,n=1===e.which,a="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return n&&!a&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return r._mouseMove(t)},this._mouseUpDelegate=function(t){return r._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),i=!0,!0)):!0}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t,e){function i(t,e,i){return[parseFloat(t[0])*(p.test(t[0])?e/100:1),parseFloat(t[1])*(p.test(t[1])?i/100:1)]}function r(e,i){return parseInt(t.css(e,i),10)||0}function n(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var a,s=Math.max,o=Math.abs,u=Math.round,h=/left|center|right/,l=/top|center|bottom/,c=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,p=/%$/,f=t.fn.position;t.position={scrollbarWidth:function(){if(a!==e)return a;var i,r,n=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=n.children()[0];return t("body").append(n),i=s.offsetWidth,n.css("overflow","scroll"),r=s.offsetWidth,i===r&&(r=n[0].clientWidth),n.remove(),a=i-r},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),r=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,a="scroll"===r||"auto"===r&&e.height<e.element[0].scrollHeight;return{width:a?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),r=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:r,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:r?i.width():i.outerWidth(),height:r?i.height():i.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return f.apply(this,arguments);e=t.extend({},e);var a,p,g,m,v,_,b=t(e.of),x=t.position.getWithinInfo(e.within),A=t.position.getScrollInfo(x),y=(e.collision||"flip").split(" "),S={};return _=n(b),b[0].preventDefault&&(e.at="left top"),p=_.width,g=_.height,m=_.offset,v=t.extend({},m),t.each(["my","at"],function(){var t,i,r=(e[this]||"").split(" ");1===r.length&&(r=h.test(r[0])?r.concat(["center"]):l.test(r[0])?["center"].concat(r):["center","center"]),r[0]=h.test(r[0])?r[0]:"center",r[1]=l.test(r[1])?r[1]:"center",t=c.exec(r[0]),i=c.exec(r[1]),S[this]=[t?t[0]:0,i?i[0]:0],e[this]=[d.exec(r[0])[0],d.exec(r[1])[0]]}),1===y.length&&(y[1]=y[0]),"right"===e.at[0]?v.left+=p:"center"===e.at[0]&&(v.left+=p/2),"bottom"===e.at[1]?v.top+=g:"center"===e.at[1]&&(v.top+=g/2),a=i(S.at,p,g),v.left+=a[0],v.top+=a[1],this.each(function(){var n,h,l=t(this),c=l.outerWidth(),d=l.outerHeight(),f=r(this,"marginLeft"),_=r(this,"marginTop"),C=c+f+r(this,"marginRight")+A.width,w=d+_+r(this,"marginBottom")+A.height,T=t.extend({},v),M=i(S.my,l.outerWidth(),l.outerHeight());"right"===e.my[0]?T.left-=c:"center"===e.my[0]&&(T.left-=c/2),"bottom"===e.my[1]?T.top-=d:"center"===e.my[1]&&(T.top-=d/2),T.left+=M[0],T.top+=M[1],t.support.offsetFractions||(T.left=u(T.left),T.top=u(T.top)),n={marginLeft:f,marginTop:_},t.each(["left","top"],function(i,r){t.ui.position[y[i]]&&t.ui.position[y[i]][r](T,{targetWidth:p,targetHeight:g,elemWidth:c,elemHeight:d,collisionPosition:n,collisionWidth:C,collisionHeight:w,offset:[a[0]+M[0],a[1]+M[1]],my:e.my,at:e.at,within:x,elem:l})}),e.using&&(h=function(t){var i=m.left-T.left,r=i+p-c,n=m.top-T.top,a=n+g-d,u={target:{element:b,left:m.left,top:m.top,width:p,height:g},element:{element:l,left:T.left,top:T.top,width:c,height:d},horizontal:0>r?"left":i>0?"right":"center",vertical:0>a?"top":n>0?"bottom":"middle"};c>p&&o(i+r)<p&&(u.horizontal="center"),d>g&&o(n+a)<g&&(u.vertical="middle"),s(o(i),o(r))>s(o(n),o(a))?u.important="horizontal":u.important="vertical",e.using.call(this,t,u)}),l.offset(t.extend(T,{using:h}))})},t.ui.position={fit:{left:function(t,e){var i,r=e.within,n=r.isWindow?r.scrollLeft:r.offset.left,a=r.width,o=t.left-e.collisionPosition.marginLeft,u=n-o,h=o+e.collisionWidth-a-n;e.collisionWidth>a?u>0&&0>=h?(i=t.left+u+e.collisionWidth-a-n,t.left+=u-i):h>0&&0>=u?t.left=n:u>h?t.left=n+a-e.collisionWidth:t.left=n:u>0?t.left+=u:h>0?t.left-=h:t.left=s(t.left-o,t.left)},top:function(t,e){var i,r=e.within,n=r.isWindow?r.scrollTop:r.offset.top,a=e.within.height,o=t.top-e.collisionPosition.marginTop,u=n-o,h=o+e.collisionHeight-a-n;e.collisionHeight>a?u>0&&0>=h?(i=t.top+u+e.collisionHeight-a-n,t.top+=u-i):h>0&&0>=u?t.top=n:u>h?t.top=n+a-e.collisionHeight:t.top=n:u>0?t.top+=u:h>0?t.top-=h:t.top=s(t.top-o,t.top)}},flip:{left:function(t,e){var i,r,n=e.within,a=n.offset.left+n.scrollLeft,s=n.width,u=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,l=h-u,c=h+e.collisionWidth-s-u,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>l?(i=t.left+d+p+f+e.collisionWidth-s-a,(0>i||i<o(l))&&(t.left+=d+p+f)):c>0&&(r=t.left-e.collisionPosition.marginLeft+d+p+f-u,(r>0||o(r)<c)&&(t.left+=d+p+f))},top:function(t,e){var i,r,n=e.within,a=n.offset.top+n.scrollTop,s=n.height,u=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,l=h-u,c=h+e.collisionHeight-s-u,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>l?(r=t.top+p+f+g+e.collisionHeight-s-a,t.top+p+f+g>l&&(0>r||r<o(l))&&(t.top+=p+f+g)):c>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-u,t.top+p+f+g>c&&(i>0||o(i)<c)&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,r,n,a,s=document.getElementsByTagName("body")[0],o=document.createElement("div");e=document.createElement(s?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&t.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(a in r)e.style[a]=r[a];e.appendChild(o),i=s||document.documentElement,i.insertBefore(e,i.firstChild),o.style.cssText="position: absolute; left: 10.7432222px;",n=t(o).offset().left,t.support.offsetFractions=n>10&&11>n,e.innerHTML="",i.removeChild(e)}()}(jQuery),function(t,e){var i=0,r={},n={};r.height=r.paddingTop=r.paddingBottom=r.borderTopWidth=r.borderBottomWidth="hide",n.height=n.paddingTop=n.paddingBottom=n.borderTopWidth=n.borderBottomWidth="show",t.widget("ui.accordion",{version:"1.10.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),e.active<0&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t(),content:this.active.length?this.active.next():t()}},_createIcons:function(){var e=this.options.icons;e&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void("disabled"===t&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!e)))},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,r=this.headers.length,n=this.headers.index(e.target),a=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(n+1)%r];break;case i.LEFT:case i.UP:a=this.headers[(n-1+r)%r];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[r-1]}a&&(t(e.target).attr("tabIndex",-1),t(a).attr("tabIndex",0),a.focus(),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().focus()},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var e,r=this.options,n=r.heightStyle,a=this.element.parent(),s=this.accordionId="ui-accordion-"+(this.element.attr("id")||++i);this.active=this._findActive(r.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(e){var i=t(this),r=i.attr("id"),n=i.next(),a=n.attr("id");r||(r=s+"-header-"+e,i.attr("id",r)),a||(a=s+"-panel-"+e,n.attr("id",a)),i.attr("aria-controls",a),n.attr("aria-labelledby",r)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(r.event),"fill"===n?(e=a.height(),this.element.siblings(":visible").each(function(){var i=t(this),r=i.css("position");"absolute"!==r&&"fixed"!==r&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===n&&(e=0,this.headers.next().each(function(){e=Math.max(e,t(this).css("height","").height())}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i=this.options,r=this.active,n=t(e.currentTarget),a=n[0]===r[0],s=a&&i.collapsible,o=s?t():n.next(),u=r.next(),h={oldHeader:r,oldPanel:u,newHeader:s?t():n,newPanel:o};e.preventDefault(),a&&!i.collapsible||this._trigger("beforeActivate",e,h)===!1||(i.active=s?!1:this.headers.index(n),this.active=a?t():n,this._toggle(h),r.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&r.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,r=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=r,this.options.animate?this._animate(i,r,e):(r.hide(),i.show(),this._toggleComplete(e)),r.attr({"aria-hidden":"true"}),r.prev().attr("aria-selected","false"),i.length&&r.length?r.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(t,e,i){var a,s,o,u=this,h=0,l=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},d=l&&c.down||c,p=function(){u._toggleComplete(i)};return"number"==typeof d&&(o=d),"string"==typeof d&&(s=d),s=s||d.easing||c.easing,o=o||d.duration||c.duration,e.length?t.length?(a=t.show().outerHeight(),e.animate(r,{duration:o,easing:s,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(n,{duration:o,easing:s,complete:p,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?h+=i.now:"content"!==u.options.heightStyle&&(i.now=Math.round(a-e.outerHeight()-h),h=0)}})):e.animate(r,o,s,p):t.animate(n,o,s,p)},_toggleComplete:function(t){var e=t.oldPanel;e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}})}(jQuery),function(t,e){t.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,r,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,s="input"===n;this.isMultiLine=a?!0:s?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||s?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,r=!0,void(i=!0);e=!1,r=!1,i=!1;var a=t.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:e=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case a.UP:e=!0,this._keyEvent("previous",n);break;case a.DOWN:e=!0,this._keyEvent("next",n);break;case a.ENTER:case a.NUMPAD_ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(r){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&r.preventDefault());if(!i){var n=t.ui.keyCode;switch(r.keyCode){case n.PAGE_UP:this._move("previousPage",r);break;case n.PAGE_DOWN:this._move("nextPage",r);break;case n.UP:this._keyEvent("previous",r);break;case n.DOWN:this._keyEvent("next",r)}}},input:function(t){return r?(r=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];t(e.target).closest(".ui-menu-item").length||this._delay(function(){var e=this;this.document.one("mousedown",function(r){r.target===e.element[0]||r.target===i||t.contains(i,r.target)||e.close()})})},menufocus:function(e,i){if(this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)});var r=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",e,{item:r})?e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(r.value):this.liveRegion.text(r.value)},menuselect:function(t,e){var i=e.item.data("ui-autocomplete-item"),r=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r,this.selectedItem=i})),!1!==this._trigger("select",t,{item:i})&&this._value(i.value),this.term=this._value(),this.close(t),this.selectedItem=i}}),this.liveRegion=t("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,r=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,r){r(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){r.xhr&&r.xhr.abort(),r.xhr=t.ajax({
url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var r=this;t.each(i,function(t,i){r._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<a>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var r=new RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return r.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var e;this._superApply(arguments),this.options.disabled||this.cancelSearch||(e=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.text(e))}})}(jQuery),function(t,e){var i,r="ui-button ui-widget ui-state-default ui-corner-all",n="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",a=function(){var e=t(this);setTimeout(function(){e.find(":ui-button").button("refresh")},1)},s=function(e){var i=e.name,r=e.form,n=t([]);return i&&(i=i.replace(/'/g,"\\'"),n=r?t(r).find("[name='"+i+"']"):t("[name='"+i+"']",e.ownerDocument).filter(function(){return!this.form})),n};t.widget("ui.button",{version:"1.10.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,a),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var e=this,n=this.options,o="checkbox"===this.type||"radio"===this.type,u=o?"":"ui-state-active";null===n.label&&(n.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(r).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){n.disabled||this===i&&t(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){n.disabled||t(this).removeClass(u)}).bind("click"+this.eventNamespace,function(t){n.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),o&&this.element.bind("change"+this.eventNamespace,function(){e.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return n.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(n.disabled)return!1;t(this).addClass("ui-state-active"),e.buttonElement.attr("aria-pressed","true");var i=e.element[0];s(i).not(i).map(function(){return t(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return n.disabled?!1:(t(this).addClass("ui-state-active"),i=this,void e.document.one("mouseup",function(){i=null}))}).bind("mouseup"+this.eventNamespace,function(){return n.disabled?!1:void t(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(e){return n.disabled?!1:void((e.keyCode===t.ui.keyCode.SPACE||e.keyCode===t.ui.keyCode.ENTER)&&t(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){t(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===t.ui.keyCode.SPACE&&t(this).click()})),this._setOption("disabled",n.disabled),this._resetButton()},_determineButtonType:function(){var t,e,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(t=this.element.parents().last(),e="label[for='"+this.element.attr("id")+"']",this.buttonElement=t.find(e),this.buttonElement.length||(t=t.length?t.siblings():this.element.siblings(),this.buttonElement=t.filter(e),this.buttonElement.length||(this.buttonElement=t.find(e))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(r+" ui-state-active "+n).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(t,e){return this._super(t,e),"disabled"===t?(this.element.prop("disabled",!!e),void(e&&this.buttonElement.removeClass("ui-state-focus"))):void this._resetButton()},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?s(this.element[0]).each(function(){t(this).is(":checked")?t(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var e=this.buttonElement.removeClass(n),i=t("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),r=this.options.icons,a=r.primary&&r.secondary,s=[];r.primary||r.secondary?(this.options.text&&s.push("ui-button-text-icon"+(a?"s":r.primary?"-primary":"-secondary")),r.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(s.push(a?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",t.trim(i)))):s.push("ui-button-text-only"),e.addClass(s.join(" "))}}),t.widget("ui.buttonset",{version:"1.10.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,e){"disabled"===t&&this.buttons.button("option",t,e),this._super(t,e)},refresh:function(){var e="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(t,e){function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.dpDiv=r(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function r(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(i,"mouseout",function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",function(){t.datepicker._isDisabledDatepicker(a.inline?e.parent()[0]:a.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))})}function n(e,i){t.extend(e,i);for(var r in i)null==i[r]&&(e[r]=i[r]);return e}t.extend(t.ui,{datepicker:{version:"1.10.4"}});var a,s="datepicker";t.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return n(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var r,n,a;r=e.nodeName.toLowerCase(),n="div"===r||"span"===r,e.id||(this.uuid+=1,e.id="dp"+this.uuid),a=this._newInst(t(e),n),a.settings=t.extend({},i||{}),"input"===r?this._connectDatepicker(e,a):n&&this._inlineDatepicker(e,a)},_newInst:function(e,i){var n=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?r(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var r=t(e);i.append=t([]),i.trigger=t([]),r.hasClass(this.markerClassName)||(this._attachments(r,i),r.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),t.data(e,s,i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var r,n,a,s=this._get(i,"appendText"),o=this._get(i,"isRTL");i.append&&i.append.remove(),s&&(i.append=t("<span class='"+this._appendClass+"'>"+s+"</span>"),e[o?"before":"after"](i.append)),e.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),r=this._get(i,"showOn"),("focus"===r||"both"===r)&&e.focus(this._showDatepicker),("button"===r||"both"===r)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(a?t("<img/>").attr({src:a,alt:n,title:n}):n)),e[o?"before":"after"](i.trigger),i.trigger.click(function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,r,n,a=new Date(2009,11,20),s=this._get(t,"dateFormat");s.match(/[DM]/)&&(e=function(t){for(i=0,r=0,n=0;n<t.length;n++)t[n].length>i&&(i=t[n].length,r=n);return r},a.setMonth(e(this._get(t,s.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(e(this._get(t,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),t.input.attr("size",this._formatDate(t,a).length)}},_inlineDatepicker:function(e,i){var r=t(e);r.hasClass(this.markerClassName)||(r.addClass(this.markerClassName).append(i.dpDiv),t.data(e,s,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,r,a,o){var u,h,l,c,d,p=this._dialogInst;return p||(this.uuid+=1,u="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+u+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},t.data(this._dialogInput[0],s,p)),n(p.settings,a||{}),i=i&&i.constructor===Date?this._formatDate(p,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+c,l/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=r,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],s,p),this},_destroyDatepicker:function(e){var i,r=t(e),n=t.data(e,s);r.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,s),"input"===i?(n.append.remove(),n.trigger.remove(),r.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&r.removeClass(this.markerClassName).empty())},_enableDatepicker:function(e){var i,r,n=t(e),a=t.data(e,s);n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(r=n.children("."+this._inlineClass),r.children().removeClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,r,n=t(e),a=t.data(e,s);n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(r=n.children("."+this._inlineClass),r.children().addClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;e<this._disabledInputs.length;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,s)}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(i,r,a){var s,o,u,h,l=this._getInst(i);return 2===arguments.length&&"string"==typeof r?"defaults"===r?t.extend({},t.datepicker._defaults):l?"all"===r?t.extend({},l.settings):this._get(l,r):null:(s=r||{},"string"==typeof r&&(s={},s[r]=a),void(l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(i,!0),u=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),n(l.settings,s),null!==u&&s.dateFormat!==e&&s.minDate===e&&(l.settings.minDate=this._formatDate(l,u)),null!==h&&s.dateFormat!==e&&s.maxDate===e&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in s&&(s.disabled?this._disableDatepicker(i):this._enableDatepicker(i)),this._attachments(t(i),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l))))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,r,n,a=t.datepicker._getInst(e.target),s=!0,o=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),s=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",a.dpDiv),n[0]&&t.datepicker._selectDay(e.target,a.selectedMonth,a.selectedYear,n[0]),i=t.datepicker._get(a,"onSelect"),i?(r=t.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[r,a])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(a,"stepBigMonths"):-t.datepicker._get(a,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(a,"stepBigMonths"):+t.datepicker._get(a,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),s=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),s=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,o?1:-1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(a,"stepBigMonths"):-t.datepicker._get(a,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),s=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,o?-1:1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(a,"stepBigMonths"):+t.datepicker._get(a,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),s=e.ctrlKey||e.metaKey;break;default:s=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):s=!1;s&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,r,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),r=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">r||!i||i.indexOf(r)>-1):void 0},_doKeyUp:function(e){var i,r=t.datepicker._getInst(e.target);if(r.input.val()!==r.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(r,"dateFormat"),r.input?r.input.val():null,t.datepicker._getFormatConfig(r)),i&&(t.datepicker._setDateFromField(r),t.datepicker._updateAlternate(r),t.datepicker._updateDatepicker(r))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var i,r,a,s,o,u,h;i=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==i&&(t.datepicker._curInst.dpDiv.stop(!0,!0),i&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),r=t.datepicker._get(i,"beforeShow"),a=r?r.apply(e,[e,i]):{},a!==!1&&(n(i.settings,a),i.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(i),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),s=!1,t(e).parents().each(function(){return s|="fixed"===t(this).css("position"),!s}),o={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(i),o=t.datepicker._checkOffset(i,o,s),i.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":s?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),i.inline||(u=t.datepicker._get(i,"showAnim"),h=t.datepicker._get(i,"duration"),i.dpDiv.zIndex(t(e).zIndex()+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[u]?i.dpDiv.show(u,t.datepicker._get(i,"showOptions"),h):i.dpDiv[u||"show"](u?h:null),t.datepicker._shouldFocusInput(i)&&i.input.focus(),t.datepicker._curInst=i))}},_updateDatepicker:function(e){this.maxRows=4,a=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i,r=this._getNumberOfMonths(e),n=r[1],s=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",s*n+"em"),e.dpDiv[(1!==r[0]||1!==r[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,r){var n=e.dpDiv.outerWidth(),a=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,u=document.documentElement.clientWidth+(r?0:t(document).scrollLeft()),h=document.documentElement.clientHeight+(r?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-s:0,i.left-=r&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=r&&i.top===e.input.offset().top+o?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>u&&u>n?Math.abs(i.left+n-u):0),i.top-=Math.min(i.top,i.top+a>h&&h>a?Math.abs(a+o):0),i},_findPos:function(e){for(var i,r=this._getInst(e),n=this._get(r,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,r,n,a,o=this._curInst;!o||e&&o!==t.data(e,s)||this._datepickerShowing&&(i=this._get(o,"showAnim"),r=this._get(o,"duration"),n=function(){t.datepicker._tidyDialog(o)},t.effects&&(t.effects.effect[i]||t.effects[i])?o.dpDiv.hide(i,t.datepicker._get(o,"showOptions"),r,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?r:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),r=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==r)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,r){var n=t(e),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===r?this._get(a,"showCurrentAtPos"):0),r),this._updateDatepicker(a))},_gotoToday:function(e){var i,r=t(e),n=this._getInst(r[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(r)},_selectMonthYear:function(e,i,r){var n=t(e),a=this._getInst(n[0]);a["selected"+("M"===r?"Month":"Year")]=a["draw"+("M"===r?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(e,i,r,n){var a,s=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||(a=this._getInst(s[0]),a.selectedDay=a.currentDay=t("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=r,this._selectDate(e,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var r,n=t(e),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),r=this._get(a,"onSelect"),r?r.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var i,r,n,a=this._get(e,"altField");a&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),r=this._getDate(e),n=this.formatDate(i,r,this._getFormatConfig(e)),t(a).each(function(){t(this).val(n)}))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,r){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?i.toString():i+"",""===i)return null;var n,a,s,o,u=0,h=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,l="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),c=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,d=(r?r.dayNames:null)||this._defaults.dayNames,p=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,f=(r?r.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,v=-1,_=-1,b=!1,x=function(t){var i=n+1<e.length&&e.charAt(n+1)===t;return i&&n++,i},A=function(t){var e=x(t),r="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n=new RegExp("^\\d{1,"+r+"}"),a=i.substring(u).match(n);if(!a)throw"Missing number at position "+u;return u+=a[0].length,parseInt(a[0],10)},y=function(e,r,n){var a=-1,s=t.map(x(e)?n:r,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(s,function(t,e){var r=e[1];return i.substr(u,r.length).toLowerCase()===r.toLowerCase()?(a=e[0],u+=r.length,!1):void 0}),-1!==a)return a+1;throw"Unknown name at position "+u},S=function(){if(i.charAt(u)!==e.charAt(n))throw"Unexpected literal at position "+u;u++};for(n=0;n<e.length;n++)if(b)"'"!==e.charAt(n)||x("'")?S():b=!1;else switch(e.charAt(n)){case"d":v=A("d");break;case"D":y("D",c,d);break;case"o":_=A("o");break;case"m":m=A("m");break;case"M":m=y("M",p,f);break;case"y":g=A("y");break;case"@":o=new Date(A("@")),g=o.getFullYear(),m=o.getMonth()+1,v=o.getDate();break;case"!":o=new Date((A("!")-this._ticksTo1970)/1e4),g=o.getFullYear(),m=o.getMonth()+1,v=o.getDate();break;case"'":x("'")?S():b=!0;break;default:S()}if(u<i.length&&(s=i.substr(u),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(l>=g?0:-100)),_>-1)for(m=1,v=_;;){if(a=this._getDaysInMonth(g,m-1),a>=v)break;m++,v-=a}if(o=this._daylightSavingAdjust(new Date(g,m-1,v)),o.getFullYear()!==g||o.getMonth()+1!==m||o.getDate()!==v)throw"Invalid date";return o},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(t,e,i){if(!e)return"";var r,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,o=(i?i.monthNames:null)||this._defaults.monthNames,u=function(e){var i=r+1<t.length&&t.charAt(r+1)===e;return i&&r++,i},h=function(t,e,i){var r=""+e;if(u(t))for(;r.length<i;)r="0"+r;return r},l=function(t,e,i,r){return u(t)?r[e]:i[e]},c="",d=!1;if(e)for(r=0;r<t.length;r++)if(d)"'"!==t.charAt(r)||u("'")?c+=t.charAt(r):d=!1;else switch(t.charAt(r)){case"d":c+=h("d",e.getDate(),2);break;case"D":c+=l("D",e.getDay(),n,a);
break;case"o":c+=h("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=h("m",e.getMonth()+1,2);break;case"M":c+=l("M",e.getMonth(),s,o);break;case"y":c+=u("y")?e.getFullYear():(e.getYear()%100<10?"0":"")+e.getYear()%100;break;case"@":c+=e.getTime();break;case"!":c+=1e4*e.getTime()+this._ticksTo1970;break;case"'":u("'")?c+="'":d=!0;break;default:c+=t.charAt(r)}return c},_possibleChars:function(t){var e,i="",r=!1,n=function(i){var r=e+1<t.length&&t.charAt(e+1)===i;return r&&e++,r};for(e=0;e<t.length;e++)if(r)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):r=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":r=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,i){return t.settings[i]!==e?t.settings[i]:this._defaults[i]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),r=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),a=n,s=this._getFormatConfig(t);try{a=this.parseDate(i,r,s)||n}catch(o){r=e?"":r}t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),t.currentDay=r?a.getDate():0,t.currentMonth=r?a.getMonth():0,t.currentYear=r?a.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,r){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},a=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(r){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,a=n.getFullYear(),s=n.getMonth(),o=n.getDate(),u=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,h=u.exec(i);h;){switch(h[2]||"d"){case"d":case"D":o+=parseInt(h[1],10);break;case"w":case"W":o+=7*parseInt(h[1],10);break;case"m":case"M":s+=parseInt(h[1],10),o=Math.min(o,t.datepicker._getDaysInMonth(a,s));break;case"y":case"Y":a+=parseInt(h[1],10),o=Math.min(o,t.datepicker._getDaysInMonth(a,s))}h=u.exec(i)}return new Date(a,s,o)},s=null==i||""===i?r:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?r:n(i):new Date(i.getTime());return s=s&&"Invalid Date"===s.toString()?r:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var r=!e,n=t.selectedMonth,a=t.selectedYear,s=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=s.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=s.getMonth(),t.drawYear=t.selectedYear=t.currentYear=s.getFullYear(),n===t.selectedMonth&&a===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(r?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),r="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(r,-i,"M")},next:function(){t.datepicker._adjustDate(r,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(r)},selectDay:function(){return t.datepicker._selectDay(r,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(r,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(r,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,r,n,a,s,o,u,h,l,c,d,p,f,g,m,v,_,b,x,A,y,S,C,w,T,M,E,k,I,N,R,F,P,D,L,O,V,B,U=new Date,G=this._daylightSavingAdjust(new Date(U.getFullYear(),U.getMonth(),U.getDate())),z=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),H=this._get(t,"hideIfNoPrevNext"),W=this._get(t,"navigationAsDateFormat"),Q=this._getNumberOfMonths(t),Y=this._get(t,"showCurrentAtPos"),q=this._get(t,"stepMonths"),X=1!==Q[0]||1!==Q[1],K=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(t,"min"),Z=this._getMinMaxDate(t,"max"),$=t.drawMonth-Y,tt=t.drawYear;if(0>$&&($+=12,tt--),Z)for(e=this._daylightSavingAdjust(new Date(Z.getFullYear(),Z.getMonth()-Q[0]*Q[1]+1,Z.getDate())),e=J&&J>e?J:e;this._daylightSavingAdjust(new Date(tt,$,1))>e;)$--,0>$&&($=11,tt--);for(t.drawMonth=$,t.drawYear=tt,i=this._get(t,"prevText"),i=W?this.formatDate(i,this._daylightSavingAdjust(new Date(tt,$-q,1)),this._getFormatConfig(t)):i,r=this._canAdjustMonth(t,-1,tt,$)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"e":"w")+"'>"+i+"</span></a>":H?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=W?this.formatDate(n,this._daylightSavingAdjust(new Date(tt,$+q,1)),this._getFormatConfig(t)):n,a=this._canAdjustMonth(t,1,tt,$)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"w":"e")+"'>"+n+"</span></a>":H?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"w":"e")+"'>"+n+"</span></a>",s=this._get(t,"currentText"),o=this._get(t,"gotoCurrent")&&t.currentDay?K:G,s=W?this.formatDate(s,o,this._getFormatConfig(t)):s,u=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",h=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(z?u:"")+(this._isInRange(t,o)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(z?"":u)+"</div>":"",l=parseInt(this._get(t,"firstDay"),10),l=isNaN(l)?0:l,c=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),_=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),x="",y=0;y<Q[0];y++){for(S="",this.maxRows=4,C=0;C<Q[1];C++){if(w=this._daylightSavingAdjust(new Date(tt,$,t.selectedDay)),T=" ui-corner-all",M="",X){if(M+="<div class='ui-datepicker-group",Q[1]>1)switch(C){case 0:M+=" ui-datepicker-group-first",T=" ui-corner-"+(z?"right":"left");break;case Q[1]-1:M+=" ui-datepicker-group-last",T=" ui-corner-"+(z?"left":"right");break;default:M+=" ui-datepicker-group-middle",T=""}M+="'>"}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+T+"'>"+(/all|left/.test(T)&&0===y?z?a:r:"")+(/all|right/.test(T)&&0===y?z?r:a:"")+this._generateMonthYearHeader(t,$,tt,J,Z,y>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",E=c?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",A=0;7>A;A++)k=(A+l)%7,E+="<th"+((A+l+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[k]+"'>"+p[k]+"</span></th>";for(M+=E+"</tr></thead><tbody>",I=this._getDaysInMonth(tt,$),tt===t.selectedYear&&$===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,I)),N=(this._getFirstDayOfMonth(tt,$)-l+7)%7,R=Math.ceil((N+I)/7),F=X&&this.maxRows>R?this.maxRows:R,this.maxRows=F,P=this._daylightSavingAdjust(new Date(tt,$,1-N)),D=0;F>D;D++){for(M+="<tr>",L=c?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(P)+"</td>":"",A=0;7>A;A++)O=m?m.apply(t.input?t.input[0]:null,[P]):[!0,""],V=P.getMonth()!==$,B=V&&!_||!O[0]||J&&J>P||Z&&P>Z,L+="<td class='"+((A+l+6)%7>=5?" ui-datepicker-week-end":"")+(V?" ui-datepicker-other-month":"")+(P.getTime()===w.getTime()&&$===t.selectedMonth&&t._keyEvent||b.getTime()===P.getTime()&&b.getTime()===w.getTime()?" "+this._dayOverClass:"")+(B?" "+this._unselectableClass+" ui-state-disabled":"")+(V&&!v?"":" "+O[1]+(P.getTime()===K.getTime()?" "+this._currentClass:"")+(P.getTime()===G.getTime()?" ui-datepicker-today":""))+"'"+(V&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(B?"":" data-handler='selectDay' data-event='click' data-month='"+P.getMonth()+"' data-year='"+P.getFullYear()+"'")+">"+(V&&!v?"&#xa0;":B?"<span class='ui-state-default'>"+P.getDate()+"</span>":"<a class='ui-state-default"+(P.getTime()===G.getTime()?" ui-state-highlight":"")+(P.getTime()===K.getTime()?" ui-state-active":"")+(V?" ui-priority-secondary":"")+"' href='#'>"+P.getDate()+"</a>")+"</td>",P.setDate(P.getDate()+1),P=this._daylightSavingAdjust(P);M+=L+"</tr>"}$++,$>11&&($=0,tt++),M+="</tbody></table>"+(X?"</div>"+(Q[0]>0&&C===Q[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),S+=M}x+=S}return x+=h,t._keyEvent=!1,x},_generateMonthYearHeader:function(t,e,i,r,n,a,s,o){var u,h,l,c,d,p,f,g,m=this._get(t,"changeMonth"),v=this._get(t,"changeYear"),_=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",x="";if(a||!m)x+="<span class='ui-datepicker-month'>"+s[e]+"</span>";else{for(u=r&&r.getFullYear()===i,h=n&&n.getFullYear()===i,x+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",l=0;12>l;l++)(!u||l>=r.getMonth())&&(!h||l<=n.getMonth())&&(x+="<option value='"+l+"'"+(l===e?" selected='selected'":"")+">"+o[l]+"</option>");x+="</select>"}if(_||(b+=x+(!a&&m&&v?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(c=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(c[0]),g=Math.max(f,p(c[1]||"")),f=r?Math.max(f,r.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),_&&(b+=(!a&&m&&v?"":"&#xa0;")+x),b+="</div>"},_adjustInstDate:function(t,e,i){var r=t.drawYear+("Y"===i?e:0),n=t.drawMonth+("M"===i?e:0),a=Math.min(t.selectedDay,this._getDaysInMonth(r,n))+("D"===i?e:0),s=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(r,n,a)));t.selectedDay=s.getDate(),t.drawMonth=t.selectedMonth=s.getMonth(),t.drawYear=t.selectedYear=s.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),r=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return r&&n>r?r:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,r){var n=this._getNumberOfMonths(t),a=this._daylightSavingAdjust(new Date(i,r+(0>e?e:n[0]*n[1]),1));return 0>e&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(t,a)},_isInRange:function(t,e){var i,r,n=this._getMinMaxDate(t,"min"),a=this._getMinMaxDate(t,"max"),s=null,o=null,u=this._get(t,"yearRange");return u&&(i=u.split(":"),r=(new Date).getFullYear(),s=parseInt(i[0],10),o=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(s+=r),i[1].match(/[+\-].*/)&&(o+=r)),(!n||e.getTime()>=n.getTime())&&(!a||e.getTime()<=a.getTime())&&(!s||e.getFullYear()>=s)&&(!o||e.getFullYear()<=o)},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,r){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(r,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new i,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.10.4"}(jQuery),function(t,e){var i={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},r={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};t.widget("ui.dialog",{version:"1.10.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i,r=this;if(this._isOpen&&this._trigger("beforeClose",e)!==!1){if(this._isOpen=!1,this._destroyOverlay(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&t(i).blur()}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){r._trigger("close",e)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,e){var i=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return i&&!e&&this._trigger("focus",t),i},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),void this._trigger("open"))},_focusTabbable:function(){var t=this.element.find("[autofocus]");t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).focus()},_keepFocus:function(e){function i(){var e=this.document[0].activeElement,i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB){var i=this.uiDialog.find(":tabbable"),r=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==r[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(n.focus(1),e.preventDefault()):(r.focus(1),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(e),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title||t.html("&#160;"),t.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(t.each(i,function(i,r){var n,a;r=t.isFunction(r)?{click:r,text:i}:r,r=t.extend({type:"button"},r),n=r.click,r.click=function(){n.apply(e.element[0],arguments)},a={icons:r.icons,text:r.showText},delete r.icons,delete r.showText,t("<button></button>",r).button(a).appendTo(e.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,r=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(r,n){t(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",r,e(n))},drag:function(t,r){i._trigger("drag",t,e(r))},stop:function(n,a){r.position=[a.position.left-i.document.scrollLeft(),a.position.top-i.document.scrollTop()],t(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(a))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,r=this.options,n=r.resizable,a=this.uiDialog.css("position"),s="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:this._minHeight(),handles:s,start:function(r,n){t(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",r,e(n))},resize:function(t,r){i._trigger("resize",t,e(r))},stop:function(n,a){r.height=t(this).height(),r.width=t(this).width(),t(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(a))}}).css("position",a)},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var n=this,a=!1,s={};t.each(e,function(t,e){n._setOption(t,e),t in i&&(a=!0),t in r&&(s[t]=e)}),a&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(t,e){var i,r,n=this.uiDialog;"dialogClass"===t&&n.removeClass(this.options.dialogClass).addClass(e),"disabled"!==t&&(this._super(t,e),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:""+e}),"draggable"===t&&(i=n.is(":data(ui-draggable)"),i&&!e&&n.draggable("destroy"),!i&&e&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&(r=n.is(":data(ui-resizable)"),r&&!e&&n.resizable("destroy"),r&&"string"==typeof e&&n.resizable("option","handles",e),r||e===!1||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),t=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),e=Math.max(0,r.minHeight-t),i="number"==typeof r.maxHeight?Math.max(0,r.maxHeight-t):"none","auto"===r.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,r.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=this,i=this.widgetFullName;t.ui.dialog.overlayInstances||this._delay(function(){t.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(r){e._allowInteraction(r)||(r.preventDefault(),t(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())})}),this.overlay=t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),t.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(t.ui.dialog.overlayInstances--,t.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),t.ui.dialog.overlayInstances=0,t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{_position:function(){var e,i=this.options.position,r=[],n=[0,0];i?(("string"==typeof i||"object"==typeof i&&"0"in i)&&(r=i.split?i.split(" "):[i[0],i[1]],1===r.length&&(r[1]=r[0]),t.each(["left","top"],function(t,e){+r[t]===r[t]&&(n[t]=r[t],r[t]=e)}),i={my:r[0]+(n[0]<0?n[0]:"+"+n[0])+" "+r[1]+(n[1]<0?n[1]:"+"+n[1]),at:r.join(" ")}),i=t.extend({},t.ui.dialog.prototype.options.position,i)):i=t.ui.dialog.prototype.options.position,e=this.uiDialog.is(":visible"),e||this.uiDialog.show(),this.uiDialog.position(i),e||this.uiDialog.hide()}})}(jQuery),function(t,e){t.widget("ui.draggable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(t(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var r=this._uiHash();if(this._trigger("drag",e,r)===!1)return this._mouseUp({}),!1;this.position=r.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,r=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(r=t.ui.ddmanager.drop(this,e)),this.dropped&&(r=this.dropped,this.dropped=!1),"original"!==this.options.helper||t.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1):!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(e){var i=this.options,r=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,r,n=this.options;return n.containment?"window"===n.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===n.containment?void(this.containment=[0,0,t(document).width()-this.helperProportions.width-this.margins.left,(t(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):n.containment.constructor===Array?void(this.containment=n.containment):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),r=i[0],void(r&&(e="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],
this.relative_container=i))):void(this.containment=null)},_convertPositionTo:function(e,i){i||(i=this.position);var r="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:n.scrollTop(),left:n.scrollLeft()}),{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*r}},_generatePosition:function(e){var i,r,n,a,s=this.options,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,u=e.pageX,h=e.pageY;return this.offset.scroll||(this.offset.scroll={top:o.scrollTop(),left:o.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),i=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(u=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(u=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),s.grid&&(n=s.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-s.grid[1]:n+s.grid[1]:n,a=s.grid[0]?this.originalPageX+Math.round((u-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,u=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-s.grid[0]:a+s.grid[0]:a)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:u-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,r){return r=r||this._uiHash(),t.ui.plugin.call(this,e,[i,r]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var r=t(this).data("ui-draggable"),n=r.options,a=t.extend({},i,{item:r.element});r.sortables=[],t(n.connectToSortable).each(function(){var i=t.data(this,"ui-sortable");i&&!i.options.disabled&&(r.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,a))})},stop:function(e,i){var r=t(this).data("ui-draggable"),n=t.extend({},i,{item:r.element});t.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===r.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,n))})},drag:function(e,i){var r=t(this).data("ui-draggable"),n=this;t.each(r.sortables,function(){var a=!1,s=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0,t.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(s.instance.element[0],this.instance.element[0])&&(a=!1),a})),a?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(n).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",e),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",e),r.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),i=t(this).data("ui-draggable").options;e.css("cursor")&&(i._cursor=e.css("cursor")),e.css("cursor",i.cursor)},stop:function(){var e=t(this).data("ui-draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var r=t(i.helper),n=t(this).data("ui-draggable").options;r.css("opacity")&&(n._opacity=r.css("opacity")),r.css("opacity",n.opacity)},stop:function(e,i){var r=t(this).data("ui-draggable").options;r._opacity&&t(i.helper).css("opacity",r._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var i=t(this).data("ui-draggable"),r=i.options,n=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(r.axis&&"x"===r.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<r.scrollSensitivity?i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop+r.scrollSpeed:e.pageY-i.overflowOffset.top<r.scrollSensitivity&&(i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<r.scrollSensitivity?i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft+r.scrollSpeed:e.pageX-i.overflowOffset.left<r.scrollSensitivity&&(i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(e.pageY-t(document).scrollTop()<r.scrollSensitivity?n=t(document).scrollTop(t(document).scrollTop()-r.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<r.scrollSensitivity&&(n=t(document).scrollTop(t(document).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(e.pageX-t(document).scrollLeft()<r.scrollSensitivity?n=t(document).scrollLeft(t(document).scrollLeft()-r.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<r.scrollSensitivity&&(n=t(document).scrollLeft(t(document).scrollLeft()+r.scrollSpeed)))),n!==!1&&t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("ui-draggable"),i=e.options;e.snapElements=[],t(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=t(this),r=i.offset();this!==e.element[0]&&e.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:r.top,left:r.left})})},drag:function(e,i){var r,n,a,s,o,u,h,l,c,d,p=t(this).data("ui-draggable"),f=p.options,g=f.snapTolerance,m=i.offset.left,v=m+p.helperProportions.width,_=i.offset.top,b=_+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--)o=p.snapElements[c].left,u=o+p.snapElements[c].width,h=p.snapElements[c].top,l=h+p.snapElements[c].height,o-g>v||m>u+g||h-g>b||_>l+g||!t.contains(p.snapElements[c].item.ownerDocument,p.snapElements[c].item)?(p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(r=Math.abs(h-b)<=g,n=Math.abs(l-_)<=g,a=Math.abs(o-v)<=g,s=Math.abs(u-m)<=g,r&&(i.position.top=p._convertPositionTo("relative",{top:h-p.helperProportions.height,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:o-p.helperProportions.width}).left-p.margins.left),s&&(i.position.left=p._convertPositionTo("relative",{top:0,left:u}).left-p.margins.left)),d=r||n||a||s,"outer"!==f.snapMode&&(r=Math.abs(h-_)<=g,n=Math.abs(l-b)<=g,a=Math.abs(o-m)<=g,s=Math.abs(u-v)<=g,r&&(i.position.top=p._convertPositionTo("relative",{top:h,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:o}).left-p.margins.left),s&&(i.position.left=p._convertPositionTo("relative",{top:0,left:u-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(r||n||a||s||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=r||n||a||s||d)}}),t.ui.plugin.add("draggable","stack",{start:function(){var e,i=this.data("ui-draggable").options,r=t.makeArray(t(i.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});r.length&&(e=parseInt(t(r[0]).css("zIndex"),10)||0,t(r).each(function(i){t(this).css("zIndex",e+i)}),this.css("zIndex",e+r.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var r=t(i.helper),n=t(this).data("ui-draggable").options;r.css("zIndex")&&(n._zIndex=r.css("zIndex")),r.css("zIndex",n.zIndex)},stop:function(e,i){var r=t(this).data("ui-draggable").options;r._zIndex&&t(i.helper).css("zIndex",r._zIndex)}})}(jQuery),function(t,e){function i(t,e,i){return t>e&&e+i>t}t.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,r=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(r)?r:function(t){return t.is(r)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},t.ui.ddmanager.droppables[i.scope]=t.ui.ddmanager.droppables[i.scope]||[],t.ui.ddmanager.droppables[i.scope].push(this),i.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,i=t.ui.ddmanager.droppables[this.options.scope];e<i.length;e++)i[e]===this&&i.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){"accept"===e&&(this.accept=t.isFunction(i)?i:function(t){return t.is(i)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var r=i||t.ui.ddmanager.current,n=!1;return r&&(r.currentItem||r.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"ui-droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope===r.options.scope&&e.accept.call(e.element[0],r.currentItem||r.element)&&t.ui.intersect(r,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(r)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(t,e,r){if(!e.offset)return!1;var n,a,s=(t.positionAbs||t.position.absolute).left,o=(t.positionAbs||t.position.absolute).top,u=s+t.helperProportions.width,h=o+t.helperProportions.height,l=e.offset.left,c=e.offset.top,d=l+e.proportions().width,p=c+e.proportions().height;switch(r){case"fit":return s>=l&&d>=u&&o>=c&&p>=h;case"intersect":return l<s+t.helperProportions.width/2&&u-t.helperProportions.width/2<d&&c<o+t.helperProportions.height/2&&h-t.helperProportions.height/2<p;case"pointer":return n=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,a=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,i(a,c,e.proportions().height)&&i(n,l,e.proportions().width);case"touch":return(o>=c&&p>=o||h>=c&&p>=h||c>o&&h>p)&&(s>=l&&d>=s||u>=l&&d>=u||l>s&&u>d);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var r,n,a=t.ui.ddmanager.droppables[e.options.scope]||[],s=i?i.type:null,o=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(r=0;r<a.length;r++)if(!(a[r].options.disabled||e&&!a[r].accept.call(a[r].element[0],e.currentItem||e.element))){for(n=0;n<o.length;n++)if(o[n]===a[r].element[0]){a[r].proportions().height=0;continue t}a[r].visible="none"!==a[r].element.css("display"),a[r].visible&&("mousedown"===s&&a[r]._activate.call(a[r],i),a[r].offset=a[r].element.offset(),a[r].proportions({width:a[r].element[0].offsetWidth,height:a[r].element[0].offsetHeight}))}},drop:function(e,i){var r=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(r=this._drop.call(this,i)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),r},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,n,a,s=t.ui.intersect(e,this,this.options.tolerance),o=!s&&this.isover?"isout":s&&!this.isover?"isover":null;o&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return t.data(this,"ui-droppable").options.scope===n}),a.length&&(r=t.data(a[0],"ui-droppable"),r.greedyChild="isover"===o)),r&&"isover"===o&&(r.isover=!1,r.isout=!0,r._out.call(r,i)),this[o]=!0,this["isout"===o?"isover":"isout"]=!1,this["isover"===o?"_over":"_out"].call(this,i),r&&"isout"===o&&(r.isout=!1,r.isover=!0,r._over.call(r,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}}}(jQuery),function(t,e){var i="ui-effects-";t.effects={effect:{}},/*!
	 * jQuery Color Animations v2.1.2
	 * https://github.com/jquery/jquery-color
	 *
	 * Copyright 2013 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * Date: Wed Jan 16 08:47:09 2013 -0600
	 */
function(t,e){function i(t,e,i){var r=c[e.type]||{};return null==t?i||!e.def?null:e.def:(t=r.floor?~~t:parseFloat(t),isNaN(t)?e.def:r.mod?(t+r.mod)%r.mod:0>t?0:r.max<t?r.max:t)}function r(e){var i=h(),r=i._rgba=[];return e=e.toLowerCase(),f(u,function(t,n){var a,s=n.re.exec(e),o=s&&n.parse(s),u=n.space||"rgba";return o?(a=i[u](o),i[l[u].cache]=a[l[u].cache],r=i._rgba=a._rgba,!1):void 0}),r.length?("0,0,0,0"===r.join()&&t.extend(r,a.transparent),i):a[e]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+(e-t)*i*6:1>2*i?e:2>3*i?t+(e-t)*(2/3-i)*6:t}var a,s="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",o=/^([\-+])=\s*(\d+\.?\d*)/,u=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],h=t.Color=function(e,i,r,n){return new t.Color.fn.parse(e,i,r,n)},l={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(l,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),h.fn=t.extend(h.prototype,{parse:function(n,s,o,u){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(s),s=e);var c=this,d=t.type(n),p=this._rgba=[];return s!==e&&(n=[n,s,o,u],d="array"),"string"===d?this.parse(r(n)||a._default):"array"===d?(f(l.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof h?f(l,function(t,e){n[e.cache]&&(c[e.cache]=n[e.cache].slice())}):f(l,function(e,r){var a=r.cache;f(r.props,function(t,e){if(!c[a]&&r.to){if("alpha"===t||null==n[t])return;c[a]=r.to(c._rgba)}c[a][e.idx]=i(n[t],e,!0)}),c[a]&&t.inArray(null,c[a].slice(0,3))<0&&(c[a][3]=1,r.from&&(c._rgba=r.from(c[a])))}),this):void 0},is:function(t){var e=h(t),i=!0,r=this;return f(l,function(t,n){var a,s=e[n.cache];return s&&(a=r[n.cache]||n.to&&n.to(r._rgba)||[],f(n.props,function(t,e){return null!=s[e.idx]?i=s[e.idx]===a[e.idx]:void 0})),i}),i},_space:function(){var t=[],e=this;return f(l,function(i,r){e[r.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var r=h(t),n=r._space(),a=l[n],s=0===this.alpha()?h("transparent"):this,o=s[a.cache]||a.to(s._rgba),u=o.slice();return r=r[a.cache],f(a.props,function(t,n){var a=n.idx,s=o[a],h=r[a],l=c[n.type]||{};null!==h&&(null===s?u[a]=h:(l.mod&&(h-s>l.mod/2?s+=l.mod:s-h>l.mod/2&&(s-=l.mod)),u[a]=i((h-s)*e+s,n)))}),this[n](u)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),r=i.pop(),n=h(e)._rgba;return h(t.map(i,function(t,e){return(1-r)*n[e]+r*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),r=i.pop();return e&&i.push(~~(255*r)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,l.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,r=t[0]/255,n=t[1]/255,a=t[2]/255,s=t[3],o=Math.max(r,n,a),u=Math.min(r,n,a),h=o-u,l=o+u,c=.5*l;return e=u===o?0:r===o?60*(n-a)/h+360:n===o?60*(a-r)/h+120:60*(r-n)/h+240,i=0===h?0:.5>=c?h/l:h/(2-l),[Math.round(e)%360,i,c,null==s?1:s]},l.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],r=t[2],a=t[3],s=.5>=r?r*(1+i):r+i-r*i,o=2*r-s;return[Math.round(255*n(o,s,e+1/3)),Math.round(255*n(o,s,e)),Math.round(255*n(o,s,e-1/3)),a]},f(l,function(r,n){var a=n.props,s=n.cache,u=n.to,l=n.from;h.fn[r]=function(r){if(u&&!this[s]&&(this[s]=u(this._rgba)),r===e)return this[s].slice();var n,o=t.type(r),c="array"===o||"object"===o?r:arguments,d=this[s].slice();return f(a,function(t,e){var r=c["object"===o?t:e.idx];null==r&&(r=d[e.idx]),d[e.idx]=i(r,e)}),l?(n=h(l(d)),n[s]=d,n):h(d)},f(a,function(e,i){h.fn[e]||(h.fn[e]=function(n){var a,s=t.type(n),u="alpha"===e?this._hsla?"hsla":"rgba":r,h=this[u](),l=h[i.idx];return"undefined"===s?l:("function"===s&&(n=n.call(this,l),s=t.type(n)),null==n&&i.empty?this:("string"===s&&(a=o.exec(n),a&&(n=l+parseFloat(a[2])*("+"===a[1]?1:-1))),h[i.idx]=n,this[u](h)))})})}),h.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var a,s,o="";if("transparent"!==n&&("string"!==t.type(n)||(a=r(n)))){if(n=h(a||n),!d.rgba&&1!==n._rgba[3]){for(s="backgroundColor"===i?e.parentNode:e;(""===o||"transparent"===o)&&s&&s.style;)try{o=t.css(s,"backgroundColor"),s=s.parentNode}catch(u){}n=n.blend(o&&"transparent"!==o?o:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(u){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=h(e.elem,i),e.end=h(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},h.hook(s),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,r){e["border"+r+"Color"]=t}),e}},a=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(e){var i,r,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(r=n.length;r--;)i=n[r],"string"==typeof n[i]&&(a[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function r(e,i){var r,n,s={};for(r in i)n=i[r],e[r]!==n&&(a[r]||(t.fx.step[r]||!isNaN(parseFloat(n)))&&(s[r]=n));return s}var n=["add","remove","toggle"],a={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(jQuery.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(e,a,s,o){var u=t.speed(a,s,o);return this.queue(function(){var a,s=t(this),o=s.attr("class")||"",h=u.children?s.find("*").addBack():s;h=h.map(function(){var e=t(this);return{el:e,start:i(this)}}),a=function(){t.each(n,function(t,i){e[i]&&s[i+"Class"](e[i])})},a(),h=h.map(function(){return this.end=i(this.el[0]),this.diff=r(this.start,this.end),this}),s.attr("class",o),h=h.map(function(){var e=this,i=t.Deferred(),r=t.extend({},u,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,r),i.promise()}),t.when.apply(t,h.get()).done(function(){a(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),u.complete.call(s[0])})})},t.fn.extend({addClass:function(e){return function(i,r,n,a){return r?t.effects.animateClass.call(this,{add:i},r,n,a):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,r,n,a){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},r,n,a):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(i){return function(r,n,a,s,o){return"boolean"==typeof n||n===e?a?t.effects.animateClass.call(this,n?{add:r}:{remove:r},a,s,o):i.apply(this,arguments):t.effects.animateClass.call(this,{toggle:r},n,a,s)}}(t.fn.toggleClass),switchClass:function(e,i,r,n,a){return t.effects.animateClass.call(this,{add:i,remove:e},r,n,a)}})}(),function(){function r(e,i,r,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,r=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=r,r=i,i={}),t.isFunction(r)&&(n=r,r=null),i&&t.extend(e,i),r=r||i.duration,e.duration=t.fx.off?0:"number"==typeof r?r:r in t.fx.speeds?t.fx.speeds[r]:t.fx.speeds._default,e.complete=n||i.complete,e}function n(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}t.extend(t.effects,{version:"1.10.4",save:function(t,e){for(var r=0;r<e.length;r++)null!==e[r]&&t.data(i+e[r],t[0].style[e[r]])},restore:function(t,r){var n,a;for(a=0;a<r.length;a++)null!==r[a]&&(n=t.data(i+r[a]),n===e&&(n=""),t.css(r[a],n))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,r;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=t[1]/e.width}return{x:r,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},r=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},a=document.activeElement;try{a.id}catch(s){a=document.body}return e.wrap(r),(e[0]===a||t.contains(e[0],a))&&t(a).focus(),r=e.parent(),"static"===e.css("position")?(r.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,r){i[r]=e.css(r),isNaN(parseInt(i[r],10))&&(i[r]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),r.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,r,n){return n=n||{},t.each(i,function(t,i){var a=e.cssUnit(i);a[0]>0&&(n[i]=a[0]*r+a[1])}),n}}),t.fn.extend({effect:function(){function e(e){function r(){t.isFunction(a)&&a.call(n[0]),t.isFunction(e)&&e()}var n=t(this),a=i.complete,o=i.mode;(n.is(":hidden")?"hide"===o:"show"===o)?(n[o](),r()):s.call(n[0],i,r)}var i=r.apply(this,arguments),n=i.mode,a=i.queue,s=t.effects.effect[i.effect];return t.fx.off||!s?n?this[n](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):a===!1?this.each(e):this.queue(a||"fx",e)},show:function(t){return function(e){if(n(e))return t.apply(this,arguments);var i=r.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(t.fn.show),hide:function(t){return function(e){if(n(e))return t.apply(this,arguments);var i=r.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(t.fn.hide),toggle:function(t){return function(e){if(n(e)||"boolean"==typeof e)return t.apply(this,arguments);var i=r.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),r=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(r=[parseFloat(i),e])}),r}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;t<((e=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}()}(jQuery),function(t,e){var i=/up|down|vertical/,r=/up|left|vertical|horizontal/;t.effects.effect.blind=function(e,n){var a,s,o,u=t(this),h=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(u,e.mode||"hide"),c=e.direction||"up",d=i.test(c),p=d?"height":"width",f=d?"top":"left",g=r.test(c),m={},v="show"===l;u.parent().is(".ui-effects-wrapper")?t.effects.save(u.parent(),h):t.effects.save(u,h),u.show(),a=t.effects.createWrapper(u).css({overflow:"hidden"}),s=a[p](),o=parseFloat(a.css(f))||0,m[p]=v?s:0,g||(u.css(d?"bottom":"right",0).css(d?"top":"left","auto").css({position:"absolute"}),m[f]=v?o:s+o),v&&(a.css(p,0),g||a.css(f,o+s)),a.animate(m,{duration:e.duration,easing:e.easing,queue:!1,complete:function(){"hide"===l&&u.hide(),t.effects.restore(u,h),t.effects.removeWrapper(u),n()}})}}(jQuery),function(t,e){t.effects.effect.bounce=function(e,i){var r,n,a,s=t(this),o=["position","top","bottom","left","right","height","width"],u=t.effects.setMode(s,e.mode||"effect"),h="hide"===u,l="show"===u,c=e.direction||"up",d=e.distance,p=e.times||5,f=2*p+(l||h?1:0),g=e.duration/f,m=e.easing,v="up"===c||"down"===c?"top":"left",_="up"===c||"left"===c,b=s.queue(),x=b.length;for((l||h)&&o.push("opacity"),t.effects.save(s,o),s.show(),t.effects.createWrapper(s),d||(d=s["top"===v?"outerHeight":"outerWidth"]()/3),l&&(a={opacity:1},a[v]=0,s.css("opacity",0).css(v,_?2*-d:2*d).animate(a,g,m)),h&&(d/=Math.pow(2,p-1)),a={},a[v]=0,r=0;p>r;r++)n={},n[v]=(_?"-=":"+=")+d,s.animate(n,g,m).animate(a,g,m),d=h?2*d:d/2;h&&(n={opacity:0},n[v]=(_?"-=":"+=")+d,s.animate(n,g,m)),s.queue(function(){h&&s.hide(),t.effects.restore(s,o),t.effects.removeWrapper(s),i()}),x>1&&b.splice.apply(b,[1,0].concat(b.splice(x,f+1))),s.dequeue()}}(jQuery),function(t,e){t.effects.effect.clip=function(e,i){var r,n,a,s=t(this),o=["position","top","bottom","left","right","height","width"],u=t.effects.setMode(s,e.mode||"hide"),h="show"===u,l=e.direction||"vertical",c="vertical"===l,d=c?"height":"width",p=c?"top":"left",f={};t.effects.save(s,o),s.show(),r=t.effects.createWrapper(s).css({overflow:"hidden"}),n="IMG"===s[0].tagName?r:s,a=n[d](),h&&(n.css(d,0),n.css(p,a/2)),f[d]=h?a:0,f[p]=h?0:a/2,n.animate(f,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){h||s.hide(),t.effects.restore(s,o),t.effects.removeWrapper(s),i()}})}}(jQuery),function(t,e){t.effects.effect.drop=function(e,i){var r,n=t(this),a=["position","top","bottom","left","right","opacity","height","width"],s=t.effects.setMode(n,e.mode||"hide"),o="show"===s,u=e.direction||"left",h="up"===u||"down"===u?"top":"left",l="up"===u||"left"===u?"pos":"neg",c={opacity:o?1:0};t.effects.save(n,a),n.show(),t.effects.createWrapper(n),r=e.distance||n["top"===h?"outerHeight":"outerWidth"](!0)/2,o&&n.css("opacity",0).css(h,"pos"===l?-r:r),c[h]=(o?"pos"===l?"+=":"-=":"pos"===l?"-=":"+=")+r,n.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===s&&n.hide(),t.effects.restore(n,a),t.effects.removeWrapper(n),i()}})}}(jQuery),function(t,e){t.effects.effect.explode=function(e,i){function r(){b.push(this),b.length===c*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),g||p.hide(),i()}var a,s,o,u,h,l,c=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=c,p=t(this),f=t.effects.setMode(p,e.mode||"hide"),g="show"===f,m=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/d),_=Math.ceil(p.outerHeight()/c),b=[];for(a=0;c>a;a++)for(u=m.top+a*_,l=a-(c-1)/2,s=0;d>s;s++)o=m.left+s*v,h=s-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-s*v,top:-a*_}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:_,left:o+(g?h*v:0),top:u+(g?l*_:0),opacity:g?0:1}).animate({left:o+(g?0:h*v),top:u+(g?0:l*_),opacity:g?1:0},e.duration||500,e.easing,r)}}(jQuery),function(t,e){t.effects.effect.fade=function(e,i){var r=t(this),n=t.effects.setMode(r,e.mode||"toggle");r.animate({opacity:n},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}}(jQuery),function(t,e){t.effects.effect.fold=function(e,i){var r,n,a=t(this),s=["position","top","bottom","left","right","height","width"],o=t.effects.setMode(a,e.mode||"hide"),u="show"===o,h="hide"===o,l=e.size||15,c=/([0-9]+)%/.exec(l),d=!!e.horizFirst,p=u!==d,f=p?["width","height"]:["height","width"],g=e.duration/2,m={},v={};t.effects.save(a,s),a.show(),r=t.effects.createWrapper(a).css({overflow:"hidden"}),n=p?[r.width(),r.height()]:[r.height(),r.width()],c&&(l=parseInt(c[1],10)/100*n[h?0:1]),u&&r.css(d?{height:0,width:l}:{height:l,width:0}),m[f[0]]=u?n[0]:l,v[f[1]]=u?n[1]:0,r.animate(m,g,e.easing).animate(v,g,e.easing,function(){h&&a.hide(),t.effects.restore(a,s),t.effects.removeWrapper(a),i()})}}(jQuery),function(t,e){t.effects.effect.highlight=function(e,i){var r=t(this),n=["backgroundImage","backgroundColor","opacity"],a=t.effects.setMode(r,e.mode||"show"),s={backgroundColor:r.css("backgroundColor")};"hide"===a&&(s.opacity=0),t.effects.save(r,n),r.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(s,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&r.hide(),t.effects.restore(r,n),i()}})}}(jQuery),function(t,e){t.effects.effect.pulsate=function(e,i){var r,n=t(this),a=t.effects.setMode(n,e.mode||"show"),s="show"===a,o="hide"===a,u=s||"hide"===a,h=2*(e.times||5)+(u?1:0),l=e.duration/h,c=0,d=n.queue(),p=d.length;for((s||!n.is(":visible"))&&(n.css("opacity",0).show(),c=1),r=1;h>r;r++)n.animate({opacity:c},l,e.easing),c=1-c;n.animate({opacity:c},l,e.easing),n.queue(function(){o&&n.hide(),i()}),p>1&&d.splice.apply(d,[1,0].concat(d.splice(p,h+1))),n.dequeue()}}(jQuery),function(t,e){t.effects.effect.puff=function(e,i){var r=t(this),n=t.effects.setMode(r,e.mode||"hide"),a="hide"===n,s=parseInt(e.percent,10)||150,o=s/100,u={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()};t.extend(e,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:a?s:100,from:a?u:{height:u.height*o,width:u.width*o,outerHeight:u.outerHeight*o,outerWidth:u.outerWidth*o}}),r.effect(e)},t.effects.effect.scale=function(e,i){var r=t(this),n=t.extend(!0,{},e),a=t.effects.setMode(r,e.mode||"effect"),s=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"hide"===a?0:100),o=e.direction||"both",u=e.origin,h={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},l={y:"horizontal"!==o?s/100:1,x:"vertical"!==o?s/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==a&&(n.origin=u||["middle","center"],n.restore=!0),n.from=e.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:h),n.to={height:h.height*l.y,width:h.width*l.x,outerHeight:h.outerHeight*l.y,outerWidth:h.outerWidth*l.x},n.fade&&("show"===a&&(n.from.opacity=0,n.to.opacity=1),"hide"===a&&(n.from.opacity=1,n.to.opacity=0)),r.effect(n)},t.effects.effect.size=function(e,i){var r,n,a,s=t(this),o=["position","top","bottom","left","right","width","height","overflow","opacity"],u=["position","top","bottom","left","right","overflow","opacity"],h=["width","height","overflow"],l=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=t.effects.setMode(s,e.mode||"effect"),f=e.restore||"effect"!==p,g=e.scale||"both",m=e.origin||["middle","center"],v=s.css("position"),_=f?o:u,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&s.show(),r={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},"toggle"===e.mode&&"show"===p?(s.from=e.to||b,s.to=e.from||r):(s.from=e.from||("show"===p?b:r),s.to=e.to||("hide"===p?b:r)),a={from:{y:s.from.height/r.height,x:s.from.width/r.width},to:{y:s.to.height/r.height,x:s.to.width/r.width}},("box"===g||"both"===g)&&(a.from.y!==a.to.y&&(_=_.concat(c),s.from=t.effects.setTransition(s,c,a.from.y,s.from),s.to=t.effects.setTransition(s,c,a.to.y,s.to)),a.from.x!==a.to.x&&(_=_.concat(d),s.from=t.effects.setTransition(s,d,a.from.x,s.from),s.to=t.effects.setTransition(s,d,a.to.x,s.to))),("content"===g||"both"===g)&&a.from.y!==a.to.y&&(_=_.concat(l).concat(h),s.from=t.effects.setTransition(s,l,a.from.y,s.from),s.to=t.effects.setTransition(s,l,a.to.y,s.to)),t.effects.save(s,_),s.show(),t.effects.createWrapper(s),s.css("overflow","hidden").css(s.from),m&&(n=t.effects.getBaseline(m,r),s.from.top=(r.outerHeight-s.outerHeight())*n.y,s.from.left=(r.outerWidth-s.outerWidth())*n.x,s.to.top=(r.outerHeight-s.to.outerHeight)*n.y,s.to.left=(r.outerWidth-s.to.outerWidth)*n.x),s.css(s.from),("content"===g||"both"===g)&&(c=c.concat(["marginTop","marginBottom"]).concat(l),d=d.concat(["marginLeft","marginRight"]),h=o.concat(c).concat(d),s.find("*[width]").each(function(){var i=t(this),r={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&t.effects.save(i,h),i.from={height:r.height*a.from.y,width:r.width*a.from.x,outerHeight:r.outerHeight*a.from.y,outerWidth:r.outerWidth*a.from.x},i.to={height:r.height*a.to.y,width:r.width*a.to.x,outerHeight:r.height*a.to.y,outerWidth:r.width*a.to.x},a.from.y!==a.to.y&&(i.from=t.effects.setTransition(i,c,a.from.y,i.from),i.to=t.effects.setTransition(i,c,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=t.effects.setTransition(i,d,a.from.x,i.from),i.to=t.effects.setTransition(i,d,a.to.x,i.to)),i.css(i.from),i.animate(i.to,e.duration,e.easing,function(){f&&t.effects.restore(i,h)})})),s.animate(s.to,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){0===s.to.opacity&&s.css("opacity",s.from.opacity),"hide"===p&&s.hide(),t.effects.restore(s,_),f||("static"===v?s.css({position:"relative",top:s.to.top,left:s.to.left}):t.each(["top","left"],function(t,e){s.css(e,function(e,i){var r=parseInt(i,10),n=t?s.to.left:s.to.top;return"auto"===i?n+"px":r+n+"px"})})),t.effects.removeWrapper(s),i()}})}}(jQuery),function(t,e){t.effects.effect.shake=function(e,i){var r,n=t(this),a=["position","top","bottom","left","right","height","width"],s=t.effects.setMode(n,e.mode||"effect"),o=e.direction||"left",u=e.distance||20,h=e.times||3,l=2*h+1,c=Math.round(e.duration/l),d="up"===o||"down"===o?"top":"left",p="up"===o||"left"===o,f={},g={},m={},v=n.queue(),_=v.length;for(t.effects.save(n,a),n.show(),t.effects.createWrapper(n),f[d]=(p?"-=":"+=")+u,g[d]=(p?"+=":"-=")+2*u,m[d]=(p?"-=":"+=")+2*u,n.animate(f,c,e.easing),r=1;h>r;r++)n.animate(g,c,e.easing).animate(m,c,e.easing);n.animate(g,c,e.easing).animate(f,c/2,e.easing).queue(function(){"hide"===s&&n.hide(),t.effects.restore(n,a),t.effects.removeWrapper(n),i()}),_>1&&v.splice.apply(v,[1,0].concat(v.splice(_,l+1))),n.dequeue()}}(jQuery),function(t,e){t.effects.effect.slide=function(e,i){var r,n=t(this),a=["position","top","bottom","left","right","width","height"],s=t.effects.setMode(n,e.mode||"show"),o="show"===s,u=e.direction||"left",h="up"===u||"down"===u?"top":"left",l="up"===u||"left"===u,c={};t.effects.save(n,a),n.show(),r=e.distance||n["top"===h?"outerHeight":"outerWidth"](!0),t.effects.createWrapper(n).css({overflow:"hidden"}),o&&n.css(h,l?isNaN(r)?"-"+r:-r:r),c[h]=(o?l?"+=":"-=":l?"-=":"+=")+r,n.animate(c,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===s&&n.hide(),t.effects.restore(n,a),t.effects.removeWrapper(n),i()}})}}(jQuery),function(t,e){t.effects.effect.transfer=function(e,i){var r=t(this),n=t(e.to),a="fixed"===n.css("position"),s=t("body"),o=a?s.scrollTop():0,u=a?s.scrollLeft():0,h=n.offset(),l={top:h.top-o,left:h.left-u,height:n.innerHeight(),width:n.innerWidth()},c=r.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:c.top-o,left:c.left-u,height:r.innerHeight(),width:r.innerWidth(),position:a?"fixed":"absolute"}).animate(l,e.duration,e.easing,function(){d.remove(),i()})}}(jQuery),function(t,e){t.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,t.proxy(function(t){this.options.disabled&&t.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(t){t.preventDefault()},"click .ui-state-disabled > a":function(t){t.preventDefault()},"click .ui-menu-item:has(a)":function(e){var i=t(e.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&t(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var i=t(e.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.children(".ui-menu-item").eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){t(e.target).closest(".ui-menu").length||this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var r,n,a,s,o,u=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:u=!1,n=this.previousFilter||"",a=String.fromCharCode(e.keyCode),s=!1,clearTimeout(this.filterTimer),a===n?s=!0:a=n+a,o=new RegExp("^"+i(a),"i"),r=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(t(this).children("a").text())}),r=s&&-1!==r.index(this.active.next())?this.active.nextAll(".ui-menu-item"):r,r.length||(a=String.fromCharCode(e.keyCode),o=new RegExp("^"+i(a),"i"),r=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(t(this).children("a").text())})),r.length?(this.focus(e,r),r.length>1?(this.previousFilter=a,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}u&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i=this.options.icons.submenu,r=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),r.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),r=e.prev("a"),n=t("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);r.attr("aria-haspopup","true").prepend(n),e.attr("aria-labelledby",r.attr("id"))}),e=r.add(this.element),e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=t(this);/[^\-\u2014\u2013\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),this._super(t,e)},focus:function(t,e){var i,r;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),r=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,r,n,a,s,o;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-r,a=this.activeMenu.scrollTop(),s=this.activeMenu.height(),o=e.height(),0>n?this.activeMenu.scrollTop(a+n):n+o>s&&this.activeMenu.scrollTop(a+n-s+o))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var r=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(e),this.activeMenu=r},this.delay)},_close:function(t){
t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var r;this.active&&(r="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),r&&r.length&&this.active||(r=this.activeMenu.children(".ui-menu-item")[e]()),this.focus(i,r)},nextPage:function(e){var i,r,n;return this.active?void(this.isLastItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-r-n<0}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,r,n;return this.active?void(this.isFirstItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-r+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item").first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)}})}(jQuery),function(t,e){t.widget("ui.progressbar",{version:"1.10.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(t){return t===e?this.options.value:(this.options.value=this._constrainedValue(t),void this._refreshValue())},_constrainedValue:function(t){return t===e&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}})}(jQuery),function(t,e){function i(t){return parseInt(t,10)||0}function r(t){return!isNaN(parseInt(t,10))}t.widget("ui.resizable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var e,i,r,n,a,s=this,o=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!o.aspectRatio,aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=o.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;i<e.length;i++)r=t.trim(e[i]),a="ui-resizable-"+r,n=t("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:o.zIndex}),"se"===r&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(n);this._renderAxis=function(e){var i,r,n,a;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=t(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=t(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?r.outerHeight():r.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,a),this._proportionallyResize()),t(this.handles[i]).length},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=n&&n[1]?n[1]:"se")}),o.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){o.disabled||(t(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){o.disabled||s.resizing||(t(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,r,n=!1;for(i in this.handles)r=t(this.handles[i])[0],(r===e.target||t.contains(r,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var r,n,a,s=this.options,o=this.element.position(),u=this.element;return this.resizing=!0,/absolute/.test(u.css("position"))?u.css({position:"absolute",top:u.css("top"),left:u.css("left")}):u.is(".ui-draggable")&&u.css({position:"absolute",top:o.top,left:o.left}),this._renderProxy(),r=i(this.helper.css("left")),n=i(this.helper.css("top")),s.containment&&(r+=t(s.containment).scrollLeft()||0,n+=t(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:n},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:u.width(),height:u.height()},this.originalSize=this._helper?{width:u.outerWidth(),height:u.outerHeight()}:{width:u.width(),height:u.height()},this.originalPosition={left:r,top:n},this.sizeDiff={width:u.outerWidth()-u.width(),height:u.outerHeight()-u.height()},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===a?this.axis+"-resize":a),u.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,r=this.helper,n={},a=this.originalMousePosition,s=this.axis,o=this.position.top,u=this.position.left,h=this.size.width,l=this.size.height,c=e.pageX-a.left||0,d=e.pageY-a.top||0,p=this._change[s];return p?(i=p.apply(this,[e,c,d]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),this.position.top!==o&&(n.top=this.position.top+"px"),this.position.left!==u&&(n.left=this.position.left+"px"),this.size.width!==h&&(n.width=this.size.width+"px"),this.size.height!==l&&(n.height=this.size.height+"px"),r.css(n),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(n)||this._trigger("resize",e,this.ui()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,r,n,a,s,o,u,h=this.options,l=this;return this._helper&&(i=this._proportionallyResizeElements,r=i.length&&/textarea/i.test(i[0].nodeName),n=r&&t.ui.hasScroll(i[0],"left")?0:l.sizeDiff.height,a=r?0:l.sizeDiff.width,s={width:l.helper.width()-a,height:l.helper.height()-n},o=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null,u=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null,h.animate||this.element.css(t.extend(s,{top:u,left:o})),l.helper.height(l.size.height),l.helper.width(l.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,i,n,a,s,o=this.options;s={minWidth:r(o.minWidth)?o.minWidth:0,maxWidth:r(o.maxWidth)?o.maxWidth:1/0,minHeight:r(o.minHeight)?o.minHeight:0,maxHeight:r(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||t)&&(e=s.minHeight*this.aspectRatio,n=s.minWidth/this.aspectRatio,i=s.maxHeight*this.aspectRatio,a=s.maxWidth/this.aspectRatio,e>s.minWidth&&(s.minWidth=e),n>s.minHeight&&(s.minHeight=n),i<s.maxWidth&&(s.maxWidth=i),a<s.maxHeight&&(s.maxHeight=a)),this._vBoundaries=s},_updateCache:function(t){this.offset=this.helper.offset(),r(t.left)&&(this.position.left=t.left),r(t.top)&&(this.position.top=t.top),r(t.height)&&(this.size.height=t.height),r(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,n=this.axis;return r(t.height)?t.width=t.height*this.aspectRatio:r(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===n&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===n&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,n=r(t.width)&&e.maxWidth&&e.maxWidth<t.width,a=r(t.height)&&e.maxHeight&&e.maxHeight<t.height,s=r(t.width)&&e.minWidth&&e.minWidth>t.width,o=r(t.height)&&e.minHeight&&e.minHeight>t.height,u=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return s&&(t.width=e.minWidth),o&&(t.height=e.minHeight),n&&(t.width=e.maxWidth),a&&(t.height=e.maxHeight),s&&l&&(t.left=u-e.minWidth),n&&l&&(t.left=u-e.maxWidth),o&&c&&(t.top=h-e.minHeight),a&&c&&(t.top=h-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var t,e,i,r,n,a=this.helper||this.element;for(t=0;t<this._proportionallyResizeElements.length;t++){if(n=this._proportionallyResizeElements[t],!this.borderDif)for(this.borderDif=[],i=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],r=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")],e=0;e<i.length;e++)this.borderDif[e]=(parseInt(i[e],10)||0)+(parseInt(r[e],10)||0);n.css({height:a.height()-this.borderDif[0]-this.borderDif[2]||0,width:a.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,r=this.originalPosition;return{left:r.left+e,width:i.width-e}},n:function(t,e,i){var r=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:r.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,r){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,r]))},sw:function(e,i,r){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,r]))},ne:function(e,i,r){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,r]))},nw:function(e,i,r){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,r]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).data("ui-resizable"),r=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),s=a&&t.ui.hasScroll(n[0],"left")?0:i.sizeDiff.height,o=a?0:i.sizeDiff.width,u={width:i.size.width-o,height:i.size.height-s},h=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,l=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(u,l&&h?{top:l,left:h}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&t(n[0]).css({width:r.width,height:r.height}),i._updateCache(r),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,r,n,a,s,o,u,h=t(this).data("ui-resizable"),l=h.options,c=h.element,d=l.containment,p=d instanceof t?d.get(0):/parent/.test(d)?c.parent().get(0):d;p&&(h.containerElement=t(p),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(p),r=[],t(["Top","Right","Left","Bottom"]).each(function(t,n){r[t]=i(e.css("padding"+n))}),h.containerOffset=e.offset(),h.containerPosition=e.position(),h.containerSize={height:e.innerHeight()-r[3],width:e.innerWidth()-r[1]},n=h.containerOffset,a=h.containerSize.height,s=h.containerSize.width,o=t.ui.hasScroll(p,"left")?p.scrollWidth:s,u=t.ui.hasScroll(p)?p.scrollHeight:a,h.parentData={element:p,left:n.left,top:n.top,width:o,height:u}))},resize:function(e){var i,r,n,a,s=t(this).data("ui-resizable"),o=s.options,u=s.containerOffset,h=s.position,l=s._aspectRatio||e.shiftKey,c={top:0,left:0},d=s.containerElement;d[0]!==document&&/static/.test(d.css("position"))&&(c=u),h.left<(s._helper?u.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-u.left:s.position.left-c.left),l&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=o.helper?u.left:0),h.top<(s._helper?u.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-u.top:s.position.top),l&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?u.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,i=Math.abs((s._helper?s.offset.left-c.left:s.offset.left-c.left)+s.sizeDiff.width),r=Math.abs((s._helper?s.offset.top-c.top:s.offset.top-u.top)+s.sizeDiff.height),n=s.containerElement.get(0)===s.element.parent().get(0),a=/relative|absolute/.test(s.containerElement.css("position")),n&&a&&(i-=Math.abs(s.parentData.left)),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,l&&(s.size.height=s.size.width/s.aspectRatio)),r+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-r,l&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var e=t(this).data("ui-resizable"),i=e.options,r=e.containerOffset,n=e.containerPosition,a=e.containerElement,s=t(e.helper),o=s.offset(),u=s.outerWidth()-e.sizeDiff.width,h=s.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(a.css("position"))&&t(this).css({left:o.left-n.left-r.left,width:u,height:h}),e._helper&&!i.animate&&/static/.test(a.css("position"))&&t(this).css({left:o.left-n.left-r.left,width:u,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,r=function(e){t(e).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?r(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],r(i.alsoResize)):t.each(i.alsoResize,function(t){r(t)})},resize:function(e,i){var r=t(this).data("ui-resizable"),n=r.options,a=r.originalSize,s=r.originalPosition,o={height:r.size.height-a.height||0,width:r.size.width-a.width||0,top:r.position.top-s.top||0,left:r.position.left-s.left||0},u=function(e,r){t(e).each(function(){var e=t(this),n=t(this).data("ui-resizable-alsoresize"),a={},s=r&&r.length?r:e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(s,function(t,e){var i=(n[e]||0)+(o[e]||0);i&&i>=0&&(a[e]=i||null)}),e.css(a)})};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?u(n.alsoResize):t.each(n.alsoResize,function(t,e){u(t,e)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,r=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("ui-resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("ui-resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("ui-resizable"),i=e.options,r=e.size,n=e.originalSize,a=e.originalPosition,s=e.axis,o="number"==typeof i.grid?[i.grid,i.grid]:i.grid,u=o[0]||1,h=o[1]||1,l=Math.round((r.width-n.width)/u)*u,c=Math.round((r.height-n.height)/h)*h,d=n.width+l,p=n.height+c,f=i.maxWidth&&i.maxWidth<d,g=i.maxHeight&&i.maxHeight<p,m=i.minWidth&&i.minWidth>d,v=i.minHeight&&i.minHeight>p;i.grid=o,m&&(d+=u),v&&(p+=h),f&&(d-=u),g&&(p-=h),/^(se|s|e)$/.test(s)?(e.size.width=d,e.size.height=p):/^(ne)$/.test(s)?(e.size.width=d,e.size.height=p,e.position.top=a.top-c):/^(sw)$/.test(s)?(e.size.width=d,e.size.height=p,e.position.left=a.left-l):(p-h>0?(e.size.height=p,e.position.top=a.top-c):(e.size.height=h,e.position.top=a.top+n.height-h),d-u>0?(e.size.width=d,e.position.left=a.left-l):(e.size.width=u,e.position.left=a.left+n.width-u))}})}(jQuery),function(t,e){t.widget("ui.selectable",t.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e=t(i.options.filter,i.element[0]),e.addClass("ui-selectee"),e.each(function(){var e=t(this),i=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:i.left,top:i.top,right:i.left+e.outerWidth(),bottom:i.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(e){var i=this,r=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(r.filter,this.element[0]),this._trigger("start",e),t(r.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=t.data(this,"selectable-item");r.startselected=!0,e.metaKey||e.ctrlKey||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",e,{unselecting:r.element}))}),t(e.target).parents().addBack().each(function(){var r,n=t.data(this,"selectable-item");return n?(r=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(r?"ui-unselecting":"ui-selected").addClass(r?"ui-selecting":"ui-unselecting"),n.unselecting=!r,n.selecting=r,n.selected=r,r?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,r=this,n=this.options,a=this.opos[0],s=this.opos[1],o=e.pageX,u=e.pageY;return a>o&&(i=o,o=a,a=i),s>u&&(i=u,u=s,s=i),this.helper.css({left:a,top:s,width:o-a,height:u-s}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1;i&&i.element!==r.element[0]&&("touch"===n.tolerance?h=!(i.left>o||i.right<a||i.top>u||i.bottom<s):"fit"===n.tolerance&&(h=i.left>a&&i.right<o&&i.top>s&&i.bottom<u),h?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,r._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),r._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var r=t.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,i._trigger("unselected",e,{unselected:r.element})}),t(".ui-selecting",this.element[0]).each(function(){var r=t.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,i._trigger("selected",e,{selected:r.element})}),this._trigger("stop",e),this.helper.remove(),!1}})}(jQuery),function(t,e){var i=5;t.widget("ui.slider",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,r=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",s=[];for(i=r.values&&r.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)s.push(a);this.handles=n.add(t(s.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,i="";e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var t=this.handles.add(this.range).filter("a");this._off(t),this._on(t,this._handleEvents),this._hoverable(t),this._focusable(t)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,r,n,a,s,o,u,h,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},r=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(r-l.values(e));(n>i||n===i&&(e===l._lastChangedValue||l.values(e)===c.min))&&(n=i,a=t(this),s=e)}),o=this._start(e,s),o===!1?!1:(this._mouseSliding=!0,this._handleIndex=s,a.addClass("ui-state-active").focus(),u=a.offset(),h=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-u.left-a.width()/2,top:e.pageY-u.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,s,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,r,n,a;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=i/e,r>1&&(r=1),0>r&&(r=0),"vertical"===this.orientation&&(r=1-r),n=this._valueMax()-this._valueMin(),a=this._valueMin()+r*n,this._trimAlignValue(a)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var r,n,a;this.options.values&&this.options.values.length?(r=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>r||1===e&&r>i)&&(i=r),i!==this.values(e)&&(n=this.values(),n[e]=i,a=this._trigger("slide",t,{handle:this.handles[e],value:i,values:n}),r=this.values(e?0:1),a!==!1&&this.values(e,i))):i!==this.value()&&(a=this._trigger("slide",t,{handle:this.handles[e],value:i}),a!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var r,n,a;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(r=this.options.values,n=arguments[0],a=0;a<r.length;a+=1)r[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(e,i){var r,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=0;n>r;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),
this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,r;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),r=0;r<i.length;r+=1)i[r]=this._trimAlignValue(i[r]);return i}return[]},_trimAlignValue:function(t){if(t<=this._valueMin())return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,r=t-i;return 2*Math.abs(i)>=e&&(r+=i>0?e:-e),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,r,n,a,s=this.options.range,o=this.options,u=this,h=this._animateOff?!1:o.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){i=(u.values(r)-u._valueMin())/(u._valueMax()-u._valueMin())*100,l["horizontal"===u.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](l,o.animate),u.options.range===!0&&("horizontal"===u.orientation?(0===r&&u.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},o.animate),1===r&&u.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:o.animate})):(0===r&&u.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},o.animate),1===r&&u.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:o.animate}))),e=i}):(r=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?(r-n)/(a-n)*100:0,l["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](l,o.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},o.animate),"max"===s&&"horizontal"===this.orientation&&this.range[h?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:o.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},o.animate),"max"===s&&"vertical"===this.orientation&&this.range[h?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:o.animate}))},_handleEvents:{keydown:function(e){var r,n,a,s,o=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(e.target).addClass("ui-state-active"),r=this._start(e,o),r===!1))return}switch(s=this.options.step,n=a=this.options.values&&this.options.values.length?this.values(o):this.value(),e.keyCode){case t.ui.keyCode.HOME:a=this._valueMin();break;case t.ui.keyCode.END:a=this._valueMax();break;case t.ui.keyCode.PAGE_UP:a=this._trimAlignValue(n+(this._valueMax()-this._valueMin())/i);break;case t.ui.keyCode.PAGE_DOWN:a=this._trimAlignValue(n-(this._valueMax()-this._valueMin())/i);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(n===this._valueMax())return;a=this._trimAlignValue(n+s);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n===this._valueMin())return;a=this._trimAlignValue(n-s)}this._slide(e,o,a)},click:function(t){t.preventDefault()},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}})}(jQuery),function(t,e){function i(t,e,i){return t>e&&e+i>t}function r(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||r(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var r=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,a.widgetName+"-item")===a?(r=t(this),!1):void 0}),t.data(e.target,a.widgetName+"-item")===a&&(r=t(e.target)),r&&(!this.options.handle||i||(t(this.options.handle,r).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n))?(this.currentItem=r,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(e,i,r){var n,a,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",s.cursor),this.storedStylesheet=t("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(a)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,r,n,a,s=this.options,o=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(e.pageY-t(document).scrollTop()<s.scrollSensitivity?o=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(o=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed)),e.pageX-t(document).scrollLeft()<s.scrollSensitivity?o=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(o=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed))),o!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(r=this.items[i],n=r.item[0],a=this._intersectsWithPointer(r),a&&r.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(e,r),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var r=this,n=this.placeholder.offset(),a=this.options.axis,s={};a&&"x"!==a||(s.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(s.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){r._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&r.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!r.length&&e.key&&r.push(e.key+"="),r.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},i.each(function(){r.push(t(e.item||this).attr(e.attribute||"id")||"")}),r},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,r=this.positionAbs.top,n=r+this.helperProportions.height,a=t.left,s=a+t.width,o=t.top,u=o+t.height,h=this.offset.click.top,l=this.offset.click.left,c="x"===this.options.axis||r+h>o&&u>r+h,d="y"===this.options.axis||e+l>a&&s>e+l,p=c&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:a<e+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&o<r+this.helperProportions.height/2&&n-this.helperProportions.height/2<u},_intersectsWithPointer:function(t){var e="x"===this.options.axis||i(this.positionAbs.top+this.offset.click.top,t.top,t.height),r="y"===this.options.axis||i(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=e&&r,a=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return n?this.floating?s&&"right"===s||"down"===a?2:1:a&&("down"===a?2:1):!1},_intersectsWithSides:function(t){var e=i(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=i(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return this.floating&&a?"right"===a&&r||"left"===a&&!r:n&&("down"===n&&e||"up"===n&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){o.push(this)}var r,n,a,s,o=[],u=[],h=this._connectWith();if(h&&e)for(r=h.length-1;r>=0;r--)for(a=t(h[r]),n=a.length-1;n>=0;n--)s=t.data(a[n],this.widgetFullName),s&&s!==this&&!s.options.disabled&&u.push([t.isFunction(s.options.items)?s.options.items.call(s.element):t(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(u.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=u.length-1;r>=0;r--)u[r][0].each(i);return t(o)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;i<e.length;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,r,n,a,s,o,u,h,l=this.items,c=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i]),r=n.length-1;r>=0;r--)a=t.data(n[r],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(c.push([t.isFunction(a.options.items)?a.options.items.call(a.element[0],e,{item:this.currentItem}):t(a.options.items,a.element),a]),this.containers.push(a));for(i=c.length-1;i>=0;i--)for(s=c[i][1],o=c[i][0],r=0,h=o.length;h>r;r++)u=t(o[r]),u.data(this.widgetName+"-item",s),l.push({item:u,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,r,n,a;for(i=this.items.length-1;i>=0;i--)r=this.items[i],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,r.item):r.item,e||(r.width=n.outerWidth(),r.height=n.outerHeight()),a=n.offset(),r.left=a.left,r.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,r=e.options;r.placeholder&&r.placeholder.constructor!==String||(i=r.placeholder,r.placeholder={element:function(){var r=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+r+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===r?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(n)}):"img"===r&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||r.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(r.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),r.placeholder.update(e,e.placeholder)},_contactContainers:function(e){var n,a,s,o,u,h,l,c,d,p,f=null,g=null;for(n=this.containers.length-1;n>=0;n--)if(!t.contains(this.currentItem[0],this.containers[n].element[0]))if(this._intersectsWith(this.containers[n].containerCache)){if(f&&t.contains(this.containers[n].element[0],f.element[0]))continue;f=this.containers[n],g=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",e,this._uiHash(this)),this.containers[n].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[g].containerCache.over||(this.containers[g]._trigger("over",e,this._uiHash(this)),this.containers[g].containerCache.over=1);else{for(s=1e4,o=null,p=f.floating||r(this.currentItem),u=p?"left":"top",h=p?"width":"height",l=this.positionAbs[u]+this.offset.click[u],a=this.items.length-1;a>=0;a--)t.contains(this.containers[g].element[0],this.items[a].item[0])&&this.items[a].item[0]!==this.currentItem[0]&&(!p||i(this.positionAbs.top+this.offset.click.top,this.items[a].top,this.items[a].height))&&(c=this.items[a].item.offset()[u],d=!1,Math.abs(c-l)>Math.abs(c+this.items[a][h]-l)&&(d=!0,c+=this.items[a][h]),Math.abs(c-l)<s&&(s=Math.abs(c-l),o=this.items[a],this.direction=d?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[g])return;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[g].element,!0),this._trigger("change",e,this._uiHash()),this.containers[g]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[g],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[g]._trigger("over",e,this._uiHash(this)),this.containers[g].containerCache.over=1}},_createHelper:function(e){var i=this.options,r=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||i.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||i.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,r,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),r="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(r?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(r?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var r="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*r}},_generatePosition:function(e){var i,r,n=this.options,a=e.pageX,s=e.pageY,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,u=/(html|body)/i.test(o[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/n.grid[1])*n.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,r=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-n.grid[0]:r+n.grid[0]:r)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():u?0:o.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():u?0:o.scrollLeft())}},_rearrange:function(t,e,i,r){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!r)})},_clear:function(t,e){function i(t,e,i){return function(r){i._trigger(t,r,e._uiHash(e))}}this.reverting=!1;var r,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)("auto"===this._storedCSS[r]||"static"===this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--)e||n.push(i("deactivate",this,this.containers[r])),this.containers[r].containerCache.over&&(n.push(i("out",this,this.containers[r])),this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),r=0;r<n.length;r++)n[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(r=0;r<n.length;r++)n[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})}(jQuery),function(t){function e(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.widget("ui.spinner",{version:"1.10.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e={},i=this.element;return t.each(["min","max","step"],function(t,r){var n=i.attr(r);void 0!==n&&n.length&&(e[r]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var t=this.element[0]===this.document[0].activeElement;t||(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r}))}var r;r=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var t=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=t.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*t.height())&&t.height()>0&&t.height(t.height()),this.options.disabled&&this.disable()},_keydown:function(e){var i=this.options,r=t.ui.keyCode;switch(e.keyCode){case r.UP:return this._repeat(null,1,e),!0;case r.DOWN:return this._repeat(null,-1,e),!0;case r.PAGE_UP:return this._repeat(null,i.page,e),!0;case r.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=t.toString(),i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,r=this.options;return e=null!==r.min?r.min:0,i=t-e,i=Math.round(i/r.step)*r.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==r.max&&t>r.max?r.max:null!==r.min&&t<r.min?r.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t));
},_setOption:function(t,e){if("culture"===t||"numberFormat"===t){var i=this._parse(this.element.val());return this.options[t]=e,void this.element.val(this._format(i))}("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),this._super(t,e),"disabled"===t&&(e?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:e(function(t){this._super(t),this._value(this.element.val())}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:e(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:e(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:e(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:e(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void e(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}})}(jQuery),function(t,e){function i(){return++n}function r(t){return t=t.cloneNode(!1),t.hash.length>1&&decodeURIComponent(t.href.replace(a,""))===decodeURIComponent(location.href.replace(a,""))}var n=0,a=/#.*$/;t.widget("ui.tabs",{version:"1.10.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var e=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(i.active):this.active=t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,r=location.hash.substring(1);return null===e&&(r&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===r?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=this.tabs.length?0:!1)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=i?!1:0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(this.document[0].activeElement).closest("li"),r=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:r++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,r--;break;case t.ui.keyCode.END:r=this.anchors.length-1;break;case t.ui.keyCode.HOME:r=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(r);case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(r===this.options.active?!1:r);default:return}e.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,n),e.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function r(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(r(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).focus(),t},_setOption:function(t,e){return"active"===t?void this._activate(e):"disabled"===t?void this._setupDisabled(e):(this._super(t,e),"collapsible"===t&&(this.element.toggleClass("ui-tabs-collapsible",e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),void("heightStyle"===t&&this._setupHeightStyle(e)))},_tabId:function(t){return t.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=t(),this.anchors.each(function(i,n){var a,s,o,u=t(n).uniqueId().attr("id"),h=t(n).closest("li"),l=h.attr("aria-controls");r(n)?(a=n.hash,s=e.element.find(e._sanitizeSelector(a))):(o=e._tabId(h),a="#"+o,s=e.element.find(a),s.length||(s=e._createPanel(o),s.insertAfter(e.panels[i-1]||e.tablist)),s.attr("aria-live","polite")),s.length&&(e.panels=e.panels.add(s)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":a.substring(1),"aria-labelledby":u}),s.attr("aria-labelledby",u)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var i,r=0;i=this.tabs[r];r++)e===!0||-1!==t.inArray(r,e)?t(i).addClass("ui-state-disabled").attr("aria-disabled","true"):t(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var i={click:function(t){t.preventDefault()}};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,r=this.element.parent();"fill"===e?(i=r.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),r=e.css("position");"absolute"!==r&&"fixed"!==r&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,r=this.active,n=t(e.currentTarget),a=n.closest("li"),s=a[0]===r[0],o=s&&i.collapsible,u=o?t():this._getPanelForTab(a),h=r.length?this._getPanelForTab(r):t(),l={oldTab:r,oldPanel:h,newTab:o?t():a,newPanel:u};e.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||s&&!i.collapsible||this._trigger("beforeActivate",e,l)===!1||(i.active=o?!1:this.tabs.index(a),this.active=s?t():a,this.xhr&&this.xhr.abort(),h.length||u.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),u.length&&this.load(this.tabs.index(a),e),this._toggle(e,l))},_toggle:function(e,i){function r(){a.running=!1,a._trigger("activate",e,i)}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),s.length&&a.options.show?a._show(s,a.options.show,r):(s.show(),r())}var a=this,s=i.newPanel,o=i.oldPanel;this.running=!0,o.length&&this.options.hide?this._hide(o,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o.hide(),n()),o.attr({"aria-expanded":"false","aria-hidden":"true"}),i.oldTab.attr("aria-selected","false"),s.length&&o.length?i.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr({"aria-expanded":"true","aria-hidden":"false"}),i.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(e){var i,r=this._findActive(e);r[0]!==this.active[0]&&(r.length||(r=this.active),i=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+t+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(i){var r=this.options.disabled;r!==!1&&(i===e?r=!1:(i=this._getIndex(i),r=t.isArray(r)?t.map(r,function(t){return t!==i?t:null}):t.map(this.tabs,function(t,e){return e!==i?e:null})),this._setupDisabled(r))},disable:function(i){var r=this.options.disabled;if(r!==!0){if(i===e)r=!0;else{if(i=this._getIndex(i),-1!==t.inArray(i,r))return;r=t.isArray(r)?t.merge([i],r).sort():[i]}this._setupDisabled(r)}},load:function(e,i){e=this._getIndex(e);var n=this,a=this.tabs.eq(e),s=a.find(".ui-tabs-anchor"),o=this._getPanelForTab(a),u={tab:a,panel:o};r(s[0])||(this.xhr=t.ajax(this._ajaxSettings(s,i,u)),this.xhr&&"canceled"!==this.xhr.statusText&&(a.addClass("ui-tabs-loading"),o.attr("aria-busy","true"),this.xhr.success(function(t){setTimeout(function(){o.html(t),n._trigger("load",i,u)},1)}).complete(function(t,e){setTimeout(function(){"abort"===e&&n.panels.stop(!1,!0),a.removeClass("ui-tabs-loading"),o.removeAttr("aria-busy"),t===n.xhr&&delete n.xhr},1)})))},_ajaxSettings:function(e,i,r){var n=this;return{url:e.attr("href"),beforeSend:function(e,a){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:a},r))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}})}(jQuery),function(t){function e(e,i){var r=(e.attr("aria-describedby")||"").split(/\s+/);r.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(r.join(" ")))}function i(e){var i=e.data("ui-tooltip-id"),r=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,r);-1!==n&&r.splice(n,1),e.removeData("ui-tooltip-id"),r=t.trim(r.join(" ")),r?e.attr("aria-describedby",r):e.removeAttr("aria-describedby")}var r=0;t.widget("ui.tooltip",{version:"1.10.4",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(e,i){var r=this;return"disabled"===e?(this[i?"_disable":"_enable"](),void(this.options[e]=i)):(this._super(e,i),void("content"===e&&t.each(this.tooltips,function(t,e){r._updateContent(e)})))},_disable:function(){var e=this;t.each(this.tooltips,function(i,r){var n=t.Event("blur");n.target=n.currentTarget=r[0],e.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,r=t(e?e.target:this.element).closest(this.options.items);r.length&&!r.data("ui-tooltip-id")&&(r.attr("title")&&r.data("ui-tooltip-title",r.attr("title")),r.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&r.parents().each(function(){var e,r=t(this);r.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),r.attr("title")&&(r.uniqueId(),i.parents[this.id]={element:this,title:r.attr("title")},r.attr("title",""))}),this._updateContent(r,e))},_updateContent:function(t,e){var i,r=this.options.content,n=this,a=e?e.type:null;return"string"==typeof r?this._open(e,t,r):(i=r.call(t[0],function(i){t.data("ui-tooltip-open")&&n._delay(function(){e&&(e.type=a),this._open(e,t,i)})}),void(i&&this._open(e,t,i)))},_open:function(i,r,n){function a(t){h.of=t,s.is(":hidden")||s.position(h)}var s,o,u,h=t.extend({},this.options.position);if(n){if(s=this._find(r),s.length)return void s.find(".ui-tooltip-content").html(n);r.is("[title]")&&(i&&"mouseover"===i.type?r.attr("title",""):r.removeAttr("title")),s=this._tooltip(r),e(r,s.attr("id")),s.find(".ui-tooltip-content").html(n),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:a}),a(i)):s.position(t.extend({of:r},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(u=this.delayedShow=setInterval(function(){s.is(":visible")&&(a(h.of),clearInterval(u))},t.fx.interval)),this._trigger("open",i,{tooltip:s}),o={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var i=t.Event(e);i.currentTarget=r[0],this.close(i,!0)}},remove:function(){this._removeTooltip(s)}},i&&"mouseover"!==i.type||(o.mouseleave="close"),i&&"focusin"!==i.type||(o.focusout="close"),this._on(!0,r,o)}},close:function(e){var r=this,n=t(e?e.currentTarget:this.element),a=this._find(n);this.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&n.attr("title",n.data("ui-tooltip-title")),i(n),a.stop(!0),this._hide(a,this.options.hide,function(){r._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete r.parents[e]}),this.closing=!0,this._trigger("close",e,{tooltip:a}),this.closing=!1)},_tooltip:function(e){var i="ui-tooltip-"+r++,n=t("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return t("<div>").addClass("ui-tooltip-content").appendTo(n),n.appendTo(this.document[0].body),this.tooltips[i]=e,n},_find:function(e){var i=e.data("ui-tooltip-id");return i?t("#"+i):t()},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,function(i,r){var n=t.Event("blur");n.target=n.currentTarget=r[0],e.close(n,!0),t("#"+i).remove(),r.data("ui-tooltip-title")&&(r.attr("title",r.data("ui-tooltip-title")),r.removeData("ui-tooltip-title"))})}})}(jQuery)},,,,,,,function(t,e,i){var r;/*! Hammer.JS - v2.0.4 - 2015-03-02
	 * http://hammerjs.github.io/
	 *
	 * Copyright (c) 2015 Jorik Tangelder;
	 * Licensed under the MIT license */
!function(n,a,s,o){"use strict";function u(t,e,i){return setTimeout(f(t,i),e)}function h(t,e,i){return Array.isArray(t)?(l(t,i[e],i),!0):!1}function l(t,e,i){var r;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==o)for(r=0;r<t.length;)e.call(i,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(i,t[r],r,t)}function c(t,e,i){for(var r=Object.keys(e),n=0;n<r.length;)(!i||i&&t[r[n]]===o)&&(t[r[n]]=e[r[n]]),n++;return t}function d(t,e){return c(t,e,!0)}function p(t,e,i){var r,n=e.prototype;r=t.prototype=Object.create(n),r.constructor=t,r._super=n,i&&c(r,i)}function f(t,e){return function(){return t.apply(e,arguments)}}function g(t,e){return typeof t==ft?t.apply(e?e[0]||o:o,e):t}function m(t,e){return t===o?e:t}function v(t,e,i){l(A(e),function(e){t.addEventListener(e,i,!1)})}function _(t,e,i){l(A(e),function(e){t.removeEventListener(e,i,!1)})}function b(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function x(t,e){return t.indexOf(e)>-1}function A(t){return t.trim().split(/\s+/g)}function y(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var r=0;r<t.length;){if(i&&t[r][i]==e||!i&&t[r]===e)return r;r++}return-1}function S(t){return Array.prototype.slice.call(t,0)}function C(t,e,i){for(var r=[],n=[],a=0;a<t.length;){var s=e?t[a][e]:t[a];y(n,s)<0&&r.push(t[a]),n[a]=s,a++}return i&&(r=e?r.sort(function(t,i){return t[e]>i[e]}):r.sort()),r}function w(t,e){for(var i,r,n=e[0].toUpperCase()+e.slice(1),a=0;a<dt.length;){if(i=dt[a],r=i?i+n:e,r in t)return r;a++}return o}function T(){return _t++}function M(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||n}function E(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){g(t.options.enable,[t])&&i.handler(e)},this.init()}function k(t){var e,i=t.options.inputClass;return new(e=i?i:At?j:yt?Q:xt?q:z)(t,I)}function I(t,e,i){var r=i.pointers.length,n=i.changedPointers.length,a=e&Et&&r-n===0,s=e&(It|Nt)&&r-n===0;i.isFirst=!!a,i.isFinal=!!s,a&&(t.session={}),i.eventType=e,N(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function N(t,e){var i=t.session,r=e.pointers,n=r.length;i.firstInput||(i.firstInput=P(e)),n>1&&!i.firstMultiple?i.firstMultiple=P(e):1===n&&(i.firstMultiple=!1);var a=i.firstInput,s=i.firstMultiple,o=s?s.center:a.center,u=e.center=D(r);e.timeStamp=vt(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=B(o,u),e.distance=V(o,u),R(i,e),e.offsetDirection=O(e.deltaX,e.deltaY),e.scale=s?G(s.pointers,r):1,e.rotation=s?U(s.pointers,r):0,F(i,e);var h=t.element;b(e.srcEvent.target,h)&&(h=e.srcEvent.target),e.target=h}function R(t,e){var i=e.center,r=t.offsetDelta||{},n=t.prevDelta||{},a=t.prevInput||{};(e.eventType===Et||a.eventType===It)&&(n=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=n.x+(i.x-r.x),e.deltaY=n.y+(i.y-r.y)}function F(t,e){var i,r,n,a,s=t.lastInterval||e,u=e.timeStamp-s.timeStamp;if(e.eventType!=Nt&&(u>Mt||s.velocity===o)){var h=s.deltaX-e.deltaX,l=s.deltaY-e.deltaY,c=L(u,h,l);r=c.x,n=c.y,i=mt(c.x)>mt(c.y)?c.x:c.y,a=O(h,l),t.lastInterval=e}else i=s.velocity,r=s.velocityX,n=s.velocityY,a=s.direction;e.velocity=i,e.velocityX=r,e.velocityY=n,e.direction=a}function P(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:gt(t.pointers[i].clientX),clientY:gt(t.pointers[i].clientY)},i++;return{timeStamp:vt(),pointers:e,center:D(e),deltaX:t.deltaX,deltaY:t.deltaY}}function D(t){var e=t.length;if(1===e)return{x:gt(t[0].clientX),y:gt(t[0].clientY)};for(var i=0,r=0,n=0;e>n;)i+=t[n].clientX,r+=t[n].clientY,n++;return{x:gt(i/e),y:gt(r/e)}}function L(t,e,i){return{x:e/t||0,y:i/t||0}}function O(t,e){return t===e?Rt:mt(t)>=mt(e)?t>0?Ft:Pt:e>0?Dt:Lt}function V(t,e,i){i||(i=Ut);var r=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return Math.sqrt(r*r+n*n)}function B(t,e,i){i||(i=Ut);var r=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return 180*Math.atan2(n,r)/Math.PI}function U(t,e){return B(e[1],e[0],Gt)-B(t[1],t[0],Gt)}function G(t,e){return V(e[0],e[1],Gt)/V(t[0],t[1],Gt)}function z(){this.evEl=jt,this.evWin=Ht,this.allow=!0,this.pressed=!1,E.apply(this,arguments)}function j(){this.evEl=Yt,this.evWin=qt,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function H(){this.evTarget=Kt,this.evWin=Jt,this.started=!1,E.apply(this,arguments)}function W(t,e){var i=S(t.touches),r=S(t.changedTouches);return e&(It|Nt)&&(i=C(i.concat(r),"identifier",!0)),[i,r]}function Q(){this.evTarget=$t,this.targetIds={},E.apply(this,arguments)}function Y(t,e){var i=S(t.touches),r=this.targetIds;if(e&(Et|kt)&&1===i.length)return r[i[0].identifier]=!0,[i,i];var n,a,s=S(t.changedTouches),o=[],u=this.target;if(a=i.filter(function(t){return b(t.target,u)}),e===Et)for(n=0;n<a.length;)r[a[n].identifier]=!0,n++;for(n=0;n<s.length;)r[s[n].identifier]&&o.push(s[n]),e&(It|Nt)&&delete r[s[n].identifier],n++;return o.length?[C(a.concat(o),"identifier",!0),o]:void 0}function q(){E.apply(this,arguments);var t=f(this.handler,this);this.touch=new Q(this.manager,t),this.mouse=new z(this.manager,t)}function X(t,e){this.manager=t,this.set(e)}function K(t){if(x(t,ae))return ae;var e=x(t,se),i=x(t,oe);return e&&i?se+" "+oe:e||i?e?se:oe:x(t,ne)?ne:re}function J(t){this.id=T(),this.manager=null,this.options=d(t||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=ue,this.simultaneous={},this.requireFail=[]}function Z(t){return t&pe?"cancel":t&ce?"end":t&le?"move":t&he?"start":""}function $(t){return t==Lt?"down":t==Dt?"up":t==Ft?"left":t==Pt?"right":""}function tt(t,e){var i=e.manager;return i?i.get(t):t}function et(){J.apply(this,arguments)}function it(){et.apply(this,arguments),this.pX=null,this.pY=null}function rt(){et.apply(this,arguments)}function nt(){J.apply(this,arguments),this._timer=null,this._input=null}function at(){et.apply(this,arguments)}function st(){et.apply(this,arguments)}function ot(){J.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ut(t,e){return e=e||{},e.recognizers=m(e.recognizers,ut.defaults.preset),new ht(t,e)}function ht(t,e){e=e||{},this.options=d(e,ut.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=k(this),this.touchAction=new X(this,this.options.touchAction),lt(this,!0),l(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function lt(t,e){var i=t.element;i.style&&l(t.options.cssProps,function(t,r){i.style[w(i.style,r)]=e?t:""})}function ct(t,e){var i=a.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}var dt=["","webkit","moz","MS","ms","o"],pt=a.createElement("div"),ft="function",gt=Math.round,mt=Math.abs,vt=Date.now,_t=1,bt=/mobile|tablet|ip(ad|hone|od)|android/i,xt="ontouchstart"in n,At=w(n,"PointerEvent")!==o,yt=xt&&bt.test(navigator.userAgent),St="touch",Ct="pen",wt="mouse",Tt="kinect",Mt=25,Et=1,kt=2,It=4,Nt=8,Rt=1,Ft=2,Pt=4,Dt=8,Lt=16,Ot=Ft|Pt,Vt=Dt|Lt,Bt=Ot|Vt,Ut=["x","y"],Gt=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(M(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&_(this.element,this.evEl,this.domHandler),this.evTarget&&_(this.target,this.evTarget,this.domHandler),this.evWin&&_(M(this.element),this.evWin,this.domHandler)}};var zt={mousedown:Et,mousemove:kt,mouseup:It},jt="mousedown",Ht="mousemove mouseup";p(z,E,{handler:function(t){var e=zt[t.type];e&Et&&0===t.button&&(this.pressed=!0),e&kt&&1!==t.which&&(e=It),this.pressed&&this.allow&&(e&It&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:wt,srcEvent:t}))}});var Wt={pointerdown:Et,pointermove:kt,pointerup:It,pointercancel:Nt,pointerout:Nt},Qt={2:St,3:Ct,4:wt,5:Tt},Yt="pointerdown",qt="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&(Yt="MSPointerDown",qt="MSPointerMove MSPointerUp MSPointerCancel"),p(j,E,{handler:function(t){var e=this.store,i=!1,r=t.type.toLowerCase().replace("ms",""),n=Wt[r],a=Qt[t.pointerType]||t.pointerType,s=a==St,o=y(e,t.pointerId,"pointerId");n&Et&&(0===t.button||s)?0>o&&(e.push(t),o=e.length-1):n&(It|Nt)&&(i=!0),0>o||(e[o]=t,this.callback(this.manager,n,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),i&&e.splice(o,1))}});var Xt={touchstart:Et,touchmove:kt,touchend:It,touchcancel:Nt},Kt="touchstart",Jt="touchstart touchmove touchend touchcancel";p(H,E,{handler:function(t){var e=Xt[t.type];if(e===Et&&(this.started=!0),this.started){var i=W.call(this,t,e);e&(It|Nt)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:St,srcEvent:t})}}});var Zt={touchstart:Et,touchmove:kt,touchend:It,touchcancel:Nt},$t="touchstart touchmove touchend touchcancel";p(Q,E,{handler:function(t){var e=Zt[t.type],i=Y.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:St,srcEvent:t})}}),p(q,E,{handler:function(t,e,i){var r=i.pointerType==St,n=i.pointerType==wt;if(r)this.mouse.allow=!1;else if(n&&!this.mouse.allow)return;e&(It|Nt)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var te=w(pt.style,"touchAction"),ee=te!==o,ie="compute",re="auto",ne="manipulation",ae="none",se="pan-x",oe="pan-y";X.prototype={set:function(t){t==ie&&(t=this.compute()),ee&&this.manager.element.style&&(this.manager.element.style[te]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return l(this.manager.recognizers,function(e){g(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),K(t.join(" "))},preventDefaults:function(t){if(!ee){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var r=this.actions,n=x(r,ae),a=x(r,oe),s=x(r,se);return n||a&&i&Ot||s&&i&Vt?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var ue=1,he=2,le=4,ce=8,de=ce,pe=16,fe=32;J.prototype={defaults:{},set:function(t){return c(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(h(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=tt(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return h(t,"dropRecognizeWith",this)?this:(t=tt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(h(t,"requireFailure",this))return this;var e=this.requireFail;return t=tt(t,this),-1===y(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(h(t,"dropRequireFailure",this))return this;t=tt(t,this);var e=y(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(i.options.event+(e?Z(r):""),t)}var i=this,r=this.state;ce>r&&e(!0),e(),r>=ce&&e(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=fe)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(fe|ue)))return!1;t++}return!0},recognize:function(t){var e=c({},t);return g(this.options.enable,[this,e])?(this.state&(de|pe|fe)&&(this.state=ue),this.state=this.process(e),void(this.state&(he|le|ce|pe)&&this.tryEmit(e))):(this.reset(),void(this.state=fe))},process:function(t){},getTouchAction:function(){},reset:function(){}},p(et,J,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,r=e&(he|le),n=this.attrTest(t);return r&&(i&Nt||!n)?e|pe:r||n?i&It?e|ce:e&he?e|le:he:fe}}),p(it,et,{defaults:{event:"pan",threshold:10,pointers:1,direction:Bt},getTouchAction:function(){var t=this.options.direction,e=[];return t&Ot&&e.push(oe),t&Vt&&e.push(se),e},directionTest:function(t){var e=this.options,i=!0,r=t.distance,n=t.direction,a=t.deltaX,s=t.deltaY;return n&e.direction||(e.direction&Ot?(n=0===a?Rt:0>a?Ft:Pt,i=a!=this.pX,r=Math.abs(t.deltaX)):(n=0===s?Rt:0>s?Dt:Lt,i=s!=this.pY,r=Math.abs(t.deltaY))),t.direction=n,i&&r>e.threshold&&n&e.direction},attrTest:function(t){return et.prototype.attrTest.call(this,t)&&(this.state&he||!(this.state&he)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=$(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),p(rt,et,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ae]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&he)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),p(nt,J,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[re]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,r=t.distance<e.threshold,n=t.deltaTime>e.time;if(this._input=t,!r||!i||t.eventType&(It|Nt)&&!n)this.reset();else if(t.eventType&Et)this.reset(),this._timer=u(function(){this.state=de,this.tryEmit()},e.time,this);else if(t.eventType&It)return de;return fe},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===de&&(t&&t.eventType&It?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=vt(),this.manager.emit(this.options.event,this._input)))}}),p(at,et,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ae]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&he)}}),p(st,et,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ot|Vt,pointers:1},getTouchAction:function(){return it.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(Ot|Vt)?e=t.velocity:i&Ot?e=t.velocityX:i&Vt&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&mt(e)>this.options.velocity&&t.eventType&It},emit:function(t){var e=$(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),p(ot,J,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[ne]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,r=t.distance<e.threshold,n=t.deltaTime<e.time;if(this.reset(),t.eventType&Et&&0===this.count)return this.failTimeout();if(r&&n&&i){if(t.eventType!=It)return this.failTimeout();var a=this.pTime?t.timeStamp-this.pTime<e.interval:!0,s=!this.pCenter||V(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,s&&a?this.count+=1:this.count=1,this._input=t;var o=this.count%e.taps;if(0===o)return this.hasRequireFailures()?(this._timer=u(function(){this.state=de,this.tryEmit()},e.interval,this),he):de}return fe},failTimeout:function(){return this._timer=u(function(){this.state=fe},this.options.interval,this),fe},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==de&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ut.VERSION="2.0.4",ut.defaults={domEvents:!1,touchAction:ie,enable:!0,inputTarget:null,inputClass:null,preset:[[at,{enable:!1}],[rt,{enable:!1},["rotate"]],[st,{direction:Ot}],[it,{direction:Ot},["swipe"]],[ot],[ot,{event:"doubletap",taps:2},["tap"]],[nt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ge=1,me=2;ht.prototype={set:function(t){return c(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?me:ge},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,r=this.recognizers,n=e.curRecognizer;(!n||n&&n.state&de)&&(n=e.curRecognizer=null);for(var a=0;a<r.length;)i=r[a],e.stopped===me||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(t),!n&&i.state&(he|le|ce)&&(n=e.curRecognizer=i),a++}},get:function(t){if(t instanceof J)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(h(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(h(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(y(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return l(A(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return l(A(t),function(t){e?i[t].splice(y(i[t],e),1):delete i[t]}),this},emit:function(t,e){this.options.domEvents&&ct(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<i.length;)i[r](e),r++}},destroy:function(){this.element&&lt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},c(ut,{INPUT_START:Et,INPUT_MOVE:kt,INPUT_END:It,INPUT_CANCEL:Nt,STATE_POSSIBLE:ue,STATE_BEGAN:he,STATE_CHANGED:le,STATE_ENDED:ce,STATE_RECOGNIZED:de,STATE_CANCELLED:pe,STATE_FAILED:fe,DIRECTION_NONE:Rt,DIRECTION_LEFT:Ft,DIRECTION_RIGHT:Pt,DIRECTION_UP:Dt,DIRECTION_DOWN:Lt,DIRECTION_HORIZONTAL:Ot,DIRECTION_VERTICAL:Vt,DIRECTION_ALL:Bt,Manager:ht,Input:E,TouchAction:X,TouchInput:Q,MouseInput:z,PointerEventInput:j,TouchMouseInput:q,SingleTouchInput:H,Recognizer:J,AttrRecognizer:et,Tap:ot,Pan:it,Swipe:st,Pinch:rt,Rotate:at,Press:nt,on:v,off:_,each:l,merge:d,extend:c,inherit:p,bindFn:f,prefixed:w}),"function"==ft&&i(283)?(r=function(){return ut}.call(e,i,e,t),!(r!==o&&(t.exports=r))):"undefined"!=typeof t&&t.exports?t.exports=ut:n[s]=ut}(window,document,"Hammer")},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e,i){var r,n,a;/**
	 * isMobile.js v0.4.0
	 *
	 * A simple library to detect Apple phones and tablets,
	 * Android phones and tablets, other mobile devices (like blackberry, mini-opera and windows phone),
	 * and any kind of seven inch device, via user agent sniffing.
	 *
	 * @author: Kai Mallea (kmallea@gmail.com)
	 *
	 * @license: http://creativecommons.org/publicdomain/zero/1.0/
	 */
!function(i){var s=/iPhone/i,o=/iPod/i,u=/iPad/i,h=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,l=/Android/i,c=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,d=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,p=/IEMobile/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,g=/BlackBerry/i,m=/BB10/i,v=/Opera Mini/i,_=/(CriOS|Chrome)(?=.*\bMobile\b)/i,b=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,x=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),A=function(t,e){return t.test(e)},y=function(t){var e=t||navigator.userAgent,i=e.split("[FBAN");return"undefined"!=typeof i[1]&&(e=i[0]),i=e.split("Twitter"),"undefined"!=typeof i[1]&&(e=i[0]),this.apple={phone:A(s,e),ipod:A(o,e),tablet:!A(s,e)&&A(u,e),device:A(s,e)||A(o,e)||A(u,e)},this.amazon={phone:A(c,e),tablet:!A(c,e)&&A(d,e),device:A(c,e)||A(d,e)},this.android={phone:A(c,e)||A(h,e),tablet:!A(c,e)&&!A(h,e)&&(A(d,e)||A(l,e)),device:A(c,e)||A(d,e)||A(h,e)||A(l,e)},this.windows={phone:A(p,e),tablet:A(f,e),device:A(p,e)||A(f,e)},this.other={blackberry:A(g,e),blackberry10:A(m,e),opera:A(v,e),firefox:A(b,e),chrome:A(_,e),device:A(g,e)||A(m,e)||A(v,e)||A(b,e)||A(_,e)},this.seven_inch=A(x,e),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window?this:void 0},S=function(){var t=new y;return t.Class=y,t};"undefined"!=typeof t&&t.exports&&"undefined"==typeof window?t.exports=y:"undefined"!=typeof t&&t.exports&&"undefined"!=typeof window?t.exports=S():(n=[],r=i.isMobile=S(),a="function"==typeof r?r.apply(e,n):r,!(void 0!==a&&(t.exports=a)))}(this)},,,,,function(t,e,i){i(290),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/user.jinja"]=function(){function t(t,e,i,r,n){var a=null,s=null,o="";try{t.getTemplate("skfb_front/macros/buttons.jinja",!1,"skfb_front/macros/user.jinja",function(u,h){return u?void n(u):void h.getExported(function(u,h){if(u)return void n(u);if(!h.hasOwnProperty("follow_button"))return void n(new Error("cannot import 'follow_button'"));var l=h.follow_button;e.setVariable("follow_button",l),o+="\n\n";var c=r.makeMacro(["authUser","user"],["options"],function(n,a,s){i=i.push(),s=s||{},s.hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("authUser",n),i.set("user",a),i.set("options",s.hasOwnProperty("options")?s.options:{});var o="";if(o+='\n\n    <a class="user-name" href="',o+=r.suppressValue(r.memberLookup(a,"profileUrl",t.opts.autoescape),t.opts.autoescape),o+='"',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"target",t.opts.autoescape)&&(o+=' target="',o+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"target",t.opts.autoescape),t.opts.autoescape),o+='"'),o+='>\n\n        <div class="wrapper ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withSummary",t.opts.autoescape)&&(o+='js-summary-trigger" data-user-summary-anchor=".user-summary-anchor.avatar[data-user=\'',o+=r.suppressValue(r.memberLookup(a,"uid",t.opts.autoescape),t.opts.autoescape),o+="']"),o+='" data-user="',o+=r.suppressValue(r.memberLookup(a,"uid",t.opts.autoescape),t.opts.autoescape),o+='">\n            <data itemprop="url" value="',o+=r.suppressValue(r.memberLookup(a,"profileUrl",t.opts.autoescape),t.opts.autoescape),o+='"></data>\n            ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withAvatar",t.opts.autoescape)){if(o+='\n                <div class="avatar ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withSummary",t.opts.autoescape)&&(o+="user-summary-anchor"),o+='" data-user="',o+=r.suppressValue(r.memberLookup(a,"uid",t.opts.autoescape),t.opts.autoescape),o+='">\n                    ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"avatarWidth",t.opts.autoescape)){o+="\n                        ";var u;u=r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"avatarWidth",t.opts.autoescape),i.set("avatarWidth",u,!0),i.parent||(e.setVariable("avatarWidth",u),e.addExport("avatarWidth")),o+="\n                    "}else{o+="\n                        ";var h;h=20,i.set("avatarWidth",h,!0),i.parent||(e.setVariable("avatarWidth",h),e.addExport("avatarWidth")),o+="\n                    "}if(o+="\n                    ",r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"avatarHeight",t.opts.autoescape)){o+="\n                        ";var l;l=r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"avatarHeight",t.opts.autoescape),i.set("avatarHeight",l,!0),i.parent||(e.setVariable("avatarHeight",l),e.addExport("avatarHeight")),o+="\n                    "}else{o+="\n                        ";var c;c=r.contextOrFrameLookup(e,i,"avatarWidth"),i.set("avatarHeight",c,!0),i.parent||(e.setVariable("avatarHeight",c),e.addExport("avatarHeight")),o+="\n                    "}o+="\n                    ",o+=r.suppressValue(t.getFilter("image_container").call(e,r.memberLookup(a,"avatars",t.opts.autoescape),r.contextOrFrameLookup(e,i,"avatarWidth"),r.contextOrFrameLookup(e,i,"avatarHeight")),t.opts.autoescape),o+="\n                </div>\n            "}return o+='\n\n            <div class="text">\n                ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"by",t.opts.autoescape)&&(o+="by"),o+='\n                <div class="username-wrapper" itemprop="name">',o+=r.suppressValue(r.memberLookup(a,"displayName",t.opts.autoescape),t.opts.autoescape),o+="</div>\n            </div>\n            ",r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withoutBadge",t.opts.autoescape)||(o+="\n                ","pro"==r.memberLookup(a,"account",t.opts.autoescape)?o+='\n                    <span class="flag flag-pro">Pro</span>\n                ':"biz"==r.memberLookup(a,"account",t.opts.autoescape)&&(o+='\n                    <span class="flag flag-biz">Pro</span>\n                '),o+="\n            "),o+="\n\n        </div>\n\n    </a>\n\n",i=i.pop(),new r.SafeString(o)});e.addExport("user_name"),e.setVariable("user_name",c),o+="\n\n\n";var d=r.makeMacro(["avatars"],["options"],function(n,a){i=i.push(),a=a||{},a.hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("avatars",n),i.set("options",a.hasOwnProperty("options")?a.options:{});var s="";s+="\n\n    ";var o;return o=t.getFilter("merge").call(e,{size:32,expand:!1},r.contextOrFrameLookup(e,i,"options")),i.set("options",o,!0),i.parent||(e.setVariable("options",o),e.addExport("options")),s+="\n    ",s+=r.suppressValue(t.getFilter("image_container").call(e,n,r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"size",t.opts.autoescape),r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"size",t.opts.autoescape),r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"expand",t.opts.autoescape)),t.opts.autoescape),s+="\n\n",i=i.pop(),new r.SafeString(s)});e.addExport("user_avatar"),e.setVariable("user_avatar",d),o+="\n\n\n",o+="\n";var p=r.makeMacro(["authUser","user"],["options"],function(n,a,s){i=i.push(),s=s||{},s.hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("authUser",n),i.set("user",a),i.set("options",s.hasOwnProperty("options")?s.options:{});var o="";return(r.memberLookup(a,"city",t.opts.autoescape)||r.memberLookup(a,"country",t.opts.autoescape))&&(r.memberLookup(a,"city",t.opts.autoescape)&&(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"microData",t.opts.autoescape)&&(o+='<data itemprop="addressLocality">'),o+=r.suppressValue(r.memberLookup(a,"city",t.opts.autoescape),t.opts.autoescape),r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"microData",t.opts.autoescape)&&(o+="</data>"),r.memberLookup(a,"country",t.opts.autoescape)&&(o+=",")),o+=" ",r.memberLookup(a,"country",t.opts.autoescape)&&(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"microData",t.opts.autoescape)&&(o+='<data itemprop="addressCountry">'),o+=r.suppressValue(r.memberLookup(a,"country",t.opts.autoescape),t.opts.autoescape),r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"microData",t.opts.autoescape)&&(o+="</data>"))),i=i.pop(),new r.SafeString(o)});e.addExport("user_location_plaintext"),e.setVariable("user_location_plaintext",p),o+="\n\n";var f=r.makeMacro(["authUser","user"],["options"],function(n,o,u){i=i.push(),u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("user",o),i.set("options",u.hasOwnProperty("options")?u.options:{});var h="";if(h+="\n\n    ",""!=(a=56,s=31,r.callWrap(p,"user_location_plaintext",[n,o,r.contextOrFrameLookup(e,i,"options")]))){h+="\n\n        ";var l;l=t.getFilter("merge").call(e,{microData:!0},r.contextOrFrameLookup(e,i,"options")),i.set("options",l,!0),i.parent||(e.setVariable("options",l),e.addExport("options")),h+='\n\n        <i class="fa fa-map-marker"></i>\n        <data itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">\n            <data itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">\n            ',h+=r.suppressValue((a=63,s=36,r.callWrap(p,"user_location_plaintext",[n,o,r.contextOrFrameLookup(e,i,"options")])),t.opts.autoescape),h+="\n            </data>\n        </data>\n    "}return h+="\n\n",i=i.pop(),new r.SafeString(h)});e.addExport("user_location"),e.setVariable("user_location",f),o+="\n\n";var g=r.makeMacro(["authUser","user"],["options"],function(n,o,u){i=i.push(),u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("user",o),i.set("options",u.hasOwnProperty("options")?u.options:{});var h="";return h+='\n\n    <div class="user-smallcard" data-link="',h+=r.suppressValue(r.memberLookup(o,"profileUrl",t.opts.autoescape),t.opts.autoescape),h+='">\n\n        <div class="card-user-avatar ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withSummary",t.opts.autoescape)&&(h+="js-summary-trigger"),h+='" data-user="',h+=r.suppressValue(r.memberLookup(o,"uid",t.opts.autoescape),t.opts.autoescape),h+='">\n            ',h+=r.suppressValue(t.getFilter("image_container").call(e,r.memberLookup(o,"avatars",t.opts.autoescape),60,60),t.opts.autoescape),h+='\n        </div>\n\n        <div class="card-user-meta">\n            <div class="card-user-name">\n                ',h+=r.suppressValue((a=80,s=26,r.callWrap(c,"user_name",[n,o])),t.opts.autoescape),h+='\n            </div>\n            <div class="card-user-stats">\n                <div class="smallcard-user-follower-count">\n                    ',h+=r.suppressValue(t.getFilter("default").call(e,r.memberLookup(o,"followerCount",t.opts.autoescape),0),t.opts.autoescape),h+=' Followers\n                </div>\n                <div class="smallcard-user-model-count">\n                    ',h+=r.suppressValue(t.getFilter("default").call(e,r.memberLookup(o,"modelCount",t.opts.autoescape),0),t.opts.autoescape),h+=" Models\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n",i=i.pop(),new r.SafeString(h)});e.addExport("user_smallcard"),e.setVariable("user_smallcard",g),o+="\n\n";var m=r.makeMacro(["authUser","user"],["options"],function(n,o,u){i=i.push(),u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("user",o),i.set("options",u.hasOwnProperty("options")?u.options:{});var h="";h+="\n\n    ";var d;if(d=t.getFilter("merge").call(e,{withSkills:!0,withRelated:!0},r.contextOrFrameLookup(e,i,"options")),i.set("options",d,!0),i.parent||(e.setVariable("options",d),e.addExport("options")),h+='\n\n    <div class="card-user" data-link="',h+=r.suppressValue(r.memberLookup(o,"profileUrl",t.opts.autoescape),t.opts.autoescape),h+='">\n\n        <div class="card-user-avatar ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withSummary",t.opts.autoescape)&&(h+="js-summary-trigger"),h+='" data-user="',h+=r.suppressValue(r.memberLookup(o,"uid",t.opts.autoescape),t.opts.autoescape),h+='">\n            ',h+=r.suppressValue(t.getFilter("image_container").call(e,r.memberLookup(o,"avatars",t.opts.autoescape),90,90,!1,!1,!0),t.opts.autoescape),h+='\n        </div>\n        <div class="card-user-meta">\n            <div class="card-user-name">\n                ',h+=r.suppressValue((a=107,s=26,r.callWrap(c,"user_name",[n,o])),t.opts.autoescape),h+='\n            </div>\n            <div class="card-user-location">\n                ',(r.memberLookup(o,"city",t.opts.autoescape)||r.memberLookup(o,"country",t.opts.autoescape))&&(h+="\n                    ",h+=r.suppressValue((a=111,s=34,r.callWrap(f,"user_location",[n,o])),t.opts.autoescape),h+="\n                "),h+='\n            </div>\n            <div class="card-user-stats">\n                ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withFollow",t.opts.autoescape)&&r.memberLookup(n,"uid",t.opts.autoescape)!=r.memberLookup(o,"uid",t.opts.autoescape)&&(h+="\n                    ",h+=r.suppressValue((a=116,s=34,r.callWrap(l,"follow_button",[n,o])),t.opts.autoescape),h+="\n                "),h+='\n                <div class="card-user-metrics-container">\n                    <div class="card-user-follower-count help">\n                        <span>',h+=r.suppressValue(r.memberLookup(o,"followerCount",t.opts.autoescape),t.opts.autoescape),h+='</span>\n                        <div class="tooltip tooltip-up">Followers</div>\n                    </div>\n                    <div class="card-user-model-count help">\n                        ',h+=r.suppressValue(r.memberLookup(o,"modelCount",t.opts.autoescape),t.opts.autoescape),h+='\n                        <div class="tooltip tooltip-up">Models</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withSkills",t.opts.autoescape)){h+='\n            <div class="card-user-skills">\n                <ul class="item-list list-monoline list-static"><!--\n                    ',i=i.push();var p=r.memberLookup(o,"skills",t.opts.autoescape);if(p)for(var g=p.length,m=0;m<p.length;m++){var v=p[m];i.set("skill",v),i.set("loop.index",m+1),i.set("loop.index0",m),i.set("loop.revindex",g-m),i.set("loop.revindex0",g-m-1),i.set("loop.first",0===m),i.set("loop.last",m===g-1),i.set("loop.length",g),h+='\n                        --><li class="item">',h+=r.suppressValue(r.memberLookup(v,"name",t.opts.autoescape),t.opts.autoescape),h+="</li><!--\n                    "}i=i.pop(),h+="\n                --></ul>\n            </div>\n        "}if(h+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withRelated",t.opts.autoescape)){h+='\n            <div class="card-user-examples">\n                <a class="overlay btn-container" href="',h+=r.suppressValue(r.memberLookup(o,"profileUrl",t.opts.autoescape),t.opts.autoescape),h+='">\n                    <div class="button btn-small btn-primary">View full profile</div>\n                </a>\n                <ul class="card-user-models"><!--\n                    ',i=i.push();var _=t.getFilter("fill_null").call(e,t.getFilter("first_n").call(e,r.memberLookup(o,"thumbnails",t.opts.autoescape),3),3);if(_)for(var b=_.length,x=0;x<_.length;x++){var A=_[x];i.set("thumb",A),i.set("loop.index",x+1),i.set("loop.index0",x),i.set("loop.revindex",b-x),i.set("loop.revindex0",b-x-1),i.set("loop.first",0===x),i.set("loop.last",x===b-1),i.set("loop.length",b),h+="\n                        --><li>",h+=r.suppressValue(t.getFilter("image_container").call(e,A,153,88,!0,!1,!0),t.opts.autoescape),h+="</li><!--\n                    "}i=i.pop(),h+="\n                --></ul>\n            </div>\n        "}return h+="\n\n    </div>\n\n",i=i.pop(),new r.SafeString(h)});e.addExport("user_card"),e.setVariable("user_card",m),o+="\n\n";var v=r.makeMacro(["authUser","user"],["options"],function(n,o,u){i=i.push(),u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("user",o),i.set("options",u.hasOwnProperty("options")?u.options:{});var h="";h+='\n\n    <div class="user">\n        <a href="/',h+=r.suppressValue(r.memberLookup(o,"username",t.opts.autoescape),t.opts.autoescape),h+='">\n        ',h+=r.suppressValue((a=162,s=20,r.callWrap(d,"user_avatar",[r.memberLookup(o,"avatars",t.opts.autoescape),{size:104}])),t.opts.autoescape),h+='\n        </a>\n        <div class="info">\n            <p class="name" title="',h+=r.suppressValue(r.memberLookup(o,"displayName",t.opts.autoescape),t.opts.autoescape),h+='"><a href="/',h+=r.suppressValue(r.memberLookup(o,"username",t.opts.autoescape),t.opts.autoescape),h+='">',h+=r.suppressValue(r.memberLookup(o,"displayName",t.opts.autoescape),t.opts.autoescape),h+='</a></p>\n            <p class="tagline" title="',h+=r.suppressValue(r.memberLookup(o,"tagline",t.opts.autoescape),t.opts.autoescape),h+='"><a href="/',h+=r.suppressValue(r.memberLookup(o,"username",t.opts.autoescape),t.opts.autoescape),h+='">',h+=r.suppressValue(r.memberLookup(o,"tagline",t.opts.autoescape),t.opts.autoescape),h+="</a></p>\n            ",0!=r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"followButton",t.opts.autoescape)&&r.memberLookup(n,"uid",t.opts.autoescape)!=r.memberLookup(o,"uid",t.opts.autoescape)&&(h+='\n                <div class="follow-wrapper">\n                    ',h+=r.suppressValue((a=169,s=34,r.callWrap(l,"follow_button",[n,o])),t.opts.autoescape),h+='\n                    <p class="follow-count"><a href="/',h+=r.suppressValue(r.memberLookup(o,"username",t.opts.autoescape),t.opts.autoescape),h+='/followers"><span>',h+=r.suppressValue(r.memberLookup(o,"followerCount",t.opts.autoescape),t.opts.autoescape),h+="</span> followers</a></p>\n                </div>\n            "),h+='\n        </div>\n    </div>\n    <div class="models">',i=i.push();var c=t.getFilter("first_n").call(e,r.memberLookup(o,"thumbnails",t.opts.autoescape),3);if(c)for(var p=c.length,f=0;f<c.length;f++){var g=c[f];i.set("thumb",g),i.set("loop.index",f+1),i.set("loop.index0",f),i.set("loop.revindex",p-f),i.set("loop.revindex0",p-f-1),i.set("loop.first",0===f),i.set("loop.last",f===p-1),i.set("loop.length",p),h+='\n            <a href="',h+=r.suppressValue(r.memberLookup(g,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='">\n                ',h+=r.suppressValue(t.getFilter("image_container").call(e,r.memberLookup(g,"thumbnail",t.opts.autoescape),133,88,!1),t.opts.autoescape),h+="\n            </a>\n        "}return i=i.pop(),h+='\n    </div>\n    <div class="stats">\n        <p class="model-count">',h+=r.suppressValue(r.memberLookup(o,"modelCount",t.opts.autoescape),t.opts.autoescape),h+=" model",h+=r.suppressValue(t.getFilter("pluralize").call(e,r.memberLookup(o,"modelCount",t.opts.autoescape)),t.opts.autoescape),h+='</p>\n        <p class="view-count">',h+=r.suppressValue(t.getFilter("humanize_number").call(e,r.memberLookup(r.memberLookup(o,"stats",t.opts.autoescape),"view_count",t.opts.autoescape)),t.opts.autoescape),h+=" view",h+=r.suppressValue(t.getFilter("pluralize").call(e,r.memberLookup(r.memberLookup(o,"stats",t.opts.autoescape),"view_count",t.opts.autoescape)),t.opts.autoescape),h+='</p>\n        <p class="like-count">',h+=r.suppressValue(t.getFilter("humanize_number").call(e,r.memberLookup(r.memberLookup(o,"stats",t.opts.autoescape),"like_count",t.opts.autoescape)),t.opts.autoescape),h+=" like",h+=r.suppressValue(t.getFilter("pluralize").call(e,r.memberLookup(r.memberLookup(o,"stats",t.opts.autoescape),"like_count",t.opts.autoescape)),t.opts.autoescape),h+="</p>\n    </div>\n\n",i=i.pop(),new r.SafeString(h)});e.addExport("user_summary"),e.setVariable("user_summary",v),o+="\n\n";var _=r.makeMacro(["authUser","followSuggestion","cloaked"],["options"],function(n,o,u,h){i=i.push(),h=h||{},h.hasOwnProperty("caller")&&i.set("caller",h.caller),i.set("authUser",n),i.set("followSuggestion",o),i.set("cloaked",u),i.set("options",h.hasOwnProperty("options")?h.options:{});var c="";return c+="\n\n\n    ",c+=r.suppressValue(t.getFilter("image_container").call(e,r.memberLookup(o,"avatars",t.opts.autoescape),64,64),t.opts.autoescape),c+='\n\n    <div class="info">\n        <p class="name">',c+=r.suppressValue(r.memberLookup(o,"displayName",t.opts.autoescape),t.opts.autoescape),c+='</p>\n        <p class="stats">',c+=r.suppressValue(t.getFilter("humanize_number").call(e,r.memberLookup(o,"followerCount",t.opts.autoescape)),t.opts.autoescape),c+=" follower",c+=r.suppressValue(t.getFilter("pluralize").call(e,r.memberLookup(o,"followerCount",t.opts.autoescape)),t.opts.autoescape),c+=", ",c+=r.suppressValue(t.getFilter("humanize_number").call(e,r.memberLookup(o,"modelCount",t.opts.autoescape)),t.opts.autoescape),c+=" model",c+=r.suppressValue(t.getFilter("pluralize").call(e,r.memberLookup(o,"modelCount",t.opts.autoescape)),t.opts.autoescape),c+=" </p>\n    </div>\n\n    ",r.memberLookup(n,"uid",t.opts.autoescape)!=r.memberLookup(o,"uid",t.opts.autoescape)&&(c+="\n        ",c+=r.suppressValue((a=201,s=22,r.callWrap(l,"follow_button",[n,o])),t.opts.autoescape),c+="\n    "),c+="\n\n",i=i.pop(),new r.SafeString(c)});e.addExport("follow_suggestion_large"),e.setVariable("follow_suggestion_large",_),o+="\n\n";var b=r.makeMacro(["authUser","followSuggestion","cloaked"],["options"],function(n,o,u,h){i=i.push(),h=h||{},h.hasOwnProperty("caller")&&i.set("caller",h.caller),i.set("authUser",n),i.set("followSuggestion",o),i.set("cloaked",u),i.set("options",h.hasOwnProperty("options")?h.options:{});var c="";return c+='\n\n    <span class="js-summary-trigger avatar-container" data-user="',c+=r.suppressValue(r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"uid",t.opts.autoescape),t.opts.autoescape),c+='">\n        ',c+=r.suppressValue(t.getFilter("image_container").call(e,r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"avatars",t.opts.autoescape),64,64),t.opts.autoescape),c+='\n    </span>\n\n    <div class="info">\n        <p class="name js-summary-trigger" data-user="',c+=r.suppressValue(r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"uid",t.opts.autoescape),t.opts.autoescape),c+='" data-user-summary-anchor=".avatar-container[data-user=\'',c+=r.suppressValue(r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"uid",t.opts.autoescape),t.opts.autoescape),c+="']\">",c+=r.suppressValue(r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"displayName",t.opts.autoescape),t.opts.autoescape),c+='</p>\n        <p class="stats">',c+=r.suppressValue(t.getFilter("humanize_number").call(e,r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"followerCount",t.opts.autoescape)),t.opts.autoescape),c+=" follower",c+=r.suppressValue(t.getFilter("pluralize").call(e,r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"followerCount",t.opts.autoescape)),t.opts.autoescape),c+=", ",c+=r.suppressValue(t.getFilter("humanize_number").call(e,r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"modelCount",t.opts.autoescape)),t.opts.autoescape),c+=" model",c+=r.suppressValue(t.getFilter("pluralize").call(e,r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"modelCount",t.opts.autoescape)),t.opts.autoescape),c+=" </p>\n    </div>\n\n    ",r.memberLookup(n,"uid",t.opts.autoescape)!=r.memberLookup(r.memberLookup(o,"user",t.opts.autoescape),"uid",t.opts.autoescape)&&(c+="\n        ",c+=r.suppressValue((a=218,s=22,r.callWrap(l,"follow_button",[n,r.memberLookup(o,"user",t.opts.autoescape)])),t.opts.autoescape),c+="\n    "),c+='\n\n    <div class="reason">\n        <p>',c+=r.suppressValue(t.getFilter("print_suggestion_verb").call(e,r.memberLookup(o,"verb",t.opts.autoescape),r.memberLookup(o,"user",t.opts.autoescape)),t.opts.autoescape),c+=" ",c+=r.suppressValue(t.getFilter("print_suggestion_target").call(e,r.memberLookup(o,"target",t.opts.autoescape),r.memberLookup(o,"verb",t.opts.autoescape)),t.opts.autoescape),c+="</p>\n    </div>\n\n",i=i.pop(),new r.SafeString(c)});e.addExport("follow_suggestion_reason"),e.setVariable("follow_suggestion_reason",b),o+="\n\n";var x=r.makeMacro(["authUser","followSuggestion","cloaked"],["options"],function(n,o,u,h){i=i.push(),h=h||{},h.hasOwnProperty("caller")&&i.set("caller",h.caller),i.set("authUser",n),i.set("followSuggestion",o),i.set("cloaked",u),i.set("options",h.hasOwnProperty("options")?h.options:{});var d="";return d+='\n\n    <li class="follow-item',u&&(d+=" cloaked"),d+='" data-user="',d+=r.suppressValue(r.memberLookup(o,"uid",t.opts.autoescape),t.opts.autoescape),d+='">\n\n        ',d+=r.suppressValue((a=231,s=18,r.callWrap(c,"user_name",[n,o,r.makeKeywordArgs({options:{withAvatar:!0,withSummary:r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"withSummary",t.opts.autoescape),avatarHeight:32,avatarWidth:32}})])),t.opts.autoescape),d+="\n\n        ",r.memberLookup(n,"uid",t.opts.autoescape)!=r.memberLookup(o,"uid",t.opts.autoescape)&&(d+="\n\n            ",d+=r.suppressValue((a=240,s=26,r.callWrap(l,"follow_button",[r.contextOrFrameLookup(e,i,"user"),o])),t.opts.autoescape),d+="\n\n        "),d+="\n\n    </li>\n\n",i=i.pop(),new r.SafeString(d)});e.addExport("follow_suggestion"),e.setVariable("follow_suggestion",x),o+="\n\n";var A=r.makeMacro(["authUser","followSuggestions"],["options"],function(n,o,u){i=i.push(),u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("followSuggestions",o),i.set("options",u.hasOwnProperty("options")?u.options:{});var h="";h+='\n\n    <div class="sidebar-box suggested-follow',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"container_class",t.opts.autoescape)&&(h+=" ",h+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"container_class",t.opts.autoescape),t.opts.autoescape)),h+='">\n        <h5 class="sidebar-title">',h+=r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"title",t.opts.autoescape)?r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"title",t.opts.autoescape),t.opts.autoescape):"Who to follow ",h+="</h5>\n        <ul>\n\n            ";var l;if(l=t.getFilter("length").call(e,o),i.set("suggestionsCount",l,!0),i.parent||(e.setVariable("suggestionsCount",l),e.addExport("suggestionsCount")),h+="\n\n            ",r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"maxSuggestions",t.opts.autoescape)){h+="\n                ";var c;c=r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"maxSuggestions",t.opts.autoescape),i.set("max",c,!0),i.parent||(e.setVariable("max",c),e.addExport("max")),h+="\n            "}else{h+="\n                ";var d;d=r.contextOrFrameLookup(e,i,"suggestionsCount"),i.set("max",d,!0),i.parent||(e.setVariable("max",d),e.addExport("max")),h+="\n            "}h+="\n\n            ",i=i.push();var p=o;if(p)for(var f=p.length,g=0;g<p.length;g++){var m=p[g];i.set("following",m),i.set("loop.index",g+1),i.set("loop.index0",g),i.set("loop.revindex",f-g),i.set("loop.revindex0",f-g-1),i.set("loop.first",0===g),i.set("loop.last",g===f-1),i.set("loop.length",f),h+="\n\n                ",h+=r.suppressValue((a=264,s=34,r.callWrap(x,"follow_suggestion",[n,m,r.memberLookup(r.contextOrFrameLookup(e,i,"loop"),"index",t.opts.autoescape)>r.contextOrFrameLookup(e,i,"max"),r.contextOrFrameLookup(e,i,"options")])),t.opts.autoescape),h+="\n\n            "}return i=i.pop(),h+='\n        </ul>\n\n        <a href="#" class="show-more" data-action="show-more"><i class="icon fa fa-plus"></i> Show More</i></a>\n\n    </div>\n\n',i=i.pop(),new r.SafeString(h)});e.addExport("follow_suggestions"),e.setVariable("follow_suggestions",A),o+="\n",n(null,o)})})}catch(u){n(r.handleError(u,a,s))}}return{root:t}}()}()},function(t,e,i){i(291),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/buttons.jinja"]=function(){function t(t,e,i,r,n){var a=null,s=null,o="";try{t.getTemplate("skfb_front/macros/popovers.jinja",!1,"skfb_front/macros/buttons.jinja",function(u,h){return u?void n(u):void h.getExported(function(u,h){if(u)return void n(u);if(!h.hasOwnProperty("share_popover"))return void n(new Error("cannot import 'share_popover'"));var l=h.share_popover;e.setVariable("share_popover",l),o+="\n\n";var c=r.makeMacro(["authUser","user"],["options"],function(e,n,a){i=i.push(),a=a||{},a.hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("authUser",e),i.set("user",n),i.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return s+='\n\n    <span class="toggle-button follow-button btn-loading" data-action="follow" data-user="',s+=r.suppressValue(r.memberLookup(n,"uid",t.opts.autoescape),t.opts.autoescape),s+='">\n        <a class="button btn-primary toggle btn-disabled">\n            <i class="icon fa fa-plus"></i>\n            Follow\n        </a>\n        <a class="button btn-important untoggle">\n            <span class="toggled">\n                Following\n            </span>\n            <span class="untoggled">\n                Unfollow\n            </span>\n        </a>\n    </span>\n\n',i=i.pop(),new r.SafeString(s)});e.addExport("follow_button"),e.setVariable("follow_button",c),o+="\n\n";var d=r.makeMacro(["authUser"],["options"],function(n,o){i=i.push(),o=o||{},o.hasOwnProperty("caller")&&i.set("caller",o.caller),i.set("authUser",n),i.set("options",o.hasOwnProperty("options")?o.options:{});var u="";return u+='\n\n    <div class="button btn-medium btn-secondary btn-loading like like-button popover-container btn-disabled" data-action="like-model">\n        <i class="icon fa fa-star"></i>\n        Like\n        ',r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"popover",t.opts.autoescape),"display",t.opts.autoescape)&&(u+="\n            ",u+=r.suppressValue((a=27,s=26,r.callWrap(l,"share_popover",[{"class":r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"popover",t.opts.autoescape),"arrow",t.opts.autoescape)}])),t.opts.autoescape),u+="\n        "),u+="\n    </div>\n\n",i=i.pop(),new r.SafeString(u)});e.addExport("like_button"),e.setVariable("like_button",d),o+="\n\n";var p=r.makeMacro(["authUser"],["options"],function(n,o){i=i.push(),o=o||{},o.hasOwnProperty("caller")&&i.set("caller",o.caller),i.set("authUser",n),i.set("options",o.hasOwnProperty("options")?o.options:{});var u="";return u+='\n\n    <div class="help like-button star-like-button btn-loading popover-container',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"buttonClass",t.opts.autoescape)&&(u+=" ",u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"buttonClass",t.opts.autoescape),t.opts.autoescape)),u+='" data-action="like-model">\n        ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"count",t.opts.autoescape)&&r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"count",t.opts.autoescape),"display",t.opts.autoescape)&&(u+='\n            <span class="count">',u+=r.suppressValue(r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"count",t.opts.autoescape),"like",t.opts.autoescape),t.opts.autoescape),u+="</span>\n        "),u+='\n        <span class="tooltip liked-content',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"tooltipClass",t.opts.autoescape)?(u+=" ",u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"tooltipClass",t.opts.autoescape),t.opts.autoescape)):u+=" tooltip-down",u+='">Like</span>\n        <span class="tooltip unliked-content',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"tooltipClass",t.opts.autoescape)?(u+=" ",u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"tooltipClass",t.opts.autoescape),t.opts.autoescape)):u+=" tooltip-down",u+='">Unlike</span>\n        ',r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"popover",t.opts.autoescape),"display",t.opts.autoescape)&&(u+="\n            ",u+=r.suppressValue((a=42,s=26,r.callWrap(l,"share_popover",[{"class":r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"popover",t.opts.autoescape),"arrow",t.opts.autoescape)}])),t.opts.autoescape),u+="\n        "),u+="\n    </div>\n\n",i=i.pop(),new r.SafeString(u)});e.addExport("star_like_button"),
e.setVariable("star_like_button",p),o+="\n\n\n";var f=r.makeMacro(["authUser"],["options"],function(n,o){i=i.push(),o=o||{},o.hasOwnProperty("caller")&&i.set("caller",o.caller),i.set("authUser",n),i.set("options",o.hasOwnProperty("options")?o.options:{});var u="";return u+='\n\n    <div class="help subscribe-button count-subscribe-button btn-loading popover-container',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"buttonClass",t.opts.autoescape)&&(u+=" ",u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"buttonClass",t.opts.autoescape),t.opts.autoescape)),u+='" data-action="subscribe-collection">\n        ',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"count",t.opts.autoescape)&&r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"count",t.opts.autoescape),"display",t.opts.autoescape)&&(u+='\n            <span class="count">',u+=r.suppressValue(r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"count",t.opts.autoescape),"subscribe",t.opts.autoescape),t.opts.autoescape),u+="</span>\n        "),u+='\n        <span class="tooltip subscribed-content',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"tooltipClass",t.opts.autoescape)?(u+=" ",u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"tooltipClass",t.opts.autoescape),t.opts.autoescape)):u+=" tooltip-down",u+='">Subscribe</span>\n        <span class="tooltip unsubscribed-content',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"tooltipClass",t.opts.autoescape)?(u+=" ",u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"tooltipClass",t.opts.autoescape),t.opts.autoescape)):u+=" tooltip-down",u+='">Unsubscribe</span>\n        ',r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"popover",t.opts.autoescape),"display",t.opts.autoescape)&&(u+="\n            ",u+=r.suppressValue((a=58,s=26,r.callWrap(l,"share_popover",[{"class":r.memberLookup(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"popover",t.opts.autoescape),"arrow",t.opts.autoescape)}])),t.opts.autoescape),u+="\n        "),u+="\n    </div>\n\n",i=i.pop(),new r.SafeString(u)});e.addExport("subscribe_button_count"),e.setVariable("subscribe_button_count",f),o+="\n\n";var g=r.makeMacro(["collection"],[],function(e,n){i=i.push(),n=n||{},n.hasOwnProperty("caller")&&i.set("caller",n.caller),i.set("collection",e);var a="";return a+='\n\n    <span class="toggle-button addto-button" data-collection="',a+=r.suppressValue(r.memberLookup(e,"uid",t.opts.autoescape),t.opts.autoescape),a+='">\n        <a class="button btn-small btn-primary toggle">\n            Add\n        </a>\n        <a class="button btn-small btn-important untoggle">\n            <span class="toggled">\n                Added\n            </span>\n            <span class="untoggled">\n                Remove\n            </span>\n        </a>\n    </span>\n\n',i=i.pop(),new r.SafeString(a)});e.addExport("add_to_collection_button"),e.setVariable("add_to_collection_button",g),o+="\n\n";var m=r.makeMacro(["collection"],[],function(e,n){i=i.push(),n=n||{},n.hasOwnProperty("caller")&&i.set("caller",n.caller),i.set("collection",e);var a="";return a+='\n\n    <span class="toggle-button subscribe-collection-button btn-loading" data-action="subscribe-collection" data-collection="',a+=r.suppressValue(r.memberLookup(e,"uid",t.opts.autoescape),t.opts.autoescape),a+='">\n        <div class="subscribe">\n            <a class="button btn-medium btn-primary btn-disabled toggle">\n                <i class="icon fa fa-rss"></i>\n                Subscribe\n            </a>\n            <a class="button btn-medium btn-important untoggle">\n                <i class="icon icon-fixed-left fa fa-rss"></i>\n                <span class="toggled">\n                    Subscribed\n                </span>\n                <span class="untoggled">\n                    Unsubscribe\n                </span>\n            </a>\n        </div>\n    </span>\n\n',i=i.pop(),new r.SafeString(a)});e.addExport("subscribe_button"),e.setVariable("subscribe_button",m),o+="\n\n";var v=r.makeMacro([],[],function(t){i=i.push(),t=t||{},t.hasOwnProperty("caller")&&i.set("caller",t.caller);var e="";return e+='\n\n    <a class="button btn-medium btn-secondary" data-action="open-collection-popup">\n        <div class="add-to">\n            <i class="icon fa fa-plus"></i>\n            Add to\n        </div>\n    </a>\n\n',i=i.pop(),new r.SafeString(e)});e.addExport("add_to_open_popup"),e.setVariable("add_to_open_popup",v),o+="\n",n(null,o)})})}catch(u){n(r.handleError(u,a,s))}}return{root:t}}()}()},function(t,e){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/popovers.jinja"]=function(){function t(t,e,i,r,n){var a=null,s=null,o="";try{var u=r.makeMacro([],["options"],function(n){i=i.push(),n=n||{},n.hasOwnProperty("caller")&&i.set("caller",n.caller),i.set("options",n.hasOwnProperty("options")?n.options:{});var a="";return a+='\n\n    <div class="popover share-popover hidden',r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"class",t.opts.autoescape)&&(a+=" ",a+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(e,i,"options"),"class",t.opts.autoescape),t.opts.autoescape)),a+='">\n        <p>Thanks!</p>\n        <p>Also share?</p>\n\n        <a data-action="share-on-twitter" class="icon fa fa-twitter"></a>\n        <a data-action="share-on-google-plus" class="icon fa fa-google-plus"></a>\n        <a data-action="share-on-facebook" class="icon fa fa-facebook"></a>\n        <a data-action="share-on-pinterest" class="icon fa fa-pinterest"></a>\n    </div>\n\n',i=i.pop(),new r.SafeString(a)});e.addExport("share_popover"),e.setVariable("share_popover",u),o+="\n",n(null,o)}catch(h){n(r.handleError(h,a,s))}}return{root:t}}()}()},,,,,,,,,,function(t,e,i){"use strict";var r=i(224),n=i(267);t.exports={isMaintenance:function(){return r('meta[property="skfb:maintenance"]').attr("content")},showPopup:function(){var t=new n({title:"Maintenance",text:'Sketchfab is undergoing maintenance.<br>See: <a href="https://forum.sketchfab.com/t/sketchfab-operations/6678" target=_blank>Operations forum post</a>',buttons:{ok:!0},safe:!0});return t.open().then(function(){t.close()}),t}}},,,,,,,,,function(t,e,i){"use strict";var r=i(235),n=i(224),a=i(219),s=i(236),o=i(234),u=i(239),h=i(311),l=i(312);t.exports=u.extend(a.extend({},l,{defaults:{collections:{}},initialize:function(){u.prototype.initialize.apply(this,arguments),this.on("change:isPrivate",function(){this.get("isPrivate")||this.set("password","")}.bind(this)),this.maxFailCount=5},url:function(){return this.isNew()?"/i/models":"/i/models/"+this.get("uid")},like:function(){return o.authenticate(function(t){return this.set({likeCount:this.get("likeCount")+1}),t.addLike(this.get("uid"),!0),r.ajax({type:"POST",url:a.result(this,"url")+"/likes",cacheBusting:!1})}.bind(this))},unlike:function(){return o.authenticate(function(t){return this.set({likeCount:this.get("likeCount")-1}),t.addLike(this.get("uid"),!1),r.ajax({type:"DELETE",url:a.result(this,"url")+"/likes"})}.bind(this))},hit:function(){var t=o.me();if(t.isAuthenticated()){var e=t.get("uid")===this.get("user").uid,i=t.get("isStaff");if(e||i)return s.resolve()}return r.ajax({type:"POST",url:a.result(this,"url")+"/views",cacheBusting:!1})},hitDownload:function(){return r.ajax({type:"POST",url:a.result(this,"url")+"/download",cacheBusting:!1})},isPublished:function(){return(this.get("isPublished")||!!this.get("publishedAt"))&&!this.get("isDeleted")},publish:function(){return this.set("isPublished",!0),this.set("publishedAt",new Date),r.ajax({type:"PATCH",url:a.result(this,"url"),data:{isPublished:!0},cacheBusting:!1})},getDownloadStatus:function(){return r.ajax({type:"GET",url:a.result(this,"url")+"/download",allowPrefetching:!1}).then(function(t,e,i){return n.Deferred().resolve(t,e,i)})},getRelatedContent:function(){return r.ajax({type:"GET",url:a.result(this,"url")+"/related",allowPrefetching:!1}).then(function(t,e,i){return n.Deferred().resolve(t,e,i)})},pollRelatedContent:function(){var t=!0;return h["while"](function(){return t},function(){return new s(function(e){this.getRelatedContent().then(function(i,r,n){return 202===n.status?s.delay(5e3).then(e):(t=!1,e(i))})}.bind(this))}.bind(this))["catch"](function(){t=!1})},getLikeUsers:function(){return r.ajax({type:"GET",url:a.result(this,"url")+"/liked_by",allowPrefetching:!0}).then(function(t){return t})},sharing:function(){return r.ajax({type:"GET",url:a.result(this,"url")+"/sharing"}).then(function(t){return this.set("sharing",t),s.resolve(t)}.bind(this))},toJSON:function(){var t=u.prototype.toJSON.apply(this,arguments);return t.categories&&(t.categories=t.categories.map(function(t){return"object"==typeof t?t.uid:t})),t},addCollection:function(t,e){var i={};i[t]=e,this.addCollections(i)},addCollections:function(t){var e=a.clone(this.get("collections"));a.extend(e,t),this.set("collections",e)},isInCollection:function(t){return this.get("collections")[t]?!0:!1},getCollections:function(t){var e=[];return a.each(t,function(t){t in this.get("collections")||e.push(t)}.bind(this)),new s(function(t,i){e.length>0?r.ajax({type:"GET",url:"/i/models/"+this.id+"/collections?uid="+e.join("&uid=")}).then(function(e){this.addCollections(e.results),t()}.bind(this),i):(this.trigger("change:collections"),t())}.bind(this))}}))},function(t,e,i){"use strict";var r=i(236);t.exports={"while":function(t,e){return new r(function(i,n){var a=function(s){return t()?r.cast(e()).then(a)["catch"](n):i(s)};setTimeout(a,0)}).cancellable()}}},function(t,e,i){"use strict";var r=i(236),n=i(219),a=i(235),s=i(311);t.exports={status:function(){return void 0===this.get("status")?this.pollStatus():r.resolve(this.get("status"))},pollStatus:function(){return new r(function(t,e){a.ajax({type:"GET",url:n.result(this,"url")+"/status",allowPrefetching:!1}).then(function(e){var i={PENDING:0,PROCESSING:1,SUCCEEDED:2,FAILED:3}[e.processing.toUpperCase()];this.set("status",e),this.set("processingStatus",i),t(e)}.bind(this),e)}.bind(this))},checkStatus:function(){return this.pollStatus().then(function(t){return-1!==["SUCCEEDED","FAILED"].indexOf(t.processing.toUpperCase())?r.resolve(t):r.reject(t)}.bind(this),function(){return this.maxFailCount<=0?r.resolve({processing:"FAILED",error:"The server failed to answer in time"}):(this.maxFailCount-=1,r.reject("Server responded with an error"))}.bind(this))},checkStatusAndRetry:function(){var t=!0;return s["while"](function(){return t},function(){return new r(function(e){this.checkStatus().then(function(i){t=!1,e(i)})["catch"](function(){return r.delay(2e3).then(function(){e()})})}.bind(this))}.bind(this))["catch"](function(){t=!1})}}},function(t,e){"use strict";t.exports=function(t,e){var i,r,n=t.length,a=e.length,s=[];if(!n)return a;if(!a)return n;for(i=0;n>=i;i++)s[i]=[i];for(r=0;a>=r;r++)s[0][r]=r;for(r=1;a>=r;r++)for(i=1;n>=i;i++)t[i-1]===e[r-1]?s[i][r]=s[i-1][r-1]:s[i][r]=Math.min(s[i-1][r],s[i][r-1],s[i-1][r-1])+1;return s[n][a]}},function(t,e){"use strict";t.exports=function(t){return t=t.substring(t.lastIndexOf("/")+1),t=t.split("."),t=t[t.length>1?t.length-2:t.length-1],t.split("_").pop().toLowerCase()}},,,,,,,function(t,e,i){"use strict";var r=i(224),n=i(219);t.exports={handleLazyLoading:function(t){t=t||{},n.defaults(t,{onBeforeLoad:function(){},onAfterLoad:function(){}});var e=function(){this.$(".lazyload").each(function(){var e=r(this),i=e.attr("data-uri"),n=new Image;n.classList.add("lazyloaded"),n.onload=n.onerror=function(){var i,r=e.width();if(i=n.naturalWidth>r?n.naturalHeight*(r/n.naturalWidth):n.naturalHeight,t.onBeforeLoad(i),e.is(":visible")){var a=function(){e.append(n),e.addClass("loaded").one("transitionend webkittransitionend moztransitionend",function(){e.replaceWith(n),t.onAfterLoad()})}.bind(this);i!==e.outerHeight()?e.css("min-height",i).one("transitionend webkittransitionend moztransitionend",a):a()}else e.replaceWith(n),t.onAfterLoad()},n.src=i})}.bind(this);"complete"===document.readyState?e():r(window).load(e)}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var r,n=i(353),a=[{type:"VERTEX_SHADER",text:["attribute vec3 aPosition;","void main() {","gl_Position = vec4(aPosition, 1.0);","}"].join("\n")},{type:"FRAGMENT_SHADER",text:["precision mediump float;","varying vec3 vColor;","void main() {","gl_FragColor = vec4(vColor, 1.0);","}"].join("\n")},{type:"FRAGMENT_SHADER",text:["precision mediump float;","varying vec3 vColor;","void f(in vec3 a, out vec3 b) {","b = 2.0 * a;","}","void main() {","vec3 color;","f(vColor, color);","gl_FragColor = vec4(color, 1.0);","}"].join("\n")}],s=function(t,e,i){var r=e;"string"==typeof r&&(r=t[e]);var n=t.createShader(r);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||t.isContextLost()?!0:(console.warn("Could't compile shader "+i),console.warn(t.getShaderInfoLog(n)),console.warn("You may want to consider a browser that fully supports WebGL."),!1)};t.exports=function(){if(void 0!==r)return r;if(r=!1,n())return!1;for(var t=["webgl","experimental-webgl"],e={antialias:!1},i=null,o=0;o<t.length&&!(i=document.createElement("canvas").getContext(t[o],e));o++);return i?r=a.every(function(t){return s(i,t.type,t.text)}):!1}},function(t,e){"use strict";t.exports=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE "),i=t.indexOf("Trident/");return e>=0||i>=0?document.all&&!window.atob:!1}},,,,,,,,function(t,e,i){i(290),i(289),i(362),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/model.jinja"]=function(){function t(t,e,r,n,a){var s=null,o=null,u="";try{t.getTemplate("skfb_front/macros/buttons.jinja",!1,"skfb_front/macros/model.jinja",function(h,l){return h?void a(h):void l.getExported(function(h,l){if(h)return void a(h);if(!l.hasOwnProperty("star_like_button"))return void a(new Error("cannot import 'star_like_button'"));var c=l.star_like_button;e.setVariable("star_like_button",c),u+="\n",t.getTemplate("skfb_front/macros/user.jinja",!1,"skfb_front/macros/model.jinja",function(h,l){return h?void a(h):void l.getExported(function(h,l){if(h)return void a(h);if(!l.hasOwnProperty("user_name"))return void a(new Error("cannot import 'user_name'"));var d=l.user_name;e.setVariable("user_name",d),u+="\n",t.getTemplate("skfb_front/macros/utils.jinja",!1,"skfb_front/macros/model.jinja",function(h,l){return h?void a(h):void l.getExported(function(h,l){if(h)return void a(h);if(!l.hasOwnProperty("humanize_count"))return void a(new Error("cannot import 'humanize_count'"));var p=l.humanize_count;e.setVariable("humanize_count",p),u+="\n\n\n";var f=n.makeMacro(["authUser","model"],["options"],function(i,a,s){r=r.push(),s=s||{},s.hasOwnProperty("caller")&&r.set("caller",s.caller),r.set("authUser",i),r.set("model",a),r.set("options",s.hasOwnProperty("options")?s.options:{});var o="";o+="\n\n    ";var u;return u=t.getFilter("merge").call(e,{clickable:!0,withStaffpickFlag:!0,withStaffpickLink:!1},n.contextOrFrameLookup(e,r,"options")),r.set("options",u,!0),r.parent||(e.setVariable("options",u),e.addExport("options")),o+="\n\n    ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"clickable",t.opts.autoescape)?(o+='\n    <a class="model-name',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withStaffpickFlag",t.opts.autoescape)&&n.memberLookup(a,"staffpickedAt",t.opts.autoescape)&&(o+=" model-staffpicked"),o+='" href="',o+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),o+='"',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"target",t.opts.autoescape)&&(o+=' target="',o+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"target",t.opts.autoescape),t.opts.autoescape),o+='"'),o+=">\n    "):(o+='\n    <span class="model-name',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withStaffpickFlag",t.opts.autoescape)&&n.memberLookup(a,"staffpickedAt",t.opts.autoescape)&&(o+=" model-staffpicked"),o+='">\n    '),o+="\n\n        ",n.memberLookup(a,"isProtected",t.opts.autoescape)?o+='\n            <i class="fa fa-lock protected"></i>\n        ':n.memberLookup(a,"isPrivate",t.opts.autoescape)&&(o+='\n            <i class="fa fa-lock private"></i>\n        '),o+='\n\n        <span class="model-name-label">',o+=n.suppressValue(n.memberLookup(a,"name",t.opts.autoescape),t.opts.autoescape),o+="</span>\n\n        ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withStaffpickFlag",t.opts.autoescape)&&n.memberLookup(a,"staffpickedAt",t.opts.autoescape)&&(o+='\n            <meta itemprop="award" content="Staff Pick" />\n            <span class="flag-staffpicked" title="Staff Picks"></span>\n        '),o+="\n\n        ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withStaffpickLink",t.opts.autoescape)&&n.memberLookup(a,"staffpickedAt",t.opts.autoescape)&&(o+='\n            <meta itemprop="award" content="Staff Pick" />\n            <a href="/models/staffpicks" class="flag-staffpicked" title="See all staff picks"></a>\n        '),o+="\n\n    ",o+=n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"clickable",t.opts.autoescape)?"\n    </a>\n    ":"\n    </span>\n    ",o+="\n\n",r=r.pop(),new n.SafeString(o)});e.addExport("model_name"),e.setVariable("model_name",f),u+="\n\n";var g=n.makeMacro(["authUser","model"],["options"],function(i,a,s){r=r.push(),s=s||{},s.hasOwnProperty("caller")&&r.set("caller",s.caller),r.set("authUser",i),r.set("model",a),r.set("options",s.hasOwnProperty("options")?s.options:{});var o="";return o+='\n\n    <ul class="hover-menu quicksettings corner',"up"==n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"direction",t.opts.autoescape)&&(o+=" hover-menu-up"),"left"==n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"direction",t.opts.autoescape)&&(o+=" hover-menu-left"),o+='">\n\n        ',2==n.memberLookup(a,"processingStatus",t.opts.autoescape)&&(o+="\n            ",n.memberLookup(a,"publishedAt",t.opts.autoescape)||(o+='\n                <li><a data-action="publish">Publish</a></li>\n                <li class="separator"></li>\n            '),o+='\n\n            <li><a data-action="open-settings-popup">Properties</a></li>\n            <li><a href="',o+=n.suppressValue(n.memberLookup(a,"editorUrl",t.opts.autoescape),t.opts.autoescape),o+='" data-action="settings3d-button">3D settings</a></li>\n            <li><a href="',o+=n.suppressValue(t.getFilter("query_string").call(e,n.memberLookup(a,"editorUrl",t.opts.autoescape),{tab:"annotations"}),t.opts.autoescape),o+='" data-action="open-editor-annotations">Annotations</a></li>\n\n            ',n.memberLookup(a,"publishedAt",t.opts.autoescape)&&(o+='\n                <li><a data-action="open-collection-popup">Add to collection</a></li>\n            '),o+='\n\n            <li class="separator"></li>\n\n        '),o+="\n\n        ",n.memberLookup(a,"processingStatus",t.opts.autoescape)>1&&(o+='\n            <li><a data-action="open-reupload-popup">Re-upload</a></li>\n        '),o+='\n        <li><a data-action="delete-model">Delete</a></li>\n        <li><a data-action="report-issue">Report an issue</a></li>\n\n    </ul>\n\n',r=r.pop(),new n.SafeString(o)});e.addExport("model_quicksettings"),e.setVariable("model_quicksettings",g),u+="\n\n";var m=n.makeMacro(["authUser","model"],["options"],function(i,a,s){r=r.push(),s=s||{},s.hasOwnProperty("caller")&&r.set("caller",s.caller),r.set("authUser",i),r.set("model",a),r.set("options",s.hasOwnProperty("options")?s.options:{});var o="";return o+='\n\n    <ul class="hover-menu quicksettings corner',"up"==n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"direction",t.opts.autoescape)&&(o+=" hover-menu-up"),"left"==n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"direction",t.opts.autoescape)&&(o+=" hover-menu-left"),o+='">\n        <li><a data-action="remove-model">Remove</a></li>\n    </ul>\n\n',r=r.pop(),new n.SafeString(o)});e.addExport("collection_quicksettings"),e.setVariable("collection_quicksettings",m),u+="\n\n";var v=n.makeMacro([],[],function(t){r=r.push(),t=t||{},t.hasOwnProperty("caller")&&r.set("caller",t.caller);var e="";return e+='\n\n    <a class="model-card-preview" data-action="open-preview">\n        <i class="fa fa-search"></i>\n    </a>\n\n',r=r.pop(),new n.SafeString(e)});e.addExport("preview_link"),e.setVariable("preview_link",v),u+="\n\n";var _=n.makeMacro(["authUser","model"],["options"],function(i,a,u){r=r.push(),u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var h="";h+="\n\n    ";var l;return l=t.getFilter("merge").call(e,{withAvatars:!0,withUser:!0,withDate:!1,withQuickSettings:!1,withStaffpickFlag:!0,deferImages:!1},n.contextOrFrameLookup(e,r,"options")),r.set("options",l,!0),r.parent||(e.setVariable("options",l),e.addExport("options")),h+="\n\n    ",h+="\n\n    ",a=t.getFilter("merge").call(e,{user:n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"user",t.opts.autoescape)},a),r.set("model",a,!0),r.parent||(e.setVariable("model",a),e.addExport("model")),h+="\n\n    ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"wrapMetaType",t.opts.autoescape)&&(h+='\n\n    <data itemscope itemtype="http://schema.org/BlogPosting">\n\n    <meta itemprop="headline" content="',h+=n.suppressValue(n.memberLookup(a,"name",t.opts.autoescape),t.opts.autoescape),h+='" />\n    <meta itemprop="image" content="',h+=n.suppressValue(t.getFilter("best_fit").call(e,n.memberLookup(a,"thumbnails",t.opts.autoescape),1024,768),t.opts.autoescape),h+='" />\n    <meta itemprop="datepublished" content="',h+=n.suppressValue(n.memberLookup(a,"publishedAt",t.opts.autoescape),t.opts.autoescape),h+='" />\n    <meta itemprop="description" content="',h+=n.suppressValue(n.memberLookup(a,"description",t.opts.autoescape),t.opts.autoescape),h+='" />\n\n    '),h+='\n\n    <div class="model-card" itemprop="',h+=n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"wrapMetaType",t.opts.autoescape)?" associatedMedia ":" owns ",h+='" itemscope itemtype="http://schema.org/MediaObject">\n\n        <meta itemprop="commentCount" content="',h+=n.suppressValue(n.memberLookup(a,"commentCount",t.opts.autoescape),t.opts.autoescape),h+='" />\n        <meta itemprop="contentSize" content="',h+=n.suppressValue(t.getFilter("humanize_number").call(e,t.getFilter("default").call(e,n.memberLookup(a,"archiveSize",t.opts.autoescape),0)),t.opts.autoescape),h+='B" />\n        <meta itemprop="isBasedOnUrl" content="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='/editor" />\n        <meta itemprop="embedUrl" content="',h+=n.suppressValue(n.memberLookup(a,"embedUrl",t.opts.autoescape),t.opts.autoescape),h+='" />\n        <meta itemprop="name" content="',h+=n.suppressValue(n.memberLookup(a,"name",t.opts.autoescape),t.opts.autoescape),h+='" />\n\n        <div class="model-card-thumbnail">\n\n            ',h+=n.suppressValue(t.getFilter("image_container").call(e,n.memberLookup(a,"thumbnails",t.opts.autoescape),500,313,!0,!1,n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"deferImages",t.opts.autoescape),n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"initialLoading",t.opts.autoescape)),t.opts.autoescape),h+='\n            <div class="model-card-overlay"></div>\n\n            <a class="model-card-filter" href="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='"></a>\n\n            ',3!=n.memberLookup(a,"processingStatus",t.opts.autoescape)&&(h+="\n                ",h+=n.suppressValue((s=125,o=29,n.callWrap(v,"preview_link",[])),t.opts.autoescape),h+="\n            "),h+="\n\n            ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withQuickSettings",t.opts.autoescape)&&(h+="\n                ",n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withQuickSettings",t.opts.autoescape),"collectionItem",t.opts.autoescape)?(h+='\n                    <div class="model-card-settings" data-action>\n                        <i class="fa fa-cog"></i>\n                        ',h+=n.suppressValue((s=132,o=49,n.callWrap(m,"collection_quicksettings",[i,a])),t.opts.autoescape),h+="\n                    </div>\n                "):(h+="\n                    ",n.memberLookup(i,"uid",t.opts.autoescape)==n.memberLookup(n.memberLookup(a,"user",t.opts.autoescape),"uid",t.opts.autoescape)&&(h+="\n                        ",h+='\n                        <div class="model-card-settings" data-action>\n                            <i class="fa fa-cog"></i>\n                            ',h+=n.suppressValue((s=139,o=48,n.callWrap(g,"model_quicksettings",[i,a])),t.opts.autoescape),h+="\n                        </div>\n                    "),h+="\n                "),h+="\n            "),h+="\n\n            ",n.memberLookup(a,"publishedAt",t.opts.autoescape)&&(h+='\n            <div class="model-card-information">\n                <div class="model-card-left-extra">\n                    <div class="model-card-stats">\n                        <span class="model-card-views">',h+=n.suppressValue(t.getFilter("humanize_number").call(e,n.memberLookup(a,"viewCount",t.opts.autoescape)),t.opts.autoescape),h+="</span>\n                    </div>\n\n                    ",h+=n.suppressValue((s=152,o=37,n.callWrap(c,"star_like_button",[i,n.makeKeywordArgs({options:{count:{display:!0,like:(s=155,o=50,n.callWrap(p,"humanize_count",[n.memberLookup(a,"likeCount",t.opts.autoescape)]))},popover:{display:!0,arrow:"down-arrow middle-arrow"},buttonClass:"model-card-like-button model-card-stats",tooltipClass:"tooltip-up"}})])),t.opts.autoescape),h+='\n                </div>\n\n                <div class="model-card-right-extra">\n\n                    ',n.memberLookup(a,"animationCount",t.opts.autoescape)>0&&(h+='\n                        <div class="model-card-stats animation-stat">\n                            <span title="Model has ',h+=n.suppressValue(n.memberLookup(a,"animationCount",t.opts.autoescape),t.opts.autoescape),h+=" animation",h+=n.suppressValue(t.getFilter("pluralize").call(e,n.memberLookup(a,"animationCount",t.opts.autoescape)),t.opts.autoescape),h+='" class="model-card-animations">',h+=n.suppressValue(n.memberLookup(a,"animationCount",t.opts.autoescape),t.opts.autoescape),h+="</span>\n                        </div>\n                    "),h+="\n\n                    ",n.memberLookup(a,"isDownloadable",t.opts.autoescape)&&n.memberLookup(a,"downloadCount",t.opts.autoescape)>0&&(h+='\n                        <div class="model-card-stats download-start">\n                            <span class="model-card-downloads">',h+=n.suppressValue(t.getFilter("humanize_number").call(e,n.memberLookup(a,"downloadCount",t.opts.autoescape)),t.opts.autoescape),h+="</span>\n                        </div>\n                    "),h+="\n\n                    ",n.memberLookup(a,"commentCount",t.opts.autoescape)>0&&(h+='\n                        <div class="model-card-stats comments-stat">\n                            <a class="model-card-comments" itemprop="discussionUrl" href="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='#comments" data-action="goto-comments">',h+=n.suppressValue(t.getFilter("humanize_number").call(e,n.memberLookup(a,"commentCount",t.opts.autoescape)),t.opts.autoescape),h+="</a>\n                        </div>\n                    "),h+="\n                </div>\n            </div>\n            "),h+='\n\n        </div>\n\n        <div class="model-card-meta',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withUser",t.opts.autoescape)&&(h+=" model-card-with-user"),h+='">\n\n            <div class="model-card-name">\n                ',h+=n.suppressValue((s=194,o=27,n.callWrap(f,"model_name",[i,a,{withStaffpickFlag:n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withStaffpickFlag",t.opts.autoescape)}])),t.opts.autoescape),h+='\n            </div>\n\n            <div class="model-card-extra">\n\n                ',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withUser",t.opts.autoescape)&&(h+='\n                    <div class="model-card-user" itemscope itemtype="http://schema.org/Person" itemprop="author">\n                        ',h+=n.suppressValue((s=201,o=34,n.callWrap(d,"user_name",[i,n.memberLookup(a,"user",t.opts.autoescape),{withAvatar:n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withAvatars",t.opts.autoescape),avatarWidth:34,by:!0,withSummary:!0}])),t.opts.autoescape),h+="\n                    </div>\n                "),h+="\n\n                ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withDate",t.opts.autoescape)&&(h+="\n                    ",n.memberLookup(a,"publishedAt",t.opts.autoescape)?(h+='\n                        <div class="model-card-date">\n                            ',h+=n.suppressValue(t.getFilter("time_ago").call(e,n.memberLookup(a,"publishedAt",t.opts.autoescape)),t.opts.autoescape),h+="\n                        </div>\n                    "):(h+="\n                        <div>\n                            ",h+=0==n.memberLookup(a,"processingStatus",t.opts.autoescape)?'\n                                <span class="flag-draft">Pending</span>\n                            ':1==n.memberLookup(a,"processingStatus",t.opts.autoescape)?'\n                                <span class="flag-draft">Processing</span>\n                            ':2==n.memberLookup(a,"processingStatus",t.opts.autoescape)?'\n                                <span class="flag-draft">Draft</span>\n                            ':'\n                                <span class="flag-error">Error</span>\n                            ',h+="\n                        </div>\n                    "),h+="\n                "),h+="\n\n            </div>\n\n        </div>\n\n    </div>\n\n\n    ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"wrapMetaType",t.opts.autoescape)&&(h+="\n    </data>\n    "),h+="\n\n",r=r.pop(),new n.SafeString(h)});e.addExport("model_card"),e.setVariable("model_card",_),u+="\n\n";var b=n.makeMacro(["authUser","model"],["options"],function(i,a,u){r=r.push(),u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var h="";return h+='\n\n    <meta itemprop="commentCount" content="',h+=n.suppressValue(n.memberLookup(a,"commentCount",t.opts.autoescape),t.opts.autoescape),h+='" />\n    <meta itemprop="contentSize" content="',h+=n.suppressValue(t.getFilter("humanize_number").call(e,t.getFilter("default").call(e,n.memberLookup(a,"archiveSize",t.opts.autoescape),0)),t.opts.autoescape),h+='B" />\n    <meta itemprop="discussionUrl" content="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='#comments" />\n    <meta itemprop="isBasedOnUrl" content="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='/editor" />\n\n    <div class="model-smallcard" data-link="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='">\n\n        <a class="thumbnail" itemprop="url" href="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='">\n            ',h+=n.suppressValue(t.getFilter("image_container").call(e,n.memberLookup(a,"thumbnails",t.opts.autoescape),125,80),t.opts.autoescape),h+='\n        </a>\n\n        <div class="meta">\n            <div class="name" itemprop="name">\n                ',h+=n.suppressValue((s=253,o=27,n.callWrap(f,"model_name",[i,a])),t.opts.autoescape),h+='\n            </div>\n\n            <div class="stats">\n                ',n.memberLookup(a,"commentCount",t.opts.autoescape)>0&&(h+='\n                    <a class="model-card-comments" href="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='#comments">\n                        ',
h+=n.suppressValue(t.getFilter("humanize_number").call(e,n.memberLookup(a,"commentCount",t.opts.autoescape)),t.opts.autoescape),h+="\n                    </a>\n                "),h+='\n                <div class="views">\n                    ',h+=n.suppressValue(t.getFilter("humanize_number").call(e,n.memberLookup(a,"viewCount",t.opts.autoescape)),t.opts.autoescape),h+="\n                </div>\n\n                ",h+=n.suppressValue((s=266,o=33,n.callWrap(c,"star_like_button",[i,n.makeKeywordArgs({options:{count:{display:!0,like:(s=269,o=46,n.callWrap(p,"humanize_count",[n.memberLookup(a,"likeCount",t.opts.autoescape)]))},popover:{display:!0,arrow:"down-arrow middle-arrow"},buttonClass:"model-card-like-button model-subscribe",tooltipClass:"tooltip-up"}})])),t.opts.autoescape),h+="\n\n            </div>\n        </div>\n\n    </div>\n\n",r=r.pop(),new n.SafeString(h)});e.addExport("model_smallcard"),e.setVariable("model_smallcard",b),u+="\n\n\n";var x=n.makeMacro(["authUser","model"],["options"],function(i,a,u){r=r.push(),u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var h="";return h+='\n\n    <div class="model-uploadcard">\n\n        <h3 class="filename">\n            <a href="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='">',h+=n.memberLookup(a,"name",t.opts.autoescape)?n.suppressValue((s=295,o=31,n.callWrap(f,"model_name",[i,a,{withStaffpickFlag:!1}])),t.opts.autoescape):n.suppressValue(t.getFilter("default").call(e,n.memberLookup(a,"originalFileName",t.opts.autoescape),"No file name"),t.opts.autoescape),h+='</a>\n        </h3>\n        <div class="meta">',n.memberLookup(a,"name",t.opts.autoescape)&&(h+='<span class="original-filename">\n                    ',h+=n.suppressValue(t.getFilter("default").call(e,n.memberLookup(a,"originalFileName",t.opts.autoescape),"No file name"),t.opts.autoescape),h+="\n                </span>"),h+='<span class="date" title="',h+=n.suppressValue(n.memberLookup(a,"createdAt",t.opts.autoescape),t.opts.autoescape),h+='">',h+=n.suppressValue(t.getFilter("time_ago").call(e,n.memberLookup(a,"createdAt",t.opts.autoescape)),t.opts.autoescape),h+='</span>\n        </div>\n\n        <div class="status">',0==n.memberLookup(a,"processingStatus",t.opts.autoescape)?h+='<div class="help">\n                    <i class="icon spinner-small-slow"></i>\n                    <div class="tooltip tooltip-down">Pending</div>\n                </div>':1==n.memberLookup(a,"processingStatus",t.opts.autoescape)?h+='<div class="help">\n                    <i class="icon spinner-small"></i>\n                    <div class="tooltip tooltip-down">Processing</div>\n                </div>':2==n.memberLookup(a,"processingStatus",t.opts.autoescape)?n.memberLookup(a,"isPublished",t.opts.autoescape)?h+='<div class="help">\n                        <i class="icon fa fa-check"></i>\n                        <div class="tooltip tooltip-down">Published</div>\n                    </div>':(h+='<a href="/models/',h+=n.suppressValue(n.memberLookup(a,"uid",t.opts.autoescape),t.opts.autoescape),h+='/edit" class="button btn-tertiary btn-medium btn-edit" data-action="edit">\n                        3D Settings\n                    </a>\n                    <button type="button" class="button btn-primary btn-medium" data-action="publish">\n                        Publish\n                    </button>'):3==n.memberLookup(a,"processingStatus",t.opts.autoescape)&&(h+='<div class="help">\n                    <i class="icon fa fa-times"></i>\n                    <div class="tooltip tooltip-down">Error</div>\n                </div>'),h+='</div>\n\n        <div class="model-uploadcard-settings">\n            <div class="button btn-medium btn-tertiary"',n.memberLookup(a,"processingStatus",t.opts.autoescape)<2&&(h+=" disabled"),h+='>\n                <i class="fa fa-cog"></i>\n                ',h+=n.suppressValue((s=358,o=36,n.callWrap(g,"model_quicksettings",[i,a,{direction:"left"}])),t.opts.autoescape),h+="\n            </div>\n        </div>\n\n    </div>\n\n",r=r.pop(),new n.SafeString(h)});e.addExport("model_uploadcard"),e.setVariable("model_uploadcard",x),u+="\n\n\n";var A=n.makeMacro(["authUser"],["options"],function(i,a){r=r.push(),a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("authUser",i),r.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return s+='\n\n    <div class="annotation" data-hotspot="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"hotspotIndex",t.opts.autoescape),t.opts.autoescape),s+='">\n\n        <div class="tooltip">\n\n            ',s+=n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"editMode",t.opts.autoescape)?'\n                <form class="tooltip-content padded">\n                    <div class="edition">\n                            <input class="title" placeholder="Title *" maxlength="64" required>\n                            <textarea class="description" placeholder="Description" maxlength="256" rows="2"></textarea>\n                    </div>\n                    <div class="render tooltip-content padded">\n                        <div class="title"></div>\n                        <div class="description markdown-rendered-content inversed"></div>\n                    </div>\n                    <div class="meta">\n                        <button type="submit" class="submit button btn-small">OK</button>\n                        <i class="fa fa-eye activate-render"></i>\n                        <i class="fa fa-pencil activate-edition selected"></i>\n                    </div>\n                </form>\n            ':'\n\n                <div class="tooltip-content">\n                    <a href="#" class="more">+ more info</a>\n                    <div class="title"></div>\n                    <div class="description markdown-rendered-content inversed"></div>\n                </div>\n\n            ',s+="\n\n        </div>\n\n    </div>\n\n",r=r.pop(),new n.SafeString(s)});e.addExport("model_hotspot"),e.setVariable("model_hotspot",A),u+="\n\n";var y=n.makeMacro(["src"],["options"],function(i,a){r=r.push(),a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("src",i),r.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return s+="<iframe",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"class",t.opts.autoescape)&&(s+=' class="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"class",t.opts.autoescape),t.opts.autoescape),s+='"'),n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"width",t.opts.autoescape)&&(s+=' width="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"width",t.opts.autoescape),t.opts.autoescape),s+='"'),n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"height",t.opts.autoescape)&&(s+=' height="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"height",t.opts.autoescape),t.opts.autoescape),s+='"'),s+=' src="',s+=n.suppressValue(i,t.opts.autoescape),s+='" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" onmousewheel=""></iframe>',r=r.pop(),new n.SafeString(s)});e.addExport("model_iframe"),e.setVariable("model_iframe",y),u+="\n\n";var S=n.makeMacro(["relatedByAlgo"],[],function(i,a){r=r.push(),a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("relatedByAlgo",i);var u="";u+='\n    <h5 class="sidebar-title">Suggested models</h5>\n    <ul class="related-algo ',i||(u+="spinner"),u+='">',r=r.push();var h=i;if(h)for(var l=h.length,c=0;c<h.length;c++){var d=h[c];r.set("model",d),r.set("loop.index",c+1),r.set("loop.index0",c),r.set("loop.revindex",l-c),r.set("loop.revindex0",l-c-1),r.set("loop.first",0===c),r.set("loop.last",c===l-1),r.set("loop.length",l),u+=n.suppressValue((s=411,o=36,n.callWrap(n.contextOrFrameLookup(e,r,"model_related_algo_item"),"model_related_algo_item",[d])),t.opts.autoescape)}return r=r.pop(),u+="</ul>\n",r=r.pop(),new n.SafeString(u)});e.addExport("model_related_algo"),e.setVariable("model_related_algo",S),u+="\n\n";var C=n.makeMacro(["item"],[],function(i,a){r=r.push(),a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("item",i);var u="";return u+='\n    <li itemprop="workExample" itemscope itemtype="http://schema.org/MediaObject" data-uid="',u+=n.suppressValue(n.memberLookup(i,"uid",t.opts.autoescape),t.opts.autoescape),u+='">',u+=n.suppressValue((s=417,o=120,n.callWrap(b,"model_smallcard",[n.contextOrFrameLookup(e,r,"authUser"),i])),t.opts.autoescape),u+="</li>\n",r=r.pop(),new n.SafeString(u)});e.addExport("model_related_algo_item"),e.setVariable("model_related_algo_item",C),u+="\n\n";var w=n.makeMacro(["license"],["options"],function(a,s){r=r.push(),s=s||{},s.hasOwnProperty("caller")&&r.set("caller",s.caller),r.set("license",a),r.set("options",s.hasOwnProperty("options")?s.options:{});var o="";o+="\n\n    ";var u;u=t.getFilter("default").call(e,n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"icon_size",t.opts.autoescape),20),r.set("icon_size",u,!0),r.parent||(e.setVariable("icon_size",u),e.addExport("icon_size")),o+="\n\n    ";var h;if(h={"http://creativecommons.org/licenses/by/4.0/":{clauses:["by"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-sa/4.0/":{clauses:["by","sa"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-nd/4.0/":{clauses:["by","nd"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-nc/4.0/":{clauses:["by","nc"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-nc-sa/4.0/":{clauses:["by","nc","sa"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-nc-nd/4.0/":{clauses:["by","nc","nd"],label:"Some rights reserved"},"http://creativecommons.org/publicdomain/zero/1.0/":{clauses:["zero"],label:"Public Domain"}},r.set("all_licenses",h,!0),r.parent||(e.setVariable("all_licenses",h),e.addExport("all_licenses")),o+="\n\n    ",n.memberLookup(n.contextOrFrameLookup(e,r,"all_licenses"),n.memberLookup(a,"url",t.opts.autoescape),t.opts.autoescape)){o+='\n\n        <a href="',o+=n.suppressValue(n.memberLookup(a,"url",t.opts.autoescape),t.opts.autoescape),o+='" rel="license" itemprop="license" class="help" target="_blank">\n            ',r=r.push();var l=n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e,r,"all_licenses"),n.memberLookup(a,"url",t.opts.autoescape),t.opts.autoescape),"clauses",t.opts.autoescape);if(l)for(var c=l.length,d=0;d<l.length;d++){var p=l[d];r.set("clause",p),r.set("loop.index",d+1),r.set("loop.index0",d),r.set("loop.revindex",c-d),r.set("loop.revindex0",c-d-1),r.set("loop.first",0===d),r.set("loop.last",d===c-1),r.set("loop.length",c),o+="\n                ","by"==p?(o+='\n                    <img src="',o+=n.suppressValue(i(363),t.opts.autoescape),o+='" width="',o+=n.suppressValue(n.contextOrFrameLookup(e,r,"icon_size"),t.opts.autoescape),o+='" height="',o+=n.suppressValue(n.contextOrFrameLookup(e,r,"icon_size"),t.opts.autoescape),o+='" class="icon" />\n                '):"nc"==p?(o+='\n                    <img src="',o+=n.suppressValue(i(364),t.opts.autoescape),o+='" width="',o+=n.suppressValue(n.contextOrFrameLookup(e,r,"icon_size"),t.opts.autoescape),o+='" height="',o+=n.suppressValue(n.contextOrFrameLookup(e,r,"icon_size"),t.opts.autoescape),o+='" class="icon" />\n                '):"sa"==p?(o+='\n                    <img src="',o+=n.suppressValue(i(365),t.opts.autoescape),o+='" width="',o+=n.suppressValue(n.contextOrFrameLookup(e,r,"icon_size"),t.opts.autoescape),o+='" height="',o+=n.suppressValue(n.contextOrFrameLookup(e,r,"icon_size"),t.opts.autoescape),o+='" class="icon" />\n                '):"nd"==p&&(o+='\n                    <img src="',o+=n.suppressValue(i(366),t.opts.autoescape),o+='" width="',o+=n.suppressValue(n.contextOrFrameLookup(e,r,"icon_size"),t.opts.autoescape),o+='" height="',o+=n.suppressValue(n.contextOrFrameLookup(e,r,"icon_size"),t.opts.autoescape),o+='" class="icon" />\n                '),o+="\n            "}r=r.pop(),o+="\n\n            ",o+=n.suppressValue(n.memberLookup(n.memberLookup(n.contextOrFrameLookup(e,r,"all_licenses"),n.memberLookup(a,"url",t.opts.autoescape),t.opts.autoescape),"label",t.opts.autoescape),t.opts.autoescape),o+='\n\n            <span class="tooltip tooltip-right">',o+=n.suppressValue(n.memberLookup(a,"fullname",t.opts.autoescape),t.opts.autoescape),o+="</span>\n        </a>\n\n    "}else o+="\n\n        <span>All rights reserved</span>\n\n    ";return o+="\n\n",r=r.pop(),new n.SafeString(o)});e.addExport("model_license"),e.setVariable("model_license",w);var T=n.makeMacro(["model"],["options"],function(i,a){r=r.push(),a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("model",i),r.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return n.memberLookup(i,"isProtected",t.opts.autoescape)?(s+="\n        ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withIcons",t.opts.autoescape)&&(s+='<i class="icon fa fa-lock protected"></i> '),s+='\n        <span class="label">Only people with password and link will have access</span>\n    '):n.memberLookup(i,"isPrivate",t.opts.autoescape)?(s+="\n        ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withIcons",t.opts.autoescape)&&(s+='<i class="icon fa fa-lock private"></i> '),s+='\n        <span class="label">Only people with link will have access</span>\n    '):(s+="\n        ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"withIcons",t.opts.autoescape)&&(s+='<i class="icon fa fa-globe"></i> '),s+='\n        <span class="label">Everyone will have access</span>\n    '),r=r.pop(),new n.SafeString(s)});e.addExport("model_draft_privacy_description"),e.setVariable("model_draft_privacy_description",T),a(null,u)})})})})})})}catch(h){a(n.handleError(h,s,o))}}return{root:t}}()}()},function(t,e){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/utils.jinja"]=function(){function t(t,e,i,r,n){var a=null,s=null,o="";try{var u=r.makeMacro(["number"],[],function(n,a){i=i.push(),a=a||{},a.hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("number",n);var s="";return s+="\n    ",s+=r.suppressValue(t.getFilter("humanize_number").call(e,n),t.opts.autoescape),s+="\n",i=i.pop(),new r.SafeString(s)});e.addExport("humanize_count"),e.setVariable("humanize_count",u),o+="\n",n(null,o)}catch(h){n(r.handleError(h,a,s))}}return{root:t}}()}()},function(t,e,i){t.exports=i.p+"by-7813b5794d8ba96aec20acb7f14ff76a.svg"},function(t,e,i){t.exports=i.p+"nc-e378f908a7f49e2a3812c0d4e70333dd.svg"},function(t,e,i){t.exports=i.p+"sa-978acd9d54dfd3c39cd92e8acfe1fe7e.svg"},function(t,e,i){t.exports=i.p+"nd-7966b830678388d28550a10805a754db.svg"},,,,,,,,,,,function(t,e,i){"use strict";var r=i(378),n=i(248),a=i(240);t.exports=n.extend({comparator:"order",model:r,url:function(){var t=this.options.filters.get("modelUID"),e=t?"/i/models/"+t+"/hotspots":"/i/hotspots";return e+a.craft("?",{offset:this.options.offset})}})},function(t,e,i){"use strict";var r=i(236),n=i(235),a=i(224),s=i(239),o="/i/hotspots";t.exports=s.extend({defaults:function(){return{name:"",content:"",position:[0,0,0],eye:[0,0,0],target:[0,0,0],uidImage:void 0,imageFile:void 0,preview:"",hovered:!0,lastComputedScenePosition:[0,0,0],geometryUid:-1,indices:[-1,-1,-1],barycentricWeights:[0,0,0],localPosition:[0,0,0]}},url:function(){return this.isNew()?o:o+"/"+this.get("uid")},remove:function(){return r.resolve(n.ajax({type:"DELETE",url:this.url()}))},appendArray:function(t,e,i){for(var r=0,n=i.length;n>r;++r)t.append(e,i[r])},save:function(t,e){(null==t||"object"==typeof t)&&(e=t);var i=this.isNew(),n=new FormData,s=this.get("imageFile");void 0===this.get("uidImage")&&s&&n.append("imageFile",s),n.append("model",e.modelUID),n.append("name",this.get("name"));var o=this.get("content").raw;n.append("content",null!==o?o:""),this.appendArray(n,"eye",this.get("eye")),this.appendArray(n,"target",this.get("target")),this.appendArray(n,"position",this.get("position"));var u=this,h=a.ajax({type:i?"POST":"PATCH",url:this.url(),data:n,cache:!1,contentType:!1,processData:!1,success:function(t){i&&(u.set("uid",t.uid),t.images.length>0&&u.set("uidImage",t.images[0].uid))},error:function(t){console.error(t.stack)}});return r.resolve(h)},_validate:function(t,e){return e=e||{},e.validate=!0,s.prototype._validate.call(this,t,e)},validate:function(t){var e=t.eye,i=t.target,r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=Math.sqrt(r*r+n*n+a*a);if(1e-8>=s)return i[0]=t.position[0],i[1]=t.position[1],i[2]=t.position[2],!1;if(.001>=s){var o=.01/s;i[0]=e[0]+r*o,i[1]=e[1]+n*o,i[2]=e[2]+a*o}return!1}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){i(290),i(361),i(291),i(289),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/viewer.jinja"]=function(){function t(t,e,r,n,a){var s=null,o=null,u="";try{t.getTemplate("skfb_front/macros/buttons.jinja",!1,"skfb_front/macros/viewer.jinja",function(h,l){return h?void a(h):void l.getExported(function(h,l){if(h)return void a(h);if(!l.hasOwnProperty("star_like_button"))return void a(new Error("cannot import 'star_like_button'"));var c=l.star_like_button;e.setVariable("star_like_button",c),u+="\n",t.getTemplate("skfb_front/macros/model.jinja",!1,"skfb_front/macros/viewer.jinja",function(h,l){return h?void a(h):void l.getExported(function(h,l){if(h)return void a(h);if(!l.hasOwnProperty("model_name"))return void a(new Error("cannot import 'model_name'"));var c=l.model_name;e.setVariable("model_name",c),u+="\n",t.getTemplate("skfb_front/macros/popovers.jinja",!1,"skfb_front/macros/viewer.jinja",function(h,l){return h?void a(h):void l.getExported(function(h,l){if(h)return void a(h);if(!l.hasOwnProperty("share_popover"))return void a(new Error("cannot import 'share_popover'"));var d=l.share_popover;e.setVariable("share_popover",d),u+="\n",t.getTemplate("skfb_front/macros/user.jinja",!1,"skfb_front/macros/viewer.jinja",function(h,l){return h?void a(h):void l.getExported(function(h,l){if(h)return void a(h);if(!l.hasOwnProperty("user_name"))return void a(new Error("cannot import 'user_name'"));var d=l.user_name;e.setVariable("user_name",d),u+="\n",t.getTemplate("skfb_front/macros/user.jinja",!1,"skfb_front/macros/viewer.jinja",function(h,l){return h?void a(h):void l.getExported(function(h,l){if(h)return void a(h);if(!l.hasOwnProperty("user_avatar"))return void a(new Error("cannot import 'user_avatar'"));var d=l.user_avatar;e.setVariable("user_avatar",d),u+="\n\n";var p=n.makeMacro(["authUser","model"],["options"],function(i,a,u){r=r.push(),u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var h="";return h+='\n\n    <div class="titlebar">\n\n        <div class="summary">\n            ',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"showInfos",t.opts.autoescape)&&(h+='\n                <div class="avatar">\n                    <a target="_blank" href="/models/',h+=n.suppressValue(n.memberLookup(a,"uid",t.opts.autoescape),t.opts.autoescape),h+='">',h+=n.suppressValue((s=13,o=78,n.callWrap(d,"user_avatar",[n.memberLookup(n.memberLookup(a,"user",t.opts.autoescape),"avatars",t.opts.autoescape),{size:32}])),t.opts.autoescape),h+='</a>\n                </div>\n                <div class="model-info">\n                    <h1 class="title">',h+=n.suppressValue((s=16,o=49,n.callWrap(c,"model_name",[i,a,{target:"_blank"}])),t.opts.autoescape),h+='</h1>\n                    <h2>by <a target="_blank" href="/models/',h+=n.suppressValue(n.memberLookup(a,"uid",t.opts.autoescape),t.opts.autoescape),h+='">',h+=n.suppressValue(n.memberLookup(n.memberLookup(a,"user",t.opts.autoescape),"displayName",t.opts.autoescape),t.opts.autoescape),h+="</a></h2>\n                </div>\n            "),h+='\n        </div>\n\n        <div class="actions">\n\n            ',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"showInfos",t.opts.autoescape)&&(h+='\n                <a class="help tooltip tooltip-down share" data-title="Share" data-action="open-share-overlay">\n                    <i class="custom-icons icon-ion-android-share-alt-icon"></i>\n                </a>\n            '),h+="\n\n            ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"allowStops",t.opts.autoescape)&&(h+='\n                <a class="help tooltip tooltip-down close hidden" data-title="Stop" data-action="stop">\n                    <i class="custom-icons icon-ion-close-round-icon"></i>\n                </a>\n            '),h+="\n\n        </div>\n\n    </div>\n\n",r=r.pop(),new n.SafeString(h)});e.addExport("viewer_infos"),e.setVariable("viewer_infos",p),u+="\n\n";var f=n.makeMacro(["authUser","model"],["options"],function(i,a,u){r=r.push(),u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var h="";return h+='\n    <div class="viewer',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"transparent",t.opts.autoescape)&&(h+=" transparent"),n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"isStarted",t.opts.autoescape)&&(h+=" started"),h+='">\n\n        ',h+=n.suppressValue((s=45,o=21,n.callWrap(p,"viewer_infos",[i,a,n.contextOrFrameLookup(e,r,"options")])),t.opts.autoescape),h+='\n\n        <div class="landing" data-action="start">\n\n            <div class="preview">\n                ',h+=n.suppressValue(t.getFilter("image_container").call(e,n.memberLookup(a,"thumbnails",t.opts.autoescape),1024,768,!0,!0),t.opts.autoescape),h+='\n            </div>\n\n            <div class="start-button">\n                <button class="play">\n                    <i class="fa fa-play"></i>\n                    <span class="label">3D</span>\n                </button>\n            </div>\n\n            ',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"showWatermark",t.opts.autoescape)&&(h+='\n                <div class="watermark">\n                    <a data-action="watermark" href="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='" title="View on Sketchfab" target="_blank"></a>\n                </div>\n            '),h+='\n\n        </div>\n\n        <div class="overlays">\n            <div class="overlay help hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <ul class="tabs">\n                        <li class="active"><a href="#" data-target="basic">Navigation basics</a></li>\n                        <li><a href="#" data-target="all">All controls</a></li>\n                    </ul>\n                    <div class="tabs-container">\n                        <div class="tab active" data-tab="basic">\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-refresh"></i>\n                                </div>\n                                <div>\n                                    <b>Orbit around</b>\n                                    <div>\n                                        Left click + drag or<br>\n                                        One finger drag (touch)\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-search-plus"></i>\n                                </div>\n                                <div>\n                                    <b>Zoom</b>\n                                    <div>\n                                        Double click on model<br>\n                                        or scroll anywhere or<br>\n                                        Pinch (touch)\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-arrows"></i>\n                                </div>\n                                <div>\n                                    <b>Pan</b>\n                                    <div>\n                                        Right click + drag or<br />\n                                        Two fingers drag (touch)\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="tab" data-tab="all">\n                            <div>\n                                <div class="section">\n                                    <h2>Orbit navigation</h2>\n                                    <b>Move camera:</b> 1 finger drag or Left Mouse Button<br>\n                                    <b>Pan:</b> 2-finger drag or Right Mouse Button or <kbd>SHIFT</kbd>+ Left Mouse Button<br>\n                                    <b>Zoom on object:</b> Double-tap or Double-click on object<br>\n                                    <b>Zoom out:</b> Double-tap or Double-click on background<br>\n                                    <b>Zoom:</b> Pinch in/out or Mousewheel or <kbd>CTRL</kbd> + Left Mouse Button<br>\n                                </div>\n                                <div class="section">\n                                    <h2>First-person navigation</h2>\n                                    <b>Move:</b> <kbd>↑</kbd>,<kbd>←</kbd>,<kbd>↓</kbd>,<kbd>→</kbd> (or <kbd>W</kbd>,<kbd>A</kbd>,<kbd>S</kbd>,<kbd>D</kbd>)<br>\n                                    <b>Look around:</b> 1-finger drag or Left Mouse Button<br>\n                                    <b>Adjust speed:</b> Mousewheel<br>\n                                </div>\n                                <div class="section rendering-shortcuts"></div>\n                                <div class="section">\n                                    <h2>Lighting</h2>\n                                    <b>Rotate lighting:</b> 3-finger drag or <kbd>ALT</kbd> + Left Mouse Button<br>\n                                    <b>Rotate env. only:</b> <kbd>ALT</kbd> + <kbd>SHIFT</kbd> + Left Mouse Button<br>\n                                </div>\n                                <div class="section annotation-shortcuts"></div>\n                                <div class="section animation-shortcuts"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="action">\n                        <button class="button" data-action="reset-camera">Reset camera view</button>\n                    </div>\n\n                </div>\n            </div>\n            <div class="overlay share hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <div class="share-link">\n                        <div class="text-field">\n                            <label>Link</label>\n                            <input type="text" class="text" value="" readonly>\n                            <button data-clipboard-target=".text-field .text">copy</button>\n                        </div>\n                    </div>\n                    <div class="share-social">\n                        <a data-action="share-on-facebook" target="_blank"><i class="fa fa-facebook"></i></a>\n                        <a data-action="share-on-twitter" target="_blank"><i class="fa fa-twitter"></i></a>\n                        <a data-action="share-on-reddit" target="_blank"><i class="fa fa-reddit"></i></a>\n                        <a data-action="share-on-tumblr" target="_blank"><i class="fa fa-tumblr"></i></a>\n                        <a data-action="share-on-google-plus" target="_blank"><i class="fa fa-google-plus"></i></a>\n                        <a data-action="share-on-linkedin" target="_blank"><i class="fa fa-linkedin"></i></a>\n                        <a data-action="share-on-pinterest" target="_blank"><i class="fa fa-pinterest"></i></a>\n                        <a class="share-mail" target="_blank"><i class="fa fa-envelope"></i></a>\n                    </div>\n                    <div class="share-embed">\n                        <a class="button" href="" target="_blank">\n                            <i class="fa fa-code"></i> Embed\n                        </a>\n                    </div>\n                </div>\n            </div>\n            <div class="overlay hotspots-overlay hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <h4 class="hotspot-title"></h4>\n                    <div class="hotspot-content markdown-rendered-content"></div>\n                </div>\n            </div>\n            <div class="overlay helper-vr-overlay hidden">\n                <i class="custom-icons icon-ion-close-round-icon close"></i>\n                <div class="inner custom-scrollbar">\n                     <div class="header-helper">\n                        To view this model in virtual reality:\n                    </div>\n                    <div class="content-helper">\n                        <div class="row-helper">\n                            <div class="content-row">\n                                <div class="image"><i class="fa fa-mobile"></i></div>\n                                <div class="text">\n                                    <div class="title">on mobile phone</div>\n                                    <div>with Cardboard or similar</div>\n                                </div>\n                            </div>\n                            <ul class="info">\n                                <li>On your mobile, open this link: <a class="url" target="_blank" href="#"></a></li>\n                                <li>Press the VR icon</li>\n                                <li>Insert your mobile in a Cardboard headset</li>\n                            </ul>\n                        </div>\n                        <div class="row-helper">\n                            <div class="content-row">\n                                <div class="image"><i class="fa fa-desktop"></i></div>\n                                <div class="text">\n                                    <div class="title">on desktop PC <span class="flag-info">BETA</span></div>\n                                    <div>with a VR headset</div>\n                                </div>\n                            </div>\n                            <ul class="info">\n                                <li><a target="_blank" href="https://webvr.info/">Get a WebVR-compatible browser</a></li>\n                                <li>Enable WebVR</li>\n                                <li>Open this model</li>\n                                <li>Click on the VR icon</li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class="footer-helper">\n                        <a target="_blank" href="https://help.sketchfab.com/hc/en-us/articles/204777439-Mobile-VR-and-Desktop-WebVR?utm_source=website&utm_campaign=vr_hints">\n                        More info on Virtual reality.\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="webgl">\n\n            <canvas class="canvas" data-modelUid="',h+=n.suppressValue(n.memberLookup(a,"uid",t.opts.autoescape),t.opts.autoescape),h+='" data-action="create-hotspot">\n            </canvas>\n\n            <div class="loading-container">\n                <div class="secondary-progress">\n                    <div class="secondary-progress-percentage"></div>\n                    <div class="secondary-progress-display"></div>\n                </div>\n                <div class="main-progress">\n                    <img src="',
h+=n.suppressValue(t.getFilter("best_fit").call(e,n.memberLookup(a,"thumbnails",t.opts.autoescape),50,50),t.opts.autoescape),h+='" class="loading-thumbnail" />\n                    <div class="main-progress-wrapper">\n                        <div class="main-progress-percentage loading-percentage">0%</div>\n                        <p>Loading 3D model</p>\n                        <progress class="main-progress-display" value="0" max="1"></progress>\n                    </div>\n                </div>\n            </div>\n\n            <div class="hotspots"></div>\n\n            <div class="gui">\n\n                <div class="animation-not-supported hidden">\n                    <a href="#" class="close"></a>\n                    <p>Model is too heavy for your device and can not be rendered properly</p>\n                </div>\n\n                <div class="hotspot-controls-responsive">\n                    <div data-title="Previous Annotation" data-action="prev-annotation">\n                        <div class="icon fa fa-caret-left"></div>\n                    </div>\n                    <div data-title="Next Annotation" data-action="next-annotation">\n                        <div class="icon fa fa-caret-right"></div>\n                    </div>\n                </div>\n                <div class="controls">\n\n                    ',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"showWatermark",t.opts.autoescape)&&(h+='\n                        <div class="watermark">\n                            <a data-action="watermark" href="',h+=n.suppressValue(n.memberLookup(a,"viewerUrl",t.opts.autoescape),t.opts.autoescape),h+='" title="View on Sketchfab" target="_blank"></a>\n                        </div>\n                    '),h+="\n\n                    ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"showControls",t.opts.autoescape)&&(h+='\n                        <div class="animation-controls widget">\n                            <div class="timeline">\n                                <div class="timeline-wrapper">\n                                    <div class="track">\n                                        <div class="bar">\n                                        </div>\n                                        <div class="knob">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <a href="#" class="control play fa"></a>\n                            <a href="#" class="control next fa"></a>\n                            <div class="animation-timer control progress help" data-unit="time">00:00.00</div>\n                            <div class="animation-list control has-menu">\n                                <p class="animation-name"></p>\n                                <div class="control-menu list">\n                                    <p class="static-pose animation-item" data-uid="-1">Static Pose</p>\n                                    <ul></ul>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="hotspot-controls widget">\n\n                            <div data-title="Previous Annotation" data-action="prev-annotation">\n                                <div class="icon fa fa-caret-left"></div>\n                            </div>\n\n                            <div class="hotspot-name default has-menu" data-action="toggle-annotation-list">\n                                Select an annotation\n                            </div>\n\n                            <div data-title="Next Annotation" data-action="next-annotation">\n                                <div class="icon fa fa-caret-right"></div>\n                            </div>\n\n                            <div class="list hotspots-list has-menu"></div>\n\n                        </div>\n                        <div class="spacer"></div>\n                        <div class="general-controls widget">\n                            <a href="#" class="control tooltip help" data-title="Help">\n                                <i class="fa fa-question"></i>\n                            </a>\n                            <a href="#" class="control tooltip settings has-menu" data-title="Settings">\n                                <i class="fa fa-gear"></i>\n                                <div class="control-menu settings-menu">\n                                    <div class="control-menu-wrapper">\n                                        <div class="control-menu-list"></div>\n                                        <div class="control-menu-pane"></div>\n                                    </div>\n                                </div>\n                                <span class="control-badge"></span>\n                            </a>\n                            <a href="#" class="control tooltip vr" data-title="View in VR">\n                                <i class="custom-icons icon-vr-icon"></i>\n                            </a>\n                            <a href="#" class="control tooltip tooltip-right-bound fullscreen" data-title="Fullscreen">\n                                <i class="custom-icons icon-fullscreen-icon"></i>\n                            </a>\n                        </div>\n                    '),h+="\n                </div>\n\n                ",n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"allowSnapshots",t.opts.autoescape)&&(h+='\n                    <div class="snapshot-guides">\n                    </div>\n                    <div class="snapshot widget">\n                        <a class="button help">\n                            <span class="normal"><i class="icon fa fa-camera"></i> Save view</span>\n                            <span class="progress"><i class="icon fa fa-camera"></i> Saving&hellip;</span>\n                            <span class="success"><i class="icon fa fa-check"></i>Saved</span>\n                            <div class="tooltip tooltip-right">Save thumbnail and initial camera view</div>\n                        </a>\n                        <div class="img-container invisible"></div>\n                    </div>\n                    <div class="snapshot-flash">\n                    </div>\n                '),h+='\n\n                <div class="viewer-hint widget disabled">\n                    <div class="viewer-movehint">\n                        <i class="icon"></i>\n                        <span class="label">\n                            click &amp; hold<br>\n                            to rotate\n                        </span>\n                    </div>\n                </div>\n\n            </div>\n\n        </div>\n\n        <div class="osd widget">\n            <div class="content">\n            </div>\n        </div>\n\n        <div class="fallback" style="display: none">\n\n            <div class="fallback-viewport">\n                <img src="" alt="" class="fallback-sprite">\n            </div>\n\n            <div class="fallback-warning">\n                <div class="inner">\n                    For compatibility reasons, 3D is not available (<a href="https://help.sketchfab.com/hc/en-us/articles/203059088-Compatibility?utm_source=website&amp;utm_campaign=error_fallback" target="_blank">see requirements</a>).<br>\n                    You are seeing a 360&deg; image instead.\n                </div>\n            </div>\n\n            <div class="fallback-error fallback-error-loading">\n                <div class="inner">\n                    <p>Connection error. Please try again.</p>\n                </div>\n            </div>\n\n            <div class="fallback-error fallback-error-nofallback">\n                <div class="inner">\n                    <p>Sorry, the model can\'t be displayed.</p>\n                    <p>Please check out <a href="https://help.sketchfab.com/hc/en-us/articles/203059088-Compatibility?utm_source=website&utm_campaign=error_fallback" target="_blank">our FAQ</a> to learn how to fix this issue.</p>\n                </div>\n            </div>\n\n            <div class="progress-bar">\n                <div class="progress-bar-percentage"></div>\n                <div class="progress-bar-display"></div>\n            </div>\n\n            <div class="progress-circle">\n                <div class="progress-circle-percentage loading-percentage"></div>\n                <svg class="progress-circle-display" version="1.1">\n                    <path class="progress-circle-path" fill="none" stroke="#1caad9" stroke-width="6" />\n                </svg>\n            </div>\n\n            ',n.memberLookup(n.contextOrFrameLookup(e,r,"options"),"showControls",t.opts.autoescape)&&(h+='\n                <div class="controls">\n                    <div class="control control-fullscreen" data-title="Toggle Fullscreen" data-action="fullscreen">\n                        <div class="icon custom-icons icon-fullscreen-icon"></div>\n                    </div>\n                </div>\n            '),h+="\n\n        </div>\n\n    </div>\n\n",r=r.pop(),new n.SafeString(h)});e.addExport("viewer"),e.setVariable("viewer",f),u+="\n\n";var g=n.makeMacro(["mode"],[],function(t,e){r=r.push(),e=e||{},e.hasOwnProperty("caller")&&r.set("caller",e.caller),r.set("mode",t);var i="";return i+="\n\n    ","orbit"==t&&(i+='\n\n        <div class="viewer-mode-help">\n            <h2>Orbit mode</h2>\n            <ul class="help-shortcuts">\n                <li class="mouse-left">Rotate</li>\n                <li class="mouse-wheel">Zoom <small class="hint">also works with CTRL+left click</small></li>\n                <li class="mouse-right">Pan <small class="hint">also works with SHIFT+left click</small></li>\n            </ul>\n        </div>\n\n    '),i+="\n\n    ","fps"==t&&(i+='\n\n        <div class="viewer-mode-help">\n            <h2>First person mode</h2>\n            <ul class="help-shortcuts">\n                <li class="mouse-left">Look around</li>\n                <li class="mouse-wheel">Walking speed</li>\n                <li class="kbd-wasd">Walk <small class="hint">also works with arrows or Z,Q,S,D</small></li>\n            </ul>\n        </div\n\n    '),i+="\n\n",r=r.pop(),new n.SafeString(i)});e.addExport("help_viewer_mode"),e.setVariable("help_viewer_mode",g),u+="\n\n";var m=n.makeMacro(["hotspots"],[],function(i,a){r=r.push(),a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("hotspots",i);var s="";s+='\n<a href="#" data-action="toggle-autopilot" class="stopped"></a>\n<ul>\n    ',r=r.push();var o=i;if(o)for(var u=o.length,h=0;h<o.length;h++){var l=o[h];r.set("hotspot",l),r.set("loop.index",h+1),r.set("loop.index0",h),r.set("loop.revindex",u-h),r.set("loop.revindex0",u-h-1),r.set("loop.first",0===h),r.set("loop.last",h===u-1),r.set("loop.length",u),s+='\n        <li class="link"><a data-hotspot-target="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e,r,"loop"),"index0",t.opts.autoescape),t.opts.autoescape),s+='" title="',s+=n.suppressValue(n.memberLookup(l,"name",t.opts.autoescape),t.opts.autoescape),s+='"><span class="index">',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(e,r,"loop"),"index",t.opts.autoescape),t.opts.autoescape),s+="</span> ",s+=n.suppressValue(n.memberLookup(l,"name",t.opts.autoescape),t.opts.autoescape),s+="</a></li>\n    "}return r=r.pop(),s+="\n</ul>\n",r=r.pop(),new n.SafeString(s)});e.addExport("hotspots_list"),e.setVariable("hotspots_list",m),u+="\n\n";var v=n.makeMacro(["hasFullscreen"],[],function(e,a){r=r.push(),a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("hasFullscreen",e);var s="";return s+='\n\n    <div class="vr-mode-help">\n        ',s+='\n        <img src="',s+=n.suppressValue(i(419),t.opts.autoescape),s+='" width="96" height="116" alt="Place your landscape oriented phone in front of lenses">\n\n        <p>\n            ',s+=e?'\n                <button class="button btn-textified" data-action="fullscreen">Switch to fullscreen</button><br>\n                then place your phone into your Cardboard viewer\n            ':"\n                Place your phone into your Cardboard viewer\n            ",s+="\n        </p>\n    </div>\n\n",r=r.pop(),new n.SafeString(s)});e.addExport("help_vr_mode"),e.setVariable("help_vr_mode",v),u+="\n",a(null,u)})})})})})})})})})})}catch(h){a(n.handleError(h,s,o))}}return{root:t}}()}()},function(t,e,i){t.exports=i.p+"cardboard-instructions-3559e10f564c87ffc582505a3919b0ad.svg"},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){"use strict";var i=!1,r=function(t){return void 0!==t&&(i=t),i};t.exports=r},,function(t,e,i){"use strict";var r=i(1096),n=i(1391),a=i(1397),s=i(1450),o=i(1475),u=i(1478),h=i(1481),l=i(1485),c=i(1495),d=i(1499),p=i(1513),f=i(1519),g=i(1522),m=i(1528),v=i(1541),_=i(1554),b=i(1565);t.exports=[r,n,a,s,o,u,h,l,c,d,p,f,g,m,v,_,b]},function(t,e,i){"use strict";var r=i(1097),n=i(1098),a=i(1368),s={FeatureName:"animation",ModelType:n,ViewListType:[a]};t.exports=r.create(s)},function(t,e,i){"use strict";var r=i(219),n=function(t){this._views=[],t&&(this._name=t.FeatureName,this._modelName=t.ModelName,this._modelType=t.ModelType,this._viewListType=t.ViewListType.slice(0))};n.prototype={getName:function(){return this._name},getModel:function(){return this._model},addView:function(t){t&&this._views.push(t)},init:function(t){if(this._model||(this._model=t.getModelByName(this._modelName)),!this._model){var e=this._modelType;this._model=new e,this._model.init&&this._model.init(t)}var i=function(e){var i=new e({model:this._model,context:t});this.addView(i)};this._viewListType.forEach(function(t){i.call(this,t)},this),t.addFeature(this)}},n.create=function(t){var e=function(){n.call(this,e)};return e.prototype=r.extend({},n.prototype),r.extend(e,t),e.getName=function(){return t.FeatureName},e},t.exports=n},function(t,e,i){"use strict";var r=i(219),n=i(235),a=i(1099),s=i(1093),o=i(1341),u=n.Model.extend({defaults:function(){var t=this.getResourceManager().getOrCreateAnimationCollection().resource;return s()||t.remove(t.where({isEnabled:!1})),{animations:t,currentUID:"-1",speed:1,autoplay:!0,playing:!0,cycleMode:"one",fps:-1,progress:0}},getName:function(){return"Animation"},getResourceManager:function(){return this._resourceManager||a.instance},getAnimationByUID:function(t){return this.get("animations").find(function(e){return e.get("uid")===t})},getCurrentAnimation:function(){return this.getAnimationByUID(this.get("currentUID"))},getEnabledAnimationsCount:function(){return this.get("animations").where({isEnabled:!0}).length},getFirstEnabledAnimation:function(){for(var t=this.get("animations"),e=t.length,i=0;e>i;++i){var r=t.at(i);if(r&&r.get("isEnabled"))return r}},init:function(t){this._viewer=t.getViewer();var e=t.getModel().get("options"),i=e.animation;if(i&&i.order){this.set("speed",i.speed),this.set("cycleMode",i.cycleMode),this.set("autoplay",void 0!==o().animationAutoplay?o().animationAutoplay:i.autoplay);var n=this.get("animations"),a=r.invert(i.order);n.forEach(function(t){t.set("order",a[t.get("uid")])}),n.sort()}},getJSON:function(){return{order:this.get("animations").pluck("uid"),speed:this.get("speed"),cycleMode:this.get("cycleMode"),autoplay:!0}}});t.exports=u},function(t,e,i){"use strict";var r=i(236),n=i(1100),a=i(219),s=i(1335),o=i(1340),u=i(1343),h=i(1344),l=i(1347),c=i(377),d=i(1348),p=i(1356),f=i(1359),g=i(1364),m=i(1365),v=i(1366),_=n.osg,fif(n),window.OSG = n.osg,fif(n),b=function(t){t=this.computeURL(t);var e=new _.Image;return e.setURL(t),r.resolve(e)},x=[],A=function(t){return function(){var e=this.getJSON(),i=e.UniqueID,n=new _.BufferArray(_.BufferArray[e.Type]);n.setItemSize(e.ItemSize),n.setElements(x);var a=n.getInstanceID();if(t[a]={},e.Array){var s=Object.keys(e.Array)[0],o=e.Array[s];o.Elements?t[a].inlined=o.Elements:(t[a].vb=o,t[a].type=s)}else t[a].inlined=e.Elements;var u=r.defer();return void 0!==i&&(this._identifierMap[i]=u.promise),u.resolve(n),u.promise}},y=function(t){return function(e,i){return e=i.currentAnimationUID?i.currentAnimationUID:this.computeURL(e),t.getBinaryArray(e,i).getPromise()}},S=function(t,e){this.resource=t,this.promise=e},C=function(t){if(!t){if(C.instance)return C.instance;C.instance=this}return this._maps={},this._resourceLoader=new s,this};C.Entry=S,C.prototype={setModelUID:function(t){this._modelUID=t},setStateContextOSG:function(t){this._state=t},getInstance:function(){return C.instance},register:function(t,e){this._maps[t]=e},exist:function(t){var e=this._maps[t];return e},hashTextureOptions:function(t){var e=a.chain(t).pick(o.getValidOptions()).values().value(),i=e.join("");return i},getOrCreateAnimationCollection:function(){var t="animationCollection",e=this.exist(t);if(e)return e;var i=new v([],{filters:new m({modelUID:this._modelUID})});return e=new S(i,r.resolve(i.fetch())),this.register(t,e),e},getOrCreateHotspotCollection:function(){var t="hotspotCollection",e=this.exist(t);if(e)return e;var i=new c([],{filters:new l({modelUID:this._modelUID})});return e=new S(i,r.resolve(i.fetch())),this.register(t,e),e},getOrCreateImageCollection:function(){var t="imageCollection",e=this.exist(t);if(e)return e;var i=new h([],{filters:new u({modelUID:this._modelUID})});return e=new S(i,r.resolve(i.fetch())),this.register(t,e),e.promise.then(function(){i.forEach(function(t){0===t.getImages().length&&i.remove(t)})}),e},getOrCreateTextureProxy:function(t,e){var i=this.hashTextureOptions(e),n=[t,i].join(""),a=this.exist(n);if(a)return a;var s=this.getOrCreateImageCollection();if(s&&s.resource){var u=s.resource.get(t);if(u){var h=new f;return h.setImageProxy(u),o.setOptions(e,h),a=new S(h,r.resolve(h)),this.register(n,a),a}}},getOrCreateImage:function(t,e){var i=this._resourceLoader.getImage(t),r=i.getPromise(),n=["image",t].join(""),a=this.exist(n);return a?a:(a=new S(null,r),r.then(function(t){e&&(t._alphaInR="A"===e.format),a.image=t}),this.register(n,a),a)},getOrCreateTexture:function(t,e){var i=function(t){!this._state||t._textureObject&&!t.isDirty()||this._state.applyTextureAttribute(0,t)}.bind(this),n=o.createValidOptions(e),a=this.hashTextureOptions(n),s=[t,a].join(""),u=this.exist(s),h=e&&e.transferToGPU&&this._state?!0:!1;if(u)return h&&(u.promise.isFulfilled()?i(u.texture):u._bindToGPU=!0),u;n.cubemap=e&&e.cubemap;var l=n.cubemap?new g:new f;l.setTextureSize(1,1),o.setOptions(n,l),e&&void 0!==e.convertNPOT&&(l._convertNPOT=e.convertNPOT);var c=this._resourceLoader.getImage(t,e),d=c.getPromise(),p=r.defer(),m=p.promise;u=new S(l,m),u.texture=l,u._bindToGPU=h;var v=this;return d.then(function(t){if(n.cubemap)for(var e=0;6>e;e++){var r=_.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+e;l.setImage(r,t[r],"RGBA")}else l.setImage(t);l.dirty(),u._bindToGPU&&i(l),p.resolve(l)})["catch"](function(){v.register(s,void 0),p.reject(l)}).done(),this.register(s,u),u},getOrCreateModel:function(t,e){var i=t,n=this.exist(i);if(n)return n;var s=e&&e.node?e.node:new _.Node,o=a.clone(e)||{};o.readImageURL=b,o.readBinaryArrayURL=y(this._resourceLoader),o.bufferMap={},o.readBufferArray=A(o.bufferMap),_.time("Download "+t.split("/").pop()+" (Async)");var u=this._resourceLoader.getModel(t,o),h=u.getPromise(),l=r.defer(),c=l.promise;n=new S(s,c),n.node=s;var d=r.defer();n.texturesReadyToload=d.promise;var p=t.split("/");p.length=p.length-1,p.length<=0&&_.error("getOrCreateModel: can't find prefix to load subdata");var f=p.join("/")+"/";return o.prefixURL=f,this._loadModel(h,t,o,l,s,d),this.register(i,n),n},_loadModel:function(t,e,i,r,n,a){var s=function(t){_.error("getOrCreateModel error : "+t),_.error(t.stack)},o=e.split("/").pop();t.then(function(t){_.timeEnd("Download "+o+" (Async)"),_.time("JSONparse "+o+" (Sync)");var e=JSON.parse(t);_.timeEnd("JSONparse "+o+" (Sync)"),_.time("parseSceneGraphAsync "+o+" (Async)");var r=p.parse(e,i);return r}).then(function(t){_.timeEnd("parseSceneGraphAsync "+o+" (Async)"),_.time("DownloadAndLoadBuffer "+o+" (Async)");var e=d.postParse(t,this._resourceLoader,i);a.resolve(),e.then(function(){_.timeEnd("DownloadAndLoadBuffer "+o+" (Async)"),n.addChild(t),r.resolve(n)})["catch"](s)}.bind(this))["catch"](s)},run:function(){this._resourceLoader.run()}},new C,t.exports=C},function(t,e,i){"use strict";var r=i(1101),n=i(1103),a=i(1207),s=i(1222),o=i(1228),u=i(1251),h=i(1310),l=i(1259),c=i(1323),d=i(1333),p=i(1334),f=r;f.osg=n,f.osgAnimation=a,f.osgDB=s,f.osgGA=o,f.osgUtil=u,f.osgViewer=h,f.osgShader=l,f.osgShadow=c,f.osgText=d,f.osgWrappers=p;var g=["osg","osgAnimation","osgDB","osgGA","osgUtil","osgViewer","osgShader","osgShadow","osgText","osgWrappers"];f.globalify=function(){g.forEach(function(t){window[t]=f[t]})},t.exports=f},function(t,e,i){"use strict";var r=i(1102);t.exports={name:r.name,version:r.version,author:r.author}},function(t,e){t.exports={devDependencies:{chai:"^3.5.0","grunt-contrib-connect":"~0.9","grunt-documentation":"*","grunt-jsbeautifier":"^0.2.10","grunt-mocha":"^1.0.2","grunt-release":"^0.10.0",mocha:"^2.5.3","webpack-strip-block":"0.0.1","grunt-plato":"~0.2.1"},peerDependencies:{grunt:">=0.4.0"},dependencies:{"grunt-lib-phantomjs":"^1.0.2","webpack-dev-server":"^1.7.0",webpack:"^1.7.3","raw-loader":"^0.5.1",path:"^0.11.14",leapjs:"^0.6.4","json-loader":"^0.5.4",jquery:"^2.1.3",hammerjs:"^2.0.4","grunt-webpack":"^1.0.8","grunt-shell":"*","grunt-git":"*","grunt-eslint":"^17.1.0","grunt-copy-to":"0.0.12","grunt-contrib-uglify":"*","grunt-contrib-jshint":"*","grunt-contrib-copy":"*","grunt-contrib-clean":"*",grunt:"> 1.0.0",glob:"*",extend:"*","eslint-plugin-private-variables":"^0.1.2",eslint:"^1.3.1"},contributors:["Paul Cheyrou-Lagrèze <tuan.kuranes@gmail.com>","Jordi Torres <jtorresfabra@gmail.com>","Matt Fontaine <tehqin@gmail.com>","Stephane Ginier <stephane.ginier@gmail.com>"],version:"0.2.6",author:"Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)",license:"MIT",description:"OpenSceneGraph implementation in javascript",repository:{url:"git@github.com:cedricpinson/osgjs.git",type:"git"},name:"OpenSceneGraph"}},function(t,e,i){"use strict";var r=i(1104),n=i(1152),a=i(1153),s=i(1138),o=i(1113),u=i(1117),h=i(1139),l=i(1154),c=i(1156),d=i(1129),p=i(1127),f=i(1157),g=i(1158),m=i(1155),v=i(1160),_=i(1161),b=i(1184),x=i(1147),A=i(1141),y=i(1142),S=i(1185),C=i(1166),w=i(1186),T=i(1130),M=i(1136),E=i(1135),k=i(1187),I=i(1188),N=i(1194),R=i(1195),F=i(1162),P=i(1196),D=i(1167),L=i(1119),O=i(1149),V=i(1115),B=i(1122),U=i(1126),G=i(1143),z=i(1111),j=i(1121),H=i(1109),W=i(1112),Q=i(1169),Y=i(1159),q=i(1123),X=i(1197),K=i(1140),J=i(1198),Z=i(1144),$=i(1125),tt=i(1164),et=i(1163),it=i(1165),rt=i(1199),nt=i(1200),at=i(1201),st=i(1202),ot=i(1120),ut=i(1107),ht=i(1118),lt=i(1133),ct=i(1203),dt=i(1110),pt=i(1189),ft=i(1134),gt=i(1204),mt=i(1105),vt=i(1168),_t=i(1114),bt=i(1124),xt=i(1205),At=i(1106),yt=i(1128),St=i(1108),Ct=i(1206),wt=i(1131),Tt={};Tt.AutoTransform=r,Tt.BillboardAttribute=n,Tt.BlendColor=a,Tt.BlendFunc=s,Tt.BoundingBox=o,Tt.BoundingSphere=u,Tt.BufferArray=h,Tt.ColorMask=c,Tt.Camera=l,Tt.ColorMask=c,Tt.ComputeBoundsVisitor=d,mt.objectMix(Tt,p),Tt.CullFace=f,Tt.CullingSet=g,Tt.CullSettings=m,Tt.CullStack=v,Tt.CullVisitor=_,Tt.Depth=b,Tt.DrawArrayLengths=x,Tt.DrawArrays=A,Tt.DrawElements=y,Tt.EllipsoidModel=S,Tt.WGS_84_RADIUS_EQUATOR=S.WGS_84_RADIUS_EQUATOR,Tt.WGS_84_RADIUS_POLAR=S.WGS_84_RADIUS_POLAR,Tt.FrameBufferObject=C,Tt.FrameStamp=w,Tt.Geometry=T,Tt.GLObject=M,Tt.Image=E,Tt.ImageStream=k,Tt.KdTree=I,Tt.KdTreeBuilder=N,Tt.Light=R,Tt.LightSource=F,Tt.LineWidth=P,Tt.Lod=D,Tt.Map=L,Tt.Material=O,mt.objectMix(Tt,V),Tt.Matrix=B,Tt.MatrixTransform=G,Tt.MatrixMemoryPool=U,Tt.Node=z,Tt.NodeVisitor=j,mt.objectMix(Tt,H),Tt.Object=W,Tt.PagedLOD=Q,Tt.Plane=q,Tt.Polytope=Y,Tt.PrimitiveSet=K,Tt.PrimitiveFunctor=X,Tt.Program=J,Tt.Projection=Z,Tt.Quat=$,Tt.RenderBin=tt,Tt.RenderLeaf=et,Tt.RenderStage=it,Tt.Shader=rt,mt.objectMix(Tt,nt),Tt.Stack=at,Tt.State=st,Tt.StateAttribute=ot,Tt.StateGraph=ut,Tt.StateSet=ht,Tt.Texture=lt,Tt.TextureCubeMap=ct,Tt.Transform=dt,Tt.TriangleIndexFunctor=pt,Tt.Uniform=ft,Tt.UpdateVisitor=gt,mt.objectMix(Tt,mt),Tt.Vec2=vt,Tt.Vec3=_t,Tt.Vec4=bt,Tt.Viewport=xt,Tt.memoryPools=At.memoryPools,Tt.Transform.RELATIVE_RF=yt.RELATIVE_RF,Tt.Transform.ABSOLUTE_RF=yt.ABSOLUTE_RF,Tt.Timer=St,Tt.TimerGPU=Ct,Tt.WebGLCaps=wt,t.exports=Tt},function(t,e,i){"use strict";var r=i(1105),n=i(1110),a=i(1114),s=i(1124),o=i(1125),u=i(1122),h=i(1121),l=i(1128),c=i(1111),d=function(){n.call(this),this._matrix=u.create(),this._position=a.create(),this._matrixDirty=!0,this._scale=a.createAndSet(1,1,1),this._minimumScale=0,this._maximumScale=Number.MAX_VALUE,this._rotation=o.create(),this._pivotPoint=a.create(),this._autoScaleToScreen=!1,this._autoRotateToScreen=!1,this._cachedMatrix=u.create(),this._firstTimeToInitEyePoint=!0,this._autoScaleTransitionWidthRatio=.25,this._billboardAttribute=void 0,this._previousWidth=0,this._previousHeight=0,this._previousProjection=u.create(),this._previousPosition=a.create()};d.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getMatrix:function(){return this._matrix},setMatrix:function(t){this._matrix=t,this.dirtyBound()},setPosition:function(t){this._position=t,this._matrixDirty=!0,this.dirtyBound()},getPosition:function(){return this._position},setRotation:function(t){this._rotation=t,this._matrixDirty=!0,this.dirtyBound()},getRotation:function(){return this._rotation},setScale:function(t){this.setScaleFromVec3(a.createAndSet(t,t,t))},setScaleFromVec3:function(t){this._scale=t,this._matrixDirty=!0,this.dirtyBound()},getScale:function(){return this._scale},setMinimumScale:function(t){this._minimumScale=t},getMinimumScale:function(){return this._minimumScale},setMaximumScale:function(t){this._maximumScale=t},getMaximumScale:function(){return this._maximumScale},setAutoScaleToScreen:function(t){this._autoScaleToScreen=t,this._matrixDirty=!0},getAutoScaleToScreen:function(){return this._autoScaleToScreen},setAutoRotateToScreen:function(t){this._autoRotateToScreen=t},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setAutoScaleTransitionWidthRatio:function(t){this._autoScaleTransitionWidthRatio=t},getAutoScaleTransitionWidthRatio:function(){return this._autoScaleTransitionWidthRatio},computeLocalToWorldMatrix:function(t){this._matrixDirty&&this.computeMatrix(),this.referenceFrame===l.RELATIVE_RF?u.preMult(t,this._matrix):u.copy(this._matrix,t)},computeMatrix:function(){var t=a.create();return function(){this._matrixDirty&&(u.makeRotateFromQuat(this._rotation,this._matrix),u.postMultTranslate(this._matrix,this._position),u.preMultScale(this._matrix,this._scale),u.preMultTranslate(this._matrix,a.neg(this._pivotPoint,t)),this._matrixDirty=!1)}}(),computeWorldToLocalMatrix:function(){var t=a.create(),e=o.create(),i=a.create();return function(r){return 0===this.scale[0]&&0===this.scale[1]&&0===this.scale[2]?!1:(i[0]=1/this._scale[0],i[1]=1/this._scale[1],i[2]=1/this._scale[2],this.referenceFrame===l.RELATIVE_RF?(u.postMultTranslate(r,a.neg(this._position,t)),o.zeroRotation(this._rotation)||u.postMultRotate(r,o.inverse(this._rotation,e)),u.postMultScale(r,i),u.postMultTranslate(r,this._pivotPoint)):(u.makeRotateFromQuat(o.inverse(this._rotation,e),this._matrix),u.preMultTranslate(r,a.neg(this._position,t)),u.postMultScale(r,i),u.postMultTranslate(r,this._pivotPoint)),!0)}}(),computeBound:function(){var t=u.create();return function(e){return this._autoScaleToScreen&&this._firstTimeToInitEyePoint?e:(c.prototype.computeBound.call(this,e),e.valid()?(u.makeIdentity(t),this.computeLocalToWorldMatrix(t),u.transformBoundingSphere(t,e,e),e):e)}}(),accept:function(){return function(t){if(t.getVisitorType()===h.CULL_VISITOR){var e=t.getViewport().width(),i=t.getViewport().height(),r=t.getCurrentProjectionMatrix(),n=this._position,l=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(e!==this._previousWidth||i!==this._previousHeight?l=!0:u.equal(r,this._previousProjection)?a.equal(n,this._previousPosition)||(l=!0):l=!0),this._firstTimeToInitEyePoint=!1,l){if(this._autoScaleToScreen){var d=t.getCurrentModelViewMatrix(),p=t.getViewport(),f=this.computePixelSizeVector(p,r,d),g=s.createAndSet(this._position[0],this._position[1],this._position[2],1),m=s.dot(g,f);m=.48/m;var v=1/m;if(this._autoScaleTransitionWidthRatio>0){var _,b,x;if(this._minimumScale>0){var A=this._minimumScale,y=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);_=1/(4*(y-A)),b=1-2*_*y,x=A+b*b/(4*_);var S=-b/(2*_);S>v?v=this._minimumScale:y>v&&(v=x+b*v+_*(v*v))}if(this._maximumScale<Number.MAX_VALUE){var C=this._maximumScale,w=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);_=1/(4*(w-C)),b=1-2*_*w,x=C+b*b/(4*_);var T=-b/(2*_);v>T?v=this._maximumScale:v>w&&(v=x+b*v+_*(v*v))}}this.setScale(v)}if(this._autoRotateToScreen){var M=o.create(),E=t.getCurrentModelViewMatrix();u.getRotate(E,M),this.setRotation(o.inverse(M,M))}this._previousWidth=e,this._previousHeight=i,a.copy(n,this._previousPosition),u.copy(r,this._previousProjection)}}c.prototype.accept.call(this,t)}}(),computePixelSizeVector:function(){var t=a.create(),e=a.create();return function(i,r,n){var o=r[0]*i.width()*.5,u=r[8]*i.width()*.5+r[11]*i.width()*.5;a.set(n[0]*o+n[2]*u,n[4]*o+n[6]*u,n[8]*o+n[10]*u,t);var h=r[5]*i.height()*.5,l=r[9]*i.height()*.5+r[11]*i.height()*.5;a.set(n[1]*h+n[2]*l,n[5]*h+n[6]*l,n[9]*h+n[10]*l,e);var c=r[11],d=r[15],p=s.createAndSet(n[2]*c,n[6]*c,n[10]*c,n[14]*c+n[15]*d),f=.7071067811/Math.sqrt(a.length2(t)+a.length2(e));return s.mult(p,f,p),p}}()}),"osg","AutoTransform"),r.setTypeID(d),t.exports=d},function(t,e,i){"use strict";var r=i(1106),n=i(1107),a=i(1108),s=i(1109);window.Object.keys(n);var o={};o.init=function(){var t=i(1107);r.memoryPools.stateGraph=new r.OsgObjectMemoryPool(t).grow(50)},o.isArray=function(t){return s.log("isArray is deprecated, use instead Array.isArray"),Array.isArray(t)},o.extend=function(){var t,e,i,r,n=window.Object.prototype.toString,a=window.Object.prototype.hasOwnProperty,s=function(t){return"[object Function]"===n.call(t)},u=o.isArray,h=function(t){if(!t||"[object Object]"!==n.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!a.call(t,"constructor")&&!a.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||a.call(t,e)},l=arguments[0]||{},c=1,d=arguments.length,p=!1;for("boolean"==typeof l&&(p=l,l=arguments[1]||{},c=2),"object"==typeof l||s(l)||(l={}),d===c&&(l=this,--c);d>c;c++)if(null!==(t=arguments[c]))for(e in t)if(i=l[e],r=t[e],l!==r)if(p&&r&&(h(r)||u(r))){var f=i&&(h(i)||u(i))?i:u(r)?[]:{};l[e]=o.extend(p,f,r)}else void 0!==r&&(l[e]=r);return l},o.objectInherit=function(t){function e(){}e.prototype=t;for(var i=new e,r=1;r<arguments.length;r++)o.objectMix(i,arguments[r],!1);return i},o.objectInehrit=function(){console.warn("please use objectInherit instead of objectInehrit")},o.objectMix=function(t,e,i){for(var r in e)i&&t[r]||(t[r]=e[r]);return t},o.objectType={},o.objectType.type=0,o.objectType.generate=function(t){var e=o.objectType.type;return o.objectType[e]=t,o.objectType[t]=e,
o.objectType.type+=1,e},o.objectLibraryClass=function(t,e,i){t.className=function(){return i},t.libraryName=function(){return e};var r=e+"::"+i;return t.libraryClassName=function(){return r},t},o.setTypeID=function(t){var e=t.prototype.libraryClassName(),i=o.objectType.generate(e),r=function(){return i};t.typeID=t.prototype.typeID=i,t.getTypeID=t.prototype.getTypeID=r},o.createPrototypeClass=function(t,e,i,r){t.prototype=e,e.constructor=t,o.objectLibraryClass(e,i,r),o.setTypeID(t)},o.Float32Array="undefined"!=typeof Float32Array?Float32Array:null,o.Int32Array="undefined"!=typeof Int32Array?Int32Array:null,o.Uint8Array="undefined"!=typeof Uint8Array?Uint8Array:null,o.Uint16Array="undefined"!=typeof Uint16Array?Uint16Array:null,o.Uint32Array="undefined"!=typeof Uint32Array?Uint32Array:null;var u={};o.time=(s.console.time||function(t){u[t]=a.instance().tick()}).bind(s.console),o.timeEnd=(s.console.timeEnd||function(t){if(void 0!==u[t]){var e=a.instance().deltaM(u[t],a.instance().tick());s.debug(t+": "+e+"ms"),u[t]=void 0}}).bind(s.console),o.timeStamp=(s.console.timeStamp||s.console.markTimeline||function(){}).bind(s.console),o.profile=(s.console.profile||function(){}).bind(s.console),o.profileEnd=(s.console.profileEnd||function(){}).bind(s.console),t.exports=o},function(t,e){"use strict";var i={};i.memoryPools={},i.OsgObjectMemoryPool=function(t){return{_memPool:[],reset:function(){return this._memPool=[],this},put:function(t){this._memPool.push(t)},get:function(){return this._memPool.length>0?this._memPool.pop():(this.grow(),this.get())},grow:function(e){var i;i=void 0===e?this._memPool.length>0?2*this._memPool.length:20:e;for(var r=this._memPool.length;r++<i;)this._memPool.push(new t);return this}}},i.OsgArrayMemoryPool=function(){return{_mempoolofPools:[],reset:function(){return this._memPoolofPools={},this},put:function(t){this._memPoolofPools[t.length]||(this._memPoolofPools[t.length]=[]),this._memPoolofPools[t.length].push(t)},get:function(t){if(this._memPoolofPools[t]){if(this._memPoolofPools.length>0)return this._memPool.pop()}else this._memPoolofPools[t]=[];return this.grow(t),this.get()},grow:function(t,e){void 0===e&&(e=this._memPool.length>0?2*this._memPool.length:5);for(var i=this._memPool.length;i++<e;)this._memPool.push(new Array(t));return this}}},i.OsgObjectMemoryStack=function(t){return{_current:0,_memPool:[new t],reset:function(){return this._current=0,this},get:function(){var e=this._memPool[this._current++];return this._current>=this._memPool.length&&this._memPool.push(new t),e}}},t.exports=i},function(t,e,i){"use strict";var r=i(1106),n=function(){this.depth=0,this.children={},this.children.keys=[],this.leafs=[],this.stateset=void 0,this.parent=void 0};n.prototype={clean:function(){this.leafs.length=0,this.stateset=void 0,this.parent=void 0,this.depth=0;for(var t,e,i=this.children,n=i.keys,a=0,s=n.length;s>a;a++)e=n[a],t=i[e],t.clean(),r.memoryPools.stateGraph.put(t);this.children={},n.length=0,this.children.keys=n},getStateSet:function(){return this.stateset},findOrInsert:function(t){var e,i=t.getInstanceID(),n=this.children;return n[i]?e=n[i]:(e=r.memoryPools.stateGraph.get(),e.parent=this,e.depth=this.depth+1,e.stateset=t,n[i]=e,n.keys.push(i)),e}},n.moveStateGraph=function(t,e,i){var r,n,a=[],s=i,o=e;if(s!==o&&void 0!==s)if(void 0!==o){if(o.parent===s.parent)return void 0!==o.stateset&&t.popStateSet(),void(void 0!==s.stateset&&t.pushStateSet(s.stateset));for(;o.depth>s.depth;)void 0!==o.stateset&&t.popStateSet(),o=o.parent;for(a=[];s.depth>o.depth;)void 0!==s.stateset&&a.push(s.stateset),s=s.parent;for(;o!==s;)void 0!==o.stateset&&t.popStateSet(),o=o.parent,void 0!==s.stateset&&a.push(s.stateset),s=s.parent;for(r=a.length-1,n=0;r>=n;--r)t.pushStateSet(a[r])}else{do void 0!==s.stateset&&a.push(s.stateset),s=s.parent;while(s);for(r=a.length-1,n=0;r>=n;--r)t.pushStateSet(a[r])}},t.exports=n},function(t,e){"use strict";var i=function(){var t=window||global;if(void 0===t.performance)return function(){return Date.now()};var e=t.performance.now||t.performance.mozNow||t.performance.msNow||t.performance.oNow||t.performance.webkitNow||function(){return Date.now()};return function(){return e.apply(t.performance,arguments)}}(),r=function(){};r.instance=function(){return r._instance||(r._instance=new r),r._instance},r.prototype={deltaS:function(t,e){return(e-t)/1e3},deltaM:function(t,e){return e-t},tick:function(){return i()}},t.exports=r},function(t,e){"use strict";function i(t,e){o.console&&(o.console[t](e),o.traceLogCall&&"error"!==t&&console.trace())}function r(t,e,i){o.console&&(o.console.groupCollapsed&&o.console.groupCollapsed(e),o.console[t](i),o.traceLogCall&&"error"!==t&&console.trace(),o.console.groupEnd&&o.console.groupEnd())}function n(t,e){return e?[t.slice(0,4),t.slice(4,8),t.slice(8,12),t.slice(12,16)]:[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]}function a(t,e){o.console.table&&i("table",n(t,e))}function s(t,e,i){o.console.table&&r("table",t,n(e,i))}var o={};o.DEBUG=0,o.INFO=1,o.NOTICE=o.LOG=2,o.WARN=3,o.ERROR=4,o.console=window.console;for(var u=["log","info","warn","error","debug"],h={},l=0;l<u.length;++l){var c=u[l];h[c]=i.bind(o,c),h[c+"Fold"]=r.bind(o,c),h[c+"Matrix"]=a.bind(o),h[c+"MatrixFold"]=s.bind(o)}var d=function(t,e){void 0===this.console||t||this.console.assert(t,e)};o.assert=d,o.setNotifyLevel=function(t){for(var e=function(){},i=0;i<u.length;++i){var r=u[i],n=t>o[r.toUpperCase()];o[r]=n?e:h[r],o[r+"Fold"]=n?e:h[r+"Fold"],o[r+"Matrix"]=n?e:h[r+"Matrix"],o[r+"MatrixFold"]=n?e:h[r+"MatrixFold"]}o.notice=o.log,o.noticeFold=o.logFold,o.noticeMatrix=o.logMatrix,o.noticeMatrixFold=o.logMatrixFold},o.setNotifyLevel(o.NOTICE),o.reportWebGLError=!1,o.setConsole=function(t){o.console=t},t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1111),a=i(1122),s=i(1128),o=function(){n.call(this),this.referenceFrame=s.RELATIVE_RF};o.prototype=r.objectInherit(n.prototype,{setReferenceFrame:function(t){this.referenceFrame=t},getReferenceFrame:function(){return this.referenceFrame},computeBoundingSphere:function(){var t=a.create();return function(e){return n.prototype.computeBoundingSphere.call(this,e),e.valid()?(a.makeIdentity(t),this.computeLocalToWorldMatrix(t),a.transformBoundingSphere(t,e,e),e):e}}()}),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1112),a=i(1113),s=i(1117),o=i(1118),u=i(1121),h=i(1109),l=i(1122),c=i(1126),d=i(1127),p=i(1128),f=function(){n.call(this),this.children=[],this._parents=[],this.nodeMask=-1,this._boundingSphere=new s,this._boundingSphereComputed=!1,this._boundingBox=new a,this._boundingBoxComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0,this._cullingActive=!0,this._numChildrenWithCullingDisabled=0,this._numChildrenRequiringUpdateTraversal=0,this._tmpBox=new a};f._reservedMatrixStack=new c;var g=function(){var t=f._reservedMatrixStack.get.bind(f._reservedMatrixStack);return l.makeIdentity(t)};f.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getOrCreateStateSet:function(){return this.stateset||this.setStateSet(new o),this.stateset},getStateSet:function(){return this.stateset},accept:function(t){t.validNodeMask(this)&&(t.pushOntoNodePath(this),t.apply(this),t.popFromNodePath())},dirtyBound:function(){if(this._boundingSphereComputed===!0||this._boundingBoxComputed===!0){this._boundingSphereComputed=!1,this._boundingBoxComputed=!1;for(var t=this._parents,e=0,i=t.length;i>e;e++)t[e].dirtyBound()}},setNodeMask:function(t){this.nodeMask=t},getNodeMask:function(){return this.nodeMask},setStateSet:function(t){if(this.stateset!==t){var e=0;this.stateset&&(this.stateset.requiresUpdateTraversal()&&e--,this.stateset.removeParent(this)),t&&(t.addParent(this),t.requiresUpdateTraversal()&&++e),0!==e&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+e),this.stateset=t}},_updateNumChildrenRequeringUpdateTraversal:function(t){if(0===this._numChildrenRequiringUpdateTraversal&&this._parents.length)for(var e=0,i=this._parents.length;i>e;e++){var r=this._parents[e],n=r.getNumChildrenRequiringUpdateTraversal();r.setNumChildrenRequiringUpdateTraversal(n+t)}},setNumChildrenRequiringUpdateTraversal:function(t){if(this._numChildrenRequiringUpdateTraversal!==t){if(!this._updateCallbacks.length&&this._parents.length){var e=0;if(this._numChildrenRequiringUpdateTraversal>0&&--e,t>0&&++e,0!==e)for(var i=this._parents,r=0,n=i.length;n>r;r++){var a=i[r],s=a.getNumChildrenRequiringUpdateTraversal();a.setNumChildrenRequiringUpdateTraversal(s+e)}}this._numChildrenRequiringUpdateTraversal=t}},getNumChildrenRequiringUpdateTraversal:function(){return this._numChildrenRequiringUpdateTraversal},setUpdateCallback:function(t){if(h.warn("deprecated use instead addUpdateCallback/removeUpdateCallback"),t!==this._updateCallbacks[0]&&t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.length?this._updateCallbacks[0]=t:this.addUpdateCallback(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)}},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.push(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)},removeUpdateCallback:function(t){var e=this._updateCallbacks.indexOf(t);-1!==e&&(this._updateCallbacks.splice(e,1),this._updateCallbacks.length||this._updateNumChildrenRequeringUpdateTraversal(-1))},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(t){this._cullCallback=t},getCullCallback:function(){return this._cullCallback},hasChild:function(t){for(var e=0,i=this.children.length;i>e;e++)if(this.children[e]===t)return!0;return!1},addChild:function(t){return-1===this.children.indexOf(t)?(this.children.push(t),t.addParent(this),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+1),t):void 0},getChildren:function(){return this.children},getNumChildren:function(){return this.children.length},getChild:function(t){return this.children[t]},getParents:function(){return this._parents},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);-1!==e&&this._parents.splice(e,1)},removeChildren:function(){var t=this.children,e=t.length;if(e){for(var i=0,r=0;e>r;r++){var n=t[r];n.removeParent(this),(n.getNumChildrenRequiringUpdateTraversal()>0||n.getUpdateCallbackList().length)&&++i}t.length=0,i&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-i),this.dirtyBound()}},removeChild:function(t){var e=this.children,i=e.indexOf(t);-1!==i&&(t.removeParent(this),e.splice(i,1),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-1))},traverse:function(t){for(var e=this.children,i=0,r=e.length;r>i;i++){var n=e[i];n.accept(t)}},ascend:function(t){for(var e=this._parents,i=0,r=e.length;r>i;i++){var n=e[i];n.accept(t)}},getBoundingBox:function(){return this._boundingBoxComputed||(this.computeBoundingBox(this._boundingBox),this._boundingBoxComputed=!0),this._boundingBox},computeBoundingBox:function(t){var e=i(1129),r=e.instance=e.instance||new e;return r.setNodeMaskOverride(-1),r.reset(),r.apply(this),t.copy(r.getBoundingBox()),t},getBoundingSphere:function(){return this.getBound()},getBound:function(){return this._boundingSphereComputed||(this.computeBoundingSphere(this._boundingSphere),this._boundingSphereComputed=!0),this._boundingSphere},computeBoundingSphere:function(t){var e=this.children,i=e.length;if(t.init(),0===i)return t;var r,n,a=this._tmpBox;for(a.init(),n=0;i>n;n++)r=e[n],r.referenceFrame!==p.ABSOLUTE_RF&&a.expandByBoundingSphere(r.getBound());if(!a.valid())return t;for(t.set(a.center(t.center()),0),n=0;i>n;n++)r=e[n],r.referenceFrame!==p.ABSOLUTE_RF&&t.expandRadiusBySphere(r.getBound());return t},getWorldMatrices:function(){var t=function(){this.nodePaths=[],this.halt=void 0,u.call(this,u.TRAVERSE_PARENTS)};t.prototype=r.objectInherit(u.prototype,{reset:function(){this.nodePath.length=0,this.nodePaths.length=0},apply:function(t){0===t._parents.length||t===this.halt||t.referenceFrame===p.ABSOLUTE_RF?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(t)}});var e=new t;return e.setNodeMaskOverride(-1),function(t,i){e.reset(),e.halt=t,this.accept(e);for(var r=[],n=i||l.create,a=0,s=e.nodePaths.length;s>a;a++){var o=e.nodePaths[a],u=n();0!==o.length&&d.computeLocalToWorld(o,!0,u),r.push(u)}return r}}(),getWorldMatrix:function(t,e){var i=this.getWorldMatrices(t,g);return 0===i.length?l.makeIdentity(e):l.copy(i[0],e),f._reservedMatrixStack.reset(),e},setCullingActive:function(t){if(this._cullingActive!==t){if(0===this._numChildrenWithCullingDisabled&&this._parents.length>0){var e=0;if(this._cullingActive||--e,t||++e,0!==e)for(var i=0,r=this._parents.length;r>i;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+e)}this._cullingActive=t}},getCullingActive:function(){return this._cullingActive},isCullingActive:function(){return 0===this._numChildrenWithCullingDisabled&&this._cullingActive&&this.getBound().valid()},setNumChildrenWithCullingDisabled:function(t){if(this._numChildrenWithCullingDisabled!==t){if(this._cullingActive&&this._parents.length>0){var e=0;if(this._numChildrenWithCullingDisabled>0&&--e,t>0&&++e,0!==e)for(var i=0,r=this._parents.length;r>i;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+e)}this._numChildrenWithCullingDisabled=t}},getNumChildrenWithCullingDisabled:function(){return this._numChildrenWithCullingDisabled},releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects()}}),"osg","Node"),r.setTypeID(f),t.exports=f},function(t,e,i){"use strict";var r=i(1105),n=function(){this._name=void 0,this._userdata=void 0,this._instanceID=n.getInstanceID()};n.prototype=r.objectLibraryClass({cloneType:function(){var t=this.constructor;return new t},getInstanceID:function(){return this._instanceID},setName:function(t){this._name=t},getName:function(){return this._name},setUserData:function(t){this._userdata=t},getUserData:function(){return this._userdata}},"osg","Object");var a=0;n.getInstanceID=function(){return a+=1},t.exports=n},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1114),s=function(){this._min=a.create(),this._max=a.create(),this.init()};s.prototype=n.objectLibraryClass({init:function(){a.copy(a.infinity,this._min),a.copy(a.negativeInfinity,this._max)},copy:function(t){var e=this._min,i=t._min;e[0]=i[0],e[1]=i[1],e[2]=i[2];var r=this._max,n=t._max;r[0]=n[0],r[1]=n[1],r[2]=n[2]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandByBoundingSphere:function(t){if(t.valid()){var e=this._max,i=this._min,r=t._radius,n=t._center[0],a=t._center[1],s=t._center[2];i[0]=Math.min(i[0],n-r),i[1]=Math.min(i[1],a-r),i[2]=Math.min(i[2],s-r),e[0]=Math.max(e[0],n+r),e[1]=Math.max(e[1],a+r),e[2]=Math.max(e[2],s+r)}},expandBySphere:function(t){return r.log("BoundingBox.expandBySphere is deprecated, use instead BoundBox.expandByBoundingSphere"),this.expandByBoundingSphere(t)},expandByVec3:function(t){var e=this._min,i=this._max;e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),i[0]=Math.max(i[0],t[0]),i[1]=Math.max(i[1],t[1]),i[2]=Math.max(i[2],t[2])},expandByBoundingBox:function(t){if(t.valid()){var e=this._min,i=this._max,r=t._min,n=t._max;r[0]<e[0]&&(e[0]=r[0]),n[0]>i[0]&&(i[0]=n[0]),r[1]<e[1]&&(e[1]=r[1]),n[1]>i[1]&&(i[1]=n[1]),r[2]<e[2]&&(e[2]=r[2]),n[2]>i[2]&&(i[2]=n[2])}},center:function(t){var e=this._min,i=this._max;return t[0]=.5*(e[0]+i[0]),t[1]=.5*(e[1]+i[1]),t[2]=.5*(e[2]+i[2]),t},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var t=this._min,e=this._max,i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return.25*(i*i+r*r+n*n)},getMin:function(){return this._min},getMax:function(){return this._max},setMin:function(t){return a.copy(t,this._min),this},setMax:function(t){return a.copy(t,this._max),this},xMax:function(){return this._max[0]},yMax:function(){return this._max[1]},zMax:function(){return this._max[2]},xMin:function(){return this._min[0]},yMin:function(){return this._min[1]},zMin:function(){return this._min[2]},corner:function(t,e){return 1&t?e[0]=this._max[0]:e[0]=this._min[0],2&t?e[1]=this._max[1]:e[1]=this._min[1],4&t?e[2]=this._max[2]:e[2]=this._min[2],e}},"osg","BoundingBox"),t.exports=s},function(t,e,i){"use strict";var r=i(1115),n=i(1116),a=n.ArrayType,s={create:function(){var t=new a(3);return t[0]=0,t[1]=0,t[2]=0,t},createAndSet:function(t,e,i){var r=new a(3);return r[0]=t,r[1]=e,r[2]=i,r},init:function(t){return t[0]=0,t[1]=0,t[2]=0,t},set:function(t,e,i,r){return r[0]=t,r[1]=e,r[2]=i,r},copy:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},cross:function(t,e,i){var r=t[1]*e[2]-t[2]*e[1],n=t[2]*e[0]-t[0]*e[2],a=t[0]*e[1]-t[1]*e[0];return i[0]=r,i[1]=n,i[2]=a,i},valid:function(t){return r.isNaN(t[0])?!1:r.isNaN(t[1])?!1:r.isNaN(t[2])?!1:!0},mult:function(t,e,i){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i},length2:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},distance2:function(t,e){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n},distance:function(t,e){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)},normalize:function(t,e){var i=this.length2(t);if(i>0){var r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}else e[0]=t[0],e[1]=t[1],e[2]=t[2];return e},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},sub:function(t,e,i){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i},add:function(t,e,i){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i},neg:function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},lerp:function(t,e,i,r){return r[0]=e[0]+(i[0]-e[0])*t,r[1]=e[1]+(i[1]-e[1])*t,r[2]=e[2]+(i[2]-e[2])*t,r},equal:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}};s.zero=s.create(),s.one=s.createAndSet(1,1,1),s.infinity=s.createAndSet(1/0,1/0,1/0),s.negativeInfinity=s.createAndSet(-(1/0),-(1/0),-(1/0)),t.exports=s},function(t,e){"use strict";var i=function(t,e,i){return Math.min(i,Math.max(e,t))},r=function(t,e,r){var n=i((r-t)/(e-t),0,1);return n*n*(3-2*n)},n=function(t){return t!==t};t.exports={clamp:i,smoothStep:r,isNaN:n}},function(t,e){"use strict";t.exports={ArrayType:Float64Array}},function(t,e,i){"use strict";var r=i(1113),n=i(1109),a=i(1114),s=function(){this._center=a.create(),this._radius=-1};s.prototype={init:function(){a.init(this._center),this._radius=-1},valid:function(){return this._radius>=0},set:function(t,e){this._center=t,this._radius=e},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBoundingBox:function(){var t=a.create(),e=new r;return function(i){if(i.valid())if(this.valid()){a.copy(i._min,e._min),a.copy(i._max,e._max);for(var r=0;8>r;r++)a.sub(i.corner(r,t),this._center,t),a.normalize(t,t),a.mult(t,-this._radius,t),a.add(t,this._center,t),e.expandByVec3(t);e.center(this._center),this._radius=e.radius()}else i.center(this._center),this._radius=i.radius()}}(),expandByBox:function(t){return n.log("BoundingSphere.expandByBox is deprecated, use instead BoundingSphere.expandByBoundingBox"),this.expandByBoundingBox(t)},expandByVec3:function(){var t=a.create();return function(e){if(this.valid()){a.sub(e,this.center(t),t);var i=a.length(t);if(i>this.radius()){var r=.5*(i-this.radius());this._center[0]+=t[0]*(r/i),this._center[1]+=t[1]*(r/i),this._center[2]+=t[2]*(r/i),this._radius+=r}}else this._center[0]=e[0],this._center[1]=e[1],this._center[2]=e[2],this._radius=0}}(),expandRadiusBySphere:function(t){if(t.valid())if(this.valid()){var e=a.distance(t._center,this._center)+t._radius;e>this._radius&&(this._radius=e)}else a.copy(t._center,this._center),this._radius=t._radius},expandBy:function(t){n.log("BoundingSphere.expandBy is deprecated, use instead BoundingSphere.expandByBoundingSphere"),this.expandByBoundingSphere(t)},expandByBoundingSphere:function(t){if(t.valid()){if(!this.valid())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t.radius());var e=a.distance(this.center(),t.center());if(!(e+t.radius()<=this.radius())){if(e+this.radius()<=t.radius())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t._radius);var i=.5*(this.radius()+e+t.radius()),r=(i-this.radius())/e;this._center[0]+=(t._center[0]-this._center[0])*r,this._center[1]+=(t._center[1]-this._center[1])*r,this._center[2]+=(t._center[2]-this._center[2])*r,this._radius=i}}},contains:function(t){return this.valid()?a.distance2(t,this.center())<=this.radius2():!1},intersects:function(t){if(!this.valid()||!t.valid())return!1;var e=this.radius()+t.radius();return a.distance2(this.center(),t.center())<=e*e}},t.exports=s},function(t,e,i){"use strict";var r=i(1119),n=i(1109),a=i(1112),s=i(1120),o=i(1105),u=function(){a.call(this),this._parents=[],this.attributeMap=new r,this.textureAttributeMapList=[],this._binName=void 0,this._binNumber=0,this._shaderGeneratorPair=null,this._updateCallbackList=[],this.uniforms=new r};u.AttributePair=function(t,e){this._object=t,this._value=e},u.AttributePair.prototype={getShaderGeneratorName:function(){return this._object},getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},u.prototype=o.objectLibraryClass(o.objectInherit(a.prototype,{getAttributePair:function(t,e){return new u.AttributePair(t,e)},addUniform:function(t,e){var i=void 0!==e?e:s.ON,r=t.getName();this.uniforms[r]=this.getAttributePair(t,i),this.uniforms.dirty()},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);-1!==e&&this._parents.splice(e,1)},removeUniform:function(t){this.uniforms.remove(t.getName())},removeUniformByName:function(t){this.uniforms.remove(t)},getUniform:function(t){var e=this.uniforms;return e[t]?e[t].getAttribute():void 0},getUniformList:function(){return this.uniforms},setTextureAttributeAndModes:function(t,e,i){var r=void 0!==i?i:s.ON;this._setTextureAttribute(t,this.getAttributePair(e,r))},setTextureAttributeAndMode:function(t,e,i){n.log("StateSet.setTextureAttributeAndMode is deprecated, insteady use setTextureAttributeAndModes"),this.setTextureAttributeAndModes(t,e,i)},getNumTextureAttributeLists:function(){return this.textureAttributeMapList.length},getTextureAttribute:function(t,e){if(void 0!==this.textureAttributeMapList[t]){var i=this.textureAttributeMapList[t];if(void 0!==i[e])return i[e].getAttribute()}},removeTextureAttribute:function(t,e){if(void 0!==this.textureAttributeMapList[t]){var i=this.textureAttributeMapList[t];void 0!==i[e]&&(i.remove(e),this.textureAttributeMapList[t].dirty())}},getAttribute:function(t){return void 0!==this.attributeMap[t]?this.attributeMap[t].getAttribute():void 0},setAttributeAndModes:function(t,e){var i=void 0!==e?e:s.ON;this._setAttribute(this.getAttributePair(t,i))},setAttributeAndMode:function(t,e){n.log("StateSet.setAttributeAndMode is deprecated, insteady use setAttributeAndModes"),this.setAttributeAndModes(t,e)},setAttribute:function(t,e){var i=void 0!==e?e:s.ON;this._setAttribute(this.getAttributePair(t,i))},removeAttribute:function(t){void 0!==this.attributeMap[t]&&(delete this.attributeMap[t],this.attributeMap.dirty())},setRenderingHint:function(t){"OPAQUE_BIN"===t?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===t?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},getUpdateCallbackList:function(){return this._updateCallbackList},removeUpdateCallback:function(t){var e=this._updateCallbackList.indexOf(t);if(-1!==e&&(this._updateCallbackList.splice(e,1),0===this._updateCallbackList.length))for(var i=this._parents,r=0,n=i.length;n>r;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()-1)}},requiresUpdateTraversal:function(){return!!this._updateCallbackList.length},addUpdateCallback:function(t){var e=Boolean(this._updateCallbackList.length);if(this._updateCallbackList.push(t),!e)for(var i=this._parents,r=0,n=i.length;n>r;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()+1)}},hasUpdateCallback:function(t){return-1!==this._updateCallbackList.indexOf(t)},setRenderBinDetails:function(t,e){this._binNumber=t,this._binName=e},getAttributeMap:function(){return this.attributeMap},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(t){this._binNumber=t},setBinName:function(t){this._binName=t},getAttributeList:function(){for(var t=this.attributeMap,e=t.getKeys(),i=e.length,r=[],n=0;i>n;n++)r.push(t[e[n]]);return r},setShaderGeneratorName:function(t,e){this._shaderGeneratorPair=this.getAttributePair(t,e)},getShaderGeneratorPair:function(){return this._shaderGeneratorPair},getShaderGeneratorName:function(){return this._shaderGeneratorPair?this._shaderGeneratorPair.getShaderGeneratorName():void 0},releaseGLObjects:function(){for(var t=0,e=this.textureAttributeMapList.length;e>t;t++)this.getTextureAttribute(t,"Texture").releaseGLObjects();var i=this.getAttributeList();for(t=0,e=i.length;e>t;t++)i[t]._object.releaseGLObjects&&i[t]._object.releaseGLObjects()},_getUniformMap:function(){return this.uniforms},_setTextureAttribute:function(t,e){void 0===this.textureAttributeMapList[t]&&(this.textureAttributeMapList[t]=new r);var i=e.getAttribute().getTypeMember(),n=this.textureAttributeMapList[t];n[i]=e,n.dirty()},_setAttribute:function(t){var e=t.getAttribute().getTypeMember();this.attributeMap[e]=t,this.attributeMap.dirty()}}),"osg","StateSet"),t.exports=u},function(t,e){"use strict";var i=function(t){window.Object.defineProperty(this,"_dirty",{configurable:!0,enumerable:!1,writable:!0,value:!0}),window.Object.defineProperty(this,"_keys",{configurable:!0,enumerable:!1,writable:!0,value:void 0}),t&&this.setMap(t)};i.prototype={getKeys:function(){return this._dirty&&(this._keys=window.Object.keys(this),this._dirty=!1),this._keys},dirty:function(){this._dirty=!0},remove:function(t){delete this[t],this.dirty(),this.getKeys()},setMap:function(t){var e,i,r=window.Object.keys(this);if(r.length>0)for(e=0,i=r.length;i>e;e++)delete this[r[e]];if(r=window.Object.keys(t),r.length>0)for(e=0,i=r.length;i>e;e++){var n=r[e];this[n]=t[n]}this.dirty()}},t.exports=i},function(t,e,i){"use strict";var r=i(1105),n=i(1112),a=function(){n.call(this)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(){},getHash:function(){return this.getTypeMember()}}),"osg","StateAttribute"),a.OFF=0,a.ON=1,a.OVERRIDE=2,a.PROTECTED=4,a.INHERIT=8,t.exports=a},function(t,e){"use strict";var i=function(t){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=t,void 0===t&&(this.traversalMode=i.TRAVERSE_ALL_CHILDREN),this.nodePath=[],this.visitorType=i.NODE_VISITOR,this._databaseRequestHandler=void 0,this._frameStamp=void 0,this.traverse=i._traversalFunctions[this.traversalMode],this.pushOntoNodePath=i._pushOntoNodePath[this.traversalMode],this.popFromNodePath=i._popFromNodePath[this.traversalMode]};i.TRAVERSE_PARENTS=1,i.TRAVERSE_ALL_CHILDREN=2,i.TRAVERSE_ACTIVE_CHILDREN=3,i.NODE_VISITOR=0,i.UPDATE_VISITOR=1,i.CULL_VISITOR=2;var r=function(t){t.ascend(this)},n=function(t){t.traverse(this)};i._traversalFunctions=[void 0,r,n,n];var a=function(t){this.nodePath.unshift(t)},s=function(t){this.nodePath.push(t)};i._pushOntoNodePath=[void 0,a,s,s];var o=function(){return this.nodePath.shift()},u=function(){this.nodePath.pop()};i._popFromNodePath=[void 0,o,u,u],i.prototype={reset:function(){this.nodePath.length=0},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setNodeMaskOverride:function(t){this.nodeMaskOverride=t},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(t){this.traversalMask=t},getTraversalMask:function(){return this.traversalMask},getNodePath:function(){return this.nodePath},pushOntoNodePath:function(t){i._pushOntoNodePath[this.traversalMode].call(this,t)},popFromNodePath:function(){i._popFromNodePath[this.traversalMode].call(this)},validNodeMask:function(t){var e=t.getNodeMask();return 0!==(this.traversalMask&(this.nodeMaskOverride|e))},apply:function(t){this.traverse(t)},traverse:function(t){i._traversalFunctions[this.traversalMode].call(this,t)},getVisitorType:function(){return this.visitorType},setDatabaseRequestHandler:function(t){this._databaseRequestHandler=t},getDatabaseRequestHandler:function(){return this._databaseRequestHandler}},t.exports=i},function(t,e,i){"use strict";var r=i(1109),n=i(1115),a=i(1113),s=i(1123),o=i(1125),u=i(1114),h=i(1116),l=h.ArrayType,c=Math.abs,d=Number.MIN_VALUE,p=function(){var t=new l(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},f={create:function(){var t=new l(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},createAndSet:function(t,e,i,r,n,a,s,o,u,h,c,d,p,f,g,m){var v=new l(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=n,v[5]=a,v[6]=s,v[7]=o,v[8]=u,v[9]=h,v[10]=c,v[11]=d,v[12]=p,v[13]=f,v[14]=g,v[15]=m,v},isIdentity:function(t){for(var e=0;16>e;e++)if(t[e]!==f.identity[e])return!1;return!0},valid:function(t){for(var e=0;16>e;e++)if(n.isNaN(t[e]))return!1;return!0},setRow:function(t,e,i,r,n,a){var s=4*e;t[s+0]=i,t[s+1]=r,t[s+2]=n,t[s+3]=a},innerProduct:function(t,e,i,r){var n=4*i;return t[n+0]*e[0+r]+t[n+1]*e[4+r]+t[n+2]*e[8+r]+t[n+3]*e[12+r]},set:function(t,e,i,r){return t[4*e+i]=r,r},get:function(t,e,i){return t[4*e+i]},makeIdentity:function(t){return f.copy(f.identity,t),t},equal:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},makeTranslate:function(t,e,i,r){return f.setRow(r,0,1,0,0,0),f.setRow(r,1,0,1,0,0),f.setRow(r,2,0,0,1,0),f.setRow(r,3,t,e,i,1),r},setTrans:function(t,e,i,r){return t[12]=e,t[13]=i,t[14]=r,t},getTrans:function(t,e){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},preMult:function(t,e){var i,r,n,a,s=t[0],o=t[1],u=t[2],h=t[3],l=t[4],c=t[5],d=t[6],p=t[7],f=t[8],g=t[9],m=t[10],v=t[11],_=t[12],b=t[13],x=t[14],A=t[15],y=e[0],S=e[1],C=e[2],w=e[3],T=e[4],M=e[5],E=e[6],k=e[7],I=e[8],N=e[9],R=e[10],F=e[11],P=e[12],D=e[13],L=e[14],O=e[15];return i=y*s+S*l+C*f+w*_,r=T*s+M*l+E*f+k*_,n=I*s+N*l+R*f+F*_,a=P*s+D*l+L*f+O*_,t[0]=i,t[4]=r,t[8]=n,t[12]=a,i=y*o+S*c+C*g+w*b,r=T*o+M*c+E*g+k*b,n=I*o+N*c+R*g+F*b,a=P*o+D*c+L*g+O*b,t[1]=i,t[5]=r,t[9]=n,t[13]=a,i=y*u+S*d+C*m+w*x,r=T*u+M*d+E*m+k*x,n=I*u+N*d+R*m+F*x,a=P*u+D*d+L*m+O*x,t[2]=i,t[6]=r,t[10]=n,t[14]=a,i=y*h+S*p+C*v+w*A,r=T*h+M*p+E*v+k*A,n=I*h+N*p+R*v+F*A,a=P*h+D*p+L*v+O*A,t[3]=i,t[7]=r,t[11]=n,t[15]=a,t},postMult:function(t,e){var i,r,n,a;return i=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],r=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],n=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],a=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],e[0]=i,e[1]=r,e[2]=n,e[3]=a,i=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],r=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],n=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],a=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],e[4]=i,e[5]=r,e[6]=n,e[7]=a,i=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],
r=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],n=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],a=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],e[8]=i,e[9]=r,e[10]=n,e[11]=a,i=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],r=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],n=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],a=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],e[12]=i,e[13]=r,e[14]=n,e[15]=a,e},multa:function(t,e,i){return i===t?f.preMult(t,e):i===e?f.postMult(t,e):(i[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],i[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],i[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],i[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],i[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],i[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],i[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],i[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],i[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],i[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],i[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],i[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],i[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],i[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],i[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],i[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],i)},mult:function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=e[6],l=e[7],c=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14],_=e[15],b=t[0],x=t[1],A=t[2],y=t[3],S=t[4],C=t[5],w=t[6],T=t[7],M=t[8],E=t[9],k=t[10],I=t[11],N=t[12],R=t[13],F=t[14],P=t[15];return i[0]=r*b+n*S+a*M+s*N,i[1]=r*x+n*C+a*E+s*R,i[2]=r*A+n*w+a*k+s*F,i[3]=r*y+n*T+a*I+s*P,i[4]=o*b+u*S+h*M+l*N,i[5]=o*x+u*C+h*E+l*R,i[6]=o*A+u*w+h*k+l*F,i[7]=o*y+u*T+h*I+l*P,i[8]=c*b+d*S+p*M+f*N,i[9]=c*x+d*C+p*E+f*R,i[10]=c*A+d*w+p*k+f*F,i[11]=c*y+d*T+p*I+f*P,i[12]=g*b+m*S+v*M+_*N,i[13]=g*x+m*C+v*E+_*R,i[14]=g*A+m*w+v*k+_*F,i[15]=g*y+m*T+v*I+_*P,i},multOrig:function(t,e,i){var r=0,n=0,a=0,s=0;if(i===t){for(var o=0;4>o;o++)r=f.innerProduct(e,t,0,o),n=f.innerProduct(e,t,1,o),a=f.innerProduct(e,t,2,o),s=f.innerProduct(e,t,3,o),t[0+o]=r,t[4+o]=n,t[8+o]=a,t[12+o]=s;return t}if(i===e){for(var u=0;4>u;u++)r=f.innerProduct(e,t,u,0),n=f.innerProduct(e,t,u,1),a=f.innerProduct(e,t,u,2),s=f.innerProduct(e,t,u,3),f.setRow(e,u,r,n,a,s);return e}var h=e[0],l=e[1],c=e[2],d=e[3],p=e[4],g=e[5],m=e[6],v=e[7],_=e[8],b=e[9],x=e[10],A=e[11],y=e[12],S=e[13],C=e[14],w=e[15],T=t[0],M=t[1],E=t[2],k=t[3],I=t[4],N=t[5],R=t[6],F=t[7],P=t[8],D=t[9],L=t[10],O=t[11],V=t[12],B=t[13],U=t[14],G=t[15];return i[0]=h*T+l*I+c*P+d*V,i[1]=h*M+l*N+c*D+d*B,i[2]=h*E+l*R+c*L+d*U,i[3]=h*k+l*F+c*O+d*G,i[4]=p*T+g*I+m*P+v*V,i[5]=p*M+g*N+m*D+v*B,i[6]=p*E+g*R+m*L+v*U,i[7]=p*k+g*F+m*O+v*G,i[8]=_*T+b*I+x*P+A*V,i[9]=_*M+b*N+x*D+A*B,i[10]=_*E+b*R+x*L+A*U,i[11]=_*k+b*F+x*O+A*G,i[12]=y*T+S*I+C*P+w*V,i[13]=y*M+S*N+C*D+w*B,i[14]=y*E+S*R+C*L+w*U,i[15]=y*k+S*F+C*O+w*G,i},makeLookFromDirection:function(){var t=u.create(),e=u.create(),i=u.create();return function(r,n,a,s){var o=n;return u.cross(o,a,t),u.normalize(t,t),u.cross(t,o,e),u.normalize(e,e),s[0]=t[0],s[1]=e[0],s[2]=-o[0],s[3]=0,s[4]=t[1],s[5]=e[1],s[6]=-o[1],s[7]=0,s[8]=t[2],s[9]=e[2],s[10]=-o[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,f.multTranslate(s,u.neg(r,i),s),s}}(),makeLookAt:function(){var t=u.create();return function(e,i,r,n){return u.sub(i,e,t),u.normalize(t,t),this.makeLookFromDirection(e,t,r,n),n}}(),makeOrtho:function(t,e,i,r,n,a,s){var o=-(e+t)/(e-t),u=-(r+i)/(r-i),h=-(a+n)/(a-n),l=f.setRow;return l(s,0,2/(e-t),0,0,0),l(s,1,0,2/(r-i),0,0),l(s,2,0,0,-2/(a-n),0),l(s,3,o,u,h,1),s},getLookAt:function(){var t=p(),e=u.create(),i=u.createAndSet(0,1,0),r=u.createAndSet(0,0,-1);return function(n,a,s,o,h){void 0===h&&(h=1);var l=f.inverse(n,t);l||f.makeIdentity(t),f.transformVec3(t,e,a),f.transform3x3(n,i,o),f.transform3x3(n,r,s),u.normalize(s,s),u.add(u.mult(s,h,e),a,s)}}(),getRotate:function(){var t=o.create();return function(e,i){var r,n,a,s=e[0],o=e[5],u=e[10];for(t[0]=1+s+o+u,t[1]=1+s-o-u,t[2]=1-s+o-u,t[3]=1-s-o+u,a=0,n=1;4>n;n++)t[n]>t[a]&&(a=n);return 0===a?(i[3]=t[0],i[0]=e[6]-e[9],i[1]=e[8]-e[2],i[2]=e[1]-e[4]):1===a?(i[3]=e[6]-e[9],i[0]=t[1],i[1]=e[1]+e[4],i[2]=e[8]+e[2]):2===a?(i[3]=e[8]-e[2],i[0]=e[1]+e[4],i[1]=t[2],i[2]=e[6]+e[9]):(i[3]=e[1]-e[4],i[0]=e[8]+e[2],i[1]=e[6]+e[9],i[2]=t[3]),r=Math.sqrt(.25/t[a]),i[3]*=r,i[0]*=r,i[1]*=r,i[2]*=r,i}}(),preMultTranslate:function(t,e){var i;return 0!==e[0]&&(i=e[0],t[12]+=i*t[0],t[13]+=i*t[1],t[14]+=i*t[2],t[15]+=i*t[3]),0!==e[1]&&(i=e[1],t[12]+=i*t[4],t[13]+=i*t[5],t[14]+=i*t[6],t[15]+=i*t[7]),0!==e[2]&&(i=e[2],t[12]+=i*t[8],t[13]+=i*t[9],t[14]+=i*t[10],t[15]+=i*t[11]),t},postMultTranslate:function(t,e){var i;return 0!==e[0]&&(i=e[0],t[0]+=i*t[3],t[4]+=i*t[7],t[8]+=i*t[11],t[12]+=i*t[15]),0!==e[1]&&(i=e[1],t[1]+=i*t[3],t[5]+=i*t[7],t[9]+=i*t[11],t[13]+=i*t[15]),0!==e[2]&&(i=e[2],t[2]+=i*t[3],t[6]+=i*t[7],t[10]+=i*t[11],t[14]+=i*t[15]),t},multTranslate:function(t,e,i){i!==t&&f.copy(t,i);var r;return 0!==e[0]&&(r=e[0],i[12]+=r*t[0],i[13]+=r*t[1],i[14]+=r*t[2],i[15]+=r*t[3]),0!==e[1]&&(r=e[1],i[12]+=r*t[4],i[13]+=r*t[5],i[14]+=r*t[6],i[15]+=r*t[7]),0!==e[2]&&(r=e[2],i[12]+=r*t[8],i[13]+=r*t[9],i[14]+=r*t[10],i[15]+=r*t[11]),i},makeRotate:function(){var t=o.create();return function(e,i,r,n,a){return f.makeRotateFromQuat(o.makeRotate(e,i,r,n,t),a)}}(),preMultRotate:function(){var t=p();return function(e,i){return f.makeRotateFromQuat(i,t),f.preMult(e,t),e}}(),postMultRotate:function(){var t=p();return function(e,i){return f.makeRotateFromQuat(i,t),f.postMult(t,e),e}}(),transform3x3:function(t,e,i){return i[0]=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i[1]=t[4]*e[0]+t[5]*e[1]+t[6]*e[2],i[2]=t[8]*e[0]+t[9]*e[1]+t[10]*e[2],i},transformVec3:function(t,e,i){var r=e[0],n=e[1],a=e[2],s=1/(t[3]*r+t[7]*n+t[11]*a+t[15]);return i[0]=(t[0]*r+t[4]*n+t[8]*a+t[12])*s,i[1]=(t[1]*r+t[5]*n+t[9]*a+t[13])*s,i[2]=(t[2]*r+t[6]*n+t[10]*a+t[14])*s,i},transformVec4:function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*a+t[12]*s,i[1]=t[1]*r+t[5]*n+t[9]*a+t[13]*s,i[2]=t[2]*r+t[6]*n+t[10]*a+t[14]*s,i[3]=t[3]*r+t[7]*n+t[11]*a+t[15]*s,i},transformBoundingBox:function(){var t=new a;return function(e,i,r){r===i&&(r=t);for(var n=i.getMin(),a=i.getMax(),s=f.getTrans(e,r.getMin()),o=u.copy(s,r.getMax()),h=0;3>h;++h)for(var l=4*h,c=n[h],d=a[h],p=0;3>p;++p){var g=e[l+p],m=g*d,v=g*c;v>m?(s[p]+=m,o[p]+=v):(s[p]+=v,o[p]+=m)}r===t&&i.copy(t)}}(),transformBoundingSphere:function(){var t=u.create();return function(e,i,r){if(!i.valid())return r;u.copy(i._center,r._center),r._radius=i._radius;var n=r._center,a=r._radius;f.getScale2(e,t);var s=Math.sqrt(Math.max(Math.max(t[0],t[1]),t[2]));return a*=s,r._radius=a,f.transformVec3(e,n,n),r}}(),transformVec4PostMult:function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3];return i[0]=t[0]*r+t[1]*n+t[2]*a+t[3]*s,i[1]=t[4]*r+t[5]*n+t[6]*a+t[7]*s,i[2]=t[8]*r+t[9]*n+t[10]*a+t[11]*s,i[3]=t[12]*r+t[13]*n+t[14]*a+t[15]*s,i},copy:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},inverse:function(){var t=p();return function(e,i){return i===e&&(f.copy(e,t),e=t),0===e[3]&&0===e[7]&&0===e[11]&&1===e[15]?f.inverse4x3(e,i):f.inverse4x4(e,i)}}(),inverse4x4:function(t,e){var i=t[10]*t[15],n=t[14]*t[11],a=t[6]*t[15],s=t[14]*t[7],o=t[6]*t[11],u=t[10]*t[7],h=t[2]*t[15],l=t[14]*t[3],c=t[2]*t[11],d=t[10]*t[3],p=t[2]*t[7],f=t[6]*t[3],g=t[8]*t[13],m=t[12]*t[9],v=t[4]*t[13],_=t[12]*t[5],b=t[4]*t[9],x=t[8]*t[5],A=t[0]*t[13],y=t[12]*t[1],S=t[0]*t[9],C=t[8]*t[1],w=t[0]*t[5],T=t[4]*t[1],M=i*t[5]+s*t[9]+o*t[13]-(n*t[5]+a*t[9]+u*t[13]),E=n*t[1]+h*t[9]+d*t[13]-(i*t[1]+l*t[9]+c*t[13]),k=a*t[1]+l*t[5]+p*t[13]-(s*t[1]+h*t[5]+f*t[13]),I=u*t[1]+c*t[5]+f*t[9]-(o*t[1]+d*t[5]+p*t[9]),N=t[0]*M+t[4]*E+t[8]*k+t[12]*I;if(Math.abs(N)<Number.EPSILON)return r.info("Warning can't inverse matrix "+t),r.infoMatrix(t),!1;var R=1/N,F=R*M,P=R*E,D=R*k,L=R*I,O=R*(n*t[4]+a*t[8]+u*t[12]-(i*t[4]+s*t[8]+o*t[12])),V=R*(i*t[0]+l*t[8]+c*t[12]-(n*t[0]+h*t[8]+d*t[12])),B=R*(s*t[0]+h*t[4]+f*t[12]-(a*t[0]+l*t[4]+p*t[12])),U=R*(o*t[0]+d*t[4]+p*t[8]-(u*t[0]+c*t[4]+f*t[8])),G=R*(g*t[7]+_*t[11]+b*t[15]-(m*t[7]+v*t[11]+x*t[15])),z=R*(m*t[3]+A*t[11]+C*t[15]-(g*t[3]+y*t[11]+S*t[15])),j=R*(v*t[3]+y*t[7]+w*t[15]-(_*t[3]+A*t[7]+T*t[15])),H=R*(x*t[3]+S*t[7]+T*t[11]-(b*t[3]+C*t[7]+w*t[11])),W=R*(v*t[10]+x*t[14]+m*t[6]-(b*t[14]+g*t[6]+_*t[10])),Q=R*(S*t[14]+g*t[2]+y*t[10]-(A*t[10]+C*t[14]+m*t[2])),Y=R*(A*t[6]+T*t[14]+_*t[2]-(w*t[14]+v*t[2]+y*t[6])),q=R*(w*t[10]+b*t[2]+C*t[6]-(S*t[6]+T*t[10]+x*t[2]));return e[0]=F,e[1]=P,e[2]=D,e[3]=L,e[4]=O,e[5]=V,e[6]=B,e[7]=U,e[8]=G,e[9]=z,e[10]=j,e[11]=H,e[12]=W,e[13]=Q,e[14]=Y,e[15]=q,!0},inverse4x3:function(){var t=p();return function(e,i){var n=e[0],a=e[1],s=e[2],o=e[4],u=e[5],h=e[6],l=e[8],c=e[9],d=e[10];i[0]=u*d-h*c,i[1]=s*c-a*d,i[2]=a*h-s*u;var p=n*i[0]+o*i[1]+l*i[2];if(Math.abs(p)<Number.EPSILON)return r.info("Warning can't inverse matrix "),r.infoMatrix(e),!1;var g=1/p;n*=g,o*=g,l*=g,i[0]*=g,i[1]*=g,i[2]*=g,i[3]=0,i[4]=h*l-o*d,i[5]=n*d-s*l,i[6]=s*o-n*h,i[7]=0,i[8]=o*c-u*l,i[9]=a*l-n*c,i[10]=n*u-a*o,i[11]=0,i[15]=1;var m,v,_,b=e[15],x=b-1;if(x*x>1e-6){i[12]=i[13]=i[14]=0;var A=e[3],y=e[7],S=e[11],C=i[0]*A+i[1]*y+i[2]*S,w=i[4]*A+i[5]*y+i[6]*S,T=i[8]*A+i[9]*y+i[10]*S;if(m=e[12],v=e[13],_=e[14],p=b-(m*C+v*w+_*T),Math.abs(p)<Number.EPSILON)return r.info("Warning can't inverse matrix "+e),r.infoMatrix(e),!1;var M=1/p;m*=M,v*=M,_*=M,t[0]=m*C+1,t[1]=v*C,t[2]=_*C,t[3]=-C*M,t[4]=m*w,t[5]=v*w+1,t[6]=_*w,t[7]=-w*M,t[8]=m*T,t[9]=v*T,t[10]=_*T+1,t[11]=-T*M,t[12]=-m,t[13]=-v,t[14]=-_,t[15]=M,f.preMult(i,t)}else m=e[12],v=e[13],_=e[14],i[12]=-(m*i[0]+v*i[4]+_*i[8]),i[13]=-(m*i[1]+v*i[5]+_*i[9]),i[14]=-(m*i[2]+v*i[6]+_*i[10]);return!0}}(),transpose:function(t,e){if(t===e){var i=t[1],r=t[2],n=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},getFrustumPlanes:function(){var t=p();return function(e,i,r,n){f.mult(e,i,t),void 0===n&&(n=!1);var a=r[0];a[0]=t[3]-t[0],a[1]=t[7]-t[4],a[2]=t[11]-t[8],a[3]=t[15]-t[12];var o=r[1];o[0]=t[3]+t[0],o[1]=t[7]+t[4],o[2]=t[11]+t[8],o[3]=t[15]+t[12];var u=r[2];u[0]=t[3]+t[1],u[1]=t[7]+t[5],u[2]=t[11]+t[9],u[3]=t[15]+t[13];var h=r[3];if(h[0]=t[3]-t[1],h[1]=t[7]-t[5],h[2]=t[11]-t[9],h[3]=t[15]-t[13],n){var l=r[4];l[0]=t[3]-t[2],l[1]=t[7]-t[6],l[2]=t[11]-t[10],l[3]=t[15]-t[14];var c=r[5];c[0]=t[3]+t[2],c[1]=t[7]+t[6],c[2]=t[11]+t[10],c[3]=t[15]+t[14]}for(var d=n?6:4,p=0;d>p;p++)s.normalizeEquation(r[p])}}(),makePerspective:function(t,e,i,r,n){var a=i*Math.tan(t*Math.PI/360),s=-a,o=s*e,u=a*e;return f.makeFrustum(o,u,s,a,i,r,n)},getFrustum:function(t,e){var i,r,n=0,a=0,s=0,o=0;if(0!==t[3]||0!==t[7]||-1!==t[11]||0!==t[15])return!1;var u=t[14]/(t[10]-1),h=t[14]/(1+t[10]);return a=u*(t[8]-1)/t[0],n=u*(1+t[8])/t[0],s=u*(1+t[9])/t[5],o=u*(t[9]-1)/t[5],i=u,r=h,e.left=a,e.right=n,e.top=s,e.bottom=o,e.zNear=i,e.zFar=r,!0},getPerspective:function(){var t={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0};return function(e,i){var r=f.getFrustum(e,t);return r&&(i.fovy=180/Math.PI*(Math.atan(t.top/t.zNear)-Math.atan(t.bottom/t.zNear)),i.aspectRatio=(t.right-t.left)/(t.top-t.bottom)),i.zNear=t.zNear,i.zFar=t.zFar,i}}(),preMultScale:function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,t},postMultScale:function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]*=i,t[1]*=r,t[2]*=n,t[4]*=i,t[5]*=r,t[6]*=n,t[8]*=i,t[9]*=r,t[10]*=n,t[12]*=i,t[13]*=r,t[14]*=n,t},makeScale:function(t,e,i,r){return f.setRow(r,0,t,0,0,0),f.setRow(r,1,0,e,0,0),f.setRow(r,2,0,0,i,0),f.setRow(r,3,0,0,0,1),r},getScale:function(){var t=u.create(),e=u.create(),i=u.create();return function(r,n){return t[0]=r[0],t[1]=r[4],t[2]=r[8],e[0]=r[1],e[1]=r[5],e[2]=r[9],i[0]=r[2],i[1]=r[6],i[2]=r[10],n[0]=u.length(t),n[1]=u.length(e),n[2]=u.length(i),n}}(),getScale2:function(){var t=u.create(),e=u.create(),i=u.create();return function(r,n){return t[0]=r[0],t[1]=r[4],t[2]=r[8],e[0]=r[1],e[1]=r[5],e[2]=r[9],i[0]=r[2],i[1]=r[6],i[2]=r[10],n[0]=u.length2(t),n[1]=u.length2(e),n[2]=u.length2(i),n}}(),clampProjectionMatrix:function(t,e,i,n,a){var s=1e-6;if(e-s>i)return r.log("clampProjectionMatrix not applied, invalid depth range, znear = "+e+"  zfar = "+i),!1;var o,u;if(e+s>i){var h=.5*(e+i);e=h-s,i=h+s}if(Math.abs(t[3])<s&&Math.abs(t[7])<s&&Math.abs(t[11])<s){var l=.02*(i-e);1>l&&(l=1),o=e-l,u=i+l,e=o,i=u,t[10]=-2/(u-o),t[14]=-(u+o)/(u-o)}else{var c=1.02,d=.98;o=e*d,u=i*c;var p=i*n;p>o&&(o=p),e=o,i=u;var f=t[10],g=t[14],m=t[11],v=t[15],_=(-o*f+g)/(-o*m+v),b=(-u*f+g)/(-u*m+v),x=Math.abs(2/(_-b)),A=-(_+b)/2,y=A*x;t[2]=t[2]*x+t[3]*y,t[6]=t[6]*x+t[7]*y,t[10]=f*x+m*y,t[14]=g*x+v*y}return void 0!==a&&(a[0]=e,a[1]=i),!0},computeFrustumCornersVectors:function(t,e){var i=1/t[0],r=1/t[5];return e[0]=u.createAndSet(-i,r,1),e[1]=u.createAndSet(-i,-r,1),e[2]=u.createAndSet(i,-r,1),e[3]=u.createAndSet(i,r,1),e},makeFrustumInfinite:function(t,e,i,r,n,a,s){var o=2*n/(e-t),u=2*n/(r-i),h=(e+t)/(e-t),l=(r+i)/(r-i),c=-1;return f.setRow(s,0,o,0,0,0),f.setRow(s,1,0,u,0,0),f.setRow(s,2,h,l,c,-1),f.setRow(s,3,0,0,-2*n,0),s},makeFrustum:function(t,e,i,r,n,a,s){var o=2*n/(e-t),u=2*n/(r-i),h=(e+t)/(e-t),l=(r+i)/(r-i),c=-(a+n)/(a-n),d=-2*a*n/(a-n);return f.setRow(s,0,o,0,0,0),f.setRow(s,1,0,u,0,0),f.setRow(s,2,h,l,c,-1),f.setRow(s,3,0,0,d,0),s},makeRotateFromQuat:function(t,e){return f.makeIdentity(e),f.setRotateFromQuat(e,t)},setRotateFromQuat:function(t,e){var i=o.length2(e);if(c(i)<=d)t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[8]=0,t[9]=0,t[10]=0;else{var r;r=1!==i?2/i:2;var n,a,s,u,h,l,p,f,g,m,v,_;m=r*e[0],v=r*e[1],_=r*e[2],u=e[0]*m,p=e[0]*v,f=e[0]*_,h=e[1]*v,l=e[1]*_,g=e[2]*_,n=e[3]*m,a=e[3]*v,s=e[3]*_,t[0]=1-(h+g),t[4]=p-s,t[8]=f+a,t[1]=p+s,t[5]=1-(u+g),t[9]=l-n,t[2]=f-a,t[6]=l+n,t[10]=1-(u+h)}return t}};f.identity=f.create(),t.exports=f},function(t,e,i){"use strict";var r=i(1122),n=i(1105),a=i(1124),s=i(1114),o=n.objectInherit(a,{INSIDE:1,INTERSECT:2,OUTSIDE:3,transformProvidingInverse:function(){var t=o.create();return function(e,i){return r.transformVec4PostMult(i,e,t),o.normalizeEquation(t),o.copy(t,e),e}},normalizeEquation:function(t){var e=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e},getNormal:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},setNormal:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]},getDistance:function(t){return t[3]},setDistance:function(t,e){t[3]=e},distanceToPlane:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},intersectsOrContainsBoundingSphere:function(t,e){if(!e.valid())return o.OUTSIDE;var i=e.center(),r=e.radius(),n=this.distanceToPlane(t,i);return-r>n?o.OUTSIDE:r>=n?o.INTERSECT:o.INSIDE},instersectsBoundingSphere:function(t,e){return this.intersectsOrContainsBoundingSphere(t,e)===o.INTERSECT},intersectsOrContainsBoundingBox:function(){var t=s.create(),e=s.create(),i=s.create();return function(r,n,a){s.add(n.getMax(),n.getMin(),t),s.mult(t,.5,t),s.sub(n.getMax(),n.getMin(),t),s.mult(e,.5,e);var u=s.dot(t,r);a||(a=i,a[0]=Math.abs(r[0]),a[1]=Math.abs(r[1]),a[2]=Math.abs(r[2]));var h=s.dot(e,a);return u+h>0?o.INTERSECT:u-h>=0?o.INSIDE:o.OUTSIDE}},intersectsBoundingBox:function(t,e,i){return this.intersectsOrContainsBoundingBox(t,e,i)===o.INTERSECT},intersectOrContainsVertices:function(t,e){for(var i=-1,r=0;r<e.length;r++){var n=this.distanceToPlane(t,e[r]);if(0>n){if(1===i)return o.INTERSECT;i=2}else{if(!(n>0))return o.INTERSECT;if(2===i)return o.INTERSECT;i=1}}return i>0?o.INSIDE:o.OUTSIDE},intersectVertices:function(t,e){return this.intersectOrContainsVertices(t,e)===o.INTERSECT}});t.exports=o},function(t,e,i){"use strict";var r=i(1116),n=r.ArrayType,a={create:function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},createAndSet:function(t,e,i,r){var a=new n(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a},init:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},set:function(t,e,i,r,n){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},copy:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},sub:function(t,e,i){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i},mult:function(t,e,i){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i},add:function(t,e,i){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i},neg:function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},lerp:function(t,e,i,r){var n=1-t;return r[0]=e[0]*n+t*i[0],r[1]=e[1]*n+t*i[1],r[2]=e[2]*n+t*i[2],r[3]=e[3]*n+t*i[3],r}};t.exports=a},function(t,e,i){"use strict";var r=i(1114),n=i(1124),a=i(1116),s=a.ArrayType,o=Math.sqrt,u=Math.cos,h=Math.sin,l={create:function(){var t=new s(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},createAndSet:n.createAndSet,makeIdentity:function(t){return l.init(t)},init:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},copy:n.copy,set:n.set,sub:n.sub,add:n.add,dot:n.dot,neg:n.neg,lerp:n.lerp,length2:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]},zeroRotation:function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])},makeRotate:function(t,e,i,r,n){var a=1e-7,s=o(e*e+i*i+r*r);if(a>s)return this.init(n);var l=1/s,c=u(.5*t),d=h(.5*t);return n[0]=e*d*l,n[1]=i*d*l,n[2]=r*d*l,n[3]=c,n},nlerp:function(t,e,i,r){var n=this.dot(e,i),a=1-t;return 0>n?(r[0]=e[0]*a-i[0]*t,r[1]=e[1]*a-i[1]*t,r[2]=e[2]*a-i[2]*t,r[3]=e[3]*a-i[3]*t):(r[0]=e[0]*a+i[0]*t,r[1]=e[1]*a+i[1]*t,r[2]=e[2]*a+i[2]*t,r[3]=e[3]*a+i[3]*t),this.normalize(r,r)},slerp:function(){var t=1e-5;return function(e,i,r,n){var a=this.dot(i,r),s=1;0>a&&(s=-1,a=-a);var o,u;if(a>1-t)o=1-e,u=e;else{var h=Math.sqrt(1-a*a),l=Math.atan2(h,a),c=1/h;o=Math.sin((1-e)*l)*c,u=Math.sin(e*l)*c}return u*=s,n[0]=i[0]*o+r[0]*u,n[1]=i[1]*o+r[1]*u,n[2]=i[2]*o+r[2]*u,n[3]=i[3]*o+r[3]*u,n}}(),transformVec3:function(t,e,i){var r=e[0],n=e[1],a=e[2],s=t[0],o=t[1],u=t[2],h=t[3],l=h*r+o*a-u*n,c=h*n+u*r-s*a,d=h*a+s*n-o*r,p=-s*r-o*n-u*a;return i[0]=l*h+p*-s+c*-u-d*-o,i[1]=c*h+p*-o+d*-s-l*-u,i[2]=d*h+p*-u+l*-o-c*-s,i},normalize:function(t,e){var i=1/this.length(t);return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},conj:function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},inverse:function(t,e){var i=1/this.length2(t);return this.conj(t,e),e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e},mult:function(t,e,i){var r=t[0],n=t[1],a=t[2],s=t[3],o=e[0],u=e[1],h=e[2],l=e[3];return i[0]=r*l+n*h-a*u+s*o,i[1]=-r*h+n*l+a*o+s*u,i[2]=r*u-n*o+a*l+s*h,i[3]=-r*o-n*u-a*h+s*l,i},div:function(t,e,i){var r=1/e;return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i},exp:function(t,e){var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=Math.exp(t[3]),n=0;return i>1e-5&&(n=r*Math.sin(i)/i),e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*Math.cos(i),e},ln:function(t,e){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=Math.sqrt(i),n=0;return r>1e-5&&(n=Math.atan2(r,t[3])/r),i+=t[3]*t[3],e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=.5*Math.log(i),e},squad:function(t,e,i,r,n,a){var s=this.slerp(t,e,n),o=this.slerp(t,i,r);return this.slerp(2*t*(1-t),s,o,a)},computeTangent:function(t,e,i,r){var n=this.inv(e),a=this.create(),s=this.create();return this.mult(i,n,a),this.ln(a,a),this.mult(t,n,s),this.ln(s,s),this.add(a,s,a),this.div(a,-4,a),this.exp(a,s),this.mult(s,e,r)},makeRotateFromTo:function(t,e,i){var n=1+r.dot(t,e);if(1e-7>n){var a,s=t[0],o=t[1],u=t[2];Math.abs(s)<.6?(a=Math.sqrt(1-s*s),i[1]=u/a,i[2]=-o/a,i[0]=i[3]=0):Math.abs(o)<.6?(a=Math.sqrt(1-o*o),i[0]=-u/a,i[2]=s/a,i[1]=i[3]=0):(a=Math.sqrt(1-u*u),i[0]=o/a,i[1]=-s/a,i[2]=i[3]=0)}else{var h=Math.sqrt(.5*n);r.cross(t,e,i);var l=.5/h;i[0]*=l,i[1]*=l,i[2]*=l,i[3]=h}return i}};l.identity=l.create(),t.exports=l},function(t,e,i){"use strict";var r=i(1122),n=function(){this._stack=[r.create()],this._current=0};n.prototype={reset:function(){this._current=0},get:function(){var t=this._stack[this._current++];return this._current===this._stack.length&&this._stack.push(r.create()),t}},t.exports=n},function(t,e,i){"use strict";var r=i(1122),n=i(1128),a=function(t,e,i){var a=e;void 0===a&&(a=!0);var s=i||r.create(),o=0;if(a){for(o=t.length-1;o>=0;o--){var u=t[o];if("Camera"===u.className()&&(u.getReferenceFrame()!==n.RELATIVE_RF||0===u.getParents().length))break}o+=1}for(var h=o,l=t.length;l>h;h++){var c=t[h];c.computeLocalToWorldMatrix&&c.computeLocalToWorldMatrix(s)}return s};t.exports={computeLocalToWorld:a}},function(t,e){"use strict";t.exports={RELATIVE_RF:0,ABSOLUTE_RF:1}},function(t,e,i){"use strict";var r=i(1113),n=i(1130),a=i(1122),s=i(1126),o=i(1110),u=i(1121),h=i(1105),l=function(t){u.call(this,t),this._reservedMatrixStack=new s,this._matrixStack=[],this._bb=new r};l.prototype=h.objectLibraryClass(h.objectInherit(u.prototype,{reset:function(){this._reservedMatrixStack.reset(),this._matrixStack.length=0,this._bb.init()},getBoundingBox:function(){return this._bb},applyTransform:function(t){var e=this._reservedMatrixStack.get(),i=this._matrixStack.length;i?a.copy(this._matrixStack[i-1],e):a.makeIdentity(e),t.computeLocalToWorldMatrix(e,this),this.pushMatrix(e),this.traverse(t),this.popMatrix()},apply:function(t){return t instanceof o?void this.applyTransform(t):t instanceof n?void this.applyBoundingBox(t.getBoundingBox()):void this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()},applyBoundingBox:function(){var t=new r;return function(e){var i=this._matrixStack.length;if(i){if(e.valid()){var r=this._matrixStack[i-1];a.transformBoundingBox(r,e,t),this._bb.expandByBoundingBox(t)}}else this._bb.expandByBoundingBox(e)}}(),getMatrixStack:function(){return this._matrixStack}}),"osg","ComputeBoundsVisitor"),t.exports=l},function(t,e,i){"use strict";var r=i(1105),n=i(1111),a=i(1109),s=i(1131),o=i(1142),u=i(1151),h=function(){if(n.call(this),window.Proxy){var t=this;this._attributes={},this._primitives=[],this.attributes=new Proxy(this._attributes,{set:function(e,i,r){var n=e[i];return n!==r&&(e[i]=r,t.dirty()),!0}});var e=function(){this.push.apply(this,arguments),t.dirty()}.bind(this._primitives),i=function(){this.pop(),t.dirty()}.bind(this._primitives);this.primitives=new Proxy(this._primitives,{get:function(t,r){return"push"===r?e:"pop"===r?i:t[r]}})}else this.attributes={},this.primitives=[],this._primitives=this.primitives,this._attributes=this.attributes;this._cacheDrawCall={},this._extVAO=void 0,this._vao={},this._cacheVertexAttributeBufferList={},this._shape=void 0};h.enableVAO=Boolean(window.Proxy),h.enableVAO&&a.info("enable VAO"),h.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects();var t,e,i,r=window.Object.keys(this._attributes);for(e=0,i=r.length;i>e;e++)t=this._attributes[r[e]],t.releaseGLObjects();for(var n=0,a=this._primitives.length;a>n;n++){var s=this._primitives[n];void 0!==s.getIndices&&void 0!==s.getIndices()&&null!==s.getIndices()&&s.indices.releaseGLObjects()}this.releaseVAO()},releaseVAO:function(){if(this._extVAO)for(var t=window.Object.keys(this._vao),e=0,i=t.length;i>e;e++){var r=t[e];if(this._vao[r]){var n=this._vao[r];this._extVAO.deleteVertexArrayOES(n),this._vao[r]=void 0}}},dirty:function(){this._cacheDrawCall={},this.releaseVAO()},getPrimitives:function(){return this.getPrimitiveSetList()},getAttributes:function(){return this.getVertexAttributeList()},getShape:function(){return this._shape},setShape:function(t){this._shape=t},getVertexAttributeList:function(){return this.attributes},getPrimitiveSetList:function(){return this.primitives},setVertexAttribArray:function(t,e){this._attributes[t]!==e&&(this._attributes[t]=e,this.dirty())},_generateVertexSetup:function(t,e,i){for(var r=["//generated by Geometry::implementation","state.lazyDisablingOfVertexAttributes();","var attr;"],n=0,a=t.length;a>n;n++)r.push("attr = this._attributes['"+t[n]+"'];"),r.push("if ( attr.BufferArrayProxy ) attr = attr.getBufferArray();"),r.push("if ( !attr.isValid() ) return;"),r.push("state.setVertexAttribArray("+e[n]+", attr, attr.getNormalize() );");return r.push("state.applyDisablingOfVertexAttributes();"),i&&r.push("state.setIndexArray( this._primitives[ 0 ].getIndices() );"),r},_generatePrimitive:function(t,e,i){var r=[e?"state.enableVertexColor();":"state.disableVertexColor();"];if(i)return r.concat(["var primitive = this._primitives[ 0 ];","var indexes = primitive.getIndices();","if ( indexes.isDirty() ) {;","  indexes.bind( gl );","  indexes.compile( gl );","};","primitive.drawElements( state );"]);r.push("var primitives = this._primitives;");for(var n=0,a=t.length;a>n;n++)r.push("primitives["+n+"].draw(state);");return r},generateDrawCommand:function(){var t=[],e=[];return function(i,r,n){var a=r._attributesCache.getKeys(),s=r._attributesCache,h=this.getVertexAttributeList();e.length=0,t.length=0;var l,c,d,p,f,g,m,v=this._extVAO,_=v?[]:void 0,b=!1;for(c=0,d=a.length;d>c;c++)if(g=a[c],l=s[g],m=h[g],void 0!==m){var x=this._attributes[g];if(x instanceof u&&(x=x.getBufferArray(),v=!1),!x.isValid())return;v&&_.push(x),b||"Color"!==g||(b=!0),e.push(g),t.push(l)}var A,y;if(v){this._cacheVertexAttributeBufferList[n]=_;var S=1===this._primitives.length&&this._primitives[0]instanceof o,C=this._generateVertexSetup(e,t,S);i.clearVertexAttribCache();var w=this._extVAO.createVertexArrayOES();i.setVertexArrayObject(w),this._vao[n]=w;var T=new Function("state",C.join("\n"));T.call(this,i);var M=["var gl = state.getGraphicContext();","var vao = this._vao[ "+n+" ] ","var hasChanged = state.setVertexArrayObject( vao );","if ( hasChanged ) {","  var vaList = this._cacheVertexAttributeBufferList[ "+n+" ];","  var va;"];for(p=0,f=_.length;f>p;p++)M.push("  va = vaList[ "+p+"];"),M.push("  if ( va.isDirty() ) {;"),M.push("    va.bind( gl );"),M.push("    va.compile( gl );"),M.push("  };");M.push("}"),A=M.concat(this._generatePrimitive(this._primitives,b,S)).join("\n"),y="GeometryDrawImplementationCacheVAO"}else A=this._generateVertexSetup(e,t,!1).concat(this._generatePrimitive(this._primitives,b,!1)).join("\n"),y="GeometryDrawImplementationCache";var E=new Function("state","return function "+y+"( state ) { "+A+"}")();return this._cacheDrawCall[n]=E,E}}(),drawImplementation:function(t){var e=t.getLastProgramApplied(),i=e.getInstanceID(),r=this._cacheDrawCall[i];if(this._extVAO&&!this._vao[i]&&t.setVertexArrayObject(null),void 0===r){if(!this._primitives.length)return;if(void 0===this._extVAO&&h.enableVAO){var n=s.instance(t.getGraphicContext()).getWebGLExtension("OES_vertex_array_object");this._extVAO=n}r=this.generateDrawCommand(t,e,i)}r.call(this,t)},setBound:function(t){this._boundingBox=t,this._boundingBoxComputed=!0},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex;if(e&&e.getElements()&&e.getItemSize()>2){for(var i=e.getElements(),r=e.getItemSize(),n=t.getMin(),a=t.getMax(),s=n[0],o=n[1],u=n[2],h=a[0],l=a[1],c=a[2],d=0,p=i.length;p>d;d+=r){var f=i[d],g=i[d+1],m=i[d+2];s>f&&(s=f),f>h&&(h=f),o>g&&(o=g),g>l&&(l=g),u>m&&(u=m),m>c&&(c=m)}n[0]=s,n[1]=o,n[2]=u,a[0]=h,a[1]=l,a[2]=c}return t},computeBoundingSphere:function(t){t.init();var e=this.getBoundingBox();return t.expandByBoundingBox(e),t}}),"osg","Geometry"),h.appendVertexAttributeToList=function(t,e,i){for(var r,n,a=window.Object.keys(t),s=0,o=a.length;o>s;s++)r=a[s],n=r,void 0!==i&&(n+="_"+i),e[n]=t[r]},r.setTypeID(h),t.exports=h},function(t,e,i){"use strict";var r,n=i(1109),a=i(1132),s=function(){r||(r=i(1133)),this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0};s.instance=function(t){if(!s._instance){var e,i=t;if(!i){var r="undefined"!=typeof window&&window.gli;r&&(e=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var o=document.createElement("canvas");o.width=32,o.height=32;var u={antialias:!1};i=a.setupWebGL(o,u,function(){})}s._instance=new s,i?s._instance.init(i):n.warn("no support for webgl context detected."),e&&(window.gli.host.inspectContext=e)}return t&&t!==s._instance.getContext()&&s._instance.initContextDependant(t),s._instance},s.prototype={getContext:function(){return this._gl},initContextDependant:function(t){this._gl=t,this.initWebGLExtensions(t),this.hasLinearHalfFloatRTT(t),this.hasLinearFloatRTT(t),this.hasHalfFloatRTT(t),this.hasFloatRTT(t)},init:function(t){if(this.initWebGLParameters(t),this.initPlatformSupport(),this.initBugDB(),this.initContextDependant(t),this._isGL2="undefined"!=typeof window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext,this._isGL2){this._checkRTT[r.FLOAT+","+r.NEAREST]=!0,this._checkRTT[r.HALF_FLOAT+","+r.NEAREST]=!0,this._checkRTT[r.FLOAT+","+r.LINEAR]=!0,this._checkRTT[r.HALF_FLOAT+","+r.LINEAR]=!0;for(var e=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],i=s._instance.getWebGLExtensions(),n=function(){},a=0,o=e.length;o>a;a++)i[e[a]]=n}},isWebGL2:function(){return this._isGL2},initBugDB:function(){var t=this._webGLPlatforms,e=this._webGLParameters;t.Apple&&(e.UNMASKED_VENDOR_WEBGL&&-1===e.UNMASKED_VENDOR_WEBGL.indexOf("Intel")||(this._bugsDB.OES_standard_derivatives=!0))},initPlatformSupport:function(){var t=this._webGLPlatforms;t.Apple=-1!==navigator.vendor.indexOf("Apple")||-1!==navigator.vendor.indexOf("OS X"),t.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(t){return this._webGLPlatforms[t]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(t){return this._webGLParameters[t]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(t,e,i){var r=e+","+i;if(void 0!==this._checkRTT[r])return this._checkRTT[r];if(!t)return!1;var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i);var a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var s=this._checkRTT[r]=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.deleteTexture(n),t.deleteFramebuffer(a),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),s},hasLinearHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(t,r.HALF_FLOAT,r.LINEAR)},hasLinearFloatRTT:function(t){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(t,r.FLOAT,r.LINEAR);
},hasHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(t,r.HALF_FLOAT,r.NEAREST)},hasFloatRTT:function(t){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(t,r.FLOAT,r.NEAREST)},queryPrecision:function(t,e,i){var r=t.getShaderPrecisionFormat(e,i);return r?0!==r.precision:!1},initWebGLParameters:function(t){if(t){for(var e=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],i=this._webGLParameters,r=0,n=e.length;n>r;++r){var a=e[r];i[a]=t.getParameter(t[a])}this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_FLOAT)&&(i.MAX_SHADER_PRECISION_FLOAT="low"),this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_INT)?i.MAX_SHADER_PRECISION_INT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_INT)?i.MAX_SHADER_PRECISION_INT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_INT)&&(i.MAX_SHADER_PRECISION_INT="low");var s=t.getExtension("WEBGL_debug_renderer_info");s&&(i.UNMASKED_RENDERER_WEBGL=t.getParameter(s.UNMASKED_VENDOR_WEBGL),i.UNMASKED_VENDOR_WEBGL=t.getParameter(s.UNMASKED_RENDERER_WEBGL))}},getWebGLExtension:function(t){return this._webGLExtensions[t]},getWebGLExtensions:function(){return this._webGLExtensions},initWebGLExtensions:function(t,e){if(t){var i=e;void 0===i&&(i=!0);for(var n=t.getSupportedExtensions(),a=this._webGLExtensions,s=0,o=n.length;o>s;++s){var u=n[s];i&&this._bugsDB[u]||(a[u]=t.getExtension(u))}var h=this.getWebGLExtension("EXT_texture_filter_anisotropic");h&&(r.ANISOTROPIC_SUPPORT_EXT=!0,r.ANISOTROPIC_SUPPORT_MAX=t.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}}},t.exports=s},function(t,e){"use strict";var i=function(){var t=function(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"},e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',i='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',r=function(r,a,s){function o(r){if(-1===r.indexOf("WebGL2")){var n=document.getElementsByTagName("body")[0];if(n){var a=window.WebGLRenderingContext?i:e;r&&(a+="<br/><br/>Status: "+r),n.innerHTML=t(a)}}}s=s||o,r.addEventListener&&r.addEventListener("webglcontextcreationerror",function(t){s(t.statusMessage)},!1);var u=n(r,a);return u||s(""),u},n=function(t,e){var i=[];e&&e.webgl2&&(i=i.concat(["webgl2","experimental-webgl2"])),i=i.concat(["webgl","experimental-webgl","webkit-3d","moz-webgl"]);for(var r=null,n=0;n<i.length;++n){try{r=t.getContext(i[n],e)}catch(a){}if(r)break}return r};return{create3DContext:n,setupWebGL:r}}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),t.exports=i},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1120),s=i(1134),o=i(1135),u=i(1136),h=i(1137),l=i(1119),c=i(1150),d=i(1131),p=function(t){return 0!==t&&(t&~t+1)===t},f=function(){a.call(this),u.call(this),this.setDefaultParameters(),this._dirty=!0,this._dirtyMipmap=!0,this._applyTexImage2DCallbacks=[],this._textureObject=void 0,this._textureNull=!0},g=function(t,e){var i=f[t];return void 0===i?(r.warn("bad Texture enum argument "+t+"\nfallback to "+e),e):i};f.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,f.UNPACK_FLIP_Y_WEBGL=37440,f.BROWSER_DEFAULT_WEBGL=37444,f.NONE=0,f.DEPTH_COMPONENT=6402,f.ALPHA=6406,f.RGB=6407,f.RGBA=6408,f.LUMINANCE=6409,f.LUMINANCE_ALPHA=6410,f.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,f.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,f.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,f.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,f.COMPRESSED_RGB_ATC_WEBGL=35986,f.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,f.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,f.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,f.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,f.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,f.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,f.COMPRESSED_RGB_ETC1_WEBGL=36196,f.LINEAR=9729,f.NEAREST=9728,f.NEAREST_MIPMAP_NEAREST=9984,f.LINEAR_MIPMAP_NEAREST=9985,f.NEAREST_MIPMAP_LINEAR=9986,f.LINEAR_MIPMAP_LINEAR=9987,f.TEXTURE_MAX_ANISOTROPY_EXT=34046,f.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,f.CLAMP_TO_EDGE=33071,f.REPEAT=10497,f.MIRRORED_REPEAT=33648,f.TEXTURE_2D=3553,f.TEXTURE_CUBE_MAP=34067,f.TEXTURE_BINDING_CUBE_MAP=34068,f.TEXTURE_CUBE_MAP_POSITIVE_X=34069,f.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,f.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,f.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,f.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,f.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,f.MAX_CUBE_MAP_TEXTURE_SIZE=34076,f.UNSIGNED_BYTE=5121,f.UNSIGNED_SHORT=5123,f.UNSIGNED_SHORT_4_4_4_4=32819,f.UNSIGNED_SHORT_5_5_5_1=32820,f.UNSIGNED_SHORT_5_6_5=33635,f.FLOAT=5126,f.HALF_FLOAT_OES=f.HALF_FLOAT=36193,f._sTextureManager=new window.Map,f.getTextureManager=function(t){return f._sTextureManager.has(t)||f._sTextureManager.set(t,new c),f._sTextureManager.get(t)},f.getEnumFromString=function(t){var e=t;return"string"==typeof e&&(e=g(e,t)),e},f.prototype=n.objectLibraryClass(n.objectInherit(u.prototype,n.objectInherit(a.prototype,{attributeType:"Texture",cloneType:function(){return new f},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},isTextureNull:function(){return this._textureNull},getOrCreateUniforms:function(t){if(void 0===f.uniforms&&(f.uniforms=[]),void 0===f.uniforms[t]){var e=this.getType()+t,i=new l,r=s.createInt1(t,e);i.setMap({texture:r}),f.uniforms[t]=i}return f.uniforms[t]},setDefaultParameters:function(){this._image=void 0,this._magFilter=f.LINEAR,this._minFilter=f.LINEAR,this._maxAnisotropy=1,this._wrapS=f.CLAMP_TO_EDGE,this._wrapT=f.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this._internalFormat=void 0,this._dirtyMipmap=!0,this._textureTarget=f.TEXTURE_2D,this._type=f.UNSIGNED_BYTE,this._isCompressed=!1,this._flipY=!0,this._colorSpaceConversion=f.NONE},setColorSpaceConversion:function(t){this._colorSpaceConversion=t},setFlipY:function(t){this._flipY=t},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(t,e){var i=d.instance().getWebGLParameter("MAX_TEXTURE_SIZE");(t!==this._textureWidth||e!==this._textureHeight)&&this.dirty(),void 0!==t&&(t>i?(r.error("width ("+t+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureWidth=i):this._textureWidth=t),void 0!==e&&(e>i?(r.error("height ("+e+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureHeight=i):this._textureHeight=e),this._textureNull=!1},init:function(t){this._gl||this.setGraphicContext(t.getGraphicContext()),this._textureObject||(this._textureObject=f.getTextureManager(this._gl).generateTextureObject(this._gl,this,this._textureTarget,this._internalFormat,this._textureWidth,this._textureHeight),this.dirty(),this._dirtyTextureObject=!1,this._textureNull=!1)},addApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);0>e&&this._applyTexImage2DCallbacks.push(t)},removeApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e>=0&&this._applyTexImage2DCallbacks.splice(e,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(){void 0!==this._textureObject&&null!==this._textureObject&&void 0!==this._gl&&f.getTextureManager(this._gl).releaseTextureObject(this._textureObject),this._textureObject=void 0},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},setWrapS:function(t){"string"==typeof t?this._wrapS=g(t,f.CLAMP_TO_EDGE):this._wrapS=t,this.dirtyTextureParameters()},setWrapT:function(t){"string"==typeof t?this._wrapT=g(t,f.CLAMP_TO_EDGE):this._wrapT=t,this.dirtyTextureParameters()},dirtyTextureParameters:function(){this.dirty(),this.dirtyMipmap(),this.dirtyTextureObject()},dirtyTextureObject:function(){this._dirtyTextureObject=!0,this.dirtyMipmap(),this.dirty()},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMaxAnisotropy:function(t){this._maxAnisotropy=t,this.dirtyTextureParameters()},getMaxAnisotropy:function(){return this._maxAnisotropy},setMinFilter:function(t){"string"==typeof t?this._minFilter=g(t,f.LINEAR):this._minFilter=t,this.dirtyTextureParameters()},setMagFilter:function(t){"string"==typeof t?this._magFilter=g(t,f.LINEAR):this._magFilter=t,this.dirtyTextureParameters()},setImage:function(t,e){var i=t;(t instanceof window.Image||t instanceof HTMLCanvasElement||t instanceof Uint8Array)&&(i=new o(t)),this._image=i,this.setImageFormat(e),i&&(i.getWidth&&i.getHeight?this.setTextureSize(i.getWidth(),i.getHeight()):i.width&&i.height&&this.setTextureSize(i.width,i.height)),this._textureNull=!1,this.dirty()},getImage:function(){return this._image},setImageFormat:function(t){var e=t;e?("string"==typeof e&&(e=f[e]),this._imageFormat=e):this._imageFormat=f.RGBA},setType:function(t){r.log("Texture.setType is deprecated, use instead Texture.setInternalFormatType"),this.setInternalFormatType(t)},setInternalFormatType:function(t){"string"==typeof t?this._type=f[t]:this._type=t},getInternalFormatType:function(){return this._type},setUnrefImageDataAfterApply:function(t){this._unrefImageDataAfterApply=t},checkIsCompressed:function(t){var e=t||this._internalFormat;switch(e){case f.COMPRESSED_RGB_S3TC_DXT1_EXT:case f.COMPRESSED_RGBA_S3TC_DXT1_EXT:case f.COMPRESSED_RGBA_S3TC_DXT3_EXT:case f.COMPRESSED_RGBA_S3TC_DXT5_EXT:case f.COMPRESSED_RGB_ATC_WEBGL:case f.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case f.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:case f.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case f.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case f.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:case f.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:case f.COMPRESSED_RGB_ETC1_WEBGL:return!0;default:return!1}},setInternalFormat:function(t){var e=t;e?("string"==typeof e&&(e=f[e]),this._isCompressed=this.checkIsCompressed(e)):(this._isCompressed=!1,e=f.RGBA),this._internalFormat=e},getInternalFormat:function(){return this._internalFormat},isDirtyMipmap:function(){return this._dirtyMipmap},dirtyMipmap:function(){this._dirtyMipmap=!0},applyFilterParameter:function(t,e){var i=p(this._textureWidth)&&p(this._textureHeight);if(i||(this._wrapT=f.CLAMP_TO_EDGE,this._wrapS=f.CLAMP_TO_EDGE,(this._minFilter===f.LINEAR_MIPMAP_LINEAR||this._minFilter===f.LINEAR_MIPMAP_NEAREST)&&(this._minFilter=f.LINEAR)),t.texParameteri(e,t.TEXTURE_MAG_FILTER,this._magFilter),t.texParameteri(e,t.TEXTURE_MIN_FILTER,this._minFilter),this._maxAnisotropy>1&&f.ANISOTROPIC_SUPPORT_EXT){var r=this._maxAnisotropy<f.ANISOTROPIC_SUPPORT_MAX?this._maxAnisotropy:f.ANISOTROPIC_SUPPORT_MAX;t.texParameterf(e,f.TEXTURE_MAX_ANISOTROPY_EXT,r)}t.texParameteri(e,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(e,t.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(t,e){if(this._dirtyMipmap=!1,this.hasMipmapFilter()){var i=this._image;if(i&&i.hasMipmap())for(var r=this._internalFormat,n=i.getMipmap(),a=1,s=n.length;s>a;a++){var o=n[a];this._isCompressed?this.applyTexImage2D(t,this._textureTarget,a,this._internalFormat,o.getWidth(),o.getHeight(),0,o.getImage()):this.applyTexImage2D(t,this._textureTarget,a,r,o.getWidth(),o.getHeight(),0,r,this._type,o.getImage())}else t.generateMipmap(e)}},hasMipmapFilter:function(){return this._minFilter===f.NEAREST_MIPMAP_NEAREST||this._minFilter===f.LINEAR_MIPMAP_NEAREST||this._minFilter===f.NEAREST_MIPMAP_LINEAR||this._minFilter===f.LINEAR_MIPMAP_LINEAR},applyTexImage2D:function(t){var e=Array.prototype.slice.call(arguments,1);n.timeStamp("osgjs.metrics:Texture.texImage2d"),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this._flipY),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._colorSpaceConversion),this._isCompressed?t.compressedTexImage2D.apply(t,e):t.texImage2D.apply(t,e);var i=this._applyTexImage2DCallbacks.length;if(i>0)for(var r=0,a=i;a>r;r++)this._applyTexImage2DCallbacks[r].call(this)},computeTextureFormat:function(){this._internalFormat?this._imageFormat=this._internalFormat:(this._internalFormat=this._imageFormat||f.RGBA,this._imageFormat=this._internalFormat)},applyImage:function(t,e){this._isCompressed?this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,e.getImage()):e.isTypedArray()?this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this._image.getImage()):this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._internalFormat,this._type,e.getImage()),e.setDirty(!1)},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{var i=this._image;if(void 0!==i)if(i.isReady()){this.computeTextureFormat();var r=i.getWidth()||this._textureWidth,n=i.getHeight()||this._textureHeight;this.setTextureSize(r,n),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e,this._image),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),this._dirty=!1}else e.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._dirty=!1)}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget),void 0!==this._image&&this._image.isDirty()&&this.applyImage(e,this._image)}})),"osg","Texture"),n.setTypeID(f),f.textureNull=new f,f.createFromImage=function(t,e){var i=new f;return i.setImage(t,e),i},f.createFromCanvas=function(t,e){return f.createFromImage(t,e)},f.create=function(t){return r.log("Texture.create is deprecated, use Texture.createFromURL instead"),f.createFromURL(t)},f.createFromURL=function(t,e){r.log("Texture.createFromURL is deprecated, use instead osgDB.readImageURL");var i=new f;return h.readImage(t).then(function(t){i.setImage(t,e)}),i},t.exports=f},function(t,e,i){"use strict";var r=i(1109),n=function(t){this._data=void 0,this._transpose=!1,this._glCall="",this._cache=void 0,this._name=t,this._type=void 0,this._isMatrix=!1};n.isUniform=function(t){return"object"==typeof t&&window.Object.getPrototypeOf(t)===n.prototype?!0:!1},n.prototype={getName:function(){return this._name},dirty:function(){r.log("deprecated dont use Uniform.dirty anymore")},getType:function(){return this._type},get:function(){return r.log("deprecated use getInternalArray instead"),this._data},set:function(t){r.log("deprecated use setFloat/setInt instead");var e=t;Array.isArray(e)||void 0!==e.byteLength?this._data=t:this._data[0]=e},apply:function(t,e){this._cache||(this._cache=t[this._glCall]),this._isMatrix?this._cache.call(t,e,this._transpose,this._data):this._cache.call(t,e,this._data)},setInternalArray:function(t){this._data=t},getInternalArray:function(){return this._data},setFloat:function(t){this._data[0]=t},setFloat1:function(t){this._data[0]=t[0]},setFloat2:function(t){this._data[0]=t[0],this._data[1]=t[1]},setFloat3:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2]},setFloat4:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3]},setFloat9:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8]},setFloat16:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8],this._data[9]=t[9],this._data[10]=t[10],this._data[11]=t[11],this._data[12]=t[12],this._data[13]=t[13],this._data[14]=t[14],this._data[15]=t[15]}},n.prototype.setVec2=n.prototype.setFloat2,n.prototype.setVec3=n.prototype.setFloat3,n.prototype.setVec4=n.prototype.setFloat4,n.prototype.setMatrix4=n.prototype.setFloat16,n.prototype.setMatrix3=n.prototype.setFloat9,n.prototype.setInt=n.prototype.setFloat,n.prototype.setInt1=n.prototype.setFloat1,n.prototype.setInt2=n.prototype.setFloat2,n.prototype.setInt3=n.prototype.setFloat3,n.prototype.setInt4=n.prototype.setFloat4;var a=function(t,e,i,r,a,s){var o=void 0===e?void 0:t,u=new n(void 0===e?t:e);if(u._data=i(),void 0!==o)if(o.length)for(var h=0,l=o.length;l>h;++h)u._data[h]=o[h];else u._data[0]=o;return u._glCall=r,u._type=a,u._isMatrix=!!s,u},s=function(){return new Float32Array(1)},o=function(){return new Float32Array(2)},u=function(){return new Float32Array(3)},h=function(){return new Float32Array(4)},l=function(){return new Int32Array(1)},c=function(){return new Int32Array(2)},d=function(){return new Int32Array(3)},p=function(){return new Int32Array(4)},f=function(){var t=new Float32Array(4);return t[0]=t[3]=1,t},g=function(){var t=new Float32Array(9);return t[0]=t[4]=t[8]=1,t},m=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t};n.createFloat1=function(t,e){return a(t,e,s,"uniform1fv","float")},n.createInt1=function(t,e){return a(t,e,l,"uniform1iv","int")},n.createFloat2=function(t,e){return a(t,e,o,"uniform2fv","vec2")},n.createInt2=function(t,e){return a(t,e,c,"uniform2iv","vec2i")},n.createFloat3=function(t,e){return a(t,e,u,"uniform3fv","vec3")},n.createInt3=function(t,e){return a(t,e,d,"uniform3iv","vec3i")},n.createFloat4=function(t,e){return a(t,e,h,"uniform4fv","vec4")},n.createInt4=function(t,e){return a(t,e,p,"uniform4iv","vec4i")},n.createMatrix2=function(t,e){return a(t,e,f,"uniformMatrix2fv","mat2",!0)},n.createMatrix3=function(t,e){return a(t,e,g,"uniformMatrix3fv","mat3",!0)},n.createMatrix4=function(t,e){return a(t,e,m,"uniformMatrix4fv","mat4",!0)},n["float"]=n.createFloatArray=n.createFloat=n.createFloat1,n["int"]=n.createIntArray=n.createInt=n.createInt1,n.vec2=n.createFloat2Array=n.createFloat2,n.vec2i=n.createInt2Array=n.createInt2,n.vec3=n.createFloat3Array=n.createFloat3,n.vec3i=n.createInt3Array=n.createInt3,n.vec4=n.createFloat4Array=n.createFloat4,n.vec4i=n.createInt4Array=n.createInt4,n.mat2=n.createMat2=n.createMatrix2,n.mat3=n.createMat3=n.createMatrix3,n.mat4=n.createMat4=n.createMatrix4,t.exports=n},function(t,e,i){"use strict";var r=(i(1109),i(1105)),n=i(1112),a=function(t){n.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,this._dirty=!0,this._mipmap=[],t&&this.setImage(t),this._isGreyscale=void 0};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{dirty:function(){this._isGreyscale=void 0,this._dirty=!0},isDirty:function(){return this._dirty},setDirty:function(t){this._dirty=t},getImage:function(){return this._imageObject instanceof a?this._imageObject.getImage():this._imageObject},getURL:function(){return this._url},setURL:function(t){this._url=t},useOrCreateImage:function(t){return t instanceof a==!1?new a(t):t},setImage:function(t){if(!this._url&&t&&(t.src||t.currentSrc)&&(this._url=t.src||t.currentSrc),this._mipmap.length=0,Array.isArray(t)){for(var e=0,i=t.length;i>e;e++)this._mipmap.push(this.useOrCreateImage(t[e]));this.setWidth(this._mipmap[0].getWidth()),this.setHeight(this._mipmap[0].getHeight())}else this._mipmap.push(t);this._imageObject=this._mipmap[0],this.dirty()},isCanvas:function(){return this.getImage()instanceof window.HTMLCanvasElement},isVideo:function(){return this.getImage()instanceof window.HTMLVideoElement},isImage:function(){return this.getImage()instanceof window.Image},isTypedArray:function(){var t=this.getImage();return t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array},setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},getWidth:function(){var t=this.getImage();return this.isImage()?t.naturalWidth:this.isVideo()?t.videoWidth:this.isCanvas()?t.width:this._width},getHeight:function(){var t=this.getImage();return this.isImage()?t.naturalHeight:this.isVideo()?t.videoHeight:this.isCanvas()?t.height:this._height},isGreyscale:function(t){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var e=this._imageObject;this.isCanvas()||(e=document.createElement("canvas"));var i=e.getContext("2d");e.width=this._imageObject.width,e.height=this._imageObject.height,i.drawImage(this._imageObject,0,0);var r,n;t||(r=e.width,n=e.height),t>0&&(t=Math.min(Math.min(e.width,e.height),t),r=n=t);for(var a=!0,s=e.width/r,o=e.height/n,u=0;r>u;u++)for(var h=0;n>h;h++){var l=Math.floor(s*(u+.5)),c=Math.floor(o*(h+.5)),d=i.getImageData(l,c,1,1).data;if(d[0]!==d[1]||d[0]!==d[2]){a=!1;break}}this._isGreyscale=a}return this._isGreyscale},isReady:function(){if(this._imageObject&&this._imageObject instanceof a)return this._imageObject.isReady();if(this.isCanvas()||this.isTypedArray())return!0;if(this.isImage()){var t=this.getImage();if(t.complete)return void 0!==t.naturalWidth&&0===t.naturalWidth?!1:!0}if(this.isVideo()&&0!==this.getWidth())return!0;var e=this.getImage();return e.complete?void 0!==e.naturalWidth&&0===e.naturalWidth?!1:!0:!1},getMipmap:function(){return this._mipmap},hasMipmap:function(){return this._mipmap.length>1},release:function(){this._mipmap.length=0,this._imageObject=void 0}}),"osg","Image"),r.setTypeID(a),t.exports=a},function(t,e){"use strict";var i=function(){this._gl=void 0};i.prototype={setGraphicContext:function(t){this._gl=t},getGraphicContext:function(){return this._gl}},t.exports=i},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1134),s=i(1138),o=i(1130),u=i(1139),h=i(1140),l=i(1141),c=i(1142),d=i(1118),p=i(1111),f=i(1122),g=i(1143),m=i(1144),v={};v.ObjectWrapper={},v.ObjectWrapper.serializers={},v.readImage=function(t,e){return v.registry().readImageURL(t,e)},v.readImageURL=v.readImage,v.readBinaryArrayURL=function(t,e){return v.registry().readBinaryArrayURL(t,e)},v.readNodeURL=function(t,e){return v.registry().readNodeURL(t,e)},v.registry=function(){var t=i(1145);return void 0===v.registry._input&&(v.registry._input=new t),v.registry._input},v.parseSceneGraph=function(t,e){if(!(void 0!==t.Version&&t.Version>0)){n.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated");var i=v.parseSceneGraphDeprecated(t);return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated"),i}n.time("osgjs.metric:ReaderParser.parseSceneGraph");var a=function(t){for(var e=window.Object.keys(t),i=0,r=e.length;r>i;i++)if("Generator"!==e[i]&&"Version"!==e[i])return e[i]},s=a(t);if(s){var o={};o[s]=t[s];var u=v.registry().clone();u.setJSON(o);var h=n.objectMix(n.objectMix({},v.registry().getOptions()),e||{});u.setOptions(h);var l=u.readObject();return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph"),l}r.log("can't parse scenegraph "+t)},v.parseSceneGraphDeprecated=function(t){var e,_=function(t,e){var i=e[t];return void 0===i&&(i=e[t.toLowerCase()]),i},b=function(t,e){var i=_("Name",e);i&&void 0!==t.setName&&t.setName(i)},x=function(t,e){b(t,e),t.setAmbient(_("Ambient",e)),t.setDiffuse(_("Diffuse",e)),t.setEmission(_("Emission",e)),t.setSpecular(_("Specular",e)),t.setShininess(_("Shininess",e))},A=function(t,e){b(t,e),t.setSourceRGB(e.SourceRGB),t.setSourceAlpha(e.SourceAlpha),t.setDestinationRGB(e.DestinationRGB),t.setDestinationAlpha(e.DestinationAlpha)},y=function(t,e){var i=e.MagFilter||e.mag_filter||void 0;i&&t.setMagFilter(i);var n=e.MinFilter||e.min_filter||void 0;n&&t.setMinFilter(n);var a=e.WrapT||e.wrap_t||void 0;a&&t.setWrapT(a);var s=e.WrapS||e.wrap_s||void 0;s&&t.setWrapS(s);var o=_("File",e);v.readImage(o).then(function(e){t.setImage(e)})["catch"](function(){r.log("Can't read image")})},S=function(t,e){b(t,e);var n=_("Textures",e)||_("TextureAttributeList",e)||void 0;if(n)for(var o=0,u=n.length;u>o;o++){var h=_("File",n[o]);if(h){var l=i(1133),c=new l;y(c,n[o]),t.setTextureAttributeAndModes(o,c),t.addUniform(a.createInt1(o,"Texture"+o))}else r.log("no texture on unit "+o+" skip it")}var d=_("BlendFunc",e);if(d){var p=new s;A(p,d),t.setAttributeAndModes(p)}var f=_("Material",e);if(f){var g=i(1149),m=new g;x(m,f),t.setAttributeAndModes(m)}},C=t.children,w=t.primitives||t.Primitives||void 0,T=t.attributes||t.Attributes||void 0;if(w||T){var M=new o;b(M,t),M.stateset=t.stateset,t=M;for(var E=0,k=w.length;k>E;E++){var I=w[E].mode;if(w[E].indices){var N=w[E].indices;N=new u(u[N.type],N.elements,N.itemSize),I=I?h[I]:"TRIANGLES",M.getPrimitiveSetList().push(new c(I,N))}else{I=h[I];var R=w[E].first,F=w[E].count;M.getPrimitiveSetList().push(new l(I,R,F))}}for(var P=window.Object.keys(T),D=0,L=P.length;L>D;D++){var O=P[D],V=T[O];M.getVertexAttributeList()[O]=new u(V.type,V.elements,V.itemSize)}}var B=_("StateSet",t);if(B){var U=new d;S(U,B),t.stateset=U}var G=t.matrix||t.Matrix||void 0;G&&(e=new g,b(e,t),n.extend(e,t),f.copy(G,e.getMatrix()),t=e);var z=t.projection||t.Projection||void 0;if(z&&(e=new m,b(e,t),n.extend(e,t),f.copy(z,e.setProjectionMatrix()),t=e),void 0===t.typeID&&(e=new p,b(e,t),n.extend(e,t),t=e),C){t.children=[];for(var j=0,H=C.length;H>j;j++)t.addChild(v.parseSceneGraphDeprecated(C[j]))}return t},t.exports=v},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=function(t,e,i,r){n.call(this),this._sourceFactor=a.DISABLE,this._destinationFactor=a.DISABLE,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==t&&this.setSource(t),void 0!==e&&this.setDestination(e),void 0!==i&&this.setSourceAlpha(i),void 0!==r&&this.setDestinationAlpha(r)};a.DISABLE=-1,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"BlendFunc",cloneType:function(){return new a},setSource:function(t){this.setSourceRGB(t),this.setSourceAlpha(t)},getSource:function(){return this._sourceFactor},setDestination:function(t){this.setDestinationRGB(t),this.setDestinationAlpha(t)},getDestination:function(){return this._destinationFactor},getSeparate:function(){return this._separate},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(t){"string"==typeof t?this._sourceFactor=a[t]:this._sourceFactor=t,this._separate=this.checkSeparate()},getSourceRGB:function(){return this._sourceFactor},setSourceAlpha:function(t){"string"==typeof t?this._sourceFactorAlpha=a[t]:this._sourceFactorAlpha=t,this._separate=this.checkSeparate()},getSourceAlpha:function(){return this._sourceFactorAlpha},setDestinationRGB:function(t){"string"==typeof t?this._destinationFactor=a[t]:this._destinationFactor=t,this._separate=this.checkSeparate()},getDestinationRGB:function(){return this._destinationFactor},setDestinationAlpha:function(t){"string"==typeof t?this._destinationFactorAlpha=a[t]:this._destinationFactorAlpha=t,this._separate=this.checkSeparate()},getDestinationAlpha:function(){return this._destinationFactorAlpha},apply:function(t){var e=t.getGraphicContext();this._sourceFactor===a.DISABLE||this._destinationFactor===a.DISABLE?e.disable(e.BLEND):(e.enable(e.BLEND),this._separate?e.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):e.blendFunc(this._sourceFactor,this._destinationFactor))}}),"osg","BlendFunc"),t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1109),a=i(1112),s=i(1136),o=i(1108),u=function(t){var e;return t instanceof r.Float32Array&&(e=5126),t instanceof r.Uint32Array&&(e=5125),t instanceof r.Uint16Array&&(e=5123),t instanceof r.Uint8Array&&(e=5121),e},h=function(t,e,i,n){if(s.call(this),this._instanceID=a.getInstanceID(),this.dirty(),this._itemSize=i,this._target="string"==typeof t?h[t]:t,this._type=void 0,this._normalize=!1,void 0!==e){var o=e;n||(o=this._target===h.ELEMENT_ARRAY_BUFFER?e instanceof r.Uint16Array?e:new r.Uint16Array(e):e instanceof r.Float32Array?e:new r.Float32Array(e)),this.setElements(o)}};h.ELEMENT_ARRAY_BUFFER=34963,h.ARRAY_BUFFER=34962,h._sDeletedGLBufferArrayCache=new window.Map,h.deleteGLBufferArray=function(t,e){h._sDeletedGLBufferArrayCache.has(t)||h._sDeletedGLBufferArrayCache.set(t,[]),h._sDeletedGLBufferArrayCache.get(t).push(e)},h.flushDeletedGLBufferArrays=function(t,e){if(0>=e)return e;if(!h._sDeletedGLBufferArrayCache.has(t))return e;for(var i=0,r=o.instance().tick(),n=h._sDeletedGLBufferArrayCache.get(t),a=n.length,s=a-1;s>=0&&e>i;s--)t.deleteBuffer(n[s]),n.splice(s,1),i=o.instance().deltaS(r,o.instance().tick());return e-i},h.flushAllDeletedGLBufferArrays=function(t){if(h._sDeletedGLBufferArrayCache.has(t))for(var e=h._sDeletedGLBufferArrayCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteBuffer(e[r]),e.splice(r,1)},h.prototype=r.objectInherit(s.prototype,{getInstanceID:function(){return this._instanceID},setItemSize:function(t){this._itemSize=t},isValid:function(){return void 0!==this._buffer||void 0!==this._elements?!0:!1},releaseGLObjects:function(){void 0!==this._buffer&&null!==this._buffer&&void 0!==this._gl&&h.deleteGLBufferArray(this._gl,this._buffer),this._buffer=void 0},setNormalize:function(t){this._normalize=t},getNormalize:function(){return this._normalize},bind:function(t){this._gl||this.setGraphicContext(t);var e=this._target,i=this._buffer;return i?void t.bindBuffer(e,i):void(!i&&this._elements.length>0&&(this._buffer=t.createBuffer(),this._numItems=this._elements.length/this._itemSize,t.bindBuffer(e,this._buffer)))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(t){this._dirty&&(r.timeStamp("osgjs.metrics:bufferData"),t.bufferData(this._target,this._elements,t.STATIC_DRAW),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(t){this._elements=t,this._type=u(t),this._dirty=!0},getType:function(){return this._type}}),h.create=function(t,e,i){return n.log("BufferArray.create is deprecated, use new BufferArray with same arguments instead"),new h(t,e,i)},t.exports=h},function(t,e){"use strict";var i={};i.POINTS=0,i.LINES=1,i.LINE_LOOP=2,i.LINE_STRIP=3,i.TRIANGLES=4,i.TRIANGLE_STRIP=5,i.TRIANGLE_FAN=6,t.exports=i},function(t,e,i){"use strict";var r=i(1109),n=i(1140),a=function(t,e,i){
this.mode=t,void 0!==t&&("string"==typeof t&&(t=n[t]),this.mode=t),this.first=e,this.count=i};a.prototype={draw:function(t){if(0!==this.count){var e=t.getGraphicContext();e.drawArrays(this.mode,this.first,this.count)}},getMode:function(){return this.mode},getCount:function(){return this.count},getFirst:function(){return this.first},getNumIndices:function(){return this.count},index:function(t){return this.first+t}},a.create=function(t,e,i){r.log("DrawArrays.create is deprecated, use new DrawArrays with same arguments");var n=new a(t,e,i);return n},t.exports=a},function(t,e,i){"use strict";var r=i(1109),n=i(1140),a=function(t,e){this.mode=n.POINTS,void 0!==t&&("string"==typeof t&&(t=n[t]),this.mode=t),this.count=0,this.offset=0,this.indices=e,this.uType=a.UNSIGNED_SHORT,void 0!==e&&this.setIndices(e)};a.UNSIGNED_BYTE=5121,a.UNSIGNED_SHORT=5123,a.UNSIGNED_INT=5125,a.prototype={getMode:function(){return this.mode},draw:function(t){0!==this.count&&(t.setIndexArray(this.indices),this.drawElements(t))},drawElements:function(t){var e=t.getGraphicContext();e.drawElements(this.mode,this.count,this.uType,this.offset)},setIndices:function(t){this.indices=t;var e=t.getElements();this.count=e.length;var i=e.BYTES_PER_ELEMENT;1===i?this.uType=a.UNSIGNED_BYTE:2===i?this.uType=a.UNSIGNED_SHORT:4===i&&(this.uType=a.UNSIGNED_INT)},getIndices:function(){return this.indices},setFirst:function(t){this.offset=t},getFirst:function(){return this.offset},setCount:function(t){this.count=t},getCount:function(){return this.count},getNumIndices:function(){return this.indices.getElements().length},index:function(t){return this.indices.getElements()[t]}},a.create=function(t,e){return r.log("DrawElements.create is deprecated, use new DrawElements with same arguments"),new a(t,e)},t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1122),a=i(1110),s=i(1128),o=function(){a.call(this),this.matrix=n.create()};o.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(t){this.matrix=t,this.dirtyBound()},computeLocalToWorldMatrix:function(t){return this.referenceFrame===s.RELATIVE_RF?n.preMult(t,this.matrix):n.copy(this.matrix,t),!0},computeWorldToLocalMatrix:function(){var t=n.create();return function(e){return n.inverse(this.matrix,t),this.referenceFrame===s.RELATIVE_RF?n.postMult(t,e):n.copy(t,e),!0}}()}),"osg","MatrixTransform"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1111),a=i(1122),s=function(){n.call(this),this.projection=a.create()};s.prototype=r.objectInherit(n.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(t){this.projection=t}}),r.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(236),n=i(1105),a=i(1101),s=i(1146),o=i(1109),u=i(1135),h=i(1139),l=i(1141),c=i(1147),d=i(1142),p=i(1140),f=function(t,e){this._json=t;var i=e;void 0===i&&(i={}),this._identifierMap=i,this._objectRegistry={},this._cacheReadObject={},this.setOptions(n.objectMix({},s))};f.imageFallback||(f.imageFallback=function(){var t=new window.Image;return t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",t}()),f.prototype={clone:function(){var t=new f;return t._objectRegistry=this._objectRegistry,t._cacheReadObject=this._cacheReadObject,t},setOptions:function(t){this._defaultOptions=t},getOptions:function(){return this._defaultOptions},setProgressXHRCallback:function(t){this._defaultOptions.progressXHRCallback=t},setReadNodeURLCallback:function(t){this._defaultOptions.readNodeURL=t},registerObject:function(t,e){this._objectRegistry[t]=e},getJSON:function(){return this._json},setJSON:function(t){return this._json=t,this},setPrefixURL:function(t){this._defaultOptions.prefixURL=t},getPrefixURL:function(){return this._defaultOptions.prefixURL},setDatabasePath:function(t){this._defaultOptions.databasePath=t},getDatabasePath:function(){return this._defaultOptions.databasePath},computeURL:function(t){return"string"==typeof this._defaultOptions.prefixURL&&this._defaultOptions.prefixURL.length>0?this._defaultOptions.prefixURL+t:t},requestFile:function(t,e){var i=r.defer(),n=new XMLHttpRequest;return n.open("GET",t,!0),e&&e.responseType&&(n.responseType=e.responseType),e&&e.progress&&n.addEventListener("progress",e.progress,!1),n.addEventListener("error",function(){i.reject()},!1),n.addEventListener("load",function(){"arraybuffer"===n.responseType?i.resolve(n.response):i.resolve(n.responseText)}),n.send(null),i.promise},getObjectWrapper:function(t){if(this._objectRegistry[t])return new this._objectRegistry[t];for(var e=a,i=t.split("."),r=0,n=i.length;n>r;r++){var s=e[i[r]];if(void 0===s)return;e=s}return this._objectRegistry[t]=e,new e},fetchImage:function(t,e,i,r){var n="data:image/",a=e.substring(0,n.length)===n,s=new window.Image;return s.onerror=function(){o.warn("warning use white texture as fallback instead of "+e),t.setImage(f.imageFallback),r&&r.resolve(t)},!a&&i.imageCrossOrigin&&(s.crossOrigin=i.imageCrossOrigin),s.onload=function(){r?(i.imageOnload&&i.imageOnload.call(t),r.resolve(t)):i.imageOnload&&i.imageOnload.call(t)},t.setURL(e),t.setImage(s),s.src=e,t},readImageURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readImageURL)return e.readImageURL.call(this,t,e);"data:image"!==t.substr(0,10)&&(t=this.computeURL(t));var i=new u;if(e.imageLoadingUsePromise!==!0)return this.fetchImage(i,t,e);var n=r.defer();return this.fetchImage(i,t,e,n),n.promise},readNodeURL:function(t,e){var a=e;if(void 0===a&&(a=this._defaultOptions),a.readNodeURL)return a.readNodeURL.call(this,t,a);t=this.computeURL(t);var s=r.defer();if(a=n.objectMix({},a),!a.prefixURL){var u=this.getPrefixURL(),h=t.lastIndexOf("/");-1!==h&&(u=t.substring(0,h+1)),a.prefixURL=u}var l=this,c=i(1137),d=function(e){c.parseSceneGraph(e,a).then(function(e){s.resolve(e),o.log("loaded "+t)})["catch"](s.reject.bind(s))},p=function(t){function e(t){return t.length<2?"0"+t:t}function i(t){for(var i="",r=0,n=t.length;n>r;++r)i+="%"+e(t[r].toString(16));return i=decodeURIComponent(i)}var r=l._unzipTypedArray(t),n=new Uint8Array(r),a=i(n);return a},f=l.requestFile(t);return f.then(function(e){var i;try{i=JSON.parse(e)}catch(r){o.error("cant parse url "+t+" try to gunzip")}if(i)return d(i);var n=l.requestFile(t,{responseType:"arraybuffer"});return n.then(function(t){var e=p(t);i=JSON.parse(e),d(i)})["catch"](function(e){o.error("cant read file "+t+" status "+e),s.reject()}).done(),!0})["catch"](function(e){o.error("cant get file "+t+" status "+e),s.reject()}).done(),s.promise},_unzipTypedArray:function(t){var e=new Uint8Array(t);if(31===e[0]&&139===e[1]){var r=i(1148);r||o.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server");var n=new r.Gunzip(e),a=n.decompress();return a.buffer}return t},readBinaryArrayURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readBinaryArrayURL)return e.readBinaryArrayURL.call(this,t,e);if(t=this.computeURL(t),void 0!==this._identifierMap[t])return this._identifierMap[t];var i=r.defer(),n=this.requestFile(t,{responseType:"arraybuffer",progress:this._defaultOptions.progressXHRCallback});return this._identifierMap[t]=i.promise,n.then(function(t){i.resolve(this._unzipTypedArray(t))}.bind(this)),i.promise},initializeBufferArray:function(t,e,i,a){if(void 0===a&&(a=this.getOptions()),a.initializeBufferArray)return a.initializeBufferArray.call(this,t,e,i);var s=t.File,u=r.defer();return this.readBinaryArrayURL(s).then(function(r){var a,s;!function(){var t=new Uint8Array([18,52]),e=new Uint16Array(t.buffer);s="1234"===e[0].toString(16)}();var h=0;void 0!==t.Offset&&(h=t.Offset);var l=n[e].BYTES_PER_ELEMENT,c=t.Size,d=i.getItemSize(),p=c*l*d;if(s){o.log("big endian detected");var f=n[e],g=new f(c*d),m=new DataView(r,h,p),v=0,_=g.length;if("Uint16Array"===e)for(;_>v;v++)g[v]=m.getUint16(v*l,!0);else if("Float32Array"===e)for(;_>v;v++)g[v]=m.getFloat32(v*l,!0);a=g,m=null}else a=new n[e](r,h,d*c);i.setElements(a),u.resolve(i)})["catch"](function(){o.warn("Can't read binary array URL")}),u.promise},readBufferArray:function(t){var e,i=this.getJSON(),a=i.UniqueID;if(void 0!==a&&(e=this._identifierMap[a],void 0!==e))return e;if(void 0===t&&(t=this.getOptions()),t.readBufferArray)return t.readBufferArray.call(this);if(!i.Elements&&!i.Array||!i.ItemSize||!i.Type)return r.reject();var s;if(i.Elements)s=r.resolve(new h(h[i.Type],i.Elements,i.ItemSize));else if(i.Array){var u=new h(h[i.Type]);u.setItemSize(i.ItemSize);var l,c;if(i.Array.Float32Array?(l=i.Array.Float32Array,c="Float32Array"):i.Array.Uint16Array?(l=i.Array.Uint16Array,c="Uint16Array"):i.Array.Uint8Array&&(l=i.Array.Uint8Array,c="Uint8Array"),void 0===l)return o.warn("Typed Array "+window.Object.keys(i.Array)[0]),r.reject();l.File?s=this.initializeBufferArray(l,c,u):l.Elements&&(u.setElements(new n[c](l.Elements)),s=r.resolve(u))}return void 0!==a&&(this._identifierMap[a]=s),s},readUserDataContainer:function(){var t,e=this.getJSON(),i=e.UniqueID;return void 0!==i&&(t=this._identifierMap[i],void 0!==t)?t.Values:(this._identifierMap[i]=e,e.Values)},readPrimitiveSet:function(){var t,e,i,n,a,s,u=this.getJSON(),h=r.defer(),f=u.DrawElementUShort||u.DrawElementUByte||u.DrawElementUInt||u.DrawElementsUShort||u.DrawElementsUByte||u.DrawElementsUInt||void 0;if(f){if(t=f.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;var g=f.Indices,m=u;n=f.Mode,n=n?p[n]:p.TRIANGLES,i=new d(n),this.setJSON(g),this.readBufferArray().then(function(t){i.setIndices(t),h.resolve(i)})["catch"](function(){o.warn("Error buffer array")}),this.setJSON(m)}var v=u.DrawArray||u.DrawArrays;if(v){if(t=v.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;n=v.Mode||v.mode,a=void 0!==v.First?v.First:v.first,s=void 0!==v.Count?v.Count:v.count;var _=new l(p[n],a,s);h.resolve(_)}var b=u.DrawArrayLengths||void 0;if(b){if(t=b.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;n=b.Mode,a=b.First;var x=b.ArrayLengths,A=new c(p[n],a,x);h.resolve(A)}return void 0!==t&&(this._identifierMap[t]=h.promise),h.promise},readObject:function(){var t=this.getJSON(),e=window.Object.keys(t)[0];if(!e)return o.warn("can't find property for object "+t),r.reject();var n,a=t[e].UniqueID;if(void 0!==a&&(n=this._identifierMap[a],void 0!==n))return n;var s=this.getObjectWrapper(e);if(!s)return o.warn("can't instanciate object "+e),r.reject();var u=i(1137),h=u.ObjectWrapper.serializers;if(this._cacheReadObject[e])h=this._cacheReadObject[e];else{for(var l=e.split("."),c=0,d=l.length;d>c;c++){var p=h[l[c]];if(void 0===p)return o.warn("can't find function to read object "+e+" - undefined"),r.reject();h=p}this._cacheReadObject[e]=h}var f=h(this.setJSON(t[e]),s);return void 0!==a&&(this._identifierMap[a]=f,s._uniqueID=a),f}},t.exports=f},function(t,e){"use strict";var i={prefixURL:"",databasePath:"",progressXHRCallback:void 0,readNodeURL:void 0,readImageURL:void 0,readBinaryArrayURL:void 0,imageLoadingUsePromise:!0,imageOnload:void 0,imageCrossOrigin:void 0};t.exports=i},function(t,e){"use strict";var i=function(t,e,i){this._mode=t,this._first=e,this._arrayLengths=i.slice(0)};i.prototype={draw:function(t){for(var e=t.getGraphicContext(),i=this._mode,r=this._first,n=this._arrayLengths,a=0,s=n.length;s>a;a++){var o=n[a];e.drawArrays(i,r,o),r+=o}},getMode:function(){return this._mode},getNumIndices:function(){for(var t=0,e=this._arrayLengths,i=0,r=e.length;r>i;i++)t+=e[i];return t},getCount:function(){return this.getNumIndices()},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(t){this._first=t}},t.exports=i},function(t,e){},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=i(1124),s=i(1134),o=i(1119),u=function(){n.call(this),this._ambient=a.createAndSet(.2,.2,.2,1),this._diffuse=a.createAndSet(.8,.8,.8,1),this._specular=a.createAndSet(0,0,0,1),this._emission=a.createAndSet(0,0,0,1),this._shininess=12.5};u.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Material",cloneType:function(){return new u},getParameterName:function(t){return this.getType()+"_uniform_"+t},getOrCreateUniforms:function(){var t=u;if(t.uniforms)return t.uniforms;var e={ambient:s.createFloat4(a.create(),"MaterialAmbient"),diffuse:s.createFloat4(a.create(),"MaterialDiffuse"),specular:s.createFloat4(a.create(),"MaterialSpecular"),emission:s.createFloat4(a.create(),"MaterialEmission"),shininess:s.createFloat1([0],"MaterialShininess")};return t.uniforms=new o(e),t.uniforms},setEmission:function(t){a.copy(t,this._emission)},getEmission:function(){return this._emission},setAmbient:function(t){a.copy(t,this._ambient)},getAmbient:function(){return this._ambient},setSpecular:function(t){a.copy(t,this._specular)},getSpecular:function(){return this._specular},setDiffuse:function(t){a.copy(t,this._diffuse)},getDiffuse:function(){return this._diffuse},setShininess:function(t){this._shininess=t},getShininess:function(){return this._shininess},setTransparency:function(t){this._diffuse[3]=1-t},getTransparency:function(){return this._diffuse[3]},apply:function(){var t=this.getOrCreateUniforms();t.ambient.setFloat4(this._ambient),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.emission.setFloat4(this._emission),t.shininess.setFloat(this._shininess)}}),"osg","Material"),t.exports=u},function(t,e,i){"use strict";var r=i(1109),n=i(1108),a=function(t,e,i,r){this._target=t,this._internalFormat=e,this._width=i,this._height=r,this._size=0,this.computeSize()};a.prototype={match:function(t){return t._target===this._target&&t._internalFormat===this._internalFormat&&t._width===this._width&&t._height===this._height},computeSize:function(){var t=i(1133),e=0;switch(this._internalFormat){case 1:e=8;break;case t.ALPHA:e=8;break;case t.LUMINANCE:e=8;break;case t.LUMINANCE_ALPHA:e=16;break;case 2:e=16;break;case t.RGB:e=24;break;case 3:e=24;break;case t.RGBA:e=32;break;case 4:e=32}var r=Math.ceil(this._width*this._height*e)/8;this._target===t.TEXTURE_CUBE_MAP&&(r*=6),r+=r/3,this._size=r},getSize:function(){return this._size}},a.getHash=function(){var t=Array.prototype.slice.call(arguments),e="";return t.forEach(function(t){e+=t}),e};var s=function(t,e,i){this._texture=t,this._id=e,this._textureSet=i};s.prototype={target:function(){return this._textureSet._profile._target},id:function(){return this._id},getTextureSet:function(){return this._textureSet},reset:function(){this._textureObject=null,this._texture=void 0},bind:function(t){t.bindTexture(this.target(),this._id)}};var o=function(t){this._profile=t,this._usedTextureObjects=[],this._orphanedTextureObjects=[]};o.prototype={getProfile:function(){return this._profile},getUsedTextureObjects:function(){return this._usedTextureObjects},getOrphanedTextureObjects:function(){return this._orphanedTextureObjects},takeOrGenerate:function(t,e){var i;if(this._orphanedTextureObjects.length>0)return i=this.takeFromOrphans(),i._texture=e,this._usedTextureObjects.push(i),i;var r=t.createTexture();return i=new s(e,r,this),this._usedTextureObjects.push(i),i},takeFromOrphans:function(){return this._orphanedTextureObjects.length?this._orphanedTextureObjects.pop():void 0},orphan:function(t){var e=this._usedTextureObjects.indexOf(t);-1!==e&&(this._orphanedTextureObjects.push(this._usedTextureObjects[e]),this._usedTextureObjects.splice(e,1))},flushDeletedTextureObjects:function(t,e){if(0>=e)return e;var i,r=this._orphanedTextureObjects.length,a=0,s=n.instance().tick();for(i=0;r>i&&e>a;i++)t.deleteTexture(this._orphanedTextureObjects[i].id()),this._orphanedTextureObjects[i].reset(),a=n.instance().deltaS(s,n.instance().tick());return this._orphanedTextureObjects.splice(0,i),e-a},flushAllDeletedTextureObjects:function(t){for(var e=this._orphanedTextureObjects.length,i=this.getProfile().getSize(),n=0,a=e;a>n;++n)t.deleteTexture(this._orphanedTextureObjects[n].id()),this._orphanedTextureObjects[n].reset();this._orphanedTextureObjects.length=0,r.info("TextureManager: released "+e+" with "+e*i/1048576+" MB")}};var u=function(){this._textureSetMap={}};u.prototype={generateTextureObject:function(t,e,i,r,n,s){var u=a.getHash(i,r,n,s);void 0===this._textureSetMap[u]&&(this._textureSetMap[u]=new o(new a(i,r,n,s)));var h=this._textureSetMap[u],l=h.takeOrGenerate(t,e);return l},updateStats:function(t,e){var i=0,r=0;window.Object.keys(this._textureSetMap).forEach(function(t){var e=this._textureSetMap[t].getProfile(),n=e.getSize(),a=this._textureSetMap[t].getUsedTextureObjects().length,s=this._textureSetMap[t].getOrphanedTextureObjects().length;i+=a*n,r+=s*n},this);var n=1048576;e("textureused").set(i/n),e("texturereserved").set(r/n),e("texturetotal").set((i+r)/n)},reportStats:function(){var t=0;window.Object.keys(this._textureSetMap).forEach(function(e){var i=this._textureSetMap[e].getProfile(),n=i.getSize()/1048576,a=this._textureSetMap[e].getUsedTextureObjects().length;n*=a,t+=n,r.notice(String(n)+" MB with "+a+" texture of "+i._width+"x"+i._height+" "+i._internalFormat)},this),r.notice(String(t)+" MB in total")},flushAllDeletedTextureObjects:function(t){window.Object.keys(this._textureSetMap).forEach(function(e){this._textureSetMap[e].flushAllDeletedTextureObjects(t)},this)},flushDeletedTextureObjects:function(t,e){for(var i=e,r=window.Object.keys(this._textureSetMap),n=0,a=r.length;a>n&&i>0;n++)i=this._textureSetMap[r[n]].flushDeletedTextureObjects(t,i);return i},releaseTextureObject:function(t){if(t){var e=t.getTextureSet();e.orphan(t)}}},t.exports=u},function(t,e,i){"use strict";var r=i(1139),n=function(t){this._initialBufferArray=void 0,this._bufferArray=void 0,t&&(this.setBufferArray(t),this.setInitialBufferArray(t))},a={setInitialBufferArray:function(t){this._initialBufferArray=t},getInitialBufferArray:function(){return this._initialBufferArray},setBufferArray:function(t){this._bufferArray=t.getBufferArray?t.getBufferArray():t},getBufferArray:function(){return this._bufferArray}},s=window.Object.keys(r.prototype);s.forEach(function(t){a[t]=function(){return r.prototype[t].apply(this._bufferArray,arguments)}}),n.prototype=a,t.exports=n},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=function(){n.call(this),this._attributeEnable=!1};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Billboard",cloneType:function(){return new a},setEnabled:function(t){this._attributeEnable=t},isEnabled:function(){return this._attributeEnable},apply:function(){}}),"osg","Billboard"),t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=i(1124),s=function(t){n.call(this),this._constantColor=a.create(),a.set(1,1,1,1,this._constantColor),void 0!==t&&this.setConstantColor(t)};s.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"BlendColor",cloneType:function(){return new s},setConstantColor:function(t){a.copy(t,this._constantColor)},getConstantColor:function(){return this._constantColor},apply:function(t){var e=t.getGraphicContext();e.blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3])}}),"osg","BlendColor"),t.exports=s},function(t,e,i){"use strict";var r=i(1105),n=i(1110),a=i(1155),s=i(1122),o=i(1133),u=i(1128),h=i(1124),l=function(){n.call(this),a.call(this),this.viewport=void 0,this._graphicContext=void 0,this.setClearColor(h.createAndSet(0,0,0,1)),this.setClearDepth(1),this.setClearMask(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),this.setViewMatrix(s.create()),this.setProjectionMatrix(s.create()),this.renderOrder=l.NESTED_RENDER,this.renderOrderNum=0,this._view=void 0,this._renderer=void 0,this._attachments={}};l.PRE_RENDER=0,l.NESTED_RENDER=1,l.POST_RENDER=2,l.COLOR_BUFFER_BIT=16384,l.DEPTH_BUFFER_BIT=256,l.STENCIL_BUFFER_BIT=1024,l.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,r.objectInherit(n.prototype,{getView:function(){return this._view},setView:function(t){this._view=t},getRenderer:function(){return this._renderer},setRenderer:function(t){this._renderer=t},setFinalDrawCallback:function(t){this._finalDrawCallback=t},getFinalDrawCallback:function(){return this._finalDrawCallback},setInitialDrawCallback:function(t){this._initialDrawCallback=t},getInitialDrawCallback:function(){return this._initialDrawCallback},getAttachments:function(){return this._attachments},setGraphicContext:function(t){this._graphicContext=t},getGraphicContext:function(){return this._graphicContext},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setClearColor:function(t){this.clearColor=t},getClearColor:function(){return this.clearColor},setViewport:function(t){this.viewport=t,this.getOrCreateStateSet().setAttributeAndModes(t)},getViewport:function(){return this.viewport},setViewMatrix:function(t){this.modelviewMatrix=t},setViewMatrixAsLookAt:function(t,e,i){s.makeLookAt(t,e,i,this.getViewMatrix())},setProjectionMatrix:function(t){this.projectionMatrix=t},setProjectionMatrixAsOrtho:function(t,e,i,r,n,a){s.makeOrtho(t,e,i,r,n,a,this.getProjectionMatrix())},isRenderToTextureCamera:function(){return window.Object.keys(this._attachments).length>0},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(t,e){this.renderOrder=t,this.renderOrderNum=e},detachAll:function(){this._attachments={},this.frameBufferObject&&this.frameBufferObject.dirty()},resetAttachments:function(){this.frameBufferObject&&(this.frameBufferObject.reset(),this.frameBufferObject=0),this._attachments={}},attachTexture:function(t,e,i){this.frameBufferObject&&this.frameBufferObject.dirty(),i||(i=o.TEXTURE_2D),this._attachments[t]={attachment:t,texture:e,textureTarget:i}},attachRenderBuffer:function(t,e){this.frameBufferObject&&this.frameBufferObject.dirty(),this._attachments[t]={format:e,attachment:t}},computeLocalToWorldMatrix:function(t){return this.referenceFrame===u.RELATIVE_RF?s.preMult(t,this.modelviewMatrix):s.copy(this.modelviewMatrix,t),!0},computeWorldToLocalMatrix:function(){var t=s.create();return function(e){return s.inverse(this.modelviewMatrix,t),this.referenceFrame===u.RELATIVE_RF?s.postMult(t,e):s.copy(t,e),!0}}()})),"osg","Camera"),r.setTypeID(l),t.exports=l},function(t,e){"use strict";var i=function(){i.prototype.reset.call(this)};i.prototype={reset:function(){this._computeNearFar=!0,this._nearFarRatio=.005,this.bbCornerFar=3,this.bbCornerNear=4,this._enableFrustumCulling=!1,this._settingsSourceOverrider=this,this._LODScale=1,this._clampProjectionMatrixCallback=void 0},setCullSettings:function(t){this._computeNearFar=t._computeNearFar,this._nearFarRatio=t._nearFarRatio,this._enableFrustumCulling=t._enableFrustumCulling,this._settingsSourceOverrider=t._settingsSourceOverrider,this._clampProjectionMatrixCallback=t._clampProjectionMatrixCallback},setNearFarRatio:function(t){this._nearFarRatio=t},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(t){this._computeNearFar=t},getComputeNearFar:function(){return this._computeNearFar},setEnableFrustumCulling:function(t){this._enableFrustumCulling=t},getEnableFrustumCulling:function(){return this._enableFrustumCulling},getSettingSourceOverrider:function(){return this._settingsSourceOverrider},setClampProjectionMatrixCallback:function(t){this._clampProjectionMatrixCallback=t},getClampProjectionMatrixCallback:function(){return this._clampProjectionMatrixCallback},setLODScale:function(t){this._LODScale=t},getLODScale:function(){return this._LODScale}},t.exports=i},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=function(t,e,i,r){n.call(this),this._colorMask=[!0,!0,!0,!0],this.setMask(t,e,i,r)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ColorMask",cloneType:function(){return new a},setMask:function(t,e,i,r){void 0!==t&&void 0!==e&&void 0!==i&&void 0!==r&&(this._colorMask[0]=t,this._colorMask[1]=e,this._colorMask[2]=i,this._colorMask[3]=r)},apply:function(t){var e=t.getGraphicContext(),i=this._colorMask;e.colorMask(i[0],i[1],i[2],i[3])}}),"osg","ColorMask"),t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=function(t){n.call(this),this.setMode(void 0!==t?t:a.BACK)};a.DISABLE=0,a.FRONT=1028,a.BACK=1029,a.FRONT_AND_BACK=1032,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"CullFace",cloneType:function(){return new a},setMode:function(t){var e=t;"string"==typeof e&&(e=a[e]),this._mode=e},getMode:function(){return this._mode},apply:function(t){var e=t.getGraphicContext();this._mode===a.DISABLE?e.disable(e.CULL_FACE):(e.enable(e.CULL_FACE),e.cullFace(this._mode))}}),"osg","CullFace"),t.exports=a},function(t,e,i){"use strict";var r=i(1159),n=function(){this._mask=n.DEFAULT_CULLING,this._frustum=new r};n.prototype={reset:function(){this._mask=n.DEFAULT_CULLING,this._frustum.clear()},setCullingMask:function(t){this._mask=t},getCullingMask:function(){return this._mask},setFrustum:function(t){this._frustum=t},getFrustum:function(){return this._frustum},getCurrentResultMask:function(){return this._frustum.getCurrentMask()},pushCurrentMask:function(){this._frustum.pushCurrentMask()},popCurrentMask:function(){this._frustum.popCurrentMask()},resetCullingMask:function(){this._frustum.setResultMask(this._frustum.getCurrentMask())},isBoundingBoxCulled:function(t){return this._mask&n.VIEW_FRUSTUM_CULLING&&!this._frustum.containsBoundingBox(t)?!0:!1},isBoundingSphereCulled:function(t){return this._mask&n.VIEW_FRUSTUM_CULLING&&!this._frustum.containsBoundingSphere(t)?!0:!1},isVerticesCulled:function(t){return this._mask&n.VIEW_FRUSTUM_CULLING&&!this._frustum.containsVertices(t)?!0:!1}},n.NO_CULLING=0,n.VIEW_FRUSTUM_LEFT_CULLING=1,n.VIEW_FRUSTUM_RIGHT_CULLING=2,n.VIEW_FRUSTUM_TOP_CULLING=3,n.VIEW_FRUSTUM_BOTTOM_CULLING=4,n.NEAR_PLANE_CULLING=5,n.FAR_PLANE_CULLING=6,n.VIEW_FRUSTUM_SIDES_CULLING=n.VIEW_FRUSTUM_LEFT_CULLING|n.VIEW_FRUSTUM_RIGHT_CULLING|n.VIEW_FRUSTUM_BOTTOM_CULLING|n.VIEW_FRUSTUM_TOP_CULLING,n.VIEW_FRUSTUM_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING|n.NEAR_PLANE_CULLING|n.FAR_PLANE_CULLING,n.DEFAULT_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING,n.ENABLE_ALL_CULLING=n.VIEW_FRUSTUM_CULLING,t.exports=n},function(t,e,i){"use strict";var r=i(1112),n=i(1123),a=i(1105),s=i(1124),o=function(){this._clippingMask=0,this._planeList=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],this._vertexList=[],this._maskStack=[],this._resultMask=0,this._maskStack.push(this._resultMask)};o.prototype=a.objectInherit(r.prototype,{getPlanes:function(){return this._planeList},setPlanes:function(t){this._planeList=t,this.setupMask()},clear:function(){if(this._clippingMask=0,this._planeList)for(var t=0,e=this._planeList.length;e>t;++t)n.init(this._planeList[t]);this._vertexList=[],this.setupMask()},setToUnitFrustum:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this._planeList.length=0,this._planeList.push(s.set(1,0,0,1,n.create())),this._planeList.push(s.set(-1,0,0,1,n.create())),this._planeList.push(s.set(0,1,0,1,n.create())),this._planeList.push(s.set(0,-1,0,1,n.create())),t&&this._planeList.push(s.set(0,0,1,1,n.create())),e&&this._planeList.push(s.set(0,0,-1,1,n.create())),this.setupMask()},setToBoundingBox:function(t){this._planeList.length=0,this._planeList.push(s.set(1,0,0,-t.getMin()[0],n.create())),this._planeList.push(s.set(-1,0,0,t.getMax()[0],n.create())),this._planeList.push(s.set(0,1,0,-t.getMin()[1],n.create())),this._planeList.push(s.set(0,-1,0,t.getMax()[1],n.create())),this._planeList.push(s.set(0,0,1,-t.getMin()[2],n.create())),this._planeList.push(s.set(0,0,-1,t.getMax()[2],n.create())),this.setupMask()},setAndTransformProvidingInverse:function(t,e){this._referenceVertexList=t._referenceVertexList;var i=t._maskStack[this._maskStack.length-1];if(0===i)return this._maskStack[this._maskStack.length-1]=0,this._resultMask=0,void(this._planeList.length=0);var r,a=1,s=0;for(r=0;r!==t._planeList.length;++r)i&a&&++s,a<<=1;this._planeList.length=s,this._resultMask=0,a=1;var o=0;for(r=0;r!==t._planeList.length;++r)i&a&&(this._planeList[o]=t._planeList[r],n.transformProvidingInverse(this._planeList[o++],e),this._resultMask=this._resultMask<<1|1),a<<=1;this._maskStack[this._maskStack.length-1]=this._resultMask},voidset:function(t){this._planeList=t,this.setupMask()},add:function(t){this._planeList.push(t),this.setupMask()},empty:function(){return 0===this._planeList.length},getPlaneList:function(){return this._planeList},setReferenceVertexList:function(t){this._referenceVertexList=t},getReferenceVertexList:function(){return this._referenceVertexList},setupMask:function(t){this._resultMask=0;for(var e=void 0!==t?t:this._planeList.length,i=0;e>i;++i)this._resultMask=this._resultMask<<1|1;this._maskStack=[],this._maskStack.push(this._resultMask)},getCurrentMask:function(){return this._maskStack[this._maskStack.length-1]},setResultMask:function(t){this._resultMask=t},getResultMask:function(){return this._resultMask},getMaskStack:function(){return this._maskStack},pushCurrentMask:function(){this._maskStack.push(this._resultMask)},popCurrentMask:function(){return this._maskStack.pop()},containsVertex:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;for(var e=1,i=0;i<this._planeList.length;++i){if(this._maskStack[this._maskStack.length-1]&e&&n.distanceToPlane(this._planeList[i],t)<0)return!1;e<<=1}return!0},containsVertices:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=0;e<t.length;++e){for(var i=t[e],r=!1,a=1,s=0;!r&&s<this._planeList.length;++s)this._maskStack[this._maskStack.length-1]&a&&n.distanceToPlane(this._planeList[s],i)<0&&(r=!0),a<<=1;if(!r)return!0}return!1},containsBoundingSphere:function(t){if(!this._maskStack[this._maskStack.length-1]||!t.valid())return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(n.OUTSIDE===r)return!1;n.INSIDE===r&&(this._resultMask^=e)}e<<=1}return!0},containsBoundingBox:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingBox(this._planeList[i],t);if(n.OUTSIDE===r)return!1;n.INSIDE===r&&(this._resultMask^=e)}e<<=1}return!0},containsAllOfVertices:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsVertices(this._planeList[i],t);if(1>r)return!1;this._resultMask^=e}e<<=1}return!0},containsAllOfBoundingSphere:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(1>r)return!1;this._resultMask^=e}e<<=1}return!0},containsAllOfBoundingBox:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingBox(this._planeList[i],t);if(1>r)return!1;this._resultMask^=e}e<<=1}return!0},transformProvidingInverse:function(t){if(this._maskStack[this._maskStack.length-1]){this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i)this._resultMask&e&&(n.transformProvidingInverse(this._planeList[i],t),e<<=1)}}}),t.exports=o;
},function(t,e,i){"use strict";var r=i(1105),n=i(1117),a=i(1154),s=i(1127),o=i(1155),u=i(1158),h=i(1122),l=i(1126),c=i(1110),d=i(1109),p=i(1128),f=i(1114),g=function(){this._modelViewMatrixStack=[],this._projectionMatrixStack=[],this._viewportStack=[],this._cullingSetStack=[],this._frustumVolume=-1,this._bbCornerFar=0,this._bbCornerNear=0,this._reservedMatrixStack=new l,this._reserveCullingSetStack=[new u],this._reserveCullingSetStack.current=0,this._cameraIndexStack=[],this._cameraModelViewIndexStack=[],this._cameraMatrixInverse=[],this._cameraMatrixInverseRoot=void 0};g.prototype=r.objectInherit(o.prototype,{_getReservedCullingSet:function(){var t=this._reserveCullingSetStack[this._reserveCullingSetStack.current++];return this._reserveCullingSetStack.current===this._reserveCullingSetStack.length&&this._reserveCullingSetStack.push(new u),t},reset:function(){this._modelViewMatrixStack.length=0,this._projectionMatrixStack.length=0,this._cullingSetStack.length=0,this._reservedMatrixStack.reset(),this._reserveCullingSetStack.current=0,this._cameraModelViewIndexStack.length=0,this._cameraIndexStack.length=0,this._cameraMatrixInverse.length=0,this._cameraMatrixInverseRoot=void 0},getProjectionMatrixStack:function(){return this._projectionMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelViewMatrix:function(){return this._modelViewMatrixStack[this._modelViewMatrixStack.length-1]},getCurrentModelviewMatrix:function(){return d.warn("deprecated switch to getCurrentModelViewMatrix"),this.getCurrentModelViewMatrix()},getCameraInverseMatrix:function(){if(!this._cameraIndexStack.length)return this._cameraMatrixInverseRoot;var t=this._cameraIndexStack[this._cameraIndexStack.length-1],e=this.getNodePath()[t],i=e.getInstanceID();if(void 0===this._cameraMatrixInverse[i]){var r=this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length-1],n=this._modelViewMatrixStack[r],a=this._reservedMatrixStack.get();h.inverse(n,a),this._cameraMatrixInverse[i]=a}return this._cameraMatrixInverse[i]},getCurrentModelWorldMatrix:function(){var t=this.getCameraInverseMatrix(),e=this._reservedMatrixStack.get(),i=h.mult(t,this.getCurrentModelViewMatrix(),e);return i},getCurrentViewMatrix:function(){if(!this._cameraIndexStack.length)return this._modelViewMatrixStack[0];var t=this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length-1];return this._modelViewMatrixStack[t]},getViewport:function(){return 0!==this._viewportStack.length?this._viewportStack[this._viewportStack.length-1]:void 0},getLookVectorLocal:function(t){var e=this.getCurrentModelViewMatrix();return f.set(-e[2],-e[6],-e[10],t)},pushViewport:function(t){this._viewportStack.push(t)},popViewport:function(){this._viewportStack.pop()},pushCullingSet:function(){var t=this._getReservedCullingSet();this._enableFrustumCulling&&(h.getFrustumPlanes(this.getCurrentProjectionMatrix(),this.getCurrentModelViewMatrix(),t.getFrustum().getPlanes(),!1),t.getFrustum().setupMask(4)),this._cullingSetStack.push(t)},popCullingSet:function(){return this._cullingSetStack.pop()},getCurrentCullingSet:function(){return this._cullingSetStack[this._cullingSetStack.length-1]},pushCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.pushCurrentMask()},popCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.popCurrentMask()},isVerticesCulled:function(t){return this._enableFrustumCulling?this.getCurrentCullingSet().isVerticesCulled(t):!1},isBoundingBoxCulled:function(t){return this._enableFrustumCulling?t.valid()&&this.getCurrentCullingSet().isBoundingBoxCulled(t):!1},isBoundingSphereCulled:function(t){return this._enableFrustumCulling?t.valid()&&this.getCurrentCullingSet().isBoundingSphereCulled(t):!1},isCulled:function(){var t=new n;return function(e,i){if(!this._enableFrustumCulling)return!1;if(e.isCullingActive()){if(0===this.getCurrentCullingSet().getCurrentResultMask())return!1;var r=this._reservedMatrixStack.get();return h.makeIdentity(r),r=e instanceof c?s.computeLocalToWorld(i.slice(0,i.length-1),!0,r):s.computeLocalToWorld(i,!0,r),h.transformBoundingSphere(r,e.getBound(),t),this.getCurrentCullingSet().isBoundingSphereCulled(t)}return this.getCurrentCullingSet().resetCullingMask(),!1}}(),pushModelViewMatrix:function(){var t=f.create();return function(e){var i=this.getNodePath(),r=i.length;if(r){var n=r-1;i[n].getTypeID()===a.getTypeID()&&i[n].getReferenceFrame()===p.ABSOLUTE_RF&&(this._cameraIndexStack.push(n),this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.length))}else{var s=this._reservedMatrixStack.get();h.inverse(e,s),this._cameraMatrixInverseRoot=s}this._modelViewMatrixStack.push(e),this.getLookVectorLocal(t),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),popModelViewMatrix:function(){var t=f.create();return function(){var e=this.getNodePath(),i=e.length-1;this._cameraIndexStack.length&&i===this._cameraIndexStack[this._cameraIndexStack.length-1]&&(this._cameraIndexStack.pop(),this._cameraModelViewIndexStack.pop()),this._modelViewMatrixStack.pop(),0!==this._modelViewMatrixStack.length?this.getLookVectorLocal(t):f.set(0,0,-1,t),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),pushProjectionMatrix:function(t){this._projectionMatrixStack.push(t),this._frustumVolume=-1,this.pushCullingSet()},popProjectionMatrix:function(){this._projectionMatrixStack.pop(),this._frustumVolume=-1,this.popCullingSet()}}),t.exports=g},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1115),s=i(1121),o=i(1155),u=i(1160),h=i(1122),l=i(1143),c=i(1104),d=i(1144),p=i(1162),f=i(1106),g=i(1130),m=i(1163),v=i(1164),_=i(1165),b=i(1111),x=i(1167),A=i(1169),y=i(1154),S=i(1128),C=i(1114),w=i(1170),T=i(1176),M=i(1172),E=i(1177),k=function(){s.call(this,s.TRAVERSE_ACTIVE_CHILDREN),o.call(this),u.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;var t=C.createAndSet(0,0,-1);this._camera=void 0,this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar,this._reserveLeafStack=[new m],this._reserveLeafStackCurrent=0,this._reserveRenderStageStacks={},this._reserveCullSettingsStack=[new o],this._reserveCullSettingsStackCurrent=0,this._renderBinStack=[],this.visitorType=s.CULL_VISITOR,this._identityMatrix=h.create(),this._renderer=void 0,this._renderStageType=_,this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0};k.prototype=n.objectInherit(u.prototype,n.objectInherit(s.prototype,{distance:function(t,e){return-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+e[14])},getComputedNear:function(){return this._computedNear},getComputedFar:function(){return this._computedFar},resetStats:function(){this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0},handleCullCallbacksAndTraverse:function(t){var e=t.getCullCallback();(!e||e.cull(t,this))&&this.traverse(t)},getCurrentCamera:function(){return this._currentRenderBin.getStage().getCamera()},updateCalculatedNearFar:function(){var t=C.create(),e=C.create();return function(i,r){var n,a,s=r.getBoundingBox();if(n=this.distance(s.corner(this._bbCornerNear,t),i),a=this.distance(s.corner(this._bbCornerFar,e),i),n>a){var o=n;n=a,a=o}return 0>a?!1:(n<this._computedNear&&(this._computedNear=n),a>this._computedFar&&(this._computedFar=a),!0)}}(),setStateGraph:function(t){this._rootStateGraph=t,this._currentStateGraph=t},setRenderStage:function(t){this._rootRenderStage=t,this._currentRenderBin=t},setRenderer:function(t){this._renderer=t},getRenderer:function(){return this._renderer},reset:function(){u.prototype.reset.call(this),this.resetRenderLeafStack(),this._reserveLeafStackCurrent=0,this.resetCullSettingsStack(),this._reserveCullSettingsStackCurrent=0;for(var t=window.Object.keys(this._reserveRenderStageStacks),e=0,i=t.length;i>e;e++){var r=t[e];this._reserveRenderStageStacks[r].reset()}v.resetStack(),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(t){this._currentRenderBin=t},addPositionedAttribute:function(t,e){var i=t?t:this._identityMatrix;this._currentRenderBin.getStage().positionedAttribute.push([i,e])},pushStateSet:function(t){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(t),void 0!==t.getBinName()){var e=this._renderBinStack,i=this._currentRenderBin;e.push(i),this._currentRenderBin=i.getStage().findOrInsert(t.getBinNumber(),t.getBinName())}},popStateSet:function(){var t=this._currentStateGraph,e=t.getStateSet();if(this._currentStateGraph=t.parent,void 0!==e.getBinName()){var i=this._renderBinStack;0===i.length?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=i.pop()}},popProjectionMatrix:function(){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var t=this.getCurrentProjectionMatrix();void 0!==this._clampProjectionMatrixCallback?this._clampProjectionMatrixCallback(t,this._computedNear,this._computedFar,this._nearFarRatio):h.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio)}u.prototype.popProjectionMatrix.call(this)},popCameraModelViewProjectionMatrix:function(){this.popModelViewMatrix(),this.popProjectionMatrix()},pushCameraModelViewProjectionMatrix:function(t,e,i){this.pushModelViewMatrix(e),this.pushProjectionMatrix(i)},apply:function(t){this[t.typeID](t)},createOrReuseRenderStage:function(t){var e,i=t?t.className():"RenderStage",r=t?t.constructor:_;return this._reserveRenderStageStacks[i]?e=this._reserveRenderStageStacks[i]:(e=new f.OsgObjectMemoryStack(r),this._reserveRenderStageStacks[i]=e),e.get().init()},createOrReuseRenderLeaf:function(){var t=this._reserveLeafStack[this._reserveLeafStackCurrent++];return this._reserveLeafStackCurrent===this._reserveLeafStack.length&&this._reserveLeafStack.push(new m),t},resetRenderLeafStack:function(){for(var t=0,e=this._reserveLeafStackCurrent;e>=t;t++)this._reserveLeafStack[t].reset()},createOrReuseCullSettings:function(){var t=this._reserveCullSettingsStack[this._reserveCullSettingsStackCurrent++];return this._reserveCullSettingsStackCurrent===this._reserveCullSettingsStack.length&&this._reserveCullSettingsStack.push(new o),t},resetCullSettingsStack:function(){for(var t=0,e=this._reserveCullSettingsStackCurrent;e>=t;t++)this._reserveCullSettingsStack[t].reset()},postPushGeometry:function(t,e){var i,r;e instanceof T?(r=e.getStateSetAnimation(),r&&t.pushStateSet(r),i=e.getSourceGeometry(),i instanceof E&&(r=i.getStateSetAnimation(),r&&t.pushStateSet(r))):e instanceof E&&(r=e.getStateSetAnimation(),r&&t.pushStateSet(r))},prePopGeometry:function(t,e){if(e instanceof T){var i=e.getSourceGeometry();i instanceof E&&i.getStateSetAnimation()&&t.popStateSet(),e.getStateSetAnimation()&&t.popStateSet()}else e instanceof E&&e.getStateSetAnimation()&&t.popStateSet()},pushLeaf:function(t,e){var i=this._currentStateGraph.leafs;0===i.length&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var r=this.createOrReuseRenderLeaf();r.init(this._currentStateGraph,t,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelWorldMatrix(),e),i.push(r)}})),k.prototype[y.typeID]=function(t){this._numCamera++;var e=t.getStateSet();e&&this.pushStateSet(e);var i=this._reservedMatrixStack.get(),r=this._reservedMatrixStack.get();if(t.getReferenceFrame()===S.RELATIVE_RF){var n=this.getCurrentProjectionMatrix();h.mult(n,t.getProjectionMatrix(),r);var a=this.getCurrentModelViewMatrix();h.mult(a,t.getViewMatrix(),i)}else h.copy(t.getViewMatrix(),i),h.copy(t.getProjectionMatrix(),r);var s=this._computedNear,o=this._computedFar,u=this.createOrReuseCullSettings();if(u.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(t),u.getSettingSourceOverrider()===this&&u.getEnableFrustumCulling()&&this.setEnableFrustumCulling(!0),this.pushCameraModelViewProjectionMatrix(t,i,r),t.getViewport()&&this.pushViewport(t.getViewport()),t.getRenderOrder()===y.NESTED_RENDER)this.handleCullCallbacksAndTraverse(t);else{var l=this.getCurrentRenderBin(),c=l.getStage(),d=this.createOrReuseRenderStage(this._rootRenderStage);d.setCamera(t),d.setClearDepth(t.getClearDepth()),d.setClearColor(t.getClearColor()),d.setClearMask(t.getClearMask());var p;p=void 0===t.getViewport()?c.getViewport():t.getViewport(),d.setViewport(p),this.setCurrentRenderBin(d),this.handleCullCallbacksAndTraverse(t),this.setCurrentRenderBin(l),t.getRenderOrder()===y.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(d,t.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(d,t.renderOrderNum)}this.popCameraModelViewProjectionMatrix(t),t.getViewport()&&this.popViewport(),this.setCullSettings(u),this._computedNear=s,this._computedFar=o,e&&this.popStateSet()},k.prototype[l.typeID]=function(t){if(this._numMatrixTransform++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=this._reservedMatrixStack.get(),i=this.getCurrentModelViewMatrix();h.copy(i,e),t.computeLocalToWorldMatrix(e),this.pushModelViewMatrix(e);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popModelViewMatrix(),this.popCurrentMask()}},k.prototype[d.typeID]=function(t){this._numProjection++;var e=this.getCurrentProjectionMatrix(),i=this._reservedMatrixStack.get();h.mult(e,t.getProjectionMatrix(),i),this.pushProjectionMatrix(i);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popProjectionMatrix()},k.prototype[b.typeID]=function(t){if(this._numNode++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=t.getStateSet();e&&this.pushStateSet(e),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet(),this.popCurrentMask()}},k.prototype[c.typeID]=k.prototype[l.typeID],k.prototype[x.typeID]=k.prototype[b.typeID],k.prototype[A.typeID]=k.prototype[b.typeID],k.prototype[p.typeID]=function(t){this._numLightSource++;var e=t.getStateSet();e&&this.pushStateSet(e);var i=t.getLight();i&&(t.getReferenceFrame()===S.RELATIVE_RF?this.addPositionedAttribute(this.getCurrentModelViewMatrix(),i):this.addPositionedAttribute(null,i)),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet()},k.prototype[g.typeID]=function(){var t=C.create(),e=!1;return function(i){this._numGeometry++;var n=this.getCurrentModelViewMatrix(),s=i.getBoundingBox();if(!this._computeNearFar||!s.valid()||this.updateCalculatedNearFar(n,i)){var o=i.getCullCallback();if(!o||o.cull(i,this)){var u=i.getStateSet();u&&this.pushStateSet(u),this.postPushGeometry(this,i);var h=0;s.valid()&&(h=this.distance(s.center(t),n)),a.isNaN(h)?e||(r.warn("warning geometry has a NaN depth, "+n+" center "+t),e=!0):this.pushLeaf(i,h),this.prePopGeometry(this,i),u&&this.popStateSet()}}}}(),k.prototype[w.typeID]=k.prototype[l.typeID],k.prototype[T.typeID]=k.prototype[g.typeID],k.prototype[E.typeID]=k.prototype[g.typeID],k.prototype[M.typeID]=k.prototype[l.typeID],t.exports=k},function(t,e,i){"use strict";var r=i(1105),n=i(1111),a=i(1128),s=i(1114),o=function(){n.call(this),this._light=void 0,this._referenceFrame=a.RELATIVE_RF};o.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getLight:function(){return this._light},setLight:function(t){this._light=t},setReferenceFrame:function(t){this._referenceFrame=t},getReferenceFrame:function(){return this._referenceFrame},computeBoundingSphere:function(){var t=s.create();return function(e){if(n.prototype.computeBoundingSphere.call(this,e),void 0!==this._light&&this._referenceFrame===a.RELATIVE_RF){var i=this._light.getPosition();0!==i[3]&&e.expandByVec3(s.mult(i,1/i[3],t))}return e}}()}),"osg","LightSource"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(1107),n=function(t,e){this.modelWorldUniform=e._uniformsCache[t.modelWorldMatrix.getName()],this.viewUniform=e._uniformsCache[t.viewMatrix.getName()],this.apply=void 0,this.generateUniformsApplyMethods()};n.prototype={generateUniformsApplyMethods:function(){var t=["//generated by RenderLeaf\n"];t.push("var gl = state.getGraphicContext();"),t.push("var matrixModelViewChanged = state.applyModelViewMatrix( modelview );"),t.push("state.applyProjectionMatrix( projection );"),void 0!==this.modelWorldUniform&&(t.push("if ( matrixModelViewChanged ) {"),t.push("    var modelWorldMatrix = state.modelWorldMatrix;"),t.push("    modelWorldMatrix.setMatrix4( modelworld );"),t.push("    modelWorldMatrix.apply( gl, this.modelWorldUniform);"),t.push("};")),void 0!==this.viewUniform&&(t.push("if ( matrixModelViewChanged ) {"),t.push("    var viewMatrix = state.viewMatrix;"),t.push("    viewMatrix.setMatrix4( view );"),t.push("    viewMatrix.apply( gl, this.viewUniform);"),t.push("};"));var e=new Function("state","modelview","modelworld","view","projection","return function RenderLeafApplyMatrixUniformCache( state, modelview, modelworld, view, projection ) { "+t.join("\n")+"}")();this.apply=e}};var a=function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._modelWorld=void 0,this._modelView=void 0};a.prototype={reset:function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._modelWorld=void 0,this._modelView=void 0},init:function(t,e,i,r,n,a,s){this._parent=t,this._geometry=e,this._depth=s,this._projection=i,this._view=r,this._modelWorld=a,this._modelView=n},drawGeometry:function(){return function(t){var e=t.getLastProgramApplied(),i=e.getInstanceID(),r=t.getCacheUniformsApplyRenderLeaf(),a=r[i];a||(a=new n(t,e),r[i]=a),a.apply(t,this._modelView,this._modelWorld,this._view,this._projection,this._normal),this._geometry.drawImplementation(t)}}(),render:function(){var t;return function(e,i){var n,a,s=this._parent,o=s.parent,u=s.stateset;if(void 0!==i)if(n=i._parent,a=n.parent,a!==o)r.moveStateGraph(e,a,o),e.applyStateSet(u),t=e.getStateSetStackHash();else if(s!==n)e.applyStateSet(u),t=e.getStateSetStackHash();else{var h=e.getStateSetStackHash();t!==h&&(e.applyStateSet(u),t=h)}else r.moveStateGraph(e,void 0,o),e.applyStateSet(u),t=e.getStateSetStackHash();this.drawGeometry(e)}}()},t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1109),a=i(1112),s=i(1115),o=function(t){a.call(this),this._leafs=[],this.positionedAttribute=[],this.stateGraphList=[],o.prototype.init.call(this,t)};o.SORT_BY_STATE=0,o.SORT_BACK_TO_FRONT=1,o.SORT_FRONT_TO_BACK=2,o.defaultSortMode=o.SORT_BY_STATE,o.BinPrototypes={RenderBin:function(){return o.getOrCreate().init()},DepthSortedBin:function(){return o.getOrCreate().init(o.SORT_BACK_TO_FRONT)}};var u=function(t,e){return e._depth-t._depth},h=function(t,e){return t._depth-e._depth},l=function(t,e){return t._binNum-e._binNum};o.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{init:function(t){return this._leafs.length=0,this.positionedAttribute.length=0,this._renderStage=void 0,this._bins={},this.stateGraphList.length=0,this._parent=void 0,this._binNum=0,this._sorted=!1,this._sortMode=void 0!==t?t:o.defaultSortMode,this._drawCallback=void 0,this},_createRenderBin:function(t){var e=o.BinPrototypes.RenderBin;return t&&o.BinPrototypes[t]&&(e=o.BinPrototypes[t]),e()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);for(var t=!1,e=0,i=this.stateGraphList.length;i>e;e++)for(var r=this.stateGraphList[e].leafs,a=0,o=r.length;o>a;a++){var u=r[a];s.isNaN(u._depth)?t=!0:this._leafs.push(u)}t&&n.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this.stateGraphList.splice(0,this.stateGraphList.length)},getSortMode:function(){return this._sortMode},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(u)},sortFrontToBack:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(h)},sortImplementation:function(){var t=o;switch(this._sortMode){case t.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case t.SORT_FRONT_TO_BACK:this.sortFrontToBack();break;case t.SORT_BY_STATE:}},sort:function(){if(!this._sorted){for(var t=this._bins,e=window.Object.keys(t),i=0,r=e.length;r>i;i++)t[e[i]].sort();this.sortImplementation(),this._sorted=!0}},setParent:function(t){this._parent=t},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(t,e){var i=this._bins[t];return i||(i=this._createRenderBin(e),i._parent=this,i._binNum=t,i._renderStage=this._renderStage,this._bins[t]=i),i},getStage:function(){return this._renderStage},addStateGraph:function(t){this.stateGraphList.push(t)},reset:function(){this.stateGraphList.length=0,this._bins={},this.positionedAttribute.length=0,this._leafs.length=0,this._sorted=!1},draw:function(t,e){var i=e;return i=this._drawCallback&&this._drawCallback.drawImplementation?this._drawCallback.drawImplementation(this,t,i):this.drawImplementation(t,i)},applyPositionedAttribute:function(t,e){for(var i=0,r=e.length;r>i;i++){var n=e[i],a=n[1],s=n[0];t.setGlobalDefaultAttribute(a),a.apply(t),a.applyPositionedUniform(s,t),t.haveAppliedAttribute(a)}},drawImplementation:function(t,e){for(var i=e,r=window.Object.keys(this._bins),n=this._bins,a=[],s=0,o=r.length;o>s;s++){var u=r[s];a.push(n[u])}a.sort(l);for(var h,c=0,d=a.length;d>c&&(h=a[c],!(h.getBinNumber()>0));c++)i=h.draw(t,i);for(i=this.drawLeafs(t,i);d>c;c++)h=a[c],i=h.draw(t,i);return i},drawLeafs:function(t,e){for(var i,r=this.stateGraphList,n=this._leafs,a=e,s=0,o=n.length;o>s;s++)i=n[s],i.render(t,a),a=i;for(var u=0,h=r.length;h>u;u++)for(var l=r[u],c=0,d=l.leafs.length;d>c;c++)i=l.leafs[c],i.render(t,a),a=i;return a}}),"osg","RenderBin"),o.getOrCreate=function(){var t=o._reservedStack[o._reservedStackCurrent++];return o._reservedStackCurrent===o._reservedStack.length&&o._reservedStack.push(new o),t},o.resetStack=function(){o._reservedStackCurrent=0},o._reservedStack=[new o],o._reservedStackCurrent=0,t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1154),a=i(1166),s=i(1109),o=i(1164),u=i(1124),h=function(){o.call(this),this.clearColor=u.create(),this.preRenderList=[],this.postRenderList=[],h.prototype.init.call(this)};h.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{constructor:h,init:function(){return o.prototype.init.call(this),this.positionedAttribute.length=0,this.clearDepth=1,u.set(0,0,0,1,this.clearColor),this.clearMask=n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT,this.camera=void 0,this.viewport=void 0,this.preRenderList.length=0,this.postRenderList.length=0,this._renderStage=this,this},reset:function(){o.prototype.reset.call(this),this.preRenderList.length=0,this.postRenderList.length=0},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearColor:function(t){u.copy(t,this.clearColor)},getClearColor:function(){return this.clearColor},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setViewport:function(t){this.viewport=t},getViewport:function(){return this.viewport},setCamera:function(t){this.camera=t},getCamera:function(){return this.camera},getPositionedAttribute:function(){return this.positionedAttribute},getPreRenderStageList:function(){return this.preRenderList},getPostRenderStageList:function(){return this.postRenderList},addPreRenderStage:function(t,e){for(var i=0,r=this.preRenderList.length;r>i;i++){var n=this.preRenderList[i];if(e<n.order)break}i<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(i,0,{order:e,renderStage:t}):this.preRenderList.push({order:e,renderStage:t})},addPostRenderStage:function(t,e){for(var i=0,r=this.postRenderList.length;r>i;i++){var n=this.postRenderList[i];if(e<n.order)break}i<this.postRenderList.length?this.postRenderList=this.postRenderList.splice(i,0,{order:e,renderStage:t}):this.postRenderList.push({order:e,renderStage:t})},drawPreRenderStages:function(t,e){for(var i=e,r=0,n=this.preRenderList.length;n>r;++r){var a=this.preRenderList[r].renderStage;i=a.draw(t,i)}return i},draw:function(t,e){this.camera&&this.camera.getInitialDrawCallback()&&this.camera.getInitialDrawCallback()(t);var i=this.drawPreRenderStages(t,e);return i=this.drawImplementation(t,i),i=this.drawPostRenderStages(t,i),this.camera&&this.camera.getFinalDrawCallback()&&this.camera.getFinalDrawCallback()(t),i},sort:function(){for(var t=0,e=this.preRenderList.length;e>t;++t)this.preRenderList[t].renderStage.sort();o.prototype.sort.call(this);for(var i=0,r=this.postRenderList.length;r>i;++i)this.postRenderList[i].renderStage.sort()},drawPostRenderStages:function(t,e){for(var i=e,r=0,n=this.postRenderList.length;n>r;++r){var a=this.postRenderList[r].renderStage;i=a.draw(t,i)}return i},applyCamera:function(t){var e=t.getGraphicContext();if(void 0===this.camera)return void e.bindFramebuffer(e.FRAMEBUFFER,null);var i=this.camera.getViewport(),r=this.camera.frameBufferObject;if(r||(r=new a,this.camera.frameBufferObject=r),r.isDirty()){var n=this.camera.getAttachments(),s=window.Object.keys(n);if(s.length)for(var o=0,u=s.length;u>o;o++){var h=s[o],l=n[h],c={};c.attachment=l.attachment,void 0===l.texture?(c.format=l.format,c.width=i.width(),c.height=i.height()):void 0!==l.texture&&(c.texture=l.texture,c.textureTarget=l.textureTarget,l.format&&(c.format=l.format)),r.setAttachment(c)}}r.apply(t)},drawImplementation:function(t,e){var i=t.getGraphicContext();this.applyCamera(t),void 0===this.viewport&&s.log("RenderStage does not have a valid viewport"),t.applyAttribute(this.viewport),0!==this.clearMask&&(this.clearMask&i.COLOR_BUFFER_BIT&&i.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),this.clearMask&i.DEPTH_BUFFER_BIT&&(i.depthMask(!0),i.clearDepth(this.clearDepth)),i.clear(this.clearMask)),0!==this.positionedAttribute.length&&this.applyPositionedAttribute(t,this.positionedAttribute);var r=o.prototype.drawImplementation.call(this,t,e);return r}}),"osg","RenderStage"),t.exports=h},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1136),s=i(1120),o=i(1108),u=i(1131),h=function(){a.call(this),s.call(this),this._fbo=void 0,this._rbo=void 0,this._attachments=[],this._dirty=!0};h.COLOR_ATTACHMENT0=36064,h.DEPTH_ATTACHMENT=36096,h.DEPTH_COMPONENT16=33189,h._sDeletedGLFrameBufferCache=new window.Map,h.deleteGLFrameBuffer=function(t,e){h._sDeletedGLFrameBufferCache.has(t)||h._sDeletedGLFrameBufferCache.set(t,[]),h._sDeletedGLFrameBufferCache.get(t).push(e)},h.flushDeletedGLFrameBuffers=function(t,e){if(0>=e)return e;if(!h._sDeletedGLFrameBufferCache.has(t))return e;for(var i=0,r=o.instance().tick(),n=h._sDeletedGLFrameBufferCache.get(t),a=n.length,s=a-1;s>=0&&e>i;s--)t.deleteFramebuffer(n[s]),n.splice(s,1),i=o.instance().deltaS(r,o.instance().tick());return e-i},h.flushAllDeletedGLFrameBuffers=function(t){if(h._sDeletedGLFrameBufferCache.has(t))for(var e=h._sDeletedGLFrameBufferCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteFramebuffer(e[r]),e.splice(r,1)},h._sDeletedGLRenderBufferCache=new window.Map,h.deleteGLRenderBuffer=function(t,e){h._sDeletedGLRenderBufferCache.has(t)||h._sDeletedGLRenderBufferCache.set(t,[]),h._sDeletedGLRenderBufferCache.get(t).push(e)},h.flushDeletedGLRenderBuffers=function(t,e){if(0>=e)return e;if(!h._sDeletedGLRenderBufferCache.has(t))return e;for(var i=0,r=o.instance().tick(),n=h._sDeletedGLRenderBufferCache.get(t),a=n.length,s=a-1;s>=0&&e>i;s--)t.deleteRenderbuffer(n[s]),n.splice(s,1),i=o.instance().deltaS(r,o.instance().tick());return e-i},h.flushAllDeletedGLRenderBuffers=function(t){if(h._sDeletedGLRenderBufferCache.has(t))for(var e=h._sDeletedGLRenderBufferCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteRenderbuffer(e[r]),e.splice(r,1)},h.prototype=n.objectInherit(a.prototype,n.objectInherit(s.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new h},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},setAttachment:function(t){this._attachments.push(t)},releaseGLObjects:function(){void 0!==this._fbo&&void 0!==this._gl&&h.deleteGLFrameBuffer(this._gl,this._fbo),this._fbo=void 0,void 0!==this._rbo&&void 0!==this._gl&&h.deleteGLRenderBuffer(this._gl,this._rbo),this._rbo=void 0},_reportFrameBufferError:function(t){switch(t){case 36054:r.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:r.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:r.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:r.debug("FRAMEBUFFER_UNSUPPORTED");break;default:r.debug("FRAMEBUFFER unknown error "+t.toString(16))}},reset:function(){this.releaseGLObjects(),this._attachments=[]},getFrameBufferObject:function(){return this._fbo},createFrameBufferObject:function(t){this.setGraphicContext(t.getGraphicContext()),this._fbo=this._gl.createFramebuffer()},createRenderBuffer:function(t,e,i){var r=this._gl,n=r.createRenderbuffer();return r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),n},framebufferRenderBuffer:function(t,e){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,e)},framebufferTexture2D:function(t,e,i,r){var n=this._gl;return t.applyTextureAttribute(1,r),r.isDirty()||!r.getTextureObject()?!1:(n.framebufferTexture2D(n.FRAMEBUFFER,e,i,r.getTextureObject().id(),0),!0)},bindFrameBufferObject:function(){var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._fbo)},checkStatus:function(){var t=this._gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);36053!==e&&this._reportFrameBufferError(e)},_checkAllowedSize:function(t,e){var i=u.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");return 0===t||0===e||e>i||t>i?(r.error("width ("+t+") or height ("+t+') makes frame buffer not bindable. Max RenderBuffer is "'+i+'"'),!1):!0},apply:function(t){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl,i=this._attachments;if(i.length>0||this._fbo)if(this.isDirty()){this._fbo||this.createFrameBufferObject(t),this.bindFrameBufferObject();for(var n=!1,a=0,s=i.length;s>a;++a){var o=i[a];if(o.texture){var u=o.texture;if(!this._checkAllowedSize(u.getWidth(),u.getHeight()))return void this.releaseGLObjects();if(!this.framebufferTexture2D(t,o.attachment,o.textureTarget,u))return void this.releaseGLObjects()}else{if(!this._checkAllowedSize(o.width,o.height))return void this.releaseGLObjects();this._rbo=this.createRenderBuffer(o.format,o.width,o.height),this.framebufferRenderBuffer(o.attachment,this._rbo),n=!0}}this.checkStatus(),n&&e.bindRenderbuffer(e.RENDERBUFFER,null),this._dirty=!1}else e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),r.reportWebGLError===!0&&this.checkStatus();else e.bindFramebuffer(e.FRAMEBUFFER,null)}})),t.exports=h},function(t,e,i){"use strict";var r=i(1105),n=i(1111),a=i(1121),s=i(1122),o=i(1168),u=i(1114),h=i(1117),l=function(){n.call(this),this._radius=-1,this._range=[],this._rangeMode=l.DISTANCE_FROM_EYE_POINT,this._userDefinedCenter=[],this._centerMode=l.USE_BOUNDING_SPHERE_CENTER};l.DISTANCE_FROM_EYE_POINT=0,l.PIXEL_SIZE_ON_SCREEN=1,l.USE_BOUNDING_SPHERE_CENTER=0,l.USER_DEFINED_CENTER=1,l.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED=2,l.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getRadius:function(){return this._radius},setRadius:function(t){this._radius=t},setCenter:function(t){this._centerMode!==l.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&(this._centerMode=l.USER_DEFINED_CENTER),this._userDefinedCenter=t},getCenter:function(){
return this._centerMode===l.USER_DEFINED_CENTER||this._centerMode===l.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED?this._userDefinedCenter:this.getBound().center()},setCenterMode:function(t){this._centerMode=t},computeBoundingSphere:function(t){if(this._centerMode===l.USER_DEFINED_CENTER&&this._radius>=0)return t.set(this._userDefinedCenter,this._radius),t;if(this._centerMode===l.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&this._radius>=0){t.set(this._userDefinedCenter,this._radius);var e=new h;return t.expandByBoundingSphere(n.prototype.computeBoundingSphere.call(this,e)),t}return n.prototype.computeBoundingSphere.call(this,t),t},projectBoundingSphere:function(){var t=u.create();return function(e,i,r){s.transformVec3(i,e.center(),t);var n=e.radius2(),a=t[2]*t[2],o=u.length2(t),h=-Math.PI*r*r*n*Math.sqrt(Math.abs((o-n)/(n-a)))/(n-a);return h}}(),setRangeMode:function(t){this._rangeMode=t},addChildNode:function(t){if(n.prototype.addChild.call(this,t),this.children.length>this._range.length){var e=[],i=0;this._range.lenght>0&&(i=this._range[this._range.length-1][1]),e.push(o.createAndSet(i,i)),this._range.push(e)}return!0},addChild:function(t,e,i){if(n.prototype.addChild.call(this,t),this.children.length>this._range.length){var r=[];r.push(o.createAndSet(e,e)),this._range.push(r)}return this._range[this.children.length-1][0]=e,this._range[this.children.length-1][1]=i,!0},traverse:function(){var t=u.create(),e=u.create(),i=s.create();return function(r){var n=r.traversalMode;switch(n){case a.TRAVERSE_ALL_CHILDREN:for(var o=0;o<this.children.length;o++)this.children[o].accept(r);break;case a.TRAVERSE_ACTIVE_CHILDREN:var h=0,c=r.getCurrentModelViewMatrix();if(s.inverse(c,i),this._rangeMode===l.DISTANCE_FROM_EYE_POINT){s.transformVec3(i,t,e);var d=u.distance(e,this.getBound().center());h=d*r.getLODScale()}else{var p=r.getCurrentProjectionMatrix();h=this.projectBoundingSphere(this.getBound(),c,p[0]),h=h*r.getViewport().width()*r.getViewport().width()*.25/r.getLODScale()}var f=this.children.length;this._range.length<f&&(f=this._range.length);for(var g=0;f>g;++g)this._range[g][0]<=h&&h<this._range[g][1]&&this.children[g].accept(r)}}}()}),"osg","Lod"),r.setTypeID(l),t.exports=l},function(t,e,i){"use strict";var r=i(1115),n=i(1116),a=n.ArrayType,s={create:function(){var t=new a(2);return t[0]=0,t[1]=0,t},createAndSet:function(t,e){var i=new a(2);return i[0]=t,i[1]=e,i},copy:function(t,e){return e[0]=t[0],e[1]=t[1],e},set:function(t,e,i){return i[0]=t,i[1]=e,i},valid:function(t){return r.isNaN(t[0])?!1:r.isNaN(t[1])?!1:!0},mult:function(t,e,i){return i[0]=t[0]*e,i[1]=t[1]*e,i},length2:function(t){return t[0]*t[0]+t[1]*t[1]},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},distance2:function(t,e){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r},distance:function(t,e){var i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)},normalize:function(t,e){var i=this.length2(t);if(i>0){var r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r}else e[0]=t[0],e[1]=t[1];return e},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},sub:function(t,e,i){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i},add:function(t,e,i){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i},neg:function(t,e){return e[0]=-t[0],e[1]=-t[1],e},lerp:function(t,e,i,r){var n=1-t;return r[0]=e[0]*n+t*i[0],r[1]=e[1]*n+t*i[1],r}};t.exports=s},function(t,e,i){"use strict";var r=i(1105),n=i(1167),a=i(1121),s=i(1122),o=i(1114),u=function(){n.call(this),this._perRangeDataList=[],this._loading=!1,this._expiryTime=0,this._expiryFrame=0,this._centerMode=n.USER_DEFINED_CENTER,this._frameNumberOfLastTraversal=0,this._databasePath="",this._numChildrenThatCannotBeExpired=0},h=function(){this.filename="",this["function"]=void 0,this.loaded=!1,this.timeStamp=0,this.frameNumber=0,this.frameNumberOfLastTraversal=0,this.dbrequest=void 0};u.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{setRange:function(t,e,i){if(t>=this._range.length){var r=[];r.push([e,e]),this._range.push(r)}this._range[t][0]=e,this._range[t][1]=i},setExpiryTime:function(t){this._expiryTime=t},setDatabasePath:function(t){this._databasePath=t},getDatabasePath:function(){return this._databasePath},setFileName:function(t,e){if(t>=this._perRangeDataList.length){var i=new h;i.filename=e,this._perRangeDataList.push(i)}else this._perRangeDataList[t].filename=e},setFunction:function(t,e){if(t>=this._perRangeDataList.length){var i=new h;i["function"]=e,this._perRangeDataList.push(i)}else this._perRangeDataList[t]["function"]=e},addChild:function(t,e,i){n.prototype.addChild.call(this,t,e,i),this._perRangeDataList.push(new h)},addChildNode:function(t){n.prototype.addChildNode.call(this,t)},setFrameNumberOfLastTraversal:function(t){this._frameNumberOfLastTraversal=t},getFrameNumberOfLastTraversal:function(){return this._frameNumberOfLastTraversal},setTimeStamp:function(t,e){this._perRangeDataList[t].timeStamp=e},setFrameNumber:function(t,e){this._perRangeDataList[t].frameNumber=e},setNumChildrenThatCannotBeExpired:function(t){this._numChildrenThatCannotBeExpired=t},getNumChildrenThatCannotBeExpired:function(){return this._numChildrenThatCannotBeExpired},getDatabaseRequest:function(t){return this._perRangeDataList[t].dbrequest},removeExpiredChildren:function(t,e,i){if(!(this.children.length<=this._numChildrenThatCannotBeExpired)){var r,n,a=this.children.length-1;r=this._perRangeDataList[a].timeStamp+this._expiryTime,n=this._perRangeDataList[a].frameNumber+this._expiryFrame,t>r&&e>n&&(this._perRangeDataList[a].filename.length>0||void 0!==this._perRangeDataList[a]["function"])&&(i.push(this.children[a]),this.removeChild(this.children[a]),this._perRangeDataList[a].loaded=!1,void 0!==this._perRangeDataList[a].dbrequest&&(this._perRangeDataList[a].dbrequest._groupExpired=!0))}},traverse:function(){var t=o.create(),e=o.create(),i=s.create();return function(r){var u=r.traversalMode,h=!1;switch(r.getVisitorType()===a.CULL_VISITOR&&(this._frameNumberOfLastTraversal=r.getFrameStamp().getFrameNumber(),h=!0),u){case a.TRAVERSE_ALL_CHILDREN:for(var l=0;l<this.children.length;l++)this.children[l].accept(r);break;case a.TRAVERSE_ACTIVE_CHILDREN:var c=0,d=r.getCurrentModelViewMatrix();if(s.inverse(d,i),this._rangeMode===n.DISTANCE_FROM_EYE_POINT){s.transformVec3(i,t,e);var p=o.distance(e,this.getBound().center());c=p*r.getLODScale()}else{var f=r.getCurrentProjectionMatrix();c=this.projectBoundingSphere(this.getBound(),d,f[0]),c=c*r.getViewport().width()*r.getViewport().width()*.25/r.getLODScale(),0>c&&(c=this._range[this._range.length-1][0])}for(var g=!1,m=-1,v=0;v<this._range.length;++v)this._range[v][0]<=c&&c<this._range[v][1]&&(v<this.children.length?(h&&(this._perRangeDataList[v].timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[v].frameNumber=r.getFrameStamp().getFrameNumber()),this.children[v].accept(r),m=v):g=!0);if(g){var _=this.children.length;if(_>0&&_-1!==m&&(h&&(this._perRangeDataList[_-1].timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[_-1].frameNumber=r.getFrameStamp().getFrameNumber()),this.children[_-1].accept(r)),_<this._perRangeDataList.length){var b=(this._range[_][0]-c)/(this._range[_][1]-this._range[_][0]);this._rangeMode===n.PIXEL_SIZE_ON_SCREEN&&(b=-b);var x=r.nodePath[r.nodePath.length-1];if(this._perRangeDataList[_].loaded===!1){this._perRangeDataList[_].loaded=!0;var A=r.getDatabaseRequestHandler();this._perRangeDataList[_].dbrequest=A.requestNodeFile(this._perRangeDataList[_]["function"],this._databasePath+this._perRangeDataList[_].filename,x,r.getFrameStamp().getSimulationTime(),b)}else void 0!==this._perRangeDataList[_].dbrequest?(this._perRangeDataList[_].dbrequest._timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[_].dbrequest._priority=b):this._perRangeDataList[_].loaded=!1}}}}}()}),"osg","PagedLOD"),r.setTypeID(u),t.exports=u},function(t,e,i){"use strict";var r=i(1105),n=i(1143),a=i(1171),s=i(1121),o=i(1174),u=i(1172),h=function(){s.call(this,s.TRAVERSE_ALL_CHILDREN)};h.prototype=r.objectInherit(s.prototype,{apply:function(t){if(t.getTypeID()===u.getTypeID()){var e=t.getUpdateCallback();if(e instanceof o){for(var i=e._stackedTransforms,r=0,n=i.length;n>r;r++){var a=i[r];a.resetToDefaultValue()}e.computeChannels()}}this.traverse(t)}});var l=new h,c=function(){n.call(this)};c.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{setDefaultUpdateCallback:function(){this.addUpdateCallback(new a)},setRestPose:function(){this.accept(l)}}),"osgAnimation","Skeleton"),r.setTypeID(c),t.exports=c},function(t,e,i){"use strict";var r=i(1105),n=i(1172),a=i(1121),s=i(1109),o=i(1112),u=function(){a.call(this)};u.prototype=r.objectInherit(a.prototype,{apply:function(t){if(t.getTypeID()===n.getTypeID()){for(var e=!1,i=t.getChildren(),r=0,a=t.getChildren().length;a>r;r++){var o=i[r];if(o.getTypeID()===n.getTypeID()){if(e)return void s.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")}else e=!0}this.traverse(t)}}});var h=function(t,e){var i=t instanceof n?0:1,r=e instanceof n?0:1;return i-r},l=function(){this._needValidate=!0};l.prototype=r.objectInherit(o.prototype,{needToValidate:function(){return this._needValidate},update:function(t,e){if(this._needValidate&&e.getVisitorType()===a.UPDATE_VISITOR&&t.className&&"Skeleton"===t.className()){for(var i=new u,r=t.getChildren(),n=0,s=r.length;s>n;n++){var o=r[n];o.accept(i)}r.sort(h),this._needValidate=!1}return!0}}),t.exports=l},function(t,e,i){"use strict";var r=i(1105),n=i(1114),a=i(1113),s=i(1122),o=i(1143),u=i(1173),h=function(t){void 0!==t&&this.setName(t),o.call(this),this._invBindInSkeletonSpace=s.create(),this._boneInSkeletonSpace=s.create(),this._boneBoundingBox=new a};h.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{getOrCreateDebugColor:function(){return this._boneColor?this._boneColor:(this._boneColor=n.createAndSet(Math.random(),Math.random(),Math.random()),this._boneColor)},getBoneBoundingBox:function(){return this._boneBoundingBox},setBoneBoundingBox:function(t){this._boneBoundingBox=t},getMatrixInSkeletonSpace:function(){return this._boneInSkeletonSpace},getInvBindMatrixInSkeletonSpace:function(){return this._invBindInSkeletonSpace},setMatrixInSkeletonSpace:function(t){s.copy(t,this._boneInSkeletonSpace)},setInvBindMatrixInSkeletonSpace:function(t){s.copy(t,this._invBindInSkeletonSpace)},getBoneParent:function(){for(var t=this.getParents(),e=0,i=t.length;i>e;e++){var r=t[e].getTypeID();if(r===h.getTypeID())return t[e]}},setDefaultUpdateCallback:function(t){this.addUpdateCallback(new u(void 0!==t?t:this.getName()))}}),"osgAnimation","Bone"),r.setTypeID(h),t.exports=h},function(t,e,i){"use strict";var r=i(1105),n=i(1109),a=i(1174),s=i(1122),o=i(1121),u=function(){a.call(this)};u.prototype=r.objectInherit(a.prototype,{update:function(t,e){if(e.getVisitorType()===o.UPDATE_VISITOR){if(t.className&&"Bone"!==t.className())return n.warn("Warning: UpdateBone set on non-Bone object."),!1;var i=t;a.prototype.update.call(this,t),i.setMatrix(i.getMatrix());var r=i.getMatrix(),u=i.getBoneParent();u?s.mult(u.getMatrixInSkeletonSpace(),r,i.getMatrixInSkeletonSpace()):i.setMatrixInSkeletonSpace(r)}return!0}}),t.exports=u},function(t,e,i){"use strict";var r=i(1105),n=i(1122),a=i(1175),s=function(){a.call(this),this._stackedTransforms=[],this._matrix=n.create(),this._dirty=!1};s.prototype=r.objectInherit(a.prototype,{getStackedTransforms:function(){return this._stackedTransforms},computeChannels:function(){this._dirty=!0;var t=this._matrix;n.makeIdentity(t);for(var e=this._stackedTransforms,i=0,r=e.length;r>i;i++){var a=e[i];a.applyToMatrix(t)}},update:function(t){return n.copy(this._matrix,t.getMatrix()),this._dirty&&(t.dirtyBound(),this._dirty=!1),!0}}),t.exports=s},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1112),s=i(1143),o=function(){a.call(this)};o.checkPathIsAnimated=function(t){for(var e=0,i=t.length;i>e;++e){var r=t[e];if(r instanceof s)for(var n=r.getUpdateCallbackList(),a=0,u=n.length;u>a;++a)if(n[a]instanceof o)return!0}return!1},o.prototype=n.objectInherit(a.prototype,{linkChannel:function(){},linkAnimation:function(t){var e=this.getName();if(0===e.length)return r.log("no name on an update callback, discard"),0;for(var i=0,n=t.getChannels(),a=0,s=n.length;s>a;a++){var o=n[a];o.getTargetName()===e&&(this.linkChannel(o),i++)}return i}}),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1114),a=i(1130),s=i(1109),o=i(1122),u=i(1118),h=i(1177),l=i(1179),c=i(1181),d=i(1175),p=i(1127),f=function(){a.call(this),this._shape=null,this.addUpdateCallback(new l),this._root=void 0,this._pathToRoot=void 0,this._isAnimatedPath=!1,this._boneNameID={},this._matrixFromSkeletonToGeometry=o.create(),this._invMatrixFromSkeletonToGeometry=o.create(),this._rigTransformImplementation=new c,this._stateSetAnimation=new u,this._needToComputeMatrix=!0};f.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{getStateSetAnimation:function(){return this._stateSetAnimation},getSkeleton:function(){return this._root},setSkeleton:function(t){this._root=t},setPathToSkeleton:function(t){this._pathToRoot=t,this._isAnimatedPath=d.checkPathIsAnimated(t)},setNeedToComputeMatrix:function(t){this._needToComputeMatrix=t},getNeedToComputeMatrix:function(){return this._needToComputeMatrix},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex,i=this.getVertexAttributeList().Weights;if(e&&i&&e.getElements()&&e.getItemSize()>2){for(var r=i.getElements(),n=e.getElements(),a=e.getItemSize(),s=t.getMin(),o=t.getMax(),u=s[0],h=s[1],l=s[2],c=o[0],d=o[1],p=o[2],f=0,g=0,m=n.length;m>f;f+=a,g+=4)if(0===r[f]&&0===r[f+1]&&0===r[f+2]&&0===r[f+3]){var v=n[f],_=n[f+1],b=n[f+2];u>v&&(u=v),v>c&&(c=v),h>_&&(h=_),_>d&&(d=_),l>b&&(l=b),b>p&&(p=b)}s[0]=u,s[1]=h,s[2]=l,o[0]=c,o[1]=d,o[2]=p}return t},computeMatrixFromRootSkeleton:function(){return this._root?(o.makeIdentity(this._matrixFromSkeletonToGeometry),p.computeLocalToWorld(this._pathToRoot,!0,this._matrixFromSkeletonToGeometry),o.inverse(this._matrixFromSkeletonToGeometry,this._invMatrixFromSkeletonToGeometry),void(this._isAnimatedPath||(this._needToComputeMatrix=!1))):void s.warn("Warning "+this.className()+".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry ("+this.getName()+") is not attached to a Skeleton subgraph")},getMatrixFromSkeletonToGeometry:function(){return this._matrixFromSkeletonToGeometry},getInvMatrixFromSkeletonToGeometry:function(){return this._invMatrixFromSkeletonToGeometry},getSourceGeometry:function(){return this._geometry},setSourceGeometry:function(t){this._geometry=t},mergeChildrenVertexAttributeList:function(){this._geometry instanceof h&&this._geometry.mergeChildrenVertexAttributeList();var t=this._geometry.getVertexAttributeList();a.appendVertexAttributeToList(t,this.getVertexAttributeList())},mergeChildrenData:function(){this.mergeChildrenVertexAttributeList();var t=this._geometry.getPrimitiveSetList();this.getPrimitiveSetList().length=0;for(var e=0,i=t.length;i>e;e++)this.getPrimitiveSetList()[e]=t[e];this.getStateSet()&&console.error("A stateset in the rig is already present : "+this.getStateSet()),this.setStateSet(this._geometry.getStateSet())},update:function(){this._rigTransformImplementation.update(this)},computeTransformedVertex:function(t,e){e=e||n.create();var i=this.getVertexAttributeList(),r=i.Weights.getElements(),a=i.Bones.getElements(),s=0,o=0,u=0;if(this._geometry.computeTransformedVertex)this._geometry.computeTransformedVertex(t,e),s=e[0],o=e[1],u=e[2];else{var h=i.Vertex.getElements();s=h[3*t],o=h[3*t+1],u=h[3*t+2]}for(var l=4*t,c=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),d=0,p=0,f=0,g=0,m=0,v=0,_=0,b=0,x=0,A=0,y=0,S=0,C=0,w=!1,T=0;4>T;++T){var M=r[l+T];if(0!==M){var E=12*a[l+T];d+=c[E+0]*M,g+=c[E+1]*M,_+=c[E+2]*M,A+=c[E+3]*M,p+=c[E+4]*M,m+=c[E+5]*M,b+=c[E+6]*M,y+=c[E+7]*M,f+=c[E+8]*M,v+=c[E+9]*M,x+=c[E+10]*M,S+=c[E+11]*M,C+=M,w=!0}}w||(e[0]=s,e[1]=o,e[2]=u);var k=1/C;return e[0]=(d*s+g*o+_*u+A)*k,e[1]=(p*s+m*o+b*u+y)*k,e[2]=(f*s+v*o+x*u+S)*k,e},computeTransformedVertices:function(){for(var t=this.getVertexAttributeList(),e=this._geometry.computeTransformedVertices?this._geometry.computeTransformedVertices():t.Vertex.getElements(),i=t.Weights.getElements(),r=t.Bones.getElements(),n=this._riggedVerts||new Float32Array(e.length),a=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),s=0,o=0,u=e.length;u>s;s+=3,o+=4){var h,l=0,c=0,d=0,p=0,f=0,g=0,m=0,v=0,_=0,b=0,x=0,A=0,y=0,S=!1,C=i[o];0!==C&&(h=12*r[o],l+=a[h+0]*C,p+=a[h+1]*C,m+=a[h+2]*C,b+=a[h+3]*C,c+=a[h+4]*C,f+=a[h+5]*C,v+=a[h+6]*C,x+=a[h+7]*C,d+=a[h+8]*C,g+=a[h+9]*C,_+=a[h+10]*C,A+=a[h+11]*C,y+=C,S=!0),C=i[o+1],0!==C&&(h=12*r[o+1],l+=a[h+0]*C,p+=a[h+1]*C,m+=a[h+2]*C,b+=a[h+3]*C,c+=a[h+4]*C,f+=a[h+5]*C,v+=a[h+6]*C,x+=a[h+7]*C,d+=a[h+8]*C,g+=a[h+9]*C,_+=a[h+10]*C,A+=a[h+11]*C,y+=C,S=!0),C=i[o+2],0!==C&&(h=12*r[o+2],l+=a[h+0]*C,p+=a[h+1]*C,m+=a[h+2]*C,b+=a[h+3]*C,c+=a[h+4]*C,f+=a[h+5]*C,v+=a[h+6]*C,x+=a[h+7]*C,d+=a[h+8]*C,g+=a[h+9]*C,_+=a[h+10]*C,A+=a[h+11]*C,y+=C,S=!0),C=i[o+3],0!==C&&(h=12*r[o+3],l+=a[h+0]*C,p+=a[h+1]*C,m+=a[h+2]*C,b+=a[h+3]*C,c+=a[h+4]*C,f+=a[h+5]*C,v+=a[h+6]*C,x+=a[h+7]*C,d+=a[h+8]*C,g+=a[h+9]*C,_+=a[h+10]*C,A+=a[h+11]*C,y+=C,S=!0);var w=e[s],T=e[s+1],M=e[s+2];if(S){var E=1/y;n[s]=(l*w+p*T+m*M+b)*E,n[s+1]=(c*w+f*T+v*M+x)*E,n[s+2]=(d*w+g*T+_*M+A)*E}else n[s]=w,n[s+1]=T,n[s+2]=M}return n}}),"osgAnimation","RigGeometry"),r.setTypeID(f),t.exports=f},function(t,e,i){"use strict";var r=i(1105),n=i(1151),a=i(1109),s=i(1114),o=i(1130),u=i(1118),h=i(1178),l=i(1120),c=i(1113),d=function(){o.call(this),this._shape=null,this._targets=[],this._stateSetAnimation=new u,this._targetWeights=new Float32Array(4),this._morphTargetNames=void 0,this._updateMorph=void 0,this._isInitialized=!1},p=d.EFFECTIVE_EPS=.05;d.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{init:function(){var t=new h(Math.min(4,this.getMorphTargets().length));return this.getStateSetAnimation().setAttributeAndModes(t,l.ON),t.setTargetWeights(this.getTargetsWeight()),this._targets[0]?(this._morphTargetNames=window.Object.keys(this._targets[0].getVertexAttributeList()),t.copyTargetNames(this._morphTargetNames)):(this._morphTargetNames=[],a.error("No Targets in the MorphGeometry !")),this._isInitialized=!0,!0},getMorphTargetNames:function(){return this._morphTargetNames},getStateSetAnimation:function(){return this._stateSetAnimation},getMorphTargets:function(){return this._targets},isInitialized:function(){return this._isInitialized},getTargetsWeight:function(){return this._targetWeights},computeBoundingBox:function(){var t=new c;return function(e){o.prototype.computeBoundingBox.call(this,e);for(var i=0,r=this._targets.length;r>i;i++)e.expandByBoundingBox(this._targets[i].computeBoundingBox(t));return e}}(),mergeChildrenVertexAttributeList:function(){for(var t=0,e=this._targets.length;e>t;t++){for(var i=this._targets[t],r=i.getVertexAttributeList(),a=window.Object.keys(r),s=0,u=a.length;u>s;s++){var h=a[s],l=r[h];l&&!l.getBufferArray&&(r[h]=new n(l))}o.appendVertexAttributeToList(i.getVertexAttributeList(),this.getVertexAttributeList(),t)}},_computeEffectiveSumWeights:function(){for(var t=0,e=this._targetWeights,i=0,r=e.length;r>i;++i){var n=e[i];Math.abs(n)<p||(t+=n)}var a=1e-5;return Math.abs(t)>a?t:0>t?-a:a},computeTransformedVertex:function(t,e){e=e||s.create();var i=3*t,r=this._targetWeights,n=this.getVertexAttributeList(),a=n.Vertex.getElements(),o=1-this._computeEffectiveSumWeights();e[0]=o*a[i],e[1]=o*a[i+1],e[2]=o*a[i+2];for(var u=0,h=r.length;h>u;++u){var l=r[u];if(!(Math.abs(l)<p)){var c=n["Vertex_"+u].getElements();e[0]+=l*c[i],e[1]+=l*c[i+1],e[2]+=l*c[i+2]}}return e},computeTransformedVertices:function(){for(var t=this._targetWeights,e=this.getVertexAttributeList(),i=e.Vertex.getElements(),r=i.length,n=this._morphedVerts=this._morphedVerts||new Float32Array(r),a=1-this._computeEffectiveSumWeights(),s=0;r>s;++s)n[s]=a*i[s];for(var o=0,u=t.length;u>o;++o){var h=t[o];if(!(Math.abs(h)<p))for(var l=e["Vertex_"+o].getElements(),c=0;r>c;++c)n[c]+=h*l[c]}return n}}),"osgAnimation","MorphGeometry"),r.setTypeID(d),t.exports=d},function(t,e,i){"use strict";var r=i(1105),n=i(1119),a=i(1120),s=i(1134),o=function(t,e){a.call(this),this._nbTarget=t,this._enable=!e,this._targetNames={},this._hashNames=""};o.uniforms={},o.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{attributeType:"Morph",cloneType:function(){return new o(void 0,!0)},hasTarget:function(t){return!!this._targetNames[t]},copyTargetNames:function(t){for(var e=this._targetNames,i="",r=e.length=t.length,n=0;r>n;++n){var a=t[n];e[a]=!0,i+=a}this._hashNames=i},getOrCreateUniforms:function(){var t=o,e=this.getNumTargets();if(t.uniforms[e])return t.uniforms[e];var i={};return i.uTargetWeights=s.createFloat4("uTargetWeights"),t.uniforms[e]=new n(i),t.uniforms[e]},getNumTargets:function(){return this._nbTarget},setTargetWeights:function(t){this._targetWeights=t},getTargetWeights:function(){return this._targetWeights},isEnabled:function(){return this._enable},getHash:function(){return this.getTypeMember()+this._hashNames+this.getNumTargets()+this.isEnabled()},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.uTargetWeights.setFloat4(this._targetWeights)}}}),"osgAnimation","MorphAttribute"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1109),a=i(1112),s=i(1180),o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{init:function(t){var e=new s;return t.getParents().length>1&&n.warn("A RigGeometry should not have multi parent ( "+t.getName()+" )"),t.getParents()[0].accept(e),e._root?(t.setSkeleton(e._root),void t.setPathToSkeleton(e._pathToRoot)):void n.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( "+t.getName()+" )")},update:function(t){if(t&&"RigGeometry"!==t.className())return!0;var e=t;return e.getSkeleton()||0===e.getParents().length||this.init(e),e.getSkeleton()?(e.getNeedToComputeMatrix()&&e.computeMatrixFromRootSkeleton(),e.update(),!0):!0}}),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=i(1170),s=function(){n.call(this,n.TRAVERSE_PARENTS),this._root=void 0,this._pathToRoot=void 0};s.prototype=r.objectInherit(n.prototype,{apply:function(t){return this._root?void 0:t.typeID===a.typeID?(this._root=t,void(this._pathToRoot=this.nodePath.slice(1))):void this.traverse(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1122),n=i(1120),a=i(1182),s=i(1183),o=function(){this._isInitialized=!1,this._bones=[]};o.prototype={computeBonePalette:function(t,e){for(var i=window.Object.keys(t),r=i.length,n=this._bones,a=0;r>a;a++){var s=i[a],o=e[s],u=t[s];void 0!==o&&(n[o]=u)}return n},init:function(t){var e=new s;t.getSkeleton().accept(e);var i=e.getBoneMap();this.computeBonePalette(i,t._boneNameID);var r=3*this._bones.length,o=this._skinningAttribute=new a;return o.setMatrixPalette(new Float32Array(4*r)),t.getStateSetAnimation().setAttributeAndModes(o,n.ON),this._isInitialized=!0,!0},computeMatrixPalette:function(){var t=r.create();return function(e,i){for(var n=this._bones,a=this._skinningAttribute.getMatrixPalette(),s=0,o=0,u=n.length;u>o;o++){var h=n[o],l=h.getInvBindMatrixInSkeletonSpace(),c=h.getMatrixInSkeletonSpace();r.mult(c,l,t),r.postMult(i,t),r.preMult(t,e),a[s++]=t[0],a[s++]=t[4],a[s++]=t[8],a[s++]=t[12],a[s++]=t[1],a[s++]=t[5],a[s++]=t[9],a[s++]=t[13],a[s++]=t[2],a[s++]=t[6],a[s++]=t[10],a[s++]=t[14]}}}(),update:function(t){this._isInitialized||this.init(t),this.computeMatrixPalette(t.getMatrixFromSkeletonToGeometry(),t.getInvMatrixFromSkeletonToGeometry())}},t.exports=o},function(t,e,i){"use strict";var r=i(1119),n=i(1105),a=i(1120),s=i(1134),o=function(t,e){a.call(this),this._enable=!t,this._boneUniformSize=e};o.uniforms={},o.maxBoneUniformSize=1,o.maxBoneUniformAllowed=1/0,o.prototype=n.objectLibraryClass(n.objectInherit(a.prototype,{attributeType:"Skinning",cloneType:function(){return new o(!0)},setBoneUniformSize:function(t){this._boneUniformSize=t},getBoneUniformSize:function(){return void 0!==this._boneUniformSize?this._boneUniformSize:o.maxBoneUniformSize},getOrCreateUniforms:function(){var t=o,e=this.getBoneUniformSize();if(t.uniforms[e])return t.uniforms[e];var i={};return i.uBones=s.createFloat4Array("uBones"),t.uniforms[e]=new r(i),t.uniforms[e]},setMatrixPalette:function(t){this._matrixPalette=t,void 0===this._boneUniformSize&&(o.maxBoneUniformSize=Math.max(o.maxBoneUniformSize,t.length/4),o.maxBoneUniformSize=Math.min(o.maxBoneUniformAllowed,o.maxBoneUniformSize))},getMatrixPalette:function(){return this._matrixPalette},isEnabled:function(){return this._enable},getHash:function(){return this.getTypeMember()+this.getBoneUniformSize()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uBones.setInternalArray(this._matrixPalette)}}),"osgAnimation","SkinningAttribute"),n.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=i(1109),s=i(1172),o=function(){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._boneMap={}};o.prototype=r.objectInherit(n.prototype,{apply:function(t){if(t.typeID===s.typeID){var e=t.getName();e?this._boneMap[e]=t:a.warn("found Bone without name")}this.traverse(t)},getBoneMap:function(){return this._boneMap}}),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=function(t,e,i,r){n.call(this),this._func=a.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==t&&("string"==typeof t?this._func=a[t]:this._func=t),void 0!==e&&(this._near=e),void 0!==i&&(this._far=i),void 0!==r&&(this._writeMask=r)};a.DISABLE=0,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Depth",cloneType:function(){return new a},setRange:function(t,e){this._near=t,this._far=e},setWriteMask:function(t){this._writeMask=t},getWriteMask:function(){return this._writeMask},getFunc:function(){return this._func},apply:function(t){var e=t.getGraphicContext();0===this._func?e.disable(e.DEPTH_TEST):(e.enable(e.DEPTH_TEST),e.depthFunc(this._func),e.depthMask(this._writeMask),e.depthRange(this._near,this._far))}}),"osg","Depth"),t.exports=a},function(t,e,i){"use strict";var r=i(1109),n=i(1122),a=i(1114),s=function(){this._radiusEquator=s.WGS_84_RADIUS_EQUATOR,this._radiusPolar=s.WGS_84_RADIUS_POLAR,this.computeCoefficients()};s.WGS_84_RADIUS_EQUATOR=6378137,s.WGS_84_RADIUS_POLAR=6356752.3142,s.prototype={setRadiusEquator:function(t){this._radiusEquator=t,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(t){this._radiusPolar=t,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(t,e,i,n){void 0===n&&(r.warn("deprecated, use this signature convertLatLongHeightToXYZ( latitude, longitude, height, result )"),n=a.create());var s=Math.sin(t),o=Math.cos(t),u=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*s*s),h=(u+i)*o*Math.cos(e),l=(u+i)*o*Math.sin(e),c=(u*(1-this._eccentricitySquared)+i)*s;return n[0]=h,n[1]=l,n[2]=c,n},convertXYZToLatLongHeight:function(t,e,i,n){void 0===n&&(r.warn("deprecated, use this signature convertXYZToLatLongHeight( X,  Y,  Z , result)"),n=a.create());var s=Math.sqrt(t*t+e*e),o=Math.atan2(i*this._radiusEquator,s*this._radiusPolar),u=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),h=Math.sin(o),l=Math.cos(o),c=Math.atan((i+u*this._radiusPolar*h*h*h)/(s-this._eccentricitySquared*this._radiusEquator*l*l*l)),d=Math.atan2(e,t),p=Math.sin(c),f=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*p*p),g=Math.cos(c);0===g&&(g=1);var m=s/g-f;return n[0]=c,n[1]=d,n[2]=m,n},computeLocalUpVector:function(t,e,i){var r,n,a,s=this.convertXYZToLatLongHeight(t,e,i,r,n,a);return r=s[0],n=s[1],a=s[2],[Math.cos(n)*Math.cos(r),Math.sin(n)*Math.cos(r),Math.sin(r)]},isWGS84:function(){return this._radiusEquator===s.WGS_84_RADIUS_EQUATOR&&this._radiusPolar===s.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var t=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*t-t*t},computeLocalToWorldTransformFromLatLongHeight:function(t,e,i,a){void 0===a&&(r.warn("deprecated, use this signature computeLocalToWorldTransformFromLatLongHeight(latitude, longitude, height, result)"),a=n.create());var s=this.convertLatLongHeightToXYZ(t,e,i,a);return n.makeTranslate(s[0],s[1],s[2],a),this.computeCoordinateFrame(t,e,a),a},computeLocalToWorldTransformFromXYZ:function(t,e,i){var r=this.convertXYZToLatLongHeight(t,e,i),a=n.makeTranslate(t,e,i,n.create());return this.computeCoordinateFrame(r[0],r[1],a),a},computeCoordinateFrame:function(){var t=a.create(),e=a.create(),i=a.create();return function(r,s,o){t[0]=Math.cos(s)*Math.cos(r),t[1]=Math.sin(s)*Math.cos(r),t[2]=Math.sin(r),e[0]=-Math.sin(s),e[1]=-Math.cos(s),a.cross(t,e,i),n.set(o,0,0,e[0]),n.set(o,0,1,e[1]),n.set(o,0,2,e[2]),n.set(o,1,0,i[0]),n.set(o,1,1,i[1]),n.set(o,1,2,i[2]),n.set(o,2,0,t[0]),n.set(o,2,1,t[1]),n.set(o,2,2,t[2])}}()},t.exports=s},function(t,e){"use strict";var i=function(){this._frame=0,this._startSimulation=0,this._currentSimulation=0,this._deltaTime=0};i.prototype={setReferenceTime:function(t){this._startSimulation=t},getReferenceTime:function(){return this._startSimulation},setSimulationTime:function(t){this._currentSimulation=t},getSimulationTime:function(){return this._currentSimulation},setDeltaTime:function(t){this._deltaTime=t},getDeltaTime:function(){return this._deltaTime},setFrameNumber:function(t){this._frame=t},getFrameNumber:function(){return this._frame}},t.exports=i},function(t,e,i){"use strict";var r=i(236),n=i(1105),a=i(1135),s=function(t){a.call(this,t),this._canPlayDefered=void 0};s.PAUSE=0,s.PLAYING=1,s.prototype=n.objectLibraryClass(n.objectInherit(a.prototype,{isDirty:function(){return this._status===s.PLAYING},setImage:function(t){a.prototype.setImage.call(this,t),this._status=s.STOP,t.addEventListener("ended",function(){this._imageObject.loop||this.stop()}.bind(this),!0),this.dirty()},setLooping:function(t){this._imageObject.loop=t},play:function(){this._imageObject.play(),this._status=s.PLAYING},stop:function(){this._imageObject.pause(),this._status=s.PAUSE},whenReady:function(){return this._imageObject?(this._canPlayDefered||(this._canPlayDefered=r.defer(),this._imageObject.addEventListener("canplaythrough",this._canPlayDefered.resolve.bind(this._canPlayDefered,this),!0)),this._canPlayDefered.promise):r.reject()}}),"osg","ImageStream"),n.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(1105),n=i(1114),a=i(1113),s=i(1189),o=i(1140),u=i(1190),h=i(1192),l=function(t,e){this._bb=new a,this._first=t,this._second=e,this._nodeRayStart=n.create(),this._nodeRayEnd=n.create()},c=function(t){this._kdTree=t,this._bb=new a,this._primitiveIndices=null,this._centers=null,this._axisOrder=n.create(),this._stackLength=0};c.prototype={build:function(t,e){var i=t._targetNumTrianglesPerLeaf,n=e.getVertexAttributeList().Vertex;if(!n)return!1;var s=n.getElements();if(!s)return!1;var o=s.length/3;if(i>o)return!1;this._bb.copy(e.getBoundingBox()),this._kdTree.setVertices(s),this.computeDivisions(t),t._numVerticesProcessed+=o,this.computeTriangles(e);var u=new l(-1,this._primitiveIndices.length);u._bb.copy(this._bb);var h=this._kdTree.addNode(u),c=new a;c.copy(this._bb),h=this.divide(t,c,h,0);for(var d=this._kdTree.getTriangles(),p=this._primitiveIndices,f=p.length,g=new r.Uint32Array(d.length),m=0,v=0;f>m;++m,v+=3){var _=3*p[m];g[v]=d[_],g[v+1]=d[_+1],g[v+2]=d[_+2]}return this._kdTree.setTriangles(g),this._kdTree.getNodes().length>0},computeTriangles:function(t){var e=this._kdTree,i=0,n=t.primitives,a=n.length,u=0;for(u=0;a>u;u++){var h=n[u],l=h.getMode();l===o.TRIANGLES?i+=h.getCount():(l===o.TRIANGLE_STRIP||l===o.TRIANGLE_FAN)&&(i+=3*(h.getCount()-2));
}var c=new r.Uint32Array(i),d=0,p=function(t,e,i){t!==e&&t!==i&&e!==i&&(c[d]=t,c[d+1]=e,c[d+2]=i,d+=3)},f=new s;f.init(t,p),f.apply(),c=c.subarray(0,d);var g=c.length;e.setTriangles(c);var m=e.getVertices();this._centers=new r.Float32Array(g);var v=this._centers;this._primitiveIndices=new r.Uint32Array(g/3);var _=this._primitiveIndices,b=0;for(u=0,b=0;g>u;u+=3,++b){var x=c[u],A=c[u+1],y=c[u+2];if(x===A||A===y||x===y)return;x*=3,A*=3,y*=3;var S=m[x],C=m[x+1],w=m[x+2],T=m[A],M=m[A+1],E=m[A+2],k=m[y],I=m[y+1],N=m[y+2],R=Math.min(S,Math.min(T,k)),F=Math.min(C,Math.min(M,I)),P=Math.min(w,Math.min(E,N)),D=Math.max(S,Math.max(T,k)),L=Math.max(C,Math.max(M,I)),O=Math.max(w,Math.max(E,N));v[u]=.5*(R+D),v[u+1]=.5*(F+L),v[u+2]=.5*(P+O),_[b]=b}},computeDivisions:function(t){this._stackLength=t._maxNumLevels;var e=this._bb._max,i=this._bb._min,r=e[0]-i[0],n=e[1]-i[1],a=e[2]-i[2],s=this._axisOrder;s[0]=r>=n&&r>=a?0:n>=a?1:2,s[2]=n>r&&a>r?0:a>n?1:2;var o=s[0]+s[2];s[1]=3===o?0:2===o?1:2},divide:function(t,e,i,r){var n=this._kdTree,a=this._primitiveIndices,s=n.getNodes(),o=s[i],u=o._first,h=o._second,c=r<this._stackLength&&0>u&&h>t._targetNumTrianglesPerLeaf,d=-u-1,p=d+h-1;if(!c)return 0>u&&this.computeNodeBox(o,d,p),i;if(u>=0)return i;for(var f=this._axisOrder[r%3],g=e._min[f],m=e._max[f],v=.5*(g+m),_=0,b=0,x=!1,A=d,y=p,S=this._centers;y>A;){for(;y>A&&S[3*a[A]+f]<=v;)++A;for(;y>A&&S[3*a[y]+f]>v;)--y;if(y>A){var C=a[A];a[A]=a[y],a[y]=C,++A,--y}}A===y&&(S[3*a[A]+f]<=v?++A:--y),-1>=y-d?(_=0,b=i,x=!0):-1>=p-A?(_=i,b=0,x=!0):(_=n.addNode(new l(-d-1,y-d+1)),b=n.addNode(new l(-A-1,p-A+1)));var w=e._max[f];e._max[f]=v;var T=0!==_?this.divide(t,e,_,r+1):0;e._max[f]=w,w=e._min[f],e._min[f]=v;var M=0!==b?this.divide(t,e,b,r+1):0;if(e._min[f]=w,!x){o._first=T,o._second=M,x=!0;var E=o._bb;E.init(),0!==T&&E.expandByBoundingBox(s[T]._bb),0!==M&&E.expandByBoundingBox(s[M]._bb)}return i},computeNodeBox:function(t,e,i){for(var r=1/0,n=1/0,a=1/0,s=-(1/0),o=-(1/0),u=-(1/0),h=this._kdTree.getTriangles(),l=this._kdTree.getVertices(),c=this._primitiveIndices,d=e;i>=d;++d){var p=3*c[d],f=3*h[p],g=3*h[p+1],m=3*h[p+2],v=l[f],_=l[f+1],b=l[f+2],x=l[g],A=l[g+1],y=l[g+2],S=l[m],C=l[m+1],w=l[m+2];r=Math.min(r,Math.min(v,Math.min(x,S))),n=Math.min(n,Math.min(_,Math.min(A,C))),a=Math.min(a,Math.min(b,Math.min(y,w))),s=Math.max(s,Math.max(v,Math.max(x,S))),o=Math.max(o,Math.max(_,Math.max(A,C))),u=Math.max(u,Math.max(b,Math.max(y,w)))}var T=1e-6,M=t._bb,E=M._min,k=M._max;E[0]=r-T,E[1]=n-T,E[2]=a-T,k[0]=s+T,k[1]=o+T,k[2]=u+T}};var d=function(){this._vertices=null,this._kdNodes=[],this._triangles=null};d.prototype=r.objectLibraryClass({getVertices:function(){return this._vertices},setVertices:function(t){this._vertices=t},getNodes:function(){return this._kdNodes},getTriangles:function(){return this._triangles},setTriangles:function(t){this._triangles=t},addNode:function(t){return this._kdNodes.push(t),this._kdNodes.length-1},build:function(t,e){var i=new c(this);return i.build(t,e)},intersectRay:function(t,e,i,r){if(0===this._kdNodes.length)return!1;var n=i.length;return this._rayIntersector||(this._rayIntersector=new u,this._rayIntersector.setKdtree(this._vertices,this._kdNodes,this._triangles)),this._rayIntersector.init(i,t,e,r),this._rayIntersector.intersect(this.getNodes()[0],t,e),n!==i.length},intersectSphere:function(t,e,i,r){if(0===this._kdNodes.length)return!1;var n=i.length;return this._sphereIntersector||(this._sphereIntersector=new h,this._sphereIntersector.setKdtree(this._vertices,this._kdNodes,this._triangles)),this._sphereIntersector.init(i,t,e,r),this._sphereIntersector.intersect(this.getNodes()[0]),n!==i.length}},"osg","KdTree"),t.exports=d},function(t,e,i){"use strict";var r=i(1140),n=i(1109),a=function(){arguments&&arguments.length&&n.warn("using ctor as initialiser is deprecated, use init(geom, cb)")};a.prototype={init:function(t,e){this._geom=t,this._cb=e},applyDrawElementsTriangles:function(t,e){for(var i=this._cb,r=0;t>r;r+=3)i(e[r],e[r+1],e[r+2])},applyDrawElementsTriangleStrip:function(t,e){for(var i=this._cb,r=2,n=0;t>r;++r,++n)r%2?i(e[n],e[n+2],e[n+1]):i(e[n],e[n+1],e[n+2])},applyDrawElementsTriangleFan:function(t,e){for(var i=this._cb,r=e[0],n=2,a=1;t>n;++n,++a)i(r,e[a],e[a+1])},applyDrawArraysTriangles:function(t,e){for(var i=this._cb,r=2,n=t;e>r;r+=3,n+=3)i(n,n+1,n+2)},applyDrawArraysTriangleStrip:function(t,e){for(var i=this._cb,r=2,n=t;e>r;++r,++n)r%2?i(n,n+2,n+1):i(n,n+1,n+2)},applyDrawArraysTriangleFan:function(t,e){for(var i=this._cb,r=2,n=t+1;e>r;++r,++n)i(t,n,n+1)},apply:function(){var t=this._geom,e=t.primitives;if(e)for(var i=e.length,n=0;i>n;n++){var a=e[n];if(void 0!==a.getIndices){var s=a.indices.getElements();switch(a.getMode()){case r.TRIANGLES:this.applyDrawElementsTriangles(a.getCount(),s);break;case r.TRIANGLE_STRIP:this.applyDrawElementsTriangleStrip(a.getCount(),s);break;case r.TRIANGLE_FAN:this.applyDrawElementsTriangleFan(a.getCount(),s)}}else switch(a.getMode()){case r.TRIANGLES:this.applyDrawArraysTriangles(a.getFirst(),a.getCount());break;case r.TRIANGLE_STRIP:this.applyDrawArraysTriangleStrip(a.getFirst(),a.getCount());break;case r.TRIANGLE_FAN:this.applyDrawArraysTriangleFan(a.getFirst(),a.getCount())}}}},t.exports=a},function(t,e,i){"use strict";var r=i(1114),n=i(1191),a=i(1109),s=function(){arguments&&arguments.length&&a.warn("using ctor as initialiser is deprecated, use init(intersections, start, end, nodePath) and/or     setKdtree: function ( vertices, nodes, triangles )"),this._intersector=new n,this._dInvX=r.create(),this._dInvY=r.create(),this._dInvZ=r.create()};s.prototype={setKdtree:function(t,e,i){this._vertices=t,this._kdNodes=e,this._triangles=i},init:function(){var t=r.create();return function(e,i,n,a){var s=r.sub(n,i,t),o=r.length(s),u=0;0!==o&&(u=1/o),r.mult(s,u,s),0!==s[0]&&r.mult(s,1/s[0],this._dInvX),0!==s[1]&&r.mult(s,1/s[1],this._dInvY),0!==s[2]&&r.mult(s,1/s[2],this._dInvZ),this._intersector._intersections=e,this._intersector.setNodePath(a),this._intersector.set(i,n)}}(),intersect:function(){var t=r.create(),e=r.create(),i=r.create();return function(n,a,s){var o=n._first,u=n._second,h=this._triangles,l=this._vertices;if(0>o){var c=-o-1,d=c+u,p=this._intersector;p.index=c;for(var f=c;d>f;++f){var g=3*f,m=h[g],v=h[g+1],_=h[g+2],b=3*m;t[0]=l[b],t[1]=l[b+1],t[2]=l[b+2],b=3*v,e[0]=l[b],e[1]=l[b+1],e[2]=l[b+2],b=3*_,i[0]=l[b],i[1]=l[b+1],i[2]=l[b+2],p.intersect(t,e,i,m,v,_)}}else{var x,A=n._nodeRayStart,y=n._nodeRayEnd,S=this._kdNodes;r.copy(a,A),r.copy(s,y),o>0&&(x=S[o],this.intersectAndClip(A,y,x._bb)&&this.intersect(x,A,y)),u>0&&(r.copy(a,A),r.copy(s,y),x=S[u],this.intersectAndClip(A,y,x._bb)&&this.intersect(x,A,y))}}}(),intersectAndClip:function(){var t=new Float64Array(3);return function(e,i,n){var a=n._min,s=a[0],o=a[1],u=a[2],h=n._max,l=h[0],c=h[1],d=h[2],p=this._dInvX,f=this._dInvY,g=this._dInvZ;if(e[0]<=i[0]){if(i[0]<s)return!1;if(e[0]>l)return!1;e[0]<s&&(r.mult(p,s-e[0],t),r.add(e,t,e)),i[0]>l&&(r.mult(p,l-e[0],t),r.add(e,t,i))}else{if(e[0]<s)return!1;if(i[0]>l)return!1;i[0]<s&&(r.mult(p,s-e[0],t),r.add(e,t,i)),e[0]>l&&(r.mult(p,l-e[0],t),r.add(e,t,e))}if(e[1]<=i[1]){if(i[1]<o)return!1;if(e[1]>c)return!1;e[1]<o&&(r.mult(f,o-e[1],t),r.add(e,t,e)),i[1]>c&&(r.mult(f,c-e[1],t),r.add(e,t,i))}else{if(e[1]<o)return!1;if(i[1]>c)return!1;i[1]<o&&(r.mult(f,o-e[1],t),r.add(e,t,i)),e[1]>c&&(r.mult(f,c-e[1],t),r.add(e,t,e))}if(e[2]<=i[2]){if(i[2]<u)return!1;if(e[2]>d)return!1;e[2]<u&&(r.mult(g,u-e[2],t),r.add(e,t,e)),i[2]>d&&(r.mult(g,d-e[2],t),r.add(e,t,i))}else{if(e[2]<u)return!1;if(i[2]>d)return!1;i[2]<u&&(r.mult(g,u-e[2],t),r.add(e,t,i)),e[2]>d&&(r.mult(g,d-e[2],t),r.add(e,t,e))}return!0}}()},t.exports=s},function(t,e,i){"use strict";var r=i(1114),n=i(1189),a=i(1109),s=function(t,e,i,r,n,a,s){this.normal=t,this.i1=e,this.i2=i,this.i3=r,this.r1=n,this.r2=a,this.r3=s},o=function(){arguments&&arguments.length&&a.warn("using ctor as initialiser is deprecated, use set(start, end)"),this._intersections=[],this._nodePath=[],this._dir=r.create()};o.prototype={reset:function(){this._intersections.length=0},setNodePath:function(t){this._nodePath=t},set:function(t,e){this._start=t,this._end=e,this._dir=r.sub(e,t,this._dir),this._length=r.length(this._dir),this._invLength=1/this._length,r.mult(this._dir,this._invLength,this._dir)},apply:function(){var t=r.create(),e=r.create(),i=r.create(),a=new n;return function(r){if(r.getAttributes().Vertex){var n=r.getAttributes().Vertex.getElements(),s=this,o=function(r,a,o){if(r!==a&&r!==o&&a!==o){var u=3*r;t[0]=n[u],t[1]=n[u+1],t[2]=n[u+2],u=3*a,e[0]=n[u],e[1]=n[u+1],e[2]=n[u+2],u=3*o,i[0]=n[u],i[1]=n[u+1],i[2]=n[u+2],s.intersect(t,e,i,r,a,o)}};a.init(r,o),a.apply()}}}(),intersect:function(){var t=r.create(),e=r.create(),i=r.create(),n=r.create(),a=r.create(),o=r.create(),u=1e-20;return function(h,l,c,d,p,f){var g=this._dir;r.sub(c,h,e),r.sub(l,h,i),r.cross(g,e,a);var m=r.dot(a,i);if(!(m>-u&&u>m)){var v=1/m;r.sub(this._start,h,n);var _=r.dot(a,n)*v;if(!(0>_||_>1)){r.cross(n,i,o);var b=r.dot(o,g)*v;if(!(0>b||_+b>1)){var x=r.dot(o,e)*v;if(!(u>x||x>this._length)){var A=1-_-b,y=_,S=b,C=x*this._invLength,w=h[0]*A+l[0]*y+c[0]*S,T=h[1]*A+l[1]*y+c[1]*S,M=h[2]*A+l[2]*y+c[2]*S;r.cross(i,e,t),r.normalize(t,t),this._intersections.push({ratio:C,backface:0>m,nodepath:this._nodePath.slice(0),TriangleIntersection:new s(r.copy(t,r.create()),d,p,f,A,y,S),point:r.createAndSet(w,T,M)}),this.hit=!0}}}}}}()},t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1114),a=i(1190),s=i(1193),o=function(){this._intersector=new s};o.prototype=r.objectInherit(a.prototype,{init:function(t,e,i,r){this._intersector._intersections=t,this._intersector.setNodePath(r),this._intersector.set(e,i),this._center=e,this._radius=i},intersect:function(){var t=n.create(),e=n.create(),i=n.create();return function(r){var n=r._first,a=r._second,s=this._triangles,o=this._vertices;if(0>n){var u=-n-1,h=u+a,l=this._intersector;l.index=u;for(var c=u;h>c;++c){var d=3*c,p=s[d],f=s[d+1],g=s[d+2],m=3*p;t[0]=o[m],t[1]=o[m+1],t[2]=o[m+2],m=3*f,e[0]=o[m],e[1]=o[m+1],e[2]=o[m+2],m=3*g,i[0]=o[m],i[1]=o[m+1],i[2]=o[m+2],l.intersect(t,e,i,p,f,g)}}else n>0&&this.intersectSphere(this._kdNodes[n]._bb)&&this.intersect(this._kdNodes[n]),a>0&&this.intersectSphere(this._kdNodes[a]._bb)&&this.intersect(this._kdNodes[a])}}(),intersectSphere:function(){var t=n.create();return function(e){var i=this._radius+e.radius();return n.distance2(this._center,e.center(t))<=i*i}}()}),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1114),a=i(1191),s=i(1109),o=function(t,e,i,r){this.normal=t,this.i1=e,this.i2=i,this.i3=r},u=function(){a.apply(this,arguments),arguments&&arguments.length&&s.warn("using ctor as initialiser is deprecated, use set(center, radius)")};u.prototype=r.objectInherit(a.prototype,{set:function(t,e){this._center=t,this._radius=e},intersect:function(){var t=n.create(),e=n.create(),i=n.create();return function(r,a,s,u,h,l){n.sub(a,r,t),n.sub(s,r,e);var c=n.length2(t),d=n.dot(t,e),p=n.length2(e);n.sub(r,this._center,i);var f=n.dot(i,t),g=n.dot(i,e),m=n.length2(i),v=Math.abs(c*p-d*d);if(!(1e-10>v)){var _,b=d*g-p*f,x=d*f-c*g,A=4;if(v>=b+x)if(0>b)0>x?(A=4,0>f?(x=0,-f>=c?(b=1,_=c+2*f+m):(b=-f/c,_=f*b+m)):(b=0,g>=0?(x=0,_=m):-g>=p?(x=1,_=p+2*g+m):(x=-g/p,_=g*x+m))):(A=3,b=0,g>=0?(x=0,_=m):-g>=p?(x=1,_=p+2*g+m):(x=-g/p,_=g*x+m));else if(0>x)A=5,x=0,f>=0?(b=0,_=m):-f>=c?(b=1,_=c+2*f+m):(b=-f/c,_=f*b+m);else{A=0;var y=1/v;b*=y,x*=y,_=b*(c*b+d*x+2*f)+x*(d*b+p*x+2*g)+m}else{var S,C,w,T;0>b?(A=2,S=d+f,C=p+g,C>S?(w=C-S,T=c-2*d+p,w>=T?(b=1,x=0,_=c+2*f+m):(b=w/T,x=1-b,_=b*(c*b+d*x+2*f)+x*(d*b+p*x+2*g)+m)):(b=0,0>=C?(x=1,_=p+2*g+m):g>=0?(x=0,_=m):(x=-g/p,_=g*x+m))):0>x?(A=6,S=d+g,C=c+f,C>S?(w=C-S,T=c-2*d+p,w>=T?(x=1,b=0,_=p+2*g+m):(x=w/T,b=1-x,_=b*(c*b+d*x+2*f)+x*(d*b+p*x+2*g)+m)):(x=0,0>=C?(b=1,_=c+2*f+m):f>=0?(b=0,_=m):(b=-f/c,_=f*b+m))):(A=1,w=p+g-d-f,0>=w?(b=0,x=1,_=p+2*g+m):(T=c-2*d+p,w>=T?(b=1,x=0,_=c+2*f+m):(b=w/T,x=1-b,_=b*(c*b+d*x+2*f)+x*(d*b+p*x+2*g)+m)))}if(0>_&&(_=0),!(_>this._radius*this._radius)){var M=n.create();M&&(M[0]=r[0]+b*t[0]+x*e[0],M[1]=r[1]+b*t[1]+x*e[1],M[2]=r[2]+b*t[2]+x*e[2]);var E=n.create();n.cross(t,e,E),n.normalize(E,E),this._intersections.push({ratio:Math.sqrt(_),nodepath:this._nodePath.slice(0),TriangleIntersection:new o(E,u,h,l),point:M,zone:A}),this.hit=!0}}}}()}),t.exports=u},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=i(1188),s=function(t){n.call(this),this._buildOptions=void 0!==t?t:{_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20}};s.prototype=r.objectInherit(n.prototype,{apply:function(t){if(t.getShape){var e=t.getShape();if(void 0===e){var i=new a;i.build(this._buildOptions,t)&&t.setShape(i)}}this.traverse(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=i(1134),s=i(1122),o=i(1114),u=i(1124),h=i(1119),l=i(1109),c=function(t,e){n.call(this);var i=void 0!==t?t:0;this._ambient=u.createAndSet(.2,.2,.2,1),this._diffuse=u.createAndSet(.8,.8,.8,1),this._specular=u.createAndSet(.2,.2,.2,1),this._position=u.createAndSet(0,0,1,0),this._direction=o.createAndSet(0,0,-1),this._ground=u.createAndSet(.2,.2,.2,-1),this._spotCutoff=180,this._spotBlend=.01,this._attenuation=u.createAndSet(1,0,0,0),this._lightUnit=i,this._invMatrix=s.create(),this._enable=!e};c.DIRECTION="DIRECTION",c.SPOT="SPOT",c.POINT="POINT",c.HEMI="HEMI",c.uniforms={},c.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Light",cloneType:function(){return new c(this._lightUnit,!0)},getTypeMember:function(){return this.attributeType+this._lightUnit},getUniformName:function(t){var e=this.getType()+this._lightUnit.toString();return e+"_uniform_"+t},getHash:function(){return this.getTypeMember()+this.getLightType()+this.isEnabled().toString()},getOrCreateUniforms:function(){var t=c,e=this.getTypeMember();if(t.uniforms[e])return t.uniforms[e];var i={ambient:"createFloat4",diffuse:"createFloat4",specular:"createFloat4",attenuation:"createFloat4",position:"createFloat4",direction:"createFloat3",spotCutOff:"createFloat1",spotBlend:"createFloat1",ground:"createFloat4",matrix:"createMatrix4",invMatrix:"createMatrix4"},r={};return window.Object.keys(i).forEach(function(t){var e=i[t],n=a[e];r[t]=n(this.getUniformName(t))}.bind(this)),t.uniforms[e]=new h(r),t.uniforms[e]},isEnabled:function(){return this._enable},setEnabled:function(t){this._enable=t},isEnable:function(){return l.log("Light.isEnable() is deprecated, use isEnabled instead"),this.isEnabled()},setEnable:function(t){l.log("Light.setEnable() is deprecated, use setEnabled instead"),this.setEnabled(t)},setAmbient:function(t){u.copy(t,this._ambient)},getAmbient:function(){return this._ambient},setDiffuse:function(t){u.copy(t,this._diffuse)},getDiffuse:function(){return this._diffuse},setSpecular:function(t){u.copy(t,this._specular)},getSpecular:function(){return this._specular},setPosition:function(t){u.copy(t,this._position)},getPosition:function(){return this._position},setDirection:function(t){o.copy(t,this._direction)},getDirection:function(){return this._direction},setSpotCutoff:function(t){this._spotCutoff=t},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(t){this._spotBlend=t},getSpotBlend:function(){return this._spotBlend},setGround:function(t){o.copy(t,this._ground)},getGround:function(){return this._ground},setConstantAttenuation:function(t){this._attenuation[0]=t},getConstantAttenuation:function(){return this._attenuation[0]},setLinearAttenuation:function(t){this._attenuation[1]=t},getLinearAttenuation:function(){return this._attenuation[1]},setQuadraticAttenuation:function(t){this._attenuation[2]=t},getQuadraticAttenuation:function(){return this._attenuation[2]},setLightType:function(t){return t===c.DIRECTION?this.setLightAsDirection():t===c.SPOT?this.setLightAsSpot():t===c.HEMI?this.setLightAsHemi():this.setLightAsPoint()},getLightType:function(){return this.isDirectionLight()?c.DIRECTION:this.isSpotLight()?c.SPOT:this.isHemiLight()?c.HEMI:c.POINT},setLightAsSpot:function(){u.set(0,0,0,1,this._position),o.set(0,0,-1,this._direction),this._ground[3]=-1,this._spotCutoff=90},setLightAsPoint:function(){u.set(0,0,0,1,this._position),o.set(0,0,-1,this._direction),this._ground[3]=-1},setLightAsDirection:function(){u.set(0,0,1,0,this._position),this._spotCutoff=180,this._ground[3]=-1},setLightAsHemi:function(){u.set(0,0,1,0,this._position),this._spotCutoff=180,this._ground[3]=1},setLightNumber:function(t){this._lightUnit=t},getLightNumber:function(){return this._lightUnit},isSpotLight:function(){return this._spotCutoff<180},isDirectionLight:function(){return 0===this._position[3]&&this._ground[3]<0},isHemiLight:function(){return this._ground[3]>=0},applyPositionedUniform:function(t){var e=this.getOrCreateUniforms(),i=e.matrix.getInternalArray(),r=e.invMatrix.getInternalArray();s.copy(t,i),s.copy(t,r),r[12]=0,r[13]=0,r[14]=0,s.inverse(r,r),s.transpose(r,r)},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();if(t.position.setFloat4(this._position),this.isSpotLight()){var e=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutOff.setFloat(e),t.spotBlend.setFloat((1-e)*this._spotBlend),t.direction.setFloat3(this._direction)}this.isHemiLight()&&t.ground.setFloat4(this._ground),t.attenuation.setFloat4(this._attenuation),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.ambient.setFloat4(this._ambient)}}}),"osg","Light"),r.setTypeID(c),t.exports=c},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=function(t){n.call(this),this.lineWidth=1,void 0!==t&&(this.lineWidth=t)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"LineWidth",cloneType:function(){return new a},apply:function(t){t.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),t.exports=a},function(t,e,i){"use strict";var r=i(1114),n=i(1140),a=function(t,e,i){this._geom=t,this._cb=e,this._vertices=i};a.prototype={applyDrawElementsPoints:function(){var t=r.create();return function(e,i){for(var r=this._cb(),n=0;e>n;++n){var a=3*i[n];t[0]=this._vertices[a],t[1]=this._vertices[a+1],t[2]=this._vertices[a+2],r.operatorPoint(t)}}}(),applyDrawElementsLines:function(){var t=r.create(),e=r.create();return function(i,r){for(var n=this._cb(),a=0;i-1>a;a+=2){var s=3*r[a];t[0]=this._vertices[s],t[1]=this._vertices[s+1],t[2]=this._vertices[s+2],s=3*r[a+1],e[0]=this._vertices[s],e[1]=this._vertices[s+1],e[2]=this._vertices[s+2],n.operatorLine(t,e)}}}(),applyDrawElementsLineStrip:function(){var t=r.create(),e=r.create();return function(i,r){for(var n=this._cb(),a=0;i-1>a;++a){var s=3*r[a];t[0]=this._vertices[s],t[1]=this._vertices[s+1],t[2]=this._vertices[s+2],s=3*r[a+1],e[0]=this._vertices[s],e[1]=this._vertices[s+1],e[2]=this._vertices[s+2],n.operatorLine(t,e)}}}(),applyDrawElementsLineLoop:function(){var t=r.create(),e=r.create();return function(i,r){for(var n=this._cb(),a=i-1,s=0;a>s;++s){var o=3*r[s];t[0]=this._vertices[o],t[1]=this._vertices[o+1],t[2]=this._vertices[o+2],o=3*r[s+1],e[0]=this._vertices[o],e[1]=this._vertices[o+1],e[2]=this._vertices[o+2],n.operatorLine(t,e)}a=3*r[a],t[0]=this._vertices[a],t[1]=this._vertices[a+1],t[2]=this._vertices[a+2];var u=3*r[0];e[0]=this._vertices[u],e[1]=this._vertices[u+1],e[2]=this._vertices[u+2],n.operatorLine(t,e)}}(),applyDrawElementsTriangles:function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n){for(var a=this._cb(),s=0;r>s;s+=3){var o=3*n[s];t[0]=this._vertices[o],t[1]=this._vertices[o+1],t[2]=this._vertices[o+2],o=3*n[s+1],e[0]=this._vertices[o],e[1]=this._vertices[o+1],e[2]=this._vertices[o+2],o=3*n[s+2],i[0]=this._vertices[o],i[1]=this._vertices[o+1],i[2]=this._vertices[o+2],a.operatorTriangle(t,e,i)}}}(),applyDrawElementsTriangleStrip:function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n){for(var a=this._cb(),s=2,o=0;r>s;++s,++o){var u=3*n[o];t[0]=this._vertices[u],t[1]=this._vertices[u+1],t[2]=this._vertices[u+2],u=3*n[o+1],e[0]=this._vertices[u],e[1]=this._vertices[u+1],e[2]=this._vertices[u+2],u=3*n[o+2],i[0]=this._vertices[u],i[1]=this._vertices[u+1],i[2]=this._vertices[u+2],s%2?a.operatorTriangle(t,i,e):a.operatorTriangle(t,e,i)}}}(),applyDrawElementsTriangleFan:function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n){for(var a=this._cb(),s=n[0],o=2,u=1;r>o;++o,++u){t[0]=this._vertices[s],t[1]=this._vertices[s+1],t[2]=this._vertices[s+2];var h=3*n[u];e[0]=this._vertices[h],e[1]=this._vertices[h+1],e[2]=this._vertices[h+2],h=3*n[u+1],i[0]=this._vertices[h],i[1]=this._vertices[h+1],i[2]=this._vertices[h+2],a.operatorTriangle(t,e,i)}}}(),applyDrawArraysPoints:function(){var t=r.create();return function(e,i){for(var r=this._cb(),n=e;e+i>n;++n){var a=3*n;t[0]=this._vertices[a],t[1]=this._vertices[a+1],t[2]=this._vertices[a+2],r.operatorPoint(t)}}}(),applyDrawArraysLines:function(){var t=r.create(),e=r.create();return function(i,r){for(var n=this._cb(),a=i;i+r-1>a;a+=2){var s=3*a;t[0]=this._vertices[s],t[1]=this._vertices[s+1],t[2]=this._vertices[s+2],s=3*(a+1),e[0]=this._vertices[s],e[1]=this._vertices[s+1],e[2]=this._vertices[s+2],n.operatorLine(t,e)}}}(),applyDrawArraysLineStrip:function(){var t=r.create(),e=r.create();return function(i,r){for(var n=this._cb(),a=i;i+r-1>a;++a){var s=3*a;t[0]=this._vertices[s],t[1]=this._vertices[s+1],t[2]=this._vertices[s+2],s=3*(a+1),e[0]=this._vertices[s],e[1]=this._vertices[s+1],e[2]=this._vertices[s+2],n.operatorLine(t,e)}}}(),applyDrawArraysLineLoop:function(){var t=r.create(),e=r.create();return function(i,r){for(var n=this._cb(),a=i+r-1,s=i;a>s;++s){var o=3*s;t[0]=this._vertices[o],t[1]=this._vertices[o+1],t[2]=this._vertices[o+2],o=3*(s+1),e[0]=this._vertices[o],e[1]=this._vertices[o+1],e[2]=this._vertices[o+2],n.operatorLine(t,e)}a=3*a,t[0]=this._vertices[a],t[1]=this._vertices[a+1],t[2]=this._vertices[a+2],i=3*i,e[0]=this._vertices[i],e[1]=this._vertices[i+1],e[2]=this._vertices[i+2],n.operatorLine(t,e)}}(),applyDrawArraysTriangles:function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n){for(var a=this._cb(),s=r;r+n>s;s+=3){var o=3*s;t[0]=this._vertices[o],t[1]=this._vertices[o+1],t[2]=this._vertices[o+2],o=3*(s+1),e[0]=this._vertices[o],e[1]=this._vertices[o+1],e[2]=this._vertices[o+2],o=3*(s+2),i[0]=this._vertices[o],i[1]=this._vertices[o+1],i[2]=this._vertices[o+2],a.operatorTriangle(t,e,i)}}}(),applyDrawArraysTriangleStrip:function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n){for(var a=this._cb(),s=2,o=r;n>s;++s,++o){var u=3*o;t[0]=this._vertices[u],t[1]=this._vertices[u+1],t[2]=this._vertices[u+2],u=3*(o+1),e[0]=this._vertices[u],e[1]=this._vertices[u+1],e[2]=this._vertices[u+2],u=3*(o+2),i[0]=this._vertices[u],i[1]=this._vertices[u+1],i[2]=this._vertices[u+2],s%2?a.operatorTriangle(t,i,e):a.operatorTriangle(t,e,i)}}}(),applyDrawArraysTriangleFan:function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n){for(var a=this._cb(),s=2,o=r+1;n>s;++s,++o){t[0]=this._vertices[r],t[1]=this._vertices[r+1],t[2]=this._vertices[r+2];var u=3*o;e[0]=this._vertices[u],e[1]=this._vertices[u+1],e[2]=this._vertices[u+2],u=3*(o+1),i[0]=this._vertices[u],i[1]=this._vertices[u+1],i[2]=this._vertices[u+2],a.operatorTriangle(t,e,i)}}}(),apply:function(){var t=this._geom,e=t.primitives;if(e)for(var i=e.length,r=0;i>r;r++){var a=e[r];if(void 0!==a.getIndices){var s=a.indices.getElements();switch(a.getMode()){case n.POINTS:this.applyDrawElementsPoints(a.getCount(),s);break;case n.LINES:this.applyDrawElementsLines(a.getCount(),s);break;case n.LINE_STRIP:this.applyDrawElementsLineStrip(a.getCount(),s);break;case n.LINE_LOOP:this.applyDrawElementsLineLoop(a.getCount(),s);break;case n.TRIANGLES:this.applyDrawElementsTriangles(a.getCount(),s);break;case n.TRIANGLE_STRIP:this.applyDrawElementsTriangleStrip(a.getCount(),s);break;case n.TRIANGLE_FAN:this.applyDrawElementsTriangleFan(a.getCount(),s)}}else switch(a.getMode()){case n.POINTS:this.applyDrawArraysPoints(a.getFirst(),a.getCount());break;case n.LINES:this.applyDrawArraysLines(a.getFirst(),a.getCount());break;case n.LINE_STRIP:this.applyDrawArraysLineStrip(a.getFirst(),a.getCount());break;case n.LINE_LOOP:this.applyDrawArraysLineLoop(a.getFirst(),a.getCount());break;case n.TRIANGLES:this.applyDrawArraysTriangles(a.getFirst(),a.getCount());break;case n.TRIANGLE_STRIP:this.applyDrawArraysTriangleStrip(a.getFirst(),a.getCount());break;case n.TRIANGLE_FAN:this.applyDrawArraysTriangleFan(a.getFirst(),a.getCount())}}}},t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1109),a=i(1136),s=i(1120),o=i(1119),u=i(1108),h=function(t,e){a.call(this),s.call(this),this._program=null,this._nullProgram=!0,this._vertex=void 0,this._fragment=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._activeUniforms=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,t&&this.setVertexShader(t),e&&this.setFragmentShader(e),this._dirty=!0};h._sDeletedGLProgramCache=new window.Map,h.deleteGLProgram=function(t,e){h._sDeletedGLProgramCache.has(t)||h._sDeletedGLProgramCache.set(t,[]),h._sDeletedGLProgramCache.get(t).push(e)},h.flushDeletedGLPrograms=function(t,e){if(0>=e)return e;if(!h._sDeletedGLProgramCache.has(t))return e;for(var i=0,r=u.instance().tick(),n=h._sDeletedGLProgramCache.get(t),a=n.length,s=a-1;s>=0&&e>i;s--)t.deleteProgram(n[s]),n.splice(s,1),i=u.instance().deltaS(r,u.instance().tick());return e-i},h.flushAllDeletedGLPrograms=function(t){if(h._sDeletedGLProgramCache.has(t))for(var e=h._sDeletedGLProgramCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteProgram(e[r]),e.splice(r,1)},h.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,r.objectInherit(s.prototype,{attributeType:"Program",cloneType:function(){return new h},setVertexShader:function(t){this._vertex=t,this._nullProgram=!1},setFragmentShader:function(t){this._fragment=t,this._nullProgram=!1},getVertexShader:function(){return this._vertex},getFragmentShader:function(){return this._fragment},getProgram:function(){return this._program},setActiveUniforms:function(t){this._activeUniforms=t},getActiveUniforms:function(){return this._activeUniforms},setForeignUniforms:function(t){this._foreignUniforms=t},getForeignUniforms:function(){return this._foreignUniforms},setUniformsCache:function(t){this._uniformsCache=t},getUniformsCache:function(){return this._uniformsCache},setAttributesCache:function(t){this._attributesCache=t},getAttributesCache:function(){return this._attributesCache},setTrackAttributes:function(t){this._trackAttributes=t},getTrackAttributes:function(){return this._trackAttributes},releaseGLObjects:function(){void 0!==this._vertex&&this._vertex.releaseGLObjects(),void 0!==this._fragment&&this._fragment.releaseGLObjects(),null!==this._program&&(void 0!==this._gl&&h.deleteGLProgram(this._gl,this._program),this._program=void 0)},apply:function(t){if(!this._nullProgram){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl;if(!this._program||this._dirty){var i;if(this._vertex.shader||(i=this._vertex.compile(e)),this._fragment.shader||(i=this._fragment.compile(e)),i&&(this._program=e.createProgram(),e.attachShader(this._program,this._vertex.shader),e.attachShader(this._program,this._fragment.shader),r.timeStamp("osgjs.metrics:linkShader"),e.linkProgram(this._program),!e.getProgramParameter(this._program,e.LINK_STATUS)&&!e.isContextLost())){var a=e.getProgramInfoLog(this._program);n.errorFold(a,"can't link program\nvertex shader:\n"+this._vertex.text+"\n fragment shader:\n"+this._fragment.text);var s=void 0!==e.rawgl?e.rawgl:e;void 0!==s&&void 0!==s.getExtension&&(s=s.getExtension("WEBGL_debug_shaders")),s&&"Failed to create D3D shaders.\n"===a&&(n.error(s.getTranslatedShaderSource(this._vertex.shader)),n.error(s.getTranslatedShaderSource(this._fragment.shader))),i=!1}if(!i){if(!h.prototype._failSafeCache){var u=e.createProgram();this._vertex.failSafe(e),this._fragment.failSafe(e),e.attachShader(u,this._vertex.shader),e.attachShader(u,this._fragment.shader),e.linkProgram(u),e.validateProgram(u),h.prototype._failSafeCache=u}n.warn("FailSafe shader Activated "),this._program=this._failSafeCache}this._uniformsCache=new o,this._attributesCache=new o,this.cacheUniformList(e,this._vertex.text),this.cacheUniformList(e,this._fragment.text),this.cacheAttributeList(e,this._vertex.text),this._dirty=!1}t.applyProgram(this._program)}},cacheUniformList:function(t,e){var i=e.match(/uniform\s+\w+\s+\w+((\s)?\[(.*?)\])?/g),r=this._uniformsCache;if(null!==i)for(var n=0,a=i.length;a>n;n++){var s=i[n].match(/uniform\s+\w+\s+(\w+)/)[1],o=i[n].match(/uniform\s+\w+\s+(\w+)(\s?\[.*?\])?/)[1],u=t.getUniformLocation(this._program,s);void 0!==u&&null!==u&&void 0===r[o]&&(r[o]=u,this._uniformsCache.dirty())}},cacheAttributeList:function(t,e){var i=e.match(/attribute\s+\w+\s+\w+/g),r=this._attributesCache;if(null!==i)for(var n=0,a=i.length;a>n;n++){var s=i[n].match(/attribute\s+\w+\s+(\w+)/)[1],o=t.getAttribLocation(this._program,s);-1!==o&&void 0!==o&&void 0===r[s]&&(r[s]=o,this._attributesCache.dirty())}}})),"osg","Program"),t.exports=h},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1108),s=i(1136),o=function(t,e){s.call(this);var i=t;"string"==typeof t&&(i=o[t]),this.type=i,this.setText(e)};o.VERTEX_SHADER=35633,o.FRAGMENT_SHADER=35632,o.VS_DBG="attribute vec3 Vertex;uniform mat4 ModelViewMatrix;uniform mat4 ProjectionMatrix;void main(void) {  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);}",o.FS_DBG="precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}";var u="\n#define SHADER_NAME FailSafe\n";o.VS_DBG+=u,o.FS_DBG+=u,o._sDeletedGLShaderCache=new window.Map,o.deleteGLShader=function(t,e){o._sDeletedGLShaderCache.has(t)||o._sDeletedGLShaderCache.set(t,[]),o._sDeletedGLShaderCache.get(t).push(e)},o.flushDeletedGLShaders=function(t,e){if(0>=e)return e;if(!o._sDeletedGLShaderCache.has(t))return e;for(var i=0,r=a.instance().tick(),n=o._sDeletedGLShaderCache.get(t),s=n.length,u=s-1;u>=0&&e>i;u--)t.deleteShader(n[u]),n.splice(u,1),i=a.instance().deltaS(r,a.instance().tick());return e-=i},o.flushAllDeletedGLShaders=function(t){if(o._sDeletedGLShaderCache.has(t))for(var e=o._sDeletedGLShaderCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteShader(e[r]),e.splice(r,1)},o.prototype=n.objectInherit(s.prototype,{setText:function(t){this.text=t},getText:function(){return this.text},failSafe:function(t){this.shader=t.createShader(this.type),t.shaderSource(this.shader,this.type===o.VERTEX_SHADER?o.VS_DBG:o.FS_DBG),t.compileShader(this.shader)},processErrors:function(t,e){var i=/ERROR: [\d]+:([\d]+): (.+)/gim,n=e.split("\n"),a=n.length;if(0!==a){var s,o;for(null===i.exec(t)&&(i=/Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),i.lastIndex=0;null!=(o=i.exec(t));){o.index===i.lastIndex&&i.lastIndex++;var u=parseInt(o[1]);if(!(u>a)){r.error("ERROR "+o[2]+" in line "+u);var h=Math.max(0,u-7),l=Math.max(0,u-2);for(s=h;l>=s;s++)r.warn(n[s].replace(/^[ \t]+/g,""));for(l=Math.max(0,u-1),r.error(n[l].replace(/^[ \t]+/g,"")),h=Math.min(a,u),l=Math.min(a,u+5),s=h;l>s;s++)r.warn(n[s].replace(/^[ \t]+/g,""))}}}},compile:function(t){this._gl||this.setGraphicContext(t),this.shader=t.createShader(this.type);var e=this.text;if(o.enableGLSLOptimizer&&o.glslOptimizer){var i=this.type===o.VERTEX_SHADER?"vertex":"fragment";r.infoFold(i+" shader before optimization",e);var a=o.glslOptimizer(e,"2",this.type===o.VERTEX_SHADER);-1!==a.indexOf("Error:")?r.error(a):a.length<=1?r.warnFold("glsl optimizer returned an empty shader, the original will be used",e):(r.infoFold(i+" shader after optimization",a),e=a)}if(t.shaderSource(this.shader,e),n.timeStamp("osgjs.metrics:compileShader"),t.compileShader(this.shader),!t.getShaderParameter(this.shader,t.COMPILE_STATUS)&&!t.isContextLost()){var s=t.getShaderInfoLog(this.shader);this.processErrors(s,e);for(var u="\n"+e,h=u.split("\n"),l="\n",c=0,d=h.length;d>c;++c)l+=c+" "+h[c]+"\n";return r.debugFold("can't compile shader",l),!1}return!0},releaseGLObjects:function(){
void 0!==this._gl&&o.deleteGLShader(this._gl,this.shader),this.shader=void 0}}),o.create=function(t,e){return r.log("Shader.create is deprecated, use new Shader with the same arguments instead"),new o(t,e)},t.exports=o},function(t,e,i){"use strict";var r=i(1109),n=i(1114),a=i(1139),s=i(1130),o=i(1140),u=i(1141),h=i(1142),l=i(1198),c=i(1199),d=i(1105),p=function(t,e,i,r,n,u){var l,c,p,f=void 0!==t?t:0,g=void 0!==e?e:0,m=void 0!==i?i:0,v=void 0!==r?r:1,_=void 0!==n?n:1,b=void 0!==u?u:1,x=new s;l=v/2,c=_/2,p=b/2;var A=new d.Float32Array(72),y=new d.Float32Array(48),S=new d.Float32Array(72);A[0]=f-l,A[1]=g-c,A[2]=m+p,S[0]=0,S[1]=-1,S[2]=0,y[0]=0,y[1]=1,A[3]=f-l,A[4]=g-c,A[5]=m-p,S[3]=0,S[4]=-1,S[5]=0,y[2]=0,y[3]=0,A[6]=f+l,A[7]=g-c,A[8]=m-p,S[6]=0,S[7]=-1,S[8]=0,y[4]=1,y[5]=0,A[9]=f+l,A[10]=g-c,A[11]=m+p,S[9]=0,S[10]=-1,S[11]=0,y[6]=1,y[7]=1,A[12]=f+l,A[13]=g+c,A[14]=m+p,S[12]=0,S[13]=1,S[14]=0,y[8]=0,y[9]=1,A[15]=f+l,A[16]=g+c,A[17]=m-p,S[15]=0,S[16]=1,S[17]=0,y[10]=0,y[11]=0,A[18]=f-l,A[19]=g+c,A[20]=m-p,S[18]=0,S[19]=1,S[20]=0,y[12]=1,y[13]=0,A[21]=f-l,A[22]=g+c,A[23]=m+p,S[21]=0,S[22]=1,S[23]=0,y[14]=1,y[15]=1,A[24]=f+l,A[25]=g-c,A[26]=m+p,S[24]=1,S[25]=0,S[26]=0,y[16]=0,y[17]=1,A[27]=f+l,A[28]=g-c,A[29]=m-p,S[27]=1,S[28]=0,S[29]=0,y[18]=0,y[19]=0,A[30]=f+l,A[31]=g+c,A[32]=m-p,S[30]=1,S[31]=0,S[32]=0,y[20]=1,y[21]=0,A[33]=f+l,A[34]=g+c,A[35]=m+p,S[33]=1,S[34]=0,S[35]=0,y[22]=1,y[23]=1,A[36]=f-l,A[37]=g+c,A[38]=m+p,S[36]=-1,S[37]=0,S[38]=0,y[24]=0,y[25]=1,A[39]=f-l,A[40]=g+c,A[41]=m-p,S[39]=-1,S[40]=0,S[41]=0,y[26]=0,y[27]=0,A[42]=f-l,A[43]=g-c,A[44]=m-p,S[42]=-1,S[43]=0,S[44]=0,y[28]=1,y[29]=0,A[45]=f-l,A[46]=g-c,A[47]=m+p,S[45]=-1,S[46]=0,S[47]=0,y[30]=1,y[31]=1,A[48]=f-l,A[49]=g+c,A[50]=m+p,S[48]=0,S[49]=0,S[50]=1,y[32]=0,y[33]=1,A[51]=f-l,A[52]=g-c,A[53]=m+p,S[51]=0,S[52]=0,S[53]=1,y[34]=0,y[35]=0,A[54]=f+l,A[55]=g-c,A[56]=m+p,S[54]=0,S[55]=0,S[56]=1,y[36]=1,y[37]=0,A[57]=f+l,A[58]=g+c,A[59]=m+p,S[57]=0,S[58]=0,S[59]=1,y[38]=1,y[39]=1,A[60]=f+l,A[61]=g+c,A[62]=m-p,S[60]=0,S[61]=0,S[62]=-1,y[40]=0,y[41]=1,A[63]=f+l,A[64]=g-c,A[65]=m-p,S[63]=0,S[64]=0,S[65]=-1,y[42]=0,y[43]=0,A[66]=f-l,A[67]=g-c,A[68]=m-p,S[66]=0,S[67]=0,S[68]=-1,y[44]=1,y[45]=0,A[69]=f-l,A[70]=g+c,A[71]=m-p,S[69]=0,S[70]=0,S[71]=-1,y[46]=1,y[47]=1;var C=new d.Uint16Array(36);C[0]=0,C[1]=1,C[2]=2,C[3]=0,C[4]=2,C[5]=3,C[6]=4,C[7]=5,C[8]=6,C[9]=4,C[10]=6,C[11]=7,C[12]=8,C[13]=9,C[14]=10,C[15]=8,C[16]=10,C[17]=11,C[18]=12,C[19]=13,C[20]=14,C[21]=12,C[22]=14,C[23]=15,C[24]=16,C[25]=17,C[26]=18,C[27]=16,C[28]=18,C[29]=19,C[30]=20,C[31]=21,C[32]=22,C[33]=20,C[34]=22,C[35]=23,x.getAttributes().Vertex=new a(a.ARRAY_BUFFER,A,3),x.getAttributes().Normal=new a(a.ARRAY_BUFFER,S,3),x.getAttributes().TexCoord0=new a(a.ARRAY_BUFFER,y,2);var w=new h(o.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,C,1));return x.getPrimitives().push(w),x},f=function(){var t=new s,e=new d.Float32Array([-1,-1,-1,4,4,-1]),i=new d.Float32Array([-1,-1,-1,4,4,-1]),r=new d.Uint16Array(3);r[0]=2,r[1]=1,r[2]=0,t.getAttributes().Vertex=new a(a.ARRAY_BUFFER,i,2),t.getAttributes().TexCoord0=new a(a.ARRAY_BUFFER,e,2);var n=new h(o.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,r,1));return t.getPrimitives().push(n),function(){return t}}(),g=function(t,e,i,r,u,l,c,p,f,g,m,v,_){void 0===v&&void 0===_&&(v=g,_=m,g=0,m=0);var b=new s,x=new d.Float32Array(12);x[0]=t+c,x[1]=e+p,x[2]=i+f,x[3]=t,x[4]=e,x[5]=i,x[6]=t+r,x[7]=e+u,x[8]=i+l,x[9]=t+r+c,x[10]=e+u+p,x[11]=i+l+f,void 0===v&&(v=1),void 0===_&&(_=1);var A=new d.Float32Array(8);A[0]=g,A[1]=_,A[2]=g,A[3]=m,A[4]=v,A[5]=m,A[6]=v,A[7]=_;var y=n.createAndSet(r,u,l);n.cross(y,n.createAndSet(c,p,f),y),n.normalize(y,y);var S=new d.Float32Array(12);S[0]=y[0],S[1]=y[1],S[2]=y[2],S[3]=y[0],S[4]=y[1],S[5]=y[2],S[6]=y[0],S[7]=y[1],S[8]=y[2],S[9]=y[0],S[10]=y[1],S[11]=y[2];var C=new d.Uint16Array(6);C[0]=0,C[1]=1,C[2]=2,C[3]=0,C[4]=2,C[5]=3,b.getAttributes().Vertex=new a(a.ARRAY_BUFFER,x,3),b.getAttributes().Normal=new a(a.ARRAY_BUFFER,S,3),b.getAttributes().TexCoord0=new a(a.ARRAY_BUFFER,A,2);var w=new h(o.TRIANGLES,new a(a.ELEMENT_ARRAY_BUFFER,C,1));return b.getPrimitives().push(w),b},m=function(t,e,i,n,a,s){return r.log("createTexturedBox is deprecated use instead createTexturedBoxGeometry"),p(t,e,i,n,a,s)},v=function(t,e,i,n,a,s,o,u,h,l,c,d,p){return r.log("createTexturedQuad is deprecated use instead createTexturedQuadGeometry"),g(t,e,i,n,a,s,o,u,h,l,c,d,p)},_=function(t){void 0===t&&(t=5),void 0===_.getShader&&(_.getShader=function(){if(void 0===_.getShader.program){var t=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","","varying vec4 FragColor;","","vec4 ftransform() {","return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}","","void main(void) {","gl_Position = ftransform();","FragColor = Color;","}"].join("\n"),e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 FragColor;","void main(void) {","gl_FragColor = FragColor;","}"].join("\n"),i=new l(new c("VERTEX_SHADER",t),new c("FRAGMENT_SHADER",e));_.getShader.program=i}return _.getShader.program});var e=new s,i=new d.Float32Array(18);i[3]=t,i[10]=t,i[17]=t;var r=new d.Float32Array(24);r[0]=r[3]=1,r[4]=r[7]=1,r[9]=r[11]=1,r[13]=r[15]=1,r[18]=r[19]=1,r[22]=r[23]=1,e.getAttributes().Vertex=new a(a.ARRAY_BUFFER,i,3),e.getAttributes().Color=new a(a.ARRAY_BUFFER,r,4);var n=new u(o.LINES,0,6);return e.getPrimitives().push(n),e.getOrCreateStateSet().setAttributeAndModes(_.getShader()),e},b=function(t,e,i,r,l,c,p){t=t||50,r=void 0!==r?r:0,l=void 0!==l?l:2*Math.PI,c=void 0!==c?c:0,p=void 0!==p?p:Math.PI;for(var f=Math.max(3,Math.floor(e)||8),g=Math.max(2,Math.floor(i)||6),m=f*g/3>=65536,v=m?f*g*6:f*g*4,_=new d.Float32Array(3*v),b=new d.Float32Array(3*v),x=new d.Float32Array(2*v),A=m?void 0:new d.Uint16Array(f*g*6),y=0,S=0,C=new d.Float32Array(3),w=new d.Float32Array(3),T=new d.Float32Array(3),M=new d.Float32Array(3),E=new d.Float32Array(3),k=new d.Float32Array(3),I=new d.Float32Array(3),N=new d.Float32Array(3),R=new d.Float32Array(2),F=new d.Float32Array(2),P=new d.Float32Array(2),D=new d.Float32Array(2),L=function(e,i,a,s,o){a[0]=-t*Math.cos(r+e*l)*Math.sin(c+i*p),a[1]=t*Math.cos(c+i*p),a[2]=t*Math.sin(r+e*l)*Math.sin(c+i*p),n.normalize(a,s),o[0]=e,o[1]=1-i},O=0;g>O;O++)for(var V=0;f>V;V++){L((V+1)/f,O/g,C,E,R),L(V/f,O/g,w,k,F),L(V/f,(O+1)/g,T,I,P),L((V+1)/f,(O+1)/g,M,N,D);var B=3*y;_[B]=C[0],_[B+1]=C[1],_[B+2]=C[2],_[B+3]=w[0],_[B+4]=w[1],_[B+5]=w[2],_[B+6]=T[0],_[B+7]=T[1],_[B+8]=T[2],b[B]=E[0],b[B+1]=E[1],b[B+2]=E[2],b[B+3]=k[0],b[B+4]=k[1],b[B+5]=k[2],b[B+6]=I[0],b[B+7]=I[1],b[B+8]=I[2];var U=2*y;if(x[U]=R[0],x[U+1]=R[1],x[U+2]=F[0],x[U+3]=F[1],x[U+4]=P[0],x[U+5]=P[1],y+=3,m)B=3*y,_[B]=C[0],_[B+1]=C[1],_[B+2]=C[2],_[B+3]=T[0],_[B+4]=T[1],_[B+5]=T[2],_[B+6]=M[0],_[B+7]=M[1],_[B+8]=M[2],b[B]=E[0],b[B+1]=E[1],b[B+2]=E[2],b[B+3]=I[0],b[B+4]=I[1],b[B+5]=I[2],b[B+6]=N[0],b[B+7]=N[1],b[B+8]=N[2],U=2*y,x[U]=R[0],x[U+1]=R[1],x[U+2]=P[0],x[U+3]=P[1],x[U+4]=D[0],x[U+5]=D[1],y+=3;else{B=3*y,_[B]=M[0],_[B+1]=M[1],_[B+2]=M[2],b[B]=N[0],b[B+1]=N[1],b[B+2]=N[2],U=2*y,x[U]=D[0],x[U+1]=D[1];var G=3*S,z=y-3;A[G]=z,A[G+1]=z+1,A[G+2]=z+2,A[G+3]=z,A[G+4]=z+2,A[G+5]=z+3,S+=2,y+=1}}var j=new s;return j.getAttributes().Vertex=new a("ARRAY_BUFFER",_,3),j.getAttributes().Normal=new a("ARRAY_BUFFER",b,3),j.getAttributes().TexCoord0=new a("ARRAY_BUFFER",x,2),m?j.getPrimitives().push(new u(o.TRIANGLES,0,_.length/3)):j.getPrimitives().push(new h(o.TRIANGLES,new a("ELEMENT_ARRAY_BUFFER",A,1))),j},x=function(t,e,i,r,n,h,l,c,d,p,f){t=void 0!==t?t:-.5,e=void 0!==e?e:-.5,i=void 0!==i?i:0,r=void 0!==r?r:1,n=void 0!==n?n:0,h=void 0!==h?h:0,l=void 0!==l?l:0,c=void 0!==c?c:1,d=void 0!==d?d:0,p=void 0!==p?p:5,f=void 0!==f?f:p,p+=2,f+=2;var g=new s,m=new Float32Array(2*(p+f)*3),v=0,_=0,b=r/(p-1),x=n/(p-1),A=h/(p-1),y=t+r+l,S=e+n+c,C=i+h+d;for(v=0;p>v;++v)_=6*v,m[_]=t+b*v,m[_+1]=e+x*v,m[_+2]=i+A*v,m[_+3]=y-b*(p-v-1),m[_+4]=S-x*(p-v-1),m[_+5]=C-A*(p-v-1);for(b=l/(f-1),x=c/(f-1),A=d/(f-1),v=0;f>v;++v)_=6*(p+v),m[_]=t+b*v,m[_+1]=e+x*v,m[_+2]=i+A*v,m[_+3]=y-b*(f-v-1),m[_+4]=S-x*(f-v-1),m[_+5]=C-A*(f-v-1);g.getAttributes().Vertex=new a(a.ARRAY_BUFFER,m,3);var w=new u(o.LINES,0,2*(p+f));return g.getPrimitives().push(w),g};t.exports={createTexturedBoxGeometry:p,createTexturedQuadGeometry:g,createTexturedSphereGeometry:b,createTexturedBox:m,createTexturedFullScreenFakeQuadGeometry:f,createTexturedQuad:v,createAxisGeometry:_,createTexturedSphere:b,createGridGeometry:x}},function(t,e){"use strict";var i=function(){this.globalDefault=void 0,this.lastApplied=void 0,this.asChanged=!1,this._values=[],this._back=void 0};i.prototype={empty:function(){return 0===this._values.length},values:function(){return this._values},back:function(){return this._back},push:function(t){this._values.push(t),this._back=t},pop:function(){var t=this._values.pop();return this._back=this._values[this._values.length-1],t}},t.exports=i},function(t,e,i){"use strict";var r=i(1119),n=i(1122),a=i(1109),s=i(1112),o=i(1198),u=i(1120),h=i(1201),l=i(1134),c=i(1105),d=i(1131),p=[void 0,function(t,e){return t[0]===e[0]?!0:(e[0]=t[0],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]?!0:(e[0]=t[0],e[1]=t[1],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]?!0:(e[0]=t[0],e[1]=t[1],e[2]=t[2],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]?!0:(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!1)}],f=function(t){s.call(this),this._graphicContext=void 0,this._shaderGeneratorProxy=t,void 0===t&&console["break"](),this._currentVAO=null,this._currentIndexVBO=null,this.vertexAttribList=[],this.stateSets=new h,this._shaderGeneratorNames=new h,this.uniforms=new r,this.textureAttributeMapList=[],this.attributeMap=new r,this.modelWorldMatrix=l.createMatrix4(n.create(),"ModelWorldMatrix"),this.viewMatrix=l.createMatrix4(n.create(),"ViewMatrix"),this.modelViewMatrix=l.createMatrix4(n.create(),"ModelViewMatrix"),this.projectionMatrix=l.createMatrix4(n.create(),"ProjectionMatrix"),this.normalMatrix=l.createMatrix4(n.create(),"NormalMatrix");var e=new h;e.globalDefault=l.createFloat1(0,"ArrayColorEnabled"),this.uniforms.setMap({ArrayColorEnabled:e}),this._previousColorAttribPair={},this.vertexAttribMap={},this.vertexAttribMap._disable=[],this.vertexAttribMap._keys=[],this._frameStamp=void 0,this._programCommonUniformsCache={},this._modelViewMatrix=void 0,this._projectionMatrix=void 0,this._program=void 0,this.applyAttribute(new o),this._numPushStateSet=0,this._numApply=0,this._programUniformCache=[],this._cacheUniformId=0};f.prototype=c.objectLibraryClass(c.objectInherit(s.prototype,{getCacheUniformsApplyRenderLeaf:function(){return this._programCommonUniformsCache},setGraphicContext:function(t){this._graphicContext=t,this._extVAO=d.instance(t).getWebGLExtension("OES_vertex_array_object")},getGraphicContext:function(){return this._graphicContext},getShaderGeneratorProxy:function(){return this._shaderGeneratorProxy},pushCheckOverride:function(t,e,i){0===t.values().length?t.push(this.getObjectPair(e,i)):t.back().value&u.OVERRIDE&&!(i&u.PROTECTED)?t.push(t.back()):t.push(this.getObjectPair(e,i))},pushStateSet:function(t){if(this._numPushStateSet++,this.stateSets.push(t),t.attributeMap&&this.pushAttributeMap(this.attributeMap,t.attributeMap),t.textureAttributeMapList)for(var e=t.textureAttributeMapList,i=0,r=e.length;r>i;i++)if(e[i]){var n=this.getOrCreateTextureAttributeMap(i);this.pushAttributeMap(n,e[i])}t.uniforms&&this.pushUniformsList(this.uniforms,t.uniforms);var a=t.getShaderGeneratorPair();a&&this.pushCheckOverride(this._shaderGeneratorNames,a.getShaderGeneratorName(),a.getValue())},getStateSetStackSize:function(){return this.stateSets.values().length},insertStateSet:function(){var t=[];return function(e,i){t.length=0;for(var r=this.getStateSetStackSize();r>e;)t.push(this.stateSets.back()),this.popStateSet(),r--;this.pushStateSet(i);for(var n=t.length-1;n>=0;n--)this.pushStateSet(t[n])}}(),removeStateSet:function(){var t=[];return function(e){var i=this.getStateSetStackSize();if(e>=i)return void a.warn("Warning State:removeStateSet "+e+" out of range");for(t.length=0;i-1>e;)t.push(this.stateSets.back()),this.popStateSet(),i--;this.popStateSet();for(var r=t.length-1;r>=0;r--)this.pushStateSet(t[r])}}(),resetCacheFrame:function(){this._modelViewMatrix=this._projectionMatrix=void 0},resetStats:function(){this._numApply=0,this._numPushStateSet=0},applyProgram:function(t){this._program!==t&&(this._program=t,this.getGraphicContext().useProgram(t))},applyModelViewMatrix:function(){var t=n.create();return function(e){if(this._modelViewMatrix===e)return!1;var i=this.getLastProgramApplied(),r=i.getUniformsCache(),a=this.modelViewMatrix,s=r.ModelViewMatrix,o=this.getGraphicContext();s&&(a.setMatrix4(e),a.apply(o,s));var u;if(this._modelViewMatrix){for(var h=this._modelViewMatrix,l=0;11>l;l++)if(e[l]!==h[l]){u=!0;break}}else u=!0;return u&&(a=this.normalMatrix,s=r.NormalMatrix,s&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[8]=e[8],t[9]=e[9],t[10]=e[10],n.inverse(t,t),n.transpose(t,t),a.setMatrix4(t),a.apply(o,s))),this._modelViewMatrix=e,!0}}(),applyModelViewMatrixEperiment:function(){var t=n.create(),e=function(t,e){return t[0]!==e[0]?!0:t[1]!==e[1]?!0:t[2]!==e[2]?!0:t[4]!==e[4]?!0:t[5]!==e[5]?!0:t[6]!==e[6]?!0:t[8]!==e[8]?!0:t[9]!==e[9]?!0:t[10]!==e[10]?!0:!1},i=1e-6,r=1+i,a=1-i;return function(i){if(this._modelViewMatrix===i)return!1;var s=this.getLastProgramApplied(),o=this.modelViewMatrix,u=s.getUniformsCache().ModelViewMatrix;u&&(o.setMatrix4(i),o.apply(this.getGraphicContext(),u));var h=!0;if(this._modelViewMatrix&&(h=e(i,this._modelViewMatrix)),h&&(o=this.normalMatrix,u=s.getUniformsCache().NormalMatrix)){t[0]=i[0],t[1]=i[1],t[2]=i[2],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[8]=i[8],t[9]=i[9],t[10]=i[10];var l=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],c=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],d=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];(l>r||a>l||c>r||a>c||d>r||a>d)&&(n.inverse(t,t),n.transpose(t,t)),o.setMatrix4(t),o.apply(this.getGraphicContext(),u)}return this._modelViewMatrix=i,!0}}(),applyProjectionMatrix:function(t){if(this._projectionMatrix!==t){this._projectionMatrix=t;var e=this.getLastProgramApplied(),i=this.projectionMatrix,r=e.getUniformsCache()[i.getName()];r&&(i.setMatrix4(t),i.apply(this.getGraphicContext(),r))}},applyStateSet:function(t){this.pushStateSet(t),this.apply(),this.popStateSet()},getStateSetStackHash:function(){for(var t=this.stateSets.values(),e=0,i=0,r=t.length;r>i;i++)e+=t[i].getInstanceID();return e},popAllStateSets:function(){for(;this.stateSets.values().length;)this.popStateSet()},popStateSet:function(){if(!this.stateSets.empty()){var t=this.stateSets.pop();if(t.attributeMap&&this.popAttributeMap(this.attributeMap,t.attributeMap),t.textureAttributeMapList)for(var e=t.textureAttributeMapList,i=0,r=e.length;r>i;i++)e[i]&&this.popAttributeMap(this.textureAttributeMapList[i],e[i]);t.uniforms&&this.popUniformsList(this.uniforms,t.uniforms),t.getShaderGeneratorPair()&&this._shaderGeneratorNames.pop()}},_createAttributeStack:function(t,e,i){var r=new h;return t[e]=r,t[e].globalDefault=i,t.dirty(),r},haveAppliedAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap[e];i||(i=this._createAttributeStack(this.attributeMap,e,t.cloneType())),i.lastApplied=t,i.asChanged=!0},applyAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap,r=i[e];r||(r=this._createAttributeStack(this.attributeMap,e,t.cloneType())),r.lastApplied!==t&&(t.apply&&t.apply(this),r.lastApplied=t,r.asChanged=!0)},applyTextureAttribute:function(t,e){var i=this.getGraphicContext();i.activeTexture(i.TEXTURE0+t);var n=e.getTypeMember();this.textureAttributeMapList[t]||(this.textureAttributeMapList[t]=new r);var a=this.getOrCreateTextureAttributeMap(t),s=a[n];s||(s=this._createAttributeStack(a,n,e.cloneType())),s.lastApplied!==e&&(e.apply&&e.apply(this,t),s.lastApplied=e,s.asChanged=!0)},getLastProgramApplied:function(){return this.attributeMap.Program.lastApplied},applyDefault:function(){this.popAllStateSets(),this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList)},apply:function(){var t=this.getLastProgramApplied();this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList);var e=this._generateAndApplyProgram();e?this._applyGeneratedProgramUniforms(this.attributeMap.Program.lastApplied):this._applyCustomProgramUniforms(this.attributeMap.Program.lastApplied),t!==this.getLastProgramApplied()&&(this._modelViewMatrix=void 0,this._projectionMatrix=void 0)},applyAttributeMap:function(t){for(var e,i=t.getKeys(),r=0,n=i.length;n>r;r++){var a=i[r];if(e=t[a],e&&e.asChanged){var s;s=0===e.values().length?e.globalDefault:e.back().object,e.lastApplied!==s&&(s.apply&&s.apply(this),e.lastApplied=s),e.asChanged=!1}}},getObjectPair:function(t,e){return{object:t,value:e}},pushUniformsList:function(t,e){for(var i,r,n=e.getKeys(),a=0,s=n.length;s>a;a++){var o=n[a],u=e[o];r=u.getUniform(),i=r.getName(),t[i]||this._createAttributeStack(t,i,r),this.pushCheckOverride(t[i],r,u.getValue())}},popUniformsList:function(t,e){for(var i=e.getKeys(),r=0,n=i.length;n>r;r++){var a=i[r];t[a].pop()}},_applyTextureAttributeStack:function(t,e,i){var r;r=0===i.values().length?i.globalDefault:i.back().object,i.lastApplied!==r&&(t.activeTexture(t.TEXTURE0+e),r.apply(this,e),i.lastApplied=r),i.asChanged=!1},applyTextureAttributeMapList:function(t){for(var e,i=this._graphicContext,r=0,n=t.length;n>r;r++)if(e=t[r])for(var a=e.getKeys(),s=0,o=a.length;o>s;s++){var u=a[s],h=e[u];h&&h.asChanged&&this._applyTextureAttributeStack(i,r,h)}},setGlobalDefaultValue:function(t){a.log("setGlobalDefaultValue is deprecated, use instead setGlobalDefaultAttribute"),this.setGlobalDefaultAttribute(t)},setGlobalDefaultAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap;void 0===i[e]?this._createAttributeStack(i,e,t):i[e].globalDefault=t},getGlobalDefaultAttribute:function(t){var e=this.attributeMap;if(void 0!==e[t])return e[t].globalDefault},setGlobalDefaultTextureAttribute:function(t,e){var i=this.getOrCreateTextureAttributeMap(t),r=e.getTypeMember();void 0===i[r]?this._createAttributeStack(i,r,e):i[r].globalDefault=e},getGlobalDefaultTextureAttribute:function(t,e){var i=this.getOrCreateTextureAttributeMap(t),r=i[e];return r.globalDefault},getOrCreateTextureAttributeMap:function(t){return this.textureAttributeMapList[t]||(this.textureAttributeMapList[t]=new r),this.textureAttributeMapList[t]},pushAttributeMap:function(t,e){for(var i,r=e.getKeys(),n=0,a=r.length;a>n;n++){var s=r[n],o=e[s],u=o.getAttribute();void 0===t[s]&&this._createAttributeStack(t,s,u.cloneType()),i=t[s],this.pushCheckOverride(i,u,o.getValue()),i.asChanged=!0}},popAttributeMap:function(t,e){for(var i,r=e.getKeys(),n=0,a=r.length;a>n;n++){var s=r[n];i=t[s],i.pop(),i.asChanged=!0}},setIndexArray:function(t){var e=this._graphicContext;this._currentIndexVBO!==t&&(t.bind(e),this._currentIndexVBO=t),t.isDirty()&&t.compile(e)},lazyDisablingOfVertexAttributes:function(){for(var t=this.vertexAttribMap._keys,e=0,i=t.length;i>e;e++){var r=t[e];this.vertexAttribMap[r]&&(this.vertexAttribMap._disable[r]=!0)}},enableVertexColor:function(){var t=this.attributeMap.Program.lastApplied;if(t.getUniformsCache().ArrayColorEnabled&&t.getAttributesCache().Color){var e=this.uniforms.ArrayColorEnabled.globalDefault,i=this._previousColorAttribPair[t.getInstanceID()];i||(e.setFloat(1),e.apply(this.getGraphicContext(),t.getUniformsCache().ArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!0)}},disableVertexColor:function(){var t=this.attributeMap.Program.lastApplied;if(t.getUniformsCache().ArrayColorEnabled&&t.getAttributesCache().Color){var e=this.uniforms.ArrayColorEnabled.globalDefault,i=this._previousColorAttribPair[t.getInstanceID()];i&&(e.setFloat(0),e.apply(this.getGraphicContext(),t.getUniformsCache().ArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!1)}},applyDisablingOfVertexAttributes:function(){for(var t=this.vertexAttribMap._keys,e=0,i=t.length;i>e;e++)if(this.vertexAttribMap._disable[t[e]]===!0){var r=t[e];this._graphicContext.disableVertexAttribArray(r),this.vertexAttribMap._disable[r]=!1,this.vertexAttribMap[r]=!1}},clearVertexAttribCache:function(){for(var t=this.vertexAttribMap,e=t._keys,i=0,r=e.length;r>i;i++){var n=e[i];t[n]=void 0,t._disable[n]=!1}this.vertexAttribMap._disable.length=0,this.vertexAttribMap._keys.length=0},setVertexArrayObject:function(t){return this._currentVAO!==t?(this._extVAO.bindVertexArrayOES(t),this._currentVAO=t,t||this.clearVertexAttribCache(),this._currentIndexVBO=void 0,!0):!1},setVertexAttribArray:function(t,e,i){var r=this.vertexAttribMap;r._disable[t]=!1;var n=this._graphicContext,a=!1;e.isDirty()&&(e.bind(n),e.compile(n),a=!0);var s=r[t];s!==e&&(a||e.bind(n),s||(n.enableVertexAttribArray(t),void 0===s&&r._keys.push(t)),r[t]=e,n.vertexAttribPointer(t,e.getItemSize(),e.getType(),i,0,0))},_getActiveUniformsFromProgramAttributes:function(t,e){var i=this.attributeMap,r=t.getTrackAttributes().attributeKeys;if(r.length>0)for(var n=0,a=r.length;a>n;n++){var s=r[n],o=i[s];if(void 0!==o){var u=o.globalDefault;if(void 0!==u.getOrCreateUniforms)for(var h=u.getOrCreateUniforms(),l=h.getKeys(),c=0,d=l.length;d>c;c++)e.push(h[l[c]])}}},_getActiveUniformsFromProgramTextureAttributes:function(t,e){var i=t.getTrackAttributes().textureAttributeKeys;if(void 0!==i)for(var r=0,n=i.length;n>r;r++){var a=i[r];if(void 0!==a){var s=this.textureAttributeMapList[r];if(void 0!==s)for(var o=0,u=a.length;u>o;o++){var h=a[o],l=s[h];if(void 0!==l){var c=l.globalDefault;if(void 0!==c.getOrCreateUniforms)for(var d=c.getOrCreateUniforms(),p=d.getKeys(),f=0,g=p.length;g>f;f++)e.push(d[p[f]])}}}}},_cacheUniformsForCustomProgram:function(t,e){this._getActiveUniformsFromProgramAttributes(t,e),this._getActiveUniformsFromProgramTextureAttributes(t,e);for(var i=this._graphicContext,n=new r,a=0,s=e.length;s>a;a++){var o=e[a],u=o.getName(),h=i.getUniformLocation(t._program,u);void 0!==h&&null!==h&&(n[u]=o)}n.dirty(),t.trackUniforms=n},_applyCustomProgramUniforms:function(){var t=[];return function(e){t.length=0,void 0!==e.getTrackAttributes()&&void 0===e.trackUniforms&&this._cacheUniformsForCustomProgram(e,t);var i,r=e.getUniformsCache(),n=r.getKeys(),a=this.uniforms;e.trackUniforms&&(i=e.trackUniforms);for(var s,o=0,u=n.length;u>o;o++){var h=n[o],l=r[h],c=a[h];void 0===c?void 0!==i&&(s=i[h],void 0!==s&&s.apply(this._graphicContext,l)):(s=0===c.values().length?c.globalDefault:c.back().object,s.apply(this._graphicContext,l))}}}(),_generateAndApplyProgram:function(){var t=this.attributeMap;if(void 0===t.Program||0===t.Program.values().length||t.Program.back().value===u.OFF){var e=this._shaderGeneratorNames.back(),i=this._shaderGeneratorProxy.getShaderGenerator(e?e.object:void 0),r=i.getOrCreateProgram(this);return this.applyAttribute(r),r}},_computeForeignUniforms:function(t,e){for(var i=t.getKeys(),r=t,n=[],a=0,s=i.length;s>a;a++){var o=i[a],u=r[o];void 0!==u&&void 0===e[o]&&o!==this.modelViewMatrix.getName()&&o!==this.modelWorldMatrix.getName()&&o!==this.viewMatrix.getName()&&o!==this.projectionMatrix.getName()&&o!==this.normalMatrix.getName()&&"ArrayColorEnabled"!==o&&n.push(o)}return n},_removeUniformsNotRequiredByProgram:function(t,e){for(var i=t.getKeys(),r=0,n=i.length;n>r;r++){var a=i[r],s=e[a];(void 0===s||null===s)&&(delete t[a],t.dirty())}},_cacheUniformsForGeneratedProgram:function(t){var e=this._computeForeignUniforms(t.getUniformsCache(),t.getActiveUniforms());t.setForeignUniforms(e),this._removeUniformsNotRequiredByProgram(t.getActiveUniforms(),t.getUniformsCache())},_copyUniformEntry:function(t){var e,i=t.getInternalArray();return i.length<16&&(e=new i.constructor(i.length)),e},_initUniformCache:function(t){var e,i,r,n,a,s,o=t.getActiveUniforms(),u=o.getKeys(),h=t.getForeignUniforms(),l=this.uniforms,c=[],d=[];if(t._cacheUniformId=this._cacheUniformId++,this._programUniformCache[t._cacheUniformId]={},h.length)for(r=c,e=0,i=h.length;i>e;e++){n=h[e];var p=l[n];p&&(s=p.globalDefault,a=this._copyUniformEntry(s),r.push(a))}if(u.length)for(r=d,e=0,i=u.length;i>e;e++)n=u[e],s=o[n],a=this._copyUniformEntry(s),r.push(a);this._programUniformCache[t._cacheUniformId].foreign=c,this._programUniformCache[t._cacheUniformId].active=d},_checkCacheAndApplyUniform:function(t,e,i,r,n){var a,s=t.getInternalArray(),o=s.length;if(4>=o){var u=e[i];a=p[o](s,u)}else a=!1;if(!a){var h=r[n];t.apply(this._graphicContext,h)}},_applyGeneratedProgramUniforms:function(t){var e=t.getForeignUniforms();e||(this._cacheUniformsForGeneratedProgram(t),e=t.getForeignUniforms(),this._initUniformCache(t));var i,r,n,s,o=t.getUniformsCache(),u=t.getActiveUniforms(),h=this._programUniformCache[t._cacheUniformId].active,l=this._programUniformCache[t._cacheUniformId].foreign,c=u.getKeys();for(this.nbApplyUniform+=c.length,i=0,r=c.length;r>i;i++)n=c[i],s=u[n],this._checkCacheAndApplyUniform(s,h,i,o,n);var d=this.uniforms;for(i=0,r=e.length;r>i;i++){n=e[i];var p=d[n];void 0!==p&&(0===p.values().length?(s=p.globalDefault,a.warn("Uniform Default Not attached to a StateSet in Scene Hierarchy: "+p.globalDefault.getName())):s=p.back().object),this._checkCacheAndApplyUniform(s,l,i,o,n)}}}),"osg","State"),t.exports=f},function(t,e,i){"use strict";var r=i(1105),n=i(1135),a=i(1109),s=i(1133),o=function(){s.call(this),this._images={};for(var t=0;6>t;t++)this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X+t]=new n};o.prototype=r.objectLibraryClass(r.objectInherit(s.prototype,{setDefaultParameters:function(){s.prototype.setDefaultParameters.call(this),this._textureTarget=s.TEXTURE_CUBE_MAP,this._flipY=!1},cloneType:function(){return new o},setImage:function(t,e,i){var r=t;"string"==typeof r&&(r=s[r]),this._images[r].setImage(e,i),this.setImageFormat(i),this.setTextureSize(this._images[r].getWidth(),this._images[r].getHeight()),this._textureNull=!1,this.dirty()},getImage:function(t){return this._images[t].getImage()},initCubemapContent:function(t){var e=this._internalFormat;return this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),!0},generateMipmap:function(t,e){if(this.hasMipmapFilter()){if(this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())for(var i=0;6>i;i++){var r=this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X+i];r.hasMipmap()||a.error("mipmap not set correctly for TextureCubemap");for(var n=this._internalFormat,o=1;o<r.getMipmap().length;o++){var u=r.getMipmap()[o].getWidth();this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,o,n,u,u,0,n,this._type,r.getMipmap()[o].getImage())}}else t.generateMipmap(e);this._dirtyMipmap=!1}},applyImageTarget:function(t,e,i){var r=this._images[i];return r.getImage()&&r.isReady()?r.isDirty()?(this.setTextureSize(r.getWidth(),r.getHeight()),r.setDirty(!1),r.isTypedArray()?this.applyTexImage2D(t,i,0,e,this._textureWidth,this._textureHeight,0,e,this._type,r.getImage()):this.applyTexImage2D(t,i,0,e,e,this._type,r.getImage()),!this._unrefImageDataAfterApply||this.hasMipmap()&&r.hasMipmap()||r.release(),1):1:0},initCubemapContentImage:function(t){var e=this._internalFormat,i=0;return i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Z),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Z),6===i?!0:!1},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&this.releaseGLObjects(),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{this._textureObject||(this.computeTextureFormat(),this.init(t)),this._textureObject.bind(e);var i;i=this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()?this.initCubemapContentImage(e):this.initCubemapContent(e),i&&(this._dirty=!1,this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget))}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget)}}),"osg","TextureCubeMap"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=function(){n.call(this),this.visitorType=n.UPDATE_VISITOR,this._numUpdateCallback=0};a.prototype=r.objectInherit(n.prototype,{resetStats:function(){this._numUpdateCallback=0},apply:function(t){var e=t.getStateSet();if(e&&e.requiresUpdateTraversal()){var i=e.getUpdateCallbackList(),r=i.length;if(r){this._numUpdateCallback+=r;for(var n=0,a=r;a>n;n++)i[n].update(e,this)}}for(var s=t.getUpdateCallbackList(),o=s.length,u=0;o>u;u++)if(this._numUpdateCallback++,!s[u].update(t,this))return;t.getNumChildrenRequiringUpdateTraversal()>0&&this.traverse(t)}}),t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=i(1122),s=function(t,e,i,r){n.call(this),this._x=void 0!==t?t:0,this._y=void 0!==e?e:0,this._width=void 0!==i?i:800,this._height=void 0!==r?r:600};s.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Viewport",cloneType:function(){return new s},apply:function(t){var e=t.getGraphicContext();e.viewport(this._x,this._y,this._width,this._height)},setViewport:function(t,e,i,r){this._x=t,this._y=e,this._width=i,this._height=r},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var t=a.create(),e=a.create();return function(i){a.makeTranslate(1,1,1,t),a.makeScale(.5*this._width,.5*this._height,.5,e);var r=a.makeTranslate(this._x,this._y,0,i);return a.preMult(r,a.preMult(e,t))}}()}),"osg","Viewport"),t.exports=s},function(t,e,i){"use strict";var r=i(1109),n=function(t){if(this._enabled=!1,t){var e=t.getExtension("EXT_disjoint_timer_query");if(!e)return this;if(this._hasTimeElapsed=e.getQueryEXT(e.TIME_ELAPSED_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,this._hasTimeStamp=e.getQueryEXT(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,!this._hasTimeElapsed&&!this._hasTimeStamp)return this;this._hasTimeStamp||r.debug("Warning: do not use interleaved GPU query"),this._gl=t,this._glTimer=e,this._enabled=!0}return this._pollingStartQueries={},this._pollingEndQueries={},this._runningQueries={},this._timingCountQuery={},this._resultCountQuery={},this._averageTimerQuery={},this._waitingQueries={},this._frameAverageCount=30,this};n.instance=function(t){return n._instance?t&&n._instance.getContext()!==t&&n._instance.setContext(t):n._instance=new n(t),n._instance},n.prototype={getContext:function(){return this._gl},setContext:function(t){this._gl=t},setFrameAverageCount:function(t){this._frameAverageCount=t},reset:function(t){this._timingCountQuery[t]=0,this._averageTimerQuery[t]=0,this._resultCountQuery[t]=0},supportInterleaveQuery:function(){return this._hasTimeStamp},enable:function(){this._enabled=this._glTimer},disable:function(){this._enabled=!1},isEnabled:function(){return this._enabled},setCallback:function(t){this._callback=t},start:function(t){if(this._enabled){this._timingCountQuery[t]?this.pollQueriesData(t):(this._resultCountQuery[t]=0,this._timingCountQuery[t]=0,this._averageTimerQuery[t]=0,this._pollingStartQueries[t]={},this._pollingEndQueries[t]={},this._waitingQueries[t]=[]);var e=this._timingCountQuery[t],i=this._glTimer.createQueryEXT();
if(this._pollingStartQueries[t][e]=i,this._hasTimeStamp){var r=this._glTimer.createQueryEXT();this._pollingEndQueries[t][e]=r,this._glTimer.queryCounterEXT(i,this._glTimer.TIMESTAMP_EXT)}else this._glTimer.beginQueryEXT(this._glTimer.TIME_ELAPSED_EXT,i);return this._runningQueries[t]=i,i}},end:function(t){if(this._enabled){var e=this._runningQueries[t];if(e){var i=this._timingCountQuery[t];if(this._hasTimeStamp){var r=this._pollingEndQueries[t][i];this._glTimer.queryCounterEXT(r,this._glTimer.TIMESTAMP_EXT)}else this._glTimer.endQueryEXT(this._glTimer.TIME_ELAPSED_EXT);this._runningQueries[t]=void 0,this._timingCountQuery[t]++,this._waitingQueries[t].push(i)}}},pollQueryData:function(t,e){var i=this._hasTimeStamp?this._pollingEndQueries[t][e]:this._pollingStartQueries[t][e],r=this._glTimer.getQueryObjectEXT(i,this._glTimer.QUERY_RESULT_AVAILABLE_EXT);if(!r)return null;var n=this._gl.getParameter(this._glTimer.GPU_DISJOINT_EXT);if(n)return null;var a;if(this._hasTimeStamp){var s=this._pollingStartQueries[t][e],o=this._glTimer.getQueryObjectEXT(s,this._glTimer.QUERY_RESULT_EXT),u=this._glTimer.getQueryObjectEXT(i,this._glTimer.QUERY_RESULT_EXT);a=u-o,this._glTimer.deleteQueryEXT(i),this._pollingEndQueries[t][e]=void 0,this._glTimer.deleteQueryEXT(s),this._pollingStartQueries[t][e]=void 0}else a=this._glTimer.getQueryObjectEXT(i,this._glTimer.QUERY_RESULT_EXT),this._glTimer.deleteQueryEXT(i),this._pollingStartQueries[t][e]=void 0;if(0!==a){this._resultCountQuery[t]++;var h=this._averageTimerQuery[t],l=this._resultCountQuery[t];l>this._frameAverageCount&&(this.reset(t),this._resultCountQuery[t]++,h=0);var c;return c=0===h?a:h+(a-h)/l,this._averageTimerQuery[t]=c,c}},pollQueriesData:function(t){var e,i=this,r=this._waitingQueries[t];r=r.filter(function(r){var n=i.pollQueryData(t,r);return null===n?!0:void 0===n?!1:(e=n,!1)}),this._waitingQueries[t]=r,void 0!==e&&this._callback&&this._callback(e,t)}},t.exports=n},function(t,e,i){"use strict";var r=i(1105),n=i(1208),a=i(1182),s=i(1175),o=i(1212),u=i(1172),h=i(1209),l=i(1214),c=i(1216),d=i(1213),p=i(1178),f=i(1177),g=i(1176),m=i(1170),v=i(1217),_=i(1218),b=i(1219),x=i(1220),A=i(1221),y=i(1173),S=i(1174),C=i(1215),w=i(1171),T={};r.objectMix(T,c),r.objectMix(T,d),T.Animation=n,T.SkinningAttribute=a,T.AnimationUpdateCallback=s,T.BasicAnimationManager=o,T.Bone=u,T.Channel=h,T.CollectAnimationUpdateCallbackVisitor=l,T.MorphAttribute=p,T.MorphGeometry=f,T.RigGeometry=g,T.Skeleton=m,T.StackedMatrix=v,T.StackedQuaternion=_,T.StackedRotateAxis=b,T.StackedScale=x,T.StackedTranslate=A,T.UpdateBone=y,T.UpdateMatrixTransform=S,T.UpdateMorph=C,T.UpdateSkeleton=w,t.exports=T},function(t,e,i){"use strict";var r=i(1209),n=0,a=function(t,e){for(var i=1/0,r=-(1/0),a=0;a<t.length;a++)i=Math.min(i,t[a].start),r=Math.max(r,t[a].end);var s=r-i,o=e||"animation"+n.toString();return n++,{channels:t,duration:s,name:o,start:i}},s=function(t){for(var e=[],i=0;i<t.channels.length;i++){var n=r.createInstanceChannel(t.channels[i]);e.push(n)}return{channels:e,duration:t.duration,start:0,name:t.name,firstKeyTime:t.start}},o=function(){};o.createAnimation=a,o.createInstanceAnimation=s,t.exports=o},function(t,e,i){"use strict";var r=i(1114),n=i(1125),a=i(1210),s=i(1211),o={},u=function(t,e,i,r,n,a){var s=i[0],o=i[i.length-1];return a.start=s,a.keys=e,a.end=o,a.times=i,a.type=t,a.duration=o-s,a.target=r,a.name=n,a},h=function(t,e,i,r,n){return u(s.Vec3,t,e,i,r,n||{})},l=function(t,e,i,r,n){return u(s.Float,t,e,i,r,n||{})},c=function(t,e,i,r,n){return u(s.Quat,t,e,i,r,n||{})},d=function(t,e,i,r,n){return u(s.QuatSlerp,t,e,i,r,n||{})},p=function(t,e,i,r,n){return u(s.FloatCubicBezier,t,e,i,r,n||{})},f=function(t,e,i,r,n){return u(s.Vec3CubicBezier,t,e,i,r,n||{})},g={create:function(){return 0}},m=function(t,e){return{channel:e,value:t.create(),targetID:a.InvalidTargetID,weight:1,key:0,start:0,end:0}},v=function(t){return m(r,t)},_=function(t){return m(n,t)},b=function(t){return m(g,t)},x=function(t){return m(g,t)},A=function(t){return m(r,t)},y=function(t){return o[t.type](t)};o.createInstanceChannel=y,o.createInstanceVec3Channel=v,o.createInstanceQuatChannel=_,o.createInstanceQuatSlerpChannel=_,o.createInstanceFloatChannel=b,o.createInstanceFloatCubicBezierChannel=x,o.createInstanceVec3CubicBezierChannel=A,o.createVec3Channel=h,o.createQuatChannel=c,o.createQuatSlerpChannel=d,o.createFloatChannel=l,o.createFloatCubicBezierChannel=p,o.createVec3CubicBezierChannel=f,o[s.Vec3]=v,o[s.Quat]=_,o[s.QuatSlerp]=_,o[s.Float]=b,o[s.FloatCubicBezier]=x,o[s.Vec3CubicBezier]=A,o.ChannelType=s,t.exports=o},function(t,e,i){"use strict";var r=i(1122),n=i(1125),a=i(1114),s=i(1211),o={};o.InvalidTargetID=-1;var u=function(t,e,i){return{type:t,id:o.InvalidTargetID,channels:[],value:e,defaultValue:i}},h=function(t){return u(s.Quat,n.copy(t,n.create()),n.copy(t,n.create()))},l=function(t){return u(s.Matrix,r.copy(t,r.create()),r.copy(t,r.create()))},c=function(t){return u(s.Vec3,a.copy(t,a.create()),a.copy(t,a.create()))},d=function(t){return u(s.Float,t,t)};o.createQuatTarget=h,o.createVec3Target=c,o.createFloatTarget=d,o.createMatrixTarget=l,t.exports=o},function(t,e){"use strict";t.exports={Vec3:0,Quat:1,Float:2,FloatCubicBezier:3,Vec3CubicBezier:4,QuatSlerp:5,Matrix:6,Count:7}},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1112),s=i(1125),o=i(1114),u=i(1122),h=i(1209),l=i(1208),c=i(1213),d=i(1214),p=i(1210),f=i(1215),g={lerp:function(t,e,i){return e+(i-e)*t},init:function(){return 0},copy:function(t){return t},create:function(){return 0}},m=[];m[h.ChannelType.Float]=1,m[h.ChannelType.FloatCubicBezier]=1,m[h.ChannelType.Vec3]=3,m[h.ChannelType.Vec3CubicBezier]=3,m[h.ChannelType.Quat]=4,m[h.ChannelType.QuatSlerp]=4,m[h.ChannelType.Matrix]=16;var v=[];v.length=h.ChannelType.Count,v[h.ChannelType.Vec3]=o,v[h.ChannelType.Quat]=s,v[h.ChannelType.QuatSlerp]=s,v[h.ChannelType.Float]=g,v[h.ChannelType.FloatCubicBezier]=g,v[h.ChannelType.Vec3CubicBezier]=o,v[h.ChannelType.Matrix]=u;var _=function(){a.call(this),this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._targets=[],this._targetsMap={},this._targetsByTypes=[],this._targetsByTypes.length=h.ChannelType.Count;for(var t=0,e=this._targetsByTypes.length;e>t;t++)this._targetsByTypes[t]=[];this._activeAnimations={},this._activeAnimationList=[],this._activeChannelsByTypes=[],this._activeChannelsByTypes.length=h.ChannelType.Count;for(var i=0,r=this._activeChannelsByTypes.length;r>i;i++)this._activeChannelsByTypes[i]=[];this._animationsUpdateCallback={},this._animationsUpdateCallbackArray=[],this._animationsToRegister=[],this._pause=!1,this._dirty=!1,this._seekTime=-1};_.prototype=n.objectInherit(a.prototype,{init:function(t){this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._resetTargets(),this._activeAnimations={},this._activeAnimationList.length=0;for(var e=0,i=this._activeChannelsByTypes.length;i>e;e++)this._activeChannelsByTypes[e].length=0;this._animationsUpdateCallback={},this._animationsUpdateCallbackArray.length=0,this._pause=!1,this._seekTime=-1,this.addAnimations(t)},addAnimations:function(t){var e=this._addAnimation(t);Array.prototype.push.apply(this._animationsToRegister,e),this._dirty=!0,this._registerAnimations()},update:function(t,e){this._dirty&&(this._findAnimationUpdateCallback(t),this._registerTargetFoundInAnimationCallback(),this._registerAnimations());var i=e.getFrameStamp().getSimulationTime();return-1!==this._seekTime&&(this._pauseTime=-this._seekTime+this._startTime+i),this._seekTime=-1,this._pause?this._pauseTime=i-this._simulationTime+this._startTime:this._simulationTime=this._startTime+(i-this._pauseTime),this.updateManager(this._simulationTime*this._timeFactor),!0},updateManager:function(t){this._processStartAnimation(t);for(var e=h.ChannelType.Count,i=0;e>i;i++){var r=this._activeChannelsByTypes[i];this._updateChannelsType(t,r,c[i])}for(var n=0;e>n;n++){var a=this._targetsByTypes[n];this._updateTargetType(a,v[n])}for(var s=0,o=this._animationsUpdateCallbackArray.length;o>s;s++){var u=this._animationsUpdateCallbackArray[s];u.computeChannels()}this._removeFinishedAnimation(t)},togglePause:function(){this._pause=!this._pause,this._pause||(this._seekTime=this._simulationTime)},getSimulationTime:function(){return this._simulationTime},setSimulationTime:function(t){this._simulationTime=t},setSeekTime:function(t){this._simulationTime=t,this._seekTime=t},stopAnimation:function(t){for(var e=this._activeAnimationList,i=0,r=e.length;r>i;++i)if(e[i].name===t)return this._removeActiveChannels(this._instanceAnimations[t]),this._activeAnimations[t]=void 0,void e.splice(i,1)},stopAllAnimation:function(){for(var t=this._activeAnimationList,e=0,i=t.length;i>e;++e){var r=t[e].name;this._removeActiveChannels(this._instanceAnimations[r]),this._activeAnimations[r]=void 0}t.length=0},setTimeFactor:function(t){var e=t/this._timeFactor;this._startTime+=(this._simulationTime-this._simulationTime*e)/e,this._timeFactor=t,this._pause&&(this._simulationTime+=(this._simulationTime-this._simulationTime*e)/e)},getTimeFactor:function(){return this._timeFactor},isPlaying:function(t){return this._activeAnimations[t]?!0:!1},playAnimationObject:function(t){var e=this._instanceAnimations[t.name];return e?void(this.isPlaying(t.name)||(e.priority=void 0===t.priority?0:t.priority,e.weight=void 0===t.weight?1:t.weight,e.loop=void 0===t.loop?!0:t.loop,this._startAnimations[e.name]=e)):void r.info("no animation "+t.name+" found")},playAnimation:function(t,e,i,r){var n;return n="object"==typeof t?t:{name:t,priority:i,weight:r,loop:e},this.playAnimationObject(n)},getAnimations:function(){return this._instanceAnimations},_registerAnimations:function(){if(this._targets.length){for(var t=0,e=this._animationsToRegister.length;e>t;t++){var i=this._animationsToRegister[t];this._registerInstanceAnimation(i)}this._animationsToRegister.length=0,this._dirty=!1}},_registerInstanceAnimation:function(t){for(var e=t.channels,i=0,n=e.length;n>i;i++){var a=e[i],s=a.channel.target,o=a.channel.name,u=s+"."+o;this._targetMap[u]?a.targetID=this._targetMap[u].id:r.warn("registerInstanceAnimation did not find targetName ("+u+") in the scene graph")}return!0},_findAnimationUpdateCallback:function(t){var e=new d;t.accept(e),this._animationsUpdateCallback=e.getAnimationUpdateCallbackMap()},_registerTargetFoundInAnimationCallback:function(){this._resetTargets();for(var t,e,i,n=0,a=this._targetMap,s=this._targets,o=function(t,e,i){if(a[t])e!==a[t]&&r.warn("detected differents target instance with the same name ("+i+")");else{a[t]=e,e.id=n++,s.push(e);var o=e.type;this._targetsByTypes[o].push(e)}}.bind(this),u=this._animationsUpdateCallback,h=window.Object.keys(u),l=0,c=h.length;c>l;l++){var d=h[l],p=u[d];if(p.getStackedTransforms&&p.getStackedTransforms().length){this._animationsUpdateCallbackArray.push(p);for(var g=p.getStackedTransforms(),m=0,v=g.length;v>m;m++){var _=g[m];t=_.getTarget(),e=_.getName(),i=p.getName()+"."+e,o(i,t,e)}}else if(p instanceof f)for(var b=0,x=p.getNumTarget();x>b;b++)e=p.getTargetName(b),i=e+"."+b,t=p.getTarget(b),o(i,t,e)}},_addAnimation:function(t){for(var e=[],i=0,r=t.length;r>i;i++){var n=t[i],a=n.name;if(!this._instanceAnimations[a]){var s=l.createInstanceAnimation(n);this._instanceAnimations[a]=s,e.push(s)}}return e},_addActiveChannels:function(t,e){for(var i=e.channels,r=0,n=i.length;n>r;r++){var a=i[r],s=a.channel.type;a.t=t,a.instanceAnimation=e;var o=a.targetID;o!==p.InvalidTargetID&&(this._activeChannelsByTypes[s].push(a),this._targets[o].channels.push(a))}},_removeActiveChannels:function(t){for(var e=t.channels,i=0,r=e.length;r>i;i++){var n=e[i],a=n.channel.type,s=n.targetID;if(s!==p.InvalidTargetID){var o=this._targets[s].channels,u=o.indexOf(n);o.splice(u,1);var h=this._activeChannelsByTypes[a],l=h.indexOf(n);h.splice(l,1)}}},_updateTargetType:function(t,e){for(var i=0,r=t.length;r>i;i++){var n=t[i],a=n.channels,s=a.length;if(0===s)n.value=e.copy(n.defaultValue,n.value);else if(1===s)n.value=e.copy(a[0].value,n.value);else{n.value=e.init(n.value);for(var o=0,u=0,h=a.length;h>u;u++){var l=a[u],c=l.weight;if(o+=c,0!==o&&0!==c){var d=c/o;n.value=e.lerp(d,n.value,l.value,n.value)}}}}},_updateChannelsType:function(t,e,i){for(var r=0,n=e.length;n>r;r++){var a=e[r],s=a.instanceAnimation,o=s.loop,u=t-a.t;o&&s.duration>0&&(u%=s.duration),i(u+s.firstKeyTime,a)}},_removeFinishedAnimation:function(t){for(var e=this._activeAnimationList,i=0;i<e.length;){var r=e[i],n=r.name;t>r.end&&r.loop===!1?(this._removeActiveChannels(r),this._activeAnimations[n]=void 0,e.splice(i,1)):i++}},_addActiveAnimation:function(t,e){this._activeAnimations[e.name]=e;var i=this._instanceAnimations[e.name];i.start=t,i.end=t+i.duration,this._addActiveChannels(t,i),this._activeAnimationList.push(i)},_processStartAnimation:function(t){if(this._targets.length){for(var e=this._startAnimations,i=window.Object.keys(e),r=0,n=i.length;n>r;r++){var a=i[r],s=e[a],o=s.name;this.isPlaying(o)||this._addActiveAnimation(t,s)}i.length&&(this._startAnimations={})}},_resetTargets:function(){this._targetMap={},this._targets.length=0;for(var t=0,e=this._targetsByTypes.length;e>t;t++)this._targetsByTypes[t].length=0},setAnimationLerpEndStart:function(t,e){var i=t.channels;void 0===t.originalDuration&&(t.originalDuration=t.duration),t.duration=t.originalDuration+e;for(var r=t.firstKeyTime,n=t.originalDuration,a=0,s=i.length;s>a;++a){var o=i[a].channel;if(!(Math.abs(o.start-r)>.01||Math.abs(o.duration-n)>.01)){void 0===o.originalEnd&&(o.originalEnd=o.end),o.end=o.originalEnd+e;var u=m[o.type],h=o.times.buffer.byteLength/4;if(0===e)o.keys=new Float32Array(o.keys.buffer,0,(h-1)*u),o.times=new Float32Array(o.times.buffer,0,h-1);else{o.keys=new Float32Array(o.keys.buffer,0,h*u);for(var l=(h-1)*u,c=0;u>c;++c)o.keys[l+c]=o.keys[c];o.times=new Float32Array(o.times.buffer,0,h),o.times[h-1]=o.times[h-2]+e}}}}}),_.TypeToSize=m,t.exports=_},function(t,e,i){"use strict";var r=i(1114),n=i(1125),a=i(1209),s=function(t,e,i){i[0]=e[t++],i[1]=e[t++],i[2]=e[t++]},o=function(t,e,i){i[0]=e[t++],i[1]=e[t++],i[2]=e[t++],i[3]=e[t++]},u=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,o=i.keys,u=i.times;if(t>=a)return e.key=0,void s(o.length-3,o,r);if(n>=t)return e.key=0,void s(0,o,r);var h=e.key;if(t>u[h])for(;u[h+1]<t;)h++;else if(t<u[h])for(;u[h]>t;)h--;var l=u[h],c=u[h+1],d=3*h,p=o[d++],f=o[d++],g=o[d++],m=o[d++],v=o[d++],_=o[d++],b=(t-l)/(c-l);r[0]=p+(m-p)*b,r[1]=f+(v-f)*b,r[2]=g+(_-g)*b,e.key=h},h=function(){var t=n.create(),e=n.create();return function(i,r){var a=r.channel,s=r.value,u=a.start,h=a.end,l=a.keys,c=a.times;if(i>=h)return r.key=0,void o(l.length-4,l,s);if(u>=i)return r.key=0,void o(0,l,s);var d=r.key;if(i>c[d])for(;c[d+1]<i;)d++;else if(i<c[d])for(;c[d]>i;)d--;var p=c[d],f=c[d+1],g=4*d;t[0]=l[g++],t[1]=l[g++],t[2]=l[g++],t[3]=l[g++],e[0]=l[g++],e[1]=l[g++],e[2]=l[g++],e[3]=l[g++];var m=(i-p)/(f-p);n.nlerp(m,t,e,s),r.key=d}}(),l=function(){var t=n.create(),e=n.create();return function(i,r){var a=r.channel,s=r.value,u=a.start,h=a.end,l=a.keys,c=a.times;if(i>=h)return r.key=0,void o(l.length-4,l,s);if(u>=i)return r.key=0,void o(0,l,s);var d=r.key;if(i>c[d])for(;c[d+1]<i;)d++;else if(i<c[d])for(;c[d]>i;)d--;var p=c[d],f=c[d+1],g=4*d;t[0]=l[g++],t[1]=l[g++],t[2]=l[g++],t[3]=l[g++],e[0]=l[g++],e[1]=l[g++],e[2]=l[g++],e[3]=l[g++];var m=(i-p)/(f-p);n.slerp(m,t,e,s),r.key=d}}(),c=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,s=i.keys,o=i.times;if(t>=a)return e.key=0,void(e.value=s[s.length-1]);if(n>=t)return e.key=0,void(e.value=s[0]);var u=e.key;if(t>o[u])for(;o[u+1]<t;)u++;else if(t<o[u])for(;o[u]>t;)u--;var h=o[u],l=o[u+1],c=u,d=s[c++],p=s[c++],f=(t-h)/(l-h);r=d+(p-d)*f,e.key=u,e.value=r},d=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,s=i.keys,o=i.times;if(t>=a)return e.key=0,void(e.value=s[s.length-3]);if(n>=t)return e.key=0,void(e.value=s[0]);var u=e.key;if(t>o[u])for(;o[u+1]<t;)u++;else if(t<o[u])for(;o[u]>t;)u--;var h=(t-o[u])/(o[u+1]-o[u]),l=1-h,c=l*l,d=c*l,p=h*h,f=3*u,g=s[f]*d,m=s[f+1]*(3*h*c),v=s[f+2]*(3*p*l),_=s[f+3]*(p*h);r=g+m+v+_,e.key=u,e.value=r},p=function(){var t=r.create(),e=r.create(),i=r.create(),n=r.create();return function(a,o){var u=o.channel,h=o.value,l=u.start,c=u.end,d=u.keys,p=u.times;if(a>=c)return o.key=0,void s(d.length-9,d,h);if(l>=a)return o.key=0,void s(0,d,h);var f=o.key;if(a>p[f])for(;p[f+1]<a;)f++;else if(a<p[f])for(;p[f]>a;)f--;var g=(a-p[f])/(p[f+1]-p[f]),m=1-g,v=m*m,_=v*m,b=g*g,x=9*f;r.mult(r.set(d[x++],d[x++],d[x++],t),_,t),r.mult(r.set(d[x++],d[x++],d[x++],e),3*g*v,e),r.mult(r.set(d[x++],d[x++],d[x++],i),3*b*m,i),r.mult(r.set(d[x++],d[x++],d[x++],n),b*g,n),h[0]=t[0]+e[0]+i[0]+n[0],h[1]=t[1]+e[1]+i[1]+n[1],h[2]=t[2]+e[2]+i[2]+n[2],o.key=f}}(),f=a.ChannelType,g={};g[f.Vec3]=u,g[f.Quat]=h,g[f.QuatSlerp]=l,g[f.Float]=c,g[f.FloatCubicBezier]=d,g[f.Vec3CubicBezier]=p,g.Vec3LerpInterpolator=u,g.QuatLerpInterpolator=h,g.QuatSlerpInterpolator=l,g.FloatLerpInterpolator=c,g.FloatCubicBezierInterpolator=d,g.Vec3CubicBezierInterpolator=p,t.exports=g},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=i(1175),s=function(){n.call(this),this._animationUpdateCallback={}};s.prototype=r.objectInherit(n.prototype,{getAnimationUpdateCallbackMap:function(){return this._animationUpdateCallback},apply:function(t){for(var e=t.getUpdateCallbackList(),i=0,r=e.length;r>i;i++){var n=e[i];n instanceof a&&(this._animationUpdateCallback[n.getInstanceID()]=n)}this.traverse(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1105),n=i(1139),a=i(1176),s=i(1175),o=i(1210),u=i(1177),h=function(){s.call(this),this._isInitialized=!1,this._targets=[],this._targetNames=[],this._morphs=[],this._weights=new Float32Array(4),this._indexMap=[0,0,0,0],this._gpuMorphed=[]},l=u.EFFECTIVE_EPS,c=function(t,e){return Math.abs(e.value)-Math.abs(t.value)};h.prototype=r.objectInherit(s.prototype,{init:function(t){for(var e=t.getChildren(),i=0,r=e.length;r>i;i++){var n,s=e[i];s instanceof u?n=s:s instanceof a&&s.getSourceGeometry()instanceof u&&(n=s.getSourceGeometry()),n&&n.getName()===this.getName()&&(n.isInitialized()||n.init(),this._morphs.push(n),this._isInitialized=!0)}},isInitialized:function(){return this._isInitialized},getNumTarget:function(){return this._targets.length},getTarget:function(t){return this._targets[t]},getTargetName:function(t){return this._targetNames[t]},addTarget:function(t,e){this._targets[e]=o.createFloatTarget(0),this._targetNames[e]=t},_remapBufferArrays:function(){for(var t=this._indexMap,e=this._morphs,i=0;4>i;++i)for(var r=t[i],n="_"+i,a="_"+r,s=0,o=e.length;o>s;++s)for(var u=e[s],h=u.getVertexAttributeList(),l=u.getMorphTargetNames(),c=0,d=l.length;d>c;++c){var p=l[c];h[p+n].setBufferArray(h[p+a].getInitialBufferArray())}},_mergeExtraMorphTarget:function(t,e,i){var r=0,a=this._gpuMorphed,s=t[e],o=s.getElements().length,u=o/s.getItemSize(),h=s.getItemSize();s._cpuMorph=s._cpuMorph||new n(n.ARRAY_BUFFER,new Float32Array(o),h);var c=s._cpuMorph.getElements();for(r=0;o>r;++r)c[r]=0;for(var d=this._targets,p=0,f=d.length;f>p;++p)if(a[p]!==!0){var g=d[p].value;if(!(Math.abs(g)<l)){g/=i;var m=t[e+"_"+p].getInitialBufferArray().getElements();for(r=0;u>r;++r){var v=r*h;c[v]+=g*m[v],c[v+1]+=g*m[v+1],c[v+2]+=g*m[v+2]}}}t[e+"_3"].setBufferArray(s._cpuMorph),s._cpuMorph.dirty()},_computeExtraWeightsSum:function(){for(var t=this._gpuMorphed,e=0,i=this._targets,r=0,n=i.length;n>r;++r)if(t[r]!==!0){var a=i[r].value;Math.abs(a)<l||(e+=a)}var s=1e-5;return Math.abs(e)>s?e:0>e?-s:s},_morphBufferArrayCPU:function(){for(var t=this._weights[3]=this._computeExtraWeightsSum(),e={},i=this._morphs,r=0,n=i.length;n>r;++r)for(var a=i[r],s=a.getVertexAttributeList(),o=a.getMorphTargetNames(),u=0,h=o.length;h>u;++u){var l=o[u],c=s[l];c&&!e[c.getInstanceID()]&&(e[c.getInstanceID()]=!0,this._mergeExtraMorphTarget(s,l,t))}},updateWeights:function(){var t=0,e=this._targets,i=e.length,r=this._weights;if(r[0]=r[1]=r[2]=r[3]=0,4>=i)for(t=0;i>t;++t)r[t]=e[t].value;else{var n=this._indexMap;n[0]=n[1]=n[2]=n[3]=0;var a=this._gpuMorphed;for(a.length=i,t=0;i>t;++t)a[t]=!1;var s=e.slice(0).sort(c);for(t=0;4>t;++t){var o=e.indexOf(s[t]);a[o]=!0,n[t]=o,r[t]=s[t].value}var u=Math.abs(s[4].value)>=l;a[n[3]]=!u,this._remapBufferArrays(),u&&this._morphBufferArrayCPU()}},update:function(t){this.isInitialized()||this.init(t),this.updateWeights();for(var e=this._weights,i=Math.min(4,this._targets.length),r=this._morphs,n=0,a=r.length;a>n;++n)for(var s=r[n].getTargetsWeight(),o=0;i>o;o++)s[o]=e[o];return!0}}),t.exports=h},function(t,e){"use strict";var i=function(t){return-(t*(t-2))},r=function(t){return t*t},n=function(t){return t-=1,t*t*t+1},a=function(t){return t*t*t},s=function(t){return t-=1,-(t*t*t*t-1)},o=function(t){return t*t*t*t},u=function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},h=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};t.exports={easeOutQuad:i,easeInQuad:r,easeOutCubic:n,easeInCubic:a,easeOutQuart:s,easeInQuart:o,easeOutElastic:u,easeOutBounce:h,EaseOutQuad:i,EaseInQuad:r,EaseOutCubic:n,EaseInCubic:a,EaseOutQuart:s,EaseInQuart:o,EaseOutElastic:u,EaseOutBounce:h}},function(t,e,i){"use strict";var r=i(1105),n=i(1112),a=i(1122),s=i(1210),o=function(t,e){n.call(this),this._target=s.createMatrixTarget(e||a.identity),t&&this.setName(t)};o.prototype=r.objectInherit(n.prototype,{init:function(t){this.setMatrix(t),a.copy(t,this._target.defaultValue)},getTarget:function(){return this._target},getMatrix:function(){return this._target.value},setMatrix:function(t){a.copy(t,this._target.value)},resetToDefaultValue:function(){this.setMatrix(this._target.defaultValue)},applyToMatrix:function(t){a.preMult(t,this._target.value)}}),t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1112),a=i(1122),s=i(1125),o=i(1210),u=function(t,e){n.call(this),this._target=o.createQuatTarget(e||s.identity),t&&this.setName(t)};u.prototype=r.objectInherit(n.prototype,{init:function(t){this.setQuaternion(t),s.copy(t,this._target.defaultValue)},setQuaternion:function(t){s.copy(t,this._target.value)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setQuaternion(this._target.defaultValue)},applyToMatrix:function(){var t=a.create();return function(e){var i=t;a.setRotateFromQuat(i,this._target.value),a.preMult(e,i)}}()}),t.exports=u},function(t,e,i){"use strict";var r=i(1105),n=i(1112),a=i(1122),s=i(1114),o=i(1125),u=i(1210),h=function(t,e,i){n.call(this),this._axis=s.set(0,0,1,s.create()),e&&s.copy(e,this._axis),this._target=u.createFloatTarget("number"==typeof i?i:0),t&&this.setName(t)};h.prototype=r.objectInherit(n.prototype,{init:function(t,e){this.setAxis(t),this.setAngle(e),this._target.defaultValue=e},setAxis:function(t){s.copy(t,this._axis)},setAngle:function(t){this._target.value=t},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setAngle(this._target.defaultValue)},applyToMatrix:function(){var t=a.create(),e=o.create();return function(i){var r=this._axis,n=e,s=t,u=this._target.value;o.makeRotate(u,r[0],r[1],r[2],n),a.setRotateFromQuat(s,n),a.preMult(i,s)}}()}),t.exports=h},function(t,e,i){"use strict";var r=i(1105),n=i(1112),a=i(1122),s=i(1114),o=i(1210),u=function(t,e){n.call(this),this._target=o.createVec3Target(e||s.one),t&&this.setName(t)};u.prototype=r.objectInherit(n.prototype,{init:function(t){this.setScale(t),s.copy(t,this._target.defaultValue)},setScale:function(t){s.copy(t,this._target.value)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setScale(this._target.defaultValue)},applyToMatrix:function(t){var e=this._target.value;a.preMultScale(t,e)}}),t.exports=u},function(t,e,i){"use strict";var r=i(1105),n=i(1112),a=i(1122),s=i(1114),o=i(1210),u=function(t,e){n.call(this),this._target=o.createVec3Target(e||s.zero),t&&this.setName(t)};u.prototype=r.objectInherit(n.prototype,{init:function(t){this.setTranslate(t),s.copy(t,this._target.defaultValue)},setTranslate:function(t){s.copy(t,this._target.value)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setTranslate(this._target.defaultValue)},applyToMatrix:function(t){a.preMultTranslate(t,this._target.value)}}),t.exports=u},function(t,e,i){"use strict";var r=i(1105),n=i(1145),a=i(1137),s=i(1223),o=i(1224),u=i(1225),h=i(1226),l={};l.Input=n,r.objectMix(l,a),l.DatabasePager=s,l.ObjectWrapper.serializers.osg=o,l.ObjectWrapper.serializers.osgAnimation=u,l.ObjectWrapper.serializers.osgText=h,t.exports=l},function(t,e,i){"use strict";var r=i(236),n=i(1105),a=i(1121),s=i(1169),o=i(1108),u=function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._progressCallback=void 0,this._lastCB=!0,this._activePagedLODList=new Set,this._childrenToRemoveList=new Set,this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},h=function(){this._loadedModel=void 0,this._group=void 0,this._url=void 0,this._function=void 0,this._timeStamp=0,this._groupExpired=!1,this._priority=0},l=function(t,e){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._activePagedLODList=t,this._frameNumber=e};l.prototype=n.objectInherit(a.prototype,{apply:function(t){t.getTypeID()===s.getTypeID()&&(t.setFrameNumberOfLastTraversal(this._frameNumber),this._activePagedLODList.add(t)),this.traverse(t)}});var c=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN)};c.prototype=n.objectInherit(a.prototype,{apply:function(t){t.releaseGLObjects(),this.traverse(t)}});var d=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._childrenList=[]};d.prototype=n.objectInherit(a.prototype,{apply:function(t){t.getTypeID()===s.getTypeID()&&(this._childrenList.push(t),this._markRequestsExpired(t)),this.traverse(t)},removeExpiredChildrenAndFindPagedLODs:function(t,e,i,r){if(!t.children.length)return!1;var n=r.length;t.removeExpiredChildren(e,i,r);for(var a=n;a<r.length;a++)r[a].accept(this);return n!==r.length},_markRequestsExpired:function(t){for(var e,i=t._perRangeDataList.length,r=0;i>r;r++)e=t.getDatabaseRequest(r),void 0!==e&&(e._groupExpired=!0,e._loadedModel=null)}}),u.prototype=n.objectLibraryClass({setTargetMaximumNumberOfPageLOD:function(t){this._targetMaximumNumberOfPagedLOD=t},getTargetMaximumNumberOfPageLOD:function(){return this._targetMaximumNumberOfPagedLOD},setAcceptNewDatabaseRequests:function(t){this._acceptNewRequests=t},getAcceptNewDatabaseRequests:function(){return this._acceptNewRequests},reset:function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._lastCB=!0,this._activePagedLODList.clear(),this._childrenToRemoveList.clear(),this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},updateSceneGraph:function(t){void 0!==this._progressCallback&&this.executeProgressCallback(),this.removeExpiredSubgraphs(t,.0025),this.takeRequests(),this.addLoadedDataToSceneGraph(t,.005)},executeProgressCallback:function(){this._pendingRequests.length>0||this._pendingNodes.length>0?(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!1):this._lastCB||(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!0)},setMaxRequestsPerFrame:function(t){this._maxRequestsPerFrame=t},getMaxRequestsPerFrame:function(){return this._maxRequestsPerFrame},getRequestListSize:function(){return this._pendingRequests.length+this._downloadingRequestsNumber},setProgressCallback:function(t){this._progressCallback=t},addLoadedDataToSceneGraph:function(t,e){if(0>=e)return 0;var i=0,r=o.instance().tick();this._pendingNodes.sort(function(t,e){return e._timeStamp-t._timeStamp});for(var n=0;n<this._pendingNodes.length;n++){if(i>e)return 0;var a=this._pendingNodes.shift(),s=t.getFrameNumber(),u=t.getSimulationTime();if(a._groupExpired===!1){var h=a._group;h.setTimeStamp(h.children.length,u),h.setFrameNumber(h.children.length,s),h.addChildNode(a._loadedModel),this._activePagedLODList.has(h)?this.registerPagedLODs(a._loadedModel,s):this.registerPagedLODs(h,s)}else a._loadedModel=void 0,a=void 0;i=o.instance().deltaS(r,o.instance().tick())}return e-=i},isLoading:function(){return this._loading},registerPagedLODs:function(t,e){t&&t.accept(new l(this._activePagedLODList,e))},requestNodeFile:function(t,e,i,r,n){if(this._acceptNewRequests){var a=new h;return a._group=i,a._function=t,a._url=e,a._timeStamp=r,a._priority=n,this._pendingRequests.push(a),a}},takeRequests:function(){if(this._pendingRequests.length){var t=Math.min(this._maxRequestsPerFrame,this._pendingRequests.length);this._pendingRequests.sort(function(t,e){var i=t._timeStamp-e._timeStamp;return 0===i&&(i=t._priority-e._priority),i});for(var e=0;t>e;e++)this._downloadingRequestsNumber++,this.processRequest(this._pendingRequests.shift())}},processRequest:function(t){this._loading=!0;var e=this;return t._groupExpired?(e._downloadingRequestsNumber--,void(this._loading=!1)):void(void 0!==t._function?this.loadNodeFromFunction(t._function,t._group).then(function(i){e._downloadingRequestsNumber--,t._loadedModel=i,e._pendingNodes.push(t),e._loading=!1}):""!==t._url&&this.loadNodeFromURL(t._url).then(function(i){e._downloadingRequestsNumber--,t._loadedModel=i,e._pendingNodes.push(t),e._loading=!1}))},loadNodeFromFunction:function(t,e){var i=t(e);return i?i&&i.then?i:r.resolve(i):r.reject()},loadNodeFromURL:function(t){var e=i(1137);return e.readNodeURL(t)},releaseGLExpiredSubgraphs:function(t){if(0>=t)return 0;var e=0,i=o.instance().tick(),r=this;return this._childrenToRemoveList.forEach(function(n){e>t||(r._childrenToRemoveList["delete"](n),n.accept(new c),n.removeChildren(),n=null,e=o.instance().deltaS(i,o.instance().tick()))}),t-=e},removeExpiredSubgraphs:function(t,e){if(0===t.getFrameNumber())return 0;var i=this._activePagedLODList.size-this._targetMaximumNumberOfPagedLOD,r=t.getSimulationTime()-.1,n=t.getFrameNumber()-1;return i>0&&(e=this.removeExpiredChildren(i,r,n,e)),e},removeExpiredChildren:function(t,e,i,r){var n=0,a=o.instance().tick(),s=this,u=[],h=new d;return this._activePagedLODList.forEach(function(l){if(n>r)return 0;if(0>t)return r;if(i<l.getFrameNumberOfLastTraversal())return r;h.removeExpiredChildrenAndFindPagedLODs(l,e,i,u);for(var c=0;c<h._childrenList.length;c++)s._activePagedLODList["delete"](h._childrenList[c]),t--;for(c=0;c<u.length;c++)s._childrenToRemoveList.add(u[c]);h._childrenList.length=0,u.length=0,n=o.instance().deltaS(a,o.instance().tick())}),r-=n}},"osgDB","DatabasePager"),t.exports=u},function(t,e,i){"use strict";var r=i(236),n=i(1128),a={};a.Object=function(t,e){var i=t.getJSON();if(i.Name&&e.setName(i.Name),i.UserDataContainer){var r=t.setJSON(i.UserDataContainer).readUserDataContainer();void 0!==r&&e.setUserData(r)}return e},a.Node=function(t,e){var i=t.getJSON();a.Object(t,e);var n=[];if(i.UpdateCallbacks)for(var s=e.addUpdateCallback.bind(e),o=0,u=i.UpdateCallbacks.length;u>o;o++){var h=t.setJSON(i.UpdateCallbacks[o]).readObject();n.push(h),h.then(s)}if(i.StateSet){var l=t.setJSON(i.StateSet).readObject();n.push(l),l.then(e.setStateSet.bind(e))}var c=[];if(i.Children)for(var d=0,p=i.Children.length;p>d;d++)c.push(t.setJSON(i.Children[d]).readObject());return r.all(n).then(function(){return r.all(c).then(function(t){for(var i=t.length,r=0;i>r;r++)e.addChild(t[r]);return e})})},a.StateSet=function(t,e){var i=t.getJSON();a.Object(t,e),void 0!==i.RenderingHint&&e.setRenderingHint(i.RenderingHint);var n=[],s=function(i){var r=t.setJSON(i).readObject();r.isRejected()||(n.push(r),r.then(e.setAttributeAndModes.bind(e)))};if(void 0!==i.AttributeList)for(var o=0,u=i.AttributeList.length;u>o;o++)s(i.AttributeList[o]);var h=function(i,r){var a=t.setJSON(r).readObject();
a.isRejected()||(n.push(a),a.then(e.setTextureAttributeAndModes.bind(e,i)))};if(i.TextureAttributeList)for(var l=i.TextureAttributeList,c=0,d=l.length;d>c;c++)for(var p=l[c],f=0,g=p.length;g>f;f++)h(c,p[f]);return r.all(n).then(function(){return e})},a.Material=function(t,e){var i=t.getJSON();return i.Diffuse&&i.Emission&&i.Specular&&void 0!==i.Shininess?(a.Object(t,e),e.setAmbient(i.Ambient),e.setDiffuse(i.Diffuse),e.setEmission(i.Emission),e.setSpecular(i.Specular),e.setShininess(i.Shininess),r.resolve(e)):r.reject()},a.BlendFunc=function(t,e){var i=t.getJSON();return i.SourceRGB&&i.SourceAlpha&&i.DestinationRGB&&i.DestinationAlpha?(a.Object(t,e),e.setSourceRGB(i.SourceRGB),e.setSourceAlpha(i.SourceAlpha),e.setDestinationRGB(i.DestinationRGB),e.setDestinationAlpha(i.DestinationAlpha),r.resolve(e)):r.reject()},a.CullFace=function(t,e){var i=t.getJSON();return void 0===i.Mode?r.reject():(a.Object(t,e),e.setMode(i.Mode),r.resolve(e))},a.BlendColor=function(t,e){var i=t.getJSON();return i.ConstantColor?(a.Object(t,e),e.setConstantColor(i.ConstantColor),r.resolve(e)):r.reject()},a.Light=function(t,e){var i=t.getJSON();return i.Ambient&&i.Diffuse&&i.Direction&&i.Position&&i.Specular&&void 0!==i.LightNum&&void 0!==i.SpotCutoff&&void 0!==i.LinearAttenuation&&void 0!==i.ConstantAttenuation&&void 0!==i.QuadraticAttenuation?(a.Object(t,e),e.setAmbient(i.Ambient),e.setConstantAttenuation(i.ConstantAttenuation),e.setDiffuse(i.Diffuse),e.setDirection(i.Direction),e.setLightNumber(i.LightNum),e.setLinearAttenuation(i.LinearAttenuation),e.setPosition(i.Position),e.setQuadraticAttenuation(i.QuadraticAttenuation),e.setSpecular(i.Specular),e.setSpotCutoff(i.SpotCutoff),e.setSpotBlend(.01),void 0!==i.SpotExponent&&e.setSpotBlend(i.SpotExponent/128),r.resolve(e)):r.reject()},a.Texture=function(t,e){var i=t.getJSON();a.Object(t,e),i.MinFilter&&e.setMinFilter(i.MinFilter),i.MagFilter&&e.setMagFilter(i.MagFilter),i.WrapT&&e.setWrapT(i.WrapT),i.WrapS&&e.setWrapS(i.WrapS);var r=i.File;return void 0===r&&(r="no-image-provided"),t.readImageURL(r).then(function(t){return e.setImage(t),e})},a.Projection=function(t,e){var i=t.getJSON();if(!i.Matrix)return r.reject();var n=a.Node(t,e);return e.setMatrix(i.Matrix),n},a.MatrixTransform=function(t,e){var i=t.getJSON();if(!i.Matrix)return r.reject();var n=a.Node(t,e);return e.setMatrix(i.Matrix),n},a.LightSource=function(t,e){var i=t.getJSON();if(!i.Light)return r.reject();var s=a.Node(t,e);return r.all([t.setJSON(i.Light).readObject(),s]).then(function(t){var r=t[0];return e.setLight(r),"ABSOLUTE_RF"===i.ReferenceFrame&&e.setReferenceFrame(n.ABSOLUTE_RF),e})},a.Geometry=function(t,e){var i=t.getJSON();if(!i.VertexAttributeList)return r.reject();i.PrimitiveSetList=i.PrimitiveSetList||[];var n=[];n.push(a.Node(t,e));var s=e.getPrimitives(),o=s.push.bind(s),u=0,h=i.PrimitiveSetList.length;for(u=0;h>u;u++){var l=t.setJSON(i.PrimitiveSetList[u]).readPrimitiveSet();n.push(l),l.then(o)}var c=function(t,e){this.getVertexAttributeList()[t]=e},d=i.VertexAttributeList,p=window.Object.keys(d);for(h=p.length,u=0;h>u;u++){var f=p[u],g=t.setJSON(d[f]).readBufferArray();n.push(g),g.then(c.bind(e,f))}return r.all(n).then(function(){return e})},a.PagedLOD=function(t,e){var i=t.getJSON();a.Object(t,e),"USE_BOUNDING_SPHERE_CENTER"===i.CenterMode?e.setCenterMode(0):"UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED"===i.CenterMode&&e.setCenterMode(2),e.setCenter([i.UserCenter[0],i.UserCenter[1],i.UserCenter[2]]),e.setRadius(i.UserCenter[3]),"PIXEL_SIZE_ON_SCREEN"===i.RangeMode&&e.setRangeMode(1);for(var n,s=i.RangeList,o=0;o<window.Object.keys(s).length;o++){n="Range "+o;var u=s[n];e.setRange(o,u[0],u[1])}for(s=i.RangeDataList,o=0;o<window.Object.keys(s).length;o++)n="File "+o,e.setFileName(o,s[n]);e.setDatabasePath(t.getDatabasePath());var h=[];if(i.Children)for(var l=0,c=i.Children.length;c>l;l++)h.push(t.setJSON(i.Children[l]).readObject());return r.all(h).then(function(t){var i=t.length;for(o=0;i>o;o++)e.addChildNode(t[o]);return e})},t.exports=a},function(t,e,i){"use strict";var r=i(236),n=i(1109),a=i(1224),s=i(1209),o=i(1208),u=i(1137),h=i(1217),l=i(1220),c=i(1177),d=i(1130),p={},f=function(){},g=u.registry();g.registerObject("osgAnimation.Vec3LerpChannel",f),g.registerObject("osgAnimation.FloatLerpChannel",f),g.registerObject("osgAnimation.QuatSlerpChannel",f),g.registerObject("osgAnimation.QuatLerpChannel",f),g.registerObject("osgAnimation.FloatCubicBezierChannel",f),g.registerObject("osgAnimation.Vec3CubicBezierChannel",f),g.registerObject("osgAnimation.StackedMatrixElement",h),g.registerObject("osgAnimation.StackedScaleElement",l),p.Animation=function(t){var e=t.getJSON();if(void 0===e.Name||!e.Channels||0===e.Channels.length)return r.reject();for(var i=[],n=0,a=e.Channels.length;a>n;n++){var s=t.setJSON(e.Channels[n]).readObject();i.push(s)}return r.all(i).then(function(t){return o.createAnimation(t,e.Name)})},p.StandardVec3Channel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&3===n.KeyFrames.Key.length))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key[0]).readBufferArray(),o=t.setJSON(n.KeyFrames.Key[1]).readBufferArray(),u=t.setJSON(n.KeyFrames.Key[2]).readBufferArray();return r.all([a,s,o,u]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),u=r.length,h=new Float32Array(new ArrayBuffer(4*(u+1)*3),0,3*u),l=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),c=0;u>c;c++){var d=3*c;l[c]=r[c],h[d++]=a[c],h[d++]=s[c],h[d]=o[c]}return i(h,l,n.TargetName,n.Name,e),e})},p.StandardQuatChannel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&4===n.KeyFrames.Key.length))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key[0]).readBufferArray(),o=t.setJSON(n.KeyFrames.Key[1]).readBufferArray(),u=t.setJSON(n.KeyFrames.Key[2]).readBufferArray(),h=t.setJSON(n.KeyFrames.Key[3]).readBufferArray();return r.all([a,s,o,u,h]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),u=t[4].getElements(),h=r.length,l=new Float32Array(new ArrayBuffer(4*(h+1)*4),0,4*h),c=new Float32Array(new ArrayBuffer(4*(h+1)),0,h),d=0;h>d;d++){var p=4*d;c[d]=r[d],l[p++]=a[d],l[p++]=s[d],l[p++]=o[d],l[p]=u[d]}return i(l,c,n.TargetName,n.Name,e),e})},p.StandardFloatChannel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key).readBufferArray();return r.all([a,s]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),s=r.length,o=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),u=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),h=0;s>h;h++)u[h]=r[h],o[h]=a[h];return i(o,u,n.TargetName,n.Name,e),e})},p.Vec3LerpChannel=function(t,e){return p.StandardVec3Channel(t,e,s.createVec3Channel)},p.QuatLerpChannel=function(t,e){return p.StandardQuatChannel(t,e,s.createQuatChannel)},p.QuatSlerpChannel=function(t,e){return p.StandardQuatChannel(t,e,s.createQuatChannel)},p.FloatLerpChannel=function(t,e){return p.StandardFloatChannel(t,e,s.createFloatChannel)},p.FloatCubicBezierChannel=function(t,e){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn))return r.reject();for(var n=[],a=window.Object.keys(i.KeyFrames),o=0;o<a.length;o++)n.push(t.setJSON(i.KeyFrames[a[o]]).readBufferArray());return r.all(n).then(function(t){for(var r=t[0].getElements(),n=t[1].getElements(),a=t[2].getElements(),o=t[3].getElements(),u=o.length,h=new Float32Array(new ArrayBuffer(4*(u+1)*3),0,3*u),l=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),c=0;u>c;c++){var d=3*c;l[c]=o[c],h[d++]=a[c],h[d++]=r[c],h[d]=n[c]}return s.createFloatCubicBezierChannel(h,l,i.TargetName,i.Name,e),e})},p.Vec3CubicBezierChannel=function(t,e){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn&&3===i.KeyFrames.Position.length&&3===i.KeyFrames.ControlPointIn.length&&3===i.KeyFrames.ControlPointOut.length))return r.reject();for(var n=[],a=window.Object.keys(i.KeyFrames),o=0;o<a.length;o++){var u=a[o],h=i.KeyFrames[u];"Time"!==u?(n.push(t.setJSON(h[0]).readBufferArray()),n.push(t.setJSON(h[1]).readBufferArray()),n.push(t.setJSON(h[2]).readBufferArray())):n.push(t.setJSON(h).readBufferArray())}return r.all(n).then(function(t){for(var r=t[0].getElements(),n=t[1].getElements(),a=t[2].getElements(),o=t[3].getElements(),u=t[4].getElements(),h=t[5].getElements(),l=t[6].getElements(),c=t[7].getElements(),d=t[8].getElements(),p=t[9].getElements(),f=p.length,g=new Float32Array(new ArrayBuffer(4*(f+1)*9),0,9*f),m=new Float32Array(new ArrayBuffer(4*(f+1)),0,f),v=0;f>v;v++){var _=9*v;m[v]=p[v],g[_++]=l[v],g[_++]=c[v],g[_++]=d[v],g[_++]=r[v],g[_++]=n[v],g[_++]=a[v],g[_++]=o[v],g[_++]=u[v],g[_]=h[v]}return s.createVec3CubicBezierChannel(g,m,i.TargetName,i.Name,e),e})},p.BasicAnimationManager=function(t,e){var i=t.getJSON();if(!i.Animations)return r.reject();a.Object(t,e);for(var s=[],o=0,u=i.Animations.length;u>o;o++){var h=t.setJSON(i.Animations[o]).readObject();h.isRejected()?n.warn("An Animation failed on the parsing!"):s.push(h)}return r.all(s).then(function(t){return e.init(t),e})},p.UpdateMatrixTransform=function(t,e){var i=t.getJSON();if(!i.StackedTransforms)return r.reject();a.Object(t,e);for(var n=[],s=0,o=i.StackedTransforms.length;o>s;s++)n.push(t.setJSON(i.StackedTransforms[s]).readObject());return r.all(n).then(function(t){for(var i=e.getStackedTransforms(),r=0,n=t.length;n>r;r++)i.push(t[r]);return e.computeChannels(),e})},p.StackedTranslate=function(t,e){var i=t.getJSON();return i.Name&&i.Translate?(a.Object(t,e),e.init(i.Translate),r.resolve(e)):r.reject()},p.StackedQuaternion=function(t,e){var i=t.getJSON();return i.Name&&i.Quaternion?(a.Object(t,e),e.init(i.Quaternion),r.resolve(e)):r.reject()},p.StackedRotateAxis=function(t,e){var i=t.getJSON();return i.Axis&&void 0!==i.Angle?(a.Object(t,e),e.init(i.Axis,i.Angle),r.resolve(e)):r.reject()},p.StackedMatrix=function(t,e){var i=t.getJSON();return i.Name&&i.Matrix?(a.Object(t,e),e.init(i.Matrix),r.resolve(e)):r.reject()},p.StackedScale=function(t,e){var i=t.getJSON();return i.Name&&i.Scale?(a.Object(t,e),e.init(i.Scale),r.resolve(e)):r.reject()},p.Bone=function(t,e){var i=t.getJSON();if(!i.InvBindMatrixInSkeletonSpace)return r.reject();var n=a.MatrixTransform(t,e);if(e.setInvBindMatrixInSkeletonSpace(i.InvBindMatrixInSkeletonSpace),i.BoundingBox){var s=e.getBoneBoundingBox();s.setMax(i.BoundingBox.max),s.setMin(i.BoundingBox.min)}return n},p.UpdateBone=p.UpdateMatrixTransform,p.UpdateSkeleton=function(t,e){return a.Object(t,e),r.resolve(e)},p.Skeleton=a.MatrixTransform,p.RigGeometry=function(t,e){var i=t.getJSON();if(!i.SourceGeometry)return r.reject();i.BoneMap||n.warn("No boneMap found in a RigGeometry !");var s=a.Geometry(t,e);e._boneNameID=i.BoneMap;var o,u=i.SourceGeometry["osg.Geometry"];return u?(t.setJSON(u),e.setSourceGeometry(new d),o=a.Geometry(t,e.getSourceGeometry())):(u=i.SourceGeometry["osgAnimation.MorphGeometry"],u?(t.setJSON(u),e.setSourceGeometry(new c),o=p.MorphGeometry(t,e.getSourceGeometry())):n.warn("SourceGeometry type no recognized")),void 0===e._uniqueID&&(e._uniqueID=u.UniqueID),r.all([s,o]).then(function(){return e.mergeChildrenData(),e})},p.MorphGeometry=function(t,e){var i=t.getJSON();if(!i.MorphTargets)return r.reject();var n=i.MorphTargets,s=[];s.push(a.Geometry(t,e));for(var o=0,u=n.length;u>o;o++)s.push(t.setJSON(n[o]).readObject());return r.all(s).then(function(t){for(var e=t[0],i=e.getMorphTargets(),r=1,n=t.length;n>r;r++)i.push(t[r]);return e.mergeChildrenVertexAttributeList(),e})},p.UpdateMorph=function(t,e){var i=t.getJSON();if(!i.TargetMap)return r.reject();a.Object(t,e);for(var n=window.Object.keys(i.TargetMap),s=0,o=n.length;o>s;s++){var u=n[s];e.addTarget(i.TargetMap[u],parseInt(u,10))}return r.resolve(e)},p.StackedMatrixElement=p.StackedMatrix,p.StackedScaleElement=p.StackedScale,t.exports=p},function(t,e,i){"use strict";var r=i(236),n=i(1224),a=i(1109),s=i(1227),o={};o.Text=function(t,e){var i=t.getJSON();if(!i.Text)return r.reject();var o=n.Node(t,e);if(e.setColor(i.Color),e.setText(i.Text),e.setAutoRotateToScreen(i.AutoRotateToScreen),e.setPosition(i.Position),e.setCharacterSize(i.CharacterSize),"VERTICAL"===i.Layout)return a.error("Vertical Alignment not supported"),r.reject();var u=i.Alignment;return i.Alignment.indexOf("BASE_LINE")>-1&&("LEFT_BASE_LINE"===i.Alignment?u=s.LEFT_CENTER:"CENTER_BASE_LINE"===i.Alignment?u=s.CENTER_CENTER:"RIGHT_BASE_LINE"===i.Alignment?u=s.RIGHT_CENTER:"LEFT_BOTTOM_BASE_LINE"===i.Alignment?u=s.LEFT_BOTTOM:"CENTER_BOTTOM_BASE_LINE"===i.Alignment?u=s.CENTER_BOTTOM:"RIGHT_BOTTOM_BASE_LINE"===i.Alignment&&(u=s.RIGHT_BOTTOM)),e.setAlignment(u),e.setLayout(i.Layout),o},t.exports=o},function(t,e,i){"use strict";var r=i(1105),n=i(1114),a=i(1124),s=i(1122),o=i(1104),u=i(1143),h=i(1200),l=i(1133),c=i(1138),d=i(1125),p=i(1121),f=i(1111),g=function(t){o.call(this),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._matrixTransform=new u,this.addChild(this._matrixTransform),this._text="",void 0!==t&&(this._text=t),this._font="monospace",this._color=a.createAndSet(0,0,0,1),this._fillStyle="rgba( 0, 0, 0, 1 )",this._context.textAlign="center",this._textX=void 0,this._context.baseLine="middle",this._textY=void 0,this._characterSize=1,this._characterSizeMode=g.OBJECT_COORDS,this._fontSize=32,this._geometry=void 0,this._autoRotateToScreen=!1,this._position=n.create(),this._layout=g.LEFT_TO_RIGHT,this._alignment=g.CENTER_CENTER,this._forcePowerOfTwo=!1,this._texture=new l,this.drawText(),this._dirty=!1,this._previousModelView=s.create()};g.OBJECT_COORDS=0,g.SCREEN_COORDS=1,g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT=2,g.LEFT_TO_RIGHT="ltr",g.RIGHT_TO_LEFT="rtl",g.LEFT_TOP=0,g.LEFT_CENTER=1,g.LEFT_BOTTOM=2,g.CENTER_TOP=3,g.CENTER_CENTER=4,g.CENTER_BOTTOM=5,g.RIGHT_TOP=6,g.RIGHT_CENTER=7,g.RIGHT_BOTTOM=8,g.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{drawText:function(){if(void 0!==this._geometry&&(this._matrixTransform.removeChild(this._geometry),this._geometry.releaseGLObjects()),this._text){this.setTextProperties(),this._canvas.width=this._context.measureText(this._text).width,this._canvas.height=2*this._fontSize,this._forcePowerOfTwo&&(this._canvas.width=this._nextPowerOfTwo(this._canvas.width),this._canvas.height=this._nextPowerOfTwo(this._canvas.height)),this.setTextProperties(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.fillText(this._text,this._textX,this._textY);var t=this._canvas.width/this._canvas.height,e=this._characterSize*t;this._geometry=h.createTexturedQuadGeometry(-e/2,-this._characterSize/2,0,e,0,0,0,this._characterSize,0),this._texture.setTextureSize(this._canvas.width,this._canvas.height),this._texture.setMinFilter("LINEAR"),this._texture.setMagFilter("LINEAR"),this._texture.setImage(this._canvas);var i=this._geometry.getOrCreateStateSet();i.setTextureAttributeAndModes(0,this._texture),i.setRenderingHint("TRANSPARENT_BIN"),i.setAttributeAndModes(new c(c.ONE,c.ONE_MINUS_SRC_ALPHA)),this._matrixTransform.addChild(this._geometry),this.dirtyBound()}},setText:function(t){this._text=t,this._dirty=!0},getText:function(){return this._text},setFont:function(t){this._font=t,this._dirty=!0},setColor:function(t){this._color=t,this._fillStyle="rgba("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+","+t[3]+")",this._context.fillStyle=this._fillStyle,this._context.fillText(this._text,this._textX,this._textY)},getColor:function(){return this._color},setCharacterSize:function(t){this._characterSize=t,this._characterSizeMode!==g.OBJECT_COORDS&&(s.makeScale(this._characterSize,this._characterSize,this._characterSize,this._matrixTransform.getMatrix()),this._characterSizeMode===g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)),this._dirty=!0},getCharacterSize:function(){return this._characterSize},setCharacterSizeMode:function(t){this._characterSizeMode=t,this._characterSizeMode!==g.OBJECT_COORDS?(s.makeScale(this._characterSize,this._characterSize,this._characterSize,this._matrixTransform.getMatrix()),this.setAutoScaleToScreen(!0),this.setMaximumScale(Number.MAX_VALUE),this._characterSizeMode===g.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)):(this._matrixTransform.setMatrix(s.create()),this.setAutoScaleToScreen(!1)),this._dirty=!0},getCharacterSizeMode:function(){return this._characterSizeMode},setFontResolution:function(t){this._fontSize=t,this._dirty=!0},getFontResolution:function(){return this._fontSize},setPosition:function(t){this._position=t,s.makeTranslate(t[0],t[1],t[2],this.getMatrix())},getPosition:function(){return this._position},setTextProperties:function(){this._context.fillStyle=this._fillStyle,this._setAlignmentValues(this._alignment),this._context.font=this._fontSize+"px "+this._font,this._context.direction=this._layout},setAutoRotateToScreen:function(t){o.prototype.setAutoRotateToScreen.call(this,t),this._dirty=!0},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setLayout:function(t){"string"==typeof t?this._layout=g[t]:this._layout=t,this._dirty=!0},getLayout:function(){return this._layout},setAlignment:function(t){"string"==typeof t?this._alignment=g[t]:this._alignment=t,this._dirty=!0},getAlignment:function(){return this._alignment},accept:function(){return function(t){if(this._dirty&&(this.drawText(),this._dirty=!1),t.getVisitorType()===p.CULL_VISITOR){var e=t.getViewport().width(),i=t.getViewport().height(),r=t.getCurrentProjectionMatrix(),o=t.getCurrentModelViewMatrix(),u=this._position,h=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(s.equal(o,this._previousModelView)?e!==this._previousWidth||i!==this._previousHeight?h=!0:s.equal(r,this._previousProjection)?n.equal(u,this._previousPosition)||(h=!0):h=!0:h=!0),this._firstTimeToInitEyePoint=!1,h){if(this._autoScaleToScreen){var l=t.getViewport(),c=this.computePixelSizeVector(l,r,o),g=a.createAndSet(this._position[0],this._position[1],this._position[2],1),m=a.dot(g,c);m=.48/m;var v=1/m;if(this._autoScaleTransitionWidthRatio>0){var _,b,x;if(this._minimumScale>0){var A=this._minimumScale,y=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);_=1/(4*(y-A)),b=1-2*_*y,x=A+b*b/(4*_);var S=-b/(2*_);S>v?v=this._minimumScale:y>v&&(v=x+b*v+_*(v*v))}if(this._maximumScale<Number.MAX_VALUE){var C=this._maximumScale,w=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);_=1/(4*(w-C)),b=1-2*_*w,x=C+b*b/(4*_);var T=-b/(2*_);v>T?v=this._maximumScale:v>w&&(v=x+b*v+_*(v*v))}}this.setScale(v)}if(this._autoRotateToScreen){var M=d.create(),E=t.getCurrentModelViewMatrix();s.getRotate(E,M),this.setRotation(d.inverse(M,M))}this._previousWidth=e,this._previousHeight=i,n.copy(u,this._previousPosition),s.copy(r,this._previousProjection),s.copy(o,this._previousModelView)}}f.prototype.accept.call(this,t)}}(),_setAlignmentValues:function(t){switch(t){case g.LEFT_TOP:this._context.textAlign="left",this._textX=0,this._context.textBaseline="top",this._textY=0;break;case g.LEFT_CENTER:this._context.textAlign="left",this._textX=0,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case g.LEFT_BOTTOM:this._context.textAlign="left",this._textX=0,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case g.CENTER_TOP:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="top",this._textY=0;break;case g.CENTER_CENTER:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case g.CENTER_BOTTOM:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case g.RIGHT_TOP:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="top",this._textY=0;break;case g.RIGHT_CENTER:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case g.RIGHT_BOTTOM:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="bottom",this._textY=this._canvas.height}},setForcePowerOfTwo:function(t){this._forcePowerOfTwo=t},getForcePowerOfTwo:function(){return this._forcePowerOfTwo},_nextPowerOfTwo:function(t){var e=t;return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}}),"osgText","Text"),t.exports=g},function(t,e,i){"use strict";var r=i(282),n=i(1229),a=i(1244),s=i(1245),o=i(1246),u=i(1233),h=i(1247),l=i(1249),c=i(1248),d=i(1230),p=i(1231),f=i(1232),g=i(1234),m=i(1235),v=i(1236),_=i(1237),b=i(1239),x=i(1250),A=i(1238),y={};r.NO_MOUSEEVENTS=!0,y.CADManipulator=n,y.getCADManipulatorStandardMouseKeyboardController=function(){return a},y.getCADManipulatorHammerController=function(){return s},y.FirstPersonManipulator=o,y.getFirstPersonDeviceOrientationController=function(){return u},y.getFirstPersonManipulatorHammerController=function(){return h},y.getFirstPersonStandardMouseKeyboardControllerClass=function(){return l},y.getFirstPersonWebVRControllerClass=function(){return c},y.Manipulator=d,y.OrbitManipulator=p,y.getOrbitManipulatorDeviceOrientationController=function(){return f},y.getOrbitManipulatorGamePadController=function(){return g},y.getOrbitManipulatorHammerController=function(){return m},y.getOrbitManipulatorLeapMotionController=function(){return v},y.getOrbitManipulatorStandardMouseKeyboardController=function(){return _},y.getOrbitManipulatorWebVRController=function(){return b},y.SwitchManipulator=x,y.OrbitManipulator.Rotate=A.ROTATE,y.OrbitManipulator.Pan=A.PAN,y.OrbitManipulator.Zoom=A.ZOOM,t.exports=y},function(t,e,i){"use strict";var r=i(1105),n=i(1230),a=i(1231),s=i(1240),o=i(1241),u=i(1242),h=i(1127),l=i(1122),c=i(1168),d=i(1114),p=i(1125),f=i(1244),g=i(1245),m=function(){n.call(this),this._tmpHomePosition=d.create(),this._intersectionVisitor=new s,this._lineSegmentIntersector=new o,this._polytopeIntersector=void 0,this._usePolytopeIntersector=!1,this._dimensionMask=4,this.init()};m.Interpolator=function(){this._current=c.create(),this._target=c.create(),this._delta=c.create(),this._reset=!1,this.reset(),this._width=void 0,this._height=void 0},m.Interpolator.prototype={setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},reset:function(){for(var t=0,e=this._current.length;e>t;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(){var t,e;return t=void 0===this._width?0:(this._target[0]-this._current[0])/this._width,this._delta[0]=t,this._current[0]=this._target[0],e=void 0===this._height?0:(this._target[1]-this._current[1])/this._height,this._delta[1]=e,this._current[1]=this._target[1],this._delta},set:function(){for(var t=0,e=this._current.length;e>t;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;e>t;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},m.AvailableControllerList=["StandardMouseKeyboard","Hammer"],m.ControllerList=["StandardMouseKeyboard","Hammer"],m.prototype=r.objectInherit(n.prototype,{init:function(){this._distance=25,this._target=d.create(),this._upz=d.createAndSet(0,0,1),d.init(this._target);var t=l.makeRotate(-Math.PI,0,0,1,l.create()),e=l.makeRotate(Math.PI/10,1,0,0,l.create());this._rotation=l.create(),l.mult(t,e,this._rotation),this._time=0,this._rotate=new m.Interpolator,this._pan=new m.Interpolator,this._zoom=new a.Interpolator(1),this._panFactor=1.5,this._rotateFactor=1,this._zoomFactor=1,this._inverseMatrix=l.create(),this._homeEye=void 0,this._homeCenter=void 0,this._homeUp=d.createAndSet(0,0,1),this._orientation=p.create(),this._pivotPoint=d.create(),this._eye=void 0,this._right=d.createAndSet(1,0,0),this._zoomDir=d.create();var i=this;m.ControllerList.forEach(function(t){void 0!==m[t]&&(i._controllerList[t]=new m[t](i))})},setViewer:function(t){this._viewer=t},reset:function(){this.init()},setNode:function(t){this._node=t},setPivotPoint:function(t){d.copy(t,this._pivotPoint)},setTarget:function(){var t=d.create();return function(e){d.copy(e,this._target),this.getEyePosition(t),this._distance=d.distance(t,e)}}(),setEyePosition:function(t){d.copy(t,this._eye),this._distance=d.distance(t,this._target)},setHomePosition:function(t,e,i){this._homeEye=t,this._homeCenter=e,this._homeUp=i},computeHomePosition:function(){var t=d.create(),e=d.create(),i=d.create(),r=l.create();return function(n){var a=this.getHomeBound(n);if(a){this.setDistance(this.getHomeDistance(a)),this.setTarget(a.center()),this.setPivotPoint(a.center()),void 0===this._homeEye&&(this._homeEye=d.create(),this.getEyePosition(this._homeEye)),void 0===this._homeCenter&&(this._homeCenter=d.create(),d.copy(a.center(),this._homeCenter)),void 0===this._eye&&(this._eye=d.create()),d.copy(this._homeEye,this._eye),d.copy(this._homeCenter,this._target),d.copy(this._homeUp,this._upz),l.copy(this._rotation,r);var s=this._target,o=this._eye;d.sub(s,o,t),d.normalize(t,t),d.cross(t,this._upz,e),d.normalize(e,e),d.cross(e,t,i),d.normalize(i,i),r[0]=e[0],r[1]=i[0],r[2]=-t[0],r[3]=0,r[4]=e[1],r[5]=i[1],r[6]=-t[1],r[7]=0,r[8]=e[2],r[9]=i[2],r[10]=-t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,l.getRotate(r,this._orientation),p.inverse(this._orientation,this._orientation)}}}(),setZoomFactor:function(t){this._zoomFactor=t},setRotateFactor:function(t){this._rotateFactor=t},setPanFactor:function(t){this._panFactor=t},setDistance:function(t){this._distance=t},setUsePolytopeIntersector:function(t){this._usePolytopeIntersector=t},getUsePolytopeIntersector:function(){return this._usePolytopeIntersector},getDistance:function(){return this._distance},zoom:function(t){this._distance=t},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getIntersectionVisitor:function(){return this._intersectionVisitor},getLineSegmentIntersector:function(){return this._lineSegmentIntersector},getOrCreatePolytopeIntersector:function(){return void 0===this._polytopeIntersector&&(this._polytopeIntersector=new u,this._polytopeIntersector.setIntersectionLimit(u.LIMIT_ONE_PER_DRAWABLE),this._polytopeIntersector.setDimensionMask(u.DimZero|u.DimOne)),this._polytopeIntersector},getTarget:function(t){return d.copy(this._target,t),t},getEyePosition:function(t){void 0===this._eye?this.computeEyePosition(this._target,this._distance,t):d.copy(this._eye,t)},computeEyePosition:function(){var t=d.create(),e=l.create();return function(i,r,n){l.inverse(this._rotation,e),t[1]=r,l.transformVec3(e,t,n),d.add(i,n,n)}}(),computePan:function(){var t=d.create(),e=d.create(),i=d.create();return function(r,n,a){var s=d.length(d.sub(this._eye,this._pivotPoint,i))/this._panFactor;10>s&&(s=10),t[0]=r*s/2,t[1]=n*s/2,t[2]=0,l.transformVec3(a,t,e),d.add(this._eye,e,this._eye)}}(),computeZoom:function(){var t=d.create(),e=d.create();return function(i){var r=i*this._zoomFactor;d.sub(this._pivotPoint,this._eye,t),d.add(this._eye,d.mult(t,r,e),this._eye)}}(),computeRotation:function(){var t=d.create(),e=d.create(),i=d.create(),r=d.create(),n=p.create(),a=p.create(),s=p.create(),o=d.create(),u=d.create;return function(h,l){p.transformVec3(this._orientation,this._right,e),d.normalize(e,t),d.sub(this._eye,this._pivotPoint,i);var c=d.dot(t,i);d.sub(i,d.mult(t,c,u),r);var f=d.createAndSet(-r[0],-r[1],0),g=Math.atan2(-r[2],d.length(f));l=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,g+l))-g,p.makeRotate(l*this._rotateFactor,e[0],e[1],e[2],n),p.makeRotate(h*this._rotateFactor,this._upz[0],this._upz[1],this._upz[2],a),p.mult(a,n,s),p.transformVec3(s,i,o),d.add(o,this._pivotPoint,this._eye),p.mult(a,this._orientation,this._orientation),p.transformVec3(this._orientation,this._right,e),p.makeRotate(l*this._rotateFactor,e[0],e[1],e[2],n),p.mult(n,this._orientation,this._orientation)}}(),update:function(){var t=l.create(),e=l.create();return function(i){var r=i.getFrameStamp().getDeltaTime(),n=10,a=this._rotate.update();this.computeRotation(-a[0]*n,a[1]*n),l.makeRotateFromQuat(this._orientation,t);var s=this._pan.update();this.computePan(-s[0]*n,-s[1]*n,t),a=this._zoom.update(r),this.computeZoom(-a[0]/10),l.makeTranslate(this._eye[0],this._eye[1],this._eye[2],e),l.mult(e,t,this._inverseMatrix),l.inverse(this._inverseMatrix,this._inverseMatrix)}}(),getInverseMatrix:function(){return this._inverseMatrix},computeIntersections:function(){var t=[],e=d.create();return function(i){var r=this._camera.getView(),n=this._camera,a=n.getViewport().width(),s=n.getViewport().height();this._rotate.setWidth(a),this._rotate.setHeight(s),this._pan.setWidth(a),this._pan.setHeight(s);var o,u;if(0!==(4&this._dimensionMask)&&(t=r.computeIntersections(i[0],i[1]),t.length>0&&(o=t[0].point,t[0].nodepath.shift(),u=h.computeLocalToWorld(t[0].nodepath),l.transformVec3(u,o,e),this.setPivotPoint(e))),0===t.length&&this._usePolytopeIntersector){var c=this.getOrCreatePolytopeIntersector();c.reset(),c.setPolytopeFromWindowCoordinates(i[0]-5,i[1]-5,i[0]+5,i[1]+5);var d=this._intersectionVisitor;d.setIntersector(c),r.getCamera().accept(d),t=c.getIntersections(),t.sort(function(t,e){return t._distance-e._distance}),t.length>0&&(o=t[0]._center,t[0].nodePath.shift(),u=h.computeLocalToWorld(t[0].nodePath),l.transformVec3(u,o,e),this.setPivotPoint(e))}}}(),getPositionRelativeToCanvas:function(){var t=c.create(),e=c.create();return function(i,r){var n=this._camera._graphicContext.canvas;this.getOffsetRect(n,t);var a=n.width/n.clientWidth,s=n.height/n.clientHeight;return e[0]=(i-t[1])*a,e[1]=(n.clientHeight-(r-t[0]))*s,e}}(),getCanvasCenter:function(){var t=c.create(),e=c.create();return function(){var i=this._camera.getGraphicContext().canvas;this.getOffsetRect(i,t);var r=i.width/i.clientWidth,n=i.height/i.clientHeight;return e[0]=i.clientWidth/2*r,e[1]=i.clientHeight/2*n,e}}(),getOffsetRect:function(t,e){var i=t.getBoundingClientRect(),r=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||r.scrollTop,s=window.pageXOffset||n.scrollLeft||r.scrollLeft,o=n.clientTop||r.clientTop||0,u=n.clientLeft||r.clientLeft||0,h=i.top+a-o,l=i.left+s-u;return e[0]=Math.round(h),e[1]=Math.round(l),e}}),m.StandardMouseKeyboard=f,m.Hammer=g,t.exports=m},function(t,e,i){"use strict";var r=i(1117),n=i(1122),a=i(1109),s=function(t){this._boundStrategy=t,void 0===this._boundStrategy&&(this._boundStrategy=s.COMPUTE_HOME_USING_SPHERE),this._controllerList={},this._inverseMatrix=n.create(),this._camera=void 0,this._node=void 0,this._frustum={}};s.prototype={setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setNode:function(t){this._node=t},getHomeBound:function(t){var e=this._node;if(e){var i=void 0!==t?t:this._boundStrategy;if((i===!0||i===!1)&&(a.warn("Manipulator.getHomeBound with boolean is deprecated, pass a type instead"),
i=i?s.COMPUTE_HOME_USING_BBOX:s.COMPUTE_HOME_USING_SPHERE),i&s.COMPUTE_HOME_USING_BBOX){var n=new r,o=e.getBoundingBox();if(o.valid()&&n.expandByBoundingBox(o),i&s.COMPUTE_HOME_USING_SPHERE){var u=e.getBound();if(u.radius()<n.radius())return u}return n}return e.getBound()}},getHomeDistance:function(t){var e=this._frustum,i=t.radius();if(this._camera&&n.getFrustum(this._camera.getProjectionMatrix(),e)){var r=Math.abs(e.right-e.left)/e.zNear/2,a=Math.abs(e.top-e.bottom)/e.zNear/2;i/=Math.sin(Math.atan2(r>a?a:r,1))}else i*=1.5;return i},update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},s.COMPUTE_HOME_USING_SPHERE=1,s.COMPUTE_HOME_USING_BBOX=2,t.exports=s},function(t,e,i){"use strict";var r=i(1105),n=i(1114),a=i(1122),s=i(1230),o=i(1232),u=i(1234),h=i(1235),l=i(1236),c=i(1237),d=i(1239),p=function(t){s.call(this,t),this._homePosition=n.create(),this._frustum={},this.init()};p.Interpolator=function(t,e){this._current=new Float32Array(t),this._target=new Float32Array(t),this._delta=new Float32Array(t),this._delay=void 0!==e?e:.15,this._reset=!1,this._start=0,this.reset()},p.Interpolator.prototype={setDelay:function(t){this._delay=t},reset:function(){for(var t=0,e=this._current.length;e>t;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(t){for(var e=Math.min(1,this._delay*t*60),i=0,r=this._current.length;r>i;i++){var n=(this._target[i]-this._current[i])*e;this._delta[i]=n,this._current[i]+=n}return this._delta},set:function(){for(var t=0,e=this._current.length;e>t;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;e>t;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta},getStart:function(){return this._start},setStart:function(t){this._start=t}},p.AvailableControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer","DeviceOrientation","WebVR"],p.ControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer","DeviceOrientation","WebVR"];var f=.99;p.prototype=r.objectInherit(s.prototype,{init:function(){this._distance=25,this._target=n.create(),this._upz=n.createAndSet(0,0,1),n.init(this._target);var t=a.makeRotate(-Math.PI,0,0,1,a.create()),e=a.makeRotate(Math.PI/10,1,0,0,a.create());this._rotation=a.create(),a.mult(t,e,this._rotation),this._time=0,this._vrMatrix=a.create(),this._rotate=new p.Interpolator(2),this._pan=new p.Interpolator(2),this._zoom=new p.Interpolator(1),this._maxDistance=1/0,this._minDistance=1e-4,this._minSpeed=1e-4,this._scaleMouseMotion=1,this._inverseMatrix=a.create(),this._autoPushTarget=!0;var i=this;p.ControllerList.forEach(function(t){void 0!==p[t]&&(i._controllerList[t]=new p[t](i))})},setDelay:function(t){this._rotate.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},reset:function(){this.init()},setTarget:function(t){n.copy(t,this._target);var e=n.create();this.getEyePosition(e),this._distance=n.distance(e,t)},setEyePosition:function(){var t=n.create(),e=n.create(),i=n.create();return function(r){var a=this._rotation,s=this._target;n.sub(r,s,t),n.normalize(t,t),n.cross(t,this._upz,e),n.normalize(e,e),n.cross(e,t,i),n.normalize(i,i),a[0]=e[0],a[1]=t[0],a[2]=i[0],a[3]=0,a[4]=e[1],a[5]=t[1],a[6]=i[1],a[7]=0,a[8]=e[2],a[9]=t[2],a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this._distance=n.distance(r,s)}}(),computeHomePosition:function(t){var e=this.getHomeBound(t);e&&e.valid()&&(this.setDistance(this.getHomeDistance(e)),this.setTarget(e.center()))},getHomePosition:function(){if(void 0!==this._node){var t=this._target,e=this.getDistance();this.computeEyePosition(t,e,this._homePosition)}return this._homePosition},setMaxDistance:function(t){this._maxDistance=t},getMaxDistance:function(){return this._maxDistance},setMinDistance:function(t){this._minDistance=Math.max(1e-4,t)},getMinDistance:function(){return this._minDistance},setMinSpeed:function(t){this._minSpeed=t},getMinSpeed:function(){return this._minSpeed},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},getSpeedFactor:function(){return Math.max(this._distance,this._minSpeed)},computePan:function(){var t=a.create(),e=n.create(),i=n.create();return function(r,s){var o=this._camera.getProjectionMatrix(),u=1===o[15]?1:2/o[5],h=this.getSpeedFactor()*u;s*=h,r*=h,a.inverse(this._rotation,t),e[0]=a.get(t,0,0),e[1]=a.get(t,0,1),e[2]=a.get(t,0,2),n.normalize(e,e),i[0]=a.get(t,2,0),i[1]=a.get(t,2,1),i[2]=a.get(t,2,2),n.normalize(i,i),n.mult(e,-r,e),n.mult(i,s,i),n.add(this._target,e,this._target),n.add(this._target,i,this._target)}}(),computeRotation:function(){var t=a.create(),e=a.create(),i=a.create(),r=n.create(),s=2*Math.acos(f);return function(n,o){return a.makeRotate(-n/10,0,0,1,t),a.mult(this._rotation,t,e),o=Math.max(Math.min(o/10,s),-s),a.makeRotate(-o,1,0,0,t),a.mult(t,e,i),a.transformVec3(i,this._upz,r),Math.abs(r[1])>f?void a.copy(e,this._rotation):void a.copy(i,this._rotation)}}(),computeZoom:function(t){this.zoom(t)},setAutoPushTarget:function(t){this._autoPushTarget=t},zoom:function(){var t=n.create();return function(e){var i=this._distance+this.getSpeedFactor()*(e-1);i<this._minDistance&&(this._autoPushTarget&&(n.sub(this._target,this.getEyePosition(t),t),n.normalize(t,t),n.mult(t,this._minDistance-i,t),n.add(this._target,t,this._target)),i=this._minDistance),i>this._maxDistance&&(i=this._maxDistance),this._distance=i}}(),getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(t){return n.copy(this._target,t)},getEyePosition:function(t){return this.computeEyePosition(this._target,this._distance,t),t},computeEyePosition:function(){var t=n.create(),e=a.create();return function(i,r,s){a.inverse(this._rotation,e),t[1]=r,a.transformVec3(e,t,s),n.add(i,s,s)}}(),update:function(){var t=n.create();return function(e){var i,r=e.getFrameStamp().getDeltaTime(),s=.1;i=this._rotate.update(r),this.computeRotation(-i[0]*s*this._scaleMouseMotion,-i[1]*s*this._scaleMouseMotion);var o=.002;i=this._pan.update(r),this.computePan(-i[0]*o,-i[1]*o),i=this._zoom.update(r),this.computeZoom(1+i[0]/10);var u=this._target,h=this._distance;a.inverse(this._rotation,this._inverseMatrix),a.postMult(this._vrMatrix,this._inverseMatrix),n.set(0,h,0,t),a.transformVec3(this._inverseMatrix,t,t),a.makeLookAt(n.add(u,t,t),u,this._upz,this._inverseMatrix)}}(),setPoseVR:function(t){a.makeRotateFromQuat(t,this._vrMatrix)}}),p.DeviceOrientation=o,p.GamePad=u,p.Hammer=h,p.LeapMotion=l,p.WebVR=d,p.StandardMouseKeyboard=c,t.exports=p},function(t,e,i){"use strict";var r=i(1125),n=i(1114),a=i(1233),s=function(t){this._manipulator=t,this.init()};s.prototype={init:function(){this._stepFactor=1,this._quat=r.create(),this._pos=n.create()},update:function(t,e){a.computeQuaternion(this._quat,t,e),this._manipulator.setPoseVR(this._quat,this._pos)}},t.exports=s},function(t,e,i){"use strict";var r=i(1125),n=i(1114),a=Math.PI/180,s=function(t,e,i,r,n){var a=Math.cos(t/2),s=Math.cos(e/2),o=Math.cos(i/2),u=Math.sin(t/2),h=Math.sin(e/2),l=Math.sin(i/2);return"XYZ"===r?(n[0]=u*s*o+a*h*l,n[1]=a*h*o-u*s*l,n[2]=a*s*l+u*h*o,n[3]=a*s*o-u*h*l):"YXZ"===r?(n[0]=u*s*o+a*h*l,n[1]=a*h*o-u*s*l,n[2]=a*s*l-u*h*o,n[3]=a*s*o+u*h*l):"ZXY"===r?(n[0]=u*s*o-a*h*l,n[1]=a*h*o+u*s*l,n[2]=a*s*l+u*h*o,n[3]=a*s*o-u*h*l):"ZYX"===r?(n[0]=u*s*o-a*h*l,n[1]=a*h*o+u*s*l,n[2]=a*s*l-u*h*o,n[3]=a*s*o+u*h*l):"YZX"===r?(n[0]=u*s*o+a*h*l,n[1]=a*h*o+u*s*l,n[2]=a*s*l-u*h*o,n[3]=a*s*o-u*h*l):"XZY"===r&&(n[0]=u*s*o-a*h*l,n[1]=a*h*o-u*s*l,n[2]=a*s*l+u*h*o,n[3]=a*s*o+u*h*l),n},o=function(t){this._manipulator=t,this.init()};o.computeQuaternion=function(){var t=r.create(),e=r.createAndSet(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(i,n,o){var u=n.alpha*a,h=n.beta*a,l=n.gamma*a,c=o*a;s(h,u,-l,"YXZ",i);var d=-c/2;t[1]=Math.sin(d),t[3]=Math.cos(d),r.mult(i,t,i),r.mult(i,e,i);var p=i[1];return i[1]=-i[2],i[2]=p,i}}(),o.prototype={init:function(){this._stepFactor=1,this._quat=r.create(),this._pos=n.create()},update:function(t,e){o.computeQuaternion(this._quat,t,e),this._manipulator.setPoseVR(this._quat,this._pos)}},t.exports=o},function(t,e,i){"use strict";var r=i(1168),n=function(t){this._manipulator=t,this.init()};n.prototype={init:function(){this._delay=.15,this._threshold=.08,this._mode=0,this._padFactor=10,this._zoomFactor=.5,this._rotateFactor=5},addPan:function(t,e,i){t.setDelay(this._delay),t.addTarget(e*this._padFactor,i*this._padFactor)},addZoom:function(t,e){t.setDelay(this._delay),t.addTarget(e*this._zoomFactor)},addRotate:function(t,e,i){t.setDelay(this._delay),t.addTarget(e*this._rotateFactor,i*this._rotateFactor)},gamepadaxes:function(t){var e=.005,i=this._manipulator.getRotateInterpolator(),r=this._manipulator.getZoomInterpolator(),n=this._manipulator.getPanInterpolator();4===t.length?((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addRotate(i,-t[0],t[1]),Math.abs(t[3])>e&&this.addZoom(r,-t[3])):t.length>=5&&((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addPan(n,-t[0],t[1]),Math.abs(t[2])>e&&this.addZoom(r,-t[2]),(Math.abs(t[3])>e||Math.abs(t[4])>e)&&this.addRotate(i,t[4],t[3]))},gamepadbuttondown:function(t){if(t.button>=12&&t.button<=15){var e=this._manipulator.getPanInterpolator(),i=e.getTarget(),n={12:r.createAndSet(0,-1),13:r.createAndSet(0,1),14:r.createAndSet(-1,0),15:r.createAndSet(1,0)}[t.button];e.setDelay(this._delay),e.setTarget(i[0]-10*n[0],i[1]+10*n[1])}},update:function(t){if(t){var e=t.axes,i=t.buttons;this.gamepadaxes(e);for(var r=function(){},n=0;n<i.length;n++)i[n]&&this.gamepadbuttondown({preventDefault:r,gamepad:t,button:n},!!i[n])}}},t.exports=n},function(t,e,i){"use strict";var r=i(1109),n=function(t){this._manipulator=t,this.init()};n.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._delay=.15},setEventProxy:function(t){if(void 0!==t&&(void 0===t||t!==this._eventProxy)){this._eventProxy=t;var e=this,i=t,n=function(t){return void 0!==t.pointers?t.pointers.length:1},a=function(t){return"touches "+n(t)+" distance "+t.distance+" x "+t.deltaX+" y "+t.deltaY};i.get("pinch").set({threshold:.1}),i.get("pan").set({threshold:0,pointers:0}),i.get("pinch").recognizeWith(i.get("pan")),this._cbPanStart=function(t){var i=e._manipulator;if(i&&!e._transformStarted&&"mouse"!==t.pointerType){var s=t;e._dragStarted=!0,e._nbPointerLast=n(s),2===e._nbPointerLast?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(t.center.x*e._panFactorX,t.center.y*e._panFactorY)):(i.getRotateInterpolator().reset(),i.getRotateInterpolator().set(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY)),r.debug("drag start, "+a(s))}},this._cbPanMove=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){var s=t,o=n(s);e._nbPointerLast!==o&&(2===o?i.getPanInterpolator().reset():i.getRotateInterpolator().reset(),e._nbPointerLast=o),2===o?(i.getPanInterpolator().setTarget(t.center.x*e._panFactorX,t.center.y*e._panFactorY),r.debug("pan, "+a(s))):(i.getRotateInterpolator().setDelay(e._delay),i.getRotateInterpolator().setTarget(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY),r.debug("rotate, "+a(s)))}},this._cbPanEnd=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){e._dragStarted=!1;var n=t;r.debug("drag end, "+a(n))}},this._cbPinchStart=function(t){var i=e._manipulator;if(i&&"mouse"!==t.pointerType){e._transformStarted=!0;var n=t;e._lastScale=n.scale,i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(e._lastScale),t.preventDefault(),r.debug("zoom start, "+a(n))}},this._cbPinchEnd=function(t){"mouse"!==t.pointerType&&(e._transformStarted=!1,r.debug("zoom end, "+a(t)))},this._cbPinchInOut=function(t){var i=e._manipulator;if(i&&e._transformStarted&&"mouse"!==t.pointerType){var n=t,s=n.scale>e._lastScale?e._zoomFactor:4*e._zoomFactor,o=(n.scale-e._lastScale)*s;e._lastScale=n.scale,i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0]-o),r.debug("zoom, "+a(n))}},i.on("panstart ",this._cbPanStart),i.on("panmove",this._cbPanMove),i.on("panend",this._cbPanEnd),i.on("pinchstart",this._cbPinchStart),i.on("pinchend",this._cbPinchEnd),i.on("pinchin pinchout",this._cbPinchInOut)}},removeEventProxy:function(t){t&&this._eventProxy&&(t.off("panstart ",this._cbPanStart),t.off("panmove",this._cbPanMove),t.off("panend",this._cbPanEnd),t.off("pinchstart",this._cbPinchStart),t.off("pinchend",this._cbPinchEnd),t.off("pinchin pinchout",this._cbPinchInOut))},setManipulator:function(t){this._manipulator=t}},t.exports=n},function(t,e,i){"use strict";var r=i(1109),n=i(1168),a=i(1114),s=function(t){this._manipulator=t,this.init()},o={rotate:{dtx:-1.44,dty:-1.08,dtz:-.1,delay:.05,method:"getRotateInterpolator"},pan:{dtx:-1.44,dty:-1.08,delay:.05,method:"getPanInterpolator"},zoom:{dtx:0,dty:-.5,delay:.05,method:"getZoomInterpolator"},"zoom-twohands":{dtx:-.05,dty:0,delay:.05,method:"getZoomInterpolator"}};s.prototype={init:function(){this._virtualCursor=n.createAndSet(0,0),this._targetPosition=n.createAndSet(0,0),this._previousFrame=void 0,this._displacement=n.createAndSet(0,0),this._top=n.createAndSet(0,1,0),this._motion=n.createAndSet(0,0),this._delay=.05,this._threshold=.08,this._directionDotThreshold=.5,this._mode="rotate"},update:function(t){if(this._previousFrame||(this._previousFrame=t),0!==t.fingers.length){var e=this._previousFrame.translation(t);if(this._previousFrame=t,0!==t.hands.length&&!(Math.abs(e[0])<this._threshold&&Math.abs(e[1])<this._threshold)){var i=this._mode,n=0;if(t.gestures.length>0)for(var s=0;s<t.gestures.length;s++){var u=t.gestures[s];if("circle"===u.type)return void this._manipulator.computeHomePosition()}if(1===t.hands.length)t.hands[0].fingers.length>=3?(i="zoom",n=t.hands[0].palmPosition[1]/10,n=Math.max(n-4,.01)):i=t.hands[0].fingers.length>1?"pan":"rotate";else if(2===t.hands.length){var h=Math.abs(a.dot(t.hands[0].palmNormal,this._top)),l=Math.abs(a.dot(t.hands[1].palmNormal,this._top));h<this._directionDotThreshold&&l<this._directionDotThreshold?i="zoom-twohands":(i=void 0,this._handsDistanceOld=void 0)}var c=this._manipulator.getZoomInterpolator();if(void 0!==i){if(i!==this._mode)return r.info("Switch to mode "+i),this._motion[0]=0,this._motion[1]=0,this._mode=i,void(("zoom"===i||"zoom-twohands"===i)&&c.isReset()&&(c.setStart(1),c.set(0)));var d,p,f;d=o[i].dtx,p=o[i].dty,f=o[i].dtz,this._motion[0]+=e[0]*d,this._motion[1]+=e[1]*p;var g=o[i].delay,m=o[i].method;if(this._manipulator[m]().setDelay(g),"zoom"===i)r.log(n),c.setTarget(n);else if("zoom-twohands"===i){var v=a.distance(t.hands[0].palmPosition,t.hands[1].palmPosition);if(void 0!==this._handsDistanceOld){var _=d*(v-this._handsDistanceOld);n=c._target,n[0]+=_}this._handsDistanceOld=v}else"rotate"===i&&(n=c._target[0],n+=e[2]*f,n=Math.max(n,.01),c.setTarget(n)),this._manipulator[m]().addTarget(this._motion[0],this._motion[1]);this._motion[1]=this._motion[0]=0}}}}},t.exports=s},function(t,e,i){"use strict";var r=i(1115),n=i(1238),a=function(t){this._manipulator=t,this.init()};a.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0,this._delay=.15},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t),i=this._manipulator;if(r.isNaN(e[0])===!1&&r.isNaN(e[1])===!1){var a=this.getMode();if(a===n.ROTATE)i.getRotateInterpolator().setDelay(this._delay),i.getRotateInterpolator().setTarget(e[0],e[1]);else if(a===n.PAN)i.getPanInterpolator().setTarget(e[0],e[1]);else if(a===n.ZOOM){var s=i.getZoomInterpolator();s.isReset()&&(s.setStart(e[1]),s.set(0));var o=e[1]-s.getStart();s.setStart(e[1]);var u=s.getTarget()[0];s.setTarget(u-o/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator,i=this.getMode();void 0===i&&(0===t.button?t.shiftKey?this.setMode(n.PAN):t.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.ROTATE):this.setMode(n.PAN)),this.pushButton();var r=this._eventProxy.getPositionRelativeToCanvas(t);i=this.getMode(),i===n.ROTATE?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(r[0],r[1])):i===n.PAN?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(r[0],r[1])):i===n.ZOOM&&(e.getZoomInterpolator().setStart(r[1]),e.getZoomInterpolator().set(0)),t.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mouseout:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var i=this._manipulator;t.preventDefault();var r=i.getZoomInterpolator().getTarget()[0]-e;i.getZoomInterpolator().setTarget(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){32===t.keyCode?(this._manipulator.computeHomePosition(),t.preventDefault()):t.keyCode===this._panKey&&this.getMode()!==n.PAN?(this.setMode(n.PAN),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==n.ZOOM?(this.setMode(n.ZOOM),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==n.ROTATE&&(this.setMode(n.ROTATE),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},t.exports=a},function(t,e){"use strict";t.exports={ROTATE:0,PAN:1,ZOOM:2}},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){},update:function(t,e){this._manipulator.setPoseVR(t,e)}},t.exports=i},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=i(1122),s=i(1126),o=i(1128),u=function(){n.call(this),this._intersector=void 0,this._projectionStack=[a.identity],this._modelStack=[a.identity],this._viewStack=[a.identity],this._windowStack=[a.identity],this.reset()};u.prototype=r.objectInherit(n.prototype,{reset:function(){u._reservedMatrixStack.reset()},setIntersector:function(t){this._intersector=t},getIntersector:function(){return this._intersector},pushModelMatrix:function(t){this._modelStack.push(t)},getModelMatrix:function(){return this._modelStack.length?this._modelStack[this._modelStack.length-1]:void 0},popModelMatrix:function(){return this._modelStack.pop()},pushViewMatrix:function(t){this._viewStack.push(t)},getViewMatrix:function(){return this._viewStack.length?this._viewStack[this._viewStack.length-1]:void 0},popViewMatrix:function(){return this._viewStack.pop()},pushProjectionMatrix:function(t){this._projectionStack.push(t)},getProjectionMatrix:function(){return this._projectionStack.length?this._projectionStack[this._projectionStack.length-1]:void 0},popProjectionMatrix:function(){return this._projectionStack.pop()},pushWindowMatrix:function(t){this._windowStack.push(t)},pushWindowMatrixUsingViewport:function(t){this._windowStack.push(t.computeWindowMatrix(u._reservedMatrixStack.get()))},getWindowMatrix:function(){return this._windowStack.length?this._windowStack[this._windowStack.length-1]:void 0},popWindowMatrix:function(){return this._windowStack.pop()},getTransformation:function(){var t=new Float64Array(16);return function(){return a.copy(this.getWindowMatrix()||a.identity,t),a.preMult(t,this.getProjectionMatrix()||a.identity),a.preMult(t,this.getViewMatrix()||a.identity),a.preMult(t,this.getModelMatrix()||a.identity),t}}(),enter:function(t){return this._intersector.enter(t)},apply:function(t){t.getViewMatrix?this.applyCamera(t):t.getMatrix?this.applyTransform(t):this.applyNode(t)},applyCamera:function(t){var e=t.getViewport();void 0!==e&&this.pushWindowMatrixUsingViewport(e);var i,r,n;t.getReferenceFrame()===o.RELATIVE_RF&&this.getViewMatrix()&&this.getProjectionMatrix()?(i=a.mult(this.getProjectionMatrix(),t.getProjectionMatrix(),u._reservedMatrixStack.get()),r=this.getViewMatrix(),n=a.mult(this.getModelMatrix(),t.getViewMatrix(),u._reservedMatrixStack.get())):(i=t.getProjectionMatrix(),r=t.getViewMatrix(),n=a.makeIdentity(u._reservedMatrixStack.get())),this.pushProjectionMatrix(i),this.pushViewMatrix(r),this.pushModelMatrix(n),this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),this.popViewMatrix(),this.popProjectionMatrix(),void 0!==e&&this.popWindowMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())},applyNode:function(t){return this.enter(t)?t.primitives?void this._intersector.intersect(this,t):void(t.traverse&&this.traverse(t)):void 0},applyTransform:function(t){if(this.enter(t)){if(t.getReferenceFrame()===o.ABSOLUTE_RF){var e=u._reservedMatrixStack.get();this.pushViewMatrix(a.makeIdentity(e)),this.pushModelMatrix(t.getMatrix())}else if(this._modelStack.length>0){var i=a.copy(this.getModelMatrix(),u._reservedMatrixStack.get());a.preMult(i,t.getMatrix()),this.pushModelMatrix(i)}else this.pushModelMatrix(t.getMatrix());this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),t.getReferenceFrame()===o.ABSOLUTE_RF&&this.popViewMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())}}}),u._reservedMatrixStack=new s,t.exports=u},function(t,e,i){"use strict";var r=i(1114),n=i(1122),a=i(1191),s=function(){this._start=r.create(),this._end=r.create(),this._iStart=r.create(),this._iEnd=r.create(),this._intersections=[]};s.prototype={set:function(t,e){r.copy(t,this._start),r.copy(t,this._iStart),r.copy(e,this._end),r.copy(e,this._iEnd)},setStart:function(t){r.copy(t,this._start),r.copy(t,this._iStart)},setEnd:function(t){r.copy(t,this._end),r.copy(t,this._iEnd)},reset:function(){this._intersections.length=0},enter:function(t){return!t.isCullingActive()||this.intersects(t.getBound())},intersects:function(){var t=r.create(),e=r.create();return function(i){if(!i.valid())return!1;r.sub(this._iStart,i.center(),t);var n=r.length2(t)-i.radius2();if(0>=n)return!0;r.sub(this._iEnd,this._iStart,e);var a=r.length2(e),s=2*r.dot(t,e),o=s*s-4*a*n;if(0>o)return!1;o=Math.sqrt(o);var u=.5/a,h=(-s-o)*u,l=(-s+o)*u;return 0>=h&&0>=l?!1:h>1&&l>1?!1:!0}}(),intersect:function(){var t=new a;return function(e,i){var r=i.getShape();if(r)return r.intersectRay(this._iStart,this._iEnd,this._intersections,e.nodePath);if(t.reset(),t.setNodePath(e.nodePath),t.set(this._iStart,this._iEnd),i.computeTransformedVertices){var n=i.getVertexAttributeList(),a=n.Vertex.getElements();n.Vertex._elements=i.computeTransformedVertices(),t.apply(i),n.Vertex._elements=a}else t.apply(i);for(var s=t._intersections,o=this._intersections,u=s.length,h=0;u>h;h++)o.push(s[h]);return u>0}}(),getIntersections:function(){return this._intersections},setCurrentTransformation:function(t){n.inverse(t,t),n.transformVec3(t,this._start,this._iStart),n.transformVec3(t,this._end,this._iEnd)}},t.exports=s},function(t,e,i){"use strict";var r=i(1243),n=i(1122),a=i(1124),s=i(1114),o=function(){this._intersections=[],this._index=0,this._polytope=[],this._iPolytope=[],this._referencePlane=a.create(),this._iReferencePlane=a.create(),this._intersectionLimit=o.NO_LIMIT,this._dimensionMask=o.AllDims};o.NO_LIMIT=0,o.LIMIT_ONE_PER_DRAWABLE=1,o.LIMIT_ONE=2,o.DimZero=1,o.DimOne=2,o.DimTwo=4,o.AllDims=o.DimZero|o.DimOne|o.DimTwo,o.prototype={setPolytope:function(t){this._polytope=t,this._referencePlane[0]=t[t.length-1][0],this._referencePlane[1]=t[t.length-1][1],this._referencePlane[2]=t[t.length-1][2],this._referencePlane[3]=t[t.length-1][3]},setPolytopeFromWindowCoordinates:function(t,e,i,r){this.setPolytope([a.createAndSet(1,0,0,-t),a.createAndSet(-1,0,0,i),a.createAndSet(0,1,0,-e),a.createAndSet(0,-1,0,r),a.createAndSet(0,0,1,0)])},setDimensionMask:function(t){this._dimensionMask=t},reset:function(){this._intersections.length=0},enter:function(t){return this.reachedLimit()?!1:this.intersects(t.getBound())},reachedLimit:function(){return this._intersectionLimit===o.LIMIT_ONE&&this._intersections.length>0},intersects:function(){var t=s.create();return function(e){if(!e.valid())return!1;var i,r=e.center();s.copy(r,t);for(var n=-e.radius(),a=0,o=this._iPolytope.length;o>a;a++)if(i=this._iPolytope[a][0]*t[0]+this._iPolytope[a][1]*t[1]+this._iPolytope[a][2]*t[2]+this._iPolytope[a][3],n>=i)return!1;return!0}}(),intersect:function(t,e){if(this.reachedLimit())return!1;var i=new r;i.setNodePath(t.nodePath),i.set(this._iPolytope,this._iReferencePlane),i.setLimitOneIntersection(this._intersectionLimit===o.LIMIT_ONE_PER_DRAWABLE||this._intersectionLimit===o.LIMIT_ONE),i.setDimensionMask(this._dimensionMask),i.apply(e);var n=i._intersections.length;if(n>0){for(var a=0;n>a;a++)this._intersections.push(i._intersections[a]);return!0}return!1},getIntersections:function(){return this._intersections},setIntersectionLimit:function(t){this._intersectionLimit=t},setCurrentTransformation:function(t){for(var e,i=a.create(),r=0,s=this._polytope.length;s>r;r++){var o=this._polytope[r];n.transformVec4PostMult(t,o,i),e=1/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=e,this._iPolytope[r]=a.copy(i,a.create())}n.transformVec4PostMult(t,this._referencePlane,this._iReferencePlane),e=1/Math.sqrt(this._iReferencePlane[0]*this._iReferencePlane[0]+this._iReferencePlane[1]*this._iReferencePlane[1]+this._iReferencePlane[2]*this._iReferencePlane[2]),this._iReferencePlane[0]*=e,this._iReferencePlane[1]*=e,this._iReferencePlane[2]*=e,this._iReferencePlane[3]*=e}},t.exports=o},function(t,e,i){"use strict";var r=i(1115),n=i(1114),a=i(1197),s=function(t,e,i,r,a){this._index=t-1,this._distance=0,this._maxDistance=-1,this._numPoints=0,this._points=[],this._maxNumIntersections=6,this._center=n.create();for(var s=0,o=e.length;o>s;s++)if(0!==i[s]){this._points[this._numPoints++]=n.copy(e[s],n.create()),n.add(this._center,e[s],this._center);var u=r[0]*e[s][0]+r[1]*e[s][1]+r[2]*e[s][2]+r[3];if(u>this._maxDistance&&(this._maxDistance=u),this._numPoints===this._maxNumIntesections)break}n.mult(this._center,1/this._numPoints,this._center),this._distance=r[0]*this._center[0]+r[1]*this._center[1]+r[2]*this._center[2]+r[3],this.nodePath=a},o=function(t,e,i){this._planeMask=t,this._pos=e,this._dir=i},u=function(){this._intersections=[],this._nodePath=[],this._index=0,this._referencePlane=[],this._planes=[],this._lines=[],this._candidates=[],this._candidatesMasks=[],this._lines=[],this._planesMask=0,this._limitOneIntersection=!1,this._dimensionMask=void 0};u.prototype={setNodePath:function(t){this._nodePath=t},set:function(t,e){this._planes=t,this._referencePlane=e,this._planesMask=0,this._lines.length=0;for(var i=0;i<this._planes.length;i++)this._planesMask=this._planesMask<<1|1},setDimensionMask:function(t){this._dimensionMask=t},apply:function(t){if(t.getAttributes().Vertex){var e=t.getAttributes().Vertex.getElements(),i=this,r=function(){return{operatorPoint:function(t){i.intersectPoint(t)},operatorLine:function(t,e){i.intersectLine(t,e)},operatorTriangle:function(t,e,r){i.intersectTriangle(t,e,r)}}},n=new a(t,r,e);n.apply()}},checkCandidatePoints:function(t){for(var e=1,i=this._candidates.length,r=0,n=this._planes.length;n>r&&i>0;++r,e<<=1)if(!(t&e))for(var a=0;a<this._candidates.length;++a)if(0!==this._candidatesMasks[a]&&!(e&this._candidatesMasks[a])&&this.distance(this._planes[r],this._candidates[a])<0&&(this._candidatesMasks[a]=0,--i,0===i))return 0;return i},intersectPoint:function(){var t=n.create();return function(e){if(this._index++,0!==(1&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){for(var i,r=0,a=this._planes.length;a>r;++r)if(i=this.distance(this._planes[r],e),0>i)return;this._candidates=[],this._candidatesMasks=[],n.copy(e,t),this._candidates.push(t),this._candidatesMasks.push(this._planesMask),this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)))}}}(),intersectLine:function(){var t=n.create();return function(e,i){if(this._index++,0!==(2&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){var r=!0,a=!0,o=1,u=0;this._candidates=[],this._candidatesMasks=[];for(var h,l,c,d,p=0,f=this._planes.length;f>p;++p,o<<=1){if(h=this.distance(this._planes[p],e),l=this.distance(this._planes[p],i),c=0>h,d=0>l,c&&d)return;c||d?(c&&(r=!1),d&&(a=!1),0===h?(n.copy(e,t),this._candidates.push(t),this._candidatesMasks.push(o)):0===l?(n.copy(i,t),this._candidates.push(t),this._candidatesMasks.push(o)):c&&!d?(n.sub(i,e,t),n.mult(t,h/(-h+l),t),n.sub(e,t,t),this._candidates.push(t),this._candidatesMasks.push(o)):!c&&d&&(n.sub(i,e,t),n.mult(t,h/(h-l),t),n.add(e,t,t),this._candidates.push(t),this._candidatesMasks.push(o))):u|=o}if(u===this._planesMask)return this._candidates.push(n.copy(e,n.create())),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.copy(i,n.create())),this._candidatesMasks.push(this._planesMask),void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));var g=this.checkCandidatePoints(u);g>0&&(r&&(this._candidatesMasks.push(this._planesMask),this._candidates.push(n.copy(e,n.create()))),a&&(this._candidatesMasks.push(this._planesMask),this._candidates.push(n.copy(i,n.create()))),this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))))}}}(),intersectTriangle:function(){var t=n.create(),e=n.create(),i=n.create(),r=n.create(),a=n.create(),o=n.create(),u=n.create();return function(h,l,c){if(this._index++,0!==(4&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){var d=1,p=0;this._candidates=[],this._candidatesMasks=[];for(var f,g,m,v,_,b,x=0,A=this._planes.length;A>x;++x,d<<=1){if(f=this.distance(this._planes[x],h),g=this.distance(this._planes[x],l),m=this.distance(this._planes[x],c),v=0>f,_=0>g,b=0>m,v&&_&&b)return;v||_||b?(0===f?(n.copy(h,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d)):0===g?(n.copy(l,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d)):v&&!_?(n.sub(l,h,t),n.mult(t,f/(-f+g),t),n.sub(h,t,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d)):!v&&_&&(n.sub(l,h,t),n.mult(t,f/(f-g),t),n.add(h,t,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d)),0===m?(n.copy(c,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d)):v&&!b?(n.sub(c,h,t),n.mult(t,f/(-f+m),t),n.sub(h,t,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d)):!v&&b&&(n.sub(c,h,t),n.mult(t,f/(f-m),t),n.add(h,t,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d)),_&&!b?(n.sub(c,l,t),n.mult(t,g/(-g+m),t),n.sub(l,t,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d)):!_&&b&&(n.sub(c,l,t),n.mult(t,g/(g-m),t),n.add(l,t,t),this._candidates.push(n.copy(t,n.create())),this._candidatesMasks.push(d))):p|=d}if(p===this._planesMask)return this._candidates.push(n.copy(h,n.create())),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.copy(l,n.create())),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.copy(c,n.create())),this._candidatesMasks.push(this._planesMask),void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));
var y=this.checkCandidatePoints(p);if(y>0)return void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));var S=this.getPolytopeLines();for(this._candidates=[],n.sub(l,h,e),n.sub(c,h,i),x=0;x<S.length;++x){n.cross(S[x]._dir,i,a);var C=n.dot(e,a);if(!(Math.abs(C)<1e-6)){var w=1/C;n.sub(S[x]._pos,h,o);var T=w*n.dot(o,a);if(!(0>T||T>1)){n.cross(o,e,u);var M=w*n.dot(S[x]._dir,u);if(!(0>M||T+M>1)){var E=w*n.dot(i,u);n.mult(S[x]._dir,E,r),n.add(S[x]._pos,r,r),this._candidates.push(n.copy(r,n.create())),this._candidatesMasks.push(S[x]._planeMask)}}}}return y=this.checkCandidatePoints(p),y>0?void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))):void 0}}}(),getPolytopeLines:function(){var t=n.create(),e=n.create(),i=n.create(),a=n.create(),s=n.create(),u=n.create(),h=1e-6;return function(){if(this._lines.length>0)return this._lines;for(var l=1,c=0,d=this._planes.length;d>c;c++,l<<=1){n.copy(this.getNormal(this._planes[c]),i),n.mult(i,-this._planes[c][3],a);for(var p=l<<1,f=c+1,g=this._planes.length;g>f;++f,p<<=1)if(n.copy(this.getNormal(this._planes[f]),s),!(Math.abs(n.dot(i,s))>1-h)){n.cross(i,s,t),n.cross(t,i,e);var m=-this.distance(this._planes[f],a)/n.dot(e,s);r.isNaN(m)||(n.mult(e,m,u),n.add(a,t,t),this._lines.push(new o(l|p,n.copy(u,n.create()),n.copy(t,n.create()))))}}return this._lines}}(),setLimitOneIntersection:function(t){this._limitOneIntersection=t},distance:function(t,e){var i=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3];return i},getNormal:function(){var t=n.create();return function(e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}}()},t.exports=u},function(t,e,i){"use strict";var r=i(1231),n=function(t){this._manipulator=t,this._timer=!1,this.init()};n.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},setDimensionMask:function(t){this._dimensionMask=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._manipulator,i=e.getPositionRelativeToCanvas(t.clientX,t.clientY);if(isNaN(i[0])===!1&&isNaN(i[1])===!1){var n=this.getMode();if(n===r.Rotate)e.getRotateInterpolator().setTarget(i[0],i[1]);else if(n===r.Pan)e.getPanInterpolator().setTarget(i[0],i[1]);else if(n===r.Zoom){var a=e.getZoomInterpolator();e.computeIntersections(i),a.isReset()&&(a.setStart(i[1]),a.set(0));var s=i[1]-a.getStart();a.setStart(i[1]);var o=a.getTarget()[0];a.setTarget(o-s/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator,i=this.getMode();void 0===i&&(0===t.button?t.shiftKey?this.setMode(r.Pan):t.ctrlKey?this.setMode(r.Zoom):this.setMode(r.Rotate):this.setMode(r.Pan)),this.pushButton();var n=e.getPositionRelativeToCanvas(t.clientX,t.clientY);e.computeIntersections(n),i=this.getMode(),i===r.Rotate?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(n[0],n[1])):i===r.Pan?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(n[0],n[1])):i===r.Zoom&&(e.getZoomInterpolator().setStart(n[1]),e.getZoomInterpolator().set(0)),t.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var i=this._manipulator;t.preventDefault();var r=i.getZoomInterpolator().getTarget()[0]-e;i.getZoomInterpolator().setTarget(r);var n;if(this._timer===!1){this._timer=!0;var a=this;clearTimeout(n),n=setTimeout(function(){a._timer=!1},200);var s=i.getPositionRelativeToCanvas(t.clientX,t.clientY);i.computeIntersections(s)}},dblclick:function(t){var e=this._manipulator;t.preventDefault(),e.getZoomInterpolator().set(0);var i=e.getZoomInterpolator().getTarget()[0]-10;e.getZoomInterpolator().setTarget(i);var r=e.getPositionRelativeToCanvas(t.clientX,t.clientY);e.computeIntersections(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){32===t.keyCode?(this._manipulator.computeHomePosition(),t.preventDefault()):t.keyCode===this._panKey&&this.getMode()!==r.Pan?(this.setMode(r.Pan),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==r.Zoom?(this.setMode(r.Zoom),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==r.Rotate&&(this.setMode(r.Rotate),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},t.exports=n},function(t,e,i){"use strict";var r=i(1109),n=function(t){this._manipulator=t,this._timer=!1,this.init()};n.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._lastPos=void 0},setEventProxy:function(t){if(void 0!==t&&(void 0===t||t!==this._eventProxy)){this._eventProxy=t;var e=this,i=t,n=function(t){return void 0!==t.pointers?t.pointers.length:1},a=function(t){return"touches "+n(t)+" distance "+t.distance+" x "+t.deltaX+" y "+t.deltaY};i.get("pinch").set({threshold:.1}),i.get("pan").set({threshold:0,pointers:0}),i.get("pinch").recognizeWith(i.get("pan")),i.get("tap").set({taps:2,posThreshold:300}),this._cbPanStart=function(t){var i=e._manipulator;if(i&&!e._transformStarted&&"mouse"!==t.pointerType){var s=t;e._dragStarted=!0,e._nbPointerLast=n(s);var o;2===e._nbPointerLast?(o=i.getPositionRelativeToCanvas(t.center.x,t.center.y),e._lastPos=o):o=void 0===e._lastPos?i.getCanvasCenter():e._lastPos,i.computeIntersections(o),2===e._nbPointerLast?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(t.center.x*e._panFactorX,t.center.y*e._panFactorY)):i.getRotateInterpolator().reset(),r.debug("drag start, "+a(s))}},this._cbPanMove=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){var s=t,o=n(s);e._nbPointerLast!==o&&(2===o?i.getPanInterpolator().reset():i.getRotateInterpolator().reset(),e._nbPointerLast=o),2===o?(i.getPanInterpolator().setTarget(t.center.x*e._panFactorX,t.center.y*e._panFactorY),r.debug("pan, "+a(s))):(i.getRotateInterpolator().setTarget(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY),r.debug("rotate, "+a(s)))}},this._cbPanEnd=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){e._dragStarted=!1;var n=t;r.debug("drag end, "+a(n))}},this._cbPinchStart=function(t){var i=e._manipulator;if(i&&"mouse"!==t.pointerType){e._transformStarted=!0;var n=t;e._lastScale=n.scale,i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(e._lastScale),t.preventDefault(),r.debug("zoom start, "+a(n))}},this._cbPinchEnd=function(t){"mouse"!==t.pointerType&&(e._transformStarted=!1,r.debug("zoom end, "+a(t)))},this._cbPinchInOut=function(t){var i=e._manipulator;if(i&&e._transformStarted&&"mouse"!==t.pointerType){var n=t,s=n.scale>e._lastScale?e._zoomFactor:4*e._zoomFactor,o=(n.scale-e._lastScale)*s;e._lastScale=n.scale,i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0]-o),r.debug("zoom, "+a(n))}},this._cbDoubleTap=function(t){var i=e._manipulator;if(i&&"mouse"!==t.pointerType){var n=t,s=i.getPositionRelativeToCanvas(t.center.x,t.center.y);e._lastPos=s,i.getZoomInterpolator().set(0);var o=i.getZoomInterpolator().getTarget()[0]-10;i.getZoomInterpolator().setTarget(o),r.debug("tap, "+a(n))}},i.on("panstart ",this._cbPanStart),i.on("panmove",this._cbPanMove),i.on("panend",this._cbPanEnd),i.on("pinchstart",this._cbPinchStart),i.on("pinchend",this._cbPinchEnd),i.on("pinchin pinchout",this._cbPinchInOut),i.on("tap",this._cbDoubleTap)}},removeEventProxy:function(t){t&&this._eventProxy&&(t.off("panstart ",this._cbPanStart),t.off("panmove",this._cbPanMove),t.off("panend",this._cbPanEnd),t.off("pinchstart",this._cbPinchStart),t.off("pinchend",this._cbPinchEnd),t.off("pinchin pinchout",this._cbPinchInOut),t.off("tap",this._cbDoubleTap))},setManipulator:function(t){this._manipulator=t}},t.exports=n},function(t,e,i){"use strict";var r=i(1105),n=i(1230),a=i(1231),s=i(1122),o=i(1168),u=i(1114),h=i(1125),l=i(1233),c=i(1247),d=i(1248),p=i(1249),f=function(t){n.call(this,t),this.init()};f.AvailableControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],f.ControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],f.prototype=r.objectInherit(n.prototype,{computeHomePosition:function(t){var e=this.getHomeBound(t);if(e&&e.valid()){this._distance=this.getHomeDistance(e);var i=e.center();u.mult(this._direction,-this._distance,this._eye),u.add(i,this._eye,this._eye),this.setTarget(i)}},init:function(){this._direction=u.createAndSet(0,1,0),this._eye=u.createAndSet(0,25,10),this._up=u.createAndSet(0,0,1),this._distance=1,this._forward=new a.Interpolator(1),this._side=new a.Interpolator(1),this._lookPosition=new a.Interpolator(2),this._pan=new a.Interpolator(2),this._zoom=new a.Interpolator(1),this._stepFactor=1,this._angleVertical=0,this._angleHorizontal=0,this._tmpGetTargetDir=u.create(),this._vrEnable=!1,this._vrRot=h.create(),this._vrPos=u.create(),this._vrTrans=u.create();var t=this;this._controllerList={},f.ControllerList.forEach(function(e){void 0!==f[e]&&(t._controllerList[e]=new f[e](t))})},setDelay:function(t){this._forward.setDelay(t),this._side.setDelay(t),this._lookPosition.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},getEyePosition:function(t){return t[0]=this._eye[0],t[1]=this._eye[1],t[2]=this._eye[2],t},setEyePosition:function(t){return this._eye[0]=t[0],this._eye[1]=t[1],this._eye[2]=t[2],this},getTarget:function(t){var e=u.mult(this._direction,this._distance,this._tmpGetTargetDir);return u.add(this._eye,e,t),t},setTarget:function(t){var e=this._tmpGetTargetDir;u.sub(t,this._eye,e),e[2]=0,u.normalize(e,e),this._angleHorizontal=Math.acos(e[1]),e[0]<0&&(this._angleHorizontal=-this._angleHorizontal),u.sub(t,this._eye,e),u.normalize(e,e),this._angleVertical=-Math.asin(e[2]),u.copy(e,this._direction)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getForwardInterpolator:function(){return this._forward},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getRotateInterpolator:function(){return this._lookPosition},computeRotation:function(){var t=s.create(),e=s.create(),i=u.createAndSet(0,1,0),r=u.createAndSet(0,0,1),n=.5*Math.PI;return function(a,o){this._angleVertical+=.01*o,this._angleHorizontal-=.01*a,this._angleVertical>n?this._angleVertical=n:this._angleVertical<-n&&(this._angleVertical=-n),this._vrEnable?(h.transformVec3(this._vrRot,i,this._direction),u.normalize(this._direction,this._direction),h.transformVec3(this._vrRot,r,this._up)):(s.makeRotate(-this._angleVertical,1,0,0,t),s.makeRotate(-this._angleHorizontal,0,0,1,e),s.preMult(e,t),s.transformVec3(e,i,this._direction),u.normalize(this._direction,this._direction),s.transformVec3(e,r,this._up))}}(),reset:function(){this.init()},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},setStepFactor:function(t){this._stepFactor=t},computePosition:function(){var t=o.create();return function(e){this._forward.update(e),this._side.update(e);var i=this._distance<.001?.001:this._distance,r=this._camera.getProjectionMatrix(),n=1===r[15]?1:2/r[5];t[0]=this._forward.getCurrent()[0],t[1]=this._side.getCurrent()[0];var a=o.length2(t);a>1&&o.mult(t,1/Math.sqrt(a),t);var s=this._pan.update(e),h=this._zoom.update(e),l=this._stepFactor*i*n*e,c=this._stepFactor*i*n*.005;this.moveForward(t[0]*l-h[0]*c*20),this.strafe(t[1]*l-s[0]*c),this.strafeVertical(-s[1]*c),this._vrEnable&&(u.add(this._eye,this._vrTrans,this._eye),u.init(this._vrTrans))}}(),update:function(){var t=u.create();return function(e){var i=e.getFrameStamp().getDeltaTime(),r=this._lookPosition.update(i);this.computeRotation(.5*-r[0],.5*-r[1]),this.computePosition(i),u.add(this._eye,this._direction,t),s.makeLookAt(this._eye,t,this._up,this._inverseMatrix),this._vrEnable=!1}}(),setPoseVR:function(t,e){this._vrEnable=!0,h.copy(t,this._vrRot),u.sub(e,this._vrPos,this._vrTrans),u.copy(e,this._vrPos)},moveForward:function(){var t=u.create();return function(e){u.normalize(this._direction,t),u.mult(t,e,t),u.add(this._eye,t,this._eye)}}(),strafe:function(){var t=u.create();return function(e){u.cross(this._direction,this._up,t),u.normalize(t,t),u.mult(t,e,t),u.add(this._eye,t,this._eye)}}(),strafeVertical:function(){var t=u.create();return function(e){u.normalize(this._up,t),u.mult(t,e,t),u.add(this._eye,t,this._eye)}}()}),f.DeviceOrientation=l,f.Hammer=c,f.WebVR=d,f.StandardMouseKeyboard=p,t.exports=f},function(t,e,i){"use strict";var r=i(1235);t.exports=r},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){},update:function(t,e){this._manipulator.setPoseVR(t,e)}},t.exports=i},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){this.releaseButton(),this._delay=.15,this._stepFactor=1},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t,this._manipulator.setStepFactor(this._stepFactor)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},mousedown:function(t){var e=this._eventProxy.getPositionRelativeToCanvas(t),i=this._manipulator;i.getLookPositionInterpolator().set(e[0],e[1]),this.pushButton()},mouseup:function(){this.releaseButton()},mouseout:function(){this.releaseButton()},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t);this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(e[0],e[1])}},mousewheel:function(t,e){t.preventDefault(),this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*e),4),this._manipulator.setStepFactor(this._stepFactor)},keydown:function(t){var e=this._manipulator;if(32===t.keyCode)e.computeHomePosition(),t.preventDefault();else{if(87===t.keyCode||90===t.keyCode||38===t.keyCode)return e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(1),t.preventDefault(),!1;if(83===t.keyCode||40===t.keyCode)return e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(-1),t.preventDefault(),!1;if(68===t.keyCode||39===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(1),t.preventDefault(),!1;if(65===t.keyCode||81===t.keyCode||37===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(-1),t.preventDefault(),!1}},keyup:function(t){var e=this._manipulator;return 87===t.keyCode||90===t.keyCode||38===t.keyCode||83===t.keyCode||40===t.keyCode?(e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(0),!1):68===t.keyCode||39===t.keyCode||65===t.keyCode||81===t.keyCode||37===t.keyCode?(e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(0),!1):void 0}},t.exports=i},function(t,e){"use strict";var i=function(){this._manipulatorList=[],this._currentManipulator=void 0};i.prototype={getCamera:function(){return this.getCurrentManipulator().getCamera()},setCamera:function(t){for(var e=this.getManipulatorList(),i=0,r=e.length;r>i;++i)e[i].setCamera(t)},update:function(t){var e=this.getCurrentManipulator();return void 0!==e?e.update(t):void 0},getNode:function(){return this.getCurrentManipulator()._node},setNode:function(t){for(var e=this.getManipulatorList(),i=0,r=e.length;r>i;++i)e[i].setNode(t)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(t){this._manipulatorList.push(t),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(t){this._currentManipulator=t},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){return this._manipulatorList[this._currentManipulator]},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(t){var e=this.getCurrentManipulator();void 0!==e&&e.computeHomePosition(t)},getInverseMatrix:function(){var t=this.getCurrentManipulator();return void 0!==t?t.getInverseMatrix():void 0},getHomeBound:function(t){return this.getCurrentManipulator().getHomeBound(t)},getHomeDistance:function(t){return this.getCurrentManipulator().getHomeDistance(t)}},t.exports=i},function(t,e,i){"use strict";var r=i(1252),n=i(1253),a=i(1263),s=i(1297),o=i(1240),u=i(1241),h=i(1303),l=i(1304),c=i(1305),d=i(1242),p=i(1243),f=i(1306),g=i(1307),m=i(1191),v=i(1308),_=i(1309),b={};b.Composer=r,b.DisplayNormalVisitor=n,b.DisplayGeometryVisitor=a,b.DisplayGraph=s,b.IntersectionVisitor=o,b.LineSegmentIntersector=u,b.NodeGizmo=h,b.GizmoGeometry=l,b.WebVRCustom=v,b.ParameterVisitor=c,b.PolytopeIntersector=d,b.PolytopePrimitiveIntersector=p,b.SphereIntersector=f,b.TangentSpaceGenerator=g,b.TriangleIntersect=m,b.WebVR=_,t.exports=b},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1111),s=i(1157),o=i(1184),u=i(1133),h=i(1154),l=i(1166),c=i(1205),d=i(1122),p=i(1134),f=i(1118),g=i(1198),m=i(1199),v=i(1200),_=i(1128),b=i(1168),x=i(1114),A=function(){a.call(this),this._stack=[],this._renderToScreen=!1,this._dirty=!1,this._textureRTT=[],this._cameraRTT=[];var t=function(){};t.prototype={update:function(t){return t.isDirty()&&t.build(),!0}},this.addUpdateCallback(new t),this.getOrCreateStateSet().setAttributeAndModes(new o("DISABLE")),this.getOrCreateStateSet().setAttributeAndModes(new s("BACK"))};A.prototype=n.objectInherit(a.prototype,{dirty:function(){for(var t=0,e=this._stack.length;e>t;t++)this._stack[t].filter.dirty()},addPass:function(t,e,i){var r={};return r.filter=t,e instanceof u?(r.texture=e,r.textureTarget=i||u.TEXTURE_2D):void 0!==e&&void 0!==i&&(r.width=Math.floor(e),r.height=Math.floor(i)),this._stack.push(r),r.filter},renderToScreen:function(t,e){this._renderToScreen=!0,this._renderToScreenWidth=t,this._renderToScreenHeight=e},getResultTexture:function(){return this._resultTexture},isDirty:function(){for(var t=0,e=this._stack.length;e>t;t++)if(this._stack[t].filter.isDirty())return!0;return!1},build:function(){var t=this;t._textureRTT=[],t._cameraRTT=[],this.removeChildren();var e;this._stack.forEach(function(i,n,a){if(i.filter.isDirty()&&i.filter.build(),i.filter.interConnectFilters)return void(e=i.filter.interConnectFilters(t,n,a));var s,o,f=i.filter.getStateSet();if(void 0!==i.texture)s=i.texture.getWidth(),o=i.texture.getHeight();else if(void 0!==i.width&&void 0!==i.height)s=i.width,o=i.height;else{var g=f.getTextureAttribute(0,"Texture");void 0===g?r.warn("Composer can't find any information to setup texture output size"):(s=g.getWidth(),o=g.getHeight())}var m=n===a.length-1&&t._renderToScreen===!0;if(!m&&void 0===f.getAttribute("Program"))return void a[n+1].filter.getStateSet().setTextureAttributeAndModes(0,f.getTextureAttribute(0,"Texture"));var x=new h;t._cameraRTT.push(x),x.setStateSet(f);var A;if(m===!0)s=t._renderToScreenWidth,o=t._renderToScreenHeight;else{x.setRenderOrder(h.PRE_RENDER,0),A=i.texture;var y=i.textureTarget;void 0===A&&(A=new u,A.setName("composer Rtt "+i.filter.getFragmentName()),A.setTextureSize(s,o),y=u.TEXTURE_2D,t._textureRTT.push(A)),x.attachTexture(l.COLOR_ATTACHMENT0,A,y)}var S=new c(0,0,s,o);x.setReferenceFrame(_.ABSOLUTE_RF),x.setViewport(S),d.makeOrtho(0,1,0,1,-5,5,x.getProjectionMatrix());var C=v.createTexturedFullScreenFakeQuadGeometry();i.filter.buildGeometry&&(C=i.filter.buildGeometry(C)),C.setName("composer layer"),A&&n+1<a.length&&a[n+1].filter.getStateSet().setTextureAttributeAndModes(0,A),e=A,x.addChild(C),i.filter.getStateSet().addUniform(p.createFloat2(b.createAndSet(s,o),"RenderSize")),x.setClearMask(0),x.setName("Composer Pass"+n),t.addChild(x)}),this._resultTexture=e}}),A.Filter=function(){this._stateSet=new f,this._dirty=!0,this._fragmentName="FilterOSGJS",this._vertexName=""},A.Filter.prototype={setFragmentName:function(t){this._fragmentName=t},getFragmentName:function(){return this._fragmentName},setVertexName:function(t){this._vertexName=t},getVertexName:function(){return this._vertexName},getDefineFragmentName:function(){return"\n#define SHADER_NAME "+this._fragmentName+"\n"},getDefineVertexName:function(){return"\n#define SHADER_NAME "+(this._vertexName||this._fragmentName)+"\n"},getStateSet:function(){return this._stateSet},getOrCreateStateSet:function(){return this._stateSet},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}},A.Filter.defaultVertexShader=["attribute vec3 Vertex;","varying vec2 FragTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex*2.0 - 1.0,1.0);","  FragTexCoord0 = Vertex.xy;","}",""].join("\n"),A.Filter.defaultFragmentShaderHeader=["#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif","varying vec2 FragTexCoord0;","uniform vec2 RenderSize;","uniform sampler2D Texture0;",""].join("\n"),A.Filter.shaderUtils=["vec4 packFloatTo4x8(in float v) {","vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;","enc = fract(enc);","enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);","return enc;","}"," ","vec4 pack2FloatTo4x8(in vec2 val) {"," const vec2 bitSh = vec2(256.0, 1.0);"," const vec2 bitMsk = vec2(0.0, 1.0/256.0);"," vec2 res1 = fract(val.x * bitSh);"," res1 -= res1.xx * bitMsk;"," vec2 res2 = fract(val.y * bitSh);"," res2 -= res2.xx * bitMsk;"," return vec4(res1.x,res1.y,res2.x,res2.y);","}"," ","float unpack4x8ToFloat( vec4 rgba ) {"," return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );","}"," ","vec2 unpack4x8To2Float(in vec4 val) {"," const vec2 unshift = vec2(1.0/256.0, 1.0);"," return vec2(dot(val.xy, unshift), dot(val.zw, unshift));","}","vec2 encodeNormal (vec3 n)","{","    float f = sqrt(8.0*n.z+8.0);","    return n.xy / f + 0.5;","}","vec3 decodeNormal (vec2 enc)","{","    vec2 fenc = enc*4.0-2.0;","    float f = dot(fenc,fenc);","    float g = sqrt(1.0-f/4.0);","    vec3 n;","    n.xy = fenc*g;","    n.z = 1.0-f/2.0;","    return n;","}",""].join("\n"),A.Filter.Helper={pascalCache:[[1]],getOrCreatePascalCoefficients:function(t){t=void 0===t?5:Math.min(t,128);var e=A.Filter.Helper.pascalCache;if(e[t])return e[t];for(var i=e.length-1;t>i;i++){var r=e[i],n=r.length,a=new Array(n);a[0]=1,a[n]=1;for(var s=i===e.length-1?Math.pow(2,i):1,o=0;n-1>o;o++)a[o+1]=(r[o]+r[o+1])*s;s=Math.pow(2,i+1);for(var u=0;n+1>u;u++)a[u]/=s;e.push(a)}return e[t]}},A.Filter.Custom=function(t,e){A.Filter.call(this),this._fragmentShader=t,this._uniforms=e,this._vertexShader=A.Filter.defaultVertexShader},A.Filter.Custom.prototype=n.objectInherit(A.Filter.prototype,{setFragmentShader:function(t){this._fragmentShader=t},setVertexShader:function(t){this._vertexShader=t},autoBindFragmentUniformStateSet:function(t,e,i){var r=0,n=e.match(/uniform\s+\w+\s+\w+/g);if(n)for(var a=0,s=n.length;s>a;a++){var o,u=n[a].match(/uniform\s+(\w+)\s+(\w+)/),h=u[1],l=u[2];if(i[l]){var c=i[l];-1!==h.search("sampler")?(t.setTextureAttributeAndModes(r,c),o=p.createInt1(r,l),r++,t.addUniform(o)):(o=p.isUniform(c)?c:p[h](i[l],l),t.addUniform(o))}}},build:function(){this._program=new g(new m(m.VERTEX_SHADER,this._vertexShader+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,this._fragmentShader+this.getDefineFragmentName())),this._uniforms&&this.autoBindFragmentUniformStateSet(this._stateSet,this._fragmentShader,this._uniforms),this._stateSet.setAttributeAndModes(this._program),this._dirty=!1}}),A.Filter.PingPong=function(t,e,i,r,n,a){A.Filter.Custom.apply(this,[n,a]),this._cameraRtt0=t,this._rtt0=e,this._cameraRtt1=i,this._rtt1=r,this._fragmentName="PingPong"},A.Filter.PingPong.prototype=n.objectInherit(A.Filter.Custom.prototype,{interConnectFilters:function(t,e,i){var r=this.getStateSet(),n=this._cameraRtt0.getOrCreateStateSet(),a=this._cameraRtt1.getOrCreateStateSet();n.setAttributeAndModes(this._program),a.setAttributeAndModes(this._program);var s,o,u,h,l=this.getStateSet().getUniformList();if(l)for(u=window.Object.keys(l),s=0,o=u.length;o>s;s++)h=l[u[s]].getUniform(),n.addUniform(h),a.addUniform(h);if(l=this._uniforms)for(u=window.Object.keys(l),s=0,o=u.length;o>s;s++)h=l[u[s]],n.addUniform(h),a.addUniform(h);var c=p.createInt1(0,"Texture0"),d=p.createInt1(1,"Texture1");n.addUniform(c),n.addUniform(d),a.addUniform(c),a.addUniform(d);var f=r.getTextureAttribute(0,"Texture");if(n.setTextureAttributeAndModes(0,f),a.setTextureAttributeAndModes(0,f),n.setTextureAttributeAndModes(1,this._rtt1),a.setTextureAttributeAndModes(1,this._rtt0),e!==i.length-1){var g=i[e+1].filter.getStateSet();g.setTextureAttributeAndModes(0,this._rtt0),g.setTextureAttributeAndModes(1,this._rtt1),g.addUniform(c),g.addUniform(d)}var m=v.createTexturedFullScreenFakeQuadGeometry();return this.buildGeometry&&(m=this.buildGeometry(m)),m.setName("composer layer"),this._cameraRtt0.addChild(m),this._cameraRtt1.addChild(m),t.addChild(this._cameraRtt0),t.addChild(this._cameraRtt1),t._textureRTT.push(this._rtt0),t._textureRTT.push(this._rtt1),t._cameraRTT.push(this._cameraRtt0),t._cameraRTT.push(this._cameraRtt1),this._cameraRtt1.setNodeMask(0),this._rtt0},"switch":function(){var t=this._cameraRtt0.getNodeMask(),e=this._cameraRtt1.getNodeMask();this._cameraRtt0.setNodeMask(e),this._cameraRtt1.setNodeMask(t)}}),A.Filter.AverageHBlur=function(t,e,i,r){A.Filter.call(this),this._linear=e!==!1,this.setBlurSize(void 0!==t?t:5),this._unpack=i,this._pack=r,this._pixelSize=1,this._fragmentName="AverageHBlur"+this._nbSamples},A.Filter.AverageHBlur.prototype=n.objectInherit(A.Filter.prototype,{setBlurSize:function(t){t%2!==1&&(t+=1),this._nbSamples=t,this.dirty()},setPixelSize:function(t){this._pixelSize=t,this.dirty()},getUVOffset:function(t){return"vec2(float("+t+")/RenderSize[0], 0.0);"},getShaderBlurKernel:function(){var t=this._nbSamples,e=[];e.push(" pixel = unpack(Texture0, FragTexCoord0 );"),e.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),e.push(" vec2 offset;");var i,r=Math.floor(t/2);r%2!==0&&(t+=1,r=Math.floor(t/2));var n=2*r+1,a=1/n;if(this._linear){var s,o,u=1,h=(1-a)/(2*r);for(e.push(" pixel *= float("+a+");"),e.push(" vec4 pixelLin = vec4(0.0);"),i=0;r>i;i+=2)o=u+.5,u+=2,s=this.getUVOffset(o*this._pixelSize),e.push(" offset = "+s),e.push(" pixelLin += unpack(Texture0, FragTexCoord0 + offset);"),e.push(" pixelLin += unpack(Texture0, FragTexCoord0 - offset);");e.push(" pixel += pixelLin * float("+2*h+");")}else{for(i=0;r>i;i++)e.push(" offset = "+this.getUVOffset((i+1)*this._pixelSize)),e.push(" pixel += unpack(Texture0, FragTexCoord0 + offset);"),e.push(" pixel += unpack(Texture0, FragTexCoord0 - offset);");e.push(" pixel *= float("+a+");")}return e},build:function(){var t=this._stateSet.getTextureAttribute(0,"Texture");t&&this._linear?(t.setMinFilter("LINEAR"),t.setMagFilter("LINEAR")):this._linear=!1;var e=A.Filter.defaultVertexShader,i=[A.Filter.defaultFragmentShaderHeader,"uniform float width;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","void main (void)","{","  vec4 pixel;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = pack(pixel);","}",""].join("\n"),r=new g(new m(m.VERTEX_SHADER,e+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(p.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),A.Filter.AverageVBlur=function(t,e,i,r){A.Filter.AverageHBlur.call(this,t,e,i,r),this._fragmentName="AverageVBlur"+this._nbSamples},A.Filter.AverageVBlur.prototype=n.objectInherit(A.Filter.AverageHBlur.prototype,{getUVOffset:function(t){return"vec2(0.0, float("+t+")/RenderSize[1]);"}}),A.Filter.BilateralHBlur=function(t,e,i){A.Filter.call(this),void 0===t&&(t={});var r=t.nbSamples,n=t.depthTexture,a=t.radius;this.setBlurSize(void 0!==r?r:5),this._depthTexture=n,this._radius=p.createFloat(1,"radius"),this._pixelSize=p.createFloat(1,"pixelSize"),this.setRadius(a),this._unpack=e,this._pack=i,this._fragmentName="BilateralHBlur"+this._nbSamples},A.Filter.BilateralHBlur.prototype=n.objectInherit(A.Filter.prototype,{setBlurSize:function(t){t%2!==1&&(t+=1),this._nbSamples=t,this.dirty()},setPixelSize:function(t){this._pixelSize.setFloat(t)},setRadius:function(t){this._radius.setFloat(t)},getUVOffset:function(t){return"vec2(0.0, float("+t+") * pixelSize )/RenderSize[1];"},getShaderBlurKernel:function(){var t=this._nbSamples,e=[];e.push(" pixel = unpack(Texture0, FragTexCoord0 );"),e.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),e.push(" vec2 offset, tmpUV;"),e.push(" depth = getDepthValue(unpack(Texture1, FragTexCoord0 ));");for(var i=1;i<Math.ceil(t/2);i++)e.push(" offset = "+this.getUVOffset(i)),e.push(" tmpUV =  FragTexCoord0 + offset;"),e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),e.push(" if ( abs(depth-tmpDepth) < radius) {"),e.push("   pixel += unpack(Texture0, tmpUV);"),e.push("   nbHits += 1.0;"),e.push(" }"),e.push(" tmpUV =  FragTexCoord0 - offset;"),e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),e.push(" if ( abs(depth-tmpDepth) < radius) {"),e.push("   pixel += unpack(Texture0, tmpUV);"),e.push("   nbHits += 1.0;"),e.push(" }");return e.push(" pixel /= nbHits;"),e},build:function(){var t=A.Filter.defaultVertexShader,e=[A.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float width;","uniform mat4 projection;","uniform float radius;","uniform float pixelSize;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","float znear,zfar,zrange;","",A.Filter.shaderUtils,"","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  return -depth;","}","void main (void)","{","  vec4 pixel;","  float depth, tmpDepth;","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  float nbHits = 1.0;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = pack(pixel);","}",""].join("\n"),i=new g(new m(m.VERTEX_SHADER,t+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,e+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(p.createInt1(0,"Texture0")),void 0===this._stateSet.getUniform("Texture1")&&this._stateSet.addUniform(p.createInt1(1,"Texture1")),this._stateSet.addUniform(this._radius),this._stateSet.addUniform(this._pixelSize),this._stateSet.setTextureAttributeAndModes(1,this._depthTexture),this._stateSet.setAttributeAndModes(i),this._dirty=!1}}),A.Filter.BilateralVBlur=function(t,e,i){A.Filter.BilateralHBlur.call(this,t,e,i),this._fragmentName="BilateralVBlur"+this._nbSamples},A.Filter.BilateralVBlur.prototype=n.objectInherit(A.Filter.BilateralHBlur.prototype,{getUVOffset:function(t){return"vec2(float("+t+")*pixelSize/RenderSize[0],0.0);"}}),A.Filter.InputTexture=function(t){A.Filter.call(this),this._stateSet.setTextureAttributeAndModes(0,t),this._fragmentName="InputTexture"},A.Filter.InputTexture.prototype=n.objectInherit(A.Filter.prototype,{build:function(){this._dirty=!1}}),A.Filter.HBlur=function(t,e,i,r){A.Filter.call(this),this._linear=e!==!1,this.setBlurSize(void 0!==t?t:5),this._unpack=i,this._pack=r,this._fragmentName="HBlur"+this._nbSamples;
},A.Filter.HBlur.prototype=n.objectInherit(A.Filter.prototype,{setBlurSize:function(t){t%2!==0&&(t+=1),this._nbSamples=t,this.dirty()},getUVOffset:function(t){return"vec2(float("+t+")/ RenderSize[0], 0.0) ;"},build:function(){var t=this._nbSamples,e=this._stateSet.getTextureAttribute(0,"Texture");e&&this._linear?(e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR")):this._linear=!1;var i=A.Filter.defaultVertexShader,r=.005/t,n=t,a=A.Filter.Helper.getOrCreatePascalCoefficients(n),s=Math.floor(n/2),o=[];o.push(" pixel = float("+a[s]+")*unpack(Texture0, FragTexCoord0 ).rgb;"),o.push(" vec2 offset;");var u,h,l,c,d;if(this._linear)for(u=1,h=s+1;t>h;h+=2){var f=a[h],v=a[h+1];if(l=f+v,r>l)break;var _=u,b=u+1;u+=2,d=(_*f+b*v)/l,c=this.getUVOffset(d),o.push(" offset = "+c),o.push(" pixel += "+l+"* unpack(Texture0, (FragTexCoord0.xy + offset.xy)).rgb;"),o.push(" pixel += "+l+"* unpack(Texture0, (FragTexCoord0.xy - offset.xy)).rgb;")}else for(u=1,h=s+1;t>h&&(l=a[h],!(r>l));h++)d=u++,c=this.getUVOffset(d),o.push(" offset = "+c),o.push(" pixel += "+l+"* unpack(Texture0, (FragTexCoord0.xy + offset.xy)).rgb;"),o.push(" pixel += "+l+"* unpack(Texture0, (FragTexCoord0.xy - offset.xy)).rgb;");var x=[A.Filter.defaultFragmentShaderHeader,"uniform float width;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","void main (void)","{","  vec3 pixel;",o.join("\n"),"  gl_FragColor = pack(vec4(pixel, 1.0));","}",""].join("\n"),y=new g(new m(m.VERTEX_SHADER,i+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,x+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(p.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(y),this._dirty=!1}}),A.Filter.VBlur=function(t,e,i,r){A.Filter.HBlur.call(this,t,e,i,r),this._fragmentName="VBlur"+this._nbSamples},A.Filter.VBlur.prototype=n.objectInherit(A.Filter.HBlur.prototype,{getUVOffset:function(t){return"vec2(0.0, float("+t+")/RenderSize[1]) ;"}}),A.Filter.SobelFilter=function(){A.Filter.call(this),this._color=p.createFloat3(x.createAndSet(1,1,1),"color"),this._factor=p.createFloat(1,"factor"),this._fragmentName="SobelFilter"},A.Filter.SobelFilter.prototype=n.objectInherit(A.Filter.prototype,{setColor:function(t){this._color.setVec3(t)},setFactor:function(t){this._factor.setFloat(t)},build:function(){var t=this._stateSet,e=A.Filter.defaultVertexShader,i=["",A.Filter.defaultFragmentShaderHeader,"uniform vec3 color;","uniform float factor;","void main (void)","{","  float fac0 = 2.0;","  float fac1 = 1.0;","  float offsetx = 1.0/RenderSize[0];","  float offsety = 1.0/RenderSize[1];","  vec4 texel0 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, offsety));","  vec4 texel1 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, 0.0));","  vec4 texel2 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, -offsety));","  vec4 texel3 = texture2D(Texture0, FragTexCoord0 + vec2(0.0, -offsety));","  vec4 texel4 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, -offsety));","  vec4 texel5 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, 0.0));","  vec4 texel6 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, offsety));","  vec4 texel7 = texture2D(Texture0, FragTexCoord0 + vec2(0.0, offsety));","  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;","  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;","  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));","  if (mag < 1.0/255.0) discard;","  mag *= factor;","  mag = min(1.0, mag);","  gl_FragColor = vec4(color*mag,mag);","}",""].join("\n"),r=new g(new m(m.VERTEX_SHADER,e+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i+this.getDefineFragmentName()));t.setAttributeAndModes(r),t.addUniform(this._color),t.addUniform(this._factor),t.addUniform(p.createInt1(0,"Texture0")),this._dirty=!1}}),A.Filter.BlendMix=function(){A.Filter.call(this);var t,e,i,r=0,n=1,a=this._stateSet;3===arguments.length?(t=arguments[0],e=arguments[1],i=arguments[2],r=1,n=2,a.setTextureAttributeAndModes(r,t)):2===arguments.length?(e=arguments[0],i=arguments[1]):1===arguments.length&&(e=arguments[0],i=.5),a.setTextureAttributeAndModes(n,e),a.addUniform(p.createInt1(r,"Texture0")),a.addUniform(p.createInt1(n,"Texture1")),this._mixValueUniform=p.createFloat1(i,"MixValue"),a.addUniform(this._mixValueUniform),this._fragmentName="BlendMix"},A.Filter.BlendMix.prototype=n.objectInherit(A.Filter.prototype,{getBlendFactorUniform:function(){return this._mixValueUniform},build:function(){var t=this._stateSet,e=A.Filter.defaultVertexShader,i=["",A.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = mix(texture2D(Texture0,FragTexCoord0), texture2D(Texture1,FragTexCoord0),MixValue);","}",""].join("\n"),r=new g(new m(m.VERTEX_SHADER,e+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i+this.getDefineFragmentName()));t.setAttributeAndModes(r),this._dirty=!1}}),A.Filter.BlendMultiply=function(){A.Filter.call(this);var t,e,i=this._stateSet,r=0,n=1;2===arguments.length?(t=arguments[0],e=arguments[1],r=1,r=2,i.setTextureAttributeAndModes(r,t)):1===arguments.length&&(e=arguments[0]),i.setTextureAttributeAndModes(n,e),i.addUniform(p.createInt1(r,"Texture0")),i.addUniform(p.createInt1(n,"Texture1")),this._fragmentName="BlendMultiply"},A.Filter.BlendMultiply.prototype=n.objectInherit(A.Filter.prototype,{build:function(){var t=A.Filter.defaultVertexShader,e=["",A.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = texture2D(Texture0,FragTexCoord0)*texture2D(Texture1,FragTexCoord0);","}",""].join("\n"),i=new g(new m(m.VERTEX_SHADER,t+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,e+this.getDefineFragmentName()));this._stateSet.setAttributeAndModes(i),this._dirty=!1}}),A.Filter.SSAO=function(t){A.Filter.call(this);var e=this._stateSet,i=16,r=.05;if(void 0!==t){void 0!==t.nbSamples&&(i=t.nbSamples),void 0!==t.radius&&(r=t.radius);var n=t.normal,a=t.position,s=n.getWidth(),o=n.getHeight();this._size=b.createAndSet(s,o),e.setTextureAttributeAndModes(0,n),e.setTextureAttributeAndModes(1,a)}this._radius=r,this._nbSamples=i,this._noiseTextureSize=16,this._sceneRadius=2,e.addUniform(p.createFloat1(1,"Power")),e.addUniform(p.createFloat1(r,"Radius")),e.addUniform(p.createInt1(0,"Texture0")),e.addUniform(p.createInt1(1,"Texture1")),e.addUniform(p.createInt1(2,"Texture2")),e.addUniform(p.createFloat1(.1,"AngleLimit")),this.initNoise(),this._fragmentName="SSAO"},A.Filter.SSAO.prototype=n.objectInherit(A.Filter.prototype,{initNoise:function(){var t=this._noiseTextureSize,e=new Array(t*t*3);!function(e){for(var i=b.createAndSet(0,0),r=0;t*t>r;r++)i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),b.normalize(i,i),e[3*r+0]=255*(.5*i[0]+.5),e[3*r+1]=255*(.5*i[1]+.5),e[3*r+2]=127.5}(e);var i=new u;i.setWrapS("REPEAT"),i.setWrapT("REPEAT"),i.setMinFilter("NEAREST"),i.setMagFilter("NEAREST"),i.setTextureSize(t,t),i.setImage(new Uint8Array(e),"RGB"),this._noiseTexture=i},setSceneRadius:function(t){this._sceneRadius=t,this.dirty()},setAngleLimit:function(t){var e=this._stateSet.getUniform("AngleLimit");e.setFloat(t)},setNbSamples:function(t){t!==this._nbSamples&&(this._nbSamples=Math.floor(t),this.dirty())},setRadius:function(t){var e=this._stateSet.getUniform("Radius");e.setFloat(t)},setPower:function(t){var e=this._stateSet.getUniform("Power");e.setFloat(t)},build:function(){var t=this._stateSet,e=this._nbSamples,i=new Array(4*e);!function(t){for(var i=x.create(),r=0;e>r;r++){i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),i[2]=Math.random(),x.normalize(i,i);var n=Math.max(r/e,.1);n=.1+.9*(n*n),t[3*r+0]=i[0],t[3*r+1]=i[1],t[3*r+2]=i[2],t[3*r+3]=n}}(i),t.setTextureAttributeAndModes(2,this._noiseTexture);var r=t.getUniform("noiseSampling");void 0===r?(r=p.createFloat2(b.createAndSet(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize),"noiseSampling"),t.addUniform(r)):r.setVec2(b.createAndSet(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize));for(var n=["","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 FragTexCoord0;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","}",""].join("\n"),a=[],s=0;e>s;s++)a.push("kernel["+s+"] = vec4("+i[3*s]+","+i[3*s+1]+", "+i[3*s+2]+", "+i[3*s+3]+");");a=a.join("\n");var o=["",A.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","vec3 normal;","vec4 position;","vec4 kernel["+e+"];","mat3 computeBasis()","{","  vec2 uvrand = FragTexCoord0*noiseSampling;","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","void main (void)","{",a,"  position = texture2D(Texture1, FragTexCoord0);","  vec4 p = texture2D(Texture0, FragTexCoord0);","  depth = p.w;","  normal = vec3(p);","  if ( position.w == 0.0) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vecKernel;","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = texture2D(Texture1, offset.xy).z;","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),u=new g(new m(m.VERTEX_SHADER,n+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,o+this.getDefineFragmentName()));t.setAttributeAndModes(u),this._dirty=!1}}),A.Filter.SSAO8=function(t){A.Filter.SSAO.call(this,t),this._fragmentName="SSAO8"},A.Filter.SSAO8.prototype=n.objectInherit(A.Filter.SSAO.prototype,{buildGeometry:function(t){return t.getAttributes().TexCoord1=this._texCoord1,t},build:function(){var t=this._stateSet,e=this._nbSamples,i=new Array(4*e);!function(t){for(var i=x.create(),r=0;e>r;r++){i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),i[2]=Math.random(),x.normalize(i,i);var n=Math.max(r/e,.1);n=.1+.9*(n*n),t[3*r+0]=i[0],t[3*r+1]=i[1],t[3*r+2]=i[2],t[3*r+3]=n}}(i),t.setTextureAttributeAndModes(2,this._noiseTexture);var r=t.getUniform("noiseSampling");void 0===r?(r=p.createFloat2(b.createAndSet(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize),"noiseSampling"),t.addUniform(r)):r.setVec2(b.createAndSet(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize));for(var n=["","attribute vec3 Vertex;","attribute vec2 TexCoord0;","attribute vec3 TexCoord1;","varying vec2 FragTexCoord0;","varying vec3 FragTexCoord1;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","  FragTexCoord1 = TexCoord1;","}",""].join("\n"),a=[],s=0;e>s;s++)a.push("kernel["+s+"] = vec4("+i[3*s]+","+i[3*s+1]+", "+i[3*s+2]+", "+i[3*s+3]+");");a=a.join("\n");var o=["",A.Filter.defaultFragmentShaderHeader,"varying vec3 FragTexCoord1;","uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","float znear, zfar, zrange;","vec3 normal;","vec3 position;","vec4 kernel["+e+"];",A.Filter.shaderUtils,"mat3 computeBasis()","{","  vec2 uvrand = FragTexCoord0*noiseSampling;","  //uvrand = rand(gl_FragCoord.xy);","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  //vec3 rvec = normalize(vec3(uvrand,0.0));","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  //depth = depth*zrange;","  return -depth;","}","void main (void)","{",a,"  vec4 p = texture2D(Texture0, FragTexCoord0);","  if (dot(p,p) < 0.001) { ","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  depth = getDepthValue(texture2D(Texture1, FragTexCoord0));","  if ( -depth < znear) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  normal = decodeNormal(unpack4x8To2Float(p));","  position = -FragTexCoord1*depth;","  position.z = -position.z;",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vec3(vecKernel);","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),u=new g(new m(m.VERTEX_SHADER,n+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,o+this.getDefineFragmentName()));t.setAttributeAndModes(u),this._dirty=!1}}),t.exports=A},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=i(1130),s=i(1139),o=i(1141),u=i(1140),h=i(1118),l=i(1134),c=i(1184),d=i(1114),p=i(1254),f=i(1255),g=i(1176),m=i(1177),v=i(1215),_=function(){f.apply(this,arguments),this._isVertexColored=!1};_.prototype=r.objectInherit(f.prototype,{getFragmentShaderName:function(){return"CompilerOffsetNormal"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]},_getDirectionVec:function(){return this.getOrCreateNormalAttribute()},getOrCreateVertexAttribute:function(){var t=this.getVariable("vertexOffset");if(t)return t;t=this.createVariable("vec3","vertexOffset");var e="%out = %offset == 1.0 ? %vertex + normalize(%direction.xyz) * %scale / length(%world[0].xyz) : %vertex;";return this.getNode("InlineCode").code(e).inputs({offset:this.getOrCreateAttribute("float","Offset"),direction:this._getDirectionVec(),vertex:f.prototype.getOrCreateVertexAttribute.call(this),scale:this.getOrCreateUniform("float","uScale"),world:this.getOrCreateUniform("mat4","ModelWorldMatrix")}).outputs({out:t}),t},declareVertexTransforms:f.prototype.declareVertexTransformShadeless});var b=function(){p.apply(this,arguments),this.setShaderCompiler(_)};b.prototype=p.prototype;var x=function(){_.apply(this,arguments)};x.prototype=r.objectInherit(_.prototype,{getFragmentShaderName:function(){return"CompilerOffsetTangent"},_getDirectionVec:function(){return this.getOrCreateTangentAttribute()}});var A=function(){p.apply(this,arguments),this.setShaderCompiler(x)};A.prototype=p.prototype;var y=function(){n.call(this),this._unifScale=l.createFloat(1,"uScale");var t=this._normalStateSet=new h;t.addUniform(l.createFloat3(d.createAndSet(1,0,0),"uColorDebug")),t.addUniform(this._unifScale),t.setAttributeAndModes(new c(c.NEVER)),t.setShaderGeneratorName("debugNormal");var e=this._tangentStateSet=new h;e.addUniform(l.createFloat3(d.createAndSet(0,1,0),"uColorDebug")),e.addUniform(this._unifScale),e.setAttributeAndModes(new c(c.NEVER)),e.setShaderGeneratorName("debugTangent")};y.CompilerOffsetNormal=_,y.CompilerOffsetTangent=x,y.ShaderGeneratorCompilerOffsetNormal=b,y.ShaderGeneratorCompilerOffsetTangent=A,y.prototype=r.objectInherit(n.prototype,{setScale:function(t){this._unifScale.setFloat(t)},setTangentVisibility:function(t){this._tangentStateSet.setAttributeAndModes(new c(t?c.LESS:c.NEVER))},setNormalVisibility:function(t){this._normalStateSet.setAttributeAndModes(new c(t?c.LESS:c.NEVER))},apply:function(t){for(var e=t.getUpdateCallbackList(),i=0,r=e.length;r>i;++i)e[i]instanceof v&&(e[i]._isInitialized=!1);if(!t._isVisitedNormalDebug){if(t._isVisitedNormalDebug=!0,t instanceof a==!1)return this.traverse(t);this._createDebugGeom(t,"Normal",this._normalStateSet),this._createDebugGeom(t,"Tangent",this._tangentStateSet)}},_createDoubleOffsetArray:function(t){for(var e=new Float32Array(2*t),i=0;t>i;++i)e[2*i]=1;return new s(s.ARRAY_BUFFER,e,1)},_createDoubledBufferArray:function(t){t.getInitialBufferArray&&(t=t.getInitialBufferArray());for(var e=t.getItemSize(),i=t.getElements(),r=i.length/e,n=i.constructor,a=new n(2*i.length),o=0;r>o;++o)for(var u=o*e,h=2*u,l=0;e>l;++l)a[h+l]=a[h+l+e]=i[u+l];return new s(s.ARRAY_BUFFER,a,e)},_addMorphTargets:function(t,e,i){var r=e.getMorphTargets();e.setName(t.getName());for(var n=t.getMorphTargets(),s=0,o=n.length;o>s;++s){var u=n[s],h=u.getVertexAttributeList(),l=new a;l.setName(u.getName());var c=l.getVertexAttributeList();c.Vertex=this._createDoubledBufferArray(h.Vertex),h[i]&&(c[i]=this._createDoubledBufferArray(h[i])),r.push(l)}return e.mergeChildrenVertexAttributeList(),e},_createDebugGeom:function(t,e,i){var r=t.getAttributes(),n=r[e];if(n){var s=r.Vertex;if(s){var h;t instanceof m?h=t:t.getSourceGeometry&&t.getSourceGeometry()instanceof m&&(h=t.getSourceGeometry());var l=s.getElements().length/s.getItemSize(),c=h?new m:new a;c.getAttributes().Vertex=this._createDoubledBufferArray(s),c.getAttributes().Offset=this._createDoubleOffsetArray(l),c.getAttributes()[e]=this._createDoubledBufferArray(n),c.getPrimitives().push(new o(u.LINES,0,2*l)),h&&this._addMorphTargets(h,c,e);var d;if(t instanceof g){var p=new g;p.setSourceGeometry(c),p.getVertexAttributeList().Bones=this._createDoubledBufferArray(r.Bones),p.getVertexAttributeList().Weights=this._createDoubledBufferArray(r.Weights),p._rigTransformImplementation=t._rigTransformImplementation,p._stateSetAnimation=t._stateSetAnimation,p.mergeChildrenData(),d=p}else d=c;var f=t.getParents(),v=f.length;d._isVisitedNormalDebug=!0,d._isNormalDebug=!0,d.setStateSet(i);for(var _=0;v>_;++_)f[_].addChild(d);return d}}}}),t.exports=y},function(t,e,i){"use strict";var r=(i(1109),i(1198)),n=i(1199),a=i(1119),s=i(1255),o=i(1264),u=["ShadowReceive","Skinning","Morph","ShadowTexture","Texture","Light","Material","Billboard"],h=function(){this._cache=new window.Map,this._shaderProcessor=new o,this._acceptAttributeTypes=new window.Set(u),this._ShaderCompiler=s};h.prototype={setShaderCompiler:function(t){this._ShaderCompiler=t},getShaderCompiler:function(){return this._ShaderCompiler},getAcceptAttributeTypes:function(){return this._acceptAttributeTypes},getShaderProcessor:function(){return this._shaderProcessor},setShaderProcessor:function(t){this._shaderProcessor=t},filterAttributeTypes:function(t){if("osg"!==t.libraryName()&&"osgShadow"!==t.libraryName()&&"osgAnimation"!==t.libraryName())return!0;var e=t.getType();return this._acceptAttributeTypes.has(e)?t.isEnabled&&!t.isEnabled()?!0:!1:!0},getActiveAttributeList:function(t,e){for(var i="",r=t.attributeMap,n=r.getKeys(),a=0,s=n.length;s>a;a++){var o=n[a],u=r[o],h=u.lastApplied;this.filterAttributeTypes(h)||(i+=h.getHash?h.getHash():h.getType(),e.push(h))}return i},getActiveTextureAttributeList:function(t,e){var i,r,n="",a=t.textureAttributeMapList;for(i=0,r=a.length;r>i;i++){var s=a[i];if(s){e[i]=[];for(var o=s.getKeys(),u=0,h=o.length;h>u;u++){var l=o[u],c=s[l];if(0!==c.values().length){var d=c.lastApplied;this.filterAttributeTypes(d)||d.isTextureNull()||(n+=d.getHash?d.getHash():d.getType(),e[i].push(d))}}}}return n},getActiveUniforms:function(t,e,i){for(var r={},n=0,s=e.length;s>n;n++){var o=e[n];if(o.getOrCreateUniforms){var u=o.getOrCreateUniforms();if(void 0!==u)for(var h=u.getKeys(),l=0,c=h.length;c>l;l++){var d=h[l],p=u[d];r[p.getName()]=p}}}for(var f=0,g=i.length;g>f;f++){var m=i[f];if(m)for(var v=0,_=m.length;_>v;v++)for(var b=m[v],x=b.getOrCreateUniforms(f),A=x.getKeys(),y=0,S=A.length;S>y;y++){var C=A[y],w=x[C];r[w.getName()]=w}}return new a(r)},getOrCreateProgram:function(){var t=[],e=[];return function(i){var a="";e.length=0,t.length=0,a+=this.getActiveAttributeList(i,e),a+=this.getActiveTextureAttributeList(i,t);var s=this._cache.get(a);if(void 0!==s)return s;var o=this._ShaderCompiler,u=new o(e,t,this._shaderProcessor),h=u.createVertexShader(),l=u.createFragmentShader(),c=new r(new n(n.VERTEX_SHADER,h),new n(n.FRAGMENT_SHADER,l));return c.hash=a,c.setActiveUniforms(this.getActiveUniforms(i,e,t)),c.generated=!0,this._cache.set(a,c),c}}()},t.exports=h},function(t,e,i){"use strict";var r=i(1195),n=i(1109),a=i(1105),s=i(1134),o=i(1256),u=function(t,e,i){this._attributes=t,this._textureAttributes=e,this._activeNodeList={},this._compiledNodeList={},this._traversedNodeList={},this._variables={},this._varyings={},this._vertexShader=[],this._fragmentShader=[],this._shaderProcessor=i,this._texturesByName={},this._shadowsTextures=[],this._lights=[],this._shadows=[],this._textures=[],this._material=null,this._shaderAttributes={Vertex:!0,VertexColor:!1,Normal:!1,Tangent:!1},this._isLighted=!1,this._isShadeless=!1,this._isBillboard=!1,this.initAttributes(),this.initTextureAttributes();var r=!!this._material;this._isLighted=r&&this._lights.length>0,this._isVertexColored=r,this._customVertexShader=!1,this._customFragmentShader=!1};u.prototype={initAttributes:function(){for(var t=this._attributes,e=this._lights,i=this._shadows,r=0,n=t.length;n>r;r++){var a=t[r].className();"Light"===a?e.push(t[r]):"Material"===a?this._material=t[r]:"ShadowReceiveAttribute"===a?i.push(t[r]):"Billboard"===a?this._isBillboard=!!t[r]:"SkinningAttribute"===a?this._skinningAttribute=t[r]:"MorphAttribute"===a&&(this._morphAttribute=t[r])}},initTextureAttributes:function(){var t=this._textureAttributes,e=t.length;this._textures.length=this._shadowsTextures.length=e;for(var i=0;e>i;i++){var r=t[i];if(void 0!==r)for(var n=0,a=r.length;a>n;n++)this.registerTextureAttributes(r[n],i)}},registerTextureAttributes:function(t,e){var i=t.className();return"Texture"===i?this.registerTexture(t,e):"ShadowTexture"===i?this.registerTextureShadow(t,e):void 0},registerTexture:function(t,e){var i=t.getName();i||(i="Texture"+e,t.setName(i)),this._textures[e]=t,this._texturesByName[i]={texture:t,variable:void 0,textureUnit:e}},registerTextureShadow:function(t,e){var i=t.getName();i||(i="Texture"+e,t.setName(i)),this._shadowsTextures[e]=t,this._texturesByName[i]={texture:t,variable:void 0,textureUnit:e,shadow:!0}},getNode:function(){var t=o.getNode.apply(o,arguments),e=t.getID();return this._activeNodeList[e]=t,t},markNodeAsVisited:function(t){var e=t.getID();this._activeNodeList[e]===t?this._compiledNodeList[e]=t:n.warn("Node not requested by using Compiler getNode and/or not registered in nodeFactory "+t.toString())},checkOrMarkNodeAsTraversed:function(t){var e=t.getID();return this._traversedNodeList[e]?!0:(this._traversedNodeList[e]=t,!1)},getVariable:function(t){return this._variables[t]},getAttributeType:function(t){for(var e=0;e<this._attributes.length;e++)if(this._attributes[e].getType()===t)return this._attributes[e]},createVariable:function(t,e,i){var r=e;if(void 0===r){var n=window.Object.keys(this._variables).length;r="tmp_"+n}else if(this._variables[r]){if(r+=i,void 0===i)return this.createVariable(t,e,1);if(this._variables[r])return i++,this.createVariable(t,e,i)}var a=this.getNode("Variable",t,r);return this._variables[r]=a,a},getOrCreateUniformFromUniformMap:function(t,e){for(var i=window.Object.keys(t),r={},n=e?e:"",a=0;a<i.length;a++){var s=n+i[a];r[s]=this.getOrCreateUniform(t[i[a]])}return r},getOrCreateTextureStateAttributeUniforms:function(t,e,i){var r=t.getOrCreateUniforms(i);return this.getOrCreateUniformFromUniformMap(r,e)},getOrCreateStateAttributeUniforms:function(t,e){var i=t.getOrCreateUniforms();return this.getOrCreateUniformFromUniformMap(i,e)},getOrCreateUniform:function(t,e,i){var r=e;if(t instanceof s){var a=t;t=a.getType(),r=a.getName()}else void 0===r&&n.error("Cannot create unamed Uniform");var o=this._variables[r];if(o&&o.getType()===t)return o;var u=this.getNode("Uniform",t,r,i);return this._variables[r]=u,u},getOrCreateAttribute:function(t,e){this._fragmentShaderMode&&n.error("No Vertex Attribute in Fragment Shader");var i=this._variables[e];if(i)return i;this._shaderAttributes[e]=!0;var r=this.getNode("Attribute",t,e);return this._variables[e]=r,r},getOrCreateConstant:function(t,e){var i=e;if(void 0===i){var r=window.Object.keys(this._variables).length;i="tmp_"+r}else{var n=this._variables[i];if(n)return n}var a=this.getNode("Constant",t,i);return this._variables[i]=a,a},getOrCreateVarying:function(t,e){void 0===e&&n.error("Error: Mandatory to name varying (as you need to retrieve them)");var i=this._variables[e];if(i)return i;if(i=this._varyings[e])return this._variables[e]=i,!this._fragmentShaderMode||this._customVertexShader||this._activeNodeList[i.getID()]&&this._activeNodeList[i.getID()]===i||n.error("Error: Varying in Fragment not declared in Vertex shader: "+e+" "+t),i;var r=this.getNode("Varying",t,e);return this._variables[e]=r,this._varyings[e]=r,r},getOrCreateSampler:function(t,e){void 0===e&&n.error("No name given for sampler type : "+t);var i=this._variables[e];if(i)return i;var r=this.getNode("Sampler",t,e);return this._variables[e]=r,r},getOrCreateInputTangent:function(){return this.getOrCreateVarying("vec4","FragTangent")},getOrCreateFrontTangent:function(){var t=this.createVariable("vec4","frontTangent");return this.getNode("FrontNormal").inputs({normal:this.getOrCreateInputTangent()}).outputs({normal:t}),t},getOrCreateInputNormal:function(){return this.getOrCreateVarying("vec3","FragNormal")},getOrCreateFrontNormal:function(){var t=this.getOrCreateInputNormal(),e=this.createVariable("vec3","frontNormal");return this.getNode("FrontNormal").inputs({normal:t}).outputs({normal:e}),e},getOrCreateInputPosition:function(){return this.getOrCreateVarying("vec4","FragEyeVector")},getOrCreateNormalizedNormal:function(){var t=this._variables.normal;if(t)return t;var e=this.createVariable("vec3","normal");return this.getNode("Normalize").inputs({vec:this.getOrCreateFrontNormal()}).outputs({vec:e}),e},getOrCreateNormalizedPosition:function(){var t=this._variables.eyeVector;if(t)return t;var e=this.createVariable("vec3"),i=this.createVariable("vec3");this.getNode("SetFromNode").inputs(this.getOrCreateInputPosition()).outputs(i),this.getNode("Normalize").inputs({vec:i}).outputs({vec:e});var r=this.createVariable("vec3","eyeVector");return this.getNode("Mult").inputs(e,this.createVariable("float").setValue("-1.0")).outputs(r),r},getPremultAlpha:function(t,e){if(void 0===e)return t;var i=this.createVariable("vec4");return this.getNode("PreMultAlpha").inputs({color:t,alpha:e}).outputs({color:i}),i},getColorsRGB:function(t){var e=this.createVariable("vec3");return this.getNode("LinearTosRGB").inputs({color:t}).outputs({color:e}),e},getVertexColor:function(t){if(void 0!==t){var e=this.getOrCreateVarying("vec4","VertexColor"),i=this.getOrCreateUniform("float","ArrayColorEnabled"),r=this.createVariable("vec4"),n=["","%color.rgb = %diffuse.rgb;","if ( %hasVertexColor == 1.0)","  %color *= %vertexColor.rgba;"].join("\n");return this.getNode("InlineCode").code(n).inputs({diffuse:t,hasVertexColor:i,vertexColor:e}).outputs({color:r}).comment("diffuse color = diffuse color * vertex color"),r}},getDiffuseColorFromTextures:function(){for(var t=[],e=this._texturesByName,i=window.Object.keys(e),r=0;r<i.length;r++){var n=e[i[r]];n&&(n.shadow||t.push(n.variable))}if(t.length>1){var a=this.createVariable("vec3","texDiffuseAccum");return this.getNode("Mult").inputs(t).outputs(a),a}return 1===t.length?t[0]:void 0},getFirstValidTexture:function(){var t=window.Object.keys(this._texturesByName);if(t.length)return this._texturesByName[t[0]].variable},declareTexture:function(t,e){var i="Texture"+t.toString(),r=this.getVariable(i);if(!r)if("Texture"===e.className())r=this.getOrCreateSampler("sampler2D",i);else if("TextureCubeMap"===e.className())r=this.getOrCreateSampler("samplerCube",i);else if("ShadowTexture"===e.className())return;var n=t,a=this.getVariable("FragTexCoord"+n);void 0===a&&(a=this.getOrCreateVarying("vec2","FragTexCoord"+n));var s=this.createTextureRGBA(e,r,a),o=e.getName();void 0===o&&(o="Texture"+n);var u=this._texturesByName[o];void 0===u?this._texturesByName[o]={variable:s,textureUnit:t}:(u.variable=s,u.textureUnit=t)},declareTextures:function(){for(var t=this._textures,e=t.length,i=0,r=e;r>i;i++){var n=t[i];if(n&&"Texture"===n.getType()){var a=this.getTexCoordUnit(i);void 0!==a&&this.declareTexture(a,n)}}},createShadowingLight:function(t,e,i){var r,n,s,o=!1,u=new Array(this._shadowsTextures.length),h=-1,l=t.getLightNumber();for(r=0;r<this._shadows.length;r++)if(n=this._shadows[r],n.getLightNumber()===l){h=r;for(var c=0;c<this._shadowsTextures.length;c++)s=this._shadowsTextures[c],s&&s.getLightUnit()===l&&(u[c]=s,o=!0)}if(o){var d=this.getOrCreateVarying("vec3","WorldPosition"),p=this.createVariable("float"),f=this.getOrCreateStateAttributeUniforms(this._shadows[h],"shadow"),g=a.objectMix(e,f);for(r=0;r<u.length;r++)s=u[r],s&&(g=this.createShadowTextureInputVarying(s,g,d,r));return this.getNode("ShadowReceive").inputs(e).outputs({"float":p}).setShadowAttribute(n),this.connectShadowLightNode(t,i,p,g)}},connectShadowLightNode:function(t,e,i){var r=this.createVariable("vec3","lightAndShadowTempOutput");return this.getNode("Mult").inputs(e,i).outputs(r),r},createShadowTextureInputVarying:function(t,e,i,r){var n="Texture"+r,s=this.getOrCreateSampler("sampler2D",n),o=this.getOrCreateTextureStateAttributeUniforms(t,"shadowTexture",r),u=o["shadowTexture"+n].getID();o["shadowTexture"+n]=void 0,this._variables[n]=s,delete this._activeNodeList[u];var h=a.objectMix(e,o);h.shadowTexture=s;var l={vertexWorld:i,lightEyeDir:h.lightEyeDir,lightNDL:h.lightNDL};return h=a.objectMix(h,l)},createCommonLightingVars:function(t,e){return{}},createLightAndShadowVars:function(t,e,i){var n,a=this._lights[i].getLightType(),s=this.createVariable("bool","lighted"+i);(a===r.SPOT||a===r.POINT)&&(n=this.createVariable("vec3","lightEyePos"+i));var o=this.createVariable("vec3","lightEyeDir"+i),u=this.createVariable("float","lightNDL"+i);return{lighted:s,lightEyePos:n,lightEyeDir:o,lightNDL:u}},createLighting:function(t,e){for(var i=this.createVariable("vec3"),r=[],n=e||{DIRECTION:"SunLight",SPOT:"SpotLight",POINT:"PointLight",HEMI:"HemiLight"},s=this.getOrCreateStateAttributeUniforms(this._material,"material"),o=this.createCommonLightingVars(t,n),u=0;u<this._lights.length;u++){var h=this._lights[u],l=this.createVariable("vec3"),c=n[h.getLightType()],d=this.getOrCreateStateAttributeUniforms(this._lights[u],"light"),p=this.createLightAndShadowVars(t,n,u),f=a.objectMix({},d);
f=a.objectMix(f,s),f=a.objectMix(f,t),f=a.objectMix(f,o),f=a.objectMix(f,p),f.normal||(f.normal=this.getOrCreateNormalizedNormal()),f.eyeVector||(f.eyeVector=this.getOrCreateNormalizedPosition()),this.getNode(c).inputs(f).outputs({color:l,lightEyePos:f.lightEyePos,lightEyeDir:f.lightEyeDir,ndl:f.lightNDL,lighted:f.lighted});var g=this.createShadowingLight(h,f,l);g?r.push(g):r.push(l);var m=this.createVariable("vec3","lightMatAmbientOutput");this.getNode("Mult").inputs(f.materialambient,d.lightambient).outputs(m),r.push(m)}return 0===r.length&&r.push(this.createVariable("vec3").setValue("vec3(0.0)")),this.getNode("Add").inputs(r).outputs(i),i},createTextureRGBA:function(t,e,i){var r=this.createVariable("vec4");return this.getNode("TextureRGBA").inputs({sampler:e,uv:i}).outputs({color:r}),r},traverse:function(t,e){if(!this.checkOrMarkNodeAsTraversed(e)){var i=e.getInputs();if(!Array.isArray(i)){for(var r=window.Object.keys(i),n=[],a=0;a<r.length;a++)n.push(i[r[a]]);i=n}for(var s=0,o=i.length;o>s;s++){e.checkInputsOutputs();var u=i[s];void 0!==u&&u!==e&&this.traverse(t,u)}t.call(t,e),this.markNodeAsVisited(e)}},preTraverse:function(t){return this._traversedNodeList={},t._map={},t._text=[],t},evaluateAndGatherField:function(t,e){var i=function(t){var i=t.getType();if((void 0===i||""===i)&&n.error("Your node "+t+" has no type"),t[e]&&void 0===this._map[i]){this._map[i]=!0;var r=t[e]();Array.prototype.push.apply(this._text,r)}};this.preTraverse(i);for(var r=0,a=t.length;a>r;r++)this.traverse(i,t[r]);return i._text},evaluateGlobalFunctionDeclaration:function(t){var e=function(t){var e=t.getType();if((void 0===e||""===e)&&n.error("Your node "+t+" has no type"),t.globalFunctionDeclaration&&void 0===this._map[e]){this._map[e]=!0;var i=t.globalFunctionDeclaration();void 0!==i&&this._text.push(i)}};this.preTraverse(e);for(var i=0,r=t.length;r>i;i++)this.traverse(e,t[i]);return e._text.join("\n")},evaluateGlobalVariableDeclaration:function(t){var e=function(t){var e=t.getID();if(t.globalDeclaration&&void 0===this._map[e]){this._map[e]=!0;var i=t.globalDeclaration();void 0!==i&&this._text.push(i)}};this.preTraverse(e);for(var i=0,r=t.length;r>i;i++)this.traverse(e,t[i]);if(e._text.length){e._text.sort();var n=[];for(i=0;i<e._text.length&&-1===e._text[0].indexOf("Vertex");i++)n.push(e._text.shift());e._text.splice(1,0,n.join("\n"));var a=e._text[0][0],s=e._text.length;for(i=0;s>i;i++)e._text[i][0]!==a&&(a=e._text[i][0],e._text.splice(i,0,""),s++)}return e._text.join("\n")},evaluate:function(t){var e=function(t){var e=t.getID();if(void 0===this._map[e]){var i=t.computeShader();if(void 0!==i){if(void 0!==t.getComment){var r=t.getComment();void 0!==r&&this._text.push(r)}this._text.push(i)}this._map[e]=!0}};this.preTraverse(e);for(var i=0,r=t.length;r>i;i++)this.traverse(e,t[i]);return e._text.join("\n")},getTexCoordUnit:function(t){var e=this._textures[t];if(void 0!==e){var i=this._texturesByName[e.getName()];if(i){var r=i.textureUnit;return void 0===r&&(i.textureUnit=r=t),r}}},getOrCreateProjectionMatrix:function(){return this.getOrCreateUniform("mat4","ProjectionMatrix")},getOrCreateBoneMatrix:function(){var t=this._variables.boneMatrix;if(t)return t;t=this.createVariable("mat4","boneMatrix");var e=this.getOrCreateAttribute("vec4","Weights"),i=this.getOrCreateAttribute("vec4","Bones"),r=this.getOrCreateUniform("vec4","uBones",this._skinningAttribute.getBoneUniformSize());return this.getNode("Skinning").inputs({weights:e,bonesIndex:i,matrixPalette:r}).outputs({mat4:t}),t},getTarget:function(t,e){var i=-1!==t.indexOf("Tangent")?"vec4":"vec3";return this.getOrCreateAttribute(i,t+"_"+e)},morphTangentApproximation:function(t,e){var i;return this._skinningAttribute?(i=this.createVariable("vec3"),this.getNode("Normalize").inputs({vec:this.getVariable("normalMorph")}).outputs({vec:i})):i=this.getVariable("normalAttribute"),this.getNode("InlineCode").code("%out = %tangent.rgb - dot(%tangent.rgb, %normal) * %normal;").inputs({tangent:t,normal:i}).outputs({out:e}),e},morphTransformVec3:function(t,e,i){for(var r={vertex:t,weights:this.getOrCreateUniform("vec4","uTargetWeights")},n=this._morphAttribute.getNumTargets(),a=0;n>a;a++)r["target"+a]=this.getTarget(i||t.getVariable(),a);return this.getNode("Morph").inputs(r).outputs({out:e}),e},skinTransformVertex:function(t,e){return this.getNode("MatrixMultPosition").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},skinTransformNormal:function(t,e){return this.getNode("MatrixMultDirection").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},getOrCreateVertexAttribute:function(){var t=this.getVariable("vertexAttribute");if(t)return t;var e=this._morphAttribute&&this._morphAttribute.hasTarget("Vertex"),i=this.getOrCreateAttribute("vec3","Vertex");if(!this._skinningAttribute&&!e)return i;if(t=this.createVariable("vec3","vertexAttribute"),e&&!this._skinningAttribute)return this.morphTransformVec3(i,t);if(!e&&this._skinningAttribute)return this.skinTransformVertex(i,t);var r=this.createVariable("vec3");return this.morphTransformVec3(i,r),this.skinTransformVertex(r,t)},getOrCreateNormalAttribute:function(){var t=this.getVariable("normalAttribute");if(t)return t;var e=this._morphAttribute&&this._morphAttribute.hasTarget("Normal"),i=this.getOrCreateAttribute("vec3","Normal");if(!this._skinningAttribute&&!e)return i;var r;return e&&!this._skinningAttribute?r=this.morphTransformVec3(i,this.createVariable("vec3","normalMorph")):!e&&this._skinningAttribute?r=this.skinTransformNormal(i,this.createVariable("vec3","normalSkin")):(r=this.morphTransformVec3(i,this.createVariable("vec3","normalMorph")),r=this.skinTransformNormal(r,this.createVariable("vec3","normalSkin"))),t=this.createVariable("vec3","normalAttribute"),this.getNode("Normalize").inputs({vec:r}).outputs({vec:t}),t},getOrCreateTangentAttribute:function(){var t=this.getVariable("tangentAttribute");if(t)return t;var e=this._morphAttribute&&this._morphAttribute.hasTarget("Tangent"),i=this.getOrCreateAttribute("vec4","Tangent");if(!this._skinningAttribute&&!e)return i;var r;e&&!this._skinningAttribute?r=this.morphTransformVec3(i,this.createVariable("vec3","tangentMorph")):!e&&this._skinningAttribute?r=this.skinTransformNormal(i,this.createVariable("vec3","tangentSkin")):(r=this.morphTransformVec3(i,this.createVariable("vec3","tangentMorph"),"Tangent"),r=this.skinTransformNormal(r,this.createVariable("vec3","tangentSkin")));var n=this.createVariable("vec3");return this.getNode("Normalize").inputs({vec:r}).outputs({vec:n}),t=this.createVariable("vec4","tangentAttribute"),this.getNode("SetAlpha").inputs({color:n,alpha:i}).outputs({color:t}),t},declareVertexTransformShadeless:function(t){var e=this.createVariable("vec4");this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","ModelViewMatrix"),vec:this.getOrCreateVertexAttribute()}).outputs({vec:e}),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateProjectionMatrix(),vec:e}).outputs({vec:t})},declareVertexTransformBillboard:function(t){this.getOrCreateInputPosition(),this.getNode("Billboard").inputs({Vertex:this.getOrCreateAttribute("vec3","Vertex"),ModelViewMatrix:this.getOrCreateUniform("mat4","ModelViewMatrix"),ProjectionMatrix:this.getOrCreateUniform("mat4","ProjectionMatrix")}).outputs({vec:t})},needTangent:function(){return!1},declareVertexTransformLighted:function(t){this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat4","NormalMatrix"),vec:this.getOrCreateNormalAttribute()}).outputs({vec:this.getOrCreateInputNormal()}),this.needTangent()&&this.getNode("MatrixMultDirection").setForceComplement(!1).inputs({matrix:this.getOrCreateUniform("mat4","NormalMatrix"),vec:this.getOrCreateTangentAttribute()}).outputs({vec:this.getOrCreateVarying("vec4","FragTangent")}),this._isBillboard?this.declareVertexTransformBillboard(t):this.declareTransformWithEyeSpace(t)},declareTransformWithEyeSpace:function(t){var e=this.getOrCreateInputPosition();this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","ModelViewMatrix"),vec:this.getOrCreateVertexAttribute()}).outputs({vec:e}),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateProjectionMatrix(),vec:e}).outputs({vec:t})},declareVertexTransformShadowed:function(){this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","ModelWorldMatrix"),vec:this.getOrCreateVertexAttribute()}).outputs({vec:this.getOrCreateVarying("vec3","WorldPosition")})},isShadowed:function(){if(!this._isLighted)return!1;for(var t=0,e=this._shadowsTextures.length;e>t;t++)if(void 0!==this._shadowsTextures[t])return!0;return!1},declareVertexTransforms:function(t){this._isLighted||this._shaderAttributes.Normal?(this.isShadowed()&&this.declareVertexTransformShadowed(t),this.declareVertexTransformLighted(t)):this._isBillboard?this.declareVertexTransformBillboard(t):this.declareVertexTransformShadeless(t)},declareVertexTextureCoords:function(){for(var t={},e=0;e<this._textures.length;e++){var i=this.getTexCoordUnit(e);void 0!==i&&void 0===t[i]&&(this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec2","TexCoord"+i)).outputs(this.getOrCreateVarying("vec2","FragTexCoord"+i)),t[i]=!0)}},declareVertexMain:function(){var t=this.getNode("glPosition"),e=[];if(this.declareVertexTransforms(t,e),this.declareVertexTextureCoords(t,e),this._isVertexColored){var i=["","if ( %ArrayColorEnabled == 1.0 ) ","    %VertexColor = %Color;","  else","    %VertexColor = vec4(1.0,1.0,1.0,1.0);"];this.getNode("InlineCode").code(i.join("\n")).inputs({ArrayColorEnabled:this.getOrCreateUniform("float","ArrayColorEnabled"),Color:this.getOrCreateAttribute("vec4","Color")}).outputs({VertexColor:this.getOrCreateVarying("vec4","VertexColor")})}var r="%out = %input;",n=this.getNode("glPointSize");this.getNode("InlineCode").code(r).inputs({input:this.getOrCreateConstant("float","unitFloat").setValue("1.0")}).outputs({out:n}),e.push(n),e.push(t);for(var a=window.Object.keys(this._varyings),s=0,o=a.length;o>s;s++){var u=this._varyings[a[s]];void 0!==u&&e.push(u)}return e},createVertexShaderGraph:function(){return this.declareVertexMain()},createShaderFromGraphs:function(t,e){this._compiledNodeList={};for(var i=window.Object.keys(this._variables),r=[],a=0,s=i.length;s>a;a++){var o=this._variables[i[a]],u=o.declare();u&&r.push(u)}var h=this.evaluateExtensions(t),l=this.evaluateDefines(t),c=[];c.push("\n"),c.push(this.evaluateGlobalVariableDeclaration(t)),c.push("\n"),c.push(this.evaluateGlobalFunctionDeclaration(t)),c.push("void main() {"),0!==r.length&&(c.push("// vars\n"),c.push(r.join(" ")),c.push("\n// end vars\n")),0===t.length&&n.error("shader without any final Node output (need at least one)"),c.push(this.evaluate(t)),c.push("}");var d=c.join("\n"),p=this._shaderProcessor.processShader(d,l,h,e);return p},createVertexShader:function(){this._variables={},this._activeNodeList={},this._fragmentShaderMode=!1;var t=this.createVertexShaderGraph(),e=this.getVertexShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var i=this.createShaderFromGraphs(t,"vertex");n.debug(i),this._variables={},this._activeNodeList={},this._fragmentShaderMode=!0;for(var r=window.Object.keys(this._varyings),a=0,s=r.length;s>a;a++){var o=this._varyings[r[a]];void 0!==o&&(o.reset(),this._activeNodeList[o.getID()]=o,this._variables[o.getID()]=o)}return i},evaluateDefines:function(t){return this.evaluateAndGatherField(t,"getDefines")},evaluateExtensions:function(t){return this.evaluateAndGatherField(t,"getExtensions")},createFragmentShader:function(){this._customVertexShader&&(this._variables={},this._activeNodeList={}),this._fragmentShaderMode=!0,this.declareTextures();var t=this.createFragmentShaderGraph(),e=this.getFragmentShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var i=this.createShaderFromGraphs(t,"fragment");return n.debug(i),this._variables={},this._fragmentShaderMode=!1,this._activeNodeList={},i},createDefaultFragmentShaderGraph:function(){var t=this.getOrCreateConstant("vec4","fofd").setValue("vec4(1.0, 0.0, 1.0, 0.7)"),e=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(t).outputs(e),e},createFragmentShaderGraph:function(){var t=[];if(!this._material)return t.push(this.createDefaultFragmentShaderGraph()),t;var e,i=this.getOrCreateStateAttributeUniforms(this._material),r=this.getVertexColor(i.diffuse);if(this._lights.length>0){var n=this.createLighting({materialdiffuse:r});e=n}else e=r;if(i.emission){var a=this.createVariable("vec3").setValue("vec3(0.0)");this.getNode("Add").inputs(e,i.emission).outputs(a),e=a}var s=this.getDiffuseColorFromTextures();void 0!==s&&this.getNode("InlineCode").code("%color.rgb *= %texture.rgb;").inputs({texture:s}).outputs({color:e});var o,u=this.createVariable("float"),h=this.getFirstValidTexture();o=h?"%alpha = %color.a * %texelAlpha.a;":"%alpha = %color.a;",this._isBillboard&&(o+="if ( %alpha == 0.0) discard;"),this.getNode("InlineCode").code(o).inputs({color:i.diffuse,texelAlpha:h}).outputs({alpha:u}),e=this.getPremultAlpha(e,u);var l=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:e,alpha:u}).outputs({color:l}),t.push(l),t},getFragmentShaderName:function(){return this._material?"CompilerOSGJS":"NoMaterialCompilerOSGJS"},getVertexShaderName:function(){return this.getFragmentShaderName()}},t.exports=u},function(t,e,i){"use strict";var r=i(1109),n=i(1257),a=i(1290),s=i(1292),o=i(1293),u=i(1295),h=i(1294),l=i(1291),c=i(1288),d=i(1296),p=function(){this._nodes=new window.Map,this.registerNodes(n),this.registerNodes(a),this.registerNodes(l),this.registerNodes(s),this.registerNodes(o),this.registerNodes(c),this.registerNodes(u),this.registerNodes(h),this.registerNodes(d)};p.prototype={registerNodes:function(t){var e=this;window.Object.keys(t).forEach(function(i){e.registerNode(i,t[i])})},registerNode:function(t,e){this._nodes.has(t)&&r.warn("Node "+t+" already registered"),this._nodes.set(t,e)},getNode:function(t){var e=this._nodes.get(t);if(!e)return void r.warn("Node "+t+" does not exist");var i=window.Object.create(e.prototype);return e.apply(i,Array.prototype.slice.call(arguments,1)),i}};var f=new p;t.exports=f},function(t,e,i){"use strict";var r=i(1105),n=i(1258),a=i(1289),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{type:"Skinning",validInputs:["weights","bonesIndex","matrixPalette"],validOutputs:["mat4"],globalFunctionDeclaration:function(){return'#pragma include "skinning.glsl"'},computeShader:function(){return n.callFunction("skeletalTransform",this._outputs.mat4,[this._inputs.weights,this._inputs.bonesIndex])}}),t.exports={Skinning:s}},function(t,e,i){"use strict";var r=function(t,e){if(!t||!e)return"";var i;for(var r in e)i=e[r],void 0!==i&&(i.getVariable&&(i=i.getVariable()),t=t.replace("%s",i));return t},n=function(t,e){var i=t,r=[],n=e;void 0===e&&(n="");for(var a=0,s=i.length;s>a;a++){var o,u=i[a];o=void 0===u?"undefined":"string"==typeof u?u:u.getType?u.getType()+" "+u.getVariable():u.getVariable(),r.push(n+o)}return r},a=function(t,e,r){var a=i(1259),s=[],o="";if(a.debugShaderNode&&(s.push("\n// output"),Array.prototype.push.apply(s,n([e],"// "))),e&&(e.getVariable&&(e=e.getVariable()),o=e+" = "),o=o+t+"( ",r&&r.length>0){a.debugShaderNode&&(s.push("// inputs"),Array.prototype.push.apply(s,n(r,"// ")));for(var u=0,h=r.length;h>u;u++)o+=r[u].getVariable?r[u].getVariable():r[u],u!==h-1&&(o+=", ")}return o+=" );\n",a.debugShaderNode?s.join("\n")+"\n"+o:o};t.exports={callFunction:a,checkVariableType:n,sprintf:r}},function(t,e,i){"use strict";var r=i(1255),n=i(1254),a=i(1260),s=i(1264),o=i(1256),u=i(1287),h=i(1258),l={};l.Compiler=r,l.ShaderGenerator=n,l.ShaderGeneratorProxy=a,l.ShaderProcessor=s,l.nodeFactory=o,l.node=u,l.utils=h,l.debugShaderNode=!1,t.exports=l},function(t,e,i){"use strict";var r=i(1254),n=i(1261),a=i(1253),s=i(1263),o=function(){return this._generators=new window.Map,this.addShaderGenerator("default",new r),this.addShaderGenerator("ShadowCast",new n),this.addShaderGenerator("debugNormal",new a.ShaderGeneratorCompilerOffsetNormal),this.addShaderGenerator("debugTangent",new a.ShaderGeneratorCompilerOffsetTangent),this.addShaderGenerator("debugGeometry",new s.ShaderGeneratorCompilerColorGeometry),this.addShaderGenerator("debugSkinning",new s.ShaderGeneratorCompilerColorSkinning),this};o.prototype={getShaderGenerator:function(t){return t?this._generators.get(t):this._generators.get("default")},addShaderGenerator:function(t,e){this._generators.set(t,e)}},t.exports=o},function(t,e,i){"use strict";var r=i(1254),n=i(1262),a=function(){r.apply(this,arguments),this.setShaderCompiler(n),this._acceptAttributeTypes=new window.Set(["ShadowCast","Skinning","Morph"])};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1255),a=function(){n.apply(this,arguments),this._isVertexColored=!1,this._isLighted=!1};a.prototype=r.objectInherit(n.prototype,{getCompilerName:function(){return"ShadowCast"},getFragmentShaderName:function(){return this.getCompilerName()},initAttributes:function(){for(var t=this._attributes,e=0,i=t.length;i>e;e++){var r=t[e].className();"ShadowCastAttribute"===r?this._shadowCastAttribute=t[e]:"Billboard"===r?this._isBillboard=!!t[e]:"SkinningAttribute"===r?this._skinningAttribute=t[e]:"MorphAttribute"===r&&(this._morphAttribute=t[e])}},registerTextureAttributes:function(){},registerTextureShadow:function(){},declareVertexTransforms:function(t){this.declareTransformWithEyeSpace(t)},createShadowCastDepth:function(){var t=this.createVariable("vec4");return this.getNode("ShadowCast").setShadowCastAttribute(this._shadowCastAttribute).inputs({exponent0:this.getOrCreateUniform("float","exponent0"),exponent1:this.getOrCreateUniform("float","exponent1"),shadowDepthRange:this.getOrCreateUniform("vec4","Shadow_DepthRange"),fragEye:this.getOrCreateInputPosition()}).outputs({color:t}),t},createFragmentShaderGraph:function(){var t=this.createShadowCastDepth(),e=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(t).outputs(e),[e]}}),t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=i(1130),s=i(1176),o=i(1134),u=i(1118),h=i(1114),l=i(1254),c=i(1255),d=i(1139),p=i(1141),f=i(1140),g=i(1143),m=i(1184),v=function(){c.apply(this,arguments),this._isVertexColored=!1};v.prototype=r.objectInherit(c.prototype,{getFragmentShaderName:function(){return"CompilerDebugGeometry"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]},declareVertexTransforms:c.prototype.declareVertexTransformShadeless});var _=function(){l.apply(this,arguments),this.setShaderCompiler(v)};_.prototype=l.prototype;var b=function(){c.apply(this,arguments),this._isVertexColored=!1};b.prototype=r.objectInherit(c.prototype,{getFragmentShaderName:function(){return"CompilerDebugSkinning"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateVarying("vec3","vBonesColor"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]},declareVertexTransforms:function(t){var e=this.getOrCreateVarying("vec3","vBonesColor");return this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec3","BonesColor")).outputs(e),c.prototype.declareVertexTransformShadeless.call(this,t)}});var x=function(){l.apply(this,arguments),this.setShaderCompiler(b)};x.prototype=l.prototype;var A=function(){n.call(this),this._debugColor=!0,this._debugSkinning=!1,this._stCenter=new u,this._stCenter.setShaderGeneratorName("debugGeometry")};A.CompilerColorGeometry=v,A.ShaderGeneratorCompilerColorGeometry=_,A.CompilerSkinningGeometry=b,A.ShaderGeneratorCompilerColorSkinning=x,A.prototype=r.objectInherit(n.prototype,{setGeometryDebug:function(t){this._stCenter.setAttributeAndModes(new m(m.ALWAYS)),this._debugColor=!0,this._debugSkinning=!1,this.apply(t)},setSkinningDebug:function(t){this._stCenter.setAttributeAndModes(new m(m.NEVER)),this._debugColor=!1,this._debugSkinning=!0,this.apply(t)},disableDebug:function(t){this._stCenter.setAttributeAndModes(new m(m.NEVER)),this._debugColor=!1,this._debugSkinning=!1,this.apply(t)},apply:function(t){if(!t._isNormalDebug&&!t._isCenterDebug){if(t instanceof a)if(this._debugColor||this._debugSkinning&&t instanceof s){void 0===t._originalStateSet&&(t._originalStateSet=t.getStateSet()||null);var e=new u;if(t.setStateSet(e),this._debugSkinning){e.setShaderGeneratorName("debugSkinning");var i=t.getVertexAttributeList();if(!i.BonesColor){for(var r=i.Bones.getElements(),n=i.Weights.getElements(),l=t._rigTransformImplementation._bones,c=r.length/4,m=new Float32Array(3*c),v=0;c>v;++v){var _=4*v,b=l[r[_]].getOrCreateDebugColor(),x=l[r[_+1]].getOrCreateDebugColor(),A=l[r[_+2]].getOrCreateDebugColor(),y=l[r[_+3]].getOrCreateDebugColor(),S=n[_],C=n[_+1],w=n[_+2],T=n[_+3],M=3*v;m[M]=S*b[0]+C*x[0]+w*A[0]+T*y[0],m[M+1]=S*b[1]+C*x[1]+w*A[1]+T*y[1],m[M+2]=S*b[2]+C*x[2]+w*A[2]+T*y[2]}i.BonesColor=new d(d.ARRAY_BUFFER,m,3)}}else{var E=h.createAndSet(Math.random(),Math.random(),Math.random());e.addUniform(o.createFloat3(E,"uColorDebug")),e.setShaderGeneratorName("debugGeometry");var k=t.getBound(),I=new Float32Array(18),N=.1*k.radius();I[0]=N,I[3]=-N,I[7]=N,I[10]=-N,I[14]=N,I[17]=-N;var R=new a;R.getAttributes().Vertex=new d(d.ARRAY_BUFFER,I,3);var F=new p(f.LINES,0,6);R.getPrimitives().push(F);var P=new g,D=k.center();P.getMatrix()[12]=D[0],P.getMatrix()[13]=D[1],P.getMatrix()[14]=D[2],P.addChild(R),this.nodePath[this.nodePath.length-2].addChild(P),E=h.createAndSet(.8*E[0],.8*E[1],.8*E[2]),R.getOrCreateStateSet().addUniform(o.createFloat3(E,"uColorDebug")),P.setStateSet(this._stCenter),P._isCenterDebug=!0}}else void 0!==t._originalStateSet&&t.setStateSet(t._originalStateSet||void 0);this.traverse(t)}}}),t.exports=A},function(t,e,i){"use strict";var r=i(1109),n=i(1265),a=i(1273),s=function(t){if(!t){if(s.instance)return s.instance;s.instance=this}return this.addShaders(n),this.addShaders(a),this};s.prototype={_shadersText:{},_shadersList:{},_globalDefaultprecision:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif",_debugLines:!1,_includeR:/#pragma include "([^"]+)"/g,_includeCondR:/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,_defineR:/\#define\s+([a-zA-Z_0-9]+)/,_precisionR:/precision\s+(high|low|medium)p\s+float/,addShaders:function(t){var e=window.Object.keys(t);e.forEach(function(e){this._shadersList[e]=e,this._shadersText[e]=t[e]},this)},instrumentShaderlines:function(t,e){return"\n#line 0 "+e+"\n"+t},getShaderTextPure:function(t){var e=this._shadersText[t];return e||(r.error("shader file/text: "+t+" not registered"),e=""),e},getShader:function(t,e,i,r){var n=this.getShaderTextPure(t);return this.processShader(n,e,i,r)},preprocess:function(t,e,i,r){var n=this;return t.replace(this._includeCondR,function(t,a){var s=a.split(" "),o=s[0].replace(/"/g,"");if(s.length>1&&r){for(var u=!1,h=r.map(function(t){return n._defineR.test(t)&&t.replace(/\s+/g," ").split(" ")[1]}),l=1;l<s.length&&!u;l++)for(var c=s[l].replace(/"/g,""),d=0;d<h.length&&!u;d++)if(h[d]!==!1&&h[d]===c){u=!0;break}if(!u)return""}if(-1!==i.indexOf(o))return"";var p=this.getShaderTextPure(o);return i.push(o),this._debugLines&&(p=this.instrumentShaderlines(p,e)),e++,p=this.preprocess(p,e,i,r)}.bind(this))},processShader:function(t,e,i,r){var n=[],a=t,s=0;this._debugLines&&(a=this.instrumentShaderlines(a,s),s++),void 0!==e&&(e=e.sort().filter(function(t,i){return!i||t!==e[i-1]})),void 0!==i&&(i=i.sort().filter(function(t,e){return!e||t!==i[e-1]}));var o=this.preprocess(a,s,n,e,r),u="";return u+="#version 100\n",void 0!==i&&(u+=i.join("\n")+"\n"),this._globalDefaultprecision&&(this._precisionR.test(o)||(u+=this._globalDefaultprecision+"\n")),void 0!==e&&(u+=e.join("\n")+"\n"),o=u+o}},t.exports=s},function(t,e,i){"use strict";var r=i(1266),n=i(1267),a=i(1268),s=i(1269),o=i(1270),u=i(1271),h=i(1272);t.exports={"functions.glsl":r,"lights.glsl":n,"skinning.glsl":a,"textures.glsl":s,"colorEncode.glsl":o,"noise.glsl":u,"billboard.glsl":h}},function(t,e){t.exports="// the approximation :\n// http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\n// introduced slightly darker colors and more slight banding in the darks.\n// The reference implementation (or even a single pow approx) did not introduced these effects.\n\n// so for now we stick with the reference implementation :\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n// with the slight changes :\n// - we always assume the color is >= 0.0 (so no check)\n// - unlike the previous approximation, linear to srgb is monotonic so we don't need to check if the color is > 1\n\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\nfloat linearTosRGB(const in float c) {\n    return LIN_SRGB(c);\n}\nvec3 linearTosRGB(const in vec3 c) {\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\n}\n\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\nfloat sRGBToLinear(const in float c) {\n    return SRGB_LIN(c);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\n}\n\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec3 RGBMToRGB( const in vec4 rgba ) {\n    const float maxRange = 8.0;\n    return rgba.rgb * maxRange * rgba.a;\n}\n\nconst mat3 LUVInverse = mat3( 6.0013,    -2.700,   -1.7995,\n                              -1.332,    3.1029,   -5.7720,\n                              0.3007,    -1.088,    5.6268 );\n\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\n    vec3 Xp_Y_XYZp;\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\n    return max(vRGB, 0.0);\n}\n\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col, const in float range) {\n    if(range <= 0.0)\n        return vec4(col, 1.0);\n    vec4 rgbm;\n    vec3 color = col / range;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col, const in float range) {\n    if(range <= 0.0)\n        return col.rgb;\n    return range * col.rgb * col.a;\n}"},function(t,e){t.exports="////////////////\n// ATTENUATION\n/////////////\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation)\n{\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\n    // TODO find a vector alu instead of 4 scalar\n    float constant = lightAttenuation.x;\n    float linear = lightAttenuation.y*dist;\n    float quadratic = lightAttenuation.z*dist*dist;\n    return 1.0 / ( constant + linear + quadratic );\n}\n//\n// LIGHTING EQUATION TERMS\n///\nvoid specularCookTorrance(const in vec3 n, const in vec3 l, const in vec3 v, const in float hard, const in vec3 materialSpecular, const in vec3 lightSpecular, out vec3 specularContrib)\n{\n    vec3 h = normalize(v + l);\n    float nh = dot(n, h);\n    float specfac = 0.0;\n\n    if(nh > 0.0) {\n        float nv = max( dot(n, v), 0.0 );\n        float i = pow(nh, hard);\n        i = i / (0.1 + nv);\n        specfac = i;\n    }\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\n    float att = hard > 100.0 ? 1.0 : smoothstep(0.0, 1.0, hard * 0.01);\n    specularContrib = specfac*materialSpecular*lightSpecular*att;\n}\n\nvoid lambert(const in float ndl,  const in vec3 materialDiffuse, const in vec3 lightDiffuse, out vec3 diffuseContrib)\n{\n    diffuseContrib = ndl*materialDiffuse*lightDiffuse;\n}\n////////////////////////\n/// Main func\n///////////////////////\n\n/// for each light\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\n\nvec3 computeSpotLightShading(\n                             const in vec3 normal,\n                             const in vec3 eyeVector,\n\n                             const in vec3 materialAmbient,\n                             const in vec3 materialDiffuse,\n                             const in vec3 materialSpecular,\n                             const in float materialShininess,\n\n                             const in vec3 lightAmbient,\n                             const in vec3 lightDiffuse,\n                             const in vec3 lightSpecular,\n\n                             const in vec3  lightSpotDirection,\n                             const in vec4  lightAttenuation,\n                             const in vec4  lightSpotPosition,\n                             const in float lightCosSpotCutoff,\n                             const in float lightSpotBlend,\n\n                             const in mat4 lightMatrix,\n                             const in mat4 lightInvMatrix,\n\n                             out vec3 eyeLightPos,\n                             out vec3 eyeLightDir,\n                             out float NdotL,\n                             out bool lighted)\n{\n    lighted = false;\n    eyeLightPos = vec3(lightMatrix * lightSpotPosition);\n    eyeLightDir = eyeLightPos - FragEyeVector.xyz;\n    // compute dist\n    float dist = length(eyeLightDir);\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0)\n        {\n            // compute direction\n            eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n            if (lightCosSpotCutoff > 0.0)\n                {\n                    //compute lightSpotBlend\n                    vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\n\n                    float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\n                    float diffAngle = cosCurAngle - lightCosSpotCutoff;\n                    float spot = 1.0;\n                    if ( diffAngle < 0.0 ) {\n                        spot = 0.0;\n                    } else {\n                        if ( lightSpotBlend > 0.0 )\n                            spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\n                    }\n\n                    if (spot > 0.0)\n                        {\n                            // compute NdL\n                            NdotL = dot(eyeLightDir, normal);\n                            if (NdotL > 0.0)\n                                {\n                                    lighted = true;\n                                    vec3 diffuseContrib;\n                                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n                                    vec3 specularContrib;\n                                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n                                    return spot * attenuation * (diffuseContrib + specularContrib);\n                                }\n                        }\n                }\n        }\n    return vec3(0.0);\n}\n\nvec3 computePointLightShading(\n                              const in vec3 normal,\n                              const in vec3 eyeVector,\n\n                              const in vec3 materialAmbient,\n                              const in vec3 materialDiffuse,\n                              const in vec3 materialSpecular,\n                              const in float materialShininess,\n\n                              const in vec3 lightAmbient,\n                              const in vec3 lightDiffuse,\n                              const in vec3 lightSpecular,\n\n                              const in vec4 lightPosition,\n                              const in vec4 lightAttenuation,\n\n                              const in mat4 lightMatrix,\n\n                              out vec3 eyeLightPos,\n                              out vec3 eyeLightDir,\n                              out float NdotL,\n                              out bool lighted)\n{\n\n    eyeLightPos =  vec3(lightMatrix * lightPosition);\n    eyeLightDir = eyeLightPos - FragEyeVector.xyz;\n    float dist = length(eyeLightDir);\n    // compute dist\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0)\n        {\n            // compute direction\n            eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n            // compute NdL\n            NdotL = dot(eyeLightDir, normal);\n            if (NdotL > 0.0)\n                {\n                    lighted = true;\n                    vec3 diffuseContrib;\n                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n                    vec3 specularContrib;\n                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n                    return attenuation * (diffuseContrib + specularContrib);\n                }\n        }\n    return vec3(0.0);\n}\n\nvec3 computeSunLightShading(\n\n                            const in vec3 normal,\n                            const in vec3 eyeVector,\n\n                            const in vec3 materialAmbient,\n                            const in vec3 materialDiffuse,\n                            const in vec3 materialSpecular,\n                            const in float materialShininess,\n\n                            const in vec3 lightAmbient,\n                            const in vec3 lightDiffuse,\n                            const in vec3 lightSpecular,\n\n                            const in vec4 lightPosition,\n\n                            const in mat4 lightMatrix,\n\n                            out vec3 eyeLightDir,\n                            out float NdotL,\n                            out bool lighted)\n{\n\n    lighted = false;\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    // compute NdL   // compute NdL\n    NdotL = dot(eyeLightDir, normal);\n    if (NdotL > 0.0)\n        {\n            lighted = true;\n            vec3 diffuseContrib;\n            lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n            vec3 specularContrib;\n            specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n            return (diffuseContrib + specularContrib);\n        }\n    return vec3(0.0);\n}\n\nvec3 computeHemiLightShading(\n\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightDiffuse,\n    const in vec3 lightGround,\n\n    const in vec4 lightPosition,\n\n    const in mat4 lightMatrix,\n\n    out vec3 eyeLightDir,\n    out float NdotL,\n    out bool lighted)\n{\n    lighted = false;\n\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    NdotL = dot(eyeLightDir, normal);\n    float weight = 0.5 * NdotL + 0.5;\n    vec3 diffuseContrib = materialDiffuse * mix(lightGround, lightDiffuse, weight);\n\n    // same cook-torrance as above for sky/ground\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\n    float skySpec = pow(skyWeight, materialShininess);\n    float skyGround = pow(gndWeight, materialShininess);\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\n    vec3 specularContrib = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\n\n    return diffuseContrib + specularContrib;\n}\n";
},function(t,e){t.exports="//////////////////////////////\n// OPTIMIZED VERSION (NO IF)\n//////////////////////////////\nmat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n    mat4 outMat_1;\n    mat4 tmpMat_2;\n    highp ivec4 tmpvar_3;\n    tmpvar_3 = (3 * ivec4(bonesIdx));\n    tmpMat_2 = mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\n    vec4 tmpvar_4;\n    tmpvar_4 = -(abs(weightsVec));\n    tmpMat_2[0] = uBones[tmpvar_3.x];\n    tmpMat_2[1] = uBones[(tmpvar_3.x + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.x + 2)];\n    outMat_1 = ((float(\n    ((tmpvar_4.x + tmpvar_4.y) >= -((tmpvar_4.z + tmpvar_4.w)))\n    ) * mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0)) + (weightsVec.x * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.y];\n    tmpMat_2[1] = uBones[(tmpvar_3.y + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.y + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.y * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.z];\n    tmpMat_2[1] = uBones[(tmpvar_3.z + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.z + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.z * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.w];\n    tmpMat_2[1] = uBones[(tmpvar_3.w + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.w + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.w * tmpMat_2));\n\n    return outMat_1;\n}\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (WITH IF)\n//////////////////////////////\n\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\n// mat4 getMat4FromVec4( const int index, inout mat4 myMat ) {\n//     // We have to use a global variable because we can't access dynamically\n//     // matrix is transpose so we should do vec * matrix\n//     myMat[0] = uBones[ index ];\n//     myMat[1] = uBones[ index + 1];\n//     myMat[2] = uBones[ index + 2];\n//     return myMat;\n// }\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n//     mat4 outMat = mat4(0.0);\n\n//     // we handle negative weights\n//     if(all(equal(weightsVec, vec4(0.0)))) return tmpMat;\n\n//     if(weightsVec.x != 0.0) outMat += weightsVec.x * getMat4FromVec4( idx.x, tmpMat );\n//     if(weightsVec.y != 0.0) outMat += weightsVec.y * getMat4FromVec4( idx.y, tmpMat );\n//     if(weightsVec.z != 0.0) outMat += weightsVec.z * getMat4FromVec4( idx.z, tmpMat );\n//     if(weightsVec.w != 0.0) outMat += weightsVec.w * getMat4FromVec4( idx.w, tmpMat );\n//     return outMat;\n// }\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (NO IF)\n//////////////////////////////\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n\n//     // if sum is 0, return identity\n//     vec4 absWeights = -abs(weightsVec);\n//     mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\n\n//     // we handle negative weights\n//     // outMat[3][3] += weightsVec.x + weightsVec.y + weightsVec.z + weightsVec.w;\n\n//     tmpMat[0] = uBones[ idx.x ];\n//     tmpMat[1] = uBones[ idx.x + 1];\n//     tmpMat[2] = uBones[ idx.x + 2];\n//     outMat += weightsVec.x * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.y ];\n//     tmpMat[1] = uBones[ idx.y + 1];\n//     tmpMat[2] = uBones[ idx.y + 2];\n//     outMat += weightsVec.y * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.z ];\n//     tmpMat[1] = uBones[ idx.z + 1];\n//     tmpMat[2] = uBones[ idx.z + 2];\n//     outMat += weightsVec.z * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.w ];\n//     tmpMat[1] = uBones[ idx.w + 1];\n//     tmpMat[2] = uBones[ idx.w + 2];\n//     outMat += weightsVec.w * tmpMat;\n\n//     return outMat;\n// }\n"},function(t,e){t.exports="vec3 textureRGB(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).rgb;\n}\n\nvec4 textureRGBA(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).rgba;\n}\n\nfloat textureIntensity(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv).r;\n}\n\nfloat textureAlpha(const in sampler2D texture, const in vec2 uv) {\n    return texture2D(texture, uv.xy ).a;\n}\n"},function(t,e){t.exports="\nfloat decodeFloatRGBA( vec4 rgba ) {\n    return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\n}\n\nvec4 encodeFloatRGBA( float v ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\n\nvec2 decodeHalfFloatRGBA( vec4 rgba ) {\n    return vec2(rgba.x + (rgba.y / 255.0), rgba.z + (rgba.w / 255.0));\n}\n\nvec4 encodeHalfFloatRGBA( vec2 v ) {\n    const vec2 bias = vec2(1.0 / 255.0, 0.0);\n    vec4 enc;\n    enc.xy = vec2(v.x, fract(v.x * 255.0));\n    enc.xy = enc.xy - (enc.yy * bias);\n\n    enc.zw = vec2(v.y, fract(v.y * 255.0));\n    enc.zw = enc.zw - (enc.ww * bias);\n    return enc;\n}\n"},function(t,e){t.exports='#pragma include "hash.glsl"\n\n//// noise glsl\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\nfloat noise2D(const in vec2 x) {\n    vec2 i = floor(x);\n    vec2 f = fract(x);\n\n    // Four corners in 2D of a tile\n    float a = hash21(i);\n    float b = hash21(i + vec2(1.0, 0.0));\n    float c = hash21(i + vec2(0.0, 1.0));\n    float d = hash21(i + vec2(1.0, 1.0));\n\n    vec2 u = f * f * (3.0 - 2.0 * f);\n    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\n//// end noise glsl\n'},function(t,e){t.exports="vec3 getScale( const in mat4 matrix ) {\n      // Only working with positive scales.\n      float xs = matrix[0][0] * matrix[0][1] * matrix[0][2] * matrix[0][3] < 0. ? -1. : 1.;\n      float ys = matrix[1][0] * matrix[1][1] * matrix[1][2] * matrix[1][3] < 0. ? -1. : 1.;\n      float zs = matrix[2][0] * matrix[2][1] * matrix[2][2] * matrix[2][3] < 0. ? -1. : 1.;\n      vec3 scale;\n      scale.x = xs * sqrt( matrix[0][0] * matrix[0][0] + matrix[0][1] * matrix[0][1] + matrix[0][2] * matrix[0][2]);\n      scale.y = ys * sqrt( matrix[1][0] * matrix[1][0] + matrix[1][1] * matrix[1][1] + matrix[1][2] * matrix[1][2]);\n      scale.z = zs * sqrt( matrix[2][0] * matrix[2][0] + matrix[2][1] * matrix[2][1] + matrix[2][2] * matrix[2][2]);\n      return scale;\n}\n\nvec4 billboard( const in vec3 vertex, const in mat4 modelViewMatrix, const in mat4 projectionMatrix ) {\n      vec3 scale = getScale( modelViewMatrix );\n      return projectionMatrix * ( vec4( scale.x* vertex.x , scale.y * vertex.y, scale.z * vertex.z, 1.0 ) + vec4( modelViewMatrix[ 3 ].xyz, 0.0 ) );\n}\n"},function(t,e,i){"use strict";var r=i(1274),n=i(1275),a=i(1276),s=i(1277),o=i(1278),u=i(1279),h=i(1280),l=i(1281),c=i(1282),d=i(1283),p=i(1284),f=i(1285),g=i(1286);t.exports={"shadowsCastFrag.glsl":r,"shadowsReceive.glsl":n,"shadowsReceiveMain.glsl":a,"shadowLinearSoft.glsl":s,"pcf.glsl":o,"bandPCF.glsl":u,"tapPCF.glsl":h,"hash.glsl":l,"arrayPoisson.glsl":c,"poissonPCF.glsl":d,"esm.glsl":p,"vsm.glsl":f,"evsm.glsl":g}},function(t,e){t.exports='\n#pragma include "colorEncode.glsl"\n\n// see shadowSettings.js header for shadow algo param explanations\n\n#ifdef _EVSM\n// Convert depth to EVSM coefficients\n// Input depth should be in [0, 1]\nvec2 warpDepth(const in float depth, const in vec2 exponents) {\n    float pos =  exp( exponents.x * depth);\n    float neg = -exp(-exponents.y * depth);\n    return vec2(pos, neg);\n}\n\n// Convert depth value to EVSM representation\nvec4 shadowDepthToEVSM(const in float depth, const in float expo0, const in float expo1) {\n    vec2 warpedDepth = warpDepth(depth, vec2(expo0, expo1));\n    return vec4(warpedDepth.xy, warpedDepth.xy * warpedDepth.xy);\n}\n#endif // _EVSM\n\n\n#if defined(_NONE) ||  defined(_PCF)\nvec4 computeShadowDepth(const in vec4 fragEye,\n                        const in vec4 shadowRange)\n#else\nvec4 computeShadowDepth(const in vec4 fragEye,\n                        const in vec4 shadowRange,\n                        const in float expo0,\n                        const in float expo1)\n#endif\n{\n    // distance to camera\n    float depth =  -fragEye.z * fragEye.w;\n    // most precision near 0, make sure we are near 0 and in  [0,1]\n    depth = (depth - shadowRange.x ) * shadowRange.w;\n\n    vec4 outputFrag;\n\n#if defined (_FLOATTEX) && defined(_PCF)\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_ESM)\n    float depthScale = expo1;\n    depth = exp(-depth * depthScale);\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_VSM)\n    outputFrag = vec4(depth, depth * depth, 0.0, 1.0);\n#elif defined (_FLOATTEX)  && defined(_EVSM)\n    outputFrag = shadowDepthToEVSM(depth, expo0, expo1);\n#elif defined (_FLOATTEX) // && defined(_NONE)\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#elif defined(_PCF)\n    outputFrag = encodeFloatRGBA(depth);\n#elif defined(_ESM)\n    float depthScale = expo1;\n    depthScale = exp(-depth * depthScale);\n    outputFrag = encodeFloatRGBA(depthScale);\n#elif defined(_VSM)\n    outputFrag = encodeHalfFloatRGBA(vec2(depth, depth* depth));\n#else // NONE\n    outputFrag = encodeFloatRGBA(depth);\n\n#endif\n\n    return outputFrag;\n}\n'},function(t,e){t.exports='//begin shadows\n\n#pragma include "colorEncode.glsl"\n\n// see shadowSettings.js header for shadow algo param explanations\n\n// end Float codec\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return  decodeFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).x;\n#endif\n}\n\nvec2 getDoubleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return decodeHalfFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).xy;\n#endif\n}\n\nvec4 getQuadFloatFromTex(const in sampler2D depths, const in vec2 uv){\n    return texture2D(depths, uv).xyzw;\n}\n// end Float codec\n\n\n#pragma include "vsm.glsl" "_VSM"\n\n#pragma include "evsm.glsl" "_EVSM"\n\n#pragma include "esm.glsl" "_ESM"\n\n#pragma include "pcf.glsl" "_NONE" "_PCF"'},function(t,e){t.exports="\n    if (!lighted)\n        return 1.;\n\n    if (depthRange.x == depthRange.y)\n        return 1.;\n\n    vec4 shadowVertexEye = shadowViewMatrix *  vec4(vertexWorld, 1.0);\n    float shadowReceiverZ =  - shadowVertexEye.z;\n\n    if( shadowReceiverZ < 0.0)\n        return 1.0; // notably behind camera\n\n    vec4 shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\n    if (shadowVertexProjected.w < 0.0)\n        return 1.0; // notably behind camera\n\n    vec2 shadowUV;\n\n    shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\n    shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\n\n    bool outFrustum = any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0. ));\n    if (outFrustum )\n        return 1.0;// limits of light frustum\n    // most precision near 0, make sure we are near 0 and in [0,1]\n    shadowReceiverZ =  (shadowReceiverZ - depthRange.x)* depthRange.w;\n\n    // depth bias: fighting shadow acne (depth imprecsion z-fighting)\n    float shadowBias = 0.0;\n    // cosTheta is dot( n, l ), clamped between 0 and 1\n    //float shadowBias = 0.005*tan(acos(N_Dot_L));\n    // same but 4 cycles instead of 15\n    shadowBias += 0.05 *  sqrt( 1. -  N_Dot_L*N_Dot_L) / clamp(N_Dot_L, 0.0005,  1.0);\n\n    //That makes sure that plane perpendicular to light doesn't flicker due to\n    //selfshadowing and 1 = dot(Normal, Light) using a min bias\n    shadowBias = clamp(shadowBias, 0.00005,  bias);\n\n    // shadowZ must be clamped to [0,1]\n    // otherwise it's not comparable to\n    // shadow caster depth map\n    // which is clamped to [0,1]\n    // Not doing that makes ALL shadowReceiver > 1.0 black\n    // because they ALL becomes behind any point in Caster depth map\n    shadowReceiverZ = clamp(shadowReceiverZ, 0., 1. - shadowBias);\n\n    shadowReceiverZ -= shadowBias;\n\n    // Now computes Shadow\n\n    // Calculate shadow amount\n    float shadow = 1.0;\n\n    // return 0.0 for black;\n    // return 1.0 for light;\n\n#ifdef _NONE\n\n    float shadowDepth = getSingleFloatFromTex(tex, shadowUV.xy);\n    // shadowReceiverZ : receiver depth in light view\n    // shadowDepth : caster depth in light view\n    // receiver is shadowed if its depth is superior to the caster\n    shadow = ( shadowReceiverZ > shadowDepth ) ? 0.0 : 1.0;\n\n#elif defined( _PCF )\n    // pcf pbias to add on offset\n    vec2 shadowBiasPCF = vec2(0.);\n\n\n// looks like derivative is broken on some mac + intel cg ...\n#ifdef GL_OES_standard_derivatives\n\n    shadowBiasPCF.x = clamp(dFdx(shadowReceiverZ)* shadowMapSize.z, -1.0, 1.0 );\n    shadowBiasPCF.y = clamp(dFdy(shadowReceiverZ)* shadowMapSize.w, -1.0, 1.0 );\n    \n#endif\n\n\n    shadow = getShadowPCF(tex, shadowMapSize, shadowUV, shadowReceiverZ, shadowBiasPCF);\n\n#elif defined( _ESM )\n\n    shadow = fetchESM(tex, shadowMapSize, shadowUV, shadowReceiverZ, exponent0, exponent1);\n\n#elif  defined( _VSM )\n\n    vec2 moments = getDoubleFloatFromTex(tex, shadowUV.xy);\n    shadow = chebyshevUpperBound(moments, shadowReceiverZ, epsilonVSM);\n\n#elif  defined( _EVSM )\n\n    vec4 occluder = getQuadFloatFromTex(tex, shadowUV.xy);\n    vec2 exponents = vec2(exponent0, exponent1);\n    vec2 warpedDepth = warpDepth(shadowReceiverZ, exponents);\n\n    float derivationEVSM = epsilonVSM;\n    // Derivative of warping at depth\n    vec2 depthScale = derivationEVSM * exponents * warpedDepth;\n    vec2 minVariance = depthScale * depthScale;\n\n    float epsilonEVSM = -epsilonVSM;\n\n    // Compute the upper bounds of the visibility function both for x and y\n    float posContrib = chebyshevUpperBound(occluder.xz, -warpedDepth.x, minVariance.x);\n    float negContrib = chebyshevUpperBound(occluder.yw, warpedDepth.y, minVariance.y);\n\n    shadow = min(posContrib, negContrib);\n\n#endif\n\n\n    return shadow;\n"},function(t,e){t.exports="\n// simulation of texture2Dshadow glsl call on HW\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\nfloat texture2DCompare(const in sampler2D depths, const in vec2 uv, const in float compare){\n\n    float depth = getSingleFloatFromTex(depths, uv);\n    return step(compare, depth);\n\n}\n\n// simulates linear fetch like texture2d shadow\nfloat texture2DShadowLerp(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare){\n\n#if defined(_FAKE_PCF)\n    // CHEAT: it's wrong, but 4x faster\n    // wronb because http://www.eng.utah.edu/~cs5610/handouts/reeves87.pdf p2\n    return texture2DCompare(depths, uv, compare);\n#else\n    vec2 f = fract(uv*size.xy+0.5);\n    vec2 centroidUV = floor(uv*size.xy+0.5)*size.zw;\n\n    float lb = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 0.0), compare);\n    float lt = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 1.0), compare);\n    float rb = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 0.0), compare);\n    float rt = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 1.0), compare);\n    float a = mix(lb, lt, f.y);\n    float b = mix(rb, rt, f.y);\n    float c = mix(a, b, f.x);\n    return c;\n#endif\n\n}\n"},function(t,e){t.exports='\n#pragma include "bandPCF.glsl" "_BAND_PCF"\n#pragma include "poissonPCF.glsl" "_POISSON_PCF"\n#pragma include "tapPCF.glsl" "_TAP_PCF"\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_PCF" "_NONE"\n\n\n\n}\n'},function(t,e){t.exports="\n\n\nfloat getShadowPCF(const in sampler2D tex, const in vec4 size, const in vec2 uv, const in float shadowZ, const in vec2 biasPCF) {\n\n    float shadowed = 0.0;\n\n    #define TSF(off1, off2) getSingleFloatFromTex( tex, uv.xy + vec2(off1, off2) + biasPCF )\n\n    float dx0 = -size.z;\n    float dy0 = -size.w;\n    float dx1 = size.z;\n    float dy1 = size.w;\n\n    // fastest but gives banding\n#if defined(_PCFx4)\n\n    vec4 sV;\n\n    // vector ops faster alu\n    sV.x = TSF( dx0, dy0 );\n    sV.y = TSF( dx1, dy0 );\n    sV.z = TSF( dx1, dy0 );\n    sV.w = TSF( dx1, dy1 );\n    sV = vec4(lessThan(vec4(shadowZ), sV  ));\n    shadowed = dot(sV, vec4(0.25));\n\n    // here still didn't querying the real shadow at uv.\n    // This could be a single func checking for branching\n    // like before going to x9, x16 or anything\n    // or even complex \"blurring\"\n    if (shadowed != 0.0) // we're on an edge\n    {\n        shadowed += step(shadowZ, TSF(0.0, 0.0));\n        shadowed *= 0.5;\n    }\n\n#elif defined(_PCFx9)\n\n\n    mat3 kern;\n    mat3 depthKernel;\n\n\n    depthKernel[0][0] = TSF( dx0, dy0 );\n    depthKernel[0][1] = TSF( dx0, 0.0 );\n    depthKernel[0][2] = TSF( dx0, dy1 );\n    depthKernel[1][0] = TSF( 0.0, dy0 );\n    depthKernel[1][1] = TSF( 0.0, 0.0 );\n    depthKernel[1][2] = TSF( 0.0, dy1 );\n    depthKernel[2][0] = TSF( dx1, dy0 );\n    depthKernel[2][1] = TSF( dx1, 0.0 );\n    depthKernel[2][2] = TSF( dx1, dy1 );\n\n    // using 4 vector ops to save ALU\n    // filter is done post dept/shadow compare\n    vec3 shadowZ3 = vec3( shadowZ );\n    kern[0] = vec3(lessThan(shadowZ3, depthKernel[0]  ));\n    kern[0] *= vec3(0.25);\n\n    kern[1] = vec3(lessThan(shadowZ3, depthKernel[1] ));\n    kern[1] *= vec3(0.25);\n\n    kern[2] = vec3(lessThan(shadowZ3, depthKernel[2] ));\n    kern[2] *= vec3(0.25);\n\n    vec2 fractCoord = 1.0 - fract( uv.xy );\n\n    kern[0] = mix( kern[1], kern[0], fractCoord.x );\n    kern[1] = mix( kern[2], kern[1], fractCoord.x );\n\n    vec4 sV;\n    sV.x = mix( kern[0][1], kern[0][0], fractCoord.y );\n    sV.y = mix( kern[0][2], kern[0][1], fractCoord.y );\n    sV.z = mix( kern[1][1], kern[1][0], fractCoord.y );\n    sV.w = mix( kern[1][2], kern[1][1], fractCoord.x );\n\n    shadowed = dot( sV, vec4( 1.0 ) );\n\n#elif defined(_PCFx16)\n\n    float dx2 = -2.0 * size.z;\n    float dy2 = -2.0 * size.w;\n    float dx3 = 2.0 * size.z;\n    float dy3 = 2.0 * size.w;\n\n    shadowed += step(shadowZ , TSF(dx2, dy2));\n    shadowed += step(shadowZ , TSF(dx0, dy2));\n    shadowed += step(shadowZ , TSF(dx1, dy2));\n    shadowed += step(shadowZ , TSF(dx3, dy2));\n\n    shadowed += step(shadowZ , TSF(dx2, dy0));\n    shadowed += step(shadowZ , TSF(dx0, dy0));\n    shadowed += step(shadowZ , TSF(dx1, dy0));\n    shadowed += step(shadowZ , TSF(dx3, dy0));\n\n    shadowed += step(shadowZ , TSF(dx2, dy1));\n    shadowed += step(shadowZ , TSF(dx0, dy1));\n    shadowed += step(shadowZ , TSF(dx1, dy1));\n    shadowed += step(shadowZ , TSF(dx3, dy1));\n\n    shadowed += step(shadowZ , TSF(dx2, dy3));\n    shadowed += step(shadowZ , TSF(dx0, dy3));\n    shadowed += step(shadowZ , TSF(dx1, dy3));\n    shadowed += step(shadowZ , TSF(dx3, dy3));\n\n    shadowed = shadowed / 16.0;\n#endif // pcfx16\n    return shadowed;\n\n}\n"},function(t,e){t.exports='\n#pragma include "noise.glsl" "_ROTATE_OFFSET"\n\n#pragma include "shadowLinearSoft.glsl"\n\nfloat getShadowPCF(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec2 biasPCF)\n{\n\n     float res = 0.0;\n\n#if defined(_ROTATE_OFFSET)\n     res += texture2DShadowLerp(depths, size,   uv + size.zw*(noise2D(uv*gl_FragCoord.xy)*2.0 - 1.0) + biasPCF, compare);\n#else\n     res += texture2DShadowLerp(depths, size,   uv + biasPCF, compare);\n#endif\n\n\n#if defined(_PCFx1)\n\n#else\n\n    float dx0 = -size.z;\n    float dy0 = -size.w;\n    float dx1 = size.z;\n    float dy1 = size.w;\n\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF,  compare)\n\n    res += TSF(dx0, dx0);\n    res += TSF(dx0, .0);\n    res += TSF(dx0, dx1);\n\n#if defined(_PCFx4)\n\n    res /=4.0;\n\n#elif defined(_PCFx9)\n    res += TSF(.0, dx0);\n    res += TSF(.0, dx1);\n\n    res += TSF(dx1, dx0);\n    res += TSF(dx1, .0);\n    res += TSF(dx1, dx1);\n\n\n    res /=9.0;\n\n#elif defined(_PCFx25)\n\n    float dx02 = -2.0*size.z;\n    float dy02 = -2.0*size.w;\n    float dx2 = 2.0*size.z;\n    float dy2 = 2.0*size.w;\n\n    // complete row above\n    res += TSF(dx0, dx02);\n    res += TSF(dx0, dx2);\n\n    res += TSF(.0, dx02);\n    res += TSF(.0, dx2);\n\n    res += TSF(dx1, dx02);\n    res += TSF(dx1, dx2);\n\n    // two new col\n    res += TSF(dx02, dx02);\n    res += TSF(dx02, dx0);\n    res += TSF(dx02, .0);\n    res += TSF(dx02, dx1);\n    res += TSF(dx02, dx2);\n\n    res += TSF(dx2, dx02);\n    res += TSF(dx2, dx0);\n    res += TSF(dx2, .0);\n    res += TSF(dx2, dx1);\n    res += TSF(dx2, dx2);\n\n\n    res/=25.0;\n\n#endif\n\n#undef TSF\n\n#endif\n    return res;\n}\n/////// end Tap\n'},function(t,e){t.exports="//// hash glsl\n\n// Dave Hoskins: hash without sin\n//https://www.shadertoy.com/view/4djSRW\n#define MOD2 vec2(443.8975,397.2973)\n//----------------------------------------------------------------------------------------\n//  1 out, 1 in...\n//note: normalized uniform random, [0;1[\nfloat hash11(const in float p)\n{\n    vec2 p2 = fract(vec2(p) * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hash21(const in vec2 p)\n{\n    vec2 p2 = fract(p * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\n// using Sin\n//  1 out, 1 in...\nfloat hashSin11( const in float n )\n{\n    return fract(sin(n)*43758.5453);\n}\n\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hashSin21( const in vec2 n ) {\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\n// note: [-1;1]\n// iq: https://www.shadertoy.com/view/Xsl3Dl\n// note: value noise\n//  2 out, 2 in...\nvec2 hashSin22( const in vec2 n )\n{\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* vec2(43758.5453,35458.5734));\n}\n//  3 out, 3 in...\nvec3 hashSin33( in vec3 p )\n{\n    p = vec3( dot(p,vec3(127.1,311.7, 74.7)),\n              dot(p,vec3(269.5,183.3,246.1)),\n              dot(p,vec3(113.5,271.9,124.6)));\n    return fract(sin(p)*43758.5453123);\n}\n\n// Returns a random number based on a vec3 and an int.\nfloat hashSin41(const in vec4 seed){\n    return fract(sin(dot(seed, vec4(12.9898,78.233,45.164,94.673)) * 43758.5453));\n}\n\n/////// end hash\n"},function(t,e){t.exports="vec2 poissonDisk[64];\n\npoissonDisk[0] = vec2(-0.613392, 0.617481);\npoissonDisk[1] = vec2(0.170019, -0.040254);\npoissonDisk[2] = vec2(-0.299417, 0.791925);\npoissonDisk[3] = vec2(0.645680, 0.493210);\npoissonDisk[4] = vec2(-0.651784, 0.717887);\npoissonDisk[5] = vec2(0.421003, 0.027070);\npoissonDisk[6] = vec2(-0.817194, -0.271096);\npoissonDisk[7] = vec2(-0.705374, -0.668203);\npoissonDisk[8] = vec2(0.977050, -0.108615);\npoissonDisk[9] = vec2(0.063326, 0.142369);\npoissonDisk[10] = vec2(0.203528, 0.214331);\npoissonDisk[11] = vec2(-0.667531, 0.326090);\npoissonDisk[12] = vec2(-0.098422, -0.295755);\npoissonDisk[13] = vec2(-0.885922, 0.215369);\npoissonDisk[14] = vec2(0.566637, 0.605213);\npoissonDisk[15] = vec2(0.039766, -0.396100);\npoissonDisk[16] = vec2(0.751946, 0.453352);\npoissonDisk[17] = vec2(0.078707, -0.715323);\npoissonDisk[18] = vec2(-0.075838, -0.529344);\npoissonDisk[19] = vec2(0.724479, -0.580798);\npoissonDisk[20] = vec2(0.222999, -0.215125);\npoissonDisk[21] = vec2(-0.467574, -0.405438);\npoissonDisk[22] = vec2(-0.248268, -0.814753);\npoissonDisk[23] = vec2(0.354411, -0.887570);\npoissonDisk[24] = vec2(0.175817, 0.382366);\npoissonDisk[25] = vec2(0.487472, -0.063082);\npoissonDisk[26] = vec2(-0.084078, 0.898312);\npoissonDisk[27] = vec2(0.488876, -0.783441);\npoissonDisk[28] = vec2(0.470016, 0.217933);\npoissonDisk[29] = vec2(-0.696890, -0.549791);\npoissonDisk[30] = vec2(-0.149693, 0.605762);\npoissonDisk[31] = vec2(0.034211, 0.979980);\npoissonDisk[32] = vec2(0.503098, -0.308878);\npoissonDisk[33] = vec2(-0.016205, -0.872921);\npoissonDisk[34] = vec2(0.385784, -0.393902);\npoissonDisk[35] = vec2(-0.146886, -0.859249);\npoissonDisk[36] = vec2(0.643361, 0.164098);\npoissonDisk[37] = vec2(0.634388, -0.049471);\npoissonDisk[38] = vec2(-0.688894, 0.007843);\npoissonDisk[39] = vec2(0.464034, -0.188818);\npoissonDisk[40] = vec2(-0.440840, 0.137486);\npoissonDisk[41] = vec2(0.364483, 0.511704);\npoissonDisk[42] = vec2(0.034028, 0.325968);\npoissonDisk[43] = vec2(0.099094, -0.308023);\npoissonDisk[44] = vec2(0.693960, -0.366253);\npoissonDisk[45] = vec2(0.678884, -0.204688);\npoissonDisk[46] = vec2(0.001801, 0.780328);\npoissonDisk[47] = vec2(0.145177, -0.898984);\npoissonDisk[48] = vec2(0.062655, -0.611866);\npoissonDisk[49] = vec2(0.315226, -0.604297);\npoissonDisk[50] = vec2(-0.780145, 0.486251);\npoissonDisk[51] = vec2(-0.371868, 0.882138);\npoissonDisk[52] = vec2(0.200476, 0.494430);\npoissonDisk[53] = vec2(-0.494552, -0.711051);\npoissonDisk[54] = vec2(0.612476, 0.705252);\npoissonDisk[55] = vec2(-0.578845, -0.768792);\npoissonDisk[56] = vec2(-0.772454, -0.090976);\npoissonDisk[57] = vec2(0.504440, 0.372295);\npoissonDisk[58] = vec2(0.155736, 0.065157);\npoissonDisk[59] = vec2(0.391522, 0.849605);\npoissonDisk[60] = vec2(-0.620106, -0.328104);\npoissonDisk[61] = vec2(0.789239, -0.419965);\npoissonDisk[62] = vec2(-0.545396, 0.538133);\npoissonDisk[63] = vec2(-0.178564, -0.596057);\n"},function(t,e){t.exports='\n\n#pragma include "shadowLinearSoft.glsl"\n\n#pragma include "hash.glsl"\n\nfloat getShadowPCF(const in sampler2D tex, const in vec4 size, const in vec2 uv, const in float shadowZ, const in vec2 biasPCF) {\n\n    vec2 o = size.zw;\n    float s = 0.0;\n\n// Not Good, as it needs the lerp things\n#pragma include "arrayPoisson.glsl"\n\n    int idx = 0;\n\n    // Not Good, as it needs the lerp things\n#define TSF_BASE(p, m) texture2DShadowLerp(tex, size, uv + m*poissonDisk[p]*o + biasPCF,  shadowZ)\n\n// fixed pattern in the shadow, no noise\n#define TSF_FIXED(i) TSF_BASE(i, 1.0)\n\n    // rand  using screenpos: No banding,"moves" camera\n#define TSF_SCREEN(i) TSF_BASE(i, hashSin22( float(i)*gl_FragCoord.xy ))\n\n//rand using worl proj +depth as world psace xyez\n#define TSF_SPACE(i)  TSF_BASE(i, hashSin41(vec4(uv.xy, shadowZ, float(i))))\n\n#define TSF(k) TSF_SPACE(k)\n\n\n    s += TSF(1);\n    s += TSF(2);\n    s += TSF(3);\n    s += TSF(4);\n\n#ifdef _PCFx4\n    const float kernSize = 4.;\n#else\n    s += TSF(5);\n    s += TSF(6);\n    s += TSF(7);\n    s += TSF(8);\n#ifdef _PCFx9\n    const float kernSize = 8.;\n#else\n    s += TSF(9);\n    s += TSF(10);\n    s += TSF(11);\n    s += TSF(12);\n    s += TSF(13);\n    s += TSF(14);\n    s += TSF(15);\n    s += TSF(16);\n#ifdef _PCFx16\n    const float kernSize = 16.;\n#else\n    s += TSF(17);\n    s += TSF(18);\n    s += TSF(19);\n    s += TSF(20);\n    s += TSF(21);\n    s += TSF(22);\n    s += TSF(23);\n    s += TSF(24);\n    s += TSF(25);\n#ifdef _PCFx25\n    const float kernSize = 25.;\n#else\n    s += TSF(26);\n    s += TSF(27);\n    s += TSF(28);\n    s += TSF(29);\n    s += TSF(30);\n    s += TSF(31);\n    s += TSF(32);\n#ifdef _PCFx32\n    const float kernSize = 32.;\n#endif // 32\n#endif // 25\n#endif // 16\n#endif // 8\n#endif // 4\n\n    s /= kernSize;\n    return s;\n}\n// end poisson\n#undef TSF\n'},function(t,e){t.exports='////////////////////////////////////////////////\n// ESM\nfloat fetchESM(const in sampler2D tex, const in vec4 shadowMapSize, const in vec2 shadowUV, const in float shadowZ,  const in float exponent0, const in float exponent1) {\n\n\n#if defined(_FLOATTEX) && (!defined(_FLOATLINEAR))\n    // emulate bilinear filtering (not needed if webgm/GPU support filtering FP32/FP16 textures)\n    vec2 unnormalized = shadowUV * shadowMapSize.xy;\n    vec2 fractional = fract(unnormalized);\n    unnormalized = floor(unnormalized);\n\n    vec4 occluder4;\n    occluder4.x = getSingleFloatFromTex(tex, (unnormalized + vec2( -0.5,  0.5 ))* shadowMapSize.zw );\n    occluder4.y = getSingleFloatFromTex(tex, (unnormalized + vec2( 0.5,   0.5 ))* shadowMapSize.zw );\n    occluder4.z = getSingleFloatFromTex(tex, (unnormalized + vec2( 0.5,  -0.5 ))* shadowMapSize.zw );\n    occluder4.w = getSingleFloatFromTex(tex, (unnormalized + vec2( -0.5, -0.5 ))* shadowMapSize.zw );\n\n    float occluder = (occluder4.w + (occluder4.x - occluder4.w) * fractional.y);\n    occluder = occluder + ((occluder4.z + (occluder4.y - occluder4.z) * fractional.y) - occluder)*fractional.x;\n\n#else\n    float occluder = getSingleFloatFromTex(tex, shadowUV);\n#endif\n\n\n    // we\'re on an edge\n    float depthScale = exponent1;\n    float over_darkening_factor = exponent0;\n    float receiver = depthScale * ( shadowZ);\n    return 1.0 - clamp(over_darkening_factor*(occluder*exp(receiver)), 0.0, 1.0);\n}\n\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float exponent0,\n                    const in float exponent1\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_ESM"\n}\n\n// end ESM\n'},function(t,e){t.exports='//////VSM\n//http://en.wikipedia.org/wiki/Chebyshev%27s_inequality\nfloat chebychevInequality (const in vec2 moments, const in float t)\n{\n    // No shadow if depth of fragment is in front\n    if ( t <= moments.x )\n        return 1.0;\n\n    // Calculate variance, which is actually the amount of\n    // error due to precision loss from fp32 to RG/BA\n    // (moment1 / moment2)\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.02);\n\n    // Calculate the upper bound\n    float d = t - moments.x;\n    return variance / (variance + d * d);\n}\n\n// http://http.developer.nvidia.com/GPUGems3/gpugems3_ch08.html\nfloat chebyshevUpperBound(const in vec2 moments, const in float mean, const in float minVariance)\n{\n    float d = mean - moments.x;\n    if ( d <= 0.0 )\n        return 1.0;\n    // Compute variance\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, minVariance);\n\n    // Compute probabilistic upper bound\n    //p represent an upper bound on the visibility percentage of the receiver. This value //attempts to estimate how much of the distribution of occluders at the surface location is //beyond the surface\'s distance from the light. If it is 0, then there is no probability //that the fragment is partially lit, so it will be fully in shadow. If it is a value in the //[0, 1] range, it represent the penumbrae value of the shadow edge.\n    float p = smoothstep(mean, mean, moments.x);\n\n    // Remove the [0, Amount] tail and linearly rescale (Amount, 1].\n    /// light bleeding when shadows overlap.\n\n    float pMax = smoothstep(0.2, 1.0, variance / (variance + d*d));\n    // One-tailed chebyshev\n    return clamp(max(p, pMax), 0.0, 1.0);\n}\n\n// might be included for EVSM\n#ifdef _VSM\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float epsilonVSM\n    )\n{\n#pragma include "shadowsReceiveMain.glsl" "_VSM"\n}\n#endif // _VSM\n\n// end VSM\n';
},function(t,e){t.exports='// EVSM\n\n#pragma include "vsm.glsl"\n\n// Convert depth to EVSM coefficients\n// Input depth should be in [0, 1]\nvec2 warpDepth(const in float depth, const in vec2 exponents)\n{\n    float pos =  exp( exponents.x * depth);\n    float neg = -exp(-exponents.y * depth);\n    return vec2(pos, neg);\n}\n\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in float N_Dot_L,\n                    const in vec3 vertexWorld,\n                    const in float bias,\n                    const in float epsilonVSM,\n                    const in float exponent0,\n                    const in float exponent1\n    )\n{\n    #pragma include "shadowsReceiveMain.glsl" "_EVSM"\n}\n\n// _EVSM\n'},function(t,e,i){"use strict";var r=[i(1257),i(1288),i(1290),i(1291),i(1292),i(1293),i(1294)],n={};r.forEach(function(t){window.Object.keys(t).forEach(function(e){var i=t[e];if(void 0!==this[e])throw"duplicate entry in node library";this[e]=i},this)},n),t.exports=n},function(t,e,i){"use strict";var r=i(1105),n=i(1258),a=i(1289),s=function(){a.call(this)},o=function(t){return"vec4"===t.getType()?t.getVariable()+".rgb":t};s.prototype=r.objectInherit(a.prototype,{type:"Morph",validInputs:["weights","vertex","target0"],validOutputs:["out"],globalFunctionDeclaration:function(){var t=window.Object.keys(this._inputs).length-2,e=0,i="vec3 morphTransform( const in vec4 weights,  const in vec3 vertex, const in vec3 target0";for(e=1;t>e;++e)i+=", const in vec3 target"+e;if(i+=" ) { \n",1===t)i+="return mix(vertex, target0, weights[0])";else{for(i+="	vec3 vecOut = vertex * (1.0 - ( weights[0]",e=1;t>e;++e)i+=" + weights["+e+"]";for(i+="));\n",e=0;t>e;++e)i+="	vecOut += target"+e+" * weights["+e+"];\n";i+="	return vecOut"}return i+=";\n}\n"},computeShader:function(){for(var t=this._inputs,e=[t.weights,o(t.vertex)],i=0;4>i&&t["target"+i];i++)e.push(o(t["target"+i]));return n.callFunction("morphTransform",this._outputs.out,e)}}),t.exports={Morph:s}},function(t,e,i){"use strict";var r=i(1109),n=0,a=function(){this._name="AbstractNode",this._inputs=[],this._outputs=null,this._id=n++,this._text=void 0};a.prototype={getID:function(){return this._id},getName:function(){return this._name},getType:function(){return this.type},toString:function(){return"name : "+this._name+", type : "+this.type},getInputs:function(){return this._inputs},getOutputs:function(){return this._outputs},checkInputsOutputs:function(){var t,e;if(this.validInputs)for(t=0;t<this.validInputs.length;t++)if(e=this.validInputs[t],!this._inputs[e])return r.error("Shader node "+this.type+" validation error input "+e+" is missing"),!1;if(this.validOutputs)for(t=0;t<this.validOutputs.length;t++)if(e=this.validOutputs[t],!this._outputs[e])return r.error("Shader node "+this.type+" validation error output "+e+" is missing"),!1;return!0},inputs:function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(!i){r.error("Shader node "+this.type+" input number "+e+" is undefined ");break}if(Array.isArray(i))return this.inputs.apply(this,i),this;if("object"==typeof i&&null!==i&&i instanceof a==!1)return this._inputs=i,this;this._inputs.push(i)}return this},outputs:function(t){if(this._outputs=t,this._outputs instanceof a==!0)this.autoLink(this._outputs);else for(var e=window.Object.keys(this._outputs),i=0;i<e.length;i++){var r=e[i];this.autoLink(this._outputs[r])}return this},autoLink:function(t){return void 0===t?this:(t.inputs(this),this)},computeShader:function(){return this._text},comment:function(t){this._comment="//"+t},getComment:function(){return this._comment}},t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1258),a=i(1289),s=n.sprintf,o=function(t,e){a.call(this),this._name="Variable",this._prefix=e,this._type=t,this._value=void 0};o.prototype=r.objectInherit(a.prototype,{getType:function(){return this._type},getVariable:function(){return this._prefix},setValue:function(t){return this._value=t,this},declare:function(){return void 0!==this._value?s("%s %s = %s;",[this._type,this.getVariable(),this._value]):s("%s %s;",[this._type,this.getVariable()])}});var u=function(t,e){o.call(this,t,e)};u.prototype=r.objectInherit(o.prototype,{declare:function(){return s("const %s %s = %s;",[this._type,this.getVariable(),this._value])}});var h=function(t,e,i){o.call(this,t,e),this._size=i};h.prototype=r.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return this._size?s("uniform %s %s[%s];",[this._type,this.getVariable(),this._size]):s("uniform %s %s;",[this._type,this.getVariable()])}});var l=function(t,e){o.call(this,t,e)};l.prototype=r.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("attribute %s %s;",[this._type,this.getVariable()])}});var c=function(t,e){o.call(this,t,e)};c.prototype=r.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("varying %s %s;",[this._type,this.getVariable()])},reset:function(){this._inputs=[],this._outputs=null,this._text=void 0}});var d=function(t,e){o.call(this,t,e)};d.prototype=r.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("uniform %s %s;",[this._type,this.getVariable()])}});var p=function(t,e){o.call(this,t,e)};p.prototype=r.objectInherit(o.prototype,{_unique:!0,isUnique:function(){return this._unique},outputs:function(){return this},getVariable:function(){return this._prefix}});var f=function(){p.call(this,"vec4","gl_FragColor"),this._name="glFragColor"};f.prototype=r.objectInherit(p.prototype,{});var g=function(){p.call(this,"vec4","gl_Position"),this._name="glPosition"};g.prototype=r.objectInherit(p.prototype,{});var m=function(){p.call(this,"vec4","gl_PointSize"),this._name="glPointSize"};m.prototype=r.objectInherit(p.prototype,{}),t.exports={Output:p,glPointSize:m,glPosition:g,glFragColor:f,Sampler:d,Variable:o,Constant:u,Attribute:l,Varying:c,Uniform:h}},function(t,e,i){"use strict";var r=i(1105),n=i(1258),a=i(1289),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{type:"TextureAbstractNode",functionName:"noTextureFunction",validInputs:["sampler","uv"],validOutputs:["color"],computeShader:function(){return n.callFunction(this.functionName,this._outputs.color,[this._inputs.sampler,this._inputs.uv.getVariable()+".xy"])},globalFunctionDeclaration:function(){return'#pragma include "textures.glsl"'}});var o=function(){s.call(this)};o.prototype=r.objectInherit(s.prototype,{type:"TextureRGB",functionName:"textureRGB"});var u=function(){o.call(this)};u.prototype=r.objectInherit(o.prototype,{type:"TextureRGBA",functionName:"textureRGBA"});var h=function(){o.call(this)};h.prototype=r.objectInherit(o.prototype,{type:"TextureAlpha",functionName:"textureAlpha"});var l=function(){o.call(this)};l.prototype=r.objectInherit(o.prototype,{type:"TextureIntensity",functionName:"textureIntensity"}),t.exports={NodeTextures:s,TextureRGB:o,TextureRGBA:u,TextureAlpha:h,TextureIntensity:l}},function(t,e,i){"use strict";var r=i(1105),n=i(1258),a=i(1289),s=n.sprintf,o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{globalFunctionDeclaration:function(){return'#pragma include "functions.glsl"'}});var u=function(){o.call(this)};u.prototype=r.objectInherit(o.prototype,{type:"Normalize",validInputs:["vec"],validOuputs:["vec"],computeShader:function(){return n.callFunction("normalize",this._outputs.vec,[this._inputs.vec])}});var h=function(){o.call(this)};h.prototype=r.objectInherit(o.prototype,{type:"sRGBToLinear",validInputs:["color"],validOuputs:["color"],computeShader:function(){return this.computeConversion("sRGBToLinear")},computeConversion:function(t){var e=this._outputs.color,i=this._inputs.color,r=e.getType()!==i.getType()?".rgb":"";return n.callFunction(t,e.getVariable()+r,[i.getVariable()+r])}});var l=function(){h.call(this)};l.prototype=r.objectInherit(h.prototype,{type:"LinearTosRGB",computeShader:function(){return this.computeConversion("linearTosRGB")}});var c=function(){o.call(this)};c.prototype=r.objectInherit(o.prototype,{type:"FrontNormal",validInputs:["normal"],validOuputs:["normal"],computeShader:function(){return s("%s = gl_FrontFacing ? %s : -%s ;",[this._outputs.normal.getVariable(),this._inputs.normal.getVariable(),this._inputs.normal.getVariable()])}});var d=function(t){return t.getType&&"vec4"===t.getType()?t.getVariable()+".rgb":t},p=function(){o.call(this)};p.prototype=r.objectInherit(o.prototype,{type:"EncodeRGBM",validInputs:["color","range"],validOutputs:["color"],computeShader:function(){return n.callFunction("encodeRGBM",this._outputs.color,[d(this._inputs.color),this._inputs.range])}});var f=function(){o.call(this)};f.prototype=r.objectInherit(o.prototype,{type:"DecodeRGBM",validInputs:["color","range"],validOutputs:["color"],computeShader:function(){return n.callFunction("decodeRGBM",this._outputs.color,[this._inputs.color,this._inputs.range])}});var g=function(t){a.call(this),this._defineName=t,this._defineValue=""};g.prototype=r.objectInherit(a.prototype,{type:"Define",setValue:function(t){return this._defineValue=t,this},getDefines:function(){return["#define "+this._defineName+" "+this._defineValue]}}),t.exports={NodeFunctions:o,Normalize:u,sRGBToLinear:h,LinearTosRGB:l,FrontNormal:c,DecodeRGBM:f,EncodeRGBM:p,Define:g}},function(t,e,i){"use strict";var r=i(1105),n=i(1258),a=i(1289),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "lights.glsl"'}});var o=function(t){return"vec4"===t.getType()?t.getVariable()+".rgb":t},u=function(){s.call(this)};u.prototype=r.objectInherit(s.prototype,{type:"PointLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightposition","lightattenuation","lightmatrix","lighted","lightEyePos","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computePointLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,o(this._inputs.materialambient),o(this._inputs.materialdiffuse),o(this._inputs.materialspecular),this._inputs.materialshininess,o(this._inputs.lightambient),o(this._inputs.lightdiffuse),o(this._inputs.lightspecular),this._inputs.lightposition,this._inputs.lightattenuation,this._inputs.lightmatrix,this._inputs.lightEyePos,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var h=function(){s.call(this)};h.prototype=r.objectInherit(s.prototype,{type:"SpotLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightdirection","lightattenuation","lightposition","lightspotCutOff","lightspotBlend","lightmatrix","lightinvMatrix","lighted","lightEyePos","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeSpotLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,o(this._inputs.materialambient),o(this._inputs.materialdiffuse),o(this._inputs.materialspecular),this._inputs.materialshininess,o(this._inputs.lightambient),o(this._inputs.lightdiffuse),o(this._inputs.lightspecular),this._inputs.lightdirection,this._inputs.lightattenuation,this._inputs.lightposition,this._inputs.lightspotCutOff,this._inputs.lightspotBlend,this._inputs.lightmatrix,this._inputs.lightinvMatrix,this._inputs.lightEyePos,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var l=function(){s.call(this)};l.prototype=r.objectInherit(s.prototype,{type:"SunLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightposition","lightmatrix","lighted","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeSunLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,o(this._inputs.materialambient),o(this._inputs.materialdiffuse),o(this._inputs.materialspecular),this._inputs.materialshininess,o(this._inputs.lightambient),o(this._inputs.lightdiffuse),o(this._inputs.lightspecular),this._inputs.lightposition,this._inputs.lightmatrix,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var c=function(){s.call(this)};c.prototype=r.objectInherit(s.prototype,{type:"HemiLight",validInputs:["normal","eyeVector","materialdiffuse","materialspecular","materialshininess","lightdiffuse","lightground","lightposition","lightmatrix","lighted","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeHemiLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,o(this._inputs.materialdiffuse),o(this._inputs.materialspecular),this._inputs.materialshininess,o(this._inputs.lightdiffuse),o(this._inputs.lightground),this._inputs.lightposition,this._inputs.lightmatrix,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}}),t.exports={PointLight:u,SpotLight:h,SunLight:l,HemiLight:c}},function(t,e,i){"use strict";var r=i(1109),n=i(1105),a=i(1289),s=i(1258),o=s.sprintf,u=function(){a.call(this)};u.prototype=a.prototype;var h=function(){u.call(this)};h.prototype=n.objectInherit(u.prototype,{type:"Add",operator:"+",computeShader:function(){var t=this._outputs.getType(),e="";"vec4"===t?e=".rgba":"vec3"===t?e=".rgb":"vec2"===t&&(e=".rg");for(var i=this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+e,r=1,n=this._inputs.length;n>r;r++){var a=this._inputs[r];i+=this.operator+a.getVariable(),"float"!==a.getType()&&(i+=e)}return i+=";"}});var l=function(){h.call(this)};l.prototype=n.objectInherit(h.prototype,{type:"Mult",operator:"*"});var c=function(){h.call(this)};c.prototype=n.objectInherit(h.prototype,{type:"SetFromNode"});var d=function(){h.call(this),this._overwriteW=!0,this._forceComplement=!0,this._inverseOp=!1};d.prototype=n.objectInherit(h.prototype,{type:"MatrixMultDirection",operator:"*",validInputs:["vec","matrix"],validOutputs:["vec"],complement:"0.",setInverse:function(t){return this._inverseOp=t,this},setForceComplement:function(t){return this._forceComplement=t,this},setOverwriteW:function(t){return this._overwriteW=t,this},computeShader:function(){var t=this._inputs.vec.getVariable(),e=this._inputs.matrix.getVariable(),i=this._outputs.vec.getVariable(),r=this._inputs.vec.getType(),n=this._outputs.vec.getType(),a=i+" = ";"vec4"!==n&&(a+=n+"(");var s=t;return(this._forceComplement||"vec4"!==r)&&(s="vec4("+t+".xyz, "+this.complement+")"),a+=this._inverseOp?s+this.operator+e:e+this.operator+s,"vec4"!==n&&(a+=")"),a+=";",this._overwriteW||"vec4"!==r||(a+="\n"+i+".a = "+t+".a;"),a}});var p=function(){d.call(this),this._forceComplement=!1};p.prototype=n.objectInherit(d.prototype,{type:"MatrixMultPosition",complement:"1."});var f=function(){a.call(this)};f.prototype=n.objectInherit(a.prototype,{type:"InlineCode",code:function(t){return this._text=t,this},computeShader:function(){var t=n.objectMix({},this._inputs);t=n.objectMix(t,this._outputs);for(var e=new RegExp("%[A-Za-z0-9_]+","gm"),i=this._text,a=this._text.match(e),s=new Set,o=0;o<a.length;o++){var u=a[o].substr(1);if(!s.has(u)){t[u]||(r.error("error with inline code\n"+this._text),r.error("input "+u+" not provided for "+a[o]));var h=new RegExp(a[o].toString(),"gm");i=i.replace(h,t[u].getVariable()),s.add(u)}}return i}});var g=function(){u.call(this)};g.prototype=n.objectInherit(u.prototype,{type:"SetAlpha",validInputs:["color","alpha"],validOuputs:["color"],computeShader:function(){var t=this._inputs.alpha;return o("%s = vec4( %s.rgb, %s );",[this._outputs.color.getVariable(),this._inputs.color.getVariable(),"float"!==t.getType()?t.getVariable()+".a":t.getVariable()])}});var m=function(){u.call(this)};m.prototype=n.objectInherit(u.prototype,{type:"PreMultAlpha",validInputs:["color"],validOuputs:["color"],computeShader:function(){var t,e=void 0!==this._inputs.alpha?this._inputs.alpha:this._inputs.color;return t="float"!==e.getType()?e.getVariable()+".a":e.getVariable(),o("%s.rgb = %s.rgb * %s;",[this._outputs.color.getVariable(),this._inputs.color.getVariable(),t])}}),t.exports={BaseOperator:u,Mult:l,MatrixMultPosition:p,MatrixMultDirection:d,Add:h,InlineCode:f,SetAlpha:g,SetFromNode:c,PreMultAlpha:m}},function(t,e,i){"use strict";var r=i(1105),n=i(1258),a=i(1289),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{type:"ShadowReceiveNode",validInputs:["lighted","shadowTexture","shadowTextureMapSize","shadowTextureProjectionMatrix","shadowTextureViewMatrix","shadowTextureDepthRange","lightNDL","vertexWorld","shadowbias"],validOutputs:["float"],globalFunctionDeclaration:function(){return'#pragma include "shadowsReceive.glsl"'},setShadowAttribute:function(t){this._shadow=t},getDefines:function(){return this._shadow.getDefines()},getExtensions:function(){return this._shadow.getExtensions()},computeShader:function(){var t=this._inputs,e=[t.lighted,t.shadowTexture,t.shadowTextureMapSize,t.shadowTextureProjectionMatrix,t.shadowTextureViewMatrix,t.shadowTextureDepthRange,t.lightNDL,t.vertexWorld,t.shadowbias],i=this._shadow.getAlgorithm();return"ESM"===i?(e.push(this._inputs.shadowexponent0),e.push(this._inputs.shadowexponent1)):"EVSM"===i?(e.push(this._inputs.shadowepsilonVSM),e.push(this._inputs.shadowexponent0),e.push(this._inputs.shadowexponent1)):"VSM"===i&&e.push(this._inputs.shadowepsilonVSM),n.callFunction("computeShadow",this._outputs["float"],e)}});var o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{type:"ShadowCast",validInputs:["exponent0","exponent1","shadowDepthRange","fragEye"],validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "shadowsCastFrag.glsl"'},setShadowCastAttribute:function(t){return this._shadowCast=t,this},getDefines:function(){return this._shadowCast.getDefines()},computeShader:function(){var t=this._inputs,e=this._shadowCast.getAlgorithm();return"NONE"===e||"PCF"===e?n.callFunction("computeShadowDepth",this._outputs.color,[t.fragEye,t.shadowDepthRange]):n.callFunction("computeShadowDepth",this._outputs.color,[t.fragEye,t.shadowDepthRange,t.exponent0,t.exponent1])}}),t.exports={ShadowCast:o,ShadowReceive:s}},function(t,e,i){"use strict";var r=i(1105),n=i(1258),a=i(1289),s=function(){a.apply(this)};s.prototype=r.objectInherit(a.prototype,{type:"Billboard",validInputs:["Vertex","ModelViewMatrix","ProjectionMatrix"],validOutputs:["vec"],globalFunctionDeclaration:function(){return'#pragma include "billboard.glsl"'},computeShader:function(){return n.callFunction("billboard",this._outputs.vec,[this._inputs.Vertex,this._inputs.ModelViewMatrix,this._inputs.ProjectionMatrix])}}),t.exports={Billboard:s}},function(t,e,i){"use strict";var r,n=i(1298),a=i(1299),s=i(1109),o=function(){try{r=i(224)}catch(t){s.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")}},u=function(t){this.options=t;var e=document.createElement("style");e.type="text/css",e.innerHTML=[".osgDebugSimpleTooltip {","display: none;","position: absolute;","margin-left: 10px;","border-radius: 4px;","padding: 10px;","background: rgba(0,0,0,.9);","color: #ffffff;","}",".osgDebugSimpleTooltip:before {","content: ",";","position: absolute;","left: -10px;","top: 8px;","border: 10px solid transparent;","border-width: 10px 10px 10px 0;","border-right-color: rgba(0,0,0,.9);","}"].join("\n"),document.getElementsByTagName("head")[0].appendChild(e),this.el=document.createElement("div"),this.el.className="osgDebugSimpleTooltip",document.body.appendChild(this.el);for(var i=document.querySelectorAll(this.options.selector),r=0;r<i.length;r++)i[r].addEventListener("mouseover",this.showTooltip.bind(this),!1),i[r].addEventListener("mouseout",this.hideTooltip.bind(this),!1)};u.prototype={showTooltip:function(t){if(r){var e=t.currentTarget;this.el.innerHTML=e.getAttribute("title"),this.el.style.display="block",this.el.style.left=r(e).position().left+r(e).get(0).getBoundingClientRect().width+"px",this.el.style.top=r(e).position().top+"px"}},hideTooltip:function(){this.el.style.display="none"}};var h=function(){o(),r&&(this._selectables=new window.Map,this._graphNode=new a(this._selectables),this._graphRender=new n(this._selectables),this._displayNode=!0,this._displayRenderer=!1,this._cbSelect=void 0,this._focusedElement="graph",this._idToDomElement=new window.Map,this._$svg=r("<svg width=100% height=100%></svg>"),r("body").append(this._$svg),this._css=".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")};h.instance=function(){return h._instance||(h._instance=new h),h._instance},h.prototype={getColorFromClassName:a.prototype.getColorFromClassName,setCallbackSelect:function(t){this._cbSelect=t},reset:function(){r&&(this._selectables.clear(),this._$svg.empty(),this._focusedElement="scene",r(".osgDebugButton").hide())},setDisplayGraphRenderer:function(t){this._displayRenderer=t},createRenderGraph:function(t){this._graphRender.createGraph(t),this.displayGraph()},createGraph:function(t){r&&(this.reset(),this._displayNode=!!t,t&&this._graphNode.createGraph(t),this._displayRenderer?i(1300).debugGraph=!0:this.displayGraph())},displayGraph:function(){if(r){if(window.d3&&window.dagreD3)return void this._createGraphApply();var t="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js",e="//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js",i=this._createGraphApply.bind(this);r.getScript(t).done(function(){r.getScript(e).done(i)})}},_createGraphApply:function(){var t=new window.dagreD3.Digraph;this._displayNode&&this._graphNode.generateNodeAndLink(t),this._displayRenderer&&this._graphRender.generateNodeAndLink(t),this.injectStyleElement(),r(".osgDebugButton").show();var e=this.renderer=new window.dagreD3.Renderer,i=window.d3.select(this._$svg.get(0)),n=i.append("g"),a=.75,s=e.zoom();e.zoom(function(t,e){var i=s(t,e);return i.scale(a).event(e),i});var o=function(t,e){return'<p class="osgDebugName">'+t+'</p><pre class="osgDebugDescription">'+e+"</pre>"},h=this._idToDomElement,l=e.drawNodes();e.drawNodes(function(t,e){var i=l(t,e);return i.attr("title",function(e){return h.set(e,this),o(e,t.node(e).description||"")}),i}),e.run(t,n),this.tooltip=new u({selector:".node"}),r(".node").click(this.onNodeSelect.bind(this)),this.focusOnGraph()},selectNode:function(t){var e=t.getInstanceID(),i=this._idToDomElement.get(e);i&&r(i).click()},onNodeSelect:function(t){var e=t.currentTarget,i=r(e.getAttribute("title"))[0].innerHTML,n=this._selectables;this.lastNode&&(this.lastNode.style.fill=this.lastColor);var a=n.get(i);a&&(this.lastNode=e.childNodes[0],this.lastColor=this.lastNode.style.fill,e.childNodes[0].style.fill="#f00",window.activeNode=a,s.info("window.activeNode is set with the node below !"),s.log(window.activeNode),s.log("\n"),this._cbSelect&&this._cbSelect(a))},focusOnScene:function(){r(".osgDebugButton").text("Access to the graph"),this._$svg.css("zIndex","-2"),this._focusedElement="scene"},focusOnGraph:function(){r(".osgDebugButton").text("Access to the scene"),this._$svg.css("zIndex","2"),r(".osgDebugSimpleTooltip").css("zIndex","3"),this._focusedElement="graph"},injectStyleElement:function(){if(!this._cssInjected){this._cssInjected=!0,r("body").append('<button class="osgDebugButton">Access to the scene</button>'),r(".osgDebugButton").click(function(){"scene"===this._focusedElement?this.focusOnGraph():this.focusOnScene()}.bind(this));var t=document.createElement("style");t.type="text/css",t.innerHTML=this._css,document.getElementsByTagName("head")[0].appendChild(t)}}},t.exports=h},function(t,e,i){"use strict";var r=i(1299),n=i(1164),a=function(t){this._selectables=t,this._nodeList=[],this._linkList=[],this._renderBinMap=new window.Map,this._renderBinStack=[],this._generatorID=0,this._refID=0,this._uniqueEdges=new window.Set};a.prototype={getColorFromClassName:r.prototype.getColorFromClassName,createGraph:function(t){this.reset(),this.apply(t)},reset:function(){this._renderBinMap.clear(),this._renderBinStack.length=0,this._generatorID=0,this._refID++,this._nodeList.length=0,this._linkList.length=0,this._uniqueEdges.clear()},apply:function(t){var e=t.getInstanceID();if(this._renderBinMap.has(e)||this._renderBinMap.set(e,t),this._renderBinStack.push(t),t.getPreRenderStageList)for(var i=t.getPreRenderStageList(),r=0,n=i.length;n>r;++r)this.apply(i[r].renderStage);if(this.registerNode(t),t.getPostRenderStageList)for(var a=t.getPostRenderStageList(),s=0,o=a.length;o>s;++s)this.apply(a[s].renderStage);this._renderBinStack.pop()},registerNode:function(t){var e=t.getInstanceID();this._nodeList.push(t);for(var i=t._bins,r=window.Object.keys(i),n=0,a=r.length;a>n;n++){var s=i[r[n]];this.apply(s)}if(t._leafs.length)for(var o=0,u=t._leafs.length;u>o;o++)this.createNodeAndSetID(e,t._leafs[o]);for(var h=0,l=t.stateGraphList.length;l>h;h++){var c=t.stateGraphList[h];this.createNodeAndSetID(e,c);for(var d=c._instanceID,p=0,f=c.leafs.length;f>p;p++)this.createNodeAndSetID(d,c.leafs[p])}if(!(this._renderBinStack.length<2)){var g=this._renderBinStack[this._renderBinStack.length-2].getInstanceID();this.createLink(g,e)}},createLink:function(t,e){var i=t+"+"+e;this._uniqueEdges.has(i)||(this._linkList.push({parentNode:t,childrenNode:e}),this._uniqueEdges.add(i))},createNodeAndSetID:function(t,e){this._nodeList.push(e),(void 0===e._instanceID||e._instanceID<0&&e._refID!==this._refID)&&(e._instanceID=-1-this._generatorID++,e._refID=this._refID),this.createLink(t,e._instanceID)},generateRenderLeaf:function(t,e){var i=e._instanceID,r="RenderLeaf",n=e._geometry&&e._geometry.getName()?"\n"+e._geometry.getName():"Geometry",a=r+" ( "+e._instanceID+" )";a+="\n"+n+" ( "+e._geometry.getInstanceID()+" )",this._selectables.set(i.toString(),e),t.addNode(i,{label:a,description:"",style:"fill: "+this.getColorFromClassName(r)+";stroke-width: 0px;"})},generateStateGraph:function(t,e){var i=e._instanceID,r="StateGraph",n=r+" ( "+e._instanceID+" )";n+="\n"+e.leafs.length+" leafs",this._selectables.set(i.toString(),e),t.addNode(i,{label:n,description:"",style:"fill: "+this.getColorFromClassName(r)+";stroke-width: 0px;"})},generateRenderStage:function(t,e){var i=e.className()+" ( "+e._instanceID+" )";e.getName()&&(i+="\n"+e.getName()),i+="\nViewport ( "+e.getViewport().width()+" x "+e.getViewport().height()+" )",this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:i,description:"",style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateRenderBin:function(t,e){var i=e.className()+" ( "+e.getInstanceID()+" )";e.getName()&&(i+="\n"+e.getName());var r="";e.getSortMode()===n.SORT_BACK_TO_FRONT&&(r="SortMode: BackToFront");var a="BinNumber: "+e.getBinNumber()+"\n"+r;this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:i,description:a,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateNodeAndLink:function(t){for(var e=0,i=this._nodeList.length;i>e;e++){var r=this._nodeList[e];r._geometry&&void 0!==r._depth?this.generateRenderLeaf(t,r):void 0!==r.depth&&r.leafs&&r.children?this.generateStateGraph(t,r):"RenderStage"===r.className()?this.generateRenderStage(t,r):this.generateRenderBin(t,r)}for(var n=0,a=this._linkList.length;a>n;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}},t.exports=a},function(t,e,i){"use strict";var r=i(1105),n=i(1121),a=i(1177),s=function(t){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._selectables=t,this._nodeList=[],this._linkList=[],this._uniqueNodes=new window.Set,this._uniqueEdges=new window.Set};s.prototype=r.objectInherit(n.prototype,{getColorFromClassName:function(t){switch(t){case"ShadowedScene":return"#3D3D3D";case"Camera":return"#AB7BCF";case"RenderBin":return"#59778B";case"LightSource":return"#53967D";case"RenderStage":return"#DDCC55";case"RenderLeaf":case"Geometry":return"#FFCC55";case"RigGeometry":return"#DD8800";case"MorphGeometry":return"#AA5500";case"MatrixTransform":return"#CE697E";case"StateSet":return"#0099FF";case"StateGraph":case"Skeleton":return"#96999E";case"Bone":return"#A9DEAA";case"Node":return"#FFFFFF";default:return"#FF00AA"}},createGraph:function(t){this.reset(),t.accept(this)},reset:function(){this._nodeList.length=0,this._linkList.length=0,this._uniqueNodes.clear(),this._uniqueEdges.clear()},apply:function(t){if(!t._isNormalDebug){if(this._uniqueNodes.has(t.getInstanceID())||(this._uniqueNodes.add(t.getInstanceID()),this._nodeList.push(t)),this.nodePath.length>=2){var e=this.nodePath[this.nodePath.length-2].getInstanceID(),i=t.getInstanceID(),r=e+"+"+i;this._uniqueEdges.has(r)||(this._linkList.push({parentNode:e,childrenNode:i}),this._uniqueEdges.add(r))}this.traverse(t)}},createMatrixGrid:function(t,e){var i="";return i+="<table><tr><td>"+e[0]+"</td>",i+="<td>"+e[4]+"</td>",i+="<td>"+e[8]+"</td>",i+="<td>"+e[12]+"</td></tr>",i+="<tr><td>"+e[1]+"</td>",i+="<td>"+e[5]+"</td>",i+="<td>"+e[9]+"</td>",i+="<td>"+e[13]+"</td></tr>",i+="<tr><td>"+e[2]+"</td>",i+="<td>"+e[6]+"</td>",i+="<td>"+e[10]+"</td>",i+="<td>"+e[14]+"</td></tr>",i+="<tr><td>"+e[3]+"</td>",i+="<td>"+e[7]+"</td>",i+="<td>"+e[11]+"</td>",i+="<td>"+e[15]+"</td></tr></table>"},getLabel:function(t){var e=t.className()+" ("+t.getInstanceID()+")";return t.getName&&t.getName()&&(e+="\n"+t.getName()),e},generateNode:function(t,e){var i="";e.getMatrix&&e.getMatrix()&&(i+="<br /><br />"+this.createMatrixGrid(e,e.getMatrix())),this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:this.getLabel(e),description:i,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateStateSet:function(t,e){var i=e.getStateSet(),r=i.getInstanceID(),n=this.getLabel(i);n+="\nNbTexture : "+i.getNumTextureAttributeLists(),t.hasNode(r)||(this._selectables.set(r.toString(),i),t.addNode(r,{label:n,style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"})),t.addEdge(null,e.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateSourceGeometry:function(t,e){var i=e.getSourceGeometry(),r=i.getInstanceID();this._selectables.set(r.toString(),i),t.addNode(r,{label:this.getLabel(i),style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"}),t.addEdge(null,e.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateNodeAndLink:function(t){for(var e=0,i=this._nodeList.length;i>e;e++){var r=this._nodeList[e];this.generateNode(t,r),r.getStateSet()&&this.generateStateSet(t,r),
r.getSourceGeometry&&r.getSourceGeometry()instanceof a&&this.generateSourceGeometry(t,r)}for(var n=0,s=this._linkList.length;s>n;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1105),n=i(1155),a=i(1161),s=i(1112),o=i(1165),u=i(1202),h=i(1107),l=i(1124),c=i(1259),d=i(1297),p=function(t){s.call(this),this._state=void 0,this._camera=t,this._renderStage=void 0,this._stateGraph=void 0,this._frameStamp=void 0,this._previousCullsettings=new n,this.setDefaults()};p.debugGraph=!1,p.prototype=r.objectLibraryClass(r.objectInherit(s.prototype,{setDefaults:function(){this._state=new u(new c.ShaderGeneratorProxy),this._cullVisitor=new a,this._cullVisitor.setRenderer(this),this._stateGraph=new h,this.getCamera().setClearColor(l.create()),this.setRenderStage(new o);var t=i(1103),e=this.getCamera().getOrCreateStateSet();e.setAttributeAndModes(new t.Material),e.setAttributeAndModes(new t.Depth),e.setAttributeAndModes(new t.BlendFunc),e.setAttributeAndModes(new t.CullFace)},getCullVisitor:function(){return this._cullVisitor},setCullVisitor:function(t){t&&!t.getRenderer()&&t.setRenderer(this),this._cullVisitor=t},setRenderStage:function(t){this._renderStage=t},getCamera:function(){return this._camera},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},getState:function(){return this._state},setState:function(t){this._state=t},setGraphicContext:function(t){this._state.setGraphicContext(t)},getGraphicContext:function(){return this._state.getGraphicContext()},cullAndDraw:function(){this.cull(),this.draw()},cull:function(){var t=this.getCamera(),e=t.getView();this._cullVisitor.setFrameStamp(this._frameStamp),this._cullVisitor.resetStats(),this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage),this._cullVisitor.pushStateSet(t.getStateSet()),this._previousCullsettings.reset(),this._previousCullsettings.setCullSettings(this._cullVisitor),this._cullVisitor.setCullSettings(t),this._previousCullsettings.getSettingSourceOverrider()===this._cullVisitor&&this._previousCullsettings.getEnableFrustumCulling()&&this._cullVisitor.setEnableFrustumCulling(!0),this._cullVisitor.pushCameraModelViewProjectionMatrix(t,t.getViewMatrix(),t.getProjectionMatrix()),t.getBound();var r=e.getLight(),n=i(1301);if(r)switch(e.getLightingMode()){case n.LightingMode.HEADLIGHT:this._cullVisitor.addPositionedAttribute(null,r);break;case n.LightingMode.SKY_LIGHT:this._cullVisitor.addPositionedAttribute(t.getViewMatrix(),r)}this._cullVisitor.pushViewport(t.getViewport()),this._renderStage.setClearDepth(t.getClearDepth()),this._renderStage.setClearColor(t.getClearColor()),this._renderStage.setClearMask(t.getClearMask()),this._renderStage.setViewport(t.getViewport()),this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),this._cullVisitor.handleCullCallbacksAndTraverse(t),this._cullVisitor.popCameraModelViewProjectionMatrix(t),this._cullVisitor.setCullSettings(this._previousCullsettings),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var t=this.getState();t.resetCacheFrame(),t.resetStats(),this._renderStage.setCamera(this._camera),this._renderStage.draw(t),p.debugGraph&&(d.instance().createRenderGraph(this._renderStage),p.debugGraph=!1),this._renderStage.setCamera(void 0),t.applyDefault()}}),"osgViewer","Renderer"),t.exports=p},function(t,e,i){"use strict";var r=i(1139),n=i(1154),a=i(1186),s=i(1166),o=i(1195),u=i(1122),h=i(1133),l=i(1198),c=i(1199),d=i(1114),p=i(1205),f=i(1131),g=i(1240),m=i(1241),v=i(1300),_=i(1302),b=i(1297),x=i(1109),A=function(){this._camera=new n,this._scene=new _,this._frameStamp=new a,this._lightingMode=void 0,this._manipulator=void 0,this._canvasWidth=0,this._canvasHeight=0,this._requestContinousUpdate=!0,this._requestRedraw=!0,this.setLightingMode(A.LightingMode.HEADLIGHT);var t=this.createRenderer(this.getCamera());t.setFrameStamp(this._frameStamp),this.getCamera().setRenderer(t),this.getCamera().setView(this)};A.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},A.prototype={requestRedraw:function(){this._requestRedraw=!0},requestContinuousUpdate:function(t){this._requestContinousUpdate=t},createRenderer:function(t){var e=new v(t);return e},setGraphicContext:function(t){this.getCamera().getRenderer().getState().setGraphicContext(t)},getGraphicContext:function(){return this.getCamera().getRenderer().getState().getGraphicContext()},initWebGLCaps:function(t){f.instance(t)},computeCanvasSize:function(){return function(t){var e,i;e=t.clientWidth,i=t.clientHeight,1>e&&(e=1),1>i&&(i=1);var r=this._devicePixelRatio,n=Math.floor(e*r),a=Math.floor(i*r),s=!1;return this._canvasWidth!==n&&(t.width=n,this._canvasWidth=n,s=!0),this._canvasHeight!==a&&(t.height=a,this._canvasHeight=a,s=!0),s}}(),getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCanvasClientWidth:function(){return Math.ceil(this._canvasWidth/this._devicePixelRatio)},getCanvasClientHeight:function(){return Math.ceil(this._canvasHeight/this._devicePixelRatio)},getCanvasPixelRatio:function(){return this._devicePixelRatio},setUpView:function(t,e){var i=window.devicePixelRatio||1,r=e.getNumber("overrideDevicePixelRatio"),n=e.getNumber("maxDevicePixelRatio")||-1;"number"==typeof r?i=r:-1!==n&&(i=Math.min(i,n)),this._devicePixelRatio=i,this.computeCanvasSize(t);var a=t.width,s=t.height,o=a/s;if(this._camera.setViewport(new p(0,0,a,s)),this._camera.setGraphicContext(this.getGraphicContext()),u.makeLookAt(d.createAndSet(0,0,-10),d.create(),d.createAndSet(0,1,0),this._camera.getViewMatrix()),u.makePerspective(55,o,1,1e3,this._camera.getProjectionMatrix()),e&&e.enableFrustumCulling&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e&&e.debugGraph){var h=this.getCamera();b.instance().refreshGraph=function(){var t=b.instance();t.setDisplayGraphRenderer(!0),t.createGraph(h)},x.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")}},computeIntersections:function(t,e,i){return void 0===i&&(i=-1),this._lsi?this._lsi.reset():this._lsi=new m,this._origIntersect||(this._origIntersect=d.create(),this._dstIntersect=d.create()),this._lsi.set(d.set(t,e,0,this._origIntersect),d.set(t,e,1,this._dstIntersect)),this._iv?this._iv.reset():(this._iv=new g,this._iv.setIntersector(this._lsi)),this._iv.setTraversalMask(i),this._camera.accept(this._iv),this._lsi.getIntersections()},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setSceneData:function(t){t!==this._scene.getSceneData()&&(this._scene.setSceneData(t),this._camera.removeChildren(),this._camera.addChild(t))},getSceneData:function(){return this._scene.getSceneData()},setDatabasePager:function(t){this._scene.setDatabasePager(t)},getDatabasePager:function(){return this._scene.getDatabasePager()},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(t){this._manipulator=t},getLight:function(){return this._light},setLight:function(t){this._light=t,this._lightingMode!==A.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(t){this._lightingMode!==t&&(this._lightingMode=t,this._lightingMode!==A.LightingMode.NO_LIGHT?this._light||(this._light=new o):this._light=void 0)},flushDeletedGLObjects:function(t){var e=this.getGraphicContext();t=r.flushDeletedGLBufferArrays(e,t),t=h.getTextureManager(e).flushDeletedTextureObjects(e,t),t=l.flushDeletedGLPrograms(e,t),t=c.flushDeletedGLShaders(e,t),t=s.flushDeletedGLFrameBuffers(e,t),t=s.flushDeletedGLRenderBuffers(e,t)},flushAllDeletedGLObjects:function(){var t=this.getGraphicContext();r.flushAllDeletedGLBufferArrays(t),h.getTextureManager(t).flushAllDeletedTextureObjects(t),l.flushAllDeletedGLPrograms(t),c.flushAllDeletedGLShaders(t),s.flushAllDeletedGLFrameBuffers(t),s.flushAllDeletedGLRenderBuffers(t)}},t.exports=A},function(t,e,i){"use strict";var r=i(1105),n=i(1112),a=i(1223),s=function(){n.call(this),this._databasePager=new a,this._sceneData=void 0};s.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getSceneData:function(){return this._sceneData},setSceneData:function(t){this._sceneData=t},setDatabasePager:function(t){this._databasePager=t},getDatabasePager:function(){return this._databasePager},updateSceneGraph:function(t){this._databasePager&&this._databasePager.updateSceneGraph(t.getFrameStamp()),this._sceneData&&this._sceneData.accept(t)}}),"osgViewer","Scene"),t.exports=s},function(t,e,i){"use strict";var r=i(1111),n=i(1143),a=i(1109),s=i(1184),o=i(1138),u=i(1157),h=i(1134),l=i(1168),c=i(1114),d=i(1124),p=i(1122),f=i(1125),g=i(1240),m=i(1241),v=i(1304),_=i(1128),b=i(1105),x=function(t,e){t[0]=void 0===e.offsetX?e.layerX:e.offsetX,t[1]=void 0===e.offsetY?e.layerY:e.offsetY},A=function(){};A.prototype={cull:function(){return!1}};var y=new o(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),S=function(t){this._testPlane=t,this._inter=c.create(),m.call(this)};S.prototype=b.objectInherit(m.prototype,{setTestPlane:function(t){this._testPlane=t},getTranslateDistance:function(){return this._inter},enter:function(){var t=c.create(),e=c.create();return function(i){if(void 0===i._nbAxis)return!0;if(c.init(t),t[i._nbAxis]=1,this._testPlane){var r=c.dot(this._iStart,t),n=c.dot(this._iEnd,t);if(r===n)return!1;var a=-r/(n-r);this._inter[0]=this._iStart[0]+(this._iEnd[0]-this._iStart[0])*a,this._inter[1]=this._iStart[1]+(this._iEnd[1]-this._iStart[1])*a,this._inter[2]=this._iStart[2]+(this._iEnd[2]-this._iStart[2])*a}else{c.normalize(c.sub(this._iEnd,this._iStart,e),e);var s=-c.dot(e,t),o=c.dot(this._iStart,e),u=Math.abs(1-s*s),h=-c.dot(this._iStart,t);c.init(this._inter),this._inter[i._nbAxis]=(s*o-h)/u}return!1}}(),intersect:function(){return!1}});var C=function(t){n.call(this),this._tmask=1,this._autoInsertMT=!1,this._viewer=t,this._canvas=t.getGraphicContext().canvas,this._manipulator=t.getManipulator(),this._rotateNode=new n,this._translateNode=new n,this._planeNode=new n,this._rotateInLocal=!0,this._translateInLocal=!0,this._showAngle=new n,this._downCanvasCoord=l.create(),this._hoverNode=null,this._keepHoverColor=d.create(),this._isEditing=!1,this._editLineOrigin=c.create(),this._editLineDirection=c.create(),this._editOffset=c.create(),this._editLocal=p.create(),this._editWorldTrans=p.create(),this._editWorldScaleRot=p.create(),this._editInvWorldScaleRot=p.create(),this._debugNode=new r,this._lastDistToEye=0,this._attachedNode=null,this.attachToGeometry(null),this._lsi=new S,this._origIntersect=c.create(),this._dstIntersect=c.create(),this._iv=new g,this._iv.setIntersector(this._lsi),this.init()};C.NO_PICK=1,C.PICK_ARC_X=2,C.PICK_ARC_Y=4,C.PICK_ARC_Z=8,C.PICK_ARROW_X=16,C.PICK_ARROW_Y=32,C.PICK_ARROW_Z=64,C.PICK_PLANE_X=128,C.PICK_PLANE_Y=256,C.PICK_PLANE_Z=512,C.NO_FULL_CIRCLE=1024,C.PICK_ARC=C.PICK_ARC_X|C.PICK_ARC_Y|C.PICK_ARC_Z,C.PICK_ARROW=C.PICK_ARROW_X|C.PICK_ARROW_Y|C.PICK_ARROW_Z,C.PICK_PLANE=C.PICK_PLANE_X|C.PICK_PLANE_Y|C.PICK_PLANE_Z,C.PICK_GIZMO=C.PICK_ARC|C.PICK_ARROW|C.PICK_PLANE,C.prototype=b.objectInherit(n.prototype,{setRotateInLocal:function(t){this._rotateInLocal=t},setTranslateInLocal:function(t){this._translateInLocal=t},setTraversalMask:function(t){this._tmask=t},init:function(){this.getOrCreateStateSet().setAttributeAndModes(new s(s.DISABLE)),this.getOrCreateStateSet().setAttributeAndModes(new u(u.DISABLE));var t=function(){};t.prototype={update:this.updateGizmo.bind(this)},this.addUpdateCallback(new t),this.addChild(this.initNodeTranslate()),this.addChild(this.initNodeTranslatePlane()),this.addChild(this.initNodeRotate()),this._debugNode&&(this._debugNode.addChild(v.createDebugLineGeometry()),this.addChild(this._debugNode),this._debugNode.setNodeMask(0));var e=this._canvas;e.addEventListener("mousemove",this.onMouseMove.bind(this)),e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mouseout",this.onMouseUp.bind(this))},attachToNodePath:function(t){var e;if(t)for(var i=t.length-1;i>=0;--i){var r=t[i].editMask||0;if(r&C.PICK_GIZMO){e=t[i];break}}return e?(this._attachedNode=e,void this.updateGizmoMask()):(this._attachedNode=null,void this.setNodeMask(0))},attachToMatrixTransform:function(t){return t?(void 0===t.editMask&&(t.editMask=C.PICK_GIZMO),this._attachedNode=t,void this.updateGizmoMask()):(this._attachedNode=null,void this.setNodeMask(0))},attachToGeometry:function(t){var e=t;if(!e)return this._attachedNode=null,void this.setNodeMask(0);var i=e.getParents();if(void 0===i[0].editMask){for(var r=new n;i.length>0;)i[0].addChild(r),i[0].removeChild(e);r.addChild(e),r.editMask=C.PICK_GIZMO,e=r}else e=i[0];this._attachedNode=e,this.updateGizmoMask()},updateGizmoMask:function(){if(!this._attachedNode)return void this.setNodeMask(0);var t=this._attachedNode.editMask;this.setNodeMask(t&C.PICK_GIZMO?C.NO_PICK:0),this._translateNode.setNodeMask(t&C.PICK_ARROW?C.PICK_ARROW:0),this._rotateNode.setNodeMask(t&C.PICK_ARC?C.PICK_ARC:0),this._planeNode.setNodeMask(t&C.PICK_PLANE?C.PICK_PLANE:0);var e=this._translateNode.getChildren();e[0].setNodeMask(t&C.PICK_ARROW_X?C.PICK_ARROW_X:0),e[1].setNodeMask(t&C.PICK_ARROW_Y?C.PICK_ARROW_Y:0),e[2].setNodeMask(t&C.PICK_ARROW_Z?C.PICK_ARROW_Z:0);var i=this._rotateNode.getChildren();i[0].setNodeMask(t&C.NO_FULL_CIRCLE?0:C.NO_PICK),i[1].setNodeMask(t&C.PICK_ARC_X?C.PICK_ARC_X:0),i[2].setNodeMask(t&C.PICK_ARC_Y?C.PICK_ARC_Y:0),i[3].setNodeMask(t&C.PICK_ARC_Z?C.PICK_ARC_Z:0);var r=this._planeNode.getChildren();r[0].setNodeMask(t&C.PICK_PLANE_X?C.PICK_PLANE_X:0),r[1].setNodeMask(t&C.PICK_PLANE_Y?C.PICK_PLANE_Y:0),r[2].setNodeMask(t&C.PICK_PLANE_Z?C.PICK_PLANE_Z:0)},onNodeHovered:function(){var t=d.createAndSet(1,1,0,1);return function(e){if(this._hoverNode&&this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),!e)return void(this._hoverNode=null);for(var i=e.nodepath,r=i.length-1,n=i[r];void 0===n._nbAxis;){if(0===r)return;n=i[--r]}var a=n.getStateSet().getUniform("uColor");this._hoverNode=n,d.copy(a.getInternalArray(),this._keepHoverColor),a.setFloat4(t)}}(),initNodeRotate:function(){var t=v.createTorusGeometry(1,.01,6,64,2*Math.PI),e=v.createTorusGeometry(1,.01,6,64,Math.PI),i=v.createTorusGeometry(1,.1,6,64,Math.PI),a=new n,s=new n,o=new n,u=new n;s._nbAxis=0,o._nbAxis=1,u._nbAxis=2;var l=new r;l.setCullCallback(new A),l.addChild(i),t.setNodeMask(C.NO_PICK),e.setNodeMask(C.NO_PICK),s.setNodeMask(C.PICK_ARC_X),o.setNodeMask(C.PICK_ARC_Y),u.setNodeMask(C.PICK_ARC_Z),a.addChild(t),s.addChild(e),o.addChild(e),u.addChild(e),s.addChild(l),o.addChild(l),u.addChild(l),a.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(.2,.2,.2,1),"uColor")),s.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(1,0,0,1),"uColor")),o.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(0,1,0,1),"uColor")),u.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(0,0,1,1),"uColor"));var p=this._showAngle;p.getOrCreateStateSet().setAttributeAndModes(y),p.setNodeMask(0),p.getOrCreateStateSet().addUniform(h.createFloat3(c.createAndSet(1,0,0),"uBase")),p.getOrCreateStateSet().addUniform(h.createFloat(0,"uAngle")),p.addChild(v.createQuadCircleGeometry());var f=this._rotateNode;return f.setNodeMask(C.PICK_ARC),f.addChild(a),f.addChild(s),f.addChild(o),f.addChild(u),f.addChild(p),f},initNodeTranslate:function(){var t=1.5,e=.3,i=.5,a=1.1*(t-i+e),s=new n;p.makeTranslate(0,0,t+.5*e,s.getMatrix()),s.addChild(v.createCylinderGeometry(0,.07,e,32,1,!0,!0));var o=new n;p.makeTranslate(0,0,.5*t,o.getMatrix()),o.addChild(v.createCylinderGeometry(.01,.01,t,32,1,!0,!0));var u=new r;u.addChild(o),u.addChild(s);var l=v.createCylinderGeometry(.1,.1,a,32,1,!0,!0),c=new n,f=new n,g=new n;c._nbAxis=0,f._nbAxis=1,g._nbAxis=2,p.makeRotate(.5*Math.PI,0,1,0,c.getMatrix()),p.makeRotate(.5*-Math.PI,1,0,0,f.getMatrix());var m=new n;m.setCullCallback(new A),p.makeTranslate(0,0,i+.5*a,m.getMatrix()),m.addChild(l),u.setNodeMask(C.NO_PICK),c.setNodeMask(C.PICK_ARROW_X),f.setNodeMask(C.PICK_ARROW_Y),g.setNodeMask(C.PICK_ARROW_Z),c.addChild(u),f.addChild(u),g.addChild(u),c.addChild(m),f.addChild(m),g.addChild(m),c.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(1,0,0,1),"uColor")),f.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(0,1,0,1),"uColor")),g.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(0,0,1,1),"uColor"));var _=this._translateNode;return _.setNodeMask(C.PICK_ARROW),_.addChild(c),_.addChild(f),_.addChild(g),_},initNodeTranslatePlane:function(){var t=new n;p.makeTranslate(.5,.5,0,t.getMatrix()),p.postMult(p.makeScale(.5,.5,1,p.create()),t.getMatrix()),t.addChild(v.createPlaneGeometry());var e=new n,i=new n,r=new n;e._nbAxis=0,i._nbAxis=1,r._nbAxis=2,p.makeRotate(.5*-Math.PI,0,1,0,e.getMatrix()),p.makeRotate(.5*Math.PI,1,0,0,i.getMatrix()),e.setNodeMask(C.PICK_PLANE_X),i.setNodeMask(C.PICK_PLANE_Y),r.setNodeMask(C.PICK_PLANE_Z),e.addChild(t),i.addChild(t),r.addChild(t),e.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(1,0,0,.3),"uColor")),i.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(0,1,0,.3),"uColor")),r.getOrCreateStateSet().addUniform(h.createFloat4(d.createAndSet(0,0,1,.3),"uColor"));var a=this._planeNode;return a.setNodeMask(C.PICK_PLANE),a.getOrCreateStateSet().setAttributeAndModes(y),a.addChild(e),a.addChild(i),a.addChild(r),a},updateArcRotation:function(){var t=f.create(),e=f.makeRotate(.5*-Math.PI,0,1,0,f.create()),i=f.makeRotate(.5*-Math.PI,1,0,0,f.create());return function(r){var n=this._rotateNode,a=n.getChildren();t[0]=-r[1],t[1]=r[0],t[2]=0,t[3]=1+r[2],f.normalize(t,t),p.makeRotateFromQuat(t,a[0].getMatrix()),f.makeRotate(Math.atan2(r[2],r[1]),1,0,0,t),f.mult(t,e,t),p.makeRotateFromQuat(t,a[1].getMatrix()),f.makeRotate(Math.atan2(-r[0],-r[2]),0,1,0,t),f.mult(t,i,t),p.makeRotateFromQuat(t,a[2].getMatrix()),f.makeRotate(Math.atan2(-r[0],r[1]),0,0,1,t),p.makeRotateFromQuat(t,a[3].getMatrix()),a[1].dirtyBound(),a[2].dirtyBound(),a[3].dirtyBound()}}(),getTransformType:function(t){for(var e=t;e.getParents().length>0;){if(void 0!==e.referenceFrame&&e.referenceFrame===_.ABSOLUTE_RF)return _.ABSOLUTE_RF;e=e.getParents()[0]}return _.RELATIVE_RF},updateGizmo:function(){var t=c.create(),e=c.create(),i=c.create(),r=p.create(),n=p.create(),a=p.create(),s=p.create();return function(){if(this._attachedNode){var o=this.getTransformType(this._attachedNode);this.setReferenceFrame(o),this.setCullingActive(o===_.RELATIVE_RF);var u=this._attachedNode.getWorldMatrices()[0];p.getTrans(u,e),p.makeTranslate(e[0],e[1],e[2],n);var h=3;if(o===_.ABSOLUTE_RF)t[0]=t[1]=t[2]=0,i[0]=i[1]=i[2]=1;else{var l=this._viewer.getCamera().getProjectionMatrix(),d=.023*this._canvas.clientWidth*l[0];this._manipulator.getEyePosition(t),this._lastDistToEye=this._isEditing?this._lastDistToEye:c.distance(t,e),h*=this._lastDistToEye/d}p.makeScale(h,h,h,s),p.mult(n,s,this.getMatrix()),c.sub(t,e,t),c.normalize(t,t),this._rotateInLocal||this._translateInLocal?(p.getScale(u,i),p.makeScale(i[0],i[1],i[2],a),p.inverse(a,a),p.mult(u,a,r),r[12]=r[13]=r[14]=0,this._translateInLocal&&(p.copy(r,this._translateNode.getMatrix()),p.copy(r,this._planeNode.getMatrix())),this._rotateInLocal&&(p.copy(r,this._rotateNode.getMatrix()),p.inverse(r,r),p.transformVec3(r,t,t))):p.makeIdentity(this._rotateNode.getMatrix()),this.updateArcRotation(t),this._rotateNode.dirtyBound(),this._translateNode.dirtyBound(),this._planeNode.dirtyBound(),this._isEditing&&p.copy(this._hoverNode.getMatrix(),this._showAngle.getMatrix())}}}(),computeNearestIntersection:function(){var t=function(t,e){return t.ratio-e.ratio},e=l.create();return function(i,r){x(e,i);var n=this._viewer,a=this._canvas,s=e[0]*(n._canvasWidth/a.clientWidth),o=(a.clientHeight-e[1])*(n._canvasHeight/a.clientHeight),u=this._viewer.computeIntersections(s,o,r);return 0!==u.length?(u.sort(t),u[0]):void 0}}(),setOnlyGizmoPicking:function(){this._viewer.getCamera().addChild(this),this._viewer.getSceneData().setNodeMask(0),this.setNodeMask(-1)},setOnlyScenePicking:function(){this._viewer.getCamera().removeChild(this),this._viewer.getSceneData().setNodeMask(-1),this.setNodeMask(C.NO_PICK)},pickGizmo:function(t,e){this.setOnlyGizmoPicking();var i=this.computeNearestIntersection(t,e);return this.setOnlyScenePicking(),i},getCanvasPositionFromWorldPoint:function(){var t=p.create();return function(e,i){var r=this._viewer.getCamera(),n=i;i||(a.warn("deprecated, use out argument for result "),n=c.create()),r.getViewport()?r.getViewport().computeWindowMatrix(t):p.makeIdentity(t),p.preMult(t,r.getProjectionMatrix()),this.getReferenceFrame()===_.RELATIVE_RF&&p.preMult(t,r.getViewMatrix()),p.transformVec3(t,e,n);var s=this._viewer,o=this._canvas;return n[0]=n[0]/(s._canvasWidth/o.clientWidth),n[1]=o.clientHeight-n[1]/(s._canvasHeight/o.clientHeight),n}}(),onMouseDown:function(t){if(x(this._downCanvasCoord,t),this._hoverNode&&this._attachedNode){this._viewer._eventProxy.StandardMouseKeyboard._enable=!1,this.saveEditMatrices();var e=this._hoverNode.getParents()[0].getNodeMask();this._isEditing=!0,e&C.PICK_ARC?(this._translateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startRotateEdit(t)):e&C.PICK_ARROW?(this._rotateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startTranslateEdit(t)):e&C.PICK_PLANE&&(this._rotateNode.setNodeMask(0),this._translateNode.setNodeMask(0),this.startPlaneEdit(t))}},saveEditMatrices:function(){p.copy(this._attachedNode.getMatrix(),this._editLocal);var t=this._attachedNode.getWorldMatrices()[0];p.makeTranslate(t[12],t[13],t[14],this._editWorldTrans),p.copy(t,this._editWorldScaleRot),this._editWorldScaleRot[12]=this._editWorldScaleRot[13]=this._editWorldScaleRot[14]=0,p.inverse(this._editWorldScaleRot,this._editInvWorldScaleRot)},startRotateEdit:function(t){var e=this._rotateNode.getWorldMatrices()[0],i=c.create();p.transformVec3(e,i,i),this.getCanvasPositionFromWorldPoint(i,i);var r=this.pickGizmo(t,this._hoverNode.getNodeMask()|C.PICK_ARC);if(r){var n=0===this._hoverNode._nbAxis?-1:1,a=c.create();a[0]=n*r.point[1],a[1]=-n*r.point[0],a[2]=r.point[2];var s=c.create();p.transformVec3(this._hoverNode.getMatrix(),a,s),p.transformVec3(e,s,s),this.getCanvasPositionFromWorldPoint(s,s);var o=this._editLineDirection;l.sub(s,i,o),l.normalize(o,o),this._showAngle.setNodeMask(C.NO_PICK),r.point[2]=0;var u=this._showAngle.getStateSet();u.getUniform("uAngle").setFloat(0),u.getUniform("uBase").setVec3(c.normalize(r.point,r.point)),x(this._editLineOrigin,t)}},startTranslateEdit:function(t){var e=this._editLineOrigin,i=this._editLineDirection,r=this._translateNode.getWorldMatrices()[0];p.getTrans(r,e),c.init(i),i[this._hoverNode._nbAxis]=1,this._translateInLocal&&(p.transformVec3(this._editWorldScaleRot,i,i),c.normalize(i,i)),c.add(e,i,i),this.getCanvasPositionFromWorldPoint(e,e),this.getCanvasPositionFromWorldPoint(i,i),l.sub(i,e,i),l.normalize(i,i);var n=this._editOffset;x(n,t),l.sub(n,e,n)},startPlaneEdit:function(t){var e=this._editLineOrigin,i=this._planeNode.getWorldMatrices()[0];p.getTrans(i,e),this.getCanvasPositionFromWorldPoint(e,e);var r=this._editOffset;x(r,t),l.sub(r,e,r)},drawLineCanvasDebug:function(t,e,i,r){this._debugNode.setNodeMask(C.NO_PICK);var n=this._debugNode.getChildren()[0].getAttributes().Vertex;n.getElements()[0]=t/this._canvas.clientWidth*2-1,n.getElements()[1]=(this._canvas.clientHeight-e)/this._canvas.clientHeight*2-1,n.getElements()[2]=i/this._canvas.clientWidth*2-1,n.getElements()[3]=(this._canvas.clientHeight-r)/this._canvas.clientHeight*2-1,n.dirty()},pickAndSelect:function(t){this.setNodeMask(0);var e=this.computeNearestIntersection(t,this._tmask);this._autoInsertMT?this.attachToGeometry(e?e.nodepath[e.nodepath.length-1]:e):this.attachToNodePath(e?e.nodepath:e)},onMouseUp:function(t){var e=this._viewer._eventProxy.StandardMouseKeyboard;e._enable===!1&&(e._enable=!0,this._viewer._eventProxy.StandardMouseKeyboard.mouseup(t)),this._debugNode&&this._debugNode.setNodeMask(0);var i=l.create();x(i,t),0===l.distance(this._downCanvasCoord,i)&&this.pickAndSelect(t),this._showAngle.setNodeMask(0),this._isEditing=!1,this._hoverNode&&this.updateGizmoMask()},onMouseMove:function(t){if(this._attachedNode){var e;if(this._isEditing===!1)return e=this.pickGizmo(t,C.PICK_GIZMO),void this.onNodeHovered(e);if(this._hoverNode){var i=this._hoverNode.getParents()[0];i===this._rotateNode?this.updateRotateEdit(t):i===this._translateNode?this.updateTranslateEdit(t):i===this._planeNode&&this.updatePlaneEdit(t)}}},updateRotateEdit:function(){var t=p.create(),e=l.create();return function(i){var r=this._editLineOrigin,n=this._editLineDirection;x(e,i),l.sub(e,r,e);var a=l.dot(e,n);this._debugNode&&this.drawLineCanvasDebug(r[0],r[1],r[0]+n[0]*a,r[1]+n[1]*a);var s=7*a/Math.min(this._canvas.clientWidth,this._canvas.clientHeight);s%=2*Math.PI;var o=this._hoverNode._nbAxis;0===o?p.makeRotate(-s,1,0,0,t):1===o?p.makeRotate(-s,0,1,0,t):2===o&&p.makeRotate(-s,0,0,1,t),this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0===o?-s:s),this._rotateInLocal||(p.postMult(this._editInvWorldScaleRot,t),p.preMult(t,this._editWorldScaleRot)),p.mult(this._editLocal,t,this._attachedNode.getMatrix()),this._attachedNode.dirtyBound()}}(),updateTranslateEdit:function(){var t=l.create(),e=c.create();return function(i){var r=this._editLineOrigin,n=this._editLineDirection;x(t,i),l.sub(t,r,t),l.sub(t,this._editOffset,t);var a=l.dot(t,n);t[0]=r[0]+n[0]*a,t[1]=r[1]+n[1]*a,this._debugNode&&this.drawLineCanvasDebug(r[0],r[1],t[0],t[1]);var s=this._viewer,o=this._canvas,u=t[0]*(s._canvasWidth/o.clientWidth),h=(o.clientHeight-t[1])*(s._canvasHeight/o.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!1),this._lsi.set(c.set(u,h,0,this._origIntersect),c.set(u,h,1,this._dstIntersect)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),p.copy(this._editWorldTrans,this.getMatrix()),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){p.getScale(this._editInvWorldScaleRot,e);var d=this._lsi.getTranslateDistance();e[0]*=d[0],e[1]*=d[1],e[2]*=d[2]}else p.transformVec3(this._editInvWorldScaleRot,this._lsi.getTranslateDistance(),e);p.multTranslate(this._editLocal,e,this._attachedNode.getMatrix()),this._attachedNode.dirtyBound()}}(),updatePlaneEdit:function(){var t=l.create(),e=c.create();return function(i){x(t,i),l.sub(t,this._editOffset,t);var r=this._viewer,n=this._canvas,a=t[0]*(r._canvasWidth/n.clientWidth),s=(n.clientHeight-t[1])*(r._canvasHeight/n.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!0),this._lsi.set(c.set(a,s,0,this._origIntersect),c.set(a,s,1,this._dstIntersect)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),p.copy(this._editWorldTrans,this.getMatrix()),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){p.getScale(this._editInvWorldScaleRot,e);var o=this._lsi.getTranslateDistance();e[0]*=o[0],e[1]*=o[1],e[2]*=o[2]}else p.transformVec3(this._editInvWorldScaleRot,this._lsi.getTranslateDistance(),e);p.multTranslate(this._editLocal,e,this._attachedNode.getMatrix()),this._attachedNode.dirtyBound()}}()}),t.exports=C},function(t,e,i){"use strict";var r,n,a,s=i(1139),o=i(1130),u=i(1140),h=i(1141),l=i(1142),c=i(1198),d=i(1199),p=["#ifdef GL_ES","precision highp float;","#endif"].join("\n"),f=function(){if(r)return r;var t="#define SHADER_NAME GizmoLine3D",e=[p,"attribute vec3 Vertex;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;",t,"","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=[p,"uniform vec4 uColor;",t,"","void main(void) {","  gl_FragColor = uColor;","}"].join("\n");return r=new c(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))},g=function(){if(n)return n;var t="#define SHADER_NAME GizmoLine2D",e=[p,"attribute vec2 Vertex;",t,"","void main(void) {","  gl_Position = vec4(Vertex, 0.0, 1.0);","}"].join("\n"),i=[p,t,"","void main(void) {","  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");return n=new c(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))},m=function(){if(a)return a;var t="#define SHADER_NAME GizmoQuadCircle",e=[p,"attribute vec3 Vertex;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","varying vec3 vVertex;",t,"","void main(void) {","  vVertex = Vertex;","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=[p,"uniform float uAngle;","uniform vec3 uBase;","varying vec3 vVertex;","const float PI = 3.14159265358979323846264;","const float PI2 = PI * 2.0;",t,"","void main(void) {","  if(length(vVertex) > 0.5)","    discard;","  vec3 vn = normalize(vVertex);","  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));","  if(angle > 0.0) {","    if(uAngle >= 0.0 && angle > uAngle) discard;","    if(uAngle < -PI && angle < uAngle + PI2) discard;","    if(uAngle < 0.0 && uAngle > -PI) discard;","  }","  if(angle < 0.0) {","    if(uAngle <= 0.0 && angle < uAngle) discard;","    if(uAngle > PI && angle > uAngle - PI2) discard;","    if(uAngle > 0.0 && uAngle < PI) discard;","  }","  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);","}"].join("\n");return a=new c(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))},v=function(){var t=new o;t.getAttributes().Vertex=new s(s.ARRAY_BUFFER,new Float32Array(4),2);var e=new h(u.LINES,0,2);return t.getPrimitives().push(e),t.getOrCreateStateSet().setAttributeAndModes(g()),t},_=function(t,e,i,r,n){var a=void 0!==t?t:1,h=void 0!==e?e:.2,c=void 0!==i?i:6,d=void 0!==r?r:64,p=void 0!==n?n:2*Math.PI,g=(c+1)*(d+1),m=c*d*2,v=new o,_=new Float32Array(3*g),b=new Uint16Array(3*m);p=p||2*Math.PI;var x=0,A=0,y=0,S=0;for(S=0;c>=S;++S)for(y=0;d>=y;++y){var C=y/d*p,w=S/c*Math.PI*2;A=3*x,_[A]=(a+h*Math.cos(w))*Math.cos(C),_[A+1]=(a+h*Math.cos(w))*Math.sin(C),_[A+2]=h*Math.sin(w),x++}for(x=0,S=1;c>=S;++S)for(y=1;d>=y;++y)A=6*x,b[A]=(d+1)*S+y-1,b[A+1]=b[A+3]=(d+1)*(S-1)+y-1,b[A+2]=b[A+5]=(d+1)*S+y,b[A+4]=(d+1)*(S-1)+y,x++;return v.getAttributes().Vertex=new s(s.ARRAY_BUFFER,_,3),v.getOrCreateStateSet().setAttributeAndModes(f()),v.getPrimitives().push(new l(u.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,b,1))),v},b=function(t,e,i,r,n,a,h){var c=void 0!==t?t:1,d=void 0!==e?e:1,p=void 0!==i?i:5,g=void 0!==r?r:32,m=void 0!==n?n:1,v=void 0!==a?a:!0,_=void 0!==h?h:!0;v=v&&c>0,_=_&&d>0;var b=.5*p,x=(m+1)*(g+1),A=m*g*2;v&&(x+=1,A+=g),_&&(x+=1,A+=g);var y=new o,S=new Float32Array(3*x),C=new Uint16Array(3*A),w=0,T=0,M=0,E=0;for(M=0;m>=M;M++){var k=M/m,I=k*(d-c)+c;for(E=0;g>=E;E++){var N=E/g;T=3*w,S[T]=I*Math.sin(N*Math.PI*2),S[T+1]=I*Math.cos(N*Math.PI*2),S[T+2]=-k*p+b,w++}}for(w=0,E=0;g>E;E++)for(M=0;m>M;M++)T=6*w,C[T]=(g+1)*M+E,C[T+1]=C[T+3]=(g+1)*(M+1)+E,C[T+2]=C[T+5]=(g+1)*M+E+1,C[T+4]=(g+1)*(M+1)+E+1,w++;w*=2;var R;if(v)for(R=(_?S.length-6:S.length-3)/3,S[3*R+2]=b,E=0;g>E;E++)T=3*w,C[T]=E,C[T+1]=E+1,C[T+2]=R,w++;if(_){R=(S.length-3)/3,S[3*R+2]=-b;var F=(g+1)*M;for(E=0;g>E;E++)T=3*w,C[T]=F+E+1,C[T+1]=F+E,C[T+2]=R,w++}return y.getAttributes().Vertex=new s(s.ARRAY_BUFFER,S,3),y.getOrCreateStateSet().setAttributeAndModes(f()),y.getPrimitives().push(new l(u.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,C,1))),y},x=function(t,e,i){for(var r=new o,n=new Float32Array(3*t),a=i||2*Math.PI,l=0;t>l;++l){var c=3*l,d=a*l/t;n[c]=Math.cos(d)*e,n[c+1]=Math.sin(d)*e}r.getAttributes().Vertex=new s(s.ARRAY_BUFFER,n,3);var p=new h(u.LINE_STRIP,0,t);return r.getOrCreateStateSet().setAttributeAndModes(f()),
r.getPrimitives().push(p),r},A=function(t,e){var i=t?.5*t:.5,r=e?.5*e:.5,n=new o,a=new Float32Array(12);a[0]=-i,a[1]=-r,a[3]=i,a[4]=-r,a[6]=-i,a[7]=r,a[9]=i,a[10]=r,n.getAttributes().Vertex=new s(s.ARRAY_BUFFER,a,3);var l=new h(u.TRIANGLE_STRIP,0,4);return n.getOrCreateStateSet().setAttributeAndModes(f()),n.getPrimitives().push(l),n},y=function(){var t=A();return t.getOrCreateStateSet().setAttributeAndModes(m()),t},S={};S.createCircleGeometry=x,S.createCylinderGeometry=b,S.createTorusGeometry=_,S.createDebugLineGeometry=v,S.createPlaneGeometry=A,S.createQuadCircleGeometry=y,t.exports=S},function(t,e,i){"use strict";var r=i(1105),n=i(1109),a=i(1134),s=i(1121),o=function(t){void 0!==t&&(void 0!==t.object&&void 0!==t.field&&this.createInternalSlider(t),this._uniform=this.createInternalSliderUniform(t))};o.prototype={setTargetHTML:function(t){this.parent=t},addToDom:function(t){var e=document.createElement("div");e.innerHTML=t,this.parent.appendChild(e)},getValue:function(t){if(window.localStorage){var e=window.localStorage.getItem(t);return e}return null},setValue:function(t,e){window.localStorage&&window.localStorage.setItem(t,e)},createHTMLSlider:function(t,e,i,r){var n='<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>',a=t.min,s=t.max,o=t.step,u=i,h=r,l=h+"(this.value)";return n=n.replace(/MIN/g,a),n=n.replace(/MAX/g,s+o),n=n.replace("STEP",o),n=n.replace("VALUE",e),n=n.replace(/NAME/g,u),n=n.replace(/UPDATE/g,h),n=n.replace("ONCHANGE",l)},createUniformFunction:function(t,e,i,r,a){var s=this;return function(){var o=e,u=i,h=r,l=a,c=function(e){h.get()[u]=e,h.dirty(),n.debug(o+" value "+e),document.getElementById(a).innerHTML=Number(e).toFixed(4),s.setValue(l,e),void 0!==t.onchange&&t.onchange(h.get())};return c}()},createFunction:function(t,e,i,r,a,s){var o=this;return function(){var u=e,h=a,l=s,c=r,d=function(e){"string"==typeof e&&(e=parseFloat(e)),"number"==typeof r[h]?c[h]=e:c[h][i]=e,n.debug(u+" value "+e),document.getElementById(s).innerHTML=Number(e).toFixed(4),o.setValue(l,e),void 0!==t.onchange&&t.onchange(c[h])};return d}()},getCallbackName:function(t,e){return"change_"+e+"_"+t},copyDefaultValue:function(t){var e=t.value;return e=Array.isArray(t.value)?t.value.slice():[e]},createInternalSliderUniform:function(t){var e=t.value,i=t.uniform;if(void 0===i){var r=t.type;r=r.charAt(0).toUpperCase()+r.slice(1),i=a["create"+r](e,t.name)}for(var s=this.getCallbackName(t.name,t.id),o=e.length,u=0;o>u;u++){var h=u.toString(),l=t.name+h,c=s+h,d=e[u],p=this.getValue(c);null!==p?d=p:t.uniform&&void 0!==t.uniform.get()[u]&&(d=t.uniform.get()[u]);var f=this.createHTMLSlider(t,d,l,c);this.addToDom(f),window[c]=this.createUniformFunction(t,l,u,i,c),n.log(l+" "+d),window[c](d)}return this.uniform=i,i},createInternalSlider:function(t){for(var e=t.value,i=t.name,r=t.id,a=e.length,s=this.getCallbackName(i,r),o=t.object,u=t.field,h=0;a>h;h++){var l=h.toString(),c=i+l,d=s+l,p=e[h],f=this.getValue(d);p=null!==f?f:"number"==typeof o[u]?o[u]:o[u][h];var g=this.createHTMLSlider(t,p,c,d);this.addToDom(g),window[d]=this.createFunction(t,c,h,o,u,d),n.log(c+" "+p),window[d](p)}},createSlider:function(t){return void 0!==t.html&&this.setTargetHTML(t.html),void 0===t.id&&(t.id=t.name),t.value=this.copyDefaultValue(t),void 0!==t.type?this.createInternalSliderUniform(t):(void 0===t.object&&(t.object={data:t.value},t.field="data"),this.createInternalSlider(t))}};var u=function(){s.call(this),this.arraySlider=new o,this.setTargetHTML(document.body)};u.createSlider=function(t){(new o).createSlider(t)},u.prototype=r.objectInherit(s.prototype,{setTargetHTML:function(t){this.targetHTML=t,this.arraySlider.setTargetHTML(this.targetHTML)},getUniformList:function(t,e){var i="(uniform)",r=".*?",n="((?:[a-z][a-z]+))",a=".*?",s="((?:[a-z][a-z]+))",o=".*?",u=".",h=".*?",l=".",c=".*?",d="(.)",p="(.)",f=".*?",g="(\\{.*?\\})",m=new RegExp(i+r+n+a+s+o+u+h+l+c+d+p+f+g,["g"]),v=t.match(m),_=e,b=function(t){return function(){return t}};if(null!==v)for(var x=new RegExp(i+r+n+a+s+o+u+h+l+c+d+p+f+g,["i"]),A=0,y=v.length;y>A;A++){var S=v[A].match(x);if(null!==S){var C=S[2],w=S[3],T=S[6],M=JSON.parse(T);M.type=C,M.name=w;var E=M.value;M.value=b(E),_[w]=M}}return _},getUniformFromStateSet:function(t,e){var i=t.getUniformList();if(i)for(var r=window.Object.keys(e),n=0,a=r.length;a>n;n++){var s=r[n];void 0!==i[s]&&void 0===e[s].uniform&&(e[s].uniform=i[s].object)}},findExistingUniform:function(t,e){var i=function(){s.call(this,s.TRAVERSE_PARENTS)};i.prototype=r.objectInherit(s.prototype,{setUniformMap:function(t){this.uniformMap=t},apply:function(t){var e=t.getStateSet();e&&u.prototype.getUniformFromStateSet(e,this.uniformMap),this.traverse(t)}});var n=new i;n.setUniformMap(e),t.accept(n)},applyProgram:function(t,e){var i=e.getAttribute("Program"),r=i.getName(),a={};this.getUniformList(i.getVertexShader().getText(),a),this.getUniformList(i.getFragmentShader().getText(),a);var s=0,o=window.Object.keys(a);if(void 0===r){var u=function(t){var e=0,i=0;if(0===t.length)return e;for(s=0;s<t.length;s++)i=t.charCodeAt(s),e=(e<<5)-e+i,e&=e;return 0>e&&(e=-e),e},h=o.join("");r=u(h).toString()}this.findExistingUniform(t,a);var l=!1;for(s=0;s<o.length;s++){var c=o[s],d=a[c];d.type,d.name;d.id=r;var p=this.arraySlider.createSlider(d);void 0===d.uniform&&p&&e.addUniform(p),l=!0}if(l){var f=document.createElement("div");f.innerHTML="<p> </p>",this.targetHTML.appendChild(f)}n.log(a)},applyStateSet:function(t,e){void 0!==e.getAttribute("Program")&&this.applyProgram(t,e)},apply:function(t){var e=this.targetHTML;if(void 0!==e&&null!==e){var i=t.getStateSet();void 0!==i&&this.applyStateSet(t,i),this.traverse(t)}}}),t.exports=u},function(t,e,i){"use strict";var r=i(1114),n=i(1122),a=i(1193),s=function(){this._center=r.create(),this._iCenter=r.create(),this._radius=1,this._iRadius=1,this._intersections=[]};s.prototype={set:function(t,e){r.copy(t,this._center),r.copy(t,this._iCenter),this._radius=this._iRadius=e,this.reset()},setCenter:function(t){r.copy(t,this._center),r.copy(t,this._iCenter)},setRadius:function(t){this._radius=this._iRadius=t},reset:function(){this._intersections.length=0},enter:function(t){return!t.isCullingActive()||this.intersects(t.getBound())},intersects:function(t){if(!t.valid())return!1;var e=this._iRadius+t.radius();return r.distance2(this._iCenter,t.center())<=e*e},intersect:function(){var t=new a;return function(e,i){var r=i.getShape();if(r)return r.intersectSphere(this._iCenter,this._iRadius,this._intersections,e.nodePath);if(t.reset(),t.setNodePath(e.nodePath),t.set(this._iCenter,this._iRadius),i.computeTransformedVertices){var n=i.getVertexAttributeList(),a=n.Vertex.getElements();n.Vertex._elements=i.computeTransformedVertices(),t.apply(i),n.Vertex._elements=a}else t.apply(i);for(var s=t._intersections.length,o=0;s>o;o++)this._intersections.push(t._intersections[o]);return s>0}}(),getIntersections:function(){return this._intersections},setCurrentTransformation:function(){var t=r.create();return function(e){n.inverse(e,e),n.transformVec3(e,this._center,this._iCenter),this._iRadius=this._radius*n.getScale(e,t)[0]}}()},t.exports=s},function(t,e,i){"use strict";var r=i(1105),n=i(1139),a=i(1130),s=i(1121),o=i(1140),u=i(1114),h=r,l=function(){s.call(this),this._T=void 0,this._B=void 0,this._N=void 0,this._texCoordUnit=0};l.prototype=r.objectInherit(s.prototype,{apply:function(t){t.getTypeID()===a.getTypeID()?this.generate(t,this._texCoordUnit):this.traverse(t)},setTexCoordUnit:function(t){this._texCoordUnit=t},computePrimitiveSet:function(t,e){if(e.getIndices){var i,r=e.getNumIndices(),n=t.getAttributes().Vertex,a=t.getAttributes().Normal,s=t.getAttributes()["TexCoord"+this._texCoordUnit];if(e.getMode()===o.TRIANGLES)for(i=0;r>i;i+=3)this.compute(e,n,a,s,i,i+1,i+2);else if(e.getMode()===o.TRIANGLE_STRIP)for(i=0;r-2>i;++i)i%2===0?this.compute(e,n,a,s,i,i+1,i+2):this.compute(e,n,a,s,i+1,i,i+2)}},generate:function(t,e){this._texCoordUnit=e,void 0===this._texCoordUnit&&(this._texCoordUnit=0);var i=t.getAttributes().Vertex.getElements().length;this._T=new h.Float32Array(i),this._B=new h.Float32Array(i),this._N=new h.Float32Array(i),t.getPrimitiveSetList().forEach(function(e){this.computePrimitiveSet(t,e)},this);for(var r=i/3,a=new h.Float32Array(4*r),s=u.create(),o=u.create(),l=u.create(),c=0;r>c;c++){var d=this._T.subarray(3*c,3*c+3),p=this._N.subarray(3*c,3*c+3),f=this._B.subarray(3*c,3*c+3);u.normalize(p,p);var g=u.dot(p,d);u.mult(p,g,o),u.sub(d,o,s),u.normalize(s,l),u.cross(p,d,s);var m=u.dot(s,f);m=0>m?-1:0,a[4*c]=l[0],a[4*c+1]=l[1],a[4*c+2]=l[2],a[4*c+3]=m}t.getAttributes().Normal.setElements(this._N),t.getAttributes().Tangent=new n("ARRAY_BUFFER",a,4)},compute:function(t,e,i,r,n,a,s){var o,h,l=t.index(n),c=t.index(a),d=t.index(s),p=e.getElements().subarray(3*l,3*l+3),f=e.getElements().subarray(3*c,3*c+3),g=e.getElements().subarray(3*d,3*d+3),m=i.getElements().subarray(3*l,3*l+3),v=i.getElements().subarray(3*c,3*c+3),_=i.getElements().subarray(3*d,3*d+3),b=r.getElements().subarray(2*l,2*l+2),x=r.getElements().subarray(2*c,2*c+2),A=r.getElements().subarray(2*d,2*d+2),y=u.create(),S=u.create(),C=u.create(),w=u.create(),T=u.create(),M=u.create(),E=u.create(),k=u.create(),I=u.create();u.set(f[0]-p[0],x[0]-b[0],x[1]-b[1],k),u.set(g[0]-p[0],A[0]-b[0],A[1]-b[1],I),u.cross(k,I,y),0!==y[0]&&(u.normalize(y,y),h=-y[1]/y[0],o=-y[2]/y[0],T[0]+=h,S[0]+=o,M[0]+=h,C[0]+=o,E[0]+=h,w[0]+=o),u.set(f[1]-p[1],x[0]-b[0],x[1]-b[1],k),u.set(g[1]-p[1],A[0]-b[0],A[1]-b[1],I),u.cross(k,I,y),0!==y[0]&&(u.normalize(y,y),h=-y[1]/y[0],o=-y[2]/y[0],T[1]+=h,S[1]+=o,M[1]+=h,C[1]+=o,E[1]+=h,w[1]+=o),u.set(f[2]-p[2],x[0]-b[0],x[1]-b[1],k),u.set(g[2]-p[2],A[0]-b[0],A[1]-b[1],I),u.cross(k,I,y),0!==y[0]&&(u.normalize(y,y),h=-y[1]/y[0],o=-y[2]/y[0],T[2]+=h,S[2]+=o,M[2]+=h,C[2]+=o,E[2]+=h,w[2]+=o);var N,R,F,P=u.create(),D=u.create();u.cross(m,T,P),u.cross(P,m,D),N=this._T.subarray(3*l,3*l+3),u.add(D,N,N),u.cross(S,m,P),u.cross(m,P,D),R=this._B.subarray(3*l,3*l+3),u.add(D,R,R),u.cross(v,M,P),u.cross(P,v,D),N=this._T.subarray(3*c,3*c+3),u.add(D,N,N),u.cross(C,v,P),u.cross(v,P,D),R=this._B.subarray(3*c,3*c+3),u.add(D,R,R),u.cross(_,E,P),u.cross(P,_,D),N=this._T.subarray(3*d,3*d+3),u.add(D,N,N),u.cross(w,_,P),u.cross(_,P,D),R=this._B.subarray(3*d,3*d+3),u.add(D,R,R),F=this._N.subarray(3*l,3*l+3),u.add(m,F,F),F=this._N.subarray(3*c,3*c+3),u.add(v,F,F),F=this._N.subarray(3*d,3*d+3),u.add(_,F,F)}}),t.exports=l},function(t,e,i){"use strict";var r=i(1154),n=i(1166),a=i(1122),s=i(1111),o=i(1198),u=i(1199),h=i(1200),l=i(1133),c=i(1110),d=i(1134),p=i(1168),f=i(1124),g=i(1205),m=i(1252),v={},_=function(t,e,i,r,n){this._viewer=t,this._rttScene=e,this._hmdConfig=i,this._root=r,this._canvas=n,this._width=n.width,this._height=n.height};_.prototype={update:function(){var t=this._canvas,e=t.width,i=t.height;if(e!==this._width||i!==this._height){this._root.removeChildren();var r=this._hmdConfig;r&&r.isCardboard&&(r.hResolution=e,r.vResolution=i),this._width=e,this._height=i,v.createScene(this._viewer,this._rttScene,r,this._root)}return!0}};var b=function(t,e){this._rootView=t,this._offsetView=e};b.prototype={update:function(t){var e=t.getViewMatrix();return a.mult(this._offsetView,this._rootView,e),!0}};var x=function(t,e,i,r){var n=e.hResolution/(2*e.vResolution),s=-1-4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,o=e.distortionK[0]+e.distortionK[1]*Math.pow(s,2)+e.distortionK[2]*Math.pow(s,4)+e.distortionK[3]*Math.pow(s,6),u=180/Math.PI*2*Math.atan2(e.vScreenSize*o,2*e.eyeToScreenDistance),h=a.makePerspective(u,n,.3,1e4,a.create()),l=4*(.25*e.hScreenSize-.5*e.interpupillaryDistance)/e.hScreenSize,c=4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize;r.projectionLeft=a.preMult(a.makeTranslate(l,0,0,a.create()),h),r.projectionRight=a.preMult(a.makeTranslate(-l,0,0,a.create()),h),r.viewLeft=a.makeTranslate(t*e.interpupillaryDistance*.5,0,0,a.create()),r.viewRight=a.makeTranslate(-t*e.interpupillaryDistance*.5,0,0,a.create()),i.lensCenterLeft=p.createAndSet(c,0),i.lensCenterRight=p.createAndSet(-c,0),i.hmdWarpParam=e.distortionK,i.chromAbParam=e.chromaAbParameter,i.scaleIn=p.createAndSet(1,1/n),i.scale=p.createAndSet(1/o,1*n/o)},A=function(){var t=["","#ifdef GL_ES","precision highp float;","#endif","uniform vec2 uScale;","uniform vec2 uScaleIn;","uniform vec2 uLensCenter;","uniform vec4 uHmdWarpParam;","uniform vec4 uChromAbParam;","uniform sampler2D Texture0;","varying vec2 FragTexCoord0;","void main(void) {","  vec2 uv = (FragTexCoord0 * 2.0) - 1.0;","  vec2 theta = (uv - uLensCenter) * uScaleIn;","  float rSq = theta.x * theta.x + theta.y * theta.y;","  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);","  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);","  vec2 tcBlue = (uLensCenter + uScale * rBlue);","  tcBlue = (tcBlue + 1.0) * 0.5;","  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;","  }","  vec2 tcGreen = uLensCenter + uScale * rvector;","  tcGreen = (tcGreen + 1.0) * 0.5;","  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);","  vec2 tcRed = uLensCenter + uScale * rRed;","  tcRed = (tcRed + 1.0) * 0.5;","  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);","}",""].join("\n");return new o(new u(u.VERTEX_SHADER,m.Filter.defaultVertexShader),new u(u.FRAGMENT_SHADER,t))},y=function(t){var e=new l;return e.setTextureSize(t[0],t[1]),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},S=function(t,e,i,n,s,o){var u=new r,h=e[0],l=e[1],p=i[0],f=i[1];n===!0?t?u.setViewport(new g(0,0,p/2,f)):u.setViewport(new g(p/2,0,p/2,f)):t?u.setViewport(new g(.5*p-h,.5*(f-l),h,l)):u.setViewport(new g(.5*p,.5*(f-l),h,l)),a.makeOrtho(-.5,.5,-.5,.5,-5,5,u.getProjectionMatrix()),u.setRenderOrder(r.NESTED_RENDER,0),u.setReferenceFrame(c.ABSOLUTE_RF);var m=u.getOrCreateStateSet();return m.setTextureAttributeAndModes(0,s),m.setAttributeAndModes(A()),m.addUniform(d.createFloat2(o.scale,"uScale")),m.addUniform(d.createFloat2(o.scaleIn,"uScaleIn")),m.addUniform(d.createFloat2(t?o.lensCenterLeft:o.lensCenterRight,"uLensCenter")),m.addUniform(d.createFloat4(o.hmdWarpParam,"uHmdWarpParam")),m.addUniform(d.createFloat4(o.chromAbParam,"uChromAbParam")),u},C=function(t,e){var i=new r;return i.setName("rtt camera"),i.setViewport(new g(0,0,t.getWidth(),t.getHeight())),i.setProjectionMatrix(e),i.setClearColor(f.createAndSet(.3,.3,.3,0)),i.setRenderOrder(r.POST_RENDER,0),i.attachTexture(n.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),i.setReferenceFrame(c.ABSOLUTE_RF),i};v.createScene=function(t,e,i,r,n){var a=v.getDefaultConfig(i),o=p.createAndSet(.5*a.hResolution,a.vResolution),u=p.createAndSet(.5*a.hResolution,a.vResolution),l=t.getCamera().getViewport(),c=p.createAndSet(l.width(),l.height()),d=t.getGraphicContext().canvas;a.isCardboard&&(c[0]=d.width,c[1]=d.height);var f=void 0!==n?n:1,g={},m={};x(f,a,g,m);var A=t.getCamera().getViewMatrix(),w=r||new s;w.addUpdateCallback(new _(t,e,i,w,d));var T=y(o),M=C(T,m.projectionLeft),E=S(!0,u,c,a.isCardboard,T,g);M.addUpdateCallback(new b(A,m.viewLeft));var k=y(o),I=C(k,m.projectionRight),N=S(!1,u,c,a.isCardboard,k,g);return I.addUpdateCallback(new b(A,m.viewRight)),M.addChild(e),I.addChild(e),E.addChild(h.createTexturedFullScreenFakeQuadGeometry()),N.addChild(h.createTexturedFullScreenFakeQuadGeometry()),w.addChild(M),w.addChild(I),w.addChild(E),w.addChild(N),w},v.getDefaultConfig=function(t){var e={hResolution:1920,vResolution:1080,hScreenSize:.1296,vScreenSize:.0729,interpupillaryDistance:.064,lensSeparationDistance:.0635,eyeToScreenDistance:.04,distortionK:f.createAndSet(1,.22,.13,.02),chromaAbParameter:f.createAndSet(.996,-.004,1.014,0),isCardboard:!1};return 2===t||void 0===t?e:1===t?(e.hResolution=1280,e.vResolution=800,e.hScreenSize=.14976,e.vScreenSize=.0936,e.lensSeparationDistance=.064,e.eyeToScreenDistance=.041,e.distortionK=f.createAndSet(1,.22,.24,0),e):(void 0!==t.hResolution&&(e.hResolution=t.hResolution),void 0!==t.vResolution&&(e.vResolution=t.vResolution),void 0!==t.hScreenSize&&(e.hScreenSize=t.hScreenSize),void 0!==t.vScreenSize&&(e.vScreenSize=t.vScreenSize),void 0!==t.interpupillaryDistance&&(e.interpupillaryDistance=t.interpupillaryDistance),void 0!==t.lensSeparationDistance&&(e.lensSeparationDistance=t.lensSeparationDistance),void 0!==t.eyeToScreenDistance&&(e.eyeToScreenDistance=t.eyeToScreenDistance),void 0!==t.distortionK&&(e.distortionK=t.distortionK),void 0!==t.chromaAbParameter&&(e.chromaAbParameter=t.chromaAbParameter),void 0!==t.isCardboard&&(e.isCardboard=t.isCardboard),e)},t.exports=v},function(t,e,i){"use strict";var r=i(1154),n=i(1166),a=i(1122),s=i(1111),o=i(1198),u=i(1199),h=i(1200),l=i(1133),c=i(1110),d=i(1134),p=i(1124),f=i(1205),g=i(1252),m=function(t,e){this._rootView=t,this._offsetView=e};m.prototype={update:function(t){var e=t.getViewMatrix();return a.mult(this._offsetView,this._rootView,e),!0}};var v=function(t,e,i){var r=a.create(),n=Math.PI/180,s=Math.tan(t.upDegrees*n),o=Math.tan(t.downDegrees*n),u=Math.tan(t.leftDegrees*n),h=Math.tan(t.rightDegrees*n),l=2/(u+h),c=2/(s+o);return r[0]=l,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=-((u-h)*l*.5),r[9]=(s-o)*c*.5,r[10]=-(e+i)/(i-e),r[11]=-1,r[12]=0,r[13]=0,r[14]=-(2*i*e)/(i-e),r[15]=0,r},_=function(t){var e=new l;return e.setTextureSize(t.width,t.height),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},b=function(){var t=["#ifdef GL_ES","   precision highp float;","#endif","varying vec2 FragTexCoord0;","uniform sampler2D TextureLeft;","uniform sampler2D TextureRight;","void main() {","   if (FragTexCoord0.x < 0.5)","       gl_FragColor = texture2D(TextureLeft, vec2(FragTexCoord0.x * 2.0, FragTexCoord0.y));","   else","       gl_FragColor = texture2D(TextureRight, vec2(FragTexCoord0.x * 2.0 - 1.0, FragTexCoord0.y));","}"].join("\n");return new o(new u(u.VERTEX_SHADER,g.Filter.defaultVertexShader),new u(u.FRAGMENT_SHADER,t))},x=function(t,e,i){var n=new r;n.setViewport(i),n.setRenderOrder(r.NESTED_RENDER,0),n.setReferenceFrame(c.ABSOLUTE_RF),a.makeOrtho(0,1,0,1,-5,5,n.getProjectionMatrix());var s=n.getOrCreateStateSet();return s.addUniform(d.createInt(0,"TextureLeft")),s.addUniform(d.createInt(1,"TextureRight")),s.setTextureAttributeAndModes(0,t),s.setTextureAttributeAndModes(1,e),s.setAttributeAndModes(b()),n.addChild(h.createTexturedFullScreenFakeQuadGeometry()),n},A=function(t,e){var i=new r;return i.setName("rtt camera"),i.setViewport(new f(0,0,t.getWidth(),t.getHeight())),i.setProjectionMatrix(e),i.setClearColor(p.createAndSet(.3,.3,.3,0)),i.setRenderOrder(r.POST_RENDER,0),i.attachTexture(n.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),i.setReferenceFrame(c.ABSOLUTE_RF),i},y={};y.createScene=function(t,e,i,r,n){var o=r||new s,u=void 0!==n?n:1,h=i.getEyeParameters("left"),l=i.getEyeParameters("right"),c=v(h.fieldOfView,.1,1e3),d=v(l.fieldOfView,.1,1e3),p=a.makeTranslate(-u*h.offset[0],h.offset[1],h.offset[2],a.create()),f=a.makeTranslate(-u*l.offset[0],l.offset[1],l.offset[2],a.create()),g={width:Math.max(h.renderWidth,l.renderWidth),height:Math.max(h.renderHeight,l.renderHeight)},b=_(g),y=_(g),S=A(b,c),C=A(y,d),w=t.getCamera().getViewMatrix();S.addUpdateCallback(new m(w,p)),C.addUpdateCallback(new m(w,f));var T=x(b,y,t.getCamera().getViewport());return S.addChild(e),C.addChild(e),o.addChild(S),o.addChild(C),o.addChild(T),o},t.exports=y},function(t,e,i){"use strict";var r=i(1300),n=i(1301),a=i(1311),s=i(1314),o=i(1302),u={};u.Renderer=r,u.View=n,u.Viewer=a,u.EventProxy=s,u.Scene=o,t.exports=u},function(module,exports,__webpack_require__){"use strict";var Notify=__webpack_require__(1109),Matrix=__webpack_require__(1122),Options=__webpack_require__(1312),P=__webpack_require__(236),Timer=__webpack_require__(1108),UpdateVisitor=__webpack_require__(1204),MACROUTILS=__webpack_require__(1105),Texture=__webpack_require__(1133),OrbitManipulator=__webpack_require__(1231),createStats=__webpack_require__(1313),EventProxy=__webpack_require__(1314),View=__webpack_require__(1301),WebGLUtils=__webpack_require__(1132),WebGLDebugUtils=__webpack_require__(1322),OptionsURL=function(){var t={};if(function(t){var e,i=[];if(window.location.search)for(var r=window.location.search.slice(1).split("&"),n=0;n<r.length;n++){e=r[n].split("=");var a=e[0];i.push(a);var s=e[1];void 0===s&&(s="1"),t[a]=s}}(t),void 0!==t.log){var e=t.log.toLowerCase();switch(e){case"debug":Notify.setNotifyLevel(Notify.DEBUG);break;case"info":Notify.setNotifyLevel(Notify.INFO);break;case"notice":Notify.setNotifyLevel(Notify.NOTICE);break;case"warn":Notify.setNotifyLevel(Notify.WARN);break;case"error":Notify.setNotifyLevel(Notify.ERROR);break;case"html":!function(){var t=[],e=document.createElement("div"),i=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(e),e.appendChild(i)});var r=function(e){t.unshift(e),i.innerHTML=t.join("\n")};e.style.overflow="hidden",e.style.position="absolute",e.style.zIndex="10000",e.style.height="100%",e.style.maxWidth="600px",i.style.overflow="scroll",i.style.width="105%",i.style.height="100%",i.style.fontSize="10px",["log","error","warn","info","debug"].forEach(function(t){window.console[t]=r})}()}}return t}(),getGLSLOptimizer=function(){if(!window.$)return P.reject("jquery not found to load GLSL optimizer");var deferOptimizeGLSL=P.defer();window.deferOptimizeGLSL=deferOptimizeGLSL;var mod=["        var Module = {","            preRun: [],","            postRun: [ function () {",'                var func = Module.cwrap( "optimize_glsl", "string", [ "string", "number", "number" ] );',"                window.deferOptimizeGLSL.resolve( func );","            } ],","            print: function ( text ) {","                Notify.debug( text );","            },","            printErr: function ( text ) {","                Notify.debug( text );","            },","            setStatus: function ( text ) {","                Notify.debug( text );","            },","            totalDependencies: 0,","            monitorRunDependencies: function ( left ) {","                this.totalDependencies = Math.max( this.totalDependencies, left );",'                Module.setStatus( left ? "GLSL optimizer preparing... (" + ( this.totalDependencies - left ) + "/" + this.totalDependencies + ")" : "All downloads complete." );',"            },",'            memoryInitializerPrefixURL: "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/"',"        };"].join("\n"),$=window.$;Notify.log("try to load glsl optimizer");var url="https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/glsl-optimizer.js";return $.get(url).done(function(script){eval(mod+script)}).fail(function(){deferOptimizeGLSL.reject()}),deferOptimizeGLSL.promise},Viewer=function(t,e,i){View.call(this),this._startTick=Timer.instance().tick(),this._stats=void 0,this._done=!1,this._runPromise=P.resolve();var r=this.initOptions(e),n=this.initWebGLContext(t,r,i);if(!n)throw"No WebGL implementation found";MACROUTILS.init(),this.initDeviceEvents(r,t),this.initStats(r,t),this.initRun(r),this._updateVisitor=new UpdateVisitor,this.setUpView(n.canvas,r),this._hmd=null,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._contextLost=!1};Viewer.prototype=MACROUTILS.objectInherit(View.prototype,{initDeviceEvents:function(t,e){var i=t.mouseEventNode||e,r=t.EventBackend||{};t.EventBackend||(t.EventBackend=r),r.StandardMouseKeyboard=t.EventBackend.StandardMouseKeyboard||{};var n=r.StandardMouseKeyboard.mouseEventNode||i;r.StandardMouseKeyboard.mouseEventNode=n,r.StandardMouseKeyboard.keyboardEventNode=r.StandardMouseKeyboard.keyboardEventNode||document,"ontouchstart"in window&&(r.Hammer=r.Hammer||{},r.Hammer.eventNode=r.Hammer.eventNode||i),r.GamePad=r.GamePad||{},this._eventProxy=this.initEventProxy(t)},initOptions:function(t){var e=new Options;return t&&e.extend(t),e.extend(OptionsURL),e.getBoolean("traceLogCall")===!0&&(Notify.traceLogCall=!0),e.getBoolean("enableFrustumCulling")===!0&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e},initWebGLContext:function(t,e,i){e.get("SimulateWebGLLostContext")&&(t=WebGLDebugUtils.makeLostContextSimulatingCanvas(t),t.loseContextInNCalls(e.get("SimulateWebGLLostContext")));var r=WebGLUtils.setupWebGL(t,e,i);return t.addEventListener("webglcontextlost",function(t){this.contextLost(),t.preventDefault()}.bind(this),!1),t.addEventListener("webglcontextrestored",function(){this.contextRestored()}.bind(this),!1),(Notify.reportWebGLError||e.get("reportWebGLError"))&&(r=WebGLDebugUtils.makeDebugContext(r)),this.initWebGLCaps(r),this.setGraphicContext(r),r},initRun:function(t){if(t.getBoolean("GLSLOptimizer")===!0){var e=__webpack_require__(1199);e.enableGLSLOptimizer=!0,this._runPromise=getGLSLOptimizer(),this._runPromise.then(function(t){e.glslOptimizer=t,e.glslOptimizer?Notify.log("uses glsl optimizer, use ?log=info to see shader output"):Notify.error("failed to load glsl optimizer")})["catch"](function(t){Notify.error(t)})}},setContextLostCallback:function(t){this._contextLostCallback=t,this._contextLost&&t()},contextLost:function(){Notify.log("webgl context lost"),this._contextLostCallback&&this._contextLostCallback(),this._contextLost=!0,window.cancelAnimationFrame(this._requestID)},contextRestored:function(){Notify.log("webgl context restored, but not supported - reload the page")},init:function(){},getUpdateVisitor:function(){return this._updateVisitor},getState:function(){return this.getCamera().getRenderer().getState()},initStats:function(t){t.getBoolean("stats")&&(this._stats=createStats())},getViewerStats:function(){return this._stats},renderingTraversal:function(){if(this.getScene().getSceneData()&&this.getScene().getSceneData().getBound(),this.getCamera()){var t=this._stats,e=this.getCamera().getRenderer();if(t&&t.rStats("cull").start(),e.cull(),t&&t.rStats("cull").end(),t&&t.rStats("render").start(),e.draw(),t&&t.rStats("render").end(),t){var i=e.getCullVisitor();t.rStats("cullcamera").set(i._numCamera),t.rStats("cullmatrixtransform").set(i._numMatrixTransform),t.rStats("cullprojection").set(i._numProjection),t.rStats("cullnode").set(i._numNode),t.rStats("cullightsource").set(i._numLightSource),t.rStats("cullgeometry").set(i._numGeometry),t.rStats("pushstateset").set(e.getState()._numPushStateSet)}}},updateTraversal:function(){var t=this._stats;t&&t.rStats("update").start(),this._updateVisitor.resetStats(),this.getScene().updateSceneGraph(this._updateVisitor),t&&t.rStats("updatecallback").set(this._updateVisitor._numUpdateCallback),this.getDatabasePager().releaseGLExpiredSubgraphs(.005),this.flushDeletedGLObjects(.005),t&&t.rStats("update").end()},advance:function(t){var e=t;void 0===e&&(e=Number.MAX_VALUE);var i=this._frameStamp,r=i.getFrameNumber();i.setFrameNumber(r+1);var n=Timer.instance().deltaS(this._startTick,Timer.instance().tick());i.setReferenceTime(n);var a=i.getSimulationTime();i.setSimulationTime(e===Number.MAX_VALUE?n:e),i.setDeltaTime(i.getSimulationTime()-a)},beginFrame:function(){var t=this._stats;t&&t.rStats("frame").start(),t&&t.glS.start(),t&&t.rStats("rAF").tick(),t&&t.rStats("FPS").frame()},endFrame:function(){var t=this.getFrameStamp().getFrameNumber(),e=this._stats,i=e?e.rStats:void 0;i&&Texture.getTextureManager(this.getGraphicContext()).updateStats(t,i),i&&i("frame").end(),i&&i("rStats").start(),i&&i().update(),i&&i("rStats").end()},checkNeedToDoFrame:function(){return this._requestContinousUpdate||this._requestRedraw},frame:function(){if(!this._contextLost){this.beginFrame(),this.advance();var t=this.updateViewport();this.updateEventProxy(this._eventProxy,this.getFrameStamp()),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),Matrix.copy(this.getManipulator().getInverseMatrix(),this.getCamera().getViewMatrix())),(this.checkNeedToDoFrame()||t)&&(this._requestRedraw=!1,this.updateTraversal(),this.renderingTraversal()),this.endFrame(),this._hmd&&this._hmd.isPresenting&&this._hmd.submitFrame(this._eventProxy.WebVR._lastPose)}},setDone:function(t){this._done=t},done:function(){return this._done},_runImplementation:function(){var t=this,e=function(){t.done()||(t._requestID=t._requestAnimationFrame(e,t.getGraphicContext().canvas),t.frame())};e()},run:function(){var t=this;this._runPromise.then(function(){t._runImplementation()})["catch"](function(){t._runImplementation()})},setVRDisplay:function(t){this._hmd=t,this._requestAnimationFrame=t.requestAnimationFrame.bind(t)},getVRDisplay:function(){return this._hmd},setPresentVR:function(t){if(!this._hmd)return Notify.warn("no hmd device provided to the viewer!"),P.reject();if(this._hmd.capabilities.hasPosition||this._hmd.resetPose(),!this._hmd.capabilities.canPresent)return P.reject();if(t){var e=[{source:this.getGraphicContext().canvas}];return this._hmd.requestPresent(e)}return this._hmd.exitPresent()},setupManipulator:function(t){void 0===t&&(t=new OrbitManipulator),void 0!==t.setNode?t.setNode(this.getSceneData()):t.view=this,t.setCamera(this.getCamera()),this.setManipulator(t)},updateViewport:function(){var t=this.getGraphicContext(),e=t.canvas,i=this.computeCanvasSize(e);if(!i)return!1;var r=this.getCamera(),n=r.getViewport(),a=n.width(),s=n.height(),o=e.width/a,u=e.height/s,h=o/u;return n.setViewport(Math.round(n.x()*o),Math.round(n.y()*u),Math.round(n.width()*o),Math.round(n.height()*u)),1!==h&&Matrix.preMult(r.getProjectionMatrix(),Matrix.makeScale(1/h,1,1,Matrix.create())),!0},initEventProxy:function(t){for(var e=t||{},i={},r=EventProxy,n=e.EventBackend,a=window.Object.keys(r),s=0,o=a.length;o>s;s++){var u=a[s],h=!0,l={};if(n&&void 0!==n[u]){var c=n[u].enable;h=void 0!==c?c:!0,l=n[u]}var d=new Options;if(d.extend(l).extend(t),delete d.EventBackend,h){var p=new r[u](this);p.init(d),i[u]=p}}return i},updateEventProxy:function(t,e){var i=window.Object.keys(t);i.forEach(function(i){var r=t[i];r.update&&r.update(e)})},setManipulator:function(t){this._manipulator&&this.removeEventProxy(),t.getCamera()||t.setCamera(this.getCamera()),View.prototype.setManipulator.call(this,t)},removeEventProxy:function(){var t=this._eventProxy,e=window.Object.keys(t);e.forEach(function(e){var i=t[e];i.remove&&i.remove()})},getEventProxy:function(){return this._eventProxy}}),module.exports=Viewer},function(t,e,i){"use strict";var r=i(1105),n={antialias:!0,fullscreen:!0,enableFrustumCulling:!1,stats:!1,scrollwheel:!0,webgl2:!1},a=function(){window.Object.keys(n).forEach(function(t){this[t]=n[t]}.bind(this))};a.prototype={extend:function(t){return r.objectMix(this,t),this},get:function(t){return this[t]},getBoolean:function(t){var e=this.getString(t);return e?"false"!==e&&"0"!==e:void 0},getNumber:function(t){var e=this[t];return e?Number(e):void 0},getString:function(t){var e=this[t];return void 0!==e?this[t].toString():void 0}},t.exports=a},function(t,e){"use strict";var i=window.BrowserStats,r=window.glStats,n=window.rStats,a=function(){this.bS=new i,this.glS=new r,this.rStats=new n({values:{frame:{caption:"Total frame time (ms)",over:16,average:!0},fps:{caption:"Framerate (FPS)",below:30},calls:{caption:"Calls (three.js)",over:3e3},raf:{caption:"Time since last rAF (ms)",average:!0,avgMs:500},rstats:{caption:"rStats update (ms)",average:!0,avgMs:100},update:{caption:"update",average:!0},cull:{caption:"cull",average:!0},render:{caption:"render",average:!0},textureused:{caption:"texture used"},texturereserved:{caption:"texture reserved"},texturetotal:{caption:"texture total"},pushstateset:{caption:"num pushStateSet"},updatecallback:{caption:"num updateCallback"},cullcamera:{caption:"camera"},cullmatrixtransform:{
caption:"matrixTransform"},cullprojection:{caption:"projection"},cullnode:{caption:"node"},culllightsource:{caption:"lightSource"},cullgeometry:{caption:"geometry"}},groups:[{caption:"Framerate",values:["fps","raf"]},{caption:"Frame Budget",values:["frame","update","cull","render"]},{caption:"Scene Graph",values:["pushstateset","updatecallback"]},{caption:"Cull",values:["cullnode","cullmatrixtransform","cullgeometry","cullcamera","culllighsource","cullprojection"]},{caption:"Texture Memory",values:["texturereserved","textureused","texturetotal"]}],fractions:[{base:"frame",steps:["update","cull","render"]}],plugins:[this.bS,this.glS],colours:["#cc9933","#f20041","#69818c","#d90074","#b6f2ee","#660044","#50664d","#330022","#f2eeb6","#ee00ff","#806460","#1600a6","#994d57","#00004d","#f279da","#002933","#395073","#00eeff","#79baf2","#008066","#79f2aa","#00ff66","#1a331d","#004d14","#8c6c46","#388c00","#602080","#ff8800","#6d3df2","#995200","#0d1233","#402200","#3d6df2","#330e00","#e6f23d","#730000"]})},s=function(){if(n){var t=".rs-base{ position: absolute; z-index: 10000; padding: 10px; background-color: #222; font-size: 12px; line-height: 1.2em; width: 350px; font-family: 'Roboto Condensed', tahoma, sans-serif; left: 0; top: 0; overflow: hidden; } .rs-base h1{ margin: 0; padding: 0; font-size: 1.4em; color: #fff; margin-bottom: 5px; cursor: pointer; } .rs-base div.rs-group{ margin-bottom: 10px; } .rs-base div.rs-group.hidden{ display: none; } .rs-base div.rs-fraction{ position: relative; margin-bottom: 5px; } .rs-base div.rs-fraction p{ width: 145px; text-align: right; margin: 0; padding: 0; } .rs-base div.rs-legend{ position: absolute; line-height: 1em; } .rs-base div.rs-counter-base{ position: relative; margin: 2px 0; height: 1em; } .rs-base span.rs-counter-id{ position: absolute; left: 0; top: 0; } .rs-base div.rs-counter-value{ position: absolute; left: 115px; width: 30px; height: 1em; top: 0; text-align: right; } .rs-base canvas.rs-canvas{ position: absolute; right: 0; } ",e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");return i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i),new a}};t.exports=s},function(t,e,i){"use strict";var r=i(1315),n=i(1316),a=i(1317),s=i(1319),o=i(1320),u=i(1321);t.exports={GamePad:r,Hammer:n,LeapMotion:a,StandardMouseKeyboard:s,WebVR:o,DeviceOrientation:u}},function(t,e,i){"use strict";var r=i(1109),n=function(t){this._viewer=t,this._type="GamePad",this._enable=!0,this._gamepadIndex=-1};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return e[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},gamepadPoll:function(){if(!navigator.getGamepads)return null;var t=navigator.getGamepads(),e=t[this._gamepadIndex];if(e)return e;for(var i=0,r=t.length;r>i;++i){var n=t[i];if(n&&n.id&&-1===n.id.indexOf("Unknown Gamepad"))return this._gamepadIndex=i,this.onGamepadConnect(n),n}return this._gamepadIndex>=0&&(this._gamepadIndex=-1,this.onGamepadConnect()),null},onGamepadConnect:function(t){r.log("Detected new gamepad!",t)},onGamepadDisconnect:function(){r.log("Gamepad disconnected")},update:function(){if(this.isValid()){var t=this.gamepadPoll();if(t){var e=this.getManipulatorController();e.update&&e.update(t)}}}},t.exports=n},function(t,e,i){"use strict";var r=i(282),n=function(t){this._enable=!0,this._viewer=t,this._type="Hammer",this._eventNode=void 0};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){var e={prevent_default:!0,drag_max_touches:2,transform_min_scale:.08,transform_min_rotation:180,transform_always_block:!0,hold:!1,release:!1,swipe:!1,tap:!1};this._eventNode=t.eventNode,this._eventNode&&(this._hammer=new r(this._eventNode,e),t.getBoolean("scrollwheel")===!1?this._hammer.get("pinch").set({enable:!1}):this._hammer.get("pinch").set({enable:!0}))},isValid:function(){return this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this._hammer)},remove:function(){this.isValid()&&this.getManipulatorController().removeEventProxy(this._hammer)}},t.exports=n},function(t,e,i){"use strict";var r=i(1318),n=i(1109),a=function(t){this._viewer=t,this._type="LeapMotion",this._enable=!0};a.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){if("undefined"!=typeof r&&r.Controller){var e=this;this._controller=new r.Controller({enableGestures:t.gestures||!0,tryReconnectOnDisconnect:!0,connectAttempts:3}),this._controller.on("ready",function(){t.readyCallback&&t.readyCallback(e._controller),e._leapMotionReady=!0,n.info("leapmotion ready")}),this._controller.loop(this._update.bind(this))}},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return e[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},_update:function(t){if(t.valid&&this.isValid()){var e=this.getManipulatorController();e.update&&e.update(t)}}},t.exports=a},function(t,e){t.exports={}},function(t,e,i){"use strict";var r=i(1168),n=function(t){this._enable=!0,this._viewer=t,this._type="StandardMouseKeyboard",this._mouseEventNode=void 0,this._wheelEventNode=void 0,this._keyboardEventNode=void 0,this._eventList=["mousedown","mouseup","mouseout","mousemove","dblclick"],this._mousePosition=r.create()};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){this.removeEventListeners(this._mouseEventNode,this._wheelEventNode,this._keyboardEventNode);var e=t.mouseEventNode,i=t.wheelEventNode||e,r=t.keyboardEventNode||e;t.getBoolean("scrollwheel")===!1&&(i=null),this.addEventListeners(e,i,r),this._mouseEventNode=e,this._wheelEventNode=i,this._keyboardEventNode=r},addEventListeners:function(t,e,i){if(t)for(var r=0,n=this._eventList.length;n>r;r++){var a=this._eventList[r];this[a]&&t.addEventListener(a,this[a].bind(this),!1)}e&&(e.addEventListener("DOMMouseScroll",this.mousewheel.bind(this),!1),e.addEventListener("mousewheel",this.mousewheel.bind(this),!1),e.addEventListener("MozMousePixelScroll",this.preventDefault.bind(this),!1)),i&&(i.addEventListener("keydown",this.keydown.bind(this),!1),i.addEventListener("keyup",this.keyup.bind(this),!1))},removeEventListeners:function(t,e,i){if(t)for(var r=0,n=this._eventList.length;n>r;r++){var a=this._eventList[r];this[a]&&t.removeEventListener(a,this[a])}e&&(e.removeEventListener("DOMMouseScroll",this.mousewheel),e.removeEventListener("mousewheel",this.mousewheel),e.removeEventListener("MozMousePixelScroll",this.preventDefault)),i&&(i.removeEventListener("keydown",this.keydown),i.removeEventListener("keyup",this.keyup))},isValid:function(){return this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},keyup:function(t){return this.isValid()&&this.getManipulatorController().keyup?this.getManipulatorController().keyup(t):void 0},keydown:function(t){return this.isValid()&&this.getManipulatorController().keydown?this.getManipulatorController().keydown(t):void 0},mousedown:function(t){return this.isValid()&&this.getManipulatorController().mousedown?this.getManipulatorController().mousedown(t):void 0},mouseup:function(t){return this.isValid()&&this.getManipulatorController().mouseup?this.getManipulatorController().mouseup(t):void 0},mouseout:function(t){return this.isValid()&&this.getManipulatorController().mouseout?this.getManipulatorController().mouseout(t):void 0},mousemove:function(t){return this.isValid()&&this.getManipulatorController().mousemove?this.getManipulatorController().mousemove(t):void 0},dblclick:function(t){return this.isValid()&&this.getManipulatorController().dblclick?this.getManipulatorController().dblclick(t):void 0},mousewheel:function(t){if(this.isValid()){var e=this.getManipulatorController();if(e.mousewheel){var i=t||window.event,r=[].slice.call(arguments,1),n=0,a=0,s=0;return t.wheelDelta&&(n=t.wheelDelta/120),t.detail&&(n=-t.detail/3),s=n,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(s=0,a=-1*n),void 0!==i.wheelDeltaY&&(s=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(a=-1*i.wheelDeltaX/120),r.unshift(t,n,a,s),this.getManipulatorController().mousewheel.apply(e,r)}}},preventDefault:function(t){t.preventDefault()},divGlobalOffset:function(t){var e=0,i=0;e=t.offsetLeft,i=t.offsetTop;for(var r=document.getElementsByTagName("body")[0];t.offsetParent&&t!==r;)e+=t.offsetParent.offsetLeft,i+=t.offsetParent.offsetTop,t=t.offsetParent;return this._mousePosition[0]=e,this._mousePosition[1]=i,this._mousePosition},getPositionRelativeToCanvas:function(t,e){var i,r,n=t.target;t.pageX||t.pageY?(i=t.pageX,r=t.pageY):(t.clientX||t.clientY)&&(i=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);var a=this.divGlobalOffset(n);return i-=a[0],r=n.height-(r-a[1]),void 0===e&&(e=this._mousePosition),e[0]=i,e[1]=r,e},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this)}},t.exports=n},function(t,e,i){"use strict";var r=i(1109),n=i(1125),a=i(1114),s=i(1122),o=function(t){this._viewer=t,this._type="WebVR",this._enable=!1,this._hmd=void 0,this._sensor=void 0,this._lastPose=void 0,this._quat=n.create(),this._pos=a.create(),this._worldScale=1};o.prototype={setWorldScale:function(t){this._worldScale=t},setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){if(navigator.getVRDisplays){var t=this;navigator.getVRDisplays().then(function(e){e.length>0&&(t._hmd=e[0],r.log("Found a VR display"),t._viewer.setVRDisplay(t._hmd))})}},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();return t&&t.getControllerList()[this._type]&&this._hmd?!0:!1},update:function(){var t=n.create(),e=a.create();return function(){if(this.isValid()){var i=this.getManipulatorController();if(i.update&&(this._hmd.capabilities.hasOrientation||this._hmd.capabilities.hasPosition)){this._lastPose=this._hmd.getPose();var r=this._hmd.stageParameters&&this._hmd.stageParameters.sittingToStandingTransform,a=this._lastPose.orientation;a&&(r&&(a=s.getRotate(r,t),n.mult(a,this._lastPose.orientation,a)),this._quat[0]=a[0],this._quat[1]=-a[2],this._quat[2]=a[1],this._quat[3]=a[3]);var o=this._lastPose.position;o&&(r&&(o=s.transformVec3(r,o,e)),this._pos[0]=o[0]*this._worldScale,this._pos[1]=-o[2]*this._worldScale,this._pos[2]=o[1]*this._worldScale),i.update(this._quat,this._pos)}}}}(),getHmd:function(){return this._hmd}},t.exports=o},function(t,e){"use strict";var i=function(t){this._viewer=t,this._type="DeviceOrientation",this._enable=!1,this._deviceOrientation=void 0,this._screenOrientation=window.orientation||90};i.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){var t=this;window.addEventListener("deviceorientation",function(e){null!==e.alpha&&void 0!==e.alpha&&(t._deviceOrientation=e)},!1),window.addEventListener("orientationchange",function(){null!==window.orientation&&void 0!==window.orientation&&(t._screenOrientation=window.orientation)},!1)},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;if(!this._deviceOrientation)return!1;var t=this._viewer.getManipulator();return t&&t.getControllerList()[this._type]?!0:!1},update:function(){if(this.isValid()){var t=this.getManipulatorController();t.update&&t.update(this._deviceOrientation,this._screenOrientation)}}},t.exports=i},function(t,e,i){"use strict";var r=i(1109),n=function(){function t(t){if(null===c){c={};for(var e in t)"number"==typeof t[e]&&(c[t[e]]=e)}}function e(){if(null===c)throw"WebGLDebugUtils.init(ctx) not called"}function i(t){return e(),void 0!==c[t]}function n(t){e();var i=c[t];return void 0!==i?i:"*UNKNOWN WebGL ENUM (0x"+t.toString(16)+")"}function a(t,e,i){var r=l[t];return void 0!==r&&r[e]?n(i):i.toString()}function s(t,e,i){t.__defineGetter__(i,function(){return e[i]}),t.__defineSetter__(i,function(t){e[i]=t})}function o(e,i){function o(t,e){return function(){var r=t[e].apply(t,arguments),n=t.getError();return 0!==n&&(u[n]=!0,i(n,e,arguments)),r}}t(e),i=i||function(t,e,i){for(var s="",o=0;o<i.length;++o)s+=(0===o?"":", ")+a(e,o,i[o]);r.log("WebGL error "+n(t)+" in "+e+"("+s+")")};var u={},h={};for(var l in e)"function"==typeof e[l]?h[l]=o(e,l):s(h,e,l);return h.getError=function(){for(var t in u)if(u[t])return u[t]=!1,t;return e.NO_ERROR},h}function u(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);var r;for(r=0;e>r;++r)t.disableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(r,0);t.deleteBuffer(i);var n=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(r=0;n>r;++r)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function h(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function i(t){var e=t.addEventListener;t.addEventListener=function(i,r,n){switch(i){case"webglcontextlost":S(r);break;case"webglcontextrestored":C(r);break;default:e.apply(t,arguments)}}}function r(){for(var t=window.Object.keys(y),e=0;e<t.length;++e)delete y[t]}function n(){++b,m||_==b&&t.loseContext()}function a(t,e){var i=t[e];return function(){if(n(),!m){var e=i.apply(t,arguments);return e}}}function o(){for(var t=0;t<v.length;++t){var e=v[t];e instanceof WebGLBuffer?c.deleteBuffer(e):e instanceof WebGLFramebuffer?c.deleteFramebuffer(e):e instanceof WebGLProgram?c.deleteProgram(e):e instanceof WebGLRenderbuffer?c.deleteRenderbuffer(e):e instanceof WebGLShader?c.deleteShader(e):e instanceof WebGLTexture&&c.deleteTexture(e)}}function h(t){return{statusMessage:t,preventDefault:function(){x=!0}}}function l(t){for(var e in t)"function"==typeof t[e]?f[e]=a(t,e):s(f,t,e);f.getError=function(){n();var t;if(!m)for(;t=c.getError();)y[t]=!0;for(t in y)if(y[t])return delete y[t],t;return f.NO_ERROR};var i,r,o=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(r=0;r<o.length;++r)i=o[r],f[i]=function(e){return function(){if(n(),m)return null;var i=e.apply(t,arguments);return i.__webglDebugContextLostId__=g,v.push(i),i}}(t[i]);var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(r=0;r<u.length;++r)i=u[r],f[i]=function(e){return function(){return n(),m?null:e.apply(t,arguments)}}(f[i]);var h=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(r=0;r<h.length;++r)i=h[r],f[i]=function(e){return function(){return n(),m?!1:e.apply(t,arguments)}}(f[i]);return f.checkFramebufferStatus=function(e){return function(){return n(),m?f.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(f.checkFramebufferStatus),f.getAttribLocation=function(e){return function(){return n(),m?-1:e.apply(t,arguments)}}(f.getAttribLocation),f.getVertexAttribOffset=function(e){return function(){return n(),m?0:e.apply(t,arguments)}}(f.getVertexAttribOffset),f.isContextLost=function(){return m},f}var c,d=[],p=[],f={},g=1,m=!1,v=[],_=0,b=0,x=!1,A=0,y={};t.getContext=function(e){return function(){var i=e.apply(t,arguments);if(i instanceof WebGLRenderingContext){if(i!=c){if(c)throw"got different context";c=i,f=l(c)}return f}return i}}(t.getContext);var S=function(t){d.push(e(t))},C=function(t){p.push(e(t))};return i(t),t.loseContext=function(){if(!m){for(m=!0,_=0,++g;c.getError(););r(),y[c.CONTEXT_LOST_WEBGL]=!0;var e=h("context lost"),i=d.slice();setTimeout(function(){for(var r=0;r<i.length;++r)i[r](e);A>=0&&setTimeout(function(){t.restoreContext()},A)},0)}},t.restoreContext=function(){m&&p.length&&setTimeout(function(){if(!x)throw"can not restore. webglcontestlost listener did not call event.preventDefault";o(),u(c),m=!1,b=0,x=!1;for(var t=p.slice(),e=h("context restored"),i=0;i<t.length;++i)t[i](e)},0)},t.loseContextInNCalls=function(t){if(m)throw"You can not ask a lost contet to be lost";_=b+t},t.getNumCalls=function(){return b},t.setRestoreTimeout=function(t){A=t},t}var l={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},c=null;return{init:t,mightBeEnum:i,glEnumToString:n,glFunctionArgToString:a,makeDebugContext:o,makeLostContextSimulatingCanvas:h,resetToInitialState:u}}();t.exports=n},function(t,e,i){"use strict";var r=i(1324),n=i(1262),a=i(1261),s=i(1325),o=i(1326),u=i(1327),h=i(1328),l=i(1331),c=i(1329),d=i(1330),p=i(1332),f={};f.ShadowCastAttribute=r,f.ShadowCastCompiler=n,f.ShadowReceiveAttribute=h,f.ShadowCasterVisitor=s,f.ShadowFrustumIntersection=o,f.ShadowMap=u,f.ShadowedScene=p,f.ShadowSettings=l,f.ShadowCastShaderGenerator=a,f.ShadowTechnique=c,f.ShadowTexture=d,t.exports=f},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=function(t,e){n.call(this),this._enable=!t,this._shadowReceiveAttribute=e};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ShadowCast",cloneType:function(){return new a(!0)},setReceiveAttribute:function(t){this._shadowReceiveAttribute=t},getReceiveAttribute:function(){return this._shadowReceiveAttribute},getDefines:function(){return this._shadowReceiveAttribute?this._shadowReceiveAttribute.getDefines():void 0},getAlgorithm:function(){return this._shadowReceiveAttribute?this._shadowReceiveAttribute.getAlgorithm():void 0},getHash:function(){return"ShadowCast"+this._enable+this._shadowReceiveAttribute.getAlgorithm()+this._shadowReceiveAttribute.getPrecision()},isEnabled:function(){return this._enable}}),"osgShadow","ShadowCastAttribute"),r.setTypeID(a),t.exports=a},function(t,e,i){"use strict";var r=i(1138),n=i(1154),a=i(1184),s=i(1195),o=i(1162),u=i(1121),h=i(1105),l=function(t){u.call(this),this._noCastMask=t,this._nodeList=[]};l.prototype=h.objectLibraryClass(h.objectInherit(u.prototype,{reset:function(){this._nodeList=[]},removeNodeFromCasting:function(t){var e=t.getNodeMask();-1===e?(e=this._noCastMask,t.setNodeMask(e),this._nodeList.push(t)):0!==(e&~this._noCastMask)&&(t.setNodeMask(e|this._noCastMask),this._nodeList.push(t))},apply:function(t){var e=t.getStateSet();if(e){var i=e.getAttribute("BlendFunc");if(void 0!==i&&i.getSource()!==r.DISABLE){var u=e.getAttribute("Depth");if(u&&(u.getFunc()===a.DISABLE||u.getWriteMask()===!1))return void this.removeNodeFromCasting(t)}}return t.getTypeID()===s.typeID||t.getTypeID()===o.typeID?void this.removeNodeFromCasting(t):t.getTypeID()===n.typeID&&t.isRenderToTextureCamera()?void this.removeNodeFromCasting(t):void this.traverse(t)},setNoCastMask:function(t){this._noCastMask=t},restore:function(){for(var t=0,e=this._nodeList.length;e>t;t++){var i=this._nodeList[t],r=i.getNodeMask();r===this._noCastMask?i.setNodeMask(-1):i.setNodeMask(r&~this._noCastMask)}}}),"osgShadow","ShadowCasterVisitor"),h.setTypeID(l),t.exports=l},function(t,e,i){"use strict";var r=i(1113),n=i(1117),a=i(1154),s=i(1130),o=i(1195),u=i(1122),h=i(1126),l=i(1143),c=i(1121),d=i(1123),p=i(1105),f=function(){c.call(this,c.TRAVERSE_ALL_CHILDREN),this._matrixStack=[u.create()],this._reservedMatrixStack=new h,this._bb=new r,this._bs=new n};f.prototype=p.objectInherit(c.prototype,{reset:function(t,e,i,r,n){this.setTraversalMask(t),this._cameraFrustum=i,this._lightFrustum=n,this.getCameraPlaneMaskForLightNear(e,i,r?6:4),this._reservedMatrixStack.reset(),this._matrixStack.length=1,this._bb.init()},getBoundingBox:function(){return this._bb},getCameraPlaneMaskForLightNear:function(t,e,i){var r,n=1,a=15;for(r=0;i>r;++r)a=a<<1|1;var s=e.getPlanes();for(r=0;i>r;++r)d.distanceToPlane(s[r],t)<0&&(a^=n),n<<=1;return this._cameraPlaneMaskedByLightNear=a,e.setResultMask(a),e.pushCurrentMask(a),a},applyTransform:function(t){var e=this._reservedMatrixStack.get(),i=this._matrixStack.length;u.copy(this._matrixStack[i-1],e),t.computeLocalToWorldMatrix(e,this);var r=this._bs;u.transformBoundingSphere(e,t.getBound(),this._bs),(0===this._cameraFrustum.getCurrentMask()||this._cameraFrustum.containsBoundingSphere(r))&&(0===this._lightFrustum.getCurrentMask()||this._lightFrustum.containsBoundingSphere(r))&&(this._cameraFrustum.pushCurrentMask(),this._lightFrustum.pushCurrentMask(),this.pushMatrix(e),this.traverse(t),this._cameraFrustum.popCurrentMask(),this._lightFrustum.popCurrentMask(),this.popMatrix())},applyBoundingBox:function(){var t=new r;return function(e){var i=this._matrixStack.length,r=this._matrixStack[i-1];u.isIdentity(r)?this._bb.expandByBoundingBox(e):e.valid()&&(u.transformBoundingBox(r,e,t),this._bb.expandByBoundingBox(t))}}(),apply:function(t){var e=t.getTypeID();if(t instanceof l)return void this.applyTransform(t);if(e===s.getTypeID()){var i=this._bs,r=this._matrixStack[this._matrixStack.length-1];if(u.transformBoundingSphere(r,t.getBound(),i),0!==this._cameraFrustum.getCurrentMask()&&!this._cameraFrustum.containsBoundingSphere(i))return;if(0!==this._lightFrustum.getCurrentMask()&&!this._lightFrustum.containsBoundingSphere(i))return;return void this.applyBoundingBox(t.getBoundingBox())}e===a.getTypeID()||e===o.getTypeID(),this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()}}),t.exports=f},function(t,e,i){"use strict";var r=i(1154),n=i(1138),a=i(1129),s=i(1184),o=i(1166),u=i(1122),h=i(1109),l=i(1120),c=i(1118),d=i(1133),p=i(1110),f=i(1134),g=i(1105),m=i(1114),v=i(1124),_=i(1205),b=i(1131),x=i(1328),A=i(1325),y=i(1326),S=i(1324),C=i(1329),w=i(1330),T=function(t){this._shadowTechnique=t};T.prototype={cull:function(t,e){this._shadowTechnique.getShadowedScene().nodeTraverse(e);var i=e.getCurrentCullingSet();if(e.getComputeNearFar()===!0&&e.getComputedFar()>=e.getComputedNear()){var r=e.getCurrentProjectionMatrix();this._shadowTechnique.getDepthRange()[0]=e.getComputedNear(),this._shadowTechnique.getDepthRange()[1]=e.getComputedFar(),u.getFrustumPlanes(r,e.getCurrentModelViewMatrix(),i.getFrustum().getPlanes(),!1),i.getFrustum().setupMask(6)}return this._shadowTechnique.setLightFrustum(i.getFrustum()),!1}};var M=function(t){C.call(this),this._projectionMatrix=u.create(),this._viewMatrix=u.create(),this._lightUp=m.createAndSet(0,0,1),this._light=t.light,this._cameraShadow=new r,this._cameraShadow.setCullCallback(new T(this)),this._cameraShadow.setRenderOrder(r.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(p.ABSOLUTE_RF),this._cameraShadow.setClearColor(v.createAndSet(1,1,1,1)),this._texture=new w,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0,this._textureSize=256,this._receivingStateset=void 0,this._casterStateSet=new c,this._casterStateSet.addUniform(f.createFloat1(0,"exponent0")),this._casterStateSet.addUniform(f.createFloat1(0,"exponent1")),this._casterStateSet.addUniform(f.createFloat1(.005,"bias")),this._texelSizeUniform=f.createFloat1(1/this._textureSize,"texelSize"),this._casterStateSet.addUniform(this._texelSizeUniform);var e=f.createFloat2("RenderSize");this._casterStateSet.addUniform(e),this._renderSize=e.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._casterStateSet.setAttributeAndModes(new s(s.LESS),l.ON|l.OVERRIDE),this._casterStateSet.setAttributeAndModes(new n,l.ON|l.OVERRIDE),this._shadowReceiveAttribute=new x(this._light.getLightNumber()),this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute,l.ON|l.OVERRIDE),this._shadowCastShaderGeneratorName="ShadowCast";var i=.001,o=1e3,h=f.createFloat4("Shadow_DepthRange");this._casterStateSet.addUniform(h),this._depthRange=h.getInternalArray(),this._depthRange[0]=i,this._depthRange[1]=o,this._depthRange[2]=o-i,this._depthRange[3]=1/(o-i),this._worldLightPos=v.create(),this._worldLightPos[3]=0,this._worldLightDir=v.create(),this._worldLightDir[3]=1,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,this._shaderProcessor=void 0,this._tmpVec=m.create(),this._tmpVecBis=m.create(),this._tmpVecTercio=m.create(),this._tmpMatrix=u.create(),t&&this.setShadowSettings(t),this._computeFrustumBounds=new y,this._computeBoundsVisitor=new a,t.userShadowCasterVisitor!==!1&&(this._removeNodesNeverCastingVisitor=t.userShadowCasterVisitor||new A(this._castsShadowTraversalMask)),this._infiniteFrustum=!0;var d=new S(!1,this._shadowReceiveAttribute);this._casterStateSet.setAttributeAndModes(d,l.ON|l.OVERRIDE),this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName,l.OVERRIDE|l.ON)};M.prototype=g.objectLibraryClass(g.objectInherit(C.prototype,{getDepthRange:function(){return this._depthRange},setLightFrustum:function(t){this._lightFrustum=t},getCamera:function(){return this._cameraShadow},getTexture:function(){return this._texture},isDirty:function(){return this._dirty},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t},setShadowSettings:function(t){t&&(this._light=t.light,this._shadowCastShaderGeneratorName=t.getShadowCastShaderGeneratorName(),this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),this.setLight(this._light),this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType),this.setFakePCF(t.fakePCF),this.setRotateOffset(t.rotateOffset),this.setKernelSizePCF(t.kernelSizePCF),this.setAlgorithm(t.algorithm),this.setBias(t.bias),this.setExponent0(t.exponent),this.setExponent1(t.exponent1),this.setEpsilonVSM(t.epsilonVSM))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},getBias:function(){return this._shadowReceiveAttribute.getBias()},setBias:function(t){this._shadowReceiveAttribute.setBias(t),this._casterStateSet.getUniformList().bias.getUniform().setFloat(t)},getExponent0:function(){return this._shadowReceiveAttribute.getExponent0()},setExponent0:function(t){this._shadowReceiveAttribute.setExponent0(t),this._casterStateSet.getUniformList().exponent0.getUniform().setFloat(t)},getExponent1:function(){return this._shadowReceiveAttribute.getExponent1()},setExponent1:function(t){this._shadowReceiveAttribute.setExponent1(t),this._casterStateSet.getUniformList().exponent1.getUniform().setFloat(t)},getEpsilonVSM:function(){return this._shadowReceiveAttribute.getEpsilonVSM()},setEpsilonVSM:function(t){this._shadowReceiveAttribute.setEpsilonVSM(t)},getKernelSizePCF:function(){return this._shadowReceiveAttribute.getKernelSizePCF()},setKernelSizePCF:function(t){this._shadowReceiveAttribute.setKernelSizePCF(t)},getFakePCF:function(){return this._shadowReceiveAttribute.getFakePCF()},setFakePCF:function(t){this._shadowReceiveAttribute.getFakePCF()!==t&&(this._shadowReceiveAttribute.setFakePCF(t),this.setTextureFiltering())},getRotateOffset:function(){return this._shadowReceiveAttribute.getRotateOffset()},setRotateOffset:function(t){this._shadowReceiveAttribute.getRotateOffset()!==t&&this._shadowReceiveAttribute.setRotateOffset(t)},setShadowedScene:function(t){C.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet(),this.dirty()},checkLightNumber:function(){var t=this._light.getLightNumber();this._shadowReceiveAttribute.getLightNumber()!==t&&this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),this._texture&&this._texture.getLightUnit()!==t&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())},init:function(){if(this._shadowedScene){this._filledOnce=!1,this.checkLightNumber(),this._cameraShadow||(this._cameraShadow=new r,this._cameraShadow.setCullCallback(new T(this)),this._cameraShadow.setRenderOrder(r.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(p.ABSOLUTE_RF),this._cameraShadow.setClearColor(v.createAndSet(1,1,1,1))),this.initTexture();var t=this._light.getLightNumber();this._textureUnit=this._textureUnitBase+t,this._cameraShadow.setName("light_shadow_camera"+this._light.getName()),this._texture.setLightUnit(t),this._texture.setName("ShadowTexture"+this._textureUnit),this._shadowReceiveAttribute.setLightNumber(t);var e=l.OVERRIDE|l.ON;
this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute,e),this._preventTextureBindingDuringShadowCasting(),this._casterStateSet.setTextureAttributeAndModes(this._textureUnit,d.textureNull,l.PROTECTED),this._receivingStateset.setTextureAttributeAndModes(this._textureUnit,this._texture,e),this._dirty=!1}},_preventTextureBindingDuringShadowCasting:function(){for(var t=b.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"),e=0;t>e;e++)this._casterStateSet.setTextureAttributeAndModes(e,d.textureNull,l.OVERRIDE|l.ON)},valid:function(){return!0},updateShadowTechnique:function(){var t=this._cameraShadow,e=this._texture;if(t&&e){var i=t.getViewport();i||(i=new _,t.setViewport(i)),(i.width()!==e.getWidth()||i.height()!==e.getHeight())&&(t.detachAll(),t.attachTexture(o.COLOR_ATTACHMENT0,e),t.attachRenderBuffer(o.DEPTH_ATTACHMENT,o.DEPTH_COMPONENT16),t.getViewport().setViewport(0,0,e.getWidth(),e.getHeight()))}},updateShadowTechnic:function(){h.log("ShadowMap.updateShadowTechnic() is deprecated, use updateShadowTechnique instead"),this.updateShadowTechnique()},setTextureFiltering:function(){var t,e,i,r=this.getTexturePrecision();if(this._texture){switch(this.getAlgorithm()){case"ESM":case"VSM":case"EVSM":e=d.LINEAR,i=d.LINEAR;break;default:case"PCF":case"NONE":this.getFakePCF()?(e=d.LINEAR,i=d.LINEAR):(e=d.NEAREST,i=d.NEAREST)}switch(r){case"HALF_FLOAT":t=d.HALF_FLOAT,e=d.NEAREST,i=d.NEAREST;break;case"HALF_FLOAT_LINEAR":t=d.HALF_FLOAT,e=d.LINEAR,i=d.LINEAR;break;case"FLOAT":t=d.FLOAT,e=d.NEAREST,i=d.NEAREST;break;case"FLOAT_LINEAR":t=d.FLOAT,e=d.LINEAR,i=d.LINEAR;break;default:case"UNSIGNED_BYTE":t=d.UNSIGNED_BYTE}}this._texture.setInternalFormatType(t),this._texture.setMinFilter(e),this._texture.setMagFilter(i),this._textureMagFilter=i,this._textureMinFilter=e},initTexture:function(){if(this._dirty){this._texture||(this._texture=new w,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var t;t=d.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(t),this._texture.setWrapS(d.CLAMP_TO_EDGE),this._texture.setWrapT(d.CLAMP_TO_EDGE),this._texture.dirty()}},setTexturePrecision:function(t){t!==this._shadowReceiveAttribute.getPrecision()&&(this._shadowReceiveAttribute.setPrecision(t),this.dirty())},getTexturePrecision:function(){return this._shadowReceiveAttribute.getPrecision()},setTextureSize:function(t){t!==this._textureSize&&(this._textureSize=t,this.dirty())},setAlgorithm:function(t){t!==this.getAlgorithm()&&(this._shadowReceiveAttribute.setAlgorithm(t),this.dirty())},getAlgorithm:function(){return this._shadowReceiveAttribute.getAlgorithm()},setLight:function(t){t&&t!==this._light&&(this._light=t,this.dirty())},getUp:function(t){return Math.abs(m.dot(this._lightUp,t))>=1&&(1===this._lightUp[0]?(this._lightUp[0]=0,this._lightUp[1]=1,this._lightUp[2]=0):(this._lightUp[0]=1,this._lightUp[1]=0,this._lightUp[2]=0)),this._lightUp},nearFarBounding:function(){var t=this._depthRange[0],e=this._depthRange[1],i=M.EPSILON;t-i>e?(this._emptyCasterScene=!0,e=1,t=i):i>t&&(t=i);var r=.005;e*r>t&&(t=e*r),this._depthRange[0]=t,this._depthRange[1]=e},makePerspectiveFromBoundingBox:function(t,e,i,r,n,a){var s=t.center(this._tmpVec),o=t.radius(),h=M.EPSILON,l=h,c=1;m.copy(r,this._tmpVecBis),m.neg(this._tmpVecBis,this._tmpVecBis),m.normalize(this._tmpVecBis,this._tmpVecBis);var d=m.dot(i,this._tmpVecBis),p=m.dot(s,this._tmpVecBis)+d;-o>p?this._emptyCasterScene=!0:0>=p?(l=h,c=p+o):o>p?(l=h,c=p+o):(l=p-o,c=p+o),this._depthRange[0]=l,this._depthRange[1]=c,this.nearFarBounding();var f=this._depthRange[0]*Math.tan(e*Math.PI/180);f=f>o?o:f;var g=f,v=-g,_=f,b=-_,x=this.getUp(r);this._infiniteFrustum?u.makeFrustumInfinite(b,_,v,g,this._depthRange[0],this._depthRange[1],a):u.makeFrustum(b,_,v,g,this._depthRange[0],this._depthRange[1],a),u.makeLookFromDirection(i,r,x,n)},makeOrthoFromBoundingBox:function(t,e,i,r){var n=t.center(this._tmpVecTercio),a=t.radius(),s=a+a,o=1e-4,h=s+1e-4,l=this._tmpVecBis;m.mult(e,-s,l);var c=this._tmpVec;m.add(n,l,c),o=a,h+=a;var d=.001;h*d>o&&(o=h*d);var p=this.getUp(e);u.makeLookFromDirection(c,e,p,i);var f,g;g=a,f=g,u.makeOrtho(-f,f,-g,g,o,h,r),this._depthRange[0]=o,this._depthRange[1]=h},aimShadowCastingCamera:function(t,e){var i=this._light;if(!i)return void(this._emptyCasterScene=!0);var r=this._cameraShadow,n=this._worldLightPos,a=this._worldLightDir;u.copy(r.getProjectionMatrix(),this._projectionMatrix),u.copy(r.getViewMatrix(),this._viewMatrix);var s,o=this._projectionMatrix,l=this._viewMatrix,c=t.getCurrentRenderBin().getPositionedAttribute();if(c=c.find(function(t){return t.length>0&&t[1]===i?(s=t[0],!0):!1}),void 0===s)return h.warn("light isnt inside children of shadowedScene Node"),void(this._emptyCasterScene=!0);var d=this._tmpMatrix;if(u.inverse(t.getCurrentModelViewMatrix(),d),0!==i.getPosition()[3]&&i.getSpotCutoff()<180){u.mult(d,s,this._tmpMatrix);var p=this._tmpMatrix;u.transformVec3(p,i.getPosition(),n),p[12]=0,p[13]=0,p[14]=0,u.inverse(p,p),u.transpose(p,p),m.copy(i.getDirection(),a),u.transformVec4(p,a,a),m.normalize(a,a),this.makePerspectiveFromBoundingBox(e,i.getSpotCutoff(),n,a,l,o)}else u.transformVec4(s,i.getPosition(),n),u.transformVec4(d,n,n),m.mult(n,-1,n),m.normalize(n,n),this.makeOrthoFromBoundingBox(e,n,l,o);u.copy(this._projectionMatrix,r.getProjectionMatrix()),u.copy(this._viewMatrix,r.getViewMatrix()),this.setShadowUniformsDepthValue()},frameShadowCastingFrustum:function(t){this._infiniteFrustum||(this.nearFarBounding(),u.clampProjectionMatrix(this._projectionMatrix,this._depthRange[0],this._depthRange[1],t.getNearFarRatio(),this._depthRange),this.setShadowUniformsDepthValue());var e=this._cameraShadow;u.copy(this._projectionMatrix,e.getProjectionMatrix()),u.copy(this._viewMatrix,e.getViewMatrix())},setShadowUniformsDepthValue:function(){this.nearFarBounding(),this._depthRange[2]=this._depthRange[1]-this._depthRange[0],this._depthRange[3]=1/this._depthRange[2];var t=this._casterStateSet.getUniformList();t.Shadow_DepthRange.getUniform().setVec4(this._depthRange),this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix),this._texture.setDepthRange(this._depthRange)},noDraw:function(){this._depthRange[0]=0,this._depthRange[1]=0,this._depthRange[2]=0,this._depthRange[3]=0;var t=this._casterStateSet.getUniformList();t.Shadow_DepthRange.getUniform().setVec4(this._depthRange),this._texture.setDepthRange(this._depthRange);var e=this._cameraShadow;u.copy(e.getProjectionMatrix(),this._projectionMatrix),u.copy(e.getViewMatrix(),this._viewMatrix),this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix),this._filledOnce=!0},cullShadowCasting:function(t){var e;if(this._removeNodesNeverCastingVisitor&&(this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask|this._castsShadowDrawTraversalMask)),this._removeNodesNeverCastingVisitor.reset(),this.getShadowedScene().accept(this._removeNodesNeverCastingVisitor)),this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),this._computeBoundsVisitor.reset(),this.getShadowedScene().accept(this._computeBoundsVisitor),e=this._computeBoundsVisitor.getBoundingBox(),!e.valid())return this.noDraw(),void(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore());var i=t.getCurrentModelWorldMatrix();if(u.transformBoundingBox(i,e,e),this._emptyCasterScene=!1,this.aimShadowCastingCamera(t,e),this._emptyCasterScene)return this.noDraw(),void(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore());var r=t.getTraversalMask();t.setTraversalMask(this._castsShadowDrawTraversalMask),t.pushStateSet(this._casterStateSet),this._cameraShadow.setEnableFrustumCulling(!0);var n=this._castsShadowDrawTraversalMask===this._castsShadowBoundsTraversalMask;this._cameraShadow.setComputeNearFar(n),this._cameraShadow.accept(t),n&&this.frameShadowCastingFrustum(t),this._cameraShadow.setComputeNearFar(!1),this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore(),t.popStateSet(),t.setTraversalMask(r),this._filledOnce=!0},cleanReceivingStateSet:function(){this._receivingStateset&&(this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember()),this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()))},cleanSceneGraph:function(){this._cameraShadow=void 0,this._filledOnce=!1,this.cleanReceivingStateSet(),this._texture=void 0,this._shadowedScene=void 0}}),"osgShadow","ShadowMap"),M.EPSILON=.005,g.setTypeID(M),t.exports=M},function(t,e,i){"use strict";var r=i(1105),n=i(1120),a=i(1134),s=i(1119),o=i(1109),u=function(t,e){n.call(this),this._lightNumber=t,this._algoType="NONE",this._bias=.001,this._exponent0=.001,this._exponent1=.001,this._epsilonVSM=.001,this._precision="UNSIGNED_BYTE",this._kernelSizePCF=void 0,this._fakePCF=!0,this._rotateOffset=!1,this._enable=!e};u.uniforms={},u.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ShadowReceive",cloneType:function(){return new u(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this.getLightNumber()},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){var e=this.getType()+this.getLightNumber().toString();return e+"_uniform_"+t},getRotateOffset:function(){return this._rotateOffset},setRotateOffset:function(t){this._rotateOffset=t},setAlgorithm:function(t){this._algoType=t},getAlgorithm:function(){return this._algoType},setBias:function(t){this._bias=t},getBias:function(){return this._bias},setExponent0:function(t){this._exponent0=t},getExponent0:function(){return this._exponent0},setExponent1:function(t){this._exponent1=t},getExponent1:function(){return this._exponent1},setEpsilonVSM:function(t){this._epsilonVSM=t},getEpsilonVSM:function(){return this._epsilonVSM},getKernelSizePCF:function(){return this._kernelSizePCF},setKernelSizePCF:function(t){this._kernelSizePCF=t},getFakePCF:function(){return this._fakePCF},setFakePCF:function(t){this._fakePCF=t},setPrecision:function(t){this._precision=t},getPrecision:function(){return this._precision},setLightNumber:function(t){this._lightNumber=t},getOrCreateUniforms:function(){var t=u,e=this.getTypeMember();if(t.uniforms[e])return t.uniforms[e];var i={bias:"createFloat",exponent0:"createFloat",exponent1:"createFloat",epsilonVSM:"createFloat"},r={};return window.Object.keys(i).forEach(function(t){var e=i[t],n=a[e];r[t]=n(this.getUniformName(t))}.bind(this)),t.uniforms[e]=new s(r),t.uniforms[e]},getExtensions:function(){var t=this.getAlgorithm();return"PCF"===t?["#extension GL_OES_standard_derivatives : enable"]:[]},getDefines:function(){var t=this.getPrecision(),e=this.getAlgorithm(),i=[],r=!1,n=!1;if("UNSIGNED_BYTE"!==t&&(r=!0),!r||"HALF_FLOAT_LINEAR"!==t&&"FLOAT_LINEAR"!==t||(n=!0),"ESM"===e)i.push("#define _ESM");else if("NONE"===e)i.push("#define _NONE");else if("PCF"===e){i.push("#define _PCF");var a=this.getKernelSizePCF();switch(this._fakePCF&&i.push("#define _FAKE_PCF 1"),a){case"4Poisson(16texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx4");break;case"8Poisson(32texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx9");break;case"16Poisson(64texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx16");break;case"25Poisson(100texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx25");break;case"32Poisson(128texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx32");break;case"1Band(1texFetch)":i.push("#define _NONE"),i.push("#define _PCFx1");break;case"4Band(4texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx4");break;case"9Band(9texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx9");break;case"16Band(16texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx16");break;case"4Tap(16texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx4");break;case"9Tap(36texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx9");break;case"16Tap(64texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx25");break;default:case"1Tap(4texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx1")}}else"VSM"===e?i.push("#define _VSM"):"EVSM"===e&&i.push("#define _EVSM");return r&&i.push("#define _FLOATTEX"),n&&i.push("#define _FLOATLINEAR"),this.getRotateOffset()&&i.push("#define _ROTATE_OFFSET"),i},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.bias.setFloat(this._bias),t.exponent0.setFloat(this._exponent0),t.exponent1.setFloat(this._exponent1),t.epsilonVSM.setFloat(this._epsilonVSM)}},isEnabled:function(){return this._enable},isEnable:function(){return o.log("ShadowAttribute.isEnable() is deprecated, use isEnabled() instead"),this.isEnabled()},getHash:function(){return this.getTypeMember()+"_"+this.getAlgorithm()+"_"+this.getKernelSizePCF()+"_"+this.getFakePCF()+"_"+this.getRotateOffset()}}),"osgShadow","ShadowReceiveAttribute"),r.setTypeID(u),t.exports=u},function(t,e,i){"use strict";var r=i(1109),n=i(1112),a=i(1105),s=function(){n.call(this),this._shadowedScene=void 0,this._dirty=!1,this._enabled=!0,this._filledOnce=!1};s.prototype=a.objectLibraryClass(a.objectInherit(n.prototype,{dirty:function(){this._dirty=!0},getShadowedScene:function(){return this._shadowedScene},setEnabled:function(t){this._enabled=t},isEnabled:function(){return this._enabled},getEnable:function(){return r.log("ShadowTechnique.getEnable() is deprecated, use isEnabled instead"),this.isEnabled()},setEnable:function(t){r.log("ShadowTechnique.setEnable() is deprecated, use setEnabled instead"),this.setEnabled(t)},isFilledOnce:function(){return this._filledOnce},requestRedraw:function(){this._filledOnce=!1},setShadowedScene:function(t){this._shadowedScene=t},init:function(){r.log("No ShadowTechnique activated: normal rendering activated")},valid:function(){return!1},updateShadowTechnique:function(){},cullShadowCasting:function(){},cleanSceneGraph:function(){r.log("No ShadowTechnique activated: normal rendering activated")}}),"osgShadow","ShadowTechnique"),a.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(1119),n=i(1109),a=i(1133),s=i(1134),o=i(1105),u=i(1124),h=function(){a.call(this),this._uniforms={},this._mapSize=u.create(),this._lightUnit=-1};h.uniforms={},h.prototype=o.objectLibraryClass(o.objectInherit(a.prototype,{cloneType:function(){return new h},setLightUnit:function(t){this._lightUnit=t},getLightUnit:function(){return this._lightUnit},getUniformName:function(t){var e="Shadow_"+this.getType()+this._lightUnit.toString();return e+"_uniform_"+t},getVaryingName:function(t){var e=this.getType()+this._lightUnit.toString();return e+"_varying_"+t},getOrCreateUniforms:function(t){var e=h;if(n.assert(void 0!==t),n.assert(-1!==this._lightUnit),void 0!==e.uniforms[t])return e.uniforms[t];var i={ViewMatrix:"createMat4",ProjectionMatrix:"createMat4",DepthRange:"createFloat4",MapSize:"createFloat4"},a={};window.Object.keys(i).forEach(function(t){var e=i[t],r=s[e];a[t]=r(this.getUniformName(t))}.bind(this));var o="Texture"+t,u=s.createInt1(t,o);return a[o]=u,e.uniforms[t]=new r(a),e.uniforms[t]},setViewMatrix:function(t){this._viewMatrix=t},setProjectionMatrix:function(t){this._projectionMatrix=t},setDepthRange:function(t){this._depthRange=t},setTextureSize:function(t,e){a.prototype.setTextureSize.call(this,t,e),this.dirty(),this._mapSize[0]=t,this._mapSize[1]=e,this._mapSize[2]=1/t,this._mapSize[3]=1/e},apply:function(t,e){if(a.prototype.apply.call(this,t,e),-1!==this._lightUnit){var i=this.getOrCreateUniforms(e);i.ViewMatrix.setMatrix4(this._viewMatrix),i.ProjectionMatrix.setMatrix4(this._projectionMatrix),i.DepthRange.setFloat4(this._depthRange),i.MapSize.setFloat4(this._mapSize)}},getHash:function(){return this.getTypeMember()+"_"+this._lightUnit+"_"+this._type}}),"osgShadow","ShadowTexture"),o.setTypeID(h),t.exports=h},function(t,e,i){"use strict";var r=i(1105),n=i(1133),a=["1Band(1texFetch)","4Band(4texFetch)","9Band(9texFetch)","16Band(16texFetch)","1Tap(4texFetch)","4Tap(16texFetch)","9Tap(36texFetch)","16Tap(64texFetch)","4Poisson(16texFetch)","8Poisson(32texFetch)","16Poisson(64texFetch)","25Poisson(100texFetch)","32Poisson(128texFetch)"],s=function(t){this.castsShadowDrawTraversalMask=4294967295,this.castsShadowBoundsTraversalMask=4294967295,this.textureSize=1024,this.textureType="UNSIGNED_BYTE",this.textureFormat=n.RGBA,this.shadowProjection="fov",this.fov=50,this.kernelSizePCF="4Band(4texFetch)",this._fakePCF=!1,this._rotateOffset=!1,this.superSample=0,this.blur=!1,this.blurKernelSize=4,this.blurTextureSize=256,this.epsilonVSM=8e-4,this.bias=.005,this.algorithm="PCF",this.exponent=40,this.exponent1=10,this.shadowCastShaderGeneratorName="ShadowCast",r.objectMix(this,t)};s.kernelSizeList=a,s.prototype={setCastsShadowDrawTraversalMask:function(t){this.castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this.castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this.castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this.castsShadowBoundsTraversalMask},setLight:function(t){this.light=t},getLight:function(){return this.light},setTextureSize:function(t){this.textureSize=t},getTextureSize:function(){return this.textureSize},setTextureType:function(t){this.textureType=t},getTextureType:function(){return this.textureType},setTextureFormat:function(t){this.textureFormat=t},getTextureFormat:function(){return this.textureFormat},setAlgorithm:function(t){this.algorithm=t},getAlgorithm:function(){return this.algorithm},setShadowCastShaderGeneratorName:function(t){this.shadowCastShaderGeneratorName=t},getShadowCastShaderGeneratorName:function(){return this.shadowCastShaderGeneratorName}},t.exports=s},function(t,e,i){"use strict";var r=i(1161),n=i(1122),a=i(1111),s=i(1121),o=i(1118),u=i(1105),h=i(1124),l=function(){a.call(this),this._shadowTechniques=[],this._optimizedFrustum=!1,this._frustumReceivers=[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()],this._tmpMat=n.create(),this._receivingStateset=new o};l.prototype=u.objectLibraryClass(u.objectInherit(a.prototype,{getReceivingStateSet:function(){return this._receivingStateset},getShadowTechniques:function(){return this._shadowTechniques},addShadowTechnique:function(t){this._shadowTechniques.length>0&&-1!==this._shadowTechniques.indexOf(t)||(this._shadowTechniques.push(t),t.valid()&&(t.setShadowedScene(this),t.dirty()))},removeShadowTechnique:function(t){if(this._shadowTechniques.length>0){var e=this._shadowTechniques.indexOf(t);-1!==e&&(this._shadowTechniques[e].valid()&&this._shadowTechniques[e].cleanSceneGraph(),this._shadowTechniques.splice(e,1))}},cleanSceneGraph:function(){for(var t=0,e=this._shadowTechniques.length;e>t;t++)this._shadowTechniques[t]&&this._shadowTechniques[t].valid()&&this._shadowTechniques[t].cleanSceneGraph()},dirty:function(){for(var t=0;t<this._shadowTechniques.length;t++)this._shadowTechniques[t].dirty()},nodeTraverse:function(t){a.prototype.traverse.call(this,t)},traverse:function(t){if(t.getVisitorType()===s.CULL_VISITOR){var e,i,r=this._shadowTechniques.length;for(r&&t.pushStateSet(this._receivingStateset),this.nodeTraverse(t),r&&t.popStateSet(),e=0;r>e;e++)i=this._shadowTechniques[e],i&&i.valid()&&(i.isDirty()&&i.init(),(i.isEnabled()||!i.isFilledOnce())&&(i.updateShadowTechnique(t),i.cullShadowCasting(t)))}else this.nodeTraverse(t)}}),"osgShadow","ShadowedScene"),u.setTypeID(l),r.prototype[l.typeID]=r.prototype[a.typeID],t.exports=l},function(t,e,i){"use strict";var r=i(1227),n={};n.Text=r,t.exports=n},function(t,e,i){"use strict";var r=i(1224),n=i(1225),a=i(1226),s={};s.osg=r,s.osgAnimation=n,s.osgText=a,t.exports=s},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(1336),s=i(1337),o=i(1338),u=i(1339),h=n.osg,fif(n),l=function(){},c=function(t,e,i){i?h.error("ResourceLoader: "+t+" failed "+e+" error "+i):h.error("ResourceLoader: "+t+" failed "+e)},d=function(){this._nbThreads=5,this._processing=[],this._queue=[],this._finished=[],this._running=!1};d.prototype={checkResource:function(t){var e;return[this._processing,this._queue,this._finished].forEach(function(i){e||(e=r.find(i,function(e){return e._url===t}))}),e},run:function(){this._running=!0,this.runPendingProcess()},runPendingProcess:function(){for(;this._processing.length<this._nbThreads&&this._queue.length>0;){var t=this._queue.shift();this._processing.push(t),t.start()}},queue:function(t){var e=t;t.start||(console.log(t.url),e=new a(t.url,t.response)),this._queue.push(e);var i=function(){this._processing.splice(this._processing.indexOf(e),1),this._finished.push(e),this.runPendingProcess()}.bind(this),r=function(){this._processing.splice(this._processing.indexOf(e),1),this.runPendingProcess()}.bind(this);return e.getPromise().then(i)["catch"](r).done(),this._running&&this.runPendingProcess(),e},getModel:function(t,e){var i=this.checkResource(t);return i?i:(i=this.queue(new s(t,"text",e)),i.getPromise().then(function(){l(t,"model")})["catch"](function(e){c(t,"model",e)}).done(),i)},getImage:function(t,e){var i=this.checkResource(t);if(i)return i;var r=e||{},n="data:image"===t.substr(0,"data:image".length);return n||(r.crossOrigin="anonymous"),i=this.queue(new o(t,r)),i.getPromise().then(function(){l(t,"image")})["catch"](function(){c(t,"image")}).done(),i},getBinaryArray:function(t,e){var i=this.checkResource(t);return i?i:(i=this.queue(new u(t,e)),i.getPromise().then(function(){l(t,"binary array")})["catch"](function(e){c(t,"binary array",e)}).done(),i)}},t.exports=d},function(t,e,i){"use strict";var r=i(236),n=function(t,e,i){this._url=t,this._defer=r.defer(),this._responseType=e,this._promise=this._defer.promise,this._options=i};n.prototype={getPromise:function(){return this._promise},getURL:function(){return this._url},start:function(){this._xhr=new XMLHttpRequest,this._xhr.addEventListener("error",this.error.bind(this),!1),this._xhr.addEventListener("abort",this.abort.bind(this),!1),this._xhr.addEventListener("progress",this.progress.bind(this),!1),this._xhr.addEventListener("load",function(t){return 200!==this._xhr.status?(console.log("Error not loaded "+this._url),void this.error(t)):(this._xhr.response||(this._xhr.response=this._xhr.responseText),void this.load.call(this))}.bind(this),!1),this._xhr.open("GET",this._url,!0),this._xhr.responseType=this._responseType,this._xhr.send(null)},error:function(){console.log("Error not loaded "+this._url),this._defer.reject(this)},abort:function(){console.log("Error not loaded "+this._url),this._defer.reject(this)},progress:function(t){var e=this._options;e&&e.progress&&e.size&&e.progress(t.loaded/e.size,e.secondary,e.idChannel)},load:function(){this._defer.resolve(this)},getXHR:function(){return this._xhr}},t.exports=n},function(t,e,i){"use strict";var r=i(219),n=i(1336),a=function(){n.apply(this,arguments)};a.prototype=r.extend({},n.prototype,{load:function(){this._model=this._xhr.response,this._defer.resolve(this._model)},getModel:function(){return this._model}}),t.exports=a},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(1336),s=n.osg,fif(n),o=function(t,e){a.call(this,t,"blob",e),this._responseType="arraybuffer"};o.prototype=r.extend({},a.prototype,{isVideo:function(t){var e=t.split("."),i=e[e.length-1].toLowerCase();return"ogv"===i||"ogg"===i||"mp4"===i||"avi"===i||"webm"===i?!0:!1},createVideo:function(){var t=document.createElement("video");return document.body.appendChild(t),t.style.display="none",t},start:function(){var t=this.getURL();if(this.isVideo(t)){var e=this.createVideo();this._image=new s.ImageStream(e),window.video=this._image,e.preload="auto",e.crossOrigin="anonymous",e.src=t,this._image.whenReady().then(function(t){t.play(),this._defer.resolve(this._image)}.bind(this))}else{this._image=new s.Image;var i=this._options;i.panoramaLUV||i.integrateBRDFLUV||i.cubemapLUV?a.prototype.start.call(this):this.loadImage()}},load:function(){var t=this._options;t.panoramaLUV||t.integrateBRDFLUV?this.loadLUV():t.cubemapLUV&&this.loadCubemapLUV()},loadImage:function(){var t=new Image;this._options.crossOrigin&&(t.crossOrigin=this._options.crossOrigin),this._image.setImage(t),t.onload=function(){this._defer.resolve(this._image)}.bind(this),t.onerror=function(){this._defer.reject(this._image)}.bind(this),this._imgHtmlTag=t,t.src=this._url},abortImage:function(){this._imgHtmlTag&&(this._imgHtmlTag.src="")},loadLUV:function(){var t,e=this._xhr.response,i=Math.sqrt(e.byteLength/4);t=this._options.integrateBRDFLUV?new Uint8Array(e):this.deinterleaveImage4(i,new Uint8Array(e),new Uint8Array(e.byteLength));var r=this._image;r.setImage(t),r.setWidth(i),r.setHeight(i),this._defer.resolve(this._image)},loadCubemapLUV:function(){for(var t=this._xhr.response,e=Math.log(this._options.size)/Math.LN2,i=0,r={},n=0;e>=n&&!(i>=t.byteLength);n++)for(var a=Math.pow(2,e-n),o=0;6>o;o++){r[s.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o]||(r[s.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o]=[]);var u=a*a*4,h=new Uint8Array(u);this.deinterleaveImage4(a,new Uint8Array(t,i,u),h);var l=new s.Image;l.setImage(h),l.setWidth(a),l.setHeight(a),r[s.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o].push(l),i+=u}this._defer.resolve(r)},deinterleaveImage4:function(t,e,i){for(var r=t*t,n=2*t*t,a=3*t*t,s=0,o=0;r>o;o++)i[s++]=e[o],i[s++]=e[o+r],i[s++]=e[o+n],i[s++]=e[o+a];return i},getImage:function(){return this._image}}),t.exports=o},function(t,e,i){"use strict";var r=i(219),n=i(1336),a=function(t,e){n.call(this,t,"arraybuffer",e)};a.prototype=r.extend({},n.prototype,{load:function(){var t=this.getXHR().response;this._defer.resolve(t)}}),t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1341),a=n().anisotropy,s=r.osg,fif(r),o=["magFilter","minFilter","wrapS","wrapT","textureWidth","textureHeight","textureTarget","internalFormat"],u={getValidOptions:function(){return o},getOptions:function(t){var e={};return e.minFilter=t.getMinFilter(),e.magFilter=t.getMagFilter(),e.wrapT=t.getWrapT(),e.wrapS=t.getWrapS(),e.textureWidth=t.getWidth(),e.textureHeight=t.getHeight(),e.textureTarget=t.getTextureTarget(),e.internalFormat=t._internalFormat,e.imageFormat=t._imageFormat,e},setOptions:function(t,e){e.setMinFilter(t.minFilter),e.setMagFilter(t.magFilter),e.setWrapT(t.wrapT),e.setWrapS(t.wrapS),t.minFilter===s.Texture.LINEAR_MIPMAP_LINEAR&&a&&e.setMaxAnisotropy(16),e.setInternalFormat(t.internalFormat)},createValidOptionsForMaterial:function(t){var e=u.createValidOptions(t);return e.minFilter===s.Texture.NEAREST_MIPMAP_LINEAR?(e.magFilter=s.Texture.NEAREST,e):e.minFilter===s.Texture.LINEAR_MIPMAP_LINEAR||e.minFilter===s.Texture.LINEAR?(e.magFilter=s.Texture.LINEAR,e):e.minFilter===s.Texture.NEAREST?(e.magFilter=s.Texture.NEAREST,e):e.magFilter===s.Texture.LINEAR?(e.minFilter=s.Texture.LINEAR_MIPMAP_LINEAR,e):(e.magFilter=s.Texture.NEAREST,e.minFilter=s.Texture.NEAREST,e)},createValidOptions:function(t){t||(t={});for(var e=o.length,i=0;e>i;++i){var r=o[i];"string"==typeof t[r]&&(t[r]=s.Texture[t[r]])}return t.magFilter||(t.magFilter=s.Texture.LINEAR),t.minFilter||(t.minFilter=s.Texture.LINEAR_MIPMAP_LINEAR),t.wrapS||(t.wrapS=s.Texture.REPEAT),t.wrapT||(t.wrapT=s.Texture.REPEAT),t.textureWidth||(t.textureWidth=0),t.textureHeight||(t.textureHeight=0),t.textureTarget||(t.textureTarget=s.Texture.TEXTURE_2D),t.internalFormat||(t.internalFormat=s.Texture.RGBA),t}};t.exports=u},function(t,e,i){"use strict";var r,n=i(240),a=i(1342),s=function(t,e){var i=n.string(t);if(!i)return e;if(i=i.split(","),i.length<3)return e;i.length=3;for(var r=0;3>r;++r)i[r]=parseFloat(i[r]);return i},o=function(){return r?r:(r={},r.transparent=n.bool("transparent",!1),r.camera=n.bool("camera",!0),r.navigation=n.string("navigation","orbit"),r.fpsSpeed=n.number("fps_speed",5),r.preload=n.bool("preload"),r.autospin=n.number("autospin",0),r.blending=n.number("blending"),r.cardboard=n.number("cardboard",0),r.cardboard&&(r.camera=!1),r.scrollwheel=n.bool("scrollwheel",!0),r.annotationCycleAutostart=n.bool("annotation_cycle",!1),r.annotationCycleDuration=1e3*n.number("annotation_cycle",5),r.annotation=n.number("annotation",0),r.annotationsVisible=n.bool("annotations_visible",!0),r.preserveDrawingBuffer=n.bool("preserve_drawing_buffer",!1),r.process_material=n.bool("process_material",!1),r.hook_prod=n.bool("hook_prod",!1),r.hook_beta=n.bool("hook_beta",!1),r.hook_staging=n.bool("hook_staging",!1),r.hook_processingvm1=n.bool("hook_processingvm1",!1),r.desc_button=n.number("desc_button"),r.stop_button=n.number("stop_button"),r.debug3d=n.bool("debug3d",!1),r.continuousRender=n.bool("continuous_render",!1),r.messaging=n.bool("messaging"),r.isApp=n.bool("is_app"),r.mobile=n.bool("mobile"),r.maxTextureSize=n.number("max_texture_size"),r.anisotropy=n.bool("anisotropy",!0),r.panorama=n.bool("panorama",!1),r.shadowTextureSize=n.number("shadow_texture_size"),r.shadowPCF=n.string("shadowPCF","1Tap(4texFetch)"),r.supersample=n.bool("supersample",!0),r.motionBlur=n.bool("motion_blur",!1),r.motionBlurCount=n.number("motion_blur_count",1.8),r.cameraShadows=n.bool("camera_shadows",!0),r.pixelBudget=n.number("pixel_budget"),r.animationAutoplay=n.bool("animation_autoplay"),r.imageCompression=n.bool("image_compression",!0),r.postProcess=n.bool("post_process",!0),r.showBones=n.number("show_bones",0),r.cameraFollowBones=n.number("camera_follow_bones",0),r.cameraEasing=n.number("camera_easing"),r.cameraEye=s("camera_eye"),r.cameraTarget=s("camera_target"),r.grainSpeed=n.number("grain_speed",64),r.downloadPicture=n.bool("download_picture",!1),r.vrMenu=n.bool("vr_menu",!1),r.vrLauncherAlphaCardFactor=n.number("vr_launcher_alpha_card_factor",1),r.useVAO=n.bool("use_vao",!1),r.dofRes=n.number("dof_res",2),r.graphOptimizer=n.number("graph_optimizer",0),r.materialNames=n.string("material_names","main_material"),r.materialEmissive=n.string("material_emissive"),r.materialTransparency=n.string("material_transparency"),r.materialNormal=n.string("material_normal"),r.materialAO=n.string("material_ao"),r.materialDiffuse=n.string("material_diffuse"),r.materialMetalness=n.string("material_metalness"),r.materialRoughness=n.string("material_roughness"),r.materialGlossiness=n.string("material_glossiness"),r.materialSpecular=n.string("material_specular"),r.materialCavity=n.string("material_cavity"),r.materialF0=n.string("material_f0"),a(r),r)};t.exports=o},function(t,e){"use strict";var i=function(t){var e=t||{};if(!window.location||!window.location.hash)return e;var i=window.location.hash.substr(1).split(",");return i.forEach(function(t){if(t.match("material_")){var i=t.split("="),r=i[0],n=i[1];"material_names"===r&&(e.materialNames=n),"material_normal"===r&&(e.materialNormal=n),"material_emissive"===r&&(e.materialEmissive=n),"material_transparency"===r&&(e.materialTransparency=n),"material_diffuse"===r&&(e.materialDiffuse=n),"material_metalness"===r&&(e.materialMetalness=n),"material_roughness"===r&&(e.materialRoughness=n),"material_glossiness"===r&&(e.materialGlossiness=n),"material_specular"===r&&(e.materialSpecular=n),"material_cavity"===r&&(e.materialCavity=n),"material_f0"===r&&(e.materialF0=n),"material_ao"===r&&(e.materialAO=n)}}),e};t.exports=i},247,function(t,e,i){"use strict";var r=i(219),n=i(1345),a=i(248),s=i(240);t.exports=a.extend({model:n,url:function(){var t=this.options.filters.get("modelUID")?"/i/models/"+this.options.filters.get("modelUID")+"/textures":"/i/textures";return t+s.craft("?",{offset:this.options.offset})},isValid:function(){this.each(function(t){t.isValid()})},addNewImage:function(t){var e=t.id||r.uniqueId(),i=new n({images:[{
uid:e,url:t.url,width:t.width,height:t.height}],uid:"tmp_"+e,id:e,name:t.name||"newImage"});return this.add(i),i},getImageFromURL:function(t){var e=t.split("/").pop();return this.find(function(t){var i=!1;return t.get("images").forEach(function(t){i||-1!==t.url.indexOf(e)&&(i=!0)}),i})}})},function(t,e,i){"use strict";var r=i(236),n=i(224),a=i(239),s=i(1346),o="/i/textures";t.exports=a.extend({url:function(){return this.isNew()?o:o+"/"+this.get("uid")},isValid:function(){var t=this.get("name");return void 0===t&&console.warn("no name for Texture "+this.id),t=t||this.id,void 0===this.get("images")&&console.warn("no images for Texture "+t),void 0===this.get("uid")&&console.warn("no uid for Texture "+t),!0},getName:function(){return this.get("name")},save:function(t,e){(null==t||"object"==typeof t)&&(e=t);var i=new FormData;return i.append("imageFile",this.get("imageFile"),this.get("name")),i.append("colorSpace",this.get("colorSpace")),i.append("modelUid",e.modelUID),r.resolve(n.ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"}))},saveColorspace:function(){return r.resolve(n.ajax({url:this.url(),data:{colorSpace:this.get("colorSpace")},type:"PATCH"}))}}).extend(s)},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(1093),s=i(1341),o=n.osg,fif(n),u=function(t,e,i,r){var n=i-t,a=r-e;return n*n+a*a},h=function(t){return 0===(t&t-1)},l=function(t){return h(t.width)&&h(t.height)},c={getUID:function(){return this.get("uid")},getImages:function(){return this.get("images")},getURL:function(){console.error("dont call ImageProxy.getURL")},findFormat:function(t){return r.filter(this.get("images"),function(e){return!e.options||e.options.format===t})},getFilteredImages:function(t){if(!t||a()||!s().imageCompression)return this.findFormat();var e;switch(t){case o.Texture.ALPHA:if(e=this.findFormat("A"),e.length>0)return e;break;case o.Texture.RGB:if(e=this.findFormat("RGB"),e.length>0)return e;if(e=this.findFormat("N"),e.length>0)return e;break;case o.Texture.LUMINANCE:if(e=this.findFormat("R"),e.length>0)return e;if(e=this.findFormat("RGB"),e.length>0)return e;if(e=this.findFormat("N"),e.length>0)return e}return this.findFormat()},findImageNearestPowerOfTwoUpToResolution:function(t,e,i){return this.findImageNearestUpToResolution(t,e,!0,i)},findImageNearestUpToResolution:function(t,e,i,r){for(var n,a,s=1/0,o=!1,h=1/0,c=this.getFilteredImages(r),d=0,p=c.length;p>d;++d){var f=c[d],g=u(t,e,f.width,f.height);if(s>g&&(s=g,n=f),!(f.width>t||f.height>e))if(i){var m=l(f);(!o||m)&&(!a||!o&&m||h>g||h===1/0&&f.width>a.width&&f.height>a.height)&&(a=f,o=m,h=g)}else(!a||h>g||h===1/0&&f.width>a.width&&f.height>a.height)&&(a=f,h=g)}return a?a:n},findImageSmallest:function(t){return this.findImageNearestToResolution(0,0,t)},findImageWidget:function(){return this.findImageNearestToResolution(0,0,o.Texture.RGB)},findImageNearestToResolution:function(t,e,i){for(var r,n=1/0,a=this.getFilteredImages(i),s=0,o=a.length;o>s;++s){var h=a[s],l=u(t,e,h.width,h.height);n>l&&(n=l,r=h)}return r}};t.exports=c},function(t,e,i){"use strict";var r=i(239);t.exports=r.extend({})},function(t,e,i){"use strict";var r=i(236),n=i(1100),a=i(1349),s=i(1350),o=i(1351),u=i(1352),h=i(1353),l=i(1354),c=i(1355),d=n.osg,fif(n),p="vtx_",f="uv_",g="_mode",m="attributes",v="vertex_mode",_="triangle_mode",b={Vertex:1,Normal:2,TexCoord:4,Color:8,Triangle:16,Tangent:32},x={quantization:1,prediction:2,delta:4},A={delta:1,highWatermark:2,implicit:4},y=function(t){return-1!==t.indexOf("TexCoord")?b.TexCoord:b[t]},S=function(t,e,i,r){var n,a=t.vb,u=a.Offset?a.Offset:0,h=this.getIndices();n=a.Encoding&&"varint"===a.Encoding?l(new Uint8Array(r,u),h.getItemSize()*a.Size,t.type):new d[t.type](r,u,h.getItemSize()*a.Size),1===n.BYTES_PER_ELEMENT&&(n=new Uint16Array(n));var p=e[m],f=y("Triangle"),g=n,v=this.getMode()===d.PrimitiveSet.TRIANGLE_STRIP;if(0===(p&f)||!v&&this.getMode()!==d.PrimitiveSet.TRIANGLES)return n instanceof Uint16Array==!1&&(g=new Uint16Array(n.buffer,n.byteOffset,n.length),g.set(n)),h.setElements(g),this.setIndices(h),this;var b=e[_],x=0;if(b&A.implicit&&v&&(x=o.IMPLICIT_HEADER_LENGTH+n[o.IMPLICIT_HEADER_MASK_LENGTH],g=new Uint16Array(n[o.IMPLICIT_HEADER_PRIMITIVE_LENGTH])),b&A.delta&&s(n,x),b&A.implicit&&v&&o(n,g,x,b&A.highWatermark),b&A.highWatermark&&c(g,g,i),g instanceof Uint16Array==!1){var S=g;g=new Uint16Array(S.buffer,S.byteOffset,S.length),g.set(S)}return h.setElements(g),this.setIndices(h),this},C=d.Vec3.create(),w=d.Vec3.create(),T=function(t,e,i,r,n){var a="Vertex"===r?p:f+r.substr(8)+"_",s=t&x.quantization&&void 0!==n[a+"bbl_x"],o=e instanceof Float32Array==!0;if(!s&&o)return e;var u=4===e.BYTES_PER_ELEMENT?new Float32Array(e.buffer,e.byteOffset,e.length):new Float32Array(e.length);return s?(C[0]=n[a+"bbl_x"],C[1]=n[a+"bbl_y"],w[0]=n[a+"h_x"],w[1]=n[a+"h_y"],3===i&&(C[2]=n[a+"bbl_z"],w[2]=n[a+"h_z"]),h(e,u,C,w,i)):(u.set(e),u)},M=function(t,e,i,r,n,s){var o,h=t.vb,c=this.getItemSize(),p=h.Size,_=h.Offset?h.Offset:0;o=h.Encoding&&"varint"===h.Encoding?l(new Uint8Array(s,_),c*p,t.type):new d[t.type](s,_,c*p);var b=i[m],A=y(e);if(0===(b&A))return this.setElements(o),this;if("Normal"===e)return this.setElements(a(o,new Float32Array(3*p),3,i.epsilon,i.nphi)),this.setItemSize(3),this;if("Tangent"===e)return this.setElements(a(o,new Float32Array(4*p),4,i.epsilon,i.nphi)),this.setItemSize(4),this;var S=null;if("Vertex"===e)S=i[v];else if(-1!==e.indexOf("TexCoord")){var C=f+e.substr(8)+g;S=void 0!==i[C]?i[C]:i[v]}return S&x.prediction&&void 0!==n?r.then(function(){return u(o,c,n.getElements()),this.setElements(T(S,o,c,e,i)),this}.bind(this)):(this.setElements(T(S,o,c,e,i)),this)},E=function(t,e,i){d.NodeVisitor.call(this),this._resourceLoader=t,this._options=e,this._promises=i,this._wireframesPromises=[]};E.prototype=d.objectInherit(d.NodeVisitor.prototype,{apply:function(t){if(t instanceof d.Geometry==!1)return this.traverse(t);var e=this._options,i=e.wireframeOptions;if(i&&1===t.userDataMap.wireframe){t.setNodeMask(0);var n=r.defer();this._wireframesPromises.push(n.promise);var a=this;i.startPromise.then(function(){a.processGeometry(t,i).then(function(){i.nodes.push(t),n.resolve()})})}else this._promises.push(this.processGeometry(t,e))},processGeometry:function(t,e){var i,n,a=t.userDataMap,s=0,o=this._options,u=this._resourceLoader,h=o.prefixURL,l=o.bufferMap,c=[],p=t.getPrimitiveSetList(),f=p.length,g=[0];for(s=0;f>s;++s){var m=p[s];if(!(m instanceof d.DrawArrays||m instanceof d.DrawArrayLengths)){var v=m.getIndices();v.getInitialBufferArray&&(v=v.getInitialBufferArray());var _=l[v.getInstanceID()];if(_.visited!==!0)if(_.visited=!0,_.inlined)v.setElements(new Uint16Array(_.inlined)),m.setCount(v.getElements().length);else{var b=u.getBinaryArray(h+_.vb.File,e).getPromise();c.push(b),b.then(S.bind(m,_,a,g)),m.getMode()===d.PrimitiveSet.TRIANGLE_STRIP&&(n=b,i=v)}}}var x=t.getVertexAttributeList(),A=Object.keys(x);A.sort();var y=A.length;for(s=0;y>s;++s){var C=A[s],w=x[C];w.getInitialBufferArray&&(w=w.getInitialBufferArray());var T=l[w.getInstanceID()];if(T.visited!==!0)if(T.visited=!0,T.inlined)w.setElements(new Float32Array(T.inlined));else{var E=a,k=C.indexOf("_");if(-1!==k){var I=C.slice(k+1);E=a["morph_"+I],C=C.slice(0,k)}var N=u.getBinaryArray(h+T.vb.File,e).getPromise(),R=N.then(M.bind(w,T,C,E,n,i));c.push(R)}}return r.all(c)}});var k={};k.postParse=function(t,e,i){var n=[],a=new E(e,i,n);t.accept(a);var s=i.wireframeOptions;if(s){var o=s.deferDownload;r.all(a._wireframesPromises).then(o.resolve.bind(o))}return r.all(n)},t.exports=k},function(t,e){"use strict";var i=1.57079632679,r=6.28318530718,n=3.14159265359,a=.01745329251,s=.25,o=720,u=832,h=47938362584151635e-21,l={},c=function(t,e,c,d,p,f){d=d||s,p=p||o;var g=Math.cos(d*a),m=0,v=0,_=l.table;if(void 0===_)for(v=(p+1)*(u+1)*3,_=l.table=new Float32Array(v),m=0;v>m;++m)_[m]=1/0;var b=n/(p-1),x=i/(p-1),A=f?3:2;for(m=0,v=t.length/A;v>m;++m){var y=m*c,S=m*A,C=t[S],w=t[S+1];4!==c||f||(e[y+3]=1024&C?-1:1,C&=-1025);var T,M,E,k=3*(C+p*w);if(T=_[k],T===1/0){var I=C*b,N=Math.cos(I),R=Math.sin(I);I+=x;var F=(g-N*Math.cos(I))/Math.max(1e-5,R*Math.sin(I));F>1?F=1:-1>F&&(F=-1);var P=w*r/Math.ceil(n/Math.max(1e-5,Math.acos(F)));T=_[k]=R*Math.cos(P),M=_[k+1]=R*Math.sin(P),E=_[k+2]=N}else M=_[k+1],E=_[k+2];if(f){var D=t[S+2]*h,L=Math.sin(D);e[y]=L*T,e[y+1]=L*M,e[y+2]=L*E,e[y+3]=Math.cos(D)}else e[y]=T,e[y+1]=M,e[y+2]=E}return e};t.exports=c},function(t,e){"use strict";var i=function(t,e){for(var i=e||0,r=t.length,n=t[i],a=i+1;r>a;++a){var s=t[a];n=t[a]=n+(s>>1^-(1&s))}return t};t.exports=i},function(t,e){"use strict";var i=function(t,e,r,n){for(var a=t[i.IMPLICIT_HEADER_EXPECTED_INDEX],s=t[i.IMPLICIT_HEADER_MASK_LENGTH],o=new Uint32Array(t.subarray(i.IMPLICIT_HEADER_LENGTH,s+i.IMPLICIT_HEADER_LENGTH)),u=32*s-e.length,h=1<<31,l=0;s>l;++l)for(var c=o[l],d=32,p=l*d,f=l===s-1?u:0,g=f;d>g;++g,++p)c&h>>>g?e[p]=t[r++]:e[p]=n?a:a++;return e};i.IMPLICIT_HEADER_PRIMITIVE_LENGTH=0,i.IMPLICIT_HEADER_MASK_LENGTH=1,i.IMPLICIT_HEADER_EXPECTED_INDEX=2,i.IMPLICIT_HEADER_LENGTH=3,t.exports=i},function(t,e){"use strict";var i=function(t,e,i){var r=t.length/e,n=new Uint8Array(r),a=i.length-1;n[i[0]]=1,n[i[1]]=1,n[i[2]]=1;for(var s=2;a>s;++s){var o=s-2,u=i[o],h=i[o+1],l=i[o+2],c=i[o+3];if(1!==n[c]){n[c]=1,u*=e,h*=e,l*=e,c*=e;for(var d=0;e>d;++d)t[c+d]=t[c+d]+t[h+d]+t[l+d]-t[u+d]}}return t};t.exports=i},function(t,e){"use strict";var i=function(t,e,i,r,n){for(var a=t.length/n,s=0;a>s;++s)for(var o=s*n,u=0;n>u;++u)e[o+u]=i[u]+t[o+u]*r[u];return e};t.exports=i},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=function(t,e,i){for(var r=new n[i](e),a=0,s=0;a!==e;){var o=0,u=0;do o|=(127&t[s])<<u,u+=7;while(0!==(128&t[s++]));r[a++]=o}if("U"!==i[0])for(var h=0;e>h;++h){var l=r[h];r[h]=l>>1^-(1&l)}return r};t.exports=a},function(t,e){"use strict";var i=function(t,e,i){for(var r=i[0],n=t.length,a=0;n>a;++a){var s=r-t[a];e[a]=s,s>=r&&(r=s+1)}return i[0]=r,e};t.exports=i},function(t,e,i){"use strict";var r=i(1100),n=i(1357),a=i(1358),s=r.osg,fif(r),o=r.osgDB,u=r.osgAnimation,h={},l={wireframe:!0,epsilon:!0,nphi:!0,attributes:!0,vertex_mode:!0,triangle_mode:!0,rigIndex:!0,framerate:!0,bx:!0,by:!0,bz:!0,hx:!0,hy:!0,hz:!0,ox:!0,oy:!0,oz:!0,ow:!0,ot:!0,channel_mode:!0};h.convertUserDataToObject=function(t,e){var i=e||{};if(!t)return i;for(var r=0,n=t.length;n>r;++r){var a=t[r],s=a.Name;l[s]||-1!==s.indexOf("_bbl_")||-1!==s.indexOf("_h_")||-1!==s.indexOf("_mode")?i[s]=JSON.parse(a.Value):i[s]=a.Value}return i},h.UserDataSetVisitor=function(){s.NodeVisitor.call(this),this._uidGeometryMap={}},h.UserDataSetVisitor.prototype=s.objectInherit(s.NodeVisitor.prototype,{apply:function(t){var e=t instanceof s.Geometry;if(e&&void 0!==t._uniqueID&&(this._uidGeometryMap[t._uniqueID]=t),e&&!a.hasVertexColor&&(a.hasVertexColor=!!t.getVertexAttributeList().Color),e||t instanceof u.Bone){var i=t.userDataMap=h.convertUserDataToObject(t.getUserData()),r=t;if(t.getSourceGeometry&&(r=t.getSourceGeometry(),h.convertUserDataToObject(r.getUserData(),i)),r instanceof u.MorphGeometry)for(var n=r.getMorphTargets(),o=0,l=n.length;l>o;++o){var c=i["morph_"+o]={};h.convertUserDataToObject(n[o].getUserData(),c)}}return this.traverse(t)}}),h.parse=function(t,e){n.OSG_VERSION=t.Version;var i=o.parseSceneGraph(t,e);return i.then(function(t){var e=new h.UserDataSetVisitor;return t.accept(e),t._uidGeometryMap=e._uidGeometryMap,t})},t.exports=h},function(t,e,i){"use strict";var r=i(1100),n=i(236),a=r.osg,fif(r),s=r.osgAnimation,o={},u=n.defer();o.getPromise=function(){return u.promise},o.resolvePromise=function(t){u.promise.isFulfilled()===!1&&u.resolve(t)},o.OSG_VERSION=-1,o.checkPathIsAnimated=function(t){for(var e=0,i=t.length;i>e;++e){var r,n=t[e];if(n instanceof s.Bone)r=s.UpdateBone;else{if(!(n instanceof a.MatrixTransform))continue;r=s.UpdateMatrixTransform}for(var o=n.getUpdateCallbackList(),u=0,h=o.length;h>u;++u)if(o[u]instanceof r)return!0}return!1},t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=function(){n.StateAttribute.call(this),this._diffuseColor=n.Vec3.create(),this._diffuseIntensity=n.Vec3.createAndSet(1,1,1),this._specularColor=n.Vec3.create(),this._specularIntensity=1,this._emitColor=n.Vec3.create(),this._opacity=1,this._specularHardness=12.5,this._reflection=0,this._shadeless=!1,this._cullFace=n.CullFace.DISABLE,this._additive=!1,this._opaqueEarlyZ=!0};a.hasVertexColor=!1,a.VertexColorEnable=!0,a.VertexColorColorSpace="linear",a.prototype=n.objectLibraryClass(n.objectInherit(n.StateAttribute.prototype,{attributeType:"SketchfabMaterial",getHash:function(){return a.VertexColorEnable+a.VertexColorColorSpace+(this.attributeType||0)+(this._diffuseShader||0)+(this._specularShader||0)+this._shadeless.toString()},cloneType:function(){return new a},getShadeless:function(){return this._shadeless},setShadeless:function(t){this._shadeless=t},getReflection:function(){return this._reflection},setReflection:function(t){this._reflection=t},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getVertexColorEnable:function(){return a.VertexColorEnable},getVertexColorColorSpace:function(){return a.VertexColorColorSpace},setCullFace:function(t){this._cullFace=t},getCullFace:function(){return this._cullFace},setAdditive:function(t){this._additive=t},getAdditive:function(){return this._additive},setOpaqueEarlyZ:function(t){this._opaqueEarlyZ=t},getOpaqueEarlyZ:function(){return this._opaqueEarlyZ},getOrCreateUniforms:function(){var t=a;if(t.uniforms)return t.uniforms;var e={};return e.uReflection=n.Uniform.createFloat("uReflection"),e.uAdditive=n.Uniform.createInt("uAdditive"),t.uniforms=new n.Map(e),t.uniforms},apply:function(){var t=this.getOrCreateUniforms();t.uReflection.setFloat(this.getReflection()),t.uAdditive.setInt(this.getAdditive()?1:0)}}),"osgSketchfab","Material"),t.exports=a},function(t,e,i){"use strict";var r=i(236),n=i(1100),a=i(1360),s=i(1361),o=i(1362),u=n.osg,fif(n),h=function(t){return 0!==t&&(t&~t+1)===t},l=function(t){return 1<<Math.floor(Math.log2(t))},c=function(){u.Texture.call(this),this._imageProxy=void 0,this._convertNPOT=!0,this._trueFormat=void 0};c.WAIT_ANIMATION=!0;var d=u.ImageStream.prototype.play;u.ImageStream.prototype.play=function(){this._status!==u.ImageStream.PLAYING&&(o.draw(),d.call(this))},c.prototype=u.objectLibraryClass(u.objectInherit(u.Texture.prototype,{getImageFormat:function(){return this._trueFormat||this.getInternalFormat()},setImage:function(t,e){var i=t instanceof u.Image;if(!i||t.isDirty()||t!==this.getImage()){t._alphaInR&&this.getInternalFormat()===u.Texture.ALPHA&&(this._trueFormat=u.Texture.ALPHA,this.setInternalFormat(u.Texture.LUMINANCE));var r=t instanceof u.ImageStream;if(this._convertNPOT&&i&&!r){var n=t.getWidth(),a=t.getHeight();if(!h(n)||!h(a)){var s=document.createElement("canvas");n=s.width=l(n),a=s.height=l(a);var c=s.getContext("2d");c.drawImage(t.getImage(),0,0,n,a),t=s}}navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().indexOf("firefox/46")>-1&&this.hasMipmapFilter()&&this.setMinFilter(this.getMagFilter()),u.Texture.prototype.setImage.call(this,t,e),o.draw()}},applyTexImage2D:function(){u.Texture.prototype.applyTexImage2D.apply(this,arguments),o.draw()},getResourceManager:function(){return this._resourceManager||i(1099).instance},setImageProxy:function(t){this._imageProxy=t},getImageProxy:function(){return this._imageProxy},getImageCount:function(){var t=this._imageProxy;return t&&t.getImages?t.getImages().length:this._image?1:0},setEntryPromiseImage:function(t){t.promise.isFulfilled()===!0&&t.image?this.setImage(t.image):t.promise.then(this.setImage.bind(this))},setImageSmallest:function(){var t=this.getImageSmallest();if(t)return this.setEntryPromiseImage(t),t},setImageMaxSupported:function(){var t=this.getImageMaxSupported();if(t){var e=c.WAIT_ANIMATION?s.getPromise():r.resolve(),i=r.settle([e,t.promise]),n=this;return t.promise=i.then(function(){return n.setImage(t.image),t.image}),t}},getImageSmallest:function(){if(this._imageProxy){var t=this._imageProxy.findImageNearestToResolution(128,128,this.getImageFormat());return this.getResourceManager().getOrCreateImage(t.url,t.options)}},getImageJSONMaxSupported:function(t){t=a(void 0!==t?t:1/0);var e=this._imageProxy.findImageNearestPowerOfTwoUpToResolution(t,t,this.getImageFormat());if(e.width!==t&&e.height!==t){var i=this._imageProxy.findImageNearestPowerOfTwoUpToResolution(t,t);(i.width>e.width||i.height>e.height)&&(e=i)}return e},getImageMaxSupported:function(){if(this._imageProxy){var t=this.getImageJSONMaxSupported();return this.getResourceManager().getOrCreateImage(t.url,t.options)}},getImageWidget:function(){if(this._imageProxy){var t=this._imageProxy.findImageWidget();return this.getResourceManager().getOrCreateImage(t.url,t.options)}},getHash:function(){return"osgSketchfabTexture"}}),"osgSketchfab","Texture"),c.dummyTexture=new c,c.dummyTexture.setTextureSize(1,1),t.exports=c},function(t,e,i){"use strict";var r=i(1100),n=i(1341),a=r.osg,fif(r),s=function(t){var e=n().maxTextureSize,i=Math.min(void 0===e?8192:e,t);return Math.min(i,a.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_SIZE"))};t.exports=s},function(t,e,i){"use strict";var r=i(236),n={},a=r.defer();n.getPromise=function(){return a.promise},n.resolvePromise=function(){a.promise.isFulfilled()===!1&&a.resolve()},n.isFinished=function(){return a.promise.isFulfilled()},t.exports=n},function(t,e,i){"use strict";var r,n,a,s,o,u,h=i(1100),l=i(1363),c=h.osg,d={},p=-1,f=0,g=40,m=c.Timer.instance().tick(),v=!1;["hidden","mozHidden","msHidden","webkitHidden"].forEach(function(t){document&&document[t]&&(o=t,u=t.toLowerCase().split("hidden").shift()+"visibilitychange")});var _=function(){if(s=window.setTimeout(_,g),r&&!v&&!d.isDrawAlreadyQueued()&&a&&a.canBeEnabled()){var t=c.Timer.instance().tick(),e=t-m-g;g>=e||(a.enable(),p=-1)}};l()||(s=window.setTimeout(_,g));var b,x=function(t){if(r&&!v&&(!n||!document[o])){var e=d.isDrawAlreadyQueued();if(e||r.requestRedraw(),a&&!t&&(a.reset(),!e)){var i=c.Timer.instance().tick();f+=i-m,p++,0===p?(p=0,f=0):4===p&&(g=Math.min(200,Math.max(16,f/p)),p=0,f=0),m=i}}};d.setPoseForScreenshot=function(t){t&&!v?(b=r.getManipulator().update,r.getManipulator().update=function(){}):!t&&v&&(r.getManipulator().update=b),v=t},d.isDrawAlreadyQueued=function(){return r._requestRedraw},d.getPoseForScreenshot=function(){return v},d.draw=function(){x()},d.setLoaded=function(t){n=t},d.drawSameFrame=function(){x(!0)},d.setViewer=function(t){r=t},d.setSuperSample=function(t){a=t},u&&document.addEventListener(u,d.draw),t.exports=d},function(t,e){"use strict";var i="undefined"!=typeof global,r=function(){return i};t.exports=r},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=function(){n.TextureCubeMap.call(this),this._imageProxy=void 0};a.prototype=n.objectLibraryClass(n.objectInherit(n.TextureCubeMap.prototype,{getHash:function(){return"osgSketchfabTexture"}}),"osgSketchfab","TextureCubeMap"),t.exports=a},1347,function(t,e,i){"use strict";var r=i(1367),n=i(248),a=i(240);t.exports=n.extend({comparator:"order",model:r,_trashbin:[],url:function(){var t=this.options.filters.get("modelUID"),e="/i/models/"+t+"/animations";return e+a.craft("?",{})}})},function(t,e,i){"use strict";var r=i(236),n=i(224),a=i(239),s="/i/animations";t.exports=a.extend({defaults:{name:"",uid:"",duration:0,isLoop:!1,isEnabled:!0},url:function(){return s+"/"+this.get("uid")},save:function(t,e){(null==t||"object"==typeof t)&&(e=t);var i=new FormData;i.append("name",this.get("name")),i.append("isLoop",this.get("isLoop")),i.append("isEnabled",this.get("isEnabled"));var a=n.ajax({type:"PATCH",url:this.url(),data:i,cache:!1,contentType:!1,processData:!1});return r.resolve(a)}})},function(t,e,i){"use strict";i(1369);var r=i(236),n=i(1100),a=i(258),s=i(1357),o=i(1373),u=i(1362),h=i(1356),l=i(255),c=n.osg,fif(n),d=n.osgAnimation,p=n.osgWrappers,f=p.osg,fif(p),g=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:playing",this.onPlayingChanged,this),t.bind("change:speed",this.onSpeedChanged,this),t.bind("change:currentUID",this.onCurrentAnimationChanged,this),t.bind("seek",this.onSeek,this),this._manager=null,this._idLoop=0,this._skeletons=[],this._viewer=this.options.context.getViewer(),this._firstAnimationPlayed=!1,this._hookBasicAnimationManager(this._viewer.getPromisePolygon()),this._viewer.getPromiseMaterialLoaded().then(this._initAnimation.bind(this))},_initAnimation:function(){this._manager&&(this.onSpeedChanged(),o.init(this._skeletons,this._viewer,this.model))},_hookBasicAnimationManager:function(t){var e=this.model,i=this,n=function(t,r){var n=i.getCurrentInstanceAnimation();(-1!==this._seekTime||!this._pause&&n)&&u.draw();var a=d.BasicAnimationManager.prototype.update.call(this,t,r);if(n){var s=0===i.getCurrentAnimation().duration?1:this.getTimeFactor(),o=Math.max(0,this.getSimulationTime()*s-n.start),h=100*(o%n.duration)/n.duration,l=Math.floor(o/n.duration);l>this._idLoop&&(h=100,i.end(),"one"!==e.get("cycleMode")&&(a=d.BasicAnimationManager.prototype.update.call(this,t,r))),this._idLoop=l,e.set("progress",h)}return a},a=function(t){var e=i.getCurrentInstanceAnimation(),r=i.model.get("fps");if(e&&r>0){var n=1/r,a=(t-e.start)%n;a>.5*n?t+=n-a:t-=a}return d.BasicAnimationManager.prototype.updateManager.call(this,t)};p.osgAnimation.BasicAnimationManager=function(o,u){var l=o.getJSON();return l.Animations?(f.Object(o,u),s.OSG_VERSION<8?r.resolve(u):this._manager?(c.error("More than one basicAnimationManager !"),r.resolve(u)):(this._manager=u,e.get("playing")||u.togglePause(),u.update=n,u.updateManager=a,t.then(function(){var t=o.getOptions();t.progress=void 0;for(var e=l.Animations.length,r=0;e>r;++r){var n=l.Animations[r],a=o.setJSON(n["osgAnimation.Animation"].UserDataContainer).readUserDataContainer(),s=h.convertUserDataToObject(a),u=i.model.getAnimationByUID(s.AnimationUID);if(u){t.currentAnimationUID=u.get("url");var d=o.setJSON(n).readObject();d.isRejected()?c.Notify.warn("An Animation failed on the parsing!"):d.then(i.onAddAnimation.bind(i,r,s))}}}),r.resolve(u))):r.reject()}.bind(this)},onAddAnimation:function(t,e,i){var r=e.AnimationUID;i.name=r,i.duration||(i.duration=2.5,i.still=!0),this._manager.addAnimations([i]),0===i.duration&&(this._manager.getAnimations()[r].duration=2.5);var n=this.model;n.trigger("change:animations");var a=n.getAnimationByUID(r);if(a.on("change:isLoop",this.onAnimationChangeLoop.bind(this)),a.get("isLoop")&&this.onAnimationChangeLoop(a),!this._firstAnimationPlayed&&n.get("autoplay")){var s=this.model.getFirstEnabledAnimation();void 0!==s&&r===s.get("uid")&&(this._firstAnimationPlayed=!0,this.model.set("currentUID",r))}},onAnimationChangeLoop:function(t){var e=this._manager.getAnimations()[t.get("uid")];this._manager.setAnimationLerpEndStart(e,t.get("isLoop")?1/30:0)},onCurrentAnimationChanged:function(){this._idLoop=0;var t=this._manager;if(t.stopAllAnimation(),this.getCurrentAnimation()){var e=this.getCurrentInstanceAnimation();t.playAnimation(e),t.setSeekTime(e.start)}else for(var i=this._skeletons,r=0,n=i.length;n>r;++r)i[r].setRestPose();u.draw()},getCurrentAnimation:function(){return this.model.getCurrentAnimation()},getCurrentInstanceAnimation:function(){var t=this.getCurrentAnimation();return t?this._manager.getAnimations()[t.get("uid")]:void 0},onPlayingChanged:function(){if(this._playlistNoLoopEnd){var t=this.model.getFirstEnabledAnimation().get("uid")||"-1";this._playlistNoLoopEnd=!1,t===this.getCurrentAnimation().get("uid")?this.model.trigger("seek",0):this.model.set("currentUID",t)}this._manager.togglePause(),u.draw()},onSeek:function(t){var e=this.getCurrentInstanceAnimation();if(e){var i=this._manager;i.setSeekTime(e.start+e.duration*(t/100)/i.getTimeFactor()),u.draw()}},onSpeedChanged:function(){this._manager.setTimeFactor(this.model.get("speed")),l.modelViewerAnimationSpeedSelected(this.model.get("speed"))},end:function(){var t=this.model.get("cycleMode");if("one"===t)this.model.trigger("cycleMode");else if("all"===t||"none"===t){var e,i=this.model.get("animations"),r=i.indexOf(this.getCurrentAnimation()),n="-1",a=0,s=i.length;for(a=r+1;s>a;++a)if(e=i.at(a),e&&e.get("isEnabled")){n=e.get("uid");break}"-1"===n&&"all"===t&&(n=this.model.getFirstEnabledAnimation()?this.model.getFirstEnabledAnimation().get("uid"):"-1"),"-1"!==n?this.model.set("currentUID",n):(this.model.set("playing",!1),this.model.trigger("seek",99.99),this._playlistNoLoopEnd=!0)}}});t.exports=g},function(t,e,i){"use strict";var r=i(236),n=i(1100),a=i(1356),s=i(1099),o=i(1370),u=i(1371),h=i(1372),l=i(1354),c=i(1353),d=i(1349),p=n.osg,fif(n),f=n.osgDB,g=n.osgAnimation,m=n.osgWrappers.osgAnimation,v=g.Channel,_=function(){},b=f.registry();b.registerObject("osgAnimation.Vec3LerpChannelCompressedPacked",_),b.registerObject("osgAnimation.Vec3LerpChannelCompressed",_),b.registerObject("osgAnimation.Vec3LerpChannelPacked",_),b.registerObject("osgAnimation.QuatSlerpChannelCompressedPacked",_),b.registerObject("osgAnimation.QuatSlerpChannelCompressed",_),b.registerObject("osgAnimation.QuatSlerpChannelPacked",_),b.registerObject("osgAnimation.FloatLerpChannelCompressedPacked",_),b.registerObject("osgAnimation.FloatLerpChannelCompressed",_),b.registerObject("osgAnimation.FloatLerpChannelPacked",_);var x={},A=(new s)._resourceLoader,y="channel_mode",S={quantization:1,prediction:2,delta:4,quat:8,deltaTime:16},C=function(t,e,i,r,n,a){var s,f=e.ItemSize,g=Object.keys(e.Array)[0],m=e.Array[g],v=m.Offset?m.Offset:0,_=m.Size,b=i[y]||0,x=!!(1===a?b&S.deltaTime:b&S.delta),A=new ArrayBuffer(4*(x?_+2:_+1)*a),C=new Float32Array(A,x?4*a:0,_*a);return s=m.Encoding&&"varint"===m.Encoding?l(new Uint8Array(t,v),f*_,g):new p[g](t,v,f*_),4===a&&b&S.quat?(n&&(s=o(s,new Float32Array(s.length),f)),d(s,C,a,i.epsilon,i.nphi,!0),x&&(C=new Float32Array(A,0,(_+1)*a),C[0]=i.ox,C[1]=i.oy,C[2]=i.oz,C[3]=i.ow,h(C)),C):(n&&1!==a?o(s,C,f):C.set(s),r?(3===a&&b&S.quantization&&c(C,C,[i.bx,i.by,i.bz],[i.hx,i.hy,i.hz],a),x&&(C=new Float32Array(A,0,(_+1)*a),3===a?(C[0]=i.ox,C[1]=i.oy,C[2]=i.oz):C[0]=i.ot,u(C,f)),C):C)},w=function(t,e,i,n,s,o){var u=t.getJSON();if(!(void 0!==u.TargetName&&u.KeyFrames&&u.Name&&u.KeyFrames.Time&&u.KeyFrames.Key))return r.reject();var h=u.UserDataContainer,l=h?a.convertUserDataToObject(t.setJSON(h).readUserDataContainer()):x;return A.getBinaryArray(t.getOptions().currentAnimationUID).getPromise().then(function(t){var r=C(t,u.KeyFrames.Time,l,n,!1,1),a=C(t,u.KeyFrames.Key,l,n,s,o);return i(a,r,u.TargetName,u.Name,e),e})};m.Vec3LerpChannel=function(t,e){return w(t,e,v.createVec3Channel,!1,!1,3)},m.Vec3LerpChannelCompressedPacked=function(t,e){return w(t,e,v.createVec3Channel,!0,!0,3)},m.Vec3LerpChannelCompressed=function(t,e){return w(t,e,v.createVec3Channel,!0,!1,3)},m.Vec3LerpChannelPacked=function(t,e){return w(t,e,v.createVec3Channel,!1,!0,3)},m.QuatSlerpChannel=function(t,e){return w(t,e,v.createQuatChannel,!1,!1,4)},m.QuatSlerpChannelCompressedPacked=function(t,e){return w(t,e,v.createQuatChannel,!0,!0,4)},m.QuatSlerpChannelCompressed=function(t,e){return w(t,e,v.createQuatChannel,!0,!1,4)},m.QuatSlerpChannelPacked=function(t,e){return w(t,e,v.createQuatChannel,!1,!0,4)},m.FloatLerpChannel=function(t,e){return w(t,e,v.createFloatChannel,!1,!1,1)},m.FloatLerpChannelCompressedPacked=function(t,e){return w(t,e,v.createFloatChannel,!0,!0,1)},m.FloatLerpChannelCompressed=function(t,e){return w(t,e,v.createFloatChannel,!0,!1,1)},m.FloatLerpChannelPacked=function(t,e){return w(t,e,v.createFloatChannel,!1,!0,1)},t.exports={}},function(t,e){"use strict";var i=function(t,e,i){for(var r=t.length/i,n=0;r>n;++n)for(var a=n*i,s=0;i>s;++s)e[a+s]=t[n+r*s];return e};t.exports=i},function(t,e){"use strict";var i=function(t,e){for(var i=e||1,r=1,n=t.length/i;n>r;++r)for(var a=(r-1)*i,s=r*i,o=0;i>o;++o)t[s+o]+=t[a+o];return t};t.exports=i},function(t,e){"use strict";var i=function(t){for(var e=1,i=t.length/4;i>e;++e){var r=4*(e-1),n=4*e,a=t[r],s=t[r+1],o=t[r+2],u=t[r+3],h=t[n],l=t[n+1],c=t[n+2],d=t[n+3];t[n]=a*d+s*c-o*l+u*h,t[n+1]=-a*c+s*d+o*h+u*l,t[n+2]=a*l-s*h+o*d+u*c,t[n+3]=-a*h-s*l-o*c+u*d}return t};t.exports=i},function(t,e,i){"use strict";var r=i(1100),n=i(1374),a=i(1388),s=i(1341),o=i(1389),u=i(1390),h=r.osg,fif(r),l=r.osgUtil,c=r.osgAnimation,d=function(){};d.prototype={cull:function(){return!1}};var p=new d,f=function(){var t=h.Vec3.create(),e=h.Vec3.create();return function(i){i.center(t),h.Vec3.sub(i.getMax(),i.getMin(),e);var r=h.createTexturedBoxGeometry(t[0],t[1],t[2],e[0],e[1],e[2]);return r.setName("BoneBox"),3!==s().showBones&&r.setCullCallback(p),r._isBoneBox=!0,r.setNodeMask(a.PICK_GEOMETRY_RIG_BOX),r}}(),g=function(t){for(var e=l.GizmoGeometry.createCylinderGeometry(.1*t,.02*t,t),i=e.getAttributes().Vertex.getElements(),r=0,n=i.length/3;n>r;++r)i[3*r+2]+=.5*t;return e._isSkeleton=!0,e},m=function(t){h.NodeVisitor.call(this),this._visitedNodes={},this._drawNames=t;var e=h.StateAttribute.OVERRIDE|h.StateAttribute.ON,i=this._geoStateSet=new h.StateSet;i.setShaderGeneratorName("skeleton",e),i.setAttributeAndModes(new h.Depth(h.Depth.ALWAYS),e),i.setRenderBinDetails(u.DEBUG_2,"RenderBin"),o.set("hasExtra",!0)};m.prototype=h.objectInherit(h.NodeVisitor.prototype,{_drawBone:function(){var t=h.Vec3.create(),e=h.Vec3.createAndSet(0,0,1),i=h.Quat.create();return function(r){var n=r.getChildren();if(n.length)for(var a=0;a<n.length;++a){var s=n[a];if(s instanceof c.Bone!=!1){h.Matrix.transformVec3(s.getMatrix(),h.Vec3.init(t),t);var o=g(h.Vec3.length(t));o.setStateSet(this._geoStateSet),o._boundingBoxComputed=!0,o._boundingSphereComputed=!0;var u=new h.MatrixTransform;h.Quat.makeRotateFromTo(e,h.Vec3.normalize(t,t),i),h.Matrix.setRotateFromQuat(u.getMatrix(),i);var l=h.Uniform.createFloat4("uColor"),d=l.getInternalArray(),p=r.getOrCreateDebugColor();h.Vec3.copy(p,d),d[0]=.9*p[0],d[1]=.9*p[1],d[2]=.9*p[2],d[3]=1,u.getOrCreateStateSet().addUniform(l);var f="Debug "+r.getName();u.setName(f),o.setName(f),u.addChild(o),r.addChild(u)}}}}(),apply:function(t){var e=t.getInstanceID();this._visitedNodes[e]||(this._visitedNodes[e]=!0,t instanceof c.Bone&&this._drawNames[t.getName()]&&this._drawBone(t),this.traverse(t))}});var v=function(t){h.NodeVisitor.call(this),this.nodeMaskOverride=-1,this._visitedNodes={},this._drawBoneNames={},this._rigIndexed=[],this._boneGeomIndexed=[],this._skls=t;var e=h.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_UNIFORM_VECTORS");this._maxBones=Math.floor((e-19)/3),c.SkinningAttribute.maxBoneUniformAllowed=3*this._maxBones,this._maxVA=h.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_ATTRIBS")};v.prototype=h.objectInherit(h.NodeVisitor.prototype,{_handleRigGeometry:function(t){var e=t._boneNameID,i=Object.keys(e),r=i.length,n=s().showBones,o=t.userDataMap.wireframe;if(this._maxBones<r||1===n||2===n)if(o)t.setCullCallback(p);else{2!==n&&t.setNodeMask(0);for(var u=this._drawBoneNames,h=0;r>h;++h)u[i[h]]=!0}else o||t.setNodeMask(a.NO_PICK_NO_SHADOW_BOUNDS|a.PICK_GEOMETRY_ANIMATED);var l=t.userDataMap.rigIndex;void 0!==l&&(this._rigIndexed[l]=t)},_popTargetAttribute:function(t,e,i){for(var r=e.getMorphTargets(),n=r.length,a=t.getVertexAttributeList(),s=e.getVertexAttributeList(),o=0;n>o;++o){delete r[o].getVertexAttributeList()[i];var u=i+"_"+o;delete a[u],a!==s&&delete s[u]}},_computeUsedVA:function(t,e,i){var r=Object.keys(t).length-Object.keys(e).length*(i.length-Math.min(4,i.length));return t.Color||r++,r},_handleMorphGeometry:function(t,e){var i=e.getVertexAttributeList(),r=e.getMorphTargets(),n=r[0].getVertexAttributeList(),a=t.getVertexAttributeList(),s=this._computeUsedVA(a,n,r),o=this._maxVA;if(!(o>=s||a.Tangent_1&&(this._popTargetAttribute(t,e,"Tangent"),s=this._computeUsedVA(a,n,r),o>=s)||a.Normal_1&&(this._popTargetAttribute(t,e,"Normal"),s=this._computeUsedVA(a,n,r),o>=s))){for(var u=r.length;u>0;){var h=r.pop();u=r.length;for(var l=Object.keys(h.getVertexAttributeList()),c=l.length,d=0;c>d;++d){var p=l[d]+"_"+u;delete a[p],a!==i&&delete i[p]}if(s=this._computeUsedVA(a,n,r),o>=s)return;
}console.warn("Too much vertex attributes !")}},apply:function(t){var e=t.getInstanceID();if(!this._visitedNodes[e]){this._visitedNodes[e]=!0;var i=t instanceof c.RigGeometry,r=i?t.getSourceGeometry():t;if(r instanceof c.MorphGeometry&&this._handleMorphGeometry(t,r),i)this._handleRigGeometry(t);else if(t instanceof c.Bone){var n=t.getBoneBoundingBox();if(n.valid()){var a=f(n);t.addChild(a);var s=t.userDataMap.rigIndex;void 0!==s&&this._boneGeomIndexed.push(a)}}else t instanceof c.Skeleton&&this._skls.push(t);this.traverse(t)}}});var _={};_.DrawBones=m,_.hideCullCallback=p,_.init=function(t,e,i){var r=new v(t),a=e.getOrCreateScene().getRoot();a.accept(r);for(var s=r._boneGeomIndexed,o=r._rigIndexed,u=s.length,h=0;u>h;++h){var l=s[h];l._mostInfluencedRig=o[l.getParents()[0].userDataMap.rigIndex]}Object.keys(r._drawBoneNames).length>0&&(e.getViewerOSGJS().getState().getShaderGeneratorProxy().addShaderGenerator("skeleton",new n),a.accept(new m(r._drawBoneNames)),i.set("notSupported",!0))},t.exports=_},function(t,e,i){"use strict";var r=i(1375),n=i(1386),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1376),a=i(1380),s=i(1381),o=i(1382),u=i(1383),h=i(1384),l=i(1385),c=r.osg,fif(r),d=r.osgShader,p=d.ShaderGenerator,f={"sketchfabFunctions.glsl":a,"sketchfabTextures.glsl":s,"lightsPBR.glsl":o,"pbrUE4.glsl":u,"panoramaSampler.glsl":h,"cubemapSampler.glsl":l},g=function(){p.apply(this,arguments),this.setShaderCompiler(n),this.getShaderProcessor().addShaders(f)};g.prototype=c.objectInherit(p.prototype,{filterAttributeTypes:function(t){return"osgSketchfab"!==t.libraryName()&&"osgShadow"!==t.libraryName()&&"osgAnimation"!==t.libraryName()?!0:t.isEnabled&&!t.isEnabled()?!0:!1}}),t.exports=g},function(t,e,i){"use strict";var r=i(1100),n=i(1377),a=i(1378),s=i(1379),o=r.osg,fif(r),u=r.osgShader,h=u.Compiler,l=u.nodeFactory;l.registerNodes(n),l.registerNodes(a),l.registerNodes(s);var c=function(){u.Compiler.apply(this,arguments),this._isLighted=!!this._material&&this._material.getShadeless()===!1,this._isVertexColored=!!this._material&&this._material.getVertexColorEnable()};c.ALPHA_THRESHOLD=.99,c.prototype=o.objectInherit(h.prototype,{getCompilerName:function(){return"Classic"},getFragmentShaderName:function(){var t=this.getCompilerName(),e="",i=this._material.getName();return i&&(e=i.length),t+e},getOrCreateConstantOne:function(t){return this.getOrCreateConstant(t,t+"White").setValue(t+"(1.0)")},getOrCreateConstantZero:function(t){return this.getOrCreateConstant(t,t+"Black").setValue(t+"(0.0)")},initTextureAttributes:function(){var t=this._textureAttributes,e=t.length;this._textures.length=this._shadowsTextures.length=e;for(var i=0;e>i;i++){var r=t[i];if(void 0!==r)for(var n=0,a=r.length;a>n;n++)this.registerTextureAttributes(r[n],i)}},registerTextureAttributes:function(t,e){var i=t.className();return"TextureMaterial"===i?this.registerTextureMaterial(t,e):"TextureEnvironment"===i?this.registerTextureEnvironment(t,e):"ShadowTexture"===i?this.registerTextureShadow(t,e):void 0},registerTextureMaterial:function(t,e){var i=e;if(t.getTexCoordUnit){var r=t.getTexCoordUnit();void 0!==r&&(e=r)}var n=t.getName();n&&(this._textures[i]=t,this._texturesByName[n]={texture:t,variable:void 0,textureUnit:e,index:i})},registerTextureEnvironment:function(t,e){this._textures[e]=t,this._texturesByName["TextureEnvironment"+t.getChannel()]={texture:t,variable:void 0,textureUnit:e}},getOrCreateStateAttributeUniforms:function(t,e){var i=h.prototype.getOrCreateStateAttributeUniforms.call(this,t,e);return"SketchfabLight"===t.getType()&&(i.lightspecular&&(i.lightspecular=i.lightdiffuse),i.lightambient&&(i.lightambient=this.getOrCreateConstantZero("vec4")),"SPOT"!==t.getLightType()&&(i.lightinvMatrix=i.lightmatrix)),i},applyEmissive:function(t){var e=this.getOrCreateTextureChannel("EmitColor");if(!e)return t;var i=this.getTextureByName("EmitColor"),r=i.texture.getOrCreateUniforms(i.textureUnit).uEmitType,n=this.createVariable("vec3");return this.getNode("InlineCode").code("%output = %type == 0 ? %color + %emit : %color * %emit;").inputs({color:t,emit:e,type:this.getOrCreateUniform(r.getType(),r.getName())}).outputs({output:n}),n},createFragmentShaderGraph:function(){var t;if(this._isLighted){var e=this.createLighting(),i=this.getEnvironment();e&&i?(t=this.createVariable("vec3"),this.getNode("Add").inputs(e,i).outputs(t)):t=e||i||this.getOrCreateConstantZero("vec3")}else t=this.getShadelessColor();return t=this.applyEmissive(t),[this.getFinalFrag(t)]},createLighting:function(){if(this._lights.length){var t={};return t.materialambient=this.getOrCreateMaterialAmbient(),t.materialdiffuse=this.getOrCreateMaterialDiffuseColor(),t.materialspecular=this.getOrCreateMaterialSpecularColor(),t.materialshininess=this.getOrCreateMaterialSpecularHardness(),t.normal=this.getOrCreateMaterialNormal(),h.prototype.createLighting.call(this,t)}},getFinalFrag:function(t){var e=this.getOrCreateTextureChannel("Opacity"),i=this.getNode("glFragColor");return e?this.getFinalRGBA(t,this.getNode("glFragColor")):(this.applyAlphaMask(i),this.getRGBM(this.getSrgbColor(t),i))},getRGBM:function(t,e){return this.getNode("EncodeRGBM").inputs({color:t,range:this.getOrCreateUniform("float","uRGBMRange")}).outputs({color:e}),e},getFinalRGBA:function(t,e){var i=this.getOrCreateTextureChannel("Opacity"),r=this.getAlphaFinalAlpha(i);this.applyDiscardTransparentOpaque(i,r,e);var n=this.getSrgbColor(this.getPremultAlpha(t,i));return this.getNode("InlineCode").code("%color = %drawOpaque == 1 ? %rgbm : vec4(%rgb, %alpha);").inputs({rgb:n,rgbm:this.getRGBM(n,this.createVariable("vec4")),alpha:r,drawOpaque:this.getOrCreateUniform("int","uDrawOpaque")}).outputs({color:e}),e},applyDiscardTransparentOpaque:function(t,e,i){var r=c.ALPHA_THRESHOLD,n="if(%alphaOriginal < 0.01 || (%drawOpaque == 1 && %alphaFinal < "+r+") || (%drawOpaque == 0 && %alphaFinal >= "+r+")) discard;";this.getNode("InlineCode").code(n).inputs({alphaOriginal:t,alphaFinal:e,drawOpaque:this.getOrCreateUniform("int","uDrawOpaque")}).outputs({out:i})},getAlphaFinalAlpha:function(t){var e=this.createVariable("float");return this.getNode("InlineCode").code("%finalAlpha = %alpha * float(1 - %additive);").inputs({alpha:t,additive:this.getOrCreateUniform("int","uAdditive")}).outputs({finalAlpha:e}),e},getShadelessColor:function(){return this.getOrCreateMaterialDiffuseColor()},getVertexColor:function(t){if(void 0!==t){if(!this._material.getVertexColorEnable())return t;var e=this.getOrCreateVarying("vec4","VertexColor"),i=this.getOrCreateUniform("float","ArrayColorEnabled");if("srgb"===this._material.getVertexColorColorSpace()){var r=this.createVariable("vec3");this.getNode("sRGBToLinear").inputs({color:e}).outputs({color:r}),e=r}var n=this.createVariable("vec3"),a=["","%color.rgb = %diffuse.rgb;","if ( %hasVertexColor == 1.0)","  %color *= %vertexColor.rgb;"].join("\n");return this.getNode("InlineCode").code(a).inputs({diffuse:t,hasVertexColor:i,vertexColor:e}).outputs({color:n}).comment("diffuse color = diffuse color * vertex color"),n}},getOrCreateMaterialDiffuseColor:function(){var t=this.getVariable("materialDiffuseColor");if(t)return t;t=this.createVariable("vec3","materialDiffuseColor");var e=this.getOrCreateTextureChannel("DiffuseColor");if(!e)return t.setValue("vec3(0.0)");var i=this.getOrCreateTextureChannel("DiffuseIntensity")||this.getOrCreateConstantOne("float");return this.getNode("Mult").inputs(this.getVertexColor(e),i).outputs(t),t},getOrCreateMaterialNormal:function(){return this.getOrCreateGeometryNormal()},getOrCreateMaterialOpacity:function(){return this.getOrCreateTextureChannel("Opacity")||this.getOrCreateConstantOne("float")},getOrCreateMaterialAmbient:function(){return this.getOrCreateConstantOne("vec3")},getOrCreateMaterialSpecularColor:function(){return this.getOrCreateTextureChannel("SpecularColor")||this.getOrCreateConstantZero("vec3")},getOrCreateMaterialSpecularHardness:function(){return this.getOrCreateTextureChannel("SpecularHardness")||this.getOrCreateConstantZero("float")},applyAlphaMask:function(t){var e=this.getTextureByName("AlphaMask");if(void 0===e)return t;var i=e.texture.getOrCreateUniforms(e.textureUnit),r=i.AlphaMask;return this.getNode("InlineCode").code("if(%alpha < max(0.01, %threshold)) discard;").inputs({alpha:e.variable,threshold:this.getOrCreateUniform(r.getType(),r.getName())}).outputs({out:t}),t},getOrCreateNormalMap:function(){var t=this.getVariable("normalMap");if(t)return t;t=this.createVariable("vec3","normalMap");var e=this.getTextureByName("NormalMap"),i=e.textureUnit,r=e.texture,n=r.getOrCreateUniforms(i).uFlipY;return this.getNode("RGBToNormal").inputs({normal:e.variable,flipY:this.getOrCreateUniform(n.getType(),n.getName())}).outputs({normal:t}),t},getOrCreateGeometryNormal:function(){var t=this.getVariable("geoNormal");if(t)return t;t=this.createVariable("vec3","geoNormal");var e=this.getNormalMapNormal(this.getTextureByName("NormalMap"));return e||(e=this.getBumpMapNormal(this.getTextureByName("BumpMap")),e||(e=this.getOrCreateNormalizedNormal())),this.getNode("SetFromNode").inputs(e).outputs(t),t},getSrgbColor:function(t){var e=this.createVariable("vec3");return this.getNode("LinearTosRGBWithTest").inputs({color:t,keepLinear:this.getOrCreateUniform("int","uOutputLinear")}).outputs({color:e}),e},getTextureEnvironmentSpecular:function(){return this._texturesByName.TextureEnvironmentSpecular},getEnvironment:function(){var t=this.getTextureEnvironmentSpecular();if(void 0!==t){var e=t.texture,i=e.getCommonUniforms(),r=this.createVariable("mat3");this.getNode("EnvironmentTransformPBR").inputs({inTransform:this.getOrCreateUniform(i.environmentTransform)}).outputs({outTransform:r});var n=this.getEnvironmentDiffuse(r,i),a=this.getEnvironmentSpecular(r,e,i),s=this.createVariable("vec3");this.getNode("Add").inputs(n,a).outputs(s);var o=this.createVariable("vec3");return this.getNode("Mult").inputs(s,this.getOrCreateUniform(i.exposure)).outputs(o),o}},getEnvironmentDiffuse:function(t,e){var i=this.getOrCreateUniform(e.diffuseSPH);i.globalDeclaration=function(){return"uniform vec3 "+i.getVariable()+"[9];"};var r=this.createVariable("vec3");return this.getNode("DiffuseUE4v1").inputs({normal:this.getOrCreateMaterialNormal(),albedo:this.getOrCreateMaterialDiffuseColor(),ao:this.getOrCreateConstantOne("float"),envTransform:t,sphCoef:i}).outputs({color:r}),r},getEnvironmentSpecular:function(t,e,i){var r=this.createVariable("vec3");this.getNode("TextureEnvironmentCube").inputs({sampler:this.getOrCreateSampler("samplerCube",i.textureSpecular.getName()),envTransform:t,normal:this.getOrCreateMaterialNormal(),eye:this.getOrCreateNormalizedPosition(),texSize:this.getOrCreateUniform(e.getOrCreateUniforms().size)}).outputs({color:r});var n=this.createVariable("vec3"),a=this.getOrCreateUniform("float","uReflection");return this.getNode("Mult").inputs(r,this.getOrCreateMaterialSpecularColor(),a).outputs(n),n},getNormalMapNormal:function(t){if(void 0!==t){var e=this.getOrCreateNormalizedNormal(),i=this.getOrCreateNormalMap(),r=t.texture.getOrCreateUniforms(t.textureUnit).NormalMap,n=this.getOrCreateUniform(r.getType(),r.getName()),a=this.createVariable("vec3"),s="%out.xy = %factor * %input.xy;%out.z = %input.z;";this.getNode("InlineCode").code(s).inputs({input:i,factor:n}).outputs({out:a});var o=this.createVariable("vec3");return this.getNode("NormalTangentSpace").inputs({tangent:this.getOrCreateFrontTangent(),normal:e,texNormal:a}).outputs({normal:o}),o}},getBumpMapNormal:function(t){if(void 0!==t){var e=this.getOrCreateNormalizedNormal(),i=t.texture.getOrCreateUniforms(t.textureUnit).BumpMap,r=this.getOrCreateUniform(i.getType(),i.getName()),n=this.createVariable("vec2");this.getNode("Mult").inputs(t.variable,r).outputs(n);var a=this.createVariable("vec3");return this.getNode("Bumpmap").inputs({tangent:this.getOrCreateFrontTangent(),normal:e,gradient:n}).outputs({normal:a}),a}},getOrCreateTextureChannelWithoutFactor:function(t){var e=this.getTextureByName(t);return e?e.variable:void 0},getOrCreateTextureChannelInvertWhiteFactor:function(t){return this.getOrCreateTextureChannel(t,!0)},getOrCreateTextureChannel:function(t,e){var i="channel"+t,r=this.getVariable(i);if(r)return r;var n=this.getTextureByName(t);if(void 0!==n){var a=n.texture.getOrCreateUniforms(n.textureUnit),s=a[t],o=this.getOrCreateUniform(s.getType(),s.getName());"SpecularColor"===t&&(o=this.applyAdjustSpecular(o));var u=n.variable;return r=this.createVariable(u.getType(),i),e?this.applyInvertLerpFactor(u,o,r):(this.getNode("Mult").inputs(u,o).outputs(r),r)}},applyAdjustSpecular:function(t){var e=this.getTextureByName("NormalMap");if(!e)return t;var i=this.getOrCreateNormalMap(),r=this.createVariable("float");return this.getNode("AdjustSpecular").inputs({specular:t,normal:i}).outputs({specular:r}),r},applyInvertLerpFactor:function(t,e,i){return this.getNode("Blend").mode("MIX").inputs(this.getOrCreateConstantOne(t.getType()),t,e).outputs(i),i},declareTextures:function(){},getTextureByName:function(t){var e=this._texturesByName[t];if(!e||e.variable)return e;var i=e.texture,r=i.getSamplerName(),n=this.getVariable(r);void 0===n&&"Texture"===i.getTexture().className()&&(n=this.getOrCreateSampler("sampler2D",r));var a=i.getName(),s=e.textureUnit,o=this.getVariable("FragTexCoord"+s);return void 0===o&&(o=this.getOrCreateVarying("vec2","FragTexCoord"+s)),e.variable=this.readChannel(a,i,n,o,e.index),e},readChannel:function(t,e,i,r,n){var a;switch(t){case"DiffuseColor":case"EmitColor":case"DiffuseIntensity":case"SpecularColor":a=this.createTextureChannelsRGB(e,i,r);break;case"Opacity":case"AlphaMask":a=this.createTextureChannelsAlphaOpacity(e,i,r,n);break;case"SpecularHardness":a=this.createTextureChannelsR(e,i,r);break;case"NormalMap":a=this.createTextureChannelsRGB(e,i,r);break;case"BumpMap":a=this.createTextureChannelsBumpMap(e,i,r,n)}return a},getLinearTexel:function(t,e){if(!t.getSRGB())return e;var i=this.createVariable(e.getType());return this.getNode("sRGBToLinear").inputs({color:e}).outputs({color:i}),i},createTextureChannelsRGB:function(t,e,i){var r=this.createVariable("vec3");return this.getNode("TextureRGB").inputs({sampler:e,uv:i}).outputs({color:r}),this.getLinearTexel(t,r)},createTextureChannelsR:function(t,e,i){var r=this.createVariable("float");return this.getNode("TextureIntensity").inputs({sampler:e,uv:i}).outputs({color:r}),this.getLinearTexel(t,r)},createTextureChannelsAlphaOpacity:function(t,e,i,r){var n=t.getTexture(),a=n.getInternalFormat()===o.Texture.ALPHA?"TextureAlpha":"TextureIntensity",s=this.createVariable("float");this.getNode(a).inputs({sampler:e,uv:i}).outputs({color:s});var u=n.getImageFormat&&n.getImageFormat()===o.Texture.ALPHA;u||(s=this.getLinearTexel(t,s));var h=t.getOrCreateUniforms(r).uInvert,l=this.createVariable("float");return this.getNode("InlineCode").code("%aout = %invert == 1 ? 1.0 - %alpha : %alpha;").inputs({alpha:s,invert:this.getOrCreateUniform(h.getType(),h.getName())}).outputs({aout:l}),l},createTextureChannelsBumpMap:function(t,e,i,r){var n=t.getOrCreateUniforms(r).uBumpMapSize,a=this.createVariable("vec2","bumpGradient");return this.getNode("TextureGradient").inputs({sampler:e,texSize:this.getOrCreateUniform(n.getType(),n.getName()),uv:i}).outputs({color:a}),this.getLinearTexel(t,a)},getOrCreateProjectionMatrix:function(){var t=this.getVariable("projectionMatrix");if(t)return t;t=this.createVariable("mat4","projectionMatrix");var e=[""," %projMat = %projectionMatrix;"," float doPerp = %projMat[3][3] == 0.0 ? 1.0 : 0.0;"," float doOrtho = doPerp == 1.0 ? 0.0 : 1.0;"," vec2 halt = (abs(%halton.z) == 2.0 ? 1.0 : 0.0) * (%halton.xy / %renderSize.xy);"," // persp"," %projMat[2][0] += doPerp * halt.x;"," %projMat[2][1] += doPerp * halt.y;"," // ortho"," %projMat[3][0] += doOrtho * halt.x;"," %projMat[3][1] += doOrtho * halt.y;",""];return this.getNode("InlineCode").code(e.join("\n")).inputs({projectionMatrix:this.getOrCreateUniform("mat4","ProjectionMatrix"),halton:this.getOrCreateUniform("vec4","uHalton"),renderSize:this.getOrCreateUniform("vec2","RenderSize")}).outputs({projMat:t}),t},needTangent:function(){return!(!this._texturesByName.NormalMap&&!this._texturesByName.BumpMap)},getMatcapUnit:function(){var t=this._textureAttributes[11];return t&&t[0]&&"matcap"===t[0].getName()?11:(t=this._textureAttributes[7],t&&t[0]&&"matcap"===t[0].getName()?7:0)},assignMatcapTexture:function(){var t=this.getMatcapUnit();this._textures[t]=this._textureAttributes[t][0]},getMatcapColor:function(t){var e="Texture"+this.getMatcapUnit(),i=this._variables[e];i=i?i:this.getOrCreateSampler("sampler2D",e);var r=this.createVariable("vec2");this.getNode("NormalMatcap").inputs({normal:t,eye:this.getOrCreateNormalizedPosition()}).outputs({uv:r});var n=this.createVariable("vec3");this.getNode("TextureRGB").inputs({sampler:i,uv:r}).outputs({color:n});var a=this.createVariable("vec3");return this.getNode("sRGBToLinear").inputs({color:n}).outputs({color:a}),a}}),t.exports=c},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=r.osgShader,s=a.node.NodeFunctions,o=a.utils,u=function(){s.apply(this)};u.prototype=n.objectInherit(s.prototype,{globalFunctionDeclaration:function(){return'#pragma include "sketchfabFunctions.glsl"'}});var h=a.node.LinearTosRGB,l=function(){h.apply(this)};l.prototype=n.objectInherit(h.prototype,{type:"LinearTosRGBWithTest",validInputs:["color","keepLinear"],validOutputs:["color"],computeShader:function(){var t=this._outputs.color,e=this._inputs.color,i=this._inputs.keepLinear,r=t.getType()!==e.getType()?".rgb":"",n=["if("+i.getVariable()+" == 1 ) {",t.getVariable()+r+"= "+e.getVariable()+r+";","} else {",h.prototype.computeShader.call(this)+"}"].join("\n");return n}});var c=function(){u.apply(this)};c.prototype=n.objectInherit(u.prototype,{type:"NormalTangentSpace",validInputs:["tangent","normal","texNormal"],validOutputs:["normal"],computeShader:function(){var t=this._inputs;return o.callFunction("mtexNspaceTangent",this._outputs.normal,[t.tangent,t.normal,t.texNormal])}});var d=function(){u.apply(this)};d.prototype=n.objectInherit(u.prototype,{type:"Bumpmap",validInputs:["tangent","normal","gradient"],validOutputs:["normal"],computeShader:function(){var t=this._inputs;return o.callFunction("bumpMap",this._outputs.normal,[t.tangent,t.normal,t.gradient])}});var p=function(){u.apply(this)};p.prototype=n.objectInherit(u.prototype,{type:"NormalMatcap",validInputs:["normal","eye"],validOutputs:["uv"],computeShader:function(){return o.callFunction("normalMatcap",this._outputs.uv,[this._inputs.normal,this._inputs.eye])}});var f=function(){u.apply(this)};f.prototype=n.objectInherit(u.prototype,{type:"RGBToNormal",validInputs:["normal","flipY"],validOutputs:["normal"],computeShader:function(){return o.callFunction("rgbToNormal",this._outputs.normal,[this._inputs.normal,this._inputs.flipY])}});var g=function(){u.apply(this)};g.prototype=n.objectInherit(u.prototype,{type:"AdjustSpecular",validInputs:["specular","normal"],validOutputs:["specular"],computeShader:function(){return o.callFunction("adjustSpecular",this._outputs.specular,[this._inputs.specular,this._inputs.normal.getVariable()+".rgb"])}}),t.exports={LinearTosRGBWithTest:l,NormalTangentSpace:c,Bumpmap:d,NormalMatcap:p,AdjustSpecular:g,RGBToNormal:f}},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=r.osgShader,s=a.node.BaseOperator,o=function(){s.apply(this),this._mode="MIX"};o.prototype=n.objectInherit(s.prototype,{type:"Blend",mode:function(t){return this._mode=t,this},computeShader:function(){return this[void 0===this._mode?"MIX":this._mode]()},ADD:function(){return this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+" + ("+this._inputs[1].getVariable()+" * "+this._inputs[2].getVariable()+");"},MIX:function(){return this._outputs.getVariable()+" = mix("+this._inputs[0].getVariable()+", "+this._inputs[1].getVariable()+", "+this._inputs[2].getVariable()+");"},MULTIPLY:function(){return this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+" * mix( "+this._inputs[0].getType()+"(1.0), "+this._inputs[1].getVariable()+", "+this._inputs[2].getVariable()+");"}}),t.exports={Blend:o}},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=r.osgShader,s=a.node.NodeTextures,o=a.utils,s=a.node.NodeTextures,o=a.utils,u=function(){s.apply(this)};u.prototype=n.objectInherit(s.prototype,{globalFunctionDeclaration:function(){return'#pragma include "sketchfabTextures.glsl"'}});var h=function(){u.apply(this),this._isSRGB=!1};h.prototype=n.objectInherit(u.prototype,{type:"TextureGradient",validInputs:["sampler","texSize","uv"],setSRGB:function(t){return this._isSRGB=t,this},computeShader:function(){var t=this._inputs,e=this._isSRGB?"textureGradientSRGB":"textureGradient";return o.callFunction(e,this._outputs.color,[t.sampler,t.uv.getVariable()+".xy",t.texSize])},globalFunctionDeclaration:function(){var t='#pragma include "sketchfabTextures.glsl"';return this._isSRGB?t+'\n#pragma include "functions.glsl"':t}});var l=function(){u.apply(this)};l.prototype=n.objectInherit(u.prototype,{type:"TextureEnvironmentCube",validInputs:["sampler","envTransform","normal","eye","texSize"],computeShader:function(){var t=this._inputs;return o.callFunction("textureEnvironmentCube",this._outputs.color,[t.sampler,t.envTransform,t.normal,t.eye,t.texSize])}}),t.exports={TextureGradient:h,TextureEnvironmentCube:l}},function(t,e){t.exports="float adjustSpecular( const in float specular, const in vec3 normal ) {\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\n    float normalLen = length(normal);\n    if ( normalLen < 1.0) {\n        float normalLen2 = normalLen * normalLen;\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\n        // page 91 : they use 0.5/kappa instead\n        return 1.0-min(1.0, sqrt( (1.0-specular) * (1.0-specular) + 1.0/kappa ));\n    }\n    return specular;\n}\n\nvec3 mtexNspaceTangent(const in vec4 tangent, const in vec3 normal, const in vec3 texnormal) {\n    vec3 tang = vec3(0.0,1.0,0.0);\n    float l = length(tangent.xyz);\n    if (l != 0.0) {\n        //normalize reusing length computations\n        // tang =  normalize(tangent.xyz);\n        tang =  tangent.xyz / l;\n    }\n    vec3 B = tangent.w * normalize(cross(normal, tang));\n    return normalize( texnormal.x*tang + texnormal.y*B + texnormal.z*normal);\n}\n\nvec2 normalMatcap(const in vec3 normal, const in vec3 nm_z) {\n    vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);\n    vec3 nm_y = cross(nm_x, nm_z);\n    return vec2(dot(normal.xz, nm_x.xz), dot(normal, nm_y)) * vec2(0.5)  + vec2(0.5) ; //MADD vector form\n}\n\nvec3 rgbToNormal(const in vec3 texel, const in int flipNormalY) {\n    vec3 rgb = texel * vec3(2.0) + vec3(-1.0); // MADD vec form\n    rgb[1] = flipNormalY == 1 ? -rgb[1] : rgb[1];\n    return rgb;\n}\n\nvec3 bumpMap(const in vec4 tangent, const in vec3 normal, const in vec2 gradient) {\n    vec3 outnormal;\n    float l = length(tangent.xyz);\n    if (l != 0.0) {\n        //normalize reusing length computations\n        // vec3 tang =  normalize(tangent.xyz);\n        vec3 tang =  tangent.xyz / l;\n        vec3 binormal = tangent.w * normalize(cross(normal, tang));\n        outnormal = normal + gradient.x * tang + gradient.y * binormal;\n    }\n    else {\n       outnormal = vec3(normal.x + gradient.x, normal.y + gradient.y, normal.z);\n    }\n    return normalize(outnormal);\n}\n"},function(t,e){t.exports='#pragma include "sketchfabFunctions.glsl"\n\nvec3 cubemapSeamlessFixDirection(const in vec3 direction, const in float size ) {\n    vec3 dir = direction;\n    float scale = 1.0 - 1.0 / size;\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 absDir = abs(dir);\n    float M = max(max(absDir.x, absDir.y), absDir.z);\n\n    if (absDir.x != M) dir.x *= scale;\n    if (absDir.y != M) dir.y *= scale;\n    if (absDir.z != M) dir.z *= scale;\n\n    return dir;\n}\n\n// seamless cubemap for background ( no lod )\nvec3 textureCubeFixed(const in samplerCube texture, const in vec3 direction, const in float scale ) {\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 dir = cubemapSeamlessFixDirection( direction, scale);\n    return LUVToRGB( textureCube( texture, dir ) );\n}\n\nvec3 textureEnvironmentCube( const in samplerCube tex, const in mat3 envTrans, const in vec3 N, const in vec3 V, const in vec2 size ){\n    vec3 R = normalize( (2.0 * clamp( dot( N, V ), 0.0, 1.0 ) ) * N - V);\n    return textureCubeFixed( tex, envTrans * R, size[0] );\n}\n\n// Todo use #idfef and derivatives (dDFx, dDFy, fwidth) extension ?\n// float valuetexture2D(texture, uv);\n// return vec2(dFdx(value), dFdy(value));\nvec2 textureGradient(in sampler2D texture, const in vec2 uv, const in vec2 size) {\n    vec2 step = 1.0 / size;\n    float dx = texture2D(texture, uv - vec2(step.x, 0.0)).r - texture2D(texture, uv + vec2(step.x, 0.0)).r;\n    float dy = texture2D(texture, uv - vec2(0.0, step.y)).r - texture2D(texture, uv + vec2(0.0, step.y)).r;\n    return vec2(dx, dy);\n}\n\n// sighhh\nvec2 textureGradientSRGB(in sampler2D texture, const in vec2 uv, const in vec2 size) {\n    vec2 step = 1.0 / size;\n    float dx = sRGBToLinear(texture2D(texture, uv - vec2(step.x, 0.0)).r) - sRGBToLinear(texture2D(texture, uv + vec2(step.x, 0.0)).r);\n    float dy = sRGBToLinear(texture2D(texture, uv - vec2(0.0, step.y)).r) - sRGBToLinear(texture2D(texture, uv + vec2(0.0, step.y)).r);\n    return vec2(dx, dy);\n}\n'},function(t,e){t.exports="\r\n// math.glsl\r\n#define PI 3.141593\r\n#define HALF_PI 1.570796\r\n#define EPS .0000001\r\n\r\n// dxtogl.glsl ?\r\n#define saturate(_x) clamp(_x, 0., 1.)\r\n#define atan2(_x, _y) atan(_x, _y)\r\n#define frac(_x) fract(_x)\r\n#define lerp(_x, _y, _t) mix(_x, _y, _t)\r\n\r\n// light_common.glsl\r\n// ATTENUATION\r\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation)\r\n{\r\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\r\n    // TODO find a vector alu instead of 4 scalar\r\n    float constant = lightAttenuation.x;\r\n    float linear = lightAttenuation.y*dist;\r\n    float quadratic = lightAttenuation.z*dist*dist;\r\n    return 1.0 / ( constant + linear + quadratic );\r\n}\r\n\r\n// light PBR glsl\r\n#define G1V(dotNV, k) (1./(dotNV*(1.-k)+k))\r\n\r\nvec4 LightingFuncPrep(const in vec3 N,\r\n                      const in vec3 V,\r\n                      const in float roughness)\r\n{\r\n\r\n    float dotNV = saturate(dot(N,V));\r\n    float alpha = roughness * roughness;\r\n    float k = alpha * .5;\r\n    float visNV = G1V(dotNV,k);\r\n\r\n    vec4 prepSpec;\r\n\r\n    prepSpec.x = alpha;\r\n    prepSpec.y = alpha * alpha;\r\n    prepSpec.z = k;\r\n    prepSpec.w = visNV;\r\n\r\n    return prepSpec;\r\n\r\n}\r\n\r\nvec3 LightingFuncUsePrepGGX(const vec4 prepSpec,\r\n                            const vec3 N,\r\n                            const vec3 V,\r\n                            const vec3 L,\r\n                            const vec3 F0,\r\n                            const float dotNL)\r\n{\r\n\r\n    vec3 H = normalize(V+L);\r\n    float dotNH = saturate(dot(N,H));\r\n    // D\r\n    float alphaSqr = prepSpec.y;\r\n    float denom = dotNH * dotNH *(alphaSqr-1.) + 1.;\r\n    float D = alphaSqr / (PI * denom * denom);\r\n    // F\r\n    float dotLH = saturate(dot(L,H));\r\n    float dotLH5 = pow(1.-dotLH,5.);\r\n    vec3 F = vec3(F0) + (vec3(1.)-F0)*(dotLH5);\r\n    // V\r\n    float visNL = G1V(dotNL, prepSpec.z);\r\n    vec3 specular = D * F * visNL * prepSpec.w;\r\n    return specular;\r\n}\r\n\r\n// pure compute Light PBR\r\nvec3 computeLight(const in vec3 lightColor,\r\n                  const in vec3 albedoColor,\r\n                  const in vec3 normal,\r\n                  const in vec3 viewDir,\r\n                  const in vec3 lightDir,\r\n                  const in vec3 specular,\r\n                  const in vec4 prepSpec,\r\n                  const in float dotNL)\r\n{\r\n    vec3 cSpec = LightingFuncUsePrepGGX(prepSpec, normal, viewDir, lightDir, specular, dotNL);\r\n    return lightColor *  dotNL*(albedoColor + cSpec);\r\n}\r\n\r\n// STANDARD call for each light\r\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\r\nvec3 computeSpotLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec3  lightSpotDirection,\r\n    const in vec4  lightAttenuation,\r\n    const in vec4  lightSpotPosition,\r\n    const in float lightCosSpotCutoff,\r\n    const in float lightSpotBlend,\r\n\r\n    const in mat4 lightMatrix,\r\n    const in mat4 lightInvMatrix,\r\n\r\n    out vec3 eyeLightPos,\r\n    out vec3 eyeLightDir,\r\n    out float NdotL,\r\n    out bool lighted)\r\n{\r\n    lighted = false;\r\n    eyeLightPos = vec3(lightMatrix * lightSpotPosition);\r\n    eyeLightDir = eyeLightPos - FragEyeVector.xyz;\r\n    // compute dist\r\n    float dist = length(eyeLightDir);\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0)\r\n    {\r\n        // compute direction\r\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n        if (lightCosSpotCutoff > 0.0)\r\n        {\r\n            //compute lightSpotBlend\r\n            vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\r\n\r\n            float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\r\n            float diffAngle = cosCurAngle - lightCosSpotCutoff;\r\n            float spot = 1.0;\r\n            if ( diffAngle < 0.0 ) {\r\n                spot = 0.0;\r\n            } else {\r\n                if ( lightSpotBlend > 0.0 )\r\n                    spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\r\n            }\r\n\r\n            if (spot > 0.0)\r\n            {\r\n                // compute NdL\r\n                NdotL = dot(eyeLightDir, normal);\r\n                if (NdotL > 0.0)\r\n                {\r\n                    lighted = true;\r\n                    return spot * attenuation *computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir, specular, prepSpec,  NdotL);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computePointLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec4 lightPosition,\r\n    const in vec4 lightAttenuation,\r\n\r\n    const in mat4 lightMatrix,\r\n\r\n    out vec3 eyeLightPos,\r\n    out vec3 eyeLightDir,\r\n    out float NdotL,\r\n    out bool lighted)\r\n{\r\n\r\n    eyeLightPos =  vec3(lightMatrix * lightPosition);\r\n    eyeLightDir = eyeLightPos - FragEyeVector.xyz;\r\n    float dist = length(eyeLightDir);\r\n    // compute dist\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0)\r\n    {\r\n        // compute direction\r\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n        // compute NdL\r\n        NdotL = dot(eyeLightDir, normal);\r\n        if (NdotL > 0.0)\r\n        {\r\n            lighted = true;\r\n            return  attenuation * computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir,  specular, prepSpec,  NdotL);\r\n        }\r\n    }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computeSunLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n\r\n    const in vec4 lightPosition,\r\n\r\n    const in mat4 lightMatrix,\r\n\r\n    out vec3 eyeLightDir,\r\n    out float NdotL,\r\n    out bool lighted)\r\n{\r\n\r\n    lighted = false;\r\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\r\n    // compute NdL   // compute NdL\r\n    NdotL = dot(eyeLightDir, normal);\r\n    if (NdotL > 0.0)\r\n    {\r\n        lighted = true;\r\n        return computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir, specular, prepSpec,  NdotL);\r\n    }\r\n    return vec3(0.0);\r\n}\r\n";
},function(t,e){t.exports='#pragma include "functions.glsl"\r\n#define LUV\r\n\r\nfloat specularOcclusion(const in int occlude, const in float ao, const in vec3 N, const in vec3 V) {\r\n    if(occlude == 0)\r\n        return 1.0;\r\n    // Yoshiharu Gotanda\'s specular occlusion approximation:\r\n    // cf http://research.tri-ace.com/Data/cedec2011_RealtimePBR_Implementation_e.pptx pg59\r\n    float d = dot( N, V ) + ao;\r\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\r\n}\r\n\r\nfloat adjustRoughnessNormalMap( const in float roughness, const in vec3 normal ) {\r\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\r\n    float normalLen = length(normal);\r\n    if ( normalLen < 1.0) {\r\n        float normalLen2 = normalLen * normalLen;\r\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\r\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\r\n        // page 91 : they use 0.5/kappa instead\r\n        return min(1.0, sqrt( roughness * roughness + 1.0/kappa ));\r\n    }\r\n    return roughness;\r\n}\r\n\r\nfloat adjustRoughnessGeometry( const in float roughness, const in vec3 normal ) {\r\n    // Geometric Specular Aliasing (slide 43)\r\n    // http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\r\n// #ifdef GL_OES_standard_derivatives\r\n//     vec3 vDx = dFdx( normal.xyz );\r\n//     vec3 vDy = dFdy( normal.xyz );\r\n//     return max(roughness, pow( clamp( max( dot( vDx, vDx ), dot( vDy, vDy ) ), 0.0, 1.0 ), 0.333 ));\r\n// #else\r\n    return roughness;\r\n// #endif\r\n}\r\n\r\nmat3 environmentTransformPBR( const in mat4 tr ) {\r\n    // TODO trick from animation matrix transpose?\r\n    vec3 x = vec3(tr[0][0], tr[1][0], tr[2][0]);\r\n    vec3 y = vec3(tr[0][1], tr[1][1], tr[2][1]);\r\n    vec3 z = vec3(tr[0][2], tr[1][2], tr[2][2]);\r\n    mat3 m = mat3(x, y, z);\r\n    return m;\r\n}\r\n\r\nvec3 evaluateDiffuseSphericalHarmonics( const in vec3 s[9], const in mat3 envTrans, const in vec3 N ) {\r\n    vec3 n = envTrans * N;\r\n    // https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\r\n    vec3 result = (s[0]+s[1]*n.y+s[2]*n.z+s[3]*n.x+s[4]*n.y*n.x+s[5]*n.y*n.z+s[6]*(3.0*n.z*n.z-1.0)+s[7]*(n.z*n.x)+s[8]*(n.x*n.x-n.y*n.y));\r\n    return max(result, vec3(0.0));\r\n}\r\n\r\n// Frostbite, Lagarde paper p67\r\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\r\nfloat linRoughnessToMipmap( const in float roughnessLinear ) {\r\n    return sqrt(roughnessLinear);\r\n}\r\n\r\nvec3 integrateBRDF( const in vec3 specular, const in float r, const in float NoV, const in sampler2D tex ) {\r\n    vec4 rgba = texture2D( tex, vec2(NoV, r) );\r\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0);\r\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0);\r\n    const float div = 1.0/65535.0;\r\n    return (specular * a + b) * div;\r\n}\r\n\r\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\r\n// TODO should we use somehow specular f0 ?\r\nvec3 integrateBRDFApprox( const in vec3 specular, const in float roughness, const in float NoV ) {\r\n    const vec4 c0 = vec4( -1, -0.0275, -0.572, 0.022 );\r\n    const vec4 c1 = vec4( 1, 0.0425, 1.04, -0.04 );\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\r\n    vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\r\n    return specular * AB.x + AB.y;\r\n}\r\n\r\nvec3 computeIBLDiffuseUE4( const in vec3 normal, const in vec3 albedo, const in mat3 envTrans, const in vec3 sphHarm[9] ) {\r\n    return albedo * evaluateDiffuseSphericalHarmonics( sphHarm, envTrans, normal ) ;\r\n}\r\n\r\n// basically whether it\'s panorama or cubemap we load the adequate glsl\r\n// and we set samplerEnv and prefilterEnvMap\r\n#ifdef CUBEMAP\r\n#pragma include "cubemapSampler.glsl" "CUBEMAP"\r\n#define samplerEnv samplerCube\r\n#define prefilterEnvMap prefilterEnvMapCube\r\n\r\n#else\r\n#ifdef PANORAMA\r\n#pragma include "panoramaSampler.glsl" "PANORAMA"\r\n#define samplerEnv sampler2D\r\n#define prefilterEnvMap prefilterEnvMapPanorama\r\n\r\n#else\r\n// in case there is no environment node ?\r\nvec3 prefilterEnvMap( const in float rLinear, const in vec3 R, const in sampler2D tex, const in vec2 lodRange, const in vec2 size ) {\r\n    return vec3(0.0);\r\n}\r\n#define samplerEnv sampler2D\r\n#endif // PANORAMA\r\n\r\n#endif // CUBEMAP\r\n\r\nvec3 getSpecularDominantDir( const in vec3 N, const in vec3 R, const in float realRoughness ) {\r\n    float smoothness = 1.0 - realRoughness;\r\n    float lerpFactor = smoothness * ( sqrt( smoothness ) + realRoughness );\r\n    // The result is not normalized as we fetch in a cubemap\r\n    return mix( N, R, lerpFactor );\r\n}\r\n\r\n// samplerEnv and prefilterEnvMap are both defined above (cubemap or panorama)\r\nvec3 computeIBLSpecularUE4(\r\n    const in vec3 N,\r\n    const in vec3 V,\r\n    const in float rLinear,\r\n    const in vec3 specular,\r\n    const in mat3 envTrans,\r\n    const in samplerEnv texEnv,\r\n    const in vec2 lodRange,\r\n    const in vec2 size,\r\n    const in vec3 frontNormal\r\n    #ifdef MOBILE\r\n    ){\r\n    #else\r\n    ,const in sampler2D texBRDF ) {\r\n    #endif\r\n\r\n    float rough = max( rLinear, 0.0);\r\n\r\n    float NoV = clamp( dot( N, V ), 0.0, 1.0 );\r\n    vec3 R = normalize( NoV * 2.0 * N - V);\r\n    R = getSpecularDominantDir(N, R, rLinear);\r\n    // could use that, especially if NoV comes from shared preCompSpec\r\n    //vec3 R = reflect(-V, N);\r\n\r\n    vec3 prefilteredColor = prefilterEnvMap( rough, envTrans * R, texEnv, lodRange, size );\r\n    // http://marmosetco.tumblr.com/post/81245981087\r\n    // TODO we set a min value (10%) to avoid pure blackness (in case of pure metal)\r\n    float factor = clamp( 1.0 + 1.3 * dot(R, frontNormal), 0.1, 1.0 );\r\n    prefilteredColor *= factor * factor;\r\n    #ifdef MOBILE\r\n    return prefilteredColor * integrateBRDFApprox( specular, rough, NoV );\r\n    #else\r\n    return prefilteredColor * integrateBRDF( specular, rough, NoV, texBRDF );\r\n    #endif\r\n}\r\n'},function(t,e){t.exports="vec2 computeUVForMipmap( const in float level, const in vec2 uv, const in float size, const in float maxLOD ) {\r\n\r\n    // width for level\r\n    float widthForLevel = exp2( maxLOD-level);\r\n\r\n    // the height locally for the level in pixel\r\n    // to opimitize a bit we scale down the v by two in the inputs uv\r\n    float heightForLevel = widthForLevel * 0.5;\r\n\r\n\r\n    // compact version\r\n    float texelSize = 1.0/size;\r\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\r\n    uvSpaceLocal.y += size - widthForLevel;\r\n    return uvSpaceLocal * texelSize;\r\n}\r\n\r\n//for y up\r\nvec2 normalToPanoramaUVY( const in vec3 dir ) {\r\n    float n = length(dir.xz);\r\n\r\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\r\n    vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\r\n\r\n    // fix edge bleeding\r\n    if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\r\n\r\n    pos = acos(pos) * 0.3183098861837907; // inv_pi\r\n\r\n    pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\r\n\r\n    // shift u to center the panorama to -z\r\n    pos.x = mod(pos.x-0.25+1.0, 1.0 );\r\n    pos.y = 1.0-pos.y;\r\n    return pos;\r\n}\r\n\r\nvec3 texturePanorama(const in sampler2D texture, const in vec2 uv) {\r\n    vec4 rgba = texture2D(texture, uv );\r\n#ifdef FLOAT\r\n    return rgba.rgb;\r\n#endif\r\n#ifdef RGBM\r\n    return RGBMToRGB( rgba );\r\n#endif\r\n#ifdef LUV\r\n    return LUVToRGB( rgba );\r\n#endif\r\n}\r\n\r\nvec3 texturePanoramaLod(const in sampler2D texture, const in vec2 size, const in vec3 direction, const in float lodInput, const in float maxLOD ) {\r\n    float lod = min( maxLOD, lodInput );\r\n    vec2 uvBase = normalToPanoramaUVY( direction );\r\n\r\n    // // we scale down v here because it avoid to do twice in sub functions\r\n    // uvBase.y *= 0.5;\r\n\r\n    float lod0 = floor(lod);\r\n    vec2 uv0 = computeUVForMipmap(lod0, uvBase, size.x, maxLOD );\r\n    vec3 texel0 = texturePanorama( texture, uv0.xy);\r\n\r\n    float lod1 = ceil(lod);\r\n    vec2 uv1 = computeUVForMipmap(lod1, uvBase, size.x, maxLOD );\r\n    vec3 texel1 = texturePanorama( texture, uv1.xy);\r\n\r\n    return mix(texel0, texel1, fract( lod ) );\r\n}\r\n\r\nvec3 prefilterEnvMapPanorama( const in float rLinear, const in vec3 R, const in sampler2D tex, const in vec2 lodRange, const in vec2 size ){\r\n    return texturePanoramaLod( tex, size, R, linRoughnessToMipmap(rLinear) * lodRange[1], lodRange[0] );\r\n}\r\n"},function(t,e){t.exports="// has to be before anything else, just after glsl language version\r\n// it's require. enable just allow\r\nvec3 textureCubemapLod(const in samplerCube texture, const in vec3 dir, const in float lod ) {\r\n    vec4 rgba = textureCubeLodEXT( texture, dir, lod );\r\n#ifdef FLOAT\r\n    return rgba.rgb;\r\n#endif\r\n#ifdef RGBM\r\n    return RGBMToRGB( rgba );\r\n#endif\r\n#ifdef LUV\r\n    return LUVToRGB( rgba );\r\n#endif\r\n}\r\n\r\nvec3 textureCubeLodEXTFixed(const in samplerCube texture, const in vec2 size, const in vec3 direction, const in float lodInput, const in float maxLod ) {\r\n    vec3 dir = direction;\r\n    float lod = min( maxLod, lodInput );\r\n\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - exp2(lod) / size.x;\r\n    vec3 absDir = abs(dir);\r\n    float M = max(max(absDir.x, absDir.y), absDir.z);\r\n\r\n    if (absDir.x != M) dir.x *= scale;\r\n    if (absDir.y != M) dir.y *= scale;\r\n    if (absDir.z != M) dir.z *= scale;\r\n\r\n    return textureCubemapLod( texture, dir, lod );\r\n}\r\n\r\nvec3 prefilterEnvMapCube( const in float rLinear, const in vec3 R, const in samplerCube tex, const in vec2 lodRange, const in vec2 size ){\r\n    float lod = linRoughnessToMipmap(rLinear) * lodRange[1]; //( uEnvironmentMaxLod - 1.0 );\r\n    return textureCubeLodEXTFixed( tex, size, R, lod, lodRange[0] );\r\n}\r\n"},function(t,e,i){"use strict";var r=i(1100),n=i(1387),a=r.osg,fif(r),s=function(){n.apply(this,arguments),this._isVertexColored=!1};s.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"Skeleton"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(this.getOrCreateUniform("vec4","uColor")).outputs(t),[t]}}),t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(1376),a=r.osg,fif(r),s=function(){n.apply(this,arguments),this._isVertexColored=!1};s.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"EarlyZ"},registerTextureMaterial:function(t,e){var i=t.getName();("AlphaMask"===i||"Opacity"===i)&&n.prototype.registerTextureMaterial.call(this,t,e)},registerTextureEnvironment:function(){},registerTextureShadow:function(){},applyAlphaBlendMasking:function(t){var e=this.getOrCreateTextureChannel("Opacity");return e?(this.getNode("InlineCode").code("if(%alpha < "+n.ALPHA_THRESHOLD+") discard;").inputs({alpha:e}).outputs({out:t}),t):t},createDepthColor:function(){var t=this.createVariable("vec4"),e=["if( %drawOpaque == 1 && %alpha < "+n.ALPHA_THRESHOLD+") discard;","float depth = (-%fragEye.z * %fragEye.w - %nearFar.x) / (%nearFar.y - %nearFar.x);","%color = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * depth);","%color -= %color.yzww * vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);","%color.a = %drawOpaque == 1 ? 1.0 : %alpha;"].join("\n");return this.getNode("InlineCode").code(e).inputs({fragEye:this.getOrCreateInputPosition(),nearFar:this.getOrCreateUniform("vec2","uNearFar"),drawOpaque:this.getOrCreateUniform("int","uDrawOpaque"),alpha:this.getOrCreateTextureChannel("Opacity")||this.createVariable("float").setValue("1.0")}).outputs({color:t}),t},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.applyAlphaMask(t),this.getNode("SetFromNode").inputs(this.createDepthColor()).outputs(t),[t]},declareVertexTransforms:n.prototype.declareTransformWithEyeSpace}),t.exports=s},function(t,e){"use strict";var i={};i.PICK_GEOMETRY_FIXED=1,i.PICK_GEOMETRY_ANIMATED=2,i.PICK_GEOMETRY_RIG_BOX=4,i.PICK_GIZMO_LIGHT=8,i.SHADOW_CAST=16,i.SHADOW_BOUNDS=32,i.PICK_GEOMETRY_SLOW=i.PICK_GEOMETRY_FIXED|i.PICK_GEOMETRY_ANIMATED,i.PICK_GEOMETRY_FAST=i.PICK_GEOMETRY_FIXED|i.PICK_GEOMETRY_RIG_BOX,i.PICK_GEOMETRY=i.PICK_GEOMETRY_FIXED|i.PICK_GEOMETRY_ANIMATED|i.PICK_GEOMETRY_RIG_BOX,i.PICK=i.PICK_GEOMETRY|i.PICK_GIZMO_LIGHT,i.SHADOW=i.SHADOW_BOUNDS|i.SHADOW_CAST,i.PICK_GEOMETRY_SHADOW=i.PICK_GEOMETRY|i.SHADOW,i.NO_SHADOW=~i.SHADOW,i.NO_PICK=~i.PICK,i.NO_PICK_NO_SHADOW_CAST=~(i.PICK|i.SHADOW_CAST),i.NO_PICK_NO_SHADOW_BOUNDS=~(i.PICK|i.SHADOW_BOUNDS),i.NO_PICK_NO_SHADOW=~(i.PICK|i.SHADOW),t.exports=i},function(t,e,i){"use strict";var r=i(239),n=i(1093),a=i(1341),s=new r({hasTransparency:!1,hasExtra:!1}),o={},u=0;s.registerStateSetTransparency=function(t){var e=t.getInstanceID();o[e]||(o[e]=!0,u++,s.set("hasTransparency",u>0))},s.registerStateSetOpaque=function(t){var e=t.getInstanceID();o[e]&&(o[e]=!1,u--,s.set("hasTransparency",u>0))};var h=!1,l=!1,c=function(){s.set("hasExtra",h||l||a().debug3d||n())};s.setHotspot=function(t){l=t,c()},s.setWireframe=function(t){h=t,c()},c(),t.exports=s},function(t,e){"use strict";var i={};i.OPAQUE_BIN=0,i.BACKGROUND=1,i.TRANSPARENT_BIN_NO_EARLYZ_PRE=9,i.TRANSPARENT_BIN=10,i.TRANSPARENT_BIN_NO_EARLYZ_POST=11,i.EXTRA=19,i.EDITOR_GIZMO=20,i.GRID=21,i.WIREFRAME=22,i.OUTLINE=23,i.DEBUG=24,i.DEBUG_2=25,t.exports=i},function(t,e,i){"use strict";var r=i(1097),n=i(1392),a=i(1393),s={FeatureName:"manipulator",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getManipulator=function(){return this._views[0]._switchManipulator},t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(239),a=i(1341),s=r.osg,fif(r),o=n.extend({defaults:{webVR:!1,indexManipulator:"fps"===a().navigation?1:0,node:void 0,eyeCamera:s.Vec3.create(),targetCamera:s.Vec3.create(),minSpeed:.1},getName:function(){return"Manipulator"},init:function(t){this._viewer=t.getViewer()},saveCameraPosition:function(){this._viewer.getFeaturesManager().getCameraWithoutAutospin(this.get("eyeCamera"),this.get("targetCamera"))},validateEyeTarget:function(t,e){var i=s.Vec3.distance(e,t);if(1e-8>=i)return!1;var r=this.get("node").getMinimumBound().radius();return.001*r>=i&&(s.Vec3.sub(e,t,e),s.Vec3.mult(e,.01*r/i,e),s.Vec3.add(t,e,e)),!0},getJSON:function(){return{position:s.Vec3.copy(this.get("eyeCamera"),s.Vec3.create()),target:s.Vec3.copy(this.get("targetCamera"),s.Vec3.create())}}}),u=new s.BoundingSphere;s.Node.prototype.getMinimumBound=function(t){t||(t=u),t.init();var e=this.getBoundingBox();e.valid()&&t.expandByBoundingBox(e);var i=this.getBound();return i.radius()<t.radius()?i:t},t.exports=o},function(t,e,i){"use strict";var r=i(258),n=i(1394),a=r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:indexManipulator",this.onIndexManipulatorChanged,this),t.bind("change:node",this.onNodeChanged,this),t.bind("change:minSpeed",this.onNodeChanged,this),t.bind("change:webVR",this.setVR,this),this._switchManipulator=new n,this._viewer=this.options.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._viewerOSGJS.setupManipulator(this._switchManipulator),this.onIndexManipulatorChanged()},setVR:function(){var t=this._viewerOSGJS.getManipulator(),e=this.model.get("webVR");t.setDelay(e?1:.15);var i=this._viewerOSGJS.getEventProxy();if(this._viewerOSGJS.requestContinuousUpdate(!0),e){this.lastMode=this.model.get("indexManipulator");var r=i.WebVR.getHmd(),a=!!r,s=!a;if(!s){var o=r.displayName.toLowerCase();(-1!==o.indexOf("cardboard")||-1!==o.indexOf("samsung"))&&(s=!0)}i.Hammer.setEnable(!1),i.WebVR.setEnable(a),i.DeviceOrientation.setEnable(!a),this.model.set("indexManipulator",n.FPS)}else i.DeviceOrientation.setEnable(!1),i.WebVR.setEnable(!1),i.Hammer.setEnable(!0),void 0!==this.lastMode&&this.model.set("indexManipulator",this.lastMode);var u=this._viewer.getFeatures();!u||u.webVR&&u.webVR.getModel().get("modeLauncher")||t.computeHomePosition()},onIndexManipulatorChanged:function(){this._switchManipulator.setManipulatorIndex(this.model.get("indexManipulator"))},onNodeChanged:function(){var t=this._switchManipulator;t.setNode(this.model.get("node"));var e=t.getManipulatorList()[n.ORBIT],i=t.getHomeBound().radius();e.setMinSpeed(this.model.get("minSpeed")*i),e.setMinDistance(.001*i)}});t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1395),a=i(1396),s=i(1362),o=i(1341),u=r.osg,fif(r),h=r.osgGA,l=h.OrbitManipulator.Interpolator.prototype,c=l.reset;l.reset=function(){c.call(this),this._epsilon=.01};var d=l.set;l.set=function(){d.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&s.draw()};var p=l.setTarget;l.setTarget=function(){p.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&s.draw()};var f=l.addTarget;l.addTarget=function(){f.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&s.draw()},l.isDone=function(){for(var t=Math.abs(this._epsilon),e=0,i=this._current.length;i>e;++e)if(Math.abs(this._target[e]-this._current[e])>t)return!1;return!0};var g=l.update;l.update=function(t){var e=g.call(this,t);if(this._epsilon>=0)if(this.isDone())for(var i=0,r=this._current.length;r>i;++i)this._current[i]=this._target[i];else s.draw();return e};var m=function(){for(var t=Math.abs(this._epsilon),e=0,i=this._current.length;i>e;++e)if(1===Math.abs(this._target[e])||Math.abs(this._target[e]-this._current[e])>t)return!1;return!0},v=function(t){t.isDone=m.bind(t)},_=function(){h.SwitchManipulator.call(this),this._boundStrategy=h.Manipulator.COMPUTE_HOME_USING_SPHERE|h.Manipulator.COMPUTE_HOME_USING_BBOX,this.init()};_.prototype=u.objectInherit(h.SwitchManipulator.prototype,{init:function(){h.SwitchManipulator.prototype.setManipulatorIndex.call(this,0);var t=new a(this._boundStrategy);t.getRotateInterpolator()._epsilon=.1,t.getPanInterpolator()._epsilon=.1,t.getZoomInterpolator()._epsilon=.001;var e=new n(this._boundStrategy);e.getLookPositionInterpolator()._epsilon=.1,e.getSideInterpolator()._epsilon=.001,v(e.getSideInterpolator()),e.getForwardInterpolator()._epsilon=.001,v(e.getForwardInterpolator()),e.getPanInterpolator()._epsilon=.001,v(e.getPanInterpolator()),e.getZoomInterpolator()._epsilon=.001,v(e.getZoomInterpolator()),this.addManipulator(t,"ORBIT"),this.addManipulator(e,"FPS"),void 0!==o().cameraEasing&&this.setDelay(1-o().cameraEasing)},getOrbitManipulator:function(){return this._manipulatorList[_.ORBIT]},getFirstPersonManipulator:function(){return this._manipulatorList[_.FPS]},_setManipulatorDelay:function(t,e){t.setDelay(e);for(var i=t._controllerList,r=Object.keys(i),n=0,a=r.length;a>n;++n){var s=i[r[n]];void 0!==s._delay&&(s._delay=e)}},setDelay:function(t){this._setManipulatorDelay(this._manipulatorList[_.ORBIT],t),this._setManipulatorDelay(this._manipulatorList[_.FPS],t)},addManipulator:function(t,e){h.SwitchManipulator.prototype.addManipulator.call(this,t),e&&(_[e]=this.getManipulatorList().length-1)},setManipulatorIndex:function(){var t=u.Vec3.create(),e=u.Vec3.create();return function(i){if(i!==this.getCurrentManipulatorIndex()){var r=_.ORBIT||0,n=this.getCurrentManipulator();h.SwitchManipulator.prototype.setManipulatorIndex.call(this,i);var a=this.getCurrentManipulator();n.getEyePosition(e),n.getTarget(t),i===r?(a.setTarget(t),a.setEyePosition(e)):(a.setEyePosition(e),a.setTarget(t))}}}(),setEyePosition:function(t,e){this.getCurrentManipulator().setEyePosition(t,e),s.draw()},getEyePosition:function(t){return this.getCurrentManipulator().getEyePosition(t)},setTarget:function(t){this.getCurrentManipulator().setTarget(t),s.draw()},getTarget:function(t){return this.getCurrentManipulator().getTarget(t)},setDistance:function(t){this.getCurrentManipulatorIndex()===_.ORBIT&&(this.getCurrentManipulator().setDistance(t),s.draw())},getDistance:function(){return this.getCurrentManipulator().getDistance()},computeHomePosition:function(t){h.SwitchManipulator.prototype.computeHomePosition.call(this,t),s.draw()}}),t.exports=_},function(t,e,i){"use strict";var r=i(1100),n=i(1341),a=r.osg,fif(r),s=r.osgGA,o=function(t){s.FirstPersonManipulator.call(this,t);var e=Math.max(0,Math.min(4,n().fpsSpeed/25));this._stepFactor=e,this.getControllerList().StandardMouseKeyboard._stepFactor=e,this._postMultRotate=a.Quat.create(),this._resetInitialVR=!1,this._lookPosition._delay=.25};o.prototype=a.objectInherit(s.FirstPersonManipulator.prototype,{getPostMultRotate:function(){return this._postMultRotate},setResetInitialRotationVR:function(t){this._resetInitialVR=t,t||a.Quat.init(this._postMultRotate)},setNode:function(t){s.FirstPersonManipulator.prototype.setNode.call(this,t);var e=this.getHomeBound();e&&e.valid()&&(this._distance=this.getHomeDistance(e))},setPoseVR:function(){var t=a.Vec3.create();return function(e,i){this._resetInitialVR&&(this._resetInitialVR=!1,a.Quat.inverse(e,this._vrRot),this._vrRot[0]=this._vrRot[1]=0,a.Quat.normalize(this._vrRot,this._vrRot),a.Quat.mult(this._vrRot,this._postMultRotate,this._postMultRotate)),a.Quat.mult(this._postMultRotate,e,this._vrRot),a.Quat.transformVec3(this._postMultRotate,i,t),a.Vec3.sub(t,this._vrPos,this._vrTrans),a.Vec3.copy(t,this._vrPos),this._vrEnable=!0}}()}),t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=r.osgGA,s=function(t){a.OrbitManipulator.call(this,t)},o=.99;s.prototype=n.objectInherit(a.OrbitManipulator.prototype,{setEyePosition:function(){var t=n.Vec3.create(),e=n.Vec3.create(),i=n.Vec3.create();return function(r,a){var s=this._rotation,u=this._target;if(n.Vec3.sub(r,u,t),n.Vec3.normalize(t,t),a){var h=n.Vec3.dot(t,this._upz);if(Math.abs(h)>o){var l=Math.sqrt((1-o*o)/(t[0]*t[0]+t[1]*t[1]));t[0]*=l,t[1]*=l,t[2]=o*Math.sign(h)}}n.Vec3.cross(t,this._upz,e),n.Vec3.normalize(e,e),n.Vec3.cross(e,t,i),n.Vec3.normalize(i,i),s[0]=e[0],s[1]=t[0],s[2]=i[0],s[3]=0,s[4]=e[1],s[5]=t[1],s[6]=i[1],s[7]=0,s[8]=e[2],s[9]=t[2],s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this._distance=n.Vec3.distance(r,u)}}()}),t.exports=s},function(t,e,i){"use strict";var r=i(1097),n=i(1398),a=i(1437),s=a.extend({getName:function(){return"Material"}}),o=n,u={FeatureName:"material",ModelType:s,ViewListType:[o]},h=r.create(u);h.prototype.getSceneLights=function(){return this._views[0].getSceneLights()},t.exports=h},function(t,e,i){"use strict";var r=i(236),n=i(219),a=i(1100),s=i(258),o=i(1399),u=i(1341),h=i(1099),l=i(1421),c=i(1434),d=i(1435),p=i(1359),f=i(1419),g=i(1420),u=i(1341),m=i(1436),v=a.osg,fif(a),_=s.extend({getName:function(){return"MaterialView3D"},initialize:function(){s.prototype.initialize.apply(this,arguments),this.model.bind("change",this.render,this),g.bind("change:mask",this.cleanAndApplyMaterials,this),this._sceneLights=[],this._defaultStateSet=void 0,this._defaultMaterial=void 0,this._renderingPaths=new c;var t=this.createImageCollection();this.model.setImageCollection(t.resource),this.model.imageCollection.isValid(),this.init()},init:function(){var t=this.options.context,e=t.getScene();this._viewer=t.getViewer(),this.resourceDefer=r.defer(),e.addResourcePromise(this.resourceDefer.promise),this._viewer.getPromisePolygon().then(this.initSceneGraph.bind(this))},createImageCollection:function(){return this.getResourceManager().getOrCreateImageCollection()},getResourceManager:function(){return this._resourceManager||h.instance},getOrCreateDefaultStateSet:function(){return void 0===this._defaultStateSet&&(this._defaultStateSet=new v.StateSet,this._defaultStateSet._uniqueID=0),this._defaultStateSet},getOrCreateDefaultMaterial:function(t,e){var i=this.getOrCreateDefaultStateSet();if(void 0===this._defaultMaterial){if(this._defaultMaterial=e.getMaterialByStateSet(i),this._defaultMaterial){var r=e.getUniqueMaterialName(i.getAttributeMap().Material,i,t);this._defaultMaterial.set("name",r)}else this._defaultMaterial=e.createMaterial(t,i);this._defaultMaterial.setStateSet(i)}return t.setStateSet(i),this._defaultMaterial},processSceneGraph:function(t,e){var i=new l(e),r=i.apply(t);return t.accept(this._renderingPaths),this.fixWrongRootEditUser(t,this._renderingPaths),this.pruneSceneGraph(this._renderingPaths),0===r.getMaterials().length&&this.getOrCreateDefaultMaterial(t,e),this._renderingPaths.getPathList().forEach(function(t){var i=t.some(function(t){var e=t.getStateSet();return e&&e.getAttribute("SketchfabMaterial")});if(!i){var r=t[t.length-1];this.getOrCreateDefaultMaterial(r,e)}}.bind(this)),this._sceneLights=r.getLights(),r},getSceneLights:function(){return this._sceneLights},fixWrongRootEditUser:function(t,e){var i=this.model,r=this.hasWrongRootEditUser(i);if(r){r.rootMaterialToKeep=!0;var a={};if(n.each(i.attributes,function(t){a[t.get("stateSetID")]=t}),2===n.size(i.attributes)){var s=n.filter(i.attributes,function(t){return t.get("stateSet")!==r.get("stateSet")})[0];for(var o in r.attributes.channels)r.attributes.channels[o].attributes.texture&&(s.attributes.channels[o].attributes.texture=r.attributes.channels[o].attributes.texture)}else for(var u=r,h=e.getStateSetPathList(),l=0,c=h.length;c>l;l++){var p=h[l];if(p[0]===u.attributes.stateSet)for(var f=p.length-1;f--;){var g=p[f];i.removeMaterialByStateSetID(g._uniqueID)}}var m=new d(a);t.accept(m),0!==m.removedStateSet.length&&(m.removedStateSet=m.removedStateSet.filter(function(t,e,i){var r=i.lastIndexOf(t)===e;return r&&-1===m.keepedStateSet.indexOf(t)}),n.each(m.removedStateSet,function(t){i.removeMaterialByStateSetID(t)}))}},initSceneGraph:function(){var t=this.options.context,e=this.model,i=t.getScene(),r=i.getRoot();u().process_material===!1&&n.each(t.getModel().get("options").materials,function(t){e.addMaterial(t)}),v.time("processSceneGraph (Sync)");var a=this.processSceneGraph(r,e);v.timeEnd("processSceneGraph (Sync)"),e.removeUnboundMaterial(),this._requestTextures(),this.applyMaterials(),this.model.trigger("change:materials"),this.model._style=a.getStyle();var s=a.hasMetallicWorkflow();s&&this.model.setWorkFlowMetalSpec(s,!1),o.resolvePromiseMaterial(),this.model.overrideMaterialChannels(u()),u().graphOptimizer&&m.optimize(this._renderingPaths,this._viewer)},pruneSceneGraph:function(t){for(var e=t.getStateSetMapNodes(),i=t.getStateSetPathList(),r=t.getStateSetMap(),n={},a=0,s=i.length;s>a;a++){var o=i[a];if(o.length>0){var u=o.length-1,h=o[u];n[h._uniqueID]=h}}for(var l=0,c=0,d=Object.keys(e),p=0,f=d.length;f>p;p++){var g=d[p];if(void 0===n[g]){this.model.removeMaterialByStateSet(r[g]),c++;for(var m=0,v=e[g].length;v>m;m++){var _=e[g][m];_.setStateSet(void 0),l+=v}}}},hasWrongRootEditUser:function(t){var e;return n.size(t.attributes)>1&&n.values(t.attributes)[0].get("version")<2&&(e=n.find(t.attributes,function(t){if(t.attributes&&t.attributes.name){var e=t.attributes.name.toLowerCase();if(-1!==e.indexOf("root")||-1!==e.indexOf("ollada visual")){var i=n.find(t.attributes.channels,function(t){return void 0!==t.getTexture()});if(void 0!==i)return!0}}return!1})),e},cleanAndApplyMaterials:function(){n.each(this.model.attributes,function(t){t.get("stateSet")&&t.trigger("change:stateSet")}),this.applyMaterials()},applyMaterials:function(){n.each(this.model.attributes,function(t){t.trigger("apply")})},_requestTexture:function(t,e,i){if(t){var r=t.getChannels()[e],n=r.getTexture();if(n&&r.isEffective()){var a=n.getTextureProxy();if(a){var s=a.getImageCount();if(0===s)return void r.setColor(v.Vec3.createAndSet(.9,.9,.9));var o=i?a.getImageSmallest():a.getImageMaxSupported();return o.promise}}}},_requestAllTextures:function(t,e){var i=this,r=[],a=new window.Set;return f.forEach(function(s){n.each(t,function(t){var n=i._requestTexture(t,s,e);n&&!a.has(n)&&(a.add(n),r.push(n))})}),r},_resolvePromiseTextures:function(t,e,i){for(var r=(new Date).getTime()-e,n=0,a=0,s=t.length;s>a;++a)t[a]!==!0&&n++;var u=i?o.resolvePromiseLowRes:o.resolvePromiseHighRes;u({time:n>0?r:0,count:n})},requestAllLowResTextures:function(t){return this._requestAllTextures(t,!0)},requestAllHighResTextures:function(t){return this._requestAllTextures(t,!1)},_resolvePromiseLowResTextures:function(t,e){return this._resolvePromiseTextures(t,e,!0)},_resolvePromiseHighResTextures:function(t,e){return this._resolvePromiseTextures(t,e,!1)},_requestTextures:function(){var t=this,e=this.options.context,i=e.getViewer(),n=u(),a=n.preload;p.WAIT_ANIMATION=!a;var s=this.model.toJSON(),o=this.requestAllLowResTextures(s),h=(new Date).getTime();a||i.setFakePrimaryProgress(o);var l=e.getFeatures().quality;l&&l.getModel().trigger("updateTexelPolicy"),r.settle(o).then(function(){t._resolvePromiseLowResTextures(o,h);var e=(new Date).getTime(),n=t.requestAllHighResTextures(s);i.setFakeProgress(n,a?!1:!0),r.settle(n).then(function(){t._resolvePromiseHighResTextures(n,e),a===!0&&t.resourceDefer.resolve()}),a||t.resourceDefer.resolve()})},getOrCreateTexelInfos:function(){if(this._infoTex)return this._infoTex;var t=this._infoTex={missingResolution:!1,count:0,size:0,min:1/0,max:-(1/0)},e=this.model.attributes,i={};return f.forEach(function(r){n.each(e,function(e){if(e){var n=e.getChannels()[r],a=n.getTexture();if(a&&n.isEffective()){var s=a.getTextureProxy();if(s&&!i[s.getInstanceID()]){i[s.getInstanceID()]=!0;var o=1,u=s.getInternalFormat();u===v.Texture.RGB?o=.75:(u===v.Texture.LUMINANCE||u===v.Texture.ALPHA)&&(o=.25);var h=s.getImageJSONMaxSupported();t.count++,t.size+=o*h.width*h.height;var l=Math.max(h.width,h.height);if(t.min=Math.min(l,t.min),t.max=Math.max(l,t.max),!t.missingResolution&&(h.width>512||h.height>512)){var c=s.getImageJSONMaxSupported(512);512!==c.width&&512!==c.height&&(t.missingResolution=!0)}}}}})}),t},render:function(){return this}});t.exports=_},function(t,e,i){"use strict";var r=i(1400),n=i(236),a=i(219),s=i(284),o=i(1401),u=i(1100),h=i(218),l=i(258),c=i(1093),d=i(1404),p=i(1405),f=i(1406),g=i(1099),m=i(1407),v=i(1408),_=i(1410),b=i(1414),x=i(1341),A=i(1362),y=i(1415),S=i(1416),C=i(1357),w=u.osg,T=u.osgViewer,M=new o({device:"VWR"}),E=function(t){var e=c()?0:1;return a.find(t,{flag:e})||t[0]||t},k=function(t){this._dataScene=t,this._modelFile=E(this._dataScene.files),this._root=new w.Node,this._root.setName("Scene - Root"),this._polygonNode=new w.Node,this._polygonNode.setName("Scene - PolygonNode"),this._wireframeNodes=[],this._resourcePromises=[];var e=function(t,e){return t.concat(e)},i=function(t){var e=t.lastIndexOf("/"),i=t.substr(0,e+1);return i},r=i(this.getPolygonURL());this._dataScene.options&&this._dataScene.options.materials&&a.each(this._dataScene.options.materials,function(t){a.each(t.channels,function(t){t.texture&&(t.texture.image&&(t.texture.image=e(r,t.texture.image)),t.texture.url&&(t.texture.url=e(r,t.texture.url)))})})};k.prototype={addResourcePromise:function(t){this._resourcePromises.push(t)},getJSON:function(){return this._dataScene},getPolygonURL:function(){return this._modelFile.osgjsUrl},getWireframeURL:function(){return this._modelFile.wireframeUrl},getPolygonSize:function(){return this._modelFile.modelSize},getWireframeSize:function(){return this._modelFile.wireframeSize},getResourceManager:function(){return this._resourceManager||g.instance},getRoot:function(){return this._root},resourcesReady:function(){return this._resourcePromises},getPolygonNode:function(){return this._polygonNode},getWireframeNodes:function(){return this._wireframeNodes},loadPolygon:function(t,e,i,r,a){var s={progress:t,size:this.getPolygonSize(),secondary:!1,idChannel:1,node:this.getPolygonNode()};e&&(s.wireframeOptions={progress:a===!0?t:void 0,size:this.getWireframeSize(),secondary:!1,idChannel:2,startPromise:i,deferDownload:n.defer(),nodes:this.getWireframeNodes()});var o=this.getResourceManager().getOrCreateModel(this.getPolygonURL(),s);if(e){var u=w.Timer.instance().tick();s.wireframeOptions.deferDownload.promise.then(function(){r.resolve({time:w.Timer.instance().tick()-u
})}.bind(this))}return this.getRoot().addChild(this.getPolygonNode()),this.getResourceManager().run(),o.promise},loadWireframe:function(t){var e={progress:t,size:this.getWireframeSize(),secondary:!1,idChannel:2,node:new w.Node},i=this.getResourceManager().getOrCreateModel(this.getWireframeURL(),e);return this.getWireframeNodes().push(e.node),this.getRoot().addChild(e.node),i.promise}};var I=l.extend({initialize:function(){l.prototype.initialize.apply(this,arguments),this._root=null,this._features=this.options.features,this._widgetAPI=this.options.widgetAPI,this._widgetAPI&&this._widgetAPI.getTabbedWidget().model.on("change",A.draw),this._featuresInstancied={};var t=this.$(".canvas"),e=t[0];e.oncontextmenu=function(){return!1};var r=-1;s.any&&(r=1.5);var a=!0,o=x().preserveDrawingBuffer;w.Geometry.enableVAO=x().useVAO;var u=this._viewer=new T.Viewer(e,{antialias:!1,alpha:a,premultipliedAlpha:!0,fullscreen:!1,preserveDrawingBuffer:o,depth:!0,//!isVR,
stencil:!1,enableFrustumCulling:!1,maxDevicePixelRatio:r,scrollwheel:x().scrollwheel,EventBackend:{StandardMouseKeyboard:{keyboardEventNode:t[0]},GamePad:{enable:!1}}});u.setContextLostCallback(function(){this._contextLost=!0,w.warn("Context Lost");var t=i(267),e=new t({title:"3D/WebGL context error",text:"Your browser seems to have hit its 3D capability limit. The page needs to be reloaded to fix this. <br/>If the problems persists, you can try to close other tabs with 3D/WebGL or restart your browser entirely.",safe:!0,buttons:{"continue":!0,continueLabel:"OK",cancel:!0}});e.open().then(function(){window.location.reload()})}.bind(this)),u.getState().getShaderGeneratorProxy().addShaderGenerator("earlyZ",new y),u.getState().getShaderGeneratorProxy().addShaderGenerator("ShadowCastSkfb",new S);for(var h=b(),c=u.getState(),d=0;h>d;d++)c.setGlobalDefaultTextureAttribute(d,w.Texture.textureNull);u.requestContinuousUpdate(x().continuousRender),t[0].setAttribute("tabindex","0"),u.init(),this.getCamera().getRenderer().setCullVisitor(new p),u.setupManipulator(),this._root=new w.MatrixTransform,u.getCamera().setClearColor(w.Vec4.create()),u.setSceneData(this._root),A.setViewer(u),this._superSample=new f(this),this._superSample.setCanBeEnabled(x().supersample),A.setSuperSample(this._superSample),this._superSample.setRoot(this._root),u.getManipulator().computeHomePosition(),u.run(),this._deferPolygon=n.defer(),this._deferWireframe=n.defer(),this._deferModelDisplayed=n.defer(),this._currentScene=void 0},getRootUserData:function(){return this._currentScene?this._currentScene.getRoot().userDataMap||{}:{}},getWidth:function(){return this.getCanvas().width},getHeight:function(){return this.getCanvas().height},getOptions:function(){return this.options},isViewerReady:function(){return this._isLoaded},createContext:function(t){var e=new m({model:t.model,viewer:this,scene:t.scene,widgetAPI:this._widgetAPI});return e},updateProgress:function(t,e,i){var r=e?this._channelsSecondary:this._channelsPrimary,n=e?this._channelsSecondaryWeights:this._channelsPrimaryWeights;r[i]=t;for(var a=0,s=0;s<r.length;++s)a+=r[s]*n[s];this.trigger(e?"secondary-progress":"primary-progress",{progress:a})},initProgress:function(t){var e=x().preload;this._channelsPrimary=[0,0],t&&this._channelsPrimary.push(0),this._channelsPrimaryWeights=[],this._channelsPrimaryWeights[0]=e?.5:.1,this._channelsPrimaryWeights[1]=e?.5:.9,t&&(this._channelsPrimaryWeights[2]=this._channelsPrimaryWeights[1]=.5*this._channelsPrimaryWeights[1]),this._channelsSecondary=[0],this._channelsSecondaryWeights=[1]},setFakeSecondaryProgress:function(t,e){this.setFakeProgress(t,!0,e)},setFakePrimaryProgress:function(t,e){this.setFakeProgress(t,!1,e)},setFakeProgress:function(t,e,i){void 0===this._idLastProgress&&(this._idLastProgress=0),i=i||0,t=void 0!==t.length?t:[t];var r=t.length;if(0===r)return void this.updateProgress(1,e,i);for(var n=0,a=++this._idLastProgress,s=function(){a===this._idLastProgress&&this.updateProgress(++n/r,e,i)}.bind(this),o=0;r>o;++o)t[o]["finally"](s);var u=0,h=0,l=function(){if(a===this._idLastProgress){if(u!==n){if(n===r)return;u=n,h=n/r}var t=(n+1)/r;t>h&&(h=Math.min(t-.01,h+.01/r),this.updateProgress(h,e,i)),window.setTimeout(l,100)}}.bind(this);window.setTimeout(l,100)},getPromisePolygon:function(){return this._deferPolygon.promise},getPromiseWireframe:function(){return this._deferWireframe.promise},getPromiseLowResLoaded:function(){return I.getPromiseLowRes()},getPromiseHighResLoaded:function(){return I.getPromiseHighRes()},getPromiseModelDisplayed:function(){return this._deferModelDisplayed.promise},getPromiseMaterialLoaded:function(){return I.getPromiseMaterial()},preloadWire:function(t,e){var i=t.loadWireframe(e),r=w.Timer.instance().tick();return i.then(function(){this._deferWireframe.resolve({time:w.Timer.instance().tick()-r})}.bind(this)),i},run:function(t){var e=n.defer();this._isLoaded=e.promise;var i=this;v(t);var s=this.getOrCreateScene(t.toJSON());s.getResourceManager().setModelUID(t.get("uid")),C.resolvePromise(s.getJSON().animationCount>0||c()&&t.get("options").animation&&t.get("options").animation.order&&t.get("options").animation.order.length>0);var o=this.createContext({model:t,scene:s}),u=[],h=x().preload,l=E(t.get("files")),d=t.get("options").wireframe.enable===!0&&h===!0&&void 0!==l.wireframeSize&&l.wireframeSize>0,p=l.wireframeUrl&&l.wireframeSize?!1:!0,f=d?n.resolve():i.getPromiseHighResLoaded(),g=s.loadPolygon(this.updateProgress.bind(this),p,f,this._deferWireframe,d);u.push(g);var m=w.Timer.instance().tick();return g.then(function(){i._deferPolygon.resolve({time:w.Timer.instance().tick()-m})}),!p&&d&&u.push(this.preloadWire(s,this.updateProgress.bind(this))),w.time("createAndInitFeatures (Sync)"),i._features.forEach(function(t){i.addFeature(t,o)}),w.timeEnd("createAndInitFeatures (Sync)"),this.initProgress(d),n.all(u).then(function(){n.all(s.resourcesReady()).then(function(){i._deferModelDisplayed.resolve({time:w.Timer.instance().tick()-m}),a.defer(a.defer.bind(a,function(){if(x().messaging){var t=M.createMessage({data:"ready"});t.appendToHash()}}.bind(this))),w.time("featureFinished (Sync)"),i.featureFinished(o,i._root),w.timeEnd("featureFinished (Sync)"),p||d||i.getPromiseHighResLoaded().then(function(){i.preloadWire(s)}),i.trigger("primary-progress",{progress:1}),r.logBound(i.getOrCreateScene().getRoot()),r.showMessage(),e.resolve(o),i.trigger("success"),i.trigger("viewerready"),A.setLoaded(!0)})}),this._featuresInstancied=o.getFeatures(),e.promise},onFail:function(t,e){w.error(e.stack),t.reject(e),this.trigger("failure")},addFeature:function(t,e){if(!t)return console.warn("Feature undefined!"),!0;var i=new t;i.init(e)},drawFrame:function(){var t=this._viewer.getState(),e=t.getGraphicContext();e.colorMask(!1,!1,!1,!1),this._viewer.frame(),e.colorMask(!0,!0,!0,!0)},getCanvas:function(){return this._viewer.getGraphicContext().canvas},setTimeline:function(t){this._timeline=t},getTimeline:function(){return this._timeline},getScreenShot:function(t,e){return d(t,e,this)},getCamera:function(){return this._viewer.getCamera()},getFeatures:function(){return this._featuresInstancied},getSuperSample:function(){return this._superSample},getFeaturesManager:function(){return this._featuresManager},getViewerOSGJS:function(){return this._viewer},getOrCreateScene:function(t){if(this._currentScene)return this._currentScene;var e=new k(t);return e.getResourceManager().setStateContextOSG(this._viewer.getState()),this._currentScene=e,e},featureFinished:function(t,e){return this._featuresManager=new _(this,t),this._featuresManager.finished(e)},getOptionsJSON:function(){var t=this.getFeatures(),e={};e.version=h.optionsVersion,e.background=t.background.getModel().getJSON(),e.environment=t.environment.getModel().getJSON(),e.lighting=t.lighting.getModel().getJSON(),e.scene=t.fov.getModel().getJSON(),e.materials=t.material.getModel().getJSON(),e.orientation=t.orientation.getModel().getJSON(),e.camera=t.manipulator.getModel().getJSON(),e.animation=t.animation.getModel().getJSON(),e.hotspot=t.hotspot.getModel().getJSON(),e.vr=t.webVR.getModel().getJSON(),e.scene=e.scene||{},e.scene.postProcess=t.postProcess.getModel().getJSON();var i=t.shadingStyle.getModel().getJSON();return e.shading=i.shading,e.wireframe=i.wireframe,v.readOptions(e)}}),N=n.defer(),R=n.defer(),F=n.defer();I.getPromiseLowRes=function(){return N.promise},I.getPromiseHighRes=function(){return R.promise},I.getPromiseMaterial=function(){return F.promise},I.resolvePromiseLowRes=N.resolve.bind(N),I.resolvePromiseHighRes=R.resolve.bind(R),I.resolvePromiseMaterial=F.resolve.bind(F),t.exports=I},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=!1,s=n.Timer.prototype.tick,o=function(){this.children=[],this.preMessage="",this.message="",this.start=s(),this.parent=this},u={},h={},l=new o,c=l;n.time=function(t){var e=u[t]=new o;c.children.push(e),e.parent=c,c=e,e.preMessage=t},n.timeEnd=function(t){var e=u[t];c=e.parent||l,e.message=t+" : "+(s()-e.start).toFixed(2)+"ms",a&&h.showMessage()};var d=function(t,e){for(var i=t.children,r=t!==l&&i.length>0?t.preMessage+"\n":"",n=0;n<i.length;++n)r+=e+d(i[n],e+"  |  ")+"\n";var a=t.parent===l?"\n":"";return r+t.message+a};h.showMessage=function(){console.log("%c"+d(l,""),"color:purple"),a=!0,l.children.length=0},h.logBound=function(t){var e=t.getMinimumBound(),i=e.center(n.Vec3.create()),r=new o;r.message="Bound center : [ "+i[0]+", "+i[1]+", "+i[2]+" ]\n",r.message+="Bound radius : "+e.radius();var a=t.getBoundingBox();r.message+="\nBbox min: [ "+a._min[0]+", "+a._min[1]+", "+a._min[2]+" ]",r.message+="\nBbox max: [ "+a._max[0]+", "+a._max[1]+", "+a._max[2]+" ]",r.message+="\n",c.children.push(r)},t.exports=h},function(t,e,i){var r=i(1402),n=":",a=";",s=",",o="=",u="&",h=function(t){t=t||"",t=decodeURIComponent(t);var e={},i=t.split(u);return i.forEach(function(t){if(t.indexOf(o)>-1){var i=t.split(o);i[1].indexOf(s)>-1&&(i[1]=i[1].split(s)),e[i[0]]=i[1]}else e=t.indexOf(s)>-1?t.split(s):t}.bind(this)),e},l=function(t,e){var i=t;i.indexOf("#")>-1&&(i=i.slice(1));var r=i.split(a),n=[];for(var s in r){var o=new d(c(r[s]));o.from&&o.from===e||!o.data||n.push(o)}return n},c=function(t){var e=t,i={};e.indexOf("#")>-1&&(e=e.slice(1));var r=e.split(n);return 1===r.length?i.data=r[0]:2===r.length?(i.from=r[0].toUpperCase(),i.data=r[1]):3===r.length&&(i.from=r[0].toUpperCase(),i.to=r[1].toUpperCase(),i.data=r[2]),i.data&&(i.stringData=i.data,i.data=h(i.data)),i._originalString=t+a,i},d=function(t){var e=t;"string"==typeof t&&(e=c(t)),this._msg=e,this.from=e.from,this.to=e.to,this.data=p(e.data)},p=function(t){return"string"==typeof t?t=decodeURIComponent(t):Array.isArray(t)?t=t.map(decodeURIComponent):"object"===(typeof t).toLowerCase()&&Object.keys(t).forEach(function(e){"string"==typeof t[e]?t[e]=decodeURIComponent(t[e]):Array.isArray(t[e])&&(t[e]=t[e].map(decodeURIComponent))}.bind(this)),t};d.prototype._getStringifiedData=function(){var t="";if("string"==typeof this.data)return encodeURIComponent(this.data);if(Array.isArray(this.data))return this.data.map(encodeURIComponent).join(",");if("object"==typeof this.data)for(var e in this.data){var i;"string"==typeof this.data[e]?i=encodeURIComponent(this.data[e]):Array.isArray(this.data[e])&&(i=this.data[e].map(encodeURIComponent).join(",")),t+=e+o+i}return t},d.prototype.toString=function(){var t="";return this.from&&(t+=this.from+n),this.to&&(t+=this.to+n),t+=this._getStringifiedData()+a};var f=function(t){if(t=t||{},!t.device)throw new Error('ViewerHashAPI options need to contain the "device" identifier property');t.listen&&this.listen(t.listen),this.device=t.device};f.prototype.appendToHash=function(t,e){t instanceof d&&(t=t.toString()),"string"==typeof t&&(e=g(e),-1===e.location.hash.indexOf(t)&&(e.location.hash=e.location.hash+t))},f.prototype.removeFromHash=function(t,e){if(!(t instanceof d))throw new Error("Please supply an instance of ViewerHashMessage");e=g(e);var i=e.location.hash;i=t._msg&&t._msg._originalString?i.replace(t._msg._originalString,""):i.replace(t.toString(),""),e.location.hash=i};var g=function(t){if(t=(t===!0?window:t)||window,t&&t.tagName&&"iframe"===t.tagName.toLowerCase()&&(t=t.contentWindow),!t.addEventListener)throw new Error("Could not bind an event to supplied target. Please supply an instance of window or an iframe.");return t};f.prototype.listen=function(t){return t=g(t),t.addEventListener("hashchange",this._onHashChange.bind(this,t),!1)},f.prototype._onHashChange=function(t){var e=this.getMessages(t.location.hash);(e.messages||[]).forEach(function(t){if(t&&t.data&&!Array.isArray(t)){var e=t.data;if("object"==typeof t.data){var i=Object.keys(t.data);e=t.data._key?t.data._key:i[0]}e&&this.trigger("message:"+e,t)}this.trigger("message",t)}.bind(this))},f.prototype.getMessages=function(t){var e=l(t,this.device),i=t;for(var r in e)i=e[r]._msg&&e[r]._msg._originalString?i.replace(e[r]._msg._originalString,""):i.replace(e[r].toString(),"");return{messages:e,hash:i}},f.prototype.createMessage=function(t){return t=t||{},t.from=this.device,new d(t)},r.mixin(f.prototype),d.prototype.removeFromHash=function(){f.prototype.removeFromHash.call(this,this)},d.prototype.appendToHash=function(){f.prototype.appendToHash.call(this,this)},t.exports=f},function(t,e,i){t.exports=i(1403)},function(t,e,i){!function(){function i(){return{keys:Object.keys||function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("keys() called on a non-object");var e,i=[];for(e in t)t.hasOwnProperty(e)&&(i[i.length]=e);return i},uniqueId:function(t){var e=++o+"";return t?t+e:e},has:function(t,e){return a.call(t,e)},each:function(t,e,i){if(null!=t)if(n&&t.forEach===n)t.forEach(e,i);else if(t.length===+t.length)for(var r=0,a=t.length;a>r;r++)e.call(i,t[r],r,t);else for(var s in t)this.has(t,s)&&e.call(i,t[s],s,t)},once:function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}}}}var r,n=Array.prototype.forEach,a=Object.prototype.hasOwnProperty,s=Array.prototype.slice,o=0,u=i();r={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,i){if(!l(this,"once",t,[e,i])||!e)return this;var r=this,n=u.once(function(){r.off(t,n),e.apply(this,arguments)});return n._callback=e,this.on(t,n,i)},off:function(t,e,i){var r,n,a,s,o,h,c,d;if(!this._events||!l(this,"off",t,[e,i]))return this;if(!t&&!e&&!i)return this._events={},this;for(s=t?[t]:u.keys(this._events),o=0,h=s.length;h>o;o++)if(t=s[o],a=this._events[t]){if(this._events[t]=r=[],e||i)for(c=0,d=a.length;d>c;c++)n=a[c],(e&&e!==n.callback&&e!==n.callback._callback||i&&i!==n.context)&&r.push(n);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t],r=this._events.all;return i&&c(i,e),r&&c(r,arguments),this},stopListening:function(t,e,i){var r=this._listeners;if(!r)return this;var n=!e&&!i;"object"==typeof e&&(i=this),t&&((r={})[t._listenerId]=t);for(var a in r)r[a].off(e,i,this),n&&delete this._listeners[a];return this}};var h=/\s+/,l=function(t,e,i,r){if(!i)return!0;if("object"==typeof i){for(var n in i)t[e].apply(t,[n,i[n]].concat(r));return!1}if(h.test(i)){for(var a=i.split(h),s=0,o=a.length;o>s;s++)t[e].apply(t,[a[s]].concat(r));return!1}return!0},c=function(t,e){var i,r=-1,n=t.length,a=e[0],s=e[1],o=e[2];switch(e.length){case 0:for(;++r<n;)(i=t[r]).callback.call(i.ctx);return;case 1:for(;++r<n;)(i=t[r]).callback.call(i.ctx,a);return;case 2:for(;++r<n;)(i=t[r]).callback.call(i.ctx,a,s);return;case 3:for(;++r<n;)(i=t[r]).callback.call(i.ctx,a,s,o);return;default:for(;++r<n;)(i=t[r]).callback.apply(i.ctx,e)}},d={listenTo:"on",listenToOnce:"once"};u.each(d,function(t,e){r[e]=function(e,i,r){var n=this._listeners||(this._listeners={}),a=e._listenerId||(e._listenerId=u.uniqueId("l"));return n[a]=e,"object"==typeof i&&(r=this),e[t](i,r,this),this}}),r.bind=r.on,r.unbind=r.off,r.mixin=function(t){var e=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return u.each(e,function(e){t[e]=this[e]},this),t},"undefined"!=typeof t&&t.exports&&(e=t.exports=r),e.BackboneEvents=r}(this)},function(t,e,i){"use strict";var r,n,a=i(1100),s=i(1341),o=i(1362),u=i(1357),h=a.osg,fif(a),l=document.createElement("canvas"),c=document.createElement("canvas"),d=!1;u.getPromise().then(function(t){t&&(d=t)});var p=function(t,e,i){var r=t.getGraphicContext(),a=l,s=a.getContext("2d"),o=e.width,u=e.height,h=4*o,c=h*u;(a.width!==o||a.height!==u)&&(a.width=o,a.height=u,n=new Uint8Array(c));for(var d=n;r.checkFramebufferStatus(r.FRAMEBUFFER,i)!==r.FRAMEBUFFER_COMPLETE;);r.flush(),r.finish(),r.readPixels(0,0,o,u,r.RGBA,r.UNSIGNED_BYTE,d);var p=s.getImageData(0,0,o,u);return p.data.set(d),s.putImageData(p,0,0),a},f=function(t,e,i,n){var a=e.width,o=e.height,u=i;u||(u=a);var h=1/(a/o);n&&(h=n);var l=[u,Math.floor(u*h)],d=p(t,e),f=c;(f.width!==l[0]||f.height!==l[1])&&(f.width=l[0],f.height=l[1]);var g=1/(a/o),m=h,v=f.getContext("2d"),_=0,b=0,x=a,A=o;if(m>g){var y=A/m;_=(x-y)/2,x=y}else if(g>m){var S=x*m;b=(A-S)/2,A=S}return v.clearRect(0,0,l[0],l[1]),v.fillStyle="transparent",v.fillRect(0,0,l[0],l[1]),v.save(),v.scale(1,-1),v.drawImage(d,_,b,x,A,0,-l[1],l[0],l[1]),v.restore(),s().downloadPicture&&(r||(r=document.createElement("a"),document.body.appendChild(r),r.style.display="none"),r.href=e.toDataURL("image/jpeg"),r.download="image.jpg",r.click()),f},g=!1,m=function(t,e,i){g&&h.warn("Screenshot already processing"),g=!0;var r,n,a,s,u,l,c,p,m,v,_=i.getCanvas(),b=i.getSuperSample(),x=i.getViewerOSGJS(),A=i.getFeatures(),y=A.orientation,S=A.webVR,C=A.outline,w=A.lighting,T=A.hotspot,M=A.animation,E=i.getFeaturesManager().getNodeGizmo(),k=!1;d&&M&&(k=M.getModel().get("playing"),M.getModel().set("playing",!1));var I,N=i.getOptions().widgetAPI;N&&(w&&w.getModel().get("enable")&&(n=w.getNodeLight(),l=n.getNodeMask(),n.setNodeMask(0),I=!0),E&&E.getNodeMask()&&(p=E.getNodeMask(),E.setNodeMask(0),I=!0),C&&(a=C.getNode(),a.hideOutline()),y&&(r=y.getNodeGrid(),r&&r.isVisible()&&(c=r.getNodeMask(),r.setNodeMask(0),I=!0))),T&&(u=T.getNodeProxy(),u.getNodeMask()&&(v=u.getNodeMask(),u.setNodeMask(0),I=!0)),S&&(s=S.getNodeProxy(),s.getNodeMask()&&(m=s.getNodeMask(),s.setNodeMask(0),I=!0));var R,F=b&&b.canBeEnabled()?b.getSampleCount():1;if(x.getCamera().setFinalDrawCallback(function(i){F--,b&&b.isEnabled()||(R=f(i,_,t,e),x.getCamera().setFinalDrawCallback(void 0),o.setPoseForScreenshot(!1),g=!1,k&&M.getModel().set("playing",!0),I&&(l&&n.setNodeMask(l),c&&r.setNodeMask(c),p&&E.setNodeMask(p),m&&s.setNodeMask(m),v&&u.setNodeMask(v),o.draw()))}),o.setPoseForScreenshot(!0),F>1&&b.forceEnable(),x.getCamera()){var P=x.getCamera().getRenderer(),D=x.getScene(),L=x.getUpdateVisitor();if(D.updateSceneGraph(L),I&&(l&&n.setNodeMask(0),c&&r.setNodeMask(0),p&&E.setNodeMask(0),m&&s.setNodeMask(0),v&&u.setNodeMask(0)),P.cull(),P.draw(),F>0)for(;b.isEnabled();)b.updateFrame(),D.updateSceneGraph(L),I&&(l&&n.setNodeMask(0),c&&r.setNodeMask(0),p&&E.setNodeMask(0),m&&s.setNodeMask(0),v&&u.setNodeMask(0)),P.cull(),P.draw()}return R};t.exports=m},function(t,e,i){"use strict";var r=i(1100),n=i(1388),a=r.osg,fif(r),s=function(){a.CullVisitor.call(this),this._uNearFar=a.Uniform.createFloat2(a.Vec2.createAndSet(1,-1),"uNearFar"),this._separateVR=!1,this._isEnv=!1},o=s.vrConfig={doVR:!1,leftRenderWidth:0,rightRenderWidth:0,leftRenderHeight:0,rightRenderHeight:0,rightProjection:a.Matrix.create(),leftProjection:a.Matrix.create(),leftOffsetView:a.Matrix.create(),rightOffsetView:a.Matrix.create()};s.prototype=a.objectInherit(a.CullVisitor.prototype,{popCameraModelViewProjectionMatrix:function(t){this.popModelViewMatrix(),this.popProjectionMatrix(t)},reset:function(){a.CullVisitor.prototype.reset.call(this),this._minNear=this._computedNear,this._maxFar=this._computedFar},updateNearFar:function(){this._minNear=Math.min(this._minNear,this._computedNear),this._maxFar=Math.max(this._maxFar,this._computedFar)},getNearFarUniform:function(){return this._uNearFar},popProjectionMatrix:function(t){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var e=this.getCurrentProjectionMatrix(),i=void 0!==t&&!t.isRenderToTextureCamera()&&t.getReferenceFrame()===a.Transform.RELATIVE_RF,r="PostProcess - MainCamera"===t.getName();if((i||r)&&this.updateNearFar(),r){var n=this._projectionMatrixStack[0];a.Matrix.copy(e,n),a.Matrix.clampProjectionMatrix(n,this._minNear,this._maxFar,1e-5),o.doVR&&(a.Matrix.clampProjectionMatrix(o.leftProjection,this._computedNear,this._computedFar,this._nearFarRatio),a.Matrix.clampProjectionMatrix(o.rightProjection,this._computedNear,this._computedFar,this._nearFarRatio)),a.Matrix.clampProjectionMatrix(e,this._computedNear,this._computedFar,this._nearFarRatio,this._uNearFar.getInternalArray())}else a.Matrix.clampProjectionMatrix(e,this._computedNear,this._computedFar,this._nearFarRatio)}a.CullStack.prototype.popProjectionMatrix.call(this)},handleCullCallbacksAndTraverse:function(t){var e=o.doVR&&"PostProcess - node Out"===t.getName();e&&(this._separateVR=!0);var i="Environment - Camera"===t.getName();i&&(this._isEnv=!0);var r=t.getCullCallback();(!r||r.cull(t,this))&&(this.traverse(t),i&&(this._isEnv=!1),e&&(this._separateVR=!1))},pushLeaf:function(t,e){var i=this._currentStateGraph.leafs;0===i.length&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var r=this._separateVR&&this.traversalMask!==n.SHADOW_CAST,s=this.createOrReuseRenderLeaf();if(s.isVR=r,r){var u=this._isEnv,h=this.getCurrentModelViewMatrix();s.leftProjection=o.leftProjection,s.rightProjection=o.rightProjection,s.leftEye=u?h:a.Matrix.mult(o.leftOffsetView,h,a.Matrix.create()),s.rightEye=u?h:a.Matrix.mult(o.rightOffsetView,h,a.Matrix.create())}s.init(this._currentStateGraph,t,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelWorldMatrix(),e),i.push(s)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(1341),a=i(1362),s=r.osg,fif(r),o=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],u=function(t){return u.instance?u.instance:(this._canBeEnabled=!0,this._viewer=t,this._sampleCount=15,this._motionBlur=n().motionBlur,this._motionBlurCount=n().motionBlurCount,this._isSupersampling=!1,this._frameNum=1,this._switch=!0,u.instance=this,this)};u.prototype={getSampleCount:function(){return this._sampleCount},setCanBeEnabled:function(t){this._canBeEnabled=t},canBeEnabled:function(){return n().supersample&&this._canBeEnabled},getOrCreateJitterUniform:function(){return this._jitterUniform?this._jitterUniform:(this._jitterUniform=s.Uniform.createFloat4("uHalton"),this._jitter=this._jitterUniform.getInternalArray(),this._jitter[2]=1,this._jitterUniform)},getSortedJitterTable:function(){return o},updateUniforms:function(){var t=this.getSortedJitterTable()[this._frameNum-1];this._jitter[0]=t[0],this._jitter[1]=t[1]},setSwitch:function(t){this._switch=t},updateFrame:function(){return this._jitter[2]=-this._jitter[2],this._postProcess.getModel().trigger("pingPongTexture0",this._jitter[2]>0),this._isSupersampling?(this._jitter[3]=this._frameNum,this.updateUniforms(),this._frameNum++,this.isSupersampled()&&(this._isSupersampling=!1),this._isSupersampling):!1},update:function(t,e){if(this._switch){var i=e.getFrameStamp().getFrameNumber();this._lastUpdateFrame!==i&&(this._lastUpdateFrame=i,(this._postProcess||(this._postProcess=this._viewer.getFeatures().postProcess,this._postProcess))&&this.updateFrame()&&a.drawSameFrame())}},isSupersampled:function(){return this._frameNum>this._sampleCount},isEnabled:function(){return this._isSupersampling},forceEnable:function(){this._isSupersampling=!0,this._jitter[0]=0,this._jitter[1]=0,this._jitter[2]=2*Math.sign(this._jitter[2]),this._jitter[3]=0,this._frameNum=1,a.drawSameFrame()},enable:function(){this.canBeEnabled()&&1===this._frameNum&&this.forceEnable()},reset:function(){this._jitter[0]=0,this._jitter[1]=0,this._jitter[2]=Math.sign(this._jitter[2])*(this._motionBlur?3:1),this._frameNum=1,this._isSupersampling=!1},setRoot:function(t){var e=t.getOrCreateStateSet();e.addUniform(this.getOrCreateJitterUniform());var i=new s.Node("supersampleUpdateInterceptor");t.addChild(i),i.addUpdateCallback(this)}},t.exports=u},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=n.osg,fif(n),s=function(t){this._model=void 0!==t?t.model:void 0,this._viewer=void 0!==t?t.viewer:void 0,this._scene=void 0!==t?t.scene:void 0,this._widgetAPI=void 0!==t?t.widgetAPI:void 0,this._features={}};s.prototype={getModel:function(){return this._model},getFeatures:function(){return this._features},getViewer:function(){return this._viewer},getScene:function(){return this._scene},getWidgetAPI:function(){return this._widgetAPI},addFeature:function(t){if(t){var e=t.getName();this._features[e]?a.error("Feature already added"+e):this._features[e]=t}return this._features},getModelByName:function(t){if(t){var e=r.find(this._features,function(e){var i=e.getModel();return i&&i.getName&&i.getName()===t?!0:!1});return e?e.getModel():void 0}},getViewsByName:function(t){if(t){var e=[];return r.forEach(this._features,function(i){if(i){var r=i._views.filter(function(e){return e.getName?e.getName()===t:!1});Array.prototype.push.apply(e,r)}}),e}}},t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(219),a=i(1409),s=r.osg,fif(r),o=function(t,e){var i=[],r={},a=0,s=function(t,n){if(!r[n]){r[n]=n;var s="https://media.sketchfab.com/urls/"+e+"/"+n,o={uid:n,name:n,images:[{url:s,uid:n,width:4096,height:4096}]};t.uid=r[n],delete t.image,delete t.url,i.push(o),a++}t.uid=r[n],delete t.image,delete t.url};n.each(t,function(t){n.each(t.channels,function(t){if(t.texture){var e=t.texture.url||t.texture.image;!e&&t.texture.uid&&(e=t.texture.uid),e&&s(t.texture,e)}})}),window.prefetchedData["/i/models/"+e+"/textures"]={results:i}},u=function(t,e,i){return Math.max(e,Math.min(i,t))},h=function(t){if(t.orientation.axis){var e=t.orientation.axis;e=s.Vec3.createAndSet(u(e[0],0,3),u(e[1],0,3),u(e[2],0,3)),delete t.orientation.axis;var i=(4-e[0])%4,r=(4-e[1])%4,o=(4-e[2])%4;t.orientation.matrix=s.Matrix.makeRotate(.5*Math.PI*(i+r+o),i,r,o,s.Matrix.create())}switch(t.shading.renderer||(t.shading.renderer="pbr"===t.shading.type?"pbr":"classic"),t.shading.type){case"lit":case"matcap":case"shadeless":case"pbr":break;case"blending":case"default":case"default-shading":case"predefined-shading":case"shading":case void 0:t.shading.type="lit";break;default:case"no-shading":t.shading.type="shadeless"}t.shading.vertexColor||"pbr"!==t.shading.renderer||(t.shading.vertexColor={enable:!1,colorSpace:"linear"});var h=t.environment;void 0!==h.exposure&&(h.exposure*=void 0!==h.light&&h.light>0?h.light:1);var l=t.environment.backgroundEnable;if(void 0!==l&&t.environment.enable===!0?l===!0?t.background.enable="environment":t.background.enable=t.background.enable===!0?"fixed":"none":void 0!==t.background.enable&&(t.background.enable===!0?t.background.enable="fixed":t.background.enable===!1&&(t.background.enable="none")),n.each(t.materials,function(e,i){"object"==typeof e?void 0===e.stateSetID?delete t.materials[e.id]:a(e):delete t.materials[i]}),t.lighting.lights)for(var c=t.lighting.lights,d=0,p=c.length;p>d;++d){var f=c[d];f.hardness=Math.max(Math.min(f.hardness,1),0)}else t.lighting={};return n.cloneDeep(t,function(t){return t.byteLength?Array.prototype.slice.call(t):void 0})},l=function(t){var e=t.toJSON();void 0===t.get("vertexCount")&&t.set("vertexCount",e.nbVertexes),void 0===t.get("faceCount")&&t.set("faceCount",e.nbTriangles),void 0===e.options&&(e.options={}),t.set("options",h(e.options)),t.set("files",e.files);var i=!0;if(n.isEmpty(t.get("options").materials)&&(i=!1),i===!0){var r=window.prefetchedData["/i/models/"+t.get("uid")+"/textures"];r&&r.results&&r.results.length>0&&(i=!1)}return i===!0&&o(e.options.materials,t.get("uid")),t};l.readOptions=h,t.exports=l},function(t,e,i){"use strict";var r=i(1100),n=i(219),a=r.osg,fif(r),s=function(t,e){return t-e},o=n.invert(a.Texture),u=["magFilter","minFilter","wrapS","wrapT","textureTarget","internalFormat"],h=function(t){t.image&&(t.url=t.image,delete t.image);for(var e=0,i=u.length;i>e;++e){var r=u[e];"number"==typeof t[r]&&(t[r]=o[t[r]])}void 0===t.texCoordUnit?t.texCoordUnit=0:"string"==typeof t.texCoordUnit&&(t.texCoordUnit=parseInt(t.texCoordUnit,10)),t.format&&delete t.format},l=function(t){return Math.max(0,Math.min(1,t))},c=function(t,e){if(t.factor&&("SpecularHardness"===e?t.factor=Math.max(0,Math.min(1e4,t.factor)):"BumpMap"===e||"EmitColor"===e?t.factor=Math.max(0,Math.min(10,t.factor)):t.factor=Math.max(0,Math.min(1,t.factor))),t.color){var i=t.color;t.color=a.Vec3.createAndSet(l(i[0]),l(i[1]),l(i[2]))}void 0===t.enable&&(t.enable=!0);var r=t.texture;if(r){h(r);var n=r.internalFormat;if(n)switch(e){case"NormalMap":case"SpecularPBR":r.internalFormat="RGB";break;case"DiffuseColor":case"DiffuseIntensity":case"SpecularColor":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":"RGBA"===n&&(r.internalFormat="RGB");break;case"SpecularHardness":case"BumpMap":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"AOPBR":case"CavityPBR":r.internalFormat="LUMINANCE";break;default:case"Opacity":"RGBA"===n?r.internalFormat="ALPHA":"RGB"===n&&(r.internalFormat="LUMINANCE")}}},d=function(t){var e=t.channels;e.Geometry&&(e.NormalMap=e.Geometry,delete e.Geometry),e.Reflection&&(void 0===t.reflection&&(t.reflection=e.Reflection.factor),delete e.Reflection),t.cullFace||t.cullFaceMode&&(t.cullFace=t.cullFaceMode,delete t.cullFaceMode),t.depthCheckMode&&(e.Opacity&&!e.Opacity.type&&(e.Opacity.type="alphaBlend"),delete t.depthCheckMode),void 0===t.texCoordUnitList?t.texCoordUnitList=[]:void 0===t.texCoordUnitList.length&&(t.texCoordUnitList=n.map(t.texCoordUnitList,function(t,e){return parseInt(e,10)})),t.texCoordUnitList.sort(s),e&&n.each(e,function(t,e){c(t,e)})};t.exports=d},function(t,e,i){"use strict";var r=i(224),n=i(219),a=i(1100),s=i(282),o=i(1093),u=i(1394),h=i(1361),l=i(1357),c=i(1099),d=i(1411),p=i(1412),f=i(1388),g=i(1390),m=i(1341),v=i(1342),_=i(1413),b=a.osg,fif(a),x=a.osgUtil,A=function(t,e){this._viewerWebGL=t,this._viewerOSGJS=t.getViewerOSGJS(),this._urlOptions=t.options,this._features=t.getFeatures(),this._context=e,this._canvas=t.getCanvas(),this._nodeGizmo=null,this._mouseKeyboard=this._viewerOSGJS.getEventProxy().StandardMouseKeyboard;var i=this.onPointerUp.bind(this);window.addEventListener("touchend",i),window.addEventListener("touchcancel",i),window.addEventListener("mouseup",i),window.addEventListener("mouseout",i)};A.prototype={getFeatures:function(){return this._features},getCanvas:function(){return this._canvas},getViewerWebGL:function(){return this._viewerWebGL},getViewerOSGJS:function(){return this._viewerOSGJS},getResourceManager:function(){return this._resourceManager||c.instance},onPointerUp:function(){this._mouseKeyboard.setEnable(!0)},focusOnTargetAndEye:function(){var t=b.Vec3.create();return function(e,i,r,n){var a=this._viewerOSGJS.getManipulator();if(!r||0>r)return e&&a.setTarget(e),void(i&&a.setEyePosition(i));var s=this._features.cameraAnimation.getModel();e||(e=a.getTarget(t)),i||(i=a.getEyePosition(t)),s.setTargetAndEye(e,i,n),s.set("duration",r)}}(),focusOnHomePosition:function(t){var e=this._features,i=e.manipulator,r=e.cameraAnimation;if(i&&i.getModel()&&r){var n=i.getManipulator().getCurrentManipulator(),a=n.getHomeBound(),s=a.center(),o=n.getEyePosition(b.Vec3.create());b.Vec3.sub(s,o,o),b.Vec3.normalize(o,o),b.Vec3.mult(o,n.getHomeDistance(a),o),b.Vec3.sub(s,o,o),this.focusOnTargetAndEye(s,o,t)}},focusOnSavedCamera:function(t){var e=this._context.getModel().get("options"),i=m(),r=this._viewerOSGJS.getManipulator(),n=i.cameraTarget||e.camera.target,a=i.cameraEye||e.camera.position,s=a&&null!==a[0];return s?s&&!this._features.manipulator.getModel().validateEyeTarget(a,n)?r.computeHomePosition():void this.focusOnTargetAndEye(n,a,t):r.computeHomePosition()},setInitialAnimation:function(){var t=this._features.cameraAnimation;if(t){var e=m().camera;if(void 0!==e&&e===!1)return void h.resolvePromise();var i=2.5,r=b.Vec3.create(),n=b.Vec3.create(),a=this._viewerOSGJS.getManipulator();a.getEyePosition(n),a.getTarget(r);var s=[r[0]-n[0],r[1]-n[1],0],o=s[0]>s[1]?0:1,u=0===o?1:0,l=b.Vec3.create();l[u]=1;var c=s[o]<0?-1:1;l[2]=.2*c;var d=1.5*a.getNode().getMinimumBound().radius();b.Vec3.mult(l,10*d*c,l);var p=b.Vec3.add(n,l,b.Vec3.create());a.setEyePosition(p),this.focusOnTargetAndEye(r,n,i);var f=this._features.autospin;if(f){var g=f.getModel();g.set("speed",-g.get("speed")*c);
}}},linkAutospinWithEvents:function(){var t=this._features,e=t.autospin,i=t.manipulator,r=i?i.getModel():void 0,n=e.getModel(),a=12500,s=0,o=function(){clearTimeout(s),n.set("paused",!0)},h=function(){var t=void 0===r||r.get("indexManipulator")===u.ORBIT;t===!0&&(s=setTimeout(function(){n.set("paused",!1)},a))},l=this._canvas;if(l.addEventListener("mousedown",o),l.addEventListener("touchstart",o),l.addEventListener("dragstart",o),l.addEventListener("mouseup",h),l.addEventListener("mouseout",h),l.addEventListener("touchend",h),l.addEventListener("touchcancel",h),l.addEventListener("touchleave",h),l.addEventListener("dragend",h),i){var c=function(){clearTimeout(s),n.set("paused",r.get("indexManipulator")!==u.ORBIT)};r.bind("change:indexManipulator",c),c()}},linkSelectMaterialUI:function(t){var e=this._features,i=e.materialUI,r=e.cameraAnimation,n=e.outline;if(i){var a=function(t){b.NodeVisitor.call(this),this._stateSet=t,this._pushIfGeo=!1,this._paths=[]};a.prototype=b.objectInherit(b.NodeVisitor.prototype,{apply:function(t){var e=t.getStateSet(),i=this._pushIfGeo;e&&void 0!==e._materialID&&(this._pushIfGeo=e===this._stateSet),t instanceof b.Geometry&&this._pushIfGeo&&this._paths.push(this.nodePath.slice(0)),this.traverse(t),this._pushIfGeo=i}});var s=function(e){var i=new a(e);t.accept(i);var s=i._paths;if(0===s.length)return void b.error("Cound not find nodes attached to the stateset.");for(var o=t.getParents()[0].getWorldMatrices()[0],u=b.Vec3.create(),h=b.Vec3.create(),l=0,c=s.length;c>l;++l){var d=s[l],p=d[d.length-1].getMinimumBound().center();b.Matrix.transformVec3(b.computeLocalToWorld(d),p,h),b.Matrix.transformVec3(o,h,h),b.Vec3.add(h,u,u)}if(b.Vec3.mult(u,1/c,u),r&&this.focusOnTargetAndEye(u,void 0,2),n){var f=n.getNode();f.setScene(s),f.showOutline()}}.bind(this);i.getModel().bind("displayOutline",s)}},initEventsOnClick:function(){var t=new s.Manager(this.getCanvas());t.add(new s.Tap({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),t.add(new s.Tap({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),t.add(new s.Tap({event:"singletap",pointers:1,taps:1,time:250,interval:450,threshold:5,posThreshold:20})),t.on("doubletap",this.onDoubleClick.bind(this)),t.on("doubletap2fingers",this.onDoubleClick.bind(this)),t.on("singletap",this.onSingleClick.bind(this))},focusAutoOnHit:function(t,e){var i=b.Vec3.create();this.getWorldPositionFromHit(t,i);var r=this._features.cameraAnimation.getModel(),n=this._features.manipulator.getManipulator().getCurrentManipulator(),a=n.getEyePosition(b.Vec3.create());if(1===m().cameraFollowBones){var s=b.Vec3.create();b.Vec3.sub(i,n.getTarget(s),s),b.Vec3.add(a,s,a)}else{var o=b.Vec3.distance(a,n.getTarget(b.Vec3.create()));b.Vec3.sub(i,a,a),b.Vec3.normalize(a,a),b.Vec3.mult(a,o,a),b.Vec3.sub(i,a,a)}r.setTargetAndEye(i,a),r.set("duration",e)},focusOnHit:function(t,e,i){var r=b.Vec3.create();this.getWorldPositionFromHit(t,r);var n=this._features.cameraAnimation.getModel(),a=this._features.manipulator.getManipulator().getCurrentManipulator(),s=a.getEyePosition(b.Vec3.create()),o=a.getHomeDistance(a.getHomeBound()),u=b.Vec3.distance(s,r),h=i*o;u>h&&(b.Vec3.sub(r,s,s),b.Vec3.normalize(s,s),b.Vec3.mult(s,h,s),b.Vec3.sub(r,s,s)),n.setTargetAndEye(r,s,!0),n.set("duration",e)},onSingleClick:function(t){var e=this._features.postProcess;if(e){var i=e.getModel();if(i.get("enable")&&i.get("dofEnable")){var n=t.center.x-r(t.target).offset().left,a=t.center.y-r(t.target).offset().top,s=this.computeNearestIntersection2D(n,a);s&&i.trigger("change:dofFocusPoint",this.getWorldPositionFromHit(s,i.get("dofFocusPoint")))}}},onDoubleClick:function(t){var e=this._features.manipulator;if(!e||!e.getModel().get("webVR")){if(this._focusTimer&&window.clearInterval(this._focusTimer),t.pointers.length>1)return void this.focusOnHomePosition(1);var i=t.center.x-r(t.target).offset().left,n=t.center.y-r(t.target).offset().top,a=this.computeNearestIntersection2D(i,n);if(!a)return void this.focusOnHomePosition(1);if(this._urlOptions.widgetAPI){var s=this._urlOptions.widgetAPI.getTabbedWidget().get();if("vr"===s)return void this._features.webVR.getModel().trigger("doubleTap",a);if("materials"===s){var o=this._features.material.getModel(),u=o.findFirstMaterial(a.nodepath[a.nodepath.length-1]);if(!u)return;var h=u.get("id");return void(o.uiModel.get("material")===h?o.trigger("displayOutline",u.get("stateSet")):o.uiModel.set("material",h))}if("annotations"===s)return}m().cameraFollowBones&&l.checkPathIsAnimated(a.nodepath)?this._focusTimer=window.setInterval(this.focusAutoOnHit.bind(this,a,0),16.6):this.focusOnHit(a,1,.2)}},initCamera:function(){this.focusOnSavedCamera(),this._features.manipulator&&this._features.manipulator.getModel().saveCameraPosition(),this.initEventsOnClick(),this.setInitialAnimation()},canvasCoordToGL:function(t,e,i){var r=this._canvas,n=i||b.Vec2.create(),a=this._viewerOSGJS.getCanvasPixelRatio();return n[0]=t*a,n[1]=(r.clientHeight-e)*(this._viewerOSGJS.getCanvasHeight()/r.clientHeight),n},glCoordToCanvas:function(t,e,i){var r=this._canvas,n=i||b.Vec2.create(),a=this._viewerOSGJS.getCanvasPixelRatio();return n[0]=t/a,n[1]=r.clientHeight-e/a,n},computeIntersections3D:function(){var t=new x.IntersectionVisitor,e=new x.LineSegmentIntersector;return t.setIntersector(e),function(i,r,n,a){return a||(a=this._features.webVR.getNode()),t.reset(),e.reset(),t.setTraversalMask(void 0!==n?n:f.PICK_GEOMETRY_SLOW),e.set(i,r),a.accept(t),e.getIntersections()}}(),computeNearestIntersection3D:function(t,e,i,r){var n=this.computeIntersections3D(t,e,i,r);return this.sortIntersections(n)},computeNearestIntersection3DHotspotFirst:function(t,e,i,r){var n=this.computeIntersections3D(t,e,i,r);if(0!==n.length){n.sort(function(t,e){return t.ratio-e.ratio});var s=0,o=n.length,u=this._features.hotspot.getNodeProxy();for(s=0;o>s;++s)if(-1!==n[s].nodepath.indexOf(u))return n[s];var h=this._features.material.getModel();for(s=0;o>s;++s){var l=n[s];if(!l.backface)return l;var c=h.findFirstMaterial(l.nodepath[l.nodepath.length-1]);if(c&&c.get("cullFace")===a.osg.CullFace.DISABLE)return l}}},computeIntersections2D:function(){var t=b.Vec3.create(),e=b.Vec3.create(),i=b.Matrix.create();return function(r,n,a,s){return s||(s=this._features.webVR.getNode()),this.canvasCoordToGL(r,n,t),this.canvasCoordToGL(r,n,e),t[2]=0,e[2]=1,this.getWorldPositionFromScreenPoint(t,t),this.getWorldPositionFromScreenPoint(e,e),s.getWorldMatrix(void 0,i),b.Matrix.inverse(i,i),b.Matrix.transformVec3(i,t,t),b.Matrix.transformVec3(i,e,e),this.computeIntersections3D(t,e,a,s)}}(),computeNearestIntersection2D:function(t,e,i,r){var n=this.computeIntersections2D(t,e,i,r);return this.sortIntersections(n)},sortIntersections:function(t){if(0!==t.length){t.sort(function(t,e){return t.ratio-e.ratio});for(var e=this._features.material.getModel(),i=0,r=t.length;r>i;++i){var n=t[i];if(!n.backface)return n;var s=e.findFirstMaterial(n.nodepath[n.nodepath.length-1]);if(s&&s.get("cullFace")===a.osg.CullFace.DISABLE)return n}}},getRelativePositionFromHit:function(t,e,i,r){for(var n=t.nodepath,a=!1,s=0,o=n.length;o>s;++s)if(n[s]===r){n=n.slice(s),a=!0;break}var u=b.Matrix.create();return a===!1&&n[0].getWorldMatrix(r,u),b.computeLocalToWorld(n,!0,u),b.Matrix.transformVec3(u,t.point,e),i&&(u[12]=u[13]=u[14]=0,b.Matrix.inverse(u,u),b.Matrix.transpose(u,u),b.Matrix.transformVec3(u,t.TriangleIntersection.normal,i),b.Vec3.normalize(i,i)),e},getWorldPositionFromHit:function(t,e,i){return this.getRelativePositionFromHit(t,e,i,this._viewerOSGJS.getSceneData())},getScenePositionFromHit:function(t,e,i){return this.getRelativePositionFromHit(t,e,i,this._context.getScene().getRoot())},getWorldPositionFromScenePoint:function(t,e){var i=e||b.Vec3.create(),r=this._features.orientation,n=this._features.autospin;return r&&b.Matrix.transformVec3(r.getNode().getMatrix(),t,i),n&&b.Matrix.transformVec3(n.getNode().getMatrix(),i,i),i},getScenePositionFromWorldPoint:function(){var t=b.Matrix.create();return function(e,i){var r=i||b.Vec3.create(),n=this._features.orientation,a=this._features.autospin;return b.Matrix.makeIdentity(t),n&&b.Matrix.preMult(t,n.getNode().getMatrix()),a&&b.Matrix.preMult(t,a.getNode().getMatrix()),b.Matrix.inverse(t,t),b.Matrix.transformVec3(t,e,r)}}(),getScreenPositionFromScenePoint:function(t,e){var i=this.getWorldPositionFromScenePoint(t,e);return this.getScreenPositionFromWorldPoint(i,i)},getScreenPositionFromWorldPoint:function(){var t=b.Matrix.create();return function(e,i){var r=this._viewerOSGJS.getCamera();b.Matrix.makeIdentity(t),r.getViewport()&&r.getViewport().computeWindowMatrix(t),b.Matrix.preMult(t,r.getProjectionMatrix()),b.Matrix.preMult(t,r.getViewMatrix());var n=i||b.Vec3.create();return b.Matrix.transformVec3(t,e,n)}}(),getWorldPositionFromScreenPoint:function(){var t=b.Matrix.create();return function(e,i){var r=this._viewerOSGJS.getCamera();b.Matrix.makeIdentity(t),r.getViewport()&&r.getViewport().computeWindowMatrix(t),b.Matrix.preMult(t,r.getProjectionMatrix()),b.Matrix.preMult(t,r.getViewMatrix()),b.Matrix.inverse(t,t);var n=i||b.Vec3.create();return b.Matrix.transformVec3(t,e,n)}}(),getScenePositionFromScreenPoint:function(t,e){var i=this.getWorldPositionFromScreenPoint(t,e);return this.getScenePositionFromWorldPoint(i,i)},computeKdTree:function(t){var e=new b.KdTreeBuilder({_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20});e.apply(t)},preloadMaxBackground:function(){var t=this._features.background;if(t){var e=t.getModel();if(e&&"fixed"===e.get("enable")){var i=e.getBackground();if(i){var r=i.findImageNearestUpToResolution(window.screen.width,window.screen.height);r&&this.getResourceManager().getOrCreateTexture(r.url,{minFilter:b.Texture.LINEAR_MIPMAP_LINEAR,magFilter:b.Texture.LINEAR,transferToGPU:!1,convertNPOT:!1})}}}},applyAutospinToCamera:function(t,e){var i=this._features.autospin;if(i){var r=i.getNode().getMatrix();b.Matrix.transformVec3(r,t,t),b.Matrix.transformVec3(r,e,e)}},getCameraWithoutAutospin:function(){var t=b.Matrix.create();return function(e,i){var r=this._viewerOSGJS.getManipulator();r.getEyePosition(e),r.getTarget(i);var n=this._features.autospin;n&&(b.Matrix.inverse(n.getNode().getMatrix(),t),b.Matrix.transformVec3(t,e,e),b.Matrix.transformVec3(t,i,i))}}(),createGizmoNode:function(){var t=new b.Camera;t.getOrCreateStateSet().setRenderBinDetails(g.EDITOR_GIZMO,"RenderBin");var e=this._nodeGizmo=new d(this._viewerOSGJS);e.setTraversalMask(f.PICK_GIZMO_LIGHT),t.addChild(e);var i=this._urlOptions.widgetAPI;if(i){var r=this._features.orientation;i.getTabbedWidget().model.on("change:value",function(){e.attachToGeometry(null),r&&r.getModel().set("showGizmo",!1)})}return t},setManipulatorNode:function(t){this._features.manipulator?this._features.manipulator.getModel().set("node",t):this._viewerOSGJS.getManipulator().setNode(t)},getNodeGizmo:function(){return this._nodeGizmo},getNodeShadows:function(){return this._nodeShadows},initGraph:function(t){var e=this._features,i=new b.Node;i.getOrCreateStateSet().setAttributeAndModes(new b.CullFace(b.CullFace.DISABLE)),i.setName("FeatureManager - Root");var r=this._nodeShadows=new a.osgShadow.ShadowedScene,n=e.orientation,s=e.autospin,o=e.outline,u=e.cameraAnimation,h=e.shadingStyle,l=e.environment,c=e.lighting,d=e.hotspot,p=e.postProcess,f=e.webVR,g=i;p&&(i.addChild(p.getNodeIn()),g=p.getNodeOut()),g.addChild(this.createGizmoNode(g)),g.addChild(r),g=r;for(var m=[u,l,c,f,s,n,d,o,h],v=0,_=m.length;_>v;++v){var x=m[v];x&&(g.addChild(x.getNode()),g=x.getNode())}return g.addChild(t),i},finished:function(t){var e=this._features,i=this._context.getScene().getRoot();i.setNodeMask(f.PICK_GEOMETRY_SHADOW),i.setName("rootModel");var r=this.initGraph(i);return t.addChild(r),this.setManipulatorNode(e.autospin.getNode()),this.preloadMaxBackground(),this.linkAutospinWithEvents(),this.linkSelectMaterialUI(i),e.lighting&&e.lighting.getModel().initLights(e.material.getSceneLights()),e.environment&&e.environment.getNode().init(this._viewerOSGJS.getCamera()),this.computeKdTree(i),b.time("drawFirstFrame (Sync)"),this._viewerWebGL.drawFrame(),b.timeEnd("drawFirstFrame (Sync)"),this.initCamera(),e.webVR&&e.webVR.getModel().initWebVR(),b.time("drawSecondFrame (Sync)"),this._viewerWebGL.drawFrame(),b.timeEnd("drawSecondFrame (Sync)"),o()&&(this.registerOptionsJSON(this._viewerWebGL.getOptionsJSON()),window.addEventListener("beforeunload",this.onBeforeUnload.bind(this),!1)),!_()&&"onhashchange"in window&&window.addEventListener("hashchange",this._hashChanged.bind(this),!1),m().debug3d&&p(this,r),r},registerOptionsJSON:function(t){this._lastOptions=n.cloneDeep(t)},onBeforeUnload:function(t){var e=this._viewerWebGL.getOptionsJSON(),i=n.reduce(this._lastOptions,function(t,i,r){return n.isEqual(i,e[r])?t:t.concat(r)},[]);if(0!==i.length){var r="You have unsaved changes:\n";return r+="- "+i.join("\n- "),r+="\n\nYou might want to save your changes before leaving.",t.returnValue=r,r}},_hashChanged:function(){var t=v(),e=this._features.material;e.getModel().overrideMaterialChannels(t)}},t.exports=A},function(t,e,i){"use strict";var r=i(1100),n=i(1362),a=r.osg,fif(r),s=r.osgUtil,o=s.NodeGizmo,u=function(){o.apply(this,arguments),this._forcePicking=!1};u.prototype=a.objectInherit(o.prototype,{setForcePicking:function(t){this._forcePicking=t},onMouseUp:function(t){this._isEditing&&n.draw();var e=this._attachedNode;o.prototype.onMouseUp.call(this,t),e!==this._attachedNode&&n.draw(),this._forcePicking&&!this._attachedNode&&(this._attachedNode=e)},onMouseMove:function(t){var e=this._hoverNode;o.prototype.onMouseMove.call(this,t),(this._isEditing||e!==this._hoverNode)&&n.draw()}}),t.exports=u},function(t,e,i){"use strict";var r=i(219),n=i(224),a=i(1100),s=i(1411),o=i(1362),u=i(1390),h=i(1373),l=i(1374),c=a.osg,fif(a),d=a.osgAnimation,p=a.osgUtil,f=c.StateAttribute.OVERRIDE|c.StateAttribute.ON,g=function(){p.DisplayNormalVisitor.call(this),this._tangentStateSet.setRenderBinDetails(u.DEBUG,"RenderBin"),this._normalStateSet.setRenderBinDetails(u.DEBUG,"RenderBin")};g.prototype=c.objectInherit(p.DisplayNormalVisitor.prototype,{apply:function(t,e){t instanceof c.Geometry&&t.getCullCallback()||p.DisplayNormalVisitor.prototype.apply.call(this,t,e)}});var m=function(t){c.NodeVisitor.call(this),this._cullCallback=t?void 0:h.hideCullCallback};m.prototype=c.objectInherit(c.NodeVisitor.prototype,{apply:function(t){t instanceof c.Geometry&&t._isBoneBox&&t.setCullCallback(this._cullCallback),this.traverse(t)}});var v=function(){var t=p.DisplayGeometryVisitor.prototype.apply;p.DisplayGeometryVisitor.prototype.apply=function(e){if(!e._isBoneBox&&!e._isSkeleton){t.apply(this,arguments);var i=e._originalStateSet;void 0!==i&&e.getStateSet()&&i!==e.getStateSet()&&e.getStateSet().setRenderBinDetails(u.DEBUG,"RenderBin")}}},_=function(t){var e=r.invert(u);t._graphRender.generateRenderBin=function(t,i){var r=i.className()+" ( "+i.getInstanceID()+" )";i.getName()&&(r+="\n"+i.getName());var n=i.getBinNumber();r+="\n"+e[n]||n,this._selectables.set(i.getInstanceID().toString(),i),t.addNode(i.getInstanceID(),{label:r,description:"",style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"})}},b=function(){var t=d.UpdateMorph.prototype.updateWeights;d.UpdateMorph.prototype.updateWeights=function(){if(void 0!==this._debugActiveTarget){var e=parseInt(this._debugActiveTarget,0);if(-2===e){var i=this._weights;return void(i[0]=i[1]=i[2]=i[3]=0)}if(-1!==e)for(var r=this._targets,n=0,a=r.length;a>n;++n)r[n].value=n===e?1:0}return t.call(this)}},x=function(t,e){var i=function(){c.NodeVisitor.call(this,c.NodeVisitor.TRAVERSE_ALL_CHILDREN)};i.prototype=c.objectInherit(c.NodeVisitor.prototype,{apply:function(e){for(var i=e.getUpdateCallbackList(),r=0,n=i.length;n>r;++r){var a=i[r];if(a instanceof d.UpdateMorph){var s={};s.___DEFAULT=-1,s["___NO MORPH"]=-2;for(var u=a._targetNames,h=0,l=u.length;l>h;++h)s[u[h]]=h;a._debugActiveTarget=-1;var c=t.add(a,"_debugActiveTarget",s).name("Name "+a.getName());c.onChange(o.draw)}}this.traverse(e)}});var r=new i;e._rootModel.accept(r)},A=function(){h.DrawBones.prototype.apply=function(t){var e=t.getInstanceID();this._visitedNodes[e]||(this._visitedNodes[e]=!0,t instanceof d.Bone&&this._drawBone(t),this.traverse(t))}},y=function(t,e){this._fManager=t,this._rootModel=t._context.getScene().getRoot(),this._rootFeature=e,this._debugNormal=!1,this._debugTangent=!1,this._debugScale=.5,this._baseScale=.07*this._rootModel.getMinimumBound().radius(),this._normalVisitor=new g,this._normalVisitor.setScale(this._baseScale*this._debugScale),this._geoColorVisitor=new p.DisplayGeometryVisitor,this._geoColorVisitor._stCenter.setRenderBinDetails(u.DEBUG_2,"RenderBin"),v(),this._debugGeometry=!1,this._debugSkinning=!1,this._useGizmo=!1,this._useSync=!1,this._protoUpdateWeights=d.UpdateMorph.prototype.updateWeights,this._protoComputeChannels=d.UpdateMatrixTransform.prototype.computeChannels,this._enableRig=!0,t.getViewerOSGJS().getState().getShaderGeneratorProxy().addShaderGenerator("skeleton",new l),this._drawBonesVisitor=new h.DrawBones([]),A(),this._showSkeleton=!1,this._showBoneBoxes=!1,this._graphVisitor=p.DisplayGraph.instance(),_(this._graphVisitor),this._debugGraphNode="Model",this._debugGraphRenderer=!1,this._displayGraph=!1,this._cbPick=this.onPickSelect.bind(this),this._fManager.getCanvas().addEventListener("dblclick",this.onTrianglePick.bind(this))};y.prototype={onTrianglePick:function(t){if(!this._displayGraph){var e=void 0===t.offsetX?t.layerX:t.offsetX,i=void 0===t.offsetY?t.layerY:t.offsetY,r=this._fManager.computeNearestIntersection2D(e,i);if(r){window.hit=r;var n=r.nodepath[r.nodepath.length-1],a=r.TriangleIntersection;console.log("Active hit : window.hit"),console.log("Name geometry : "+n.getName()),console.log("Vertex indices : "+a.i1+", "+a.i2+", "+a.i3),console.log("Unique id : "+n._uniqueID);var s={};s[a.i1]={},s[a.i2]={},s[a.i3]={};for(var o=n.getVertexAttributeList(),u=Object.keys(o),h=Object.keys(s),l=0,c=h.length;c>l;++l){var d=h[l],p=s[d];d=parseInt(d);for(var f=0,g=u.length;g>f;++f)for(var m=u[f],v=o[m],_=v.getItemSize(),b=v.getElements(),x=p[m]=[],A=0;_>A;++A)x[A]=b[d*_+A]}r.verts=s,console.log("\n")}}},onDebugScale:function(t){this._normalVisitor.setScale(this._baseScale*t),o.draw()},testCreateNormalVisitor:function(){this._normalVisitor._alreadyRun||(this._normalVisitor._alreadyRun=!0,this._normalVisitor.apply(this._rootModel))},onDebugNormal:function(t){this.testCreateNormalVisitor(),this._normalVisitor.setNormalVisibility(t),o.draw()},onDebugTangent:function(t){this.testCreateNormalVisitor(),this._normalVisitor.setTangentVisibility(t),o.draw()},onDebugGeometry:function(){this._debugGeometry?this._geoColorVisitor.setGeometryDebug(this._rootModel):this._debugSkinning?this._geoColorVisitor.setSkinningDebug(this._rootModel):this._geoColorVisitor.disableDebug(this._rootModel),o.draw()},resetGraph:function(){this._fManager.getCanvas().removeEventListener("dblclick",this._cbPick),this._graphVisitor.reset()},onDisplayGraph:function(){this.resetGraph(),this._displayGraph&&(this._fManager.getCanvas().addEventListener("dblclick",this._cbPick),this._fManager.getViewerWebGL().getPromiseModelDisplayed().then(this.createDebugGraph.bind(this)))},createDebugGraph:function(){var t;"Model"===this._debugGraphNode?t=this._rootModel:"Feature"===this._debugGraphNode&&(t=this._rootFeature),this._graphVisitor.setDisplayGraphRenderer(this._debugGraphRenderer),this._graphVisitor.createGraph(t),this._graphVisitor.setCallbackSelect(this.onNodeSelect.bind(this)),o.draw()},onPickSelect:function(t){var e=void 0===t.offsetX?t.layerX:t.offsetX,i=void 0===t.offsetY?t.layerY:t.offsetY,r=this._fManager.computeNearestIntersection2D(e,i);if(r){this._graphVisitor.selectNode(r.nodepath[r.nodepath.length-1]);var n=this._fManager.getFeatures().outline.getNode();n.setScene([r.nodepath]),n.showOutline(),this._graphVisitor.focusOnGraph()}},onNodeSelect:function(t){if(!t.getParents())return void this._fManager.getFeatures().materialUI.getModel().trigger("displayOutline",t);for(var e=[t];t.getParents().length>0;)e.unshift(t.getParents()[0]),t=t.getParents()[0];var i=c.Vec3.create(),r=this._rootModel.getParents()[0].getWorldMatrices()[0],n=e[e.length-1].getMinimumBound().center();c.Matrix.transformVec3(c.computeLocalToWorld(e),n,i),c.Matrix.transformVec3(r,i,i),this._fManager.focusOnTargetAndEye(i,void 0,1);var a=this._fManager.getFeatures().outline.getNode();a.setScene([e]),a.showOutline()},pasteCamera:function(){var t=c.Vec3.create(),e=c.Vec3.create();this._fManager.getCameraWithoutAutospin(t,e),window.prompt("For marc : ","camera_eye="+t+"&camera_target="+e)},onEnableRig:function(t){t?d.UpdateMatrixTransform.prototype.computeChannels=this._protoComputeChannels:d.UpdateMatrixTransform.prototype.computeChannels=function(){this._dirty=!0;var t=this._matrix;c.Matrix.makeIdentity(t);for(var e=this._stackedTransforms,i=0,r=e.length;r>i;i++){var n=e[i];n.resetToDefaultValue(),n.applyToMatrix(t)}},o.draw()},onShowSkeleton:function(t){o.draw();var e=this._drawBonesVisitor;return t?(e._geoStateSet.setAttributeAndModes(new c.Depth(c.Depth.ALWAYS),f),void(e._alreadyRun||(e._alreadyRun=!0,this._rootModel.accept(e)))):void e._geoStateSet.setAttributeAndModes(new c.Depth(c.Depth.NEVER),f)},onShowBoneBoxes:function(t){this._rootModel.accept(new m(t)),o.draw()},onUseGizmo:function(t){this._gizmo||(this._gizmo=new s(this._fManager.getViewerOSGJS()),this._rootFeature.addChild(this._gizmo)),this._gizmo.attachToGeometry(null),this._gizmo._autoInsertMT=t,this._gizmo.setTraversalMask(t?1:0),o.draw()}};var S=function(t,e,i){var r=t.addFolder("Debug graph"),n={Model:"Model",Feature:"Feature",None:"None"};return i._graphNode=r.add(e,"_debugGraphNode",n).name("Root"),i._graphNode.onChange(e.onDisplayGraph.bind(e)),i._graphRenderer=r.add(e,"_debugGraphRenderer").name("Renderer"),i._graphRenderer.onChange(e.onDisplayGraph.bind(e)),i._displayGraph=r.add(e,"_displayGraph").name("Display graph"),i._displayGraph.onChange(e.onDisplayGraph.bind(e)),r.open(),r},C=function(t,e,i){var r=t.addFolder("Display vectors");return i._showNormal=r.add(e,"_debugNormal").name("Display normal"),i._showNormal.onChange(e.onDebugNormal.bind(e)),i._showTangent=r.add(e,"_debugTangent").name("Display tangent"),i._showTangent.onChange(e.onDebugTangent.bind(e)),i._vectorScale=r.add(e,"_debugScale").min(0).max(2).name("Scale vectors"),i._vectorScale.onChange(e.onDebugScale.bind(e)),r.open(),r},w=function(t,e,i){var r=t.addFolder("Animation");return i._useRig=r.add(e,"_enableRig").name("Use rig"),i._useRig.onChange(e.onEnableRig.bind(e)),b(),x(r,e),i._showSkeleton=r.add(e,"_showSkeleton").name("Show skeleton"),i._showSkeleton.onChange(e.onShowSkeleton.bind(e)),i._showBoxes=r.add(e,"_showBoneBoxes").name("Show boxes"),i._showBoxes.onChange(e.onShowBoneBoxes.bind(e)),i._showSkinning=r.add(e,"_debugSkinning").name("Display skinning"),i._showSkinning.onChange(function(t){t&&e._debugGeometry&&i._showGeometry.setValue(!1),e.onDebugGeometry()}),r.open(),r},T=function(t,e,i){var r=t.addFolder("Misc");return i._showGeometry=r.add(e,"_debugGeometry").name("Display geometry"),i._showGeometry.onChange(function(t){t&&e._debugSkinning&&i._showSkinning.setValue(!1),e.onDebugGeometry(),i._showSkinning.updateDisplay()}),i._gizmo=r.add(e,"_useGizmo").name("Use gizmo"),i._gizmo.onChange(e.onUseGizmo.bind(e)),i._pasteCamera=r.add(e,"pasteCamera").name("Paste camera"),r.open(),r},M=function(t){var e=new window.dat.GUI;e.domElement.style.paddingTop="50px";var i=new y(this,t),r={};S(e,i,r),C(e,i,r),w(e,i,r),T(e,i,r)},E=function(t,e){var i=M.bind(t,e);n.getScript("https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js").done(i)};t.exports=E},function(t,e){"use strict";var i=!1,r=function(t){return void 0!==t&&(i=t),i};t.exports=r},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=function(){return n.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS")};t.exports=a},function(t,e,i){"use strict";var r=i(1375),n=i(1387),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1417),a=i(1418),s=r.osg,fif(r),o=r.osgShadow,u=function(){o.ShadowCastShaderGenerator.apply(this,arguments),this.setShaderCompiler(n)};u.prototype=s.objectInherit(o.ShadowCastShaderGenerator.prototype,{filterAttributeTypes:function(t){if("osgSketchfab"===t.libraryName()){if(t.getTypeID&&t.getTypeID()===a.typeID){var e=t.getName();if("AlphaMask"===e||"Opacity"===e)return t.isEnabled&&!t.isEnabled()}return!0}return o.ShadowCastShaderGenerator.prototype.filterAttributeTypes.call(this,t)}}),t.exports=u},function(t,e,i){"use strict";var r=i(1100),n=i(1387),a=r.osg,fif(r),s=r.osgShadow,o=function(){n.apply(this,arguments)};o.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"ShadowCastSkfb"},getFragmentShaderName:function(){return this.getCompilerName()},initAttributes:s.ShadowCastCompiler.prototype.initAttributes,createFragmentShaderGraph:function(){var t=this.createVariable("vec4").setValue("vec4(1.0, 1.0, 1.0, 1.0)");this.applyAlphaMask(t),this.applyAlphaBlendMasking(t);var e=s.ShadowCastCompiler.prototype.createShadowCastDepth.call(this),i=this.getNode("glFragColor");return this.getNode("Mult").inputs(t,e).outputs(i),[i]},declareVertexTransforms:s.ShadowCastCompiler.prototype.declareVertexTransforms}),t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(1359),a=i(1419),s=r.osg,fif(r),o=function(t,e){this._texture=t,this._channelName=e,this._factor=1,this._texCoordUnit=void 0,this._sRGB=!0,this._samplerName="sTexture"+e,this._emitType="additive",this._flipY=!1,this._invert=!1,this._occludeSpecular=!1};o.ChannelType=["AlphaMask"].concat(a),o.uniforms=[],o.prototype=s.objectLibraryClass(s.objectInherit(s.Texture.prototype,{attributeType:"Texture",channelType:o.ChannelType,getImage:function(){return this._texture.getImage()},cloneType:function(){return new o(new n)},isTextureNull:function(){return this._texture.isTextureNull()},setChannelName:function(t){this._channelName=t},getChannelType:function(){return this.channelType},setFactor:function(t){this._factor=t},getFactor:function(){return this._factor},setTexture:function(t){this._texture=t},getTexture:function(){return this._texture},setTexCoordUnit:function(t){this._texCoordUnit=t},getTexCoordUnit:function(){return this._texCoordUnit},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setFlipY:function(t){this._flipY=t},getFlipY:function(){return this._flipY},setEmitType:function(t){this._emitType="additive"===t?0:1},getEmitType:function(){return this._emitType},setInvert:function(t){this._invert=t},getInvert:function(){return this._invert},setOccludeSpecular:function(t){this._occludeSpecular=t},getOccludeSpecular:function(){return this._occludeSpecular},getName:function(){return this._channelName},setName:function(t){this._channelName=t},setSRGB:function(t){return t===!0?void(this._sRGB=!0):t===!1?void(this._sRGB=!1):void(this._sRGB=a.isSRGB("AlphaMask"===this._channelName?"Opacity":this._channelName))},getSRGB:function(){return this._sRGB},getOrCreateUniformSharedOnTextureUnit:function(){var t=o.uniformsSharedOnTextureUnit;if(t)return t;var e={};return o.ChannelType.forEach(function(t){var i="sTexture"+t;e[i]||(e[i]=s.Uniform.createInt(0,i));var r="u"+t+"Factor";e[t]=s.Uniform.createFloat(r),"BumpMap"===t?e.uBumpMapSize=s.Uniform.createFloat2(s.Vec2.create(),"uTextureBumpMapSize"):"NormalMap"===t?e.uFlipY=s.Uniform.createInt("uFlipY"):"AOPBR"===t?e.uOccludeSpecular=s.Uniform.createInt("uOccludeSpecular"):"Opacity"===t||"AlphaMask"===t?e.uInvert=s.Uniform.createInt("uInvert"):"EmitColor"===t&&(e.uEmitType=s.Uniform.createInt("uEmitType"))}),o.uniformsSharedOnTextureUnit=new s.Map(e),o.uniformsSharedOnTextureUnit},getOrCreateUniforms:function(t){var e=o.uniforms;if(e[t])return e[t];var i=this.getOrCreateUniformSharedOnTextureUnit();return e[t]=i,e[t]},getSamplerName:function(){return this._samplerName},apply:function(t,e){void 0!==this._texture&&this._texture.apply(t);var i=this._channelName;if(i){var r=this.getOrCreateUniforms(e);r[i].getInternalArray()[0]!==this._factor&&r[i].setFloat(this._factor);var n=r[this.getSamplerName()];if(n.getInternalArray()[0]!==e&&n.setInt(e),"BumpMap"===i){var a=r.uBumpMapSize.getInternalArray();a[0]=this._texture.getWidth(),a[1]=this._texture.getHeight()}else"NormalMap"===i?r.uFlipY.setInt(this.getFlipY()?1:0):"AOPBR"===i?r.uOccludeSpecular.setInt(this.getOccludeSpecular()?1:0):"Opacity"===i||"AlphaMask"===i?r.uInvert.setInt(this.getInvert()?1:0):"EmitColor"===i&&r.uEmitType.setInt(this.getEmitType())}},getHash:function(){var t=[this.className()],e=this._channelName,i=this.getTexture();return void 0!==i&&(e+=":"+i.getInternalFormat()),t.push(e),[t.join(", "),this._texCoordUnit,this._sRGB].join(" / ")}}),"osgSketchfab","TextureMaterial"),s.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r,n=i(1100),a=i(1420),s=n.osg,fif(n),o=["Opacity","DiffuseColor","DiffusePBR","AlbedoPBR","SpecularColor","DiffuseIntensity","SpecularPBR","MetalnessPBR","GlossinessPBR","RoughnessPBR","NormalMap","BumpMap","AOPBR","CavityPBR","EmitColor","SpecularHardness","SpecularF0"],u=0,h=o.length,l=function(t){switch(t){case"Opacity":return a.LIT|a.SHADELESS|a.MATCAP;case"EmitColor":return a.LIT|a.SHADELESS;case"NormalMap":case"BumpMap":return a.LIT|a.MATCAP;case"DiffusePBR":case"AlbedoPBR":case"AOPBR":case"CavityPBR":return a.PBR;case"SpecularPBR":case"MetalnessPBR":case"GlossinessPBR":case"RoughnessPBR":case"SpecularF0":return a.PBR_LIT;case"DiffuseColor":case"DiffuseIntensity":return a.CLASSIC;case"SpecularColor":case"SpecularHardness":return a.CLASSIC_LIT}},c={};for(u=0;h>u;++u)r=o[u],c[r]=l(r);o.getShadingMask=function(t){return c[t]};var d=function(t){switch(t){case"DiffuseColor":case"DiffusePBR":case"AlbedoPBR":case"EmitColor":case"SpecularColor":case"SpecularPBR":return!0;default:return!1}},p={};for(u=0;h>u;++u)r=o[u],p[r]=d(r);o.isSRGB=function(t){return p[t]};var f=function(t){switch(t){case"DiffuseColor":case"DiffuseIntensity":case"SpecularColor":case"NormalMap":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":case"SpecularPBR":return s.Texture.RGB;case"SpecularHardness":case"BumpMap":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"AOPBR":case"CavityPBR":return s.Texture.LUMINANCE;default:case"Opacity":return s.Texture.ALPHA}},g={};for(u=0;h>u;++u)r=o[u],g[r]=f(r);o.getTextureFormat=function(t){return g[t]};var m=function(t){var e={};switch(t){case"NormalMap":case"SpecularPBR":break;case"DiffuseColor":case"DiffuseIntensity":case"SpecularColor":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":e.LUMINANCE="Luminance",e.RGB="RGB";break;case"SpecularHardness":case"BumpMap":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"AOPBR":case"CavityPBR":break;default:case"Opacity":e.ALPHA="Alpha",e.LUMINANCE="Luminance"}return e},v={};for(u=0;h>u;++u)r=o[u],v[r]=m(r);o.getPossibleTextureFormat=function(t){return v[t]},t.exports=o},function(t,e,i){"use strict";var r=i(239),n=new r;n.PBR_LIT=1,n.CLASSIC_LIT=2,n.PBR_SHADELESS=4,n.CLASSIC_SHADELESS=8,n.MATCAP=16,n.LIT=n.PBR_LIT|n.CLASSIC_LIT,n.SHADELESS=n.PBR_SHADELESS|n.CLASSIC_SHADELESS,n.PBR=n.PBR_LIT|n.PBR_SHADELESS,n.CLASSIC=n.CLASSIC_LIT|n.CLASSIC_SHADELESS,n.set("mask",n.PBR_LIT),n.on("change:mask",function(){var t=n.get("mask");switch(t){case n.PBR_LIT:case n.CLASSIC_LIT:case n.PBR_SHADELESS:case n.CLASSIC_SHADELESS:case n.MATCAP:break;default:console.error("Invalid ShadingGlobal mask value !"+t)}}),t.exports=n},function(t,e,i){"use strict";var r=i(1422),n=i(1423),a=i(1356),s=function(t){this._materialManager=t};s.prototype={apply:function(t){var e=new r;t.accept(e);var i=e.getSource(),s=e.getAuthoringTool();i=i?i.toLowerCase():"default";var o=n[i]?n[i]:n["default"],u=new o(this._materialManager,s);t.accept(u),
u.postApply(t),"q3d"===i&&(u._style="shadeless");var h=t.getUserData()||[];return h.push({Name:"source",Value:i},{Name:"authoringTool",Value:s}),t.setUserData(h),t.userDataMap=a.convertUserDataToObject(h),u}},t.exports=s},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=n.osg,fif(n),s=function(){a.NodeVisitor.call(this,a.NodeVisitor.TRAVERSE_ALL_CHILDREN)};s.prototype=a.objectInherit(a.NodeVisitor.prototype,{getSource:function(){return this._source},getAuthoringTool:function(){return this._authoringTool},extractSource:function(t){var e=r.find(t,function(t){return"source"===t.Name});return e?e.Value:void 0},checkStateSet:function(t){t&&t.getUserData()&&(this._source=this.extractSource(t.getUserData()))},checkNode:function(t){var e=t.getUserData();if(!e&&"LightSource"===t.className()){var i=t.getLight();i&&(e=i.getUserData())}var n=this;e&&r.each(e,function(t){"source"===t.Name?n._source=t.Value:"authoring_tool"===t.Name&&(n._authoringTool=t.Value)})},apply:function(t){this.checkNode(t),this._source||this.checkStateSet(t.getStateSet()),this._source||this.traverse(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1424),n=i(1428),a=i(1429),s=i(1430),o=i(1431),u=i(1432),h=i(1433);t.exports={"default":a,wavefront:h,blender:r,ksp:r,lightwave:o,minecraft:u,collada:n,fbx:s,substancepainter:n,mineways:u}},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(1425),s=i(1427),o=n.osg,fif(n),u=function(){a.apply(this,arguments)};u.prototype=o.objectInherit(a.prototype,{cyclesNodeToMaterial:function(t,e,i,r,n,a,s,u){var h=t.nodes[n];if(void 0!==h){void 0===u&&(u=n);var l="setChannel"+r;if(void 0===e[l])return void o.warn("material has not method "+l);if(!(s&&a&&h.inputs)&&h.value)return void e[l](u,h.value);for(var c=0;c<h.inputs.length;c++){var d=h.inputs[c];if(d.name===a){var p=d.default_value;if(void 0!==p)if(Array.isArray(p))if("Opacity"===u||"Transparent BSDF"===u||"Glass BSDF"===u)if("Color"===a){var f=p[0]*p[1]*p[2]*p[3];1===f&&(f=.15),e[l](u,f)}else e[l](u,p);else"SpecularPBR"===u?"Color"===a?e[l](u,p):(p=p[0]*p[1]*p[2]*p[3],e[l](u,p)):("Color"!==a||"NormalMap"!==u)&&e[l](u,p);else"setChannelColor"!==u&&"Color"!==r&&("Strength"===a&&"Emission"===n&&(p/=10),e[l](u,p));if(d.links&&"SpecularPBR"!==u){for(var g=0;g<d.links.length;g++){var m=d.links[g];if(m.from_node){var v=t.nodes[m.from_node];if(v){var _=v.texture_slot;if(p=i.getTextureAttribute(_,"Texture")){e.setChannelTexture(u,this.createTextureModelFromTextureOSG(p));var b=e.getChannels()[u];b.resetTextureFormat(),b.setTexCoordUnit(_),b.setEnable(!0),this._texturesAssigned.push(p)}}(void 0===v||void 0===p)&&o.warn("Missing Texture linked in "+n+" node destined to "+u)}}return}}}h=this.findNodeByValueCyclesMetadata(t.nodes,n),h&&h.value&&e[l](u,h.value)}},findNodeByValueCyclesMetadata:function(t,e){for(var i=Object.keys(t),r=0;r<i.length;r++){var n=i[r],a=t[n];if(a instanceof Object){var s=this.findNodeByValueCyclesMetadata(a,e);if(void 0!==s)return s}else if(a===e)return t}},metaDataToMaterial:function(t,e,i,r,n,a){if(void 0!==t[r]){void 0===n&&(n=r);var s="setChannel"+i;return void 0===e[s]?void o.warn("material has not method "+s):void(void 0===a||a===!0?e[s](n,JSON.parse(t[r])):e[s](n,t[r]))}},setTextureFromBlender:function(t,e,i,r,n){var a=t.getChannels()[e];a.setFactor(n);var s=this.createTextureModelFromTextureOSG(r);a.setTexture(s),a.resetTextureFormat(),a.setTexCoordUnit(i),a.setEnable(!0)},processDefaultMaterial:function(t,e){e.removeAttribute("Material");for(var i=0,r=e.getNumTextureAttributeLists();r>i;i++)e.removeTextureAttribute(i,"Texture");t.setStateSet(void 0)},processLightSource:function(t){var e=t.getLight();if(e&&void 0!==e.getUserData()&&e.typeID!==s.typeID){var i=e.getUserData(),r=this.convertUserDataToObject(i),n=new s;("AREA"===r.Type||"SUN"===r.Type||"HEMI"===r.Type)&&(r.Type="DIRECTION"),n.setLightType(r.Type),void 0!==r.SpotSize&&n.setSpotCutoff(90*JSON.parse(r.SpotSize)/Math.PI),void 0!==r.SpotBlend&&n.setSpotBlend(JSON.parse(r.SpotBlend)),o.Vec3.mult(JSON.parse(r.Color),JSON.parse(r.Energy),n.getDiffuse());var a=1/JSON.parse(r.Distance);n.setQuadraticAttenuation(Math.abs(a)===1/0?0:a),t.setLight(n),n._node=t,this._lights.push(n)}},processCyclesGraph:function(t,e,i){var r;try{r=JSON.parse(i.NodeTree)}catch(n){return o.warn("error in blender cycle graph json "+n),!0}if(void 0===r)return!0;this._texturesAssigned=[],this.cyclesNodeToMaterial(r,t,e,"Color","Diffuse BSDF","Color",!0,"DiffusePBR"),this.cyclesNodeToMaterial(r,t,e,"Factor","Diffuse BSDF","Roughness",!0,"RoughnessPBR"),this.cyclesNodeToMaterial(r,t,e,"Color","Diffuse BSDF","Normal",!0,"NormalMap"),this.cyclesNodeToMaterial(r,t,e,"Color","Glossy BSDF","Color",!0,"SpecularPBR"),t.setChannelFactor("SpecularPBR",1),this.cyclesNodeToMaterial(r,t,e,"Factor","Glossy BSDF","Roughness",!0,"RoughnessPBR"),this.cyclesNodeToMaterial(r,t,e,"Color","Glossy BSDF","Normal",!0,"NormalMap"),this.cyclesNodeToMaterial(r,t,e,"Color","Bump","Height",!0,"NormalMap"),this.cyclesNodeToMaterial(r,t,e,"Factor","Bump","Strength",!0,"NormalMap"),this.cyclesNodeToMaterial(r,t,e,"Color","Emission","Color",!0,"EmitColor"),this.cyclesNodeToMaterial(r,t,e,"Factor","Emission","Strength",!0,"EmitColor"),this.cyclesNodeToMaterial(r,t,e,"Color","Ambient Occlusion","Color",!0,"AOPBR"),this.cyclesNodeToMaterial(r,t,e,"Factor","Ambient Occlusion","Strength",!0,"AOPBR"),this.cyclesNodeToMaterial(r,t,e,"Factor","Transparency","Strength",!0,"Opacity"),this.cyclesNodeToMaterial(r,t,e,"Factor","Transparent BSDF","Color",!0,"Opacity"),this.cyclesNodeToMaterial(r,t,e,"Factor","Glass BSDF","Color",!0,"Opacity");for(var a=[],s=0,u=e.getNumTextureAttributeLists();u>s;s++){var h=e.getTextureAttribute(s,"Texture");h&&-1===this._texturesAssigned.indexOf(h)&&a.push(h)}return this.assignPBRTextureFromFilenames(a,t),t.setWorkFlowMetalSpec(!1,!1),t.setWorkFlowRoughGloss(!0,!1),!1},processMaterial:function(t,e,i){var n=this.createMaterial(t,e),a=e.getAttribute("Material"),s=this.convertUserDataToObject(a?a.getUserData():void 0),u=!0;s.NodeTree&&(u=this.processCyclesGraph(n,e,s)),u&&(this.metaDataToMaterial(s,n,"Color","DiffuseColor"),this.metaDataToMaterial(s,n,"Factor","DiffuseIntensity","DiffuseColor"),n.setChannelEnable("DiffuseColor",!0),this.metaDataToMaterial(s,n,"Color","SpecularColor"),this.metaDataToMaterial(s,n,"Factor","SpecularIntensity","SpecularColor"),n.setChannelEnable("SpecularColor",!0),this.metaDataToMaterial(s,n,"Factor","Emit","EmitColor"),n.setChannelEnable("EmitColor",!0),this.metaDataToMaterial(s,n,"Factor","SpecularHardness"),n.setChannelEnable("SpecularHardness",!0),void 0!==s.Translucency&&(n.setChannelFactor("Opacity",1-JSON.parse(s.Translucency)),n.setChannelEnable("Opacity",!0)),void 0!==i.Shadeless&&n.set("shadeless",i.Shadeless));var h=r.chain(e.getUserData()).map(function(t){var e=t.Name.substr(0,2),i=parseInt(e,10);return isNaN(i)?void 0:i}).without(void 0).uniq().sortBy(function(t){return t}).value();e.removeAttribute("Material");var l={},c=["DiffuseColor","DiffuseIntensity","SpecularColor","Normal","Bump","Translucency","Alpha","EmitColor","SpecularHardness"],d=this;r.each(h,function(t){var i=r.chain(e.getUserData()).filter(function(e){var i=e.Name.substr(0,2),r=parseInt(i,10);return r===t?!0:!1}).value();r.each(i,function(t){var i=t.Name.substr(0,2),a=parseInt(i,10),s=e.getTextureAttribute(a,"Texture");if(void 0===s)return void o.warn("missing texture");l[a]=s;var u=t.Name.substr(3);if(r.contains(c,u)===!0){var h=parseFloat(t.Value);"DiffuseColor"===u?void 0!==n.getChannels().DiffuseColor.getTexture()&&void 0===n.getChannels().DiffuseIntensity.getTexture()&&(u="DiffuseIntensity"):"Alpha"===u?u="Opacity":"Translucency"===u?(u="Opacity",h=1-h):"Normal"===u?u="NormalMap":"Bump"===u&&(u="BumpMap"),d.setTextureFromBlender(n,u,a,s,h)}else"UsePremultiplyAlpha"===u?o.warn("UsePremultiplyAlpha not supported"):"UseAlpha"===u?o.warn("UseAlpha not supported"):o.warn("channel "+u+" not supported")})}),r.each(Object.keys(l),function(t){if(void 0!==l[t]){var i=t,r=parseInt(i,10);e.removeTextureAttribute(r,"Texture")}}),"ksp"===s.source&&(-1===n.attributes.name.toLowerCase().indexOf("wheel")?n.getChannels().MetalnessPBR.setFactor(1):n.getChannels().SpecularF0.setFactor(0),-1!==n.attributes.name.toLowerCase().indexOf("fairing")&&n.getChannels().Opacity.setFactor(.25)),n.setStateSet(e)}}),t.exports=u},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(218),s=i(313),o=i(314),u=i(1426),h=i(1340),l=n.osg,fif(n),c=function(t,e){l.NodeVisitor.call(this,l.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._lights=[],this._materials=[],this._materialManager=t,this._stateSetsProcessed={},this._authoringTool=e,this._style="",this._hasMetal=void 0,this._dictionary=a.channelNames,this._dictionaryKeys=Object.keys(a.channelNames)};c.prototype=l.objectInherit(l.NodeVisitor.prototype,{getStyle:function(){return this._style},hasMetallicWorkflow:function(){return this._hasMetal},getLights:function(){return this._lights},getMaterials:function(){return this._materials},matchNameAgainstDict:function(t,e,i){for(var r=o(t),n=0;n<e.length;n++){var a=e[n],u=s(r,a);if(i>u&&u<a.length)return!0}return!1},channelTextureExtract:function(t,e){var i=t.getChannels()[e];if(i){var r=i.getTexture();if(r)return r.getImage().getName()}},channelTextureMatch:function(t,e,i,r){var n=this.channelTextureExtract(t,e);return n&&this.matchNameAgainstDict(n,i,r)},hasTextureChannel:function(t,e){var i=this.channelTextureExtract(t,e);return void 0!==i},channelTextureCopy:function(t,e,i){var r,n=t.getChannels(),a=this.channelTextureExtract(t,e);if(a)for(var s=i.length;s--;)r=n[i[s]],r.setTexture(n[e].getTexture().clone())},checkPBRSlot:function(t){if(t)for(var e=0;e<this._dictionaryKeys.length;e++){var i=this._dictionaryKeys[e],r=this._dictionary[i];if(this.matchNameAgainstDict(t,r,a.maxLevenshteinDistance))return i}},assignPBRTextureFromFilenames:function(t,e){t.forEach(function(t){var i=t.getName(),r=this.checkPBRSlot(i);if(void 0===r&&t.getImage()&&(i=t.getImage().getURL(),r=this.checkPBRSlot(i)),void 0!==r){var n,a=e.getChannels();n=a[r],void 0===n.getTexture()&&n.setTexture(this.createTextureModelFromTextureOSG(t))}},this)},checkChannelsAndSetWorkFlowRoughGloss:function(t){if(t){var e=this.hasTextureChannel(t,"GlossinessPBR"),i=this.hasTextureChannel(t,"SpecularPBR"),r=this.hasTextureChannel(t,"RoughnessPBR"),n=this.hasTextureChannel(t,"BumpMap"),a=t.getChannels();n&&a.BumpMap.setFactor(10),this.hasTextureChannel(t,"MetalnessPBR")&&(this._hasMetal=!0),r&&a.RoughnessPBR.setFactor(1),e&&(i&&(a.SpecularPBR.setFactor(1),void 0===this._hasMetal&&(this._hasMetal=!1)),a.GlossinessPBR.setFactor(1)),t.setWorkFlowRoughGloss(r||!r&&!e,!1)}},setChannelsFromImagesNames:function(t,e,i){for(var r=0,n=e.length;n>r;r++)for(var s=0,o=i.length;o>s;s++){var h=i[s].get("name");if(this.matchNameAgainstDict(h,this._dictionary[e[r]],a.maxLevenshteinDistance)){var l=t.getChannels()[e[r]];l.setTexture(new u({image:i[s]})),l.setFactor(1),t.setChannelEnable(l.get("name"),!0)}}},getPBRChannels:function(t){var e=[];return r.each(t.getChannels(),function(t,i){-1!==i.indexOf("PBR")&&e.push(i)}),e},checkForPBRTextureFromChannelsAndFilenames:function(t){if(t){for(var e=this.getPBRChannels(t),i=e.length;i--;)if(void 0!==this.channelTextureExtract(t,e[i]))return;this.channelTextureCopy(t,"DiffuseColor",["AlbedoPBR","DiffusePBR"]),this.channelTextureCopy(t,"DiffuseIntensity",["AOPBR"]);var r=this._dictionary;this.channelTextureMatch(t,"SpecularColor",r.MetalnessPBR,2)?this.channelTextureCopy(t,"SpecularColor",["MetalnessPBR"]):this.channelTextureMatch(t,"SpecularHardness",r.MetalnessPBR,2)?this.channelTextureCopy(t,"SpecularHardness",["MetalnessPBR"]):this.channelTextureMatch(t,"SpecularColor",r.SpecularPBR,2)?this.channelTextureCopy(t,"SpecularColor",["SpecularPBR"]):this.channelTextureMatch(t,"SpecularHardness",r.SpecularPBR,2)&&this.channelTextureCopy(t,"SpecularHardness",["SpecularPBR"]),this.channelTextureMatch(t,"SpecularColor",r.RoughnessPBR,2)?this.channelTextureCopy(t,"SpecularColor",["RoughnessPBR"]):this.channelTextureMatch(t,"SpecularHardness",r.RoughnessPBR,2)?this.channelTextureCopy(t,"SpecularHardness",["RoughnessPBR"]):this.channelTextureMatch(t,"SpecularColor",r.GlossinessPBR,2)?this.channelTextureCopy(t,"SpecularColor",["GlossinessPBR"]):this.channelTextureMatch(t,"SpecularHardness",r.GlossinessPBR,2)&&this.channelTextureCopy(t,"SpecularHardness",["GlossinessPBR"])}},checkForPBRTextureFromMaterialAndFilenames:function(t){if(t){var e=[],i=this;r.each(t.getChannels(),function(r,n){i.channelTextureExtract(t,n)||e.push(n)});for(var n=[],a=this._materialManager.getImageCollection(),s=t.get("name").toLowerCase(),o=0;o<a.length;o++)-1!==a.models[o].get("name").toLowerCase().indexOf(s)&&n.push(a.models[o]);this.setChannelsFromImagesNames(t,e,n)}},hasMaterialAttributes:function(t){return t.getAttribute("Material")},processDefaultMaterial:function(t,e){e.removeAttribute("Material");for(var i=0,r=e.getNumTextureAttributeLists();r>i;i++)e.removeTextureAttribute(i,"Texture")},convertUserDataToObject:function(t){var e={};return t?(t.forEach(function(t){var i=t.Name,r=t.Value;e[i]=r}),e):e},getMetaData:function(t){return t&&t.getUserData()?this.convertUserDataToObject(t.getUserData()):void 0},getTextureLists:function(t){for(var e=[],i=0;i<t.getNumTextureAttributeLists();i++){var r=t.getTextureAttribute(i,"Texture");void 0!==r&&("TextureMaterial"===r.className()&&(r=r.getTexture()),e[i]=r)}return e},setMaterialChannelTexture:function(t,e,i,r,n){t.removeTextureAttribute(i,"Texture");var a=e.getChannels()[r];a.setTexture(n),a.resetTextureFormat(),a.setTexCoordUnit(i),a.setEnable(!0)},createMaterial:function(t,e){var i=this._materialManager.createMaterial(t,e);return this._materials.push(i),i},createTextureModelFromTextureOSG:function(t){var e=h.getOptions(t),i=t.getImage(),n=i.getURL(),a=this._materialManager.getImageCollection(),s=a.getImageFromURL(n);return s?new u(r.extend(e,{image:s})):void l.error("SceneProcessorVisitor.createTextureModelFromTextureOSG can't find image "+n+" image collections")},mapTexturesOnMaterial:function(t,e){for(var i=this.getTextureLists(t),r=t.getNumTextureAttributeLists(),n=function(t,e,i,r,n){if(void 0!==r){var a=this.createTextureModelFromTextureOSG(r);this.setMaterialChannelTexture(t,e,i,n,a)}}.bind(this),a=0,s=r;s>a;a++){var o=a,u=t.getTextureAttribute(a,"Texture");void 0!==u&&(1===r?n(t,e,o,i[o],"DiffuseColor"):r>=2&&(0===o?n(t,e,o,i[o],"EmitColor"):1===o?n(t,e,o,i[o],"DiffuseColor"):2===o&&n(t,e,o,i[o],"SpecularColor")))}},postApply:function(){},applyExistingMaterial:function(t,e){if(t){var i=t.getInstanceID(),r=this._stateSetsProcessed[i];this._stateSetsProcessed[i]=!0;var n=this._materialManager.getMaterialByStateSet(t);if(n)return r===!0?n:(n.set("name",this._materialManager.getUniqueMaterialName(t.getAttributeMap().Material,t,e)),n.setStateSet(t),this._materials.push(n),n)}},processLightSource:function(){},removeDuplicateTexCoordUnit:function(t,e){if(e instanceof l.Geometry!=!1&&t){var i=t.get("texCoordUnitList");if(1!==i.length){var n="TexCoord",a=e.getVertexAttributeList();i.sort();for(var s=!0,o=[],u=[],h=i.length-1;h>=0;--h){for(var c=i[h],d=a[n+c],p=0;h>p;++p)if(d===a[n+i[p]]){s=!1;break}var f=i[p];o[c]=f,u.push(f)}s||(t.set("texCoordUnitList",r.uniq(u)),r.each(t.getChannels(),function(t){var e=t.getTexCoordUnit();void 0!==e&&t.setTexCoordUnit(o[e])}))}}},apply:function(t){t.typeID===l.LightSource.typeID&&this.processLightSource(t);var e=t.getStateSet();if(e){var i=this.applyExistingMaterial(e,t);if(!i){var r=this.getMetaData(e);r?this.processMaterial(t,e,r):this.hasMaterialAttributes(e)&&this.processDefaultMaterial(t,e),i=this._materialManager.getMaterialByStateSet(e),this.checkForPBRTextureFromChannelsAndFilenames(i),this._materialManager.getImageCollection().length&&(this.checkForPBRTextureFromMaterialAndFilenames(i),this.checkChannelsAndSetWorkFlowRoughGloss(i))}this.removeDuplicateTexCoordUnit(i,t)}this.traverse(t)}}),t.exports=c},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(239),s=i(1340),o=i(1099),u=n.osg,fif(n),h=r.invert(u.Texture),l=["magFilter","minFilter","wrapS","wrapT","textureTarget","internalFormat"],c=a.extend({initialize:function(t){if(a.prototype.initialize.apply(this,arguments),!t||!t.image)return void u.error("no image found in attributes, TextureModel invalid");var e=s.createValidOptionsForMaterial(t);this.bind("change:image",this.updateTextureProxy,this),this.set(e),this.updateTextureProxy()},getImage:function(){return this.get("image")},setImage:function(t){this.set("image",t)},getResourceManager:function(){return this._resourceManager||o.instance},getTextureProxy:function(){return this.get("textureProxy")},getURL:function(){console.trace("dont call TextureModel.getURL")},updateTextureProxy:function(){var t=this.get("image"),e=t.getUID(),i=s.createValidOptionsForMaterial(this.toJSON()),r=this.getResourceManager().getOrCreateTextureProxy(e,i);r&&this.set("textureProxy",r.resource)},getUID:function(){return this.getImage().getUID()},getJSON:function(){for(var t={},e=0,i=l.length;i>e;++e){var r=l[e];t[r]=h[this.get(r)]}return t.texCoordUnit=this.get("texCoordUnit"),t.uid=this.getUID(),t}});c.createFromTexture=function(){console.error("dont call TextureModel.createFromTexture")},t.exports=c},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=function(){n.Light.apply(this,arguments)};a.prototype=n.objectLibraryClass(n.objectInherit(n.Light.prototype,{attributeType:"SketchfabLight"}),"osgSketchfab","Light");var s=n.Vec3.create();n.LightSource.prototype.computeBoundingSphere=function(t){if(n.Node.prototype.computeBoundingSphere.call(this,t),!t.valid())return t;if(void 0!==this._light&&this._referenceFrame===n.Transform.RELATIVE_RF){var e=this._light.getPosition();0!==e[3]&&t.expandByVec3(n.Vec3.mult(e,1/e[3],s))}return t},t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1425),a=r.osg,fif(r),s=function(){n.apply(this,arguments)};s.prototype=a.objectInherit(n.prototype,{processMaterial:function(t,e,i){var r,n=this.createMaterial(t,e),a=["lambert","blinn","phong"],s=function(t,e,r){for(var n=a.length,s="_"+t+"_"+e;n--;)if(void 0!==i[a[n]+s]){var o=i[a[n]+s];return r?o:JSON.parse(o)}},o="color";r=s("emission",o),void 0!==r&&(n.setChannelColor("EmitColor",r),n.setChannelEnable("EmitColor",!0)),r=s("diffuse",o),void 0!==r&&(n.setChannelColor("DiffuseColor",r),n.setChannelEnable("DiffuseColor",!0)),r=s("specular",o),void 0!==r&&(n.setChannelColor("SpecularColor",r),n.setChannelEnable("SpecularColor",!0)),o="amount",r=s("shininess",o),void 0!==r&&(n.setChannelFactor("SpecularHardness",128*r),n.setChannelEnable("SpecularHardness",!0));var u=1;r=s("transparency","amount"),void 0!==r&&(u=r),n.setChannelFactor("Opacity",u),n.setChannelEnable("Opacity",!0),e.removeAttribute("Material");var h,l,c=[];!function(){for(var t=0;t<e.getNumTextureAttributeLists();t++){var i=e.getTextureAttribute(t,"Texture");void 0!==i&&("TextureMaterial"===i.className()&&(i=i.getTexture()),c[t]=i)}}();var d=function(t,i,r){e.removeTextureAttribute(t,"Texture");var a=n.getChannels()[r];a.setTexture(this.createTextureModelFromTextureOSG(i)),a.resetTextureFormat(),a.setTexCoordUnit(t),a.setEnable(!0)}.bind(this);if(o="unit",r=s("emissive",o),void 0!==r&&(h=r,l=c[h],void 0!==l&&d(h,l,"EmitColor")),r=s("diffuse",o),void 0!==r&&(h=r,l=c[h],void 0!==l&&d(h,l,"DiffuseColor")),r=s("specular",o),void 0!==r&&(h=r,l=c[h],void 0!==l&&d(h,l,"SpecularColor")),void 0!==i.extra_shininess_unit&&(h=JSON.parse(i.extra_shininess_unit),l=c[h],void 0!==l&&d(h,l,"SpecularColor")),r=s("transparency",o),void 0!==r&&(h=r,l=c[h],void 0!==l)){var p=s("transparency","alphamask");p?(d(h,l,"Opacity"),l=n.getChannels().Opacity.getTexture(),n.getChannels().Opacity.setTransparency("alphaMask")):(d(h,l,"Opacity"),l=n.getChannels().Opacity.getTexture(),n.getChannels().Opacity.setTransparency("alphaBlend"))}void 0!==i.extra_bump_unit&&(h=JSON.parse(i.extra_bump_unit),l=c[h],void 0!==l&&d(h,l,"BumpMap"),i.extra_bump_amount&&(r=JSON.parse(i.extra_bump_amount),n.setChannelFactor("BumpMap",r))),void 0!==i.extra_normal_unit&&(h=JSON.parse(i.extra_normal_unit),l=c[h],void 0!==l&&d(h,l,"NormalMap"),i.extra_normal_amount&&(r=JSON.parse(i.extra_normal_amount),n.setChannelFactor("NormalMap",r))),e.removeAttribute("Material"),n.setStateSet(e)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(1425),a=r.osg,fif(r),s=function(){n.apply(this,arguments)};s.prototype=a.objectInherit(n.prototype,{processMaterial:function(t,e){return this.processDefaultMaterial(t,e)},processDefaultMaterial:function(t,e){var i=this.createMaterial(t,e),r=e.getAttribute("Material");return void 0!==r&&(i.setChannelColor("EmitColor",r.getAmbient()),i.setChannelColor("DiffuseColor",r.getDiffuse()),i.setChannelColor("SpecularColor",r.getSpecular()),i.setChannelFactor("SpecularHardness",r.getShininess()),i.setChannelFactor("Opacity",r.getDiffuse()[3]),i.setChannelEnable("EmitColor",!0),i.setChannelEnable("DiffuseColor",!0),i.setChannelEnable("SpecularColor",!0),i.setChannelEnable("SpecularHardness",!0),i.setChannelEnable("Opacity",!0),e.removeAttribute("Material")),this.mapTexturesOnMaterial(e,i),i.setStateSet(e),i}}),t.exports=s},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(1425),s=i(1427),o=n.osg,fif(n),u=function(){a.apply(this,arguments)};u.prototype=o.objectInherit(a.prototype,{setChannelsFromMetaData:function(t,e,i,n){r.each(n,function(r,n){if(void 0!==t[n]){var a=JSON.parse(t[n]);e[i](r,a),e.setChannelEnable(r,!0)}})},setMaterialChannelTexture:function(t,e,i,r,n){t.removeTextureAttribute(i,"Texture");var a=e.getChannels()[n];a.setTexture(this.createTextureModelFromTextureOSG(r)),a.resetTextureFormat(),a.setTexCoordUnit(i),a.setFactor(1),a.setEnable(!0)},getReferencedTextures:function(t){for(var e=[],i=0;i<t.getNumTextureAttributeLists();i++){var r=t.getTextureAttribute(i,"Texture");void 0!==r&&("TextureMaterial"===r.className()&&(r=r.getTexture()),e[i]=r)}return e},processLightSource:function(t){var e=t.getLight();if(e){var i=e.getUserData();if(void 0!==i&&e.typeID!==s.typeID){var r=this.convertUserDataToObject(i),n=new s;if("directional"===r.Type)n.setLightType("DIRECTION");else if("point"===r.Type)n.setLightType("POINT");else{if("spot"!==r.Type)return;n.setLightType("SPOT")}if("spot"===r.Type){n.setSpotCutoff(JSON.parse(r.OuterAngle)/2);var a=JSON.parse(r.InnerAngle)/JSON.parse(r.OuterAngle);n.setSpotBlend(a!==a||Math.abs(a)===1/0?.5:Math.min(a,1))}o.Vec3.mult(JSON.parse(r.Color),JSON.parse(r.Intensity)/100,n.getDiffuse());var u=1/JSON.parse(r.DecayStart);n.setQuadraticAttenuation(Math.abs(u)===1/0?0:u),n._node=t,this._lights.push(n)}}},processMaterial:function(t,e,i){var n=this.createMaterial(t,e),a={LambertDiffuseColor:"DiffuseColor",LambertEmissiveColor:"EmitColor",PhongSpecularColor:"SpecularColor"},s={sDiffuse:"DiffuseColor",sNormalMap:"NormalMap",sBump:"BumpMap",sEmissive:"EmitColor",sSpecular:"SpecularColor",sOpacity:"Opacity",sAo:"AOPBR",sRoughness:"RoughnessPBR",sMetallic:"MetalnessPBR"},u={LambertDiffuseFactor:"DiffuseColor",LambertBumpFactor:"BumpMap",LambertEmissiveFactor:"EmitColor",PhongSpecularFactor:"SpecularColor",PhongShininess:"SpecularHardness"};this.setChannelsFromMetaData(i,n,"setChannelColor",a),this.setChannelsFromMetaData(i,n,"setChannelFactor",u),e.removeAttribute("Material");var h=this.getReferencedTextures(e);if(r.each(s,function(t,r){if(void 0!==i[r]){var a=JSON.parse(i[r]),s=h[a];void 0!==s&&this.setMaterialChannelTexture(e,n,a,s,t)}}.bind(this)),i.LambertBumpFactor&&!i.sBump&&n.getChannels().BumpMap.setEnable(!1),"Tilt Brush"===this._authoringTool){var l=n.getChannels(),c=l.EmitColor;c.set("type","multiplicative"),c.getTexture()||0===c.getColor()[0]&&0===c.getColor()[1]&&0===c.getColor()[2]&&c.setColor(o.Vec3.createAndSet(1,1,1)),l.SpecularF0.setFactor(0),l.RoughnessPBR.setFactor(1);var d=i.BlendMode;"AlphaMask"===d?(l.Opacity.setFactor(i.LambertTransparencyFactor||0),l.Opacity.setTransparency("alphaMask")):"AdditiveBlend"===d?(l.Opacity.setFactor(1-(i.LambertTransparencyFactor||0)),l.Opacity.setTransparency("additive")):l.Opacity.setEnable(!1)}n.setStateSet(e)}}),t.exports=u},function(t,e,i){"use strict";var r=i(1100),n=i(1425),a=r.osg,fif(r),s=function(){n.apply(this,arguments)};s.prototype=a.objectInherit(n.prototype,{processMaterial:function(t,e,i){var r,n,s=this.createMaterial(t,e),o=function(t){for(var e=[],i=0;i<t.getNumTextureAttributeLists();i++){var r=t.getTextureAttribute(i,"Texture");void 0!==r&&("TextureMaterial"===r.className()&&(r=r.getTexture()),e[i]=r)}return e}(e),u=function(t,e,i,r){t.removeTextureAttribute(e,"Texture");var n=s.getChannels()[r];n.setTexture(this.createTextureModelFromTextureOSG(i)),n.resetTextureFormat(),n.setTexCoordUnit(0),n.setEnable(!0)}.bind(this);void 0!==i.diffuse&&(r=JSON.parse(i.diffuse),n=o[r],void 0!==n&&u(e,r,n,"DiffuseColor")),void 0!==i.specular&&(r=JSON.parse(i.specular),n=o[r],void 0!==n&&u(e,r,n,"SpecularColor")),void 0!==i.transparency&&(r=JSON.parse(i.transparency),n=o[r],void 0!==n&&(u(e,r,n,"Opacity"),e.setRenderingHint("TRANSPARENT_BIN"),e.setTextureAttributeAndModes(r,n),e.setAttributeAndModes(new a.BlendFunc("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")))),e.removeAttribute("Material"),s.setStateSet(e)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(1425),a=i(1433),s=i(1427),o=r.osg,fif(r),u=function(){n.apply(this,arguments)};u.prototype=o.objectInherit(a.prototype,{isSelfIlluminationSurface:function(t){if(!t.length)return!1;var e=t[0],i=e.getImage().getURL().split("/").pop().split(".").shift();return i.match("carrot_crop_(.*)")||i.match("crops_(.*)")||"fern"===i||"dead_shrub"===i||"flower_red"===i||"flower_yellow"===i||"lilypad"===i||"mushroom_brown"===i||"mushroom_red"===i||i.match("netherwart_(.*)")||i.match("potato_crop_(.*)")||i.match("sapling_(.*)")||"tall_grass"===i||"torch"===i||"torch_flame"===i?!0:!1},getReferencedTextures:function(t){for(var e=[],i=0;i<t.getNumTextureAttributeLists();i++){var r=t.getTextureAttribute(i,"Texture");void 0!==r&&("TextureMaterial"===r.className()&&(r=r.getTexture()),e[i]=r)}return e},setMaterialChannelTexture:function(t,e,i,r,n,a,s){t.removeTextureAttribute(i,"Texture");var u=e.getChannels()[n],h=this.createTextureModelFromTextureOSG(r);h.set("wrapT",o.Texture[a]),h.set("wrapS",o.Texture[a]),s&&(h.set("minFilter",o.Texture.NEAREST_MIPMAP_LINEAR),h.set("magFilter",o.Texture.NEAREST),h.updateTextureProxy()),u.setTexture(h),u.resetTextureFormat(),u.setTexCoordUnit(0),u.setEnable(!0)},processMaterial:function(t,e,i){var r=this.createMaterial(t,e),n={kd:"DiffuseColor"},a={tr:"Opacity",d:"Opacity"};this.setChannelsFromMetaData(i,r,"setChannelColor",n),this.setChannelsFromMetaData(i,r,"setChannelFactor",a),void 0!==i.ka&&(r.setChannelFactor("EmitColor",.1),r.setChannelEnable("EmitColor",!0)),r.setChannelColor("SpecularColor",o.Vec3.create()),r.setChannelEnable("SpecularColor",!0),r.setChannelFactor("SpecularHardness",1),r.setChannelEnable("SpecularHardness",!0),this.verifyOpacity(r),e.removeAttribute("Material");var u,h,l="mineways"===i.source,c=this.getReferencedTextures(e),d=this.isSelfIlluminationSurface(c),p=d?"CLAMP_TO_EDGE":"REPEAT";if(void 0!==i.map_kd&&(u=JSON.parse(i.map_kd),h=c[u],void 0!==h&&this.setMaterialChannelTexture(e,r,u,h,"DiffuseColor",p,l)),d||(void 0!==i.map_ke?(u=JSON.parse(i.map_ke),h=c[u],void 0!==h&&(this.setMaterialChannelTexture(e,r,u,h,"EmitColor",p,l),r.setChannelFactor("EmitColor",1))):void 0!==i.map_ka?(u=JSON.parse(i.map_ka),h=c[u],void 0!==h&&this.setMaterialChannelTexture(e,r,u,h,"EmitColor",p,l)):(u=JSON.parse(i.map_kd),h=c[u],void 0!==h&&(this.setMaterialChannelTexture(e,r,u,h,"EmitColor",p,l),r.setChannelFactor("EmitColor",.1)))),d&&(r.set("shadeless",!0),r.setChannelFactor("EmitColor",0),r.setChannelEnable("EmitColor",!0)),void 0!==i.map_d&&(u=JSON.parse(i.map_d),h=c[u],void 0!==h)){this.setMaterialChannelTexture(e,r,u,h,"Opacity",p,l);var f=r.getChannels().Opacity;l?(f.getTexture().set("internalFormat",o.Texture.ALPHA),-1!==r.attributes.name.toLowerCase().indexOf("leaves")&&(f.setTransparency("alphaMask"),r.setChannelFactor("Opacity",.2))):(f.getTexture().set("internalFormat",o.Texture.LUMINANCE),f.setTransparency("alphaBlend")),r.set("cullFace",o.CullFace.BACK)}if(r.setChannelFactor("RoughnessPBR",1),r.setChannelFactor("SpecularF0",0),e.removeAttribute("Material"),r.setStateSet(e),!this._lights.length){var g=new o.MatrixTransform;o.Matrix.makeRotate(Math.PI/6,1,1,0,g.getMatrix());var m=new s;m.setLightType("DIRECTION"),o.Vec3.set(1,1,1,m.getDiffuse()),m._node=g,this._lights.push(m)}}}),t.exports=u},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(1425),s=n.osg,fif(n),o=function(){a.apply(this,arguments)};o.prototype=s.objectInherit(a.prototype,{verifyOpacity:function(t){var e=t.getChannels().Opacity.getFactor();.001>e&&(e=1),t.setChannelFactor("Opacity",e)},setChannelsFromMetaData:function(t,e,i,n){r.each(n,function(r,n){if(void 0!==t[n]){var a=JSON.parse(t[n]);e[i](r,a),e.setChannelEnable(r,!0)}})},processMaterial:function(t,e,i){var r=this.createMaterial(t,e),n={kd:"DiffuseColor",ka:"EmitColor",ks:"SpecularColor"},a={ns:"SpecularHardness",tr:"Opacity",d:"Opacity"};this.setChannelsFromMetaData(i,r,"setChannelColor",n),this.setChannelsFromMetaData(i,r,"setChannelFactor",a),this.verifyOpacity(r),e.removeAttribute("Material");var s,o,u=function(t){for(var e=[],i=0;i<t.getNumTextureAttributeLists();i++){var r=t.getTextureAttribute(i,"Texture");void 0!==r&&("TextureMaterial"===r.className()&&(r=r.getTexture()),e[i]=r)}return e}(e),h=function(t,e,i,n){t.removeTextureAttribute(e,"Texture");var a=r.getChannels()[n];a.setTexture(this.createTextureModelFromTextureOSG(i)),a.resetTextureFormat(),a.setTexCoordUnit(0),a.setEnable(!0)}.bind(this);void 0!==i.map_ka&&(s=JSON.parse(i.map_ka),o=u[s],void 0!==o&&h(e,s,o,"EmitColor")),void 0!==i.map_kd&&(s=JSON.parse(i.map_kd),o=u[s],void 0!==o&&h(e,s,o,"DiffuseColor")),void 0!==i.map_occlusion&&(s=JSON.parse(i.map_occlusion),o=u[s],void 0!==o&&h(e,s,o,"DiffuseIntensity")),void 0!==i.map_d&&(s=JSON.parse(i.map_d),o=u[s],void 0!==o&&(h(e,s,o,"Opacity"),r.getChannels().Opacity.setTransparency("alphaBlend"))),void 0!==i.map_ks&&(s=JSON.parse(i.map_ks),o=u[s],void 0!==o&&h(e,s,o,"SpecularColor")),void 0!==i.map_ns&&(s=JSON.parse(i.map_ns),o=u[s],void 0!==o&&h(e,s,o,"SpecularHardness")),void 0!==i.map_normal&&(s=JSON.parse(i.map_normal),o=u[s],void 0!==o&&h(e,s,o,"NormalMap")),void 0!==i.bump&&(s=JSON.parse(i.bump),o=u[s],void 0!==o&&h(e,s,o,"BumpMap")),r.setStateSet(e)}}),t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=function(){n.NodeVisitor.call(this,n.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._paths=[],this._pathsStateSet=[],this._currentStateSet=[],this._stateSetMap={},this._stateSetMapNodes={},this._wireframePaths=[],this._noGeometryPaths=[],this.nodeMaskOverride=-1};a.prototype=n.objectInherit(n.NodeVisitor.prototype,{getPathList:function(){return this._paths},getStateSetMap:function(){return this._stateSetMap},getStateSetMapNodes:function(){return this._stateSetMapNodes},getStateSetPathList:function(){return this._pathsStateSet},getWireframePathList:function(){return this._wireframePaths},getNoGeometryPathList:function(){return this._noGeometryPaths},apply:function(t){var e=t.getStateSet();if(e){var i=e._uniqueID;this._stateSetMap[i]?this._stateSetMapNodes[i].push(t):(this._stateSetMap[i]=e,this._stateSetMapNodes[i]=[]),this._currentStateSet.push(e)}t instanceof n.Geometry?t.userDataMap&&t.userDataMap.wireframe?this._wireframePaths.push(this.nodePath.slice(0)):(this._pathsStateSet.push(this._currentStateSet.slice(0)),this._paths.push(this.nodePath.slice(0))):(this.traverse(t),0===t.getChildren().length&&this._noGeometryPaths.push(this.nodePath.slice(0))),e&&this._currentStateSet.pop()}}),t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=function(t){n.NodeVisitor.call(this,n.NodeVisitor.TRAVERSE_ALL_CHILDREN),this.stateSetStack=[],this.countGeometryStack={},this.removedStateSet=[],this.keepedStateSet=[],
this.deep=0,this.materialRootList=t||{}};a.prototype=n.objectInherit(n.NodeVisitor.prototype,{getCurrentStateSet:function(){return this.stateSetStack[this.stateSetStack.length-1]},getCurrentGeometryCount:function(){return void 0===this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]&&(this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]=0),this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]},setCurrentGeometryCount:function(t){this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]=t},updateStateSetGeometryCount:function(t){var e=this.getCurrentGeometryCount();e+=t,this.setCurrentGeometryCount(e)},logTree:function(t,e){for(var i="";t--;)i+="    ";n.log(i+e)},apply:function(t){var e=t.getStateSet();if(e&&(this.stateSetStack.push(e),this.deep++,this.logTree(this.deep,e._uniqueID+" >>>")),this.traverse(t),t instanceof n.Geometry&&(this.updateStateSetGeometryCount(1),this.logTree(this.deep," Geom")),e){if(this.logTree(this.deep,e._uniqueID+" <<< geom children num "+this.getCurrentGeometryCount()),0===this.getCurrentGeometryCount())this.removedStateSet.push(e._uniqueID);else{var i=!0,r=e._uniqueID,a=this.stateSetStack.length;if(a-- >1)for(;a-- >0;){var s=this.stateSetStack[a],o=this.materialRootList[s._uniqueID];if(o&&o.rootMaterialToKeep)if(2===this.materialRootList.size){var u=this.materialRootList[r];if(u)for(var h in o.attributes.channels)o.attributes.channels[h].attributes.texture&&(u.attributes.channels[h].attributes.texture=o.attributes.channels[h].attributes.texture)}else o.rootMaterialDidOverride=!0,e._uniqueID=o.attributes.stateSetID,i=!1,this.keepedStateSet.push(o.attributes.stateSetID)}i?this.keepedStateSet.push(r):this.removedStateSet.push(r)}this.stateSetStack.pop(),this.deep--}}}),t.exports=a},function(t,e,i){"use strict";var r,n=i(1100),a=i(1390),s=i(1357),o=n.osg,fif(n),u=n.osgAnimation,h={splitLimit:65536,limitMergePerMaterial:100,hasAnimation:!1,isTransparent:!1,isWireframe:!1,channelTargetNames:{},bakedGeometriesFromID:{},parentCountFromID:{},childrenCountFromID:{},multiParentPathFromGeometryID:{},animatedFromID:{}},l={Vertex:1,Normal:1,Tangent:1},c=function(t,e){var i=t[t.length-1],r=e[e.length-1];return r.getVertexAttributeList().Vertex.getElements().length-i.getVertexAttributeList().Vertex.getElements().length},d=function(t){return t===a.TRANSPARENT_BIN},p=function(t){return t.getVertexAttributeList().Vertex.getElements().length/3},f=function(t){return t[t.length-1].getVertexAttributeList().Vertex.getElements().length/3},g=function(t){var e=t.getStateSet();return e&&e.getAttribute("SketchfabMaterial")?e:void 0},m=function(t){for(var e=t.length-1;e>=0;--e){var i=g(t[e]);if(i)return i}},v=function(t){for(var e=0,i=t.length;i>e;++e)t[e].removeChildren()},_=function(t){for(var e=0,i=t.length-1;i>e;++e)t[e].addChild(t[e+1])},b=function(t){for(var e=t.length,i=0;e>i;++i)v(t[i])},x=function(t){var e=t[t.length-1].getInstanceID(),i=h.multiParentPathFromGeometryID;return Boolean(i[e])},A=function(t,e,i){var r=e.getVertexAttributeList().Vertex.getElements(),n=t.getVertexAttributeList().Vertex.getElements();e.getVertexAttributeList().Vertex.setElements(n.subarray(i,i+r.length)),t._boundingBox.copy(e.getBoundingBox()),t._boundingBoxComputed=!0;var a=e.getBoundingSphere(),s=t._boundingSphere;s.set(o.Vec3.copy(a.center(),s.center()),a.radius()),t._boundingSphereComputed=!0,e.getVertexAttributeList().Vertex.setElements(r),e.dirtyBound()},y=function(t){var e=o.Matrix.create();return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[8]=t[8],e[9]=t[9],e[10]=t[10],o.Matrix.inverse(e,e),o.Matrix.transpose(e,e),e},S=function(t,e,i,r){var n=h.bakedGeometriesFromID[e.getInstanceID()];n||(h.bakedGeometriesFromID[i.getInstanceID()]=!0);var a=i.getElements();r&&(a=a.subarray(r));var s=e.getElements();if(n||o.Matrix.isIdentity(t))return void(i!==e&&a.set(s));for(var u=e.getItemSize(),l=o.Vec3.create(),c=Math.min(s.length,a.length),d=0;c>d;d+=u)l[0]=s[d],l[1]=s[d+1],l[2]=s[d+2],o.Matrix.transformVec3(t,l,l),a[d]=l[0],a[d+1]=l[1],a[d+2]=l[2]},C=function(t,e,i,r){var n=i.getIndices(),a=n.getElements(),s=a.length,u=0,l=i.getMode(),c=t[l],d=c.drawElements,p=d.getIndices().getElements(),f=d.getCount(),g=f;if(l!==o.PrimitiveSet.TRIANGLE_STRIP||h.isTransparent)p.set(a,g);else{var m=p[f-1],v=a[0]+r,_=m!==v&&0!==f?2:0,b=f%2;_&&(p[f]=m,p[f+1]=v),b&&(p[f+_]=v),g+=_+b,p.set(a,g)}d.setCount(g+s);var x=g+s;for(u=g;x>u;++u)p[u]+=r;h.isTransparent&&(i.setIndices(d.getIndices()),i.setCount(s),i.setFirst(g*p.BYTES_PER_ELEMENT))},w=function(t,e,i,r){for(var n=i.length,a=0;n>a;++a){var s=i[a];s instanceof o.DrawElements?C(t,e,s,r):s.first+=r}},T=function(t){for(var e=t[t.length-1],i=[{nbVertex:f(e),pathList:[e]}],r=t.length-1;r>0;--r){var n=t[r-1],a=t[r],s=i[i.length-1],o=f(n),u=s.nbVertex;o+u>=h.splitLimit?i.push({nbVertex:f(a),pathList:[a]}):(s.nbVertex+=o,s.pathList.push(n))}return i},M=function(t,e,i){for(var r=x(t),n=0,a=i.length;a>n;++n){var s,u=i[n];if(r)if(u instanceof o.DrawElements){var h=u.getIndices(),l=h.getElements(),c=new l.constructor(l.getElements()),d=new o.BufferArray(o.BufferArray.ELEMENT_ARRAY_BUFFER,c,h.getItemSize(),!0);s=new o.DrawElements(u.getMode(),d)}else s=new o.DrawArrays(u.getMode(),u.getFirst(),u.getCount());else s=u;e.push(s)}},E=function(t,e,i){for(var r=e*i,n=t.length,a=r;n>a;++a)t[a]=1},k=function(t,e){var i=t[t.length-1],r=new o.Geometry;r.setName(i.getName()),M(t,r.getPrimitiveSetList(),i.getPrimitiveSetList());for(var n=o.computeLocalToWorld(t),a=y(n),s=e!==p(i),u=x(t),c=r.getVertexAttributeList(),d=i.getVertexAttributeList(),f=Object.keys(d),g=0,m=f.length;m>g;++g){var v,_=f[g],b=d[_],C=l[_],w=b.getItemSize();if(s?(v=new Float32Array(e*w),C||v.set(b.getElements()),"Color"===_&&E(v,b.getElements().length/w,w)):C&&u?v=new Float32Array(b.getElements().length):c[_]=b,v&&(c[_]=new o.BufferArray(o.BufferArray.ARRAY_BUFFER,v,w,!0)),C){var T="Vertex"===_?n:a;S(T,b,c[_],0)}}return h.isTransparent&&A(r,i,0),r},I=function(t,e,i){for(var r=e[e.length-1],n=t.getVertexAttributeList(),a=r.getVertexAttributeList(),s=Object.keys(a),u=o.computeLocalToWorld(e),h=y(u),c=s.length,d=0;c>d;++d){var p=s[d],f=n[p],g=a[p],m=f.getElements(),v=i*g.getItemSize();if(l[p]){var _="Vertex"===p?u:h;S(_,g,f,v)}else m.set(g.getElements(),v)}},N=function(t,e,i){for(var r=Object.keys(e),n=0,a=r.length;a>n;++n){var s=r[n];if(!t[s]){var u=e[s].getItemSize(),h=new Float32Array(i*u),l=new o.BufferArray(o.BufferArray.ARRAY_BUFFER,h,u,!0);t[s]=l,"Color"===s&&E(h,0,u)}}},R=function(t,e,i){var r=0,n=e.length;for(r=0;n>r;++r){var a=e[r];if(a instanceof o.DrawElements!=!1){var s=a.getMode(),u=t[s];if(!u){var l=a.getIndices().getItemSize(),c=new o.BufferArray(o.BufferArray.ELEMENT_ARRAY_BUFFER,new Uint16Array,l,!0);u=t[s]={drawElements:new o.DrawElements(s,c),lastElement:-1,initCount:0,existInBase:!1}}var d=u.drawElements;if(s!==o.PrimitiveSet.TRIANGLE_STRIP||h.isTransparent)d.setCount(d.getCount()+a.getCount());else{var p=a.getIndices().getElements(),f=p[0]+i,g=u.lastElement!==f&&0!==d.getCount()?2:0,m=d.getCount()%2;d.setCount(d.getCount()+a.getCount()+g+m),u.lastElement=p[p.length-1]+i}}}},F=function(t){for(var e={},i=0,r=t.length;r>i;++i){var n=t[i];if(n instanceof o.DrawElements){var a=n.getIndices().getElements();e[n.getMode()]={drawElements:n,lastElement:a[a.length-1],initCount:n.getCount(),existInBase:!0}}}return e},P=function(t,e,i){for(var r=Object.keys(e),n=0,a=r.length;a>n;++n){var s=e[r[n]],o=s.drawElements,u=o.getIndices(),h=u.getElements();u.setElements(new i(o.getCount())),u.getElements().set(h),o.setIndices(u),o.setCount(h.length),s.existInBase||t.push(o)}},D=function(t,e,i,r){for(var n=t.getVertexAttributeList(),a=p(t),s=r,o=0,u=e.length;u>o;++o){var h=e[o],l=h[h.length-1];N(n,l.getVertexAttributeList(),a),R(i,l.getPrimitiveSetList(),s),s+=f(h)}P(t.getPrimitiveSetList(),i,a>=65536?Uint32Array:Uint16Array)},L=function(t,e){var i=t.pathList,r=i.pop(),n=p(r[r.length-1]),a=k(r,t.nbVertex);if(e.addChild(a),0!==i.length){var s=a.getPrimitiveSetList(),u=F(s);D(a,i,u,n);for(var l=h.isTransparent,c=0,d=i.length;d>c;++c){var g=i[c];I(a,g,n);var m=g[g.length-1];if(l||x(g)){var v=new o.Geometry;v.setName(m.getName()),M(g,v.getPrimitiveSetList(),m.getPrimitiveSetList()),l&&(v.attributes=v._attributes=a.getVertexAttributeList(),e.addChild(v),A(v,m,3*n)),m=v}var _=m.getPrimitiveSetList();w(u,s,_,n),n+=f(g)}if(h.isTransparent){var b=u[o.PrimitiveSet.TRIANGLE_STRIP];b&&b.drawElements.setCount(b.initCount),b=u[o.PrimitiveSet.TRIANGLES],b&&b.drawElements.setCount(b.initCount)}}},O=function(t){var e=t.localRoot;t.renderPathList.sort(c);for(var i=T(t.renderPathList),r=i.length,n=0;r>n;++n)L(i[n],e)},V=function(t){var e=t.localRoot,i=e.getStateSet();h.isTransparent=Boolean(i&&d(i.getBinNumber())),t.renderPathList.length>h.limitMergePerMaterial&&(h.isTransparent=!1),O(t)},B=function(t,e,i){var r;h.isWireframe||(r=m(t));var n=h.isWireframe?0:r.getInstanceID(),a=e[n];a||(e[n]=a={localRoot:new o.Node,renderPathList:[]},a.localRoot.setStateSet(r),a.localRoot.setName(h.isWireframe?"Wireframe":r.getName()),i.addChild(a.localRoot)),a.renderPathList.push(t),t[0]===i&&t.shift()},U=function(t,e,i){var r={},n=0,a=t.length;for(n=0;a>n;++n)B(t[n],r,e);o.time(i+" - merge geometries");var s=Object.keys(r),u=s.length;for(n=0;u>n;++n)V(r[s[n]]);o.timeEnd(i+" - merge geometries")},G=function(t){for(var e=!1,i=h.channelTargetNames,r=0,n=t.length;n>r;++r){var a,s=t[r],l=!1;if(s instanceof u.Bone)a=u.UpdateBone;else{if(!(s instanceof o.MatrixTransform))continue;a=u.UpdateMatrixTransform,l=!0}for(var c=s.getUpdateCallbackList(),d=c.length-1;d>=0;--d){var p=c[d];p instanceof a!=!1&&(i[p.getName()]||!l?e=!0:s.removeUpdateCallback(p))}}var f=t[t.length-1];return e||f instanceof u.RigGeometry||f instanceof u.MorphGeometry},z=function(){var t=[];return function(e){return t[0]=e,G(t)}}();n.osgDB.Input.prototype.getJSON=function(){return this._json.Animations&&(r=this._json),this._json};var j=function(){var t=h.channelTargetNames;if(!h.hasAnimation)return t;for(var e=r.Animations,i=0,n=e.length;n>i;++i)for(var a=e[i]["osgAnimation.Animation"].Channels,s=0,o=a.length;o>s;++s){var u=a[s];t[u[Object.keys(u)[0]].TargetName]=1}return t},H=function(t,e){for(var i=t.length-1;i>=0;--i){var r=t[i],n=r[r.length-1];n instanceof o.Geometry==!1&&n instanceof u.Bone==!1?t.splice(i,1):G(r)&&(e.push(r),t.splice(i,1))}},W=function(t,e,i){H(t.getPathList(),e),H(t.getNoGeometryPathList(),e),H(t.getWireframePathList(),i)},Q=function(t){for(var e=h.parentCountFromID,i=h.childrenCountFromID,r=h.multiParentPathFromGeometryID,n=0,a=t.length;a>n;++n){for(var s=t[n],o=!1,u=0,l=s.length;l>u;++u){var c=s[u],d=c.getInstanceID();e[d]=c.getParents().length,i[d]=c.getChildren().length,o=o||c.getParents().length>1}r[s[s.length-1].getInstanceID()]=o}},Y=function(t){Q(t.getPathList()),Q(t.getNoGeometryPathList()),Q(t.getWireframePathList())},q=function(t){b(t.getPathList()),b(t.getNoGeometryPathList()),b(t.getWireframePathList())},X=function(t,e,i,r){var n=0,a=t.length,s=i.length,o=!1;for(n=a-1;n>=0;--n){var u=t[n];_(u),m(u)||(o=!0)}for(n=s-1;n>=0;--n){var h=i[n];_(h),r.push(h[h.length-1])}o||e.setStateSet(void 0)},K=function(t,e,i){h.isWireframe=!0,U(e,t,"optimizer wireframe");var r=t.getChildren(),n=r[r.length-1];n.setNodeMask(0),i.push(n)},J=function(t,e){var i=t.length;if(0!==i)for(var r=t[0].indexOf(e),n=Boolean(e.getStateSet())?0:1,a=0;i>a;++a){var s=t[a];s.splice(0,r+n)}},Z=function(t){for(var e=t.getUpdateCallbackList(),i=0,r=e.length;r>i;++i){var n=e[i];if(n instanceof u.BasicAnimationManager)return t.removeUpdateCallback(n),n}},$=function(t){for(var e,i,r=t.getPathList(),n=r[0][0],a=n,s=[];;){e=g(a)||e,i=i||Z(a);var h=a.getChildren();if(1!==h.length)break;if(h[0]instanceof u.Skeleton)break;if(h[0]instanceof o.Geometry)break;if(z(a))break;s.push(a),a=h[0]}if(n.removeChildren(),i&&n.addUpdateCallback(i),n===a)return a;a.getParents()[0].removeChild(a),a.removeChildren(),n.setStateSet(void 0),a.setStateSet(e);var l=o.computeLocalToWorld(s);if(o.Matrix.isIdentity(l))n.addChild(a);else{var c=new o.MatrixTransform;c.setName("Optim - RootMatrix"),o.Matrix.copy(l,c.getMatrix()),n.addChild(c),c.addChild(a)}return J(r,a),J(t.getWireframePathList(),a),J(t.getNoGeometryPathList(),a),a};h.optimize=function(t,e){o.WebGLCaps.instance().getWebGLExtension("OES_element_index_uint")&&(h.splitLimit=4294967296),o.time("optimizer preparation"),h.hasAnimation=s.getPromise().value();var i=e.getOrCreateScene().getWireframeNodes();i.length=0;var r=[],n=[],a=t.getPathList(),u=t.getWireframePathList();j();var l=$(t);if(Y(t),q(t),W(t,r,n),o.timeEnd("optimizer preparation"),U(a,l,"optimizer model"),X(r,l,n,i),u.length>0){var c=i.slice(0);e.getPromiseWireframe().then(function(){for(var t=i.length=c.length,e=0;t>e;++e)i[e]=c[e];K(l,u,i)})}},t.exports=h},function(t,e,i){"use strict";var r=i(235),n=i(219),a=i(1100),s=i(1438),o=i(1444),u=i(1448),h=i(1449),l=i(1099),c=i(1426),d=a.osg,fif(a),p=1,f=function(){d.NodeVisitor.call(this,d.NodeVisitor.TRAVERSE_PARENTS),this._material=void 0,this._manager=void 0};f.prototype=d.objectInherit(d.NodeVisitor.prototype,{setManager:function(t){this._manager=t},reset:function(){this.nodePath.length=0,this._material=void 0},apply:function(t){if(!this._material){var e=t.getStateSet();e&&(this._material=this._manager.getMaterialByStateSet(e)),this._material||this.traverse(t)}}});var g=r.Model.extend({initialize:function(){this.matNames={material_:0}},getImageCollection:function(){return this.imageCollection||a.osg.error("ImageCollection not initialized in MaterialManager, somewhing wrong"),this.imageCollection},setImageCollection:function(t){this.imageCollection=t},addMaterial:function(t){var e=new s,i=this.getImageCollection();return e.setMaterialJSON(t,i),new o({model:e}),this.set(t.id,e),e},getMaterialStateID:function(t){if(void 0!==t._materialID)return t._materialID;var e=t.getUserData();if(e)for(var i=e.length-1;i>=0;--i)if("UniqueID"===e[i].Name){t._materialID=parseInt(e[i].Value,10);break}return void 0===t._materialID&&(void 0!==t._uniqueID?t._materialID=t._uniqueID:(console.warn("v0 StateSet detected"),t._materialID=p++)),t._materialID},getMaterialByStateSetID:function(t){return void 0!==t?n.find(this.attributes,function(e){return e.get("stateSetID")===t}):void 0},getMaterialByStateSet:function(t){return this.getMaterialByStateSetID(this.getMaterialStateID(t))},removeMaterialByStateSetID:function(t){var e=this;n.filter(this.attributes,function(e){return e.get("stateSetID")===t}).forEach(function(t){delete e.attributes[t.get("id")]})},removeMaterialByStateSet:function(t){var e=this,i=n.find(this.attributes,function(e){return e.get("stateSet")===t});i&&delete e.attributes[i.get("id")]},removeUnboundMaterial:function(){var t=this.attributes;n.each(t,function(e){e.get("stateSet")||delete t[e.get("id")]})},createMaterial:function(t,e){void 0===e&&(e=t.getOrCreateStateSet());var i=new s;new o({model:i});var r=this.findTexCoordChannels(t),n=u();return i.set("id",n),i.set("stateSetID",this.getMaterialStateID(e)),i.set("name",this.getUniqueMaterialName(e.getAttributeMap().Material,e,t)),i.setTexCoordUnitList(r),this.set(n,i),i},findTexCoordChannels:function(){var t=new h;return function(e){return t.reset(),e.accept(t),t.getTexCoordList()}}(),getUniqueMaterialName:function(t,e,i){var r=this.matNames,n=t&&t.getAttribute()?t.getAttribute().getName():void 0;if(void 0===n&&(n=void 0!==e.getName()?e.getName():i.getName()),void 0===n)return"material_"+r.material_++;var a=r[n];return void 0===a?r[n]=0:n+="_"+r[n]++,n},getJSON:function(){var t={},e=this.attributes;return n.each(e,function(e){t[e.get("id")]=e.getJSON()}),t},setWorkFlowMetalSpec:function(t,e){for(var i=this.attributes,r=Object.keys(i),n=0,a=r.length;a>n;++n)i[r[n]].setWorkFlowMetalSpec(t,e)},setWorkFlowRoughGloss:function(t,e){for(var i=this.attributes,r=Object.keys(i),n=0,a=r.length;a>n;++n)i[r[n]].setWorkFlowRoughGloss(t,e)},overrideMaterialChannels:function(t){var e=t.materialNormal,i=t.materialDiffuse,r=t.materialMetalness,a=t.materialRoughness,s=t.materialGlossiness,o=t.materialSpecular,u=t.materialEmissive,h=t.materialTransparency,l=t.materialCavity,c=t.materialAO,d=t.materialF0,p=t.materialNames||"main_material",f=p.split(";"),g=this;n.each(this.attributes,function(t){if(-1!==f.indexOf(t.get("name"))){var n=t.getChannels();i&&(g._replaceChannelURL(n,"DiffuseColor",i),g._replaceChannelURL(n,"AlbedoPBR",i),g._replaceChannelURL(n,"DiffusePBR",i)),void 0!==d&&(d.length?g._replaceChannelURL(n,"SpecularF0",d):(n.SpecularF0.reset(),n.SpecularF0.setFactor(.5))),void 0!==e&&g._replaceChannelURL(n,"NormalMap",e,!0),void 0!==l&&g._replaceChannelURL(n,"CavityPBR",l,!0),void 0!==u&&g._replaceChannelURL(n,"EmitColor",u,!0),void 0!==h&&g._replaceChannelURL(n,"Opacity",h,!0),void 0!==c&&(g._replaceChannelURL(n,"AOPBR",c,!0),g._replaceChannelURL(n,"DiffuseIntensity",c,!0)),(o||r)&&(g._replaceChannelURL(n,"SpecularPBR",o),g._replaceChannelURL(n,"MetalnessPBR",r),t.setWorkFlowMetalSpec(Boolean(r))),(a||s)&&(g._replaceChannelURL(n,"RoughnessPBR",a),g._replaceChannelURL(n,"GlossinessPBR",s),t.setWorkFlowRoughGloss(Boolean(a)))}})},_replaceChannelURL:function(t,e,i,r){var n=t[e];if(!i||!i.length)return void n.setEnable(!1);var a=l.instance,s=this.getImageCollection();a.getOrCreateImage(i).promise.then(function(t){var e=t.getImage(),a=s.addNewImage({url:e.src,width:e.naturalWidth,height:e.naturalHeight,name:i}),o=new c({image:a});n.setTexture(o),r&&n.setEnable(!0),n.setFactor(1)})},findFirstMaterial:function(){var t=new f;return function(e){return e._mostInfluencedRig&&(e=e._mostInfluencedRig),t.reset(),t.setManager(this),e.accept(t),t._material||d.error("could not find a material from the geometry !!"),t._material}}()});t.exports=g},function(t,e,i){"use strict";var r=i(1100),n=i(219),a=i(239),s=i(1439),o=i(1440),u=i(1426),h=i(1413),l=r.osg,fif(r),c=2,d=n.invert(l.CullFace),p=function(){var t={};return[{name:"DiffuseColor",displayName:"Diffuse",color:h()?l.Vec3.createAndSet(1,1,1):l.Vec3.createAndSet(.5,.5,.5),factor:1,enable:!0},{name:"DiffuseIntensity",displayName:"Lightmap",color:l.Vec3.createAndSet(1,1,1),factor:1,enable:!0},{name:"SpecularColor",displayName:"Specular Color",color:l.Vec3.createAndSet(.5,.5,.5),factor:0,enable:!0},{name:"SpecularHardness",displayName:"Specular Glossiness",factor:12.5,enable:!0},{name:"NormalMap",displayName:"Normal map",factor:1,enable:!1,flipY:!1},{name:"BumpMap",displayName:"Bump map",factor:1,enable:!1},{name:"Opacity",displayName:"Transparency",factor:1,type:"alphaBlend",enable:!0},{name:"EmitColor",displayName:"Emission",color:l.Vec3.createAndSet(1,1,1),factor:0,enable:!0,type:"additive"},{name:"DiffusePBR",displayName:"Diffuse (PBR)",color:l.Vec3.createAndSet(1,1,1),factor:1,enable:!1},{name:"AlbedoPBR",displayName:"Albedo",color:l.Vec3.createAndSet(1,1,1),factor:1,enable:!0},{name:"SpecularPBR",displayName:"Specular (PBR)",color:l.Vec3.createAndSet(1,1,1),factor:.05,enable:!1},{name:"GlossinessPBR",displayName:"Glossiness (PBR)",factor:.4,enable:!1},{name:"RoughnessPBR",displayName:"Roughness",factor:.6,enable:!0},{name:"MetalnessPBR",displayName:"Metalness",factor:0,enable:!0},{name:"SpecularF0",displayName:"Specular F0",factor:.5,enable:!0},{name:"AOPBR",displayName:"Ambient Occlusion",factor:1,enable:!1,occludeSpecular:!1},{name:"CavityPBR",displayName:"Cavity",factor:1,enable:!1}].forEach(function(e){var i=e.name,r=s.getModel(i);t[i]=new r(e)},t),t},f=function(){return{version:c,shadeless:!1,id:"0",stateSetID:0,name:"noname",channels:p(),texCoordUnitList:[],cullFace:l.CullFace.DISABLE,reflection:h()?.1:.3}},g=a.extend({defaults:function(){return f()},setMaterial:function(t){this.set(t),n.each(t.channels,function(t,e){this.getChannels()[e].set(t)},this)},setMaterialJSON:function(t,e){var i={},r=Object.keys(t);r.forEach(function(e){"channels"!==e&&void 0!==this.attributes[e]&&void 0!==t[e]&&null!==t[e]&&("cullFace"===e?i.cullFace=l.CullFace[t[e]]:i[e]=t[e])}.bind(this)),this.set(i);var a=Object.keys(t.channels);a.forEach(function(i){var r=t.channels[i];if(r){if(r.texture){r=n.clone(r);var a=e.get(r.texture.uid);if(a){var s=new u(n.extend(r.texture,{image:a}));r.texture=s,r.color=void 0}else l.error("can't find ImageProxy "+r.texture.uid),r.color=l.Vec3.createAndSet(1,1,1),r.texture=void 0}this.getChannels()[i].set(r)}}.bind(this))},getChannels:function(){return this.get("channels")},setStateSet:function(t){return this.set("stateSet",t),this},setTexCoordUnitList:function(t){return this.set("texCoordUnitList",t)},setChannelEnable:function(t,e){var i=this.get("channels");return i[t]?(i[t].setEnable(e),this):this},setChannelColor:function(t,e){var i=this.get("channels");return i[t]?(i[t].setColor(e),this):this},setChannelTexture:function(t,e){var i=this.get("channels");return i[t]?(i[t].setTexture(e),this):this},setChannelFactor:function(t,e){var i=this.get("channels");return i[t]?(i[t].setFactor(e),this):this},cleanMaterialJSON:function(t){n.forEach(t.channels,function(t){o.prototype.cleanChannelJSON(t)})},getJSON:function(){var t={};t.version=c,t.stateSetID=this.get("stateSetID"),t.shadeless=this.get("shadeless"),t.id=this.get("id"),t.name=this.get("name"),t.texCoordUnitList=this.get("texCoordUnitList"),t.cullFace=d[this.get("cullFace")],t.reflection=this.get("reflection");var e={};return n.each(this.get("channels"),function(t,i){e[i]=t.getJSON()}),t.channels=e,t},copyDualChannel:function(t,e){var i=this.getChannels(),r=i[t],n=i[e],a=n.getTexture(),s="MetalnessPBR"===t||"SpecularPBR"===t,o="NormalMap"===t||"BumpMap"===t;a?(a=a.clone(),(s||o)&&(a.setImage(a.getImage()),a.set("internalFormat","NormalMap"===t||"SpecularPBR"===t?l.Texture.RGB:l.Texture.LUMINANCE),a.updateTextureProxy()),r.setTexture(a)):s||r.setColor(n.getColor()),o||r.setFactor(n.getFactor())},getWorkFlowPBRMetalSpec:function(){return this.getChannels().MetalnessPBR.getEnable()},getWorkFlowPBRRoughGloss:function(){return this.getChannels().RougnessPBR.getEnable()},setWorkFlowRoughGloss:function(t,e){var i=t?"GlossinessPBR":"RoughnessPBR",r=t?"RoughnessPBR":"GlossinessPBR",n=this.getChannels();n[i].setEnable(!1),n[r].setEnable(!0),e&&this.copyDualChannel(r,i,n)},setWorkFlowMetalSpec:function(t,e){var i=t?"DiffusePBR":"AlbedoPBR",r=t?"SpecularPBR":"MetalnessPBR",n=t?"AlbedoPBR":"DiffusePBR",a=t?"MetalnessPBR":"SpecularPBR",s=this.getChannels();s[i].setEnable(!1),s[r].setEnable(!1),s.SpecularF0.setEnable(t),s[n].setEnable(!0),s[a].setEnable(!0),e&&(this.copyDualChannel(n,i),this.copyDualChannel(a,r))}});t.exports=g},function(t,e,i){"use strict";var r=i(219),n=i(1440),a=i(1441),s=i(1442),o=i(1443),u={},h=u.view=a.extend({}),l=u.model=n.extend({_checkEffective:function(){if(!this.isActivated()||!this.getEnable())return 0;var t=.01,e=this.getName(),i=this.getTexture(),r=this.getFactor();if(t>r){var n=!1;switch(e){case"DiffusePBR":case"AlbedoPBR":case"SpecularPBR":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":n=!0}return n?2:0}return"AOPBR"!==e&&"CavityPBR"!==e||i?1:0},isEffective:function(){return 1===this._checkEffective()},isEnableEffective:function(){return 0!==this._checkEffective()}}),c={};c.view=h.extend({initialize:function(){h.prototype.initialize.apply(this,arguments),this.model.on("change:occludeSpecular",this.updateChannel,this)}}),c.model=l.extend({defaults:function(){var t=l.prototype.defaults.apply(this,arguments);return r.extend({},t,{occludeSpecular:!1})},initialize:function(t){l.prototype.initialize.apply(this,arguments),this.set("occludeSpecular",t&&void 0!==t.occludeSpecular?t.occludeSpecular:this.defaults().occludeSpecular)},getJSON:function(){var t=l.prototype.getJSON.apply(this);return t.occludeSpecular=this.get("occludeSpecular"),t}});var d={};d.view=a.extend({}),d.model=n.extend({isEffective:function(){if(!this.isActivated()||!this.getEnable())return!1;var t=.01;return this.getFactor()<t?!1:this.getTexture()?!0:!1}});var p={};p.view=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments),this.model.on("change:flipY",this.updateChannel,this)}}),p.model=n.extend({defaults:function(){var t=n.prototype.defaults.apply(this,arguments);return r.extend({},t,{flipY:!1})},initialize:function(t){n.prototype.initialize.apply(this,arguments),this.set("flipY",t&&void 0!==t.flipY?t.flipY:this.defaults().flipY)},getJSON:function(){var t=n.prototype.getJSON.apply(this);return t.flipY=this.get("flipY"),t},isEffective:function(){if(!this.isActivated()||!this.getEnable())return!1;var t=.01;return this.getFactor()<t?!1:this.getTexture()?!0:!1}});var f={};f.view=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments),this.model.on("change:type",this.updateChannel,this)}}),f.model=n.extend({defaults:function(){var t=n.prototype.defaults.apply(this,arguments);return r.extend({},t,{type:"additive"})},initialize:function(t){n.prototype.initialize.apply(this,arguments),this.set("type",t&&void 0!==t.type?t.type:this.defaults().type)},getJSON:function(){var t=n.prototype.getJSON.apply(this);return t.type=this.get("type"),t},isEffective:function(){if(!this.isActivated()||!this.getEnable())return!1;var t=.01,e=this.getFactor();return t>e&&"additive"===this.get("type")?!1:!0}});for(var g={getModel:function(t){return this[t]?this[t].model:n},getView:function(t){return this[t]?this[t].view:a},NormalMap:p,AOPBR:c,BumpMap:d,EmitColor:f,Opacity:{model:s,view:o}},m=["DiffusePBR","AlbedoPBR","SpecularPBR","GlossinessPBR","RoughnessPBR","MetalnessPBR","SpecularF0","CavityPBR"],v=0,_=m.length;_>v;++v)g[m[v]]=u;t.exports=g},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(239),s=i(1419),o=i(1420),u=n.osg,fif(n),h=function(t){return t[0]+t[1]+t[2]<1e-4},l=function(t){return t[0]+t[1]+t[2]>2.9999},c=a.extend({defaults:function(){return{texture:void 0,color:u.Vec3.createAndSet(1,1,1),factor:1,enable:!0}},initialize:function(t){a.prototype.initialize.apply(this,arguments);var e=this.defaults();t&&(e=r.extend(e,t)),e.color&&e.texture&&(e.color=void 0),this.set(e)},getName:function(){return this.get("name")},setFactor:function(t){return this.set("factor",t),this.trigger("setFactor")},getFactor:function(){return this.get("factor")},getTexture:function(){return this.get("texture")},setTexture:function(t){return this.set("color",void 0),this.set("texture",t),this.trigger("setTexture")},setTexCoordUnit:function(t){var e=this.get("texture");void 0!==e&&(e.set("texCoordUnit",t),this.trigger("change:uv"))},setEnable:function(t){return this.set("enable",t)},getEnable:function(){return this.get("enable")},getTexCoordUnit:function(){var t=this.get("texture");if(t)return t.get("texCoordUnit")},getColor:function(){return this.get("color")},setColor:function(t){return this.set("texture",void 0),this.set("color",u.Vec3.copy(t,this.get("color")||u.Vec3.create())),this.trigger("setColor")},removeTexture:function(){this.setColor(u.Vec3.one)},reset:function(){return this.removeTexture(),this.set("factor",1),this.trigger("reset")},getJSON:function(){var t={},e=this.get("texture");void 0!==e&&(t.texture=e.getJSON());var i=this.get("color");return void 0!==i&&(t.color=i),t.factor=this.get("factor"),t.enable=this.get("enable"),t},resetTextureFormat:function(){var t=this.getTexture();t&&(t.set("internalFormat",s.getTextureFormat(this.getName())),t.updateTextureProxy())},isEffective:function(){if(!this.isActivated()||!this.getEnable())return!1;var t=.01,e=this.getName(),i=this.getColor(),r=this.getFactor();return"SpecularHardness"===e?!0:t>r?!1:i&&h(i)?!1:"DiffuseIntensity"===e&&i&&l(i)&&r>1-t?!1:!0},isEnableEffective:function(){return this.isEffective()},isActivated:function(){return!!(s.getShadingMask(this.getName())&o.get("mask"))}});t.exports=c},function(t,e,i){"use strict";var r=i(258),n=i(1362),a=r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments),this.model.on("setFactor",this.updateChannel,this),this.model.on("change:uv",this.changeTexCoord,this),this.model.on("setColor",this.updateChannel,this),this.model.on("setTexture",this.updateChannel,this),this.model.on("reset",this.updateChannel,this),this.model.on("change:enable",this.updateChannel,this),this.model.on("all",n.draw)},getStateSetContext:function(){return this.options.stateSetContext},updateChannel:function(){var t=this.getStateSetContext();if(this.model.getTexture()&&void 0===this.model.getTexCoordUnit()){var e=t._material.get("texCoordUnitList");this.model.setTexCoordUnit(e&&e.length>0?e[0]:0)}t.updateChannel(this.model)},apply:function(){this.updateChannel()},changeTexCoord:function(){this.getStateSetContext().setTexCoord(this.model)}});t.exports=a},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(1440),s=n.osg,fif(n),o=a.extend({defaults:function(){var t=a.prototype.defaults.apply(this,arguments);return r.extend({},t,{type:"alphaBlend",invert:!1})},initialize:function(t){a.prototype.initialize.apply(this,arguments),this.setTransparency(t&&t.type?t.type:this.defaults().type),this.set("invert",t&&void 0!==t.invert?t.invert:this.defaults().invert)},getTransparency:function(){return this.get("type")},setTransparency:function(t){return"alphaMask"!==t&&"alphaBlend"!==t&&"additive"!==t?void s.warn("Invalid transparency type given : "+t):void this.set("type",t)},getJSON:function(){var t=a.prototype.getJSON.apply(this);return t.type=this.get("type"),t.invert=this.get("invert"),t},isEffective:function(){if(!this.isActivated()||!this.getEnable())return!1;var t=this.getTransparency(),e=this.getFactor(),i=this.getTexture();return"alphaBlend"===t&&e>=.99&&void 0===i?!1:!0}});t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(1441),a=r.osg,fif(r),s=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),this.model.on("change:type",this.changeType,this),this.model.on("change:invert",this.updateChannel,this),this._blendFilter=a.Texture.LINEAR_MIPMAP_LINEAR,this._maskFilter=a.Texture.LINEAR;var t=this.model.getTexture();if(t){var e=t.get("minFilter");"alphaMask"===this.model.getTransparency()?this._maskFilter=e:this._blendFilter=e}},updateChannel:function(){var t=this.model.getTexture(),e=t?t.getTextureProxy():void 0;if(e){var i=t.getImage(),r=t.getImage().getName()||e.getImage().getURL(),s=r.toLowerCase(),o=i.get("alpha")===!1||-1!==s.indexOf("jpg")||-1!==s.indexOf("jpeg");o&&(t.set("internalFormat",a.Texture.LUMINANCE),t.updateTextureProxy())}n.prototype.updateChannel.call(this)},changeType:function(){var t=this.model.getTexture();if(t&&t.get("magFilter")!==a.Texture.NEAREST){var e=t.get("minFilter");"alphaMask"===this.model.getTransparency()?(this._blendFilter=e,e=this._maskFilter):(this._maskFilter=e,e=this._blendFilter),t.set("minFilter",e),t.set("magFilter",e===a.Texture.LINEAR_MIPMAP_LINEAR?a.Texture.LINEAR:e),t.updateTextureProxy()}this.updateChannel()}});t.exports=s},function(t,e,i){"use strict";var r=i(219),n=i(258),a=i(1439),s=i(1445),o=i(1362),u=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),this.model.bind("change:stateSet",this.stateSet,this),this.model.bind("change:shadeless",this.shadeless,this),this.model.bind("change:cullFace",this.cullFace,this),this.model.bind("change:reflection",this.reflection,this),this.model.bind("apply",this.apply,this),this.model.bind("change",o.draw),this._context=new s(this.model),this._views={};var t=this.model.get("channels");r.each(t,function(t,e){t.set("name",e);var i=a.getView(e),r=new i({model:t,stateSetContext:this.getStateSetContext()});t.bind("change:enable",this.onEnableChanged,this),this._views[e]=r}.bind(this))},getStateSetContext:function(){return this._context},stateSet:function(){var t=this.model.get("stateSet");return t.setName(this.model.get("name")),this.getStateSetContext().setStateSet(t),this},apply:function(){r.each(this._views,function(t){t.apply()},this),this.shadeless(),this.cullFace(),this.reflection()},shadeless:function(){var t=this.model.get("shadeless");return this.getStateSetContext().setShadeless(t),this},cullFace:function(){var t=this.model.get("cullFace");return this.getStateSetContext().setCullface(t),
this},reflection:function(){var t=this.model.get("reflection");return this.getStateSetContext().setReflection(t),this},onEnableChanged:function(t,e){if(e===!0){var i=t.getName(),r=this.model.getChannels();"BumpMap"===i?r.NormalMap.setEnable(!1):"NormalMap"===i&&r.BumpMap.setEnable(!1),"GlossinessPBR"===i?r.RoughnessPBR.setEnable(!1):"RoughnessPBR"===i&&r.GlossinessPBR.setEnable(!1),"AlbedoPBR"===i||"MetalnessPBR"===i?(r.DiffusePBR.setEnable(!1),r.SpecularPBR.setEnable(!1)):("DiffusePBR"===i||"SpecularPBR"===i)&&(r.AlbedoPBR.setEnable(!1),r.MetalnessPBR.setEnable(!1))}return this}});t.exports=u},function(t,e,i){"use strict";var r=i(1100),n=i(1399),a=i(1446),s=i(1358),o=i(1418),u=i(1414),h=i(1390),l=i(1419),c=i(1447),d=i(1389),p=r.osg,fif(r),f=p.Texture.textureNull,g=new p.CullFace(p.CullFace.BACK),m=new p.CullFace(p.CullFace.DISABLE),v=function(t){this._stateSet=void 0,this._material=t,this._channelTextureMaterialActive={},this._channelTextureMaterialCache={},this._channelTextureMaterialColorCache={},this._channelTextureColorCache={},this._channelCanvasColorCache={},this._channelNameToTextureUnit={},this._maxTextureUnit=u()},_={"0,0,0":null,"255,255,255":null},b={"0,0,0":null,"255,255,255":null};v.prototype={isActive:function(t){return void 0===this._channelTextureMaterialActive[t]?!1:!0},getSketchfabMaterial:function(){return this._stateSet.getAttribute("SketchfabMaterial")},setStateSetAlphaBlending:function(){this._stateSet&&(this._stateSet.setRenderBinDetails(h.TRANSPARENT_BIN,"DepthSortedBin"),d.registerStateSetTransparency(this._stateSet))},setStateSetOpaque:function(){this._stateSet&&(this._stateSet.setRenderBinDetails(h.OPAQUE_BIN,"RenderBin"),d.registerStateSetOpaque(this._stateSet))},setCullface:function(t){this._stateSet&&(this._stateSet.setAttributeAndModes(t?g:m),this.getSketchfabMaterial().setCullFace(t?p.CullFace.BACK:p.CullFace.DISABLE))},setShadeless:function(t){this._stateSet&&this.getSketchfabMaterial().setShadeless(t)},setReflection:function(t){this._stateSet&&this.getSketchfabMaterial().setReflection(t)},getAvailableTextureUnit:function(){var t=this._stateSet,e=t.getNumTextureAttributeLists(),i=0;for(i=0;e>=i;i++){6===i&&i++;var r=t.getTextureAttribute(i,"Texture");if(void 0===r||r===f)break}return i<this._maxTextureUnit?i:-1},getStateSet:function(){return this._stateSet},setStateSet:function(t){this._stateSet=t;var e=t.getAttribute("SketchfabMaterial");void 0===e&&(e=new s,t.setAttributeAndModes(e),e.setName(t.getName()));for(var i=0,r=t.getNumTextureAttributeLists();r>i;i++)t.removeTextureAttribute(i,"Texture")},enableAlphaBlending:function(){this._stateSet&&this.setStateSetAlphaBlending()},disableTransparency:function(){this._stateSet&&this.setStateSetOpaque()},setTexCoord:function(t){if(this._stateSet){var e=t.getTexCoordUnit(),i=t.getName(),r=this._channelTextureMaterialActive[i];r&&r.setTexCoordUnit(e)}},getOrCreateTextureMaterial:function(t,e,i){var r=this._channelTextureMaterialCache[t];r?r.setTexture(e):r=this._channelTextureMaterialCache[t]=new o(e,t);var n="unknown"===i||void 0===i;return r.setSRGB(n?void 0:"srgb"===i),r},getOrCreateTextureMaterialColor:function(t,e){var i=this._channelTextureMaterialColorCache[t],r="Opacity"===t?p.Texture.LUMINANCE:l.getTextureFormat(t),n=l.isSRGB(t);n&&(e=c.linearToSrgb(e));var s,u=[Math.round(255*e[0]),Math.round(255*e[1]),Math.round(255*e[2])].join(","),h=r===p.Texture.LUMINANCE?b:_,d=h[u];return null===d?(s=document.createElement("canvas"),a.setCanvasFromVec3(e,s),d=h[u]=new p.Texture,d.setImage(s)):void 0===d&&(s=this._channelCanvasColorCache[t],s||(s=this._channelCanvasColorCache[t]=document.createElement("canvas")),a.setCanvasFromVec3(e,s),d=this._channelTextureColorCache[t],d||(d=this._channelTextureColorCache[t]=new p.Texture),d.setImage(s)),i?(i.setTexture(d),i.dirty()):i=this._channelTextureMaterialColorCache[t]=new o(d,t),d.setInternalFormat(r),i.setSRGB(n),i},setTextureMaterialToStateSet:function(t,e,i){var r=t.getName(),n=this.getTextureUnitFromChannelName(r),a=t.getTexCoordUnit();void 0===a&&(a=0),e.setTexCoordUnit(a),0>n&&(n=this.getAvailableTextureUnit(),0>n)||("Opacity"===r?(e.setName("alphaMask"===t.getTransparency()?"AlphaMask":"Opacity"),e.setInvert(i?!1:t.get("invert"))):"NormalMap"===r?e.setFlipY(t.get("flipY")):"AOPBR"===r?e.setOccludeSpecular(t.get("occludeSpecular")):"EmitColor"===r&&e.setEmitType(t.get("type")),this.setTextureToUnit(e,n,r),this._channelTextureMaterialActive[r]=e,e.setFactor(t.getFactor()))},setTextureToUnit:function(t,e,i){"Opacity"===i?this._stateSet.setTextureAttributeAndModes(e,t,p.StateAttribute.PROTECTED):this._stateSet.setTextureAttributeAndModes(e,t),this._channelNameToTextureUnit[i]=e},setTexture:function(t){if(this._stateSet){var e=t.getTexture(),i=e.getImage(),r=e.getTextureProxy();if(i&&r){var a=i.get("colorSpace"),s=t.getName();this.setTextureMaterialToStateSet(t,this.getOrCreateTextureMaterial(s,r,a));var o=n.getPromiseLowRes(),u=r.setImageMaxSupported.bind(r);return o.isFulfilled()?u():void r.setImageSmallest().promise.then(function(){n.getPromiseLowRes().then(u)})}}},setColor:function(t,e){if(this._stateSet){var i=this.getOrCreateTextureMaterialColor(t.getName(),e||t.getColor());this.setTextureMaterialToStateSet(t,i,!0)}},getTextureUnitFromChannelName:function(t){var e=this._channelNameToTextureUnit[t];if(void 0===e||0>e)return-1;var i=this._stateSet.getTextureAttribute(e,"Texture");if(i&&i!==f){var r=i.getName();if(r===t||"Opacity"===t&&"AlphaMask"===r)return e}return-1},disableChannel:function(t){if(this._stateSet){var e=t.getName(),i=this.getTextureUnitFromChannelName(e);0>i&&(i=this.getAvailableTextureUnit()),0>i||this.setTextureToUnit(f,i,e)}},setChannelEnable:function(){var t=p.Vec3.create();return function(e,i){return i===!1?this.disableChannel(e):e.isEffective()?e.getTexture()?this.setTexture(e):e.getColor()?this.setColor(e):void 0:this.setColor(e,t)}}(),setChannelOpacity:function(t,e){if(this._stateSet){var i=this.getSketchfabMaterial(),r="additive"===t.getTransparency(),n="alphaMask"===t.getTransparency();i.setAdditive(r),i.setOpaqueEarlyZ(!e||n||!r&&!!t.getTexture())}if(e===!1)return this.disableTransparency();var a=t.getTransparency();return"alphaMask"===a?this.disableTransparency():"alphaBlend"===a||"additive"===a?this.enableAlphaBlending():void p.warn("Unknow alpha type : "+a)},updateChannel:function(t){var e=t.isEnableEffective();this.setChannelEnable(t,e),"Opacity"===t.getName()&&this.setChannelOpacity(t,e),this.checkInterChannelOptimizations(t)},checkInterChannelOptimizations:function(t){var e=this._material.getChannels(),i=t.getName();if("DiffuseIntensity"===i||"DiffuseColor"===i){var r=e.DiffuseIntensity,n=e.DiffuseColor;if(n.isEffective()===!1)return void this.setChannelEnable(r,!1);this.setChannelEnable(n,r.getEnable()===!1||r.getFactor()>.01),this.setChannelEnable(r,r.isEffective())}}},t.exports=v},function(t,e){"use strict";var i=function(t){var e=Math.round(100*t[0]),i=Math.round(100*t[1]),r=Math.round(100*t[2]),n="rgb("+e+"%, "+i+"%, "+r+"% )",a=document.createElement("canvas");a.width=a.height=1;var s=a.getContext("2d");s.fillStyle=n,s.fillRect(0,0,1,1);var o=new Image;return o.src=a.toDataURL(),o},r=function(t,e){var i=Math.round(255*t[0]),r=Math.round(255*t[1]),n=Math.round(255*t[2]);e.width=e.height=1;var a=e.getContext("2d"),s=a.createImageData(1,1);s.data[0]=i,s.data[1]=r,s.data[2]=n,s.data[3]=255,a.putImageData(s,0,0)},n=function(t){return 1===t.width&&1===t.height?!0:!1},a=function(t){var e=document.createElement("canvas");e.width=e.height=1;var i=e.getContext("2d");i.drawImage(t,0,0);var r=i.getImageData(0,0,1,1);return[r.data[0]/255,r.data[1]/255,r.data[2]/255]};t.exports={createImageFromVec3:i,isImageColor:n,getColorFromImage:a,setCanvasFromVec3:r}},function(t,e){"use strict";var i={},r=2.4;i.linearToSrgb1=function(t){var e=0;return.0031308>t?t>0&&(e=12.92*t):e=1.055*Math.pow(t,1/r)-.055,e},i.srgbToLinear1=function(t){var e=0;return.04045>t?t>=0&&(e=t*(1/12.92)):e=Math.pow((t+.055)*(1/1.055),r),e},i.linearToSrgb=function(t,e){var r=e||new Array(t.length);return r[0]=i.linearToSrgb1(t[0]),r[1]=i.linearToSrgb1(t[1]),r[2]=i.linearToSrgb1(t[2]),r.length>3&&t.length>3&&(r[3]=t[3]),r},i.srgbToLinear=function(t,e){var r=e||new Array(t.length);return r[0]=i.srgbToLinear1(t[0]),r[1]=i.srgbToLinear1(t[1]),r[2]=i.srgbToLinear1(t[2]),r.length>3&&t.length>3&&(r[3]=t[3]),r},i.encodeRGBM=function(t,e,i){i[3]=Math.min(1,Math.max(t[0]/e,i[1]/e,i[2]/e,1e-6)),i[3]=Math.ceil(255*i[3])/255;var r=1/(e*i[3]);return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i},i.decodeRGBM=function(t,e,i){var r=e*t[3];return i[0]=r*i[0],i[1]=r*i[1],i[2]=r*i[2],i},i.rgbToHex=function(t){var e={r:255*t.r,g:255*t.g,b:255*t.b},i="#"+(16777216|e.b|e.g<<8|e.r<<16).toString(16).substr(1);return i},t.exports=i},function(t,e){"use strict";t.exports=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)})}},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=n.osg,fif(n),s=function(){a.NodeVisitor.call(this,a.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._texCoordList=[]};s.prototype=a.objectInherit(a.NodeVisitor.prototype,{getTexCoordList:function(){return this._texCoordList},reset:function(){this._texCoordList=[]},apply:function(t){if(void 0!==t.getVertexAttributeList){var e=t.getVertexAttributeList(),i=r.chain(e).keys().filter(function(t){return-1!==t.indexOf("TexCoord")}).map(function(t){var e="TexCoord",i=t.substring(e.length),r=parseInt(i,10);return r}).value();this._texCoordList=r.union(i,this._texCoordList)}this.traverse(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1097),n=i(1451),a=i(1452),s={FeatureName:"shadingStyle",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNode=function(){return this._views[0]._nodeBlending},t.exports=o},function(t,e,i){"use strict";var r=i(239),n=i(1413),a=i(1341),s=r.extend({defaults:function(){return{renderer:"classic",style:"lit",hasWireframe:!0,wireframeEnable:!1,wireframeColor:"000000FF",hasVertexColor:!1,vertexColorEnable:!0,vertexColorColorSpace:n()?"srgb":"linear",blendingEasingDuration:1,blendingPauseDuration:2.5,webVR:!1}},getName:function(){return"ShadingStyle"},init:function(t){this.set("hasWireframe",!!t.getScene().getWireframeSize());var e=t.getModel().get("options"),i=e.shading;i&&i.type&&(this.set("style",i.type),this.set("renderer",i.renderer));var r=e.wireframe;r&&(void 0!==r.enable&&this.set("wireframeEnable",r.enable),r.color&&r.enable&&this.set("wireframeColor",r.color)),i&&i.vertexColor&&(this.set("vertexColorEnable",i.vertexColor.enable),this.set("vertexColorColorSpace",i.vertexColor.colorSpace));var s=a().blending;void 0!==s&&(this.set("style","blending"),this.set("blendingPauseDuration",Math.abs(s))),n()&&t.getViewer().getPromiseMaterialLoaded().then(function(){var e=t.getFeatures().material.getModel();this.set("renderer","pbr",{copyChannel:!0,overrideTexture:!1}),e._style&&this.set("style",e._style)}.bind(this))},setWireframeColorSmooth:function(t){this.trigger("setWireframeColorSmooth",t)},getJSON:function(){return{shading:{type:this.get("style"),renderer:this.get("renderer"),vertexColor:{enable:this.get("vertexColorEnable"),colorSpace:this.get("vertexColorColorSpace")}},wireframe:{enable:this.get("wireframeEnable"),color:this.get("wireframeColor")}}}});t.exports=s},function(t,e,i){"use strict";var r=i(219),n=i(236),a=i(1100),s=i(258),o=i(1453),u=i(1457),h=i(1459),l=i(1388),c=i(1375),d=i(1460),p=i(1462),f=i(1463),g=i(1467),m=i(1469),v=i(1471),_=i(1473),b=i(1420),x=i(1362),A=i(1389),y=i(1358),S=a.osg,fif(a),C=s.extend({initialize:function(t){s.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:webVR",this.onWebVRChanged,this),e.bind("change:renderer",this.onRendererChanged,this),e.bind("change:style",this.onShadingChanged,this),e.bind("change:wireframeEnable",this.onWireframeEnableChanged,this),e.bind("change:wireframeColor",this.onWireframeColorChanged,this),e.bind("change:vertexColorEnable",this.onVertexColorEnableChanged,this),e.bind("change:vertexColorColorSpace",this.onVertexColorColorSpaceChanged,this),e.bind("change:blendingPauseDuration",this.onBlendingPauseDurationChanged,this),e.bind("change:blendingTransitionDuration",this.onBlendingTransitionDurationChanged,this),e.bind("setWireframeColorSmooth",this.onSetWireframeColorSmooth,this),this._viewer=t.context.getViewer();var i=this._viewer,r=i.getViewerOSGJS(),a=this._generatorProxy=r.getState().getShaderGeneratorProxy();a.addShaderGenerator("classic-lit",new c),a.addShaderGenerator("classic-shadeless",new d),a.addShaderGenerator("classic-blending",new p),a.addShaderGenerator("pbr-lit",new f),a.addShaderGenerator("pbr-shadeless",new g),a.addShaderGenerator("pbr-blending",new m),a.addShaderGenerator("classic-matcap",new v),a.addShaderGenerator("pbr-matcap",new v),a.addShaderGenerator("wireframe",new _),this._rootStateSet=r.getSceneData().getOrCreateStateSet(),this._scene=r.getSceneData(),this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),this.updateShadingGlobal(),this._nodeBlending=new o(e.get("blendingDuration")),this._nodeBlending.setName("ShadingStyle - Node Blending"),this.initBlendingPreset(t.context,"classic"),this.initBlendingPreset(t.context,"pbr"),this.initNodeBlending();var h=t.context.getScene();this._hasWireframe=!!h.getWireframeSize(),this._wireframeNodes=h.getWireframeNodes(),this._stateSetWireframe=new u(this.getRGBA()),i.getPromisePolygon().then(function(){this.model.set("hasVertexColor",y.hasVertexColor),y.hasVertexColor===!1&&this.model.set("vertexColorEnable",!1),this.onVertexColorEnableChanged(),this.onVertexColorColorSpaceChanged()}.bind(this)),n.all([i.getPromiseMaterialLoaded(),i.getPromiseWireframe()]).then(this.initWireframe.bind(this))},onWebVRChanged:function(){this._stateSetWireframe.setRenderBinVR(this.model.get("webVR"))},initBlending:function(t,e){var i=this._generatorProxy.getShaderGenerator(e+"-blending");i.setGraphicContext(t.getViewer().getViewerOSGJS().getGraphicContext()),i.addShader(h.DEFAULT),i.addShader(h.MATCAP|h.WIREFRAME),i.addShader(h.MATCAP|h.GEOMETRY|h.WIREFRAME),i.addShader(h.DEFAULT&~h.DIFFUSE),i.addShader(h.DEFAULT)},initNodeBlending:function(){var t=this,e=function(e){if("matcap"!==t.model.get("style")){var i=t._generatorProxy.getShaderGenerator(t.model.get("renderer")+"-blending");e===!0?i.onSameShader():(i.toNextShader(),t.onBlendingShader())}};this._nodeBlending.setFinishCallback(e);var i=this.model.get("style");this._nodeBlending.setEnable("blending"===i),"matcap"===i&&this._nodeBlending.setMatcapEnable(!0)},initBlendingPreset:function(t,e){var i=this._generatorProxy.getShaderGenerator(e+"-blending");i.setGraphicContext(t.getViewer().getViewerOSGJS().getGraphicContext()),i.addShader(h.DEFAULT),i.addShader(h.MATCAP|h.WIREFRAME),i.addShader(h.MATCAP|h.GEOMETRY|h.WIREFRAME),i.addShader(h.DEFAULT&~h.DIFFUSE),i.addShader(h.DEFAULT)},initWireframe:function(){for(var t=this._wireframeNodes,e=this._stateSetWireframe,i=this.model.get("wireframeEnable")===!0?l.NO_PICK_NO_SHADOW:0,r=0,n=t.length;n>r;++r){var a=t[r];a.setNodeMask(i),a.setStateSet(e)}e.getUpdateCallbackList()[0].setFinishCallback(this.setWireframeNodesMask.bind(this,0)),this.onWireframeColorChanged(),this.model.get("wireframeEnable")===!0&&this.onWireframeEnableChanged()},onBlendingPauseDurationChanged:function(){this._nodeBlending.setPauseDuration(this.model.get("blendingPauseDuration"))},onBlendingTransitionDurationChanged:function(){this._nodeBlending.setTransitionDuration(this.model.get("blendingTransitionDuration"))},onBlendingShader:function(){var t=this._generatorProxy.getShaderGenerator(this.getCompilerName()).getNextShader(),e=0!==(t&h.WIREFRAME);this.model.set("wireframeEnable",e),e&&this.model.set("wireframeColor","ffffff66"),this.model.trigger("nextBlendingShader",t)},getCompilerName:function(){return this.model.get("renderer")+"-"+this.model.get("style")},updateShadingGlobal:function(){var t,e=this.model.get("style"),i=this.model.get("renderer"),r="lit"===e||"blending"===e;t="matcap"===e?b.MATCAP:"pbr"===i&&r?b.PBR_LIT:"pbr"===i&&"shadeless"===e?b.PBR_SHADELESS:"classic"===i&&r?b.CLASSIC_LIT:b.CLASSIC_SHADELESS,b.set("mask",t)},copyChannels:function(t,e,i){var n={DiffusePBR:"DiffuseColor",AlbedoPBR:"DiffuseColor",AOPBR:"DiffuseIntensity"};r.each(n,function(r,n){var a=e.getChannels(),s=a[n],o=a[r];"pbr"===t?o.getTexture()?(!s.getTexture()||i)&&s.setTexture(o.getTexture().clone()):s.getTexture()||s.setColor(o.getColor()):(e.getWorkFlowPBRMetalSpec()&&"DiffusePBR"!==n||!e.getWorkFlowPBRMetalSpec()&&"AlbedoPBR"!==n)&&(s.getTexture()?(!s.getTexture()||i)&&o.setTexture(s.getTexture().clone()):o.getTexture()||o.setColor(s.getColor()))})},onRendererChanged:function(t,e,i){this.onShadingChanged();var n=this.model.get("renderer"),a=void 0!==i.copyChannel?i.copyChannel:!0,s=void 0!==i.overrideTexture?i.overrideTexture:!0,o=this._viewer.getFeatures().material;if(!o)return void S.error("The renderer has been changed before the material feature is initialized");var u=o.getModel().attributes,h=this;a&&r.each(u,function(t){h.copyChannels(n,t,s)}),x.draw()},onShadingChanged:function(){this.updateShadingGlobal();var t=this.model.get("style");this.model.set("hasWireframe",this._hasWireframe&&"blending"!==t),this._nodeBlending.setEnable("blending"===t),this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),"matcap"===t&&this._nodeBlending.setMatcapEnable(!0),"blending"!==t&&(this._wireEnable=void 0),"blending"===t?(this._wireEnable=this.model.get("wireframeEnable"),this._wireColor=this.model.get("wireframeColor"),this.onBlendingShader()):void 0!==this._wireEnable&&(this.model.set("wireframeEnable",this._wireEnable),this._wireEnable&&this.model.set("wireframeColor",this._wireColor)),x.draw()},onWireframeColorChanged:function(){this._stateSetWireframe.setWireframeColor(this.getRGBA())},onSetWireframeColorSmooth:function(t){this.model.off("change:wireframeColor",this.onWireframeColorChanged,this),this.model.set("wireframeColor",t),this.model.bind("change:wireframeColor",this.onWireframeColorChanged,this),this._stateSetWireframe.setWireframeColorSmooth(this.getRGBA(t));var e=this.model;e.off("change:wireframeColor",this.onWireframeColorChanged,this),e.set("wireframeColor",t),e.on("change:wireframeColor",this.onWireframeColorChanged,this)},setWireframeNodesMask:function(t){for(var e=this._wireframeNodes,i=0,r=e.length;r>i;++i)e[i].setNodeMask(t);A.setWireframe(0!==t)},onWireframeEnableChanged:function(){this.setWireframeNodesMask(l.NO_PICK_NO_SHADOW),this._stateSetWireframe.setWireframeEnable(this.model.get("wireframeEnable"),this.getRGBA())},getRGBA:function(){var t=S.Vec4.create();return function(e){var i=e||this.model.get("wireframeColor");return t[0]=parseInt(i.substr(0,2),16)/255,t[1]=parseInt(i.substr(2,2),16)/255,t[2]=parseInt(i.substr(4,2),16)/255,t[3]=parseInt(i.substr(6,2),16)/255,t}}(),onVertexColorEnableChanged:function(){y.VertexColorEnable=this.model.get("vertexColorEnable"),x.draw()},onVertexColorColorSpaceChanged:function(){y.VertexColorColorSpace=this.model.get("vertexColorColorSpace"),x.draw()}});t.exports=C},function(t,e,i){"use strict";var r=i(1100),n=i(1099),a=i(1454),s=i(1455),o=i(1362),u=r.osg,fif(r),h=function(t,e,i){a.call(this,i),this._pauseDuration=void 0===e?2.5:e,this._blendUniform=t,this._finishCallback=void 0,this._finished=!0,this._inPause=!1};h.prototype=u.objectInherit(a.prototype,{smoothStep:function(t){return t*t*(3-2*t)},setPauseDuration:function(t){this._pauseDuration=t},setFinishCallback:function(t){this._finishCallback=t},changeBlend:function(){this._inPause=!1,this.reset(),this._finishCallback()},update:function(t,e){if(this._finished===!0)return!0;o.draw();var i=e.getFrameStamp().getSimulationTime();if(this._inPause===!0){if(i<this._startTime+this._pauseDuration+this._duration)return!0;this.changeBlend()}var r=this.interpolate(i,t,e);return this._finished===!0&&(this._finished=!1,this._inPause=!0,this._finishCallback(!0)),r=this.smoothStep(r),this._blendUniform.getInternalArray()[0]=r,!0}});var l=function(t,e){u.Node.call(this),this._blendUniform=u.Uniform.createFloat1(0,"uBlend"),this._callbackUpdate=new h(this._blendUniform,t,e),this._textureMatcap=void 0;var i=u.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS");this._matcapUnit=i>11?11:7,this.init()};l.prototype=u.objectInherit(u.Node.prototype,{setPauseDuration:function(t){this._callbackUpdate.setPauseDuration(t)},setTransitionDuration:function(t){this._callbackUpdate.setDuration(t)},setEnable:function(t){this.setMatcapEnable(t),this._callbackUpdate._finished=!t},setMatcapEnable:function(t){var e=this.getOrCreateStateSet();t===!0?e.setTextureAttributeAndModes(this._matcapUnit,this._textureMatcap,u.StateAttribute.OVERRIDE|u.StateAttribute.ON):e.removeTextureAttribute(this._matcapUnit,"Texture")},setFinishCallback:function(t){this._callbackUpdate.setFinishCallback(t)},init:function(){var t=s(),e=this._resourceManager||n.instance,i=e.getOrCreateTexture(t);this._textureMatcap=i.texture,i.texture.setName("matcap"),this.getOrCreateStateSet().addUniform(this._blendUniform),this.addUpdateCallback(this._callbackUpdate)}}),t.exports=l},function(t,e,i){"use strict";var r=i(1362),n=function(t){this._duration=void 0===t?1:t,this.reset()};n.prototype={getDuration:function(){return this._duration},setDuration:function(t){this._duration=t},reset:function(){this._startTime=-1,this._finished=!1,this._ratio=0,r.draw()},finished:function(){},interpolate:function(t,e,i){if(this._finished)return 1;this._startTime<0&&(this._startTime=t);var r=Math.min(this._duration,t-this._startTime),n=0===this._duration?1:r/this._duration;return this._ratio=n,(n>=1||0===this._duration)&&(this._finished=!0,this.finished(e,i)),n},update:function(t,e){return this.interpolate(e.getFrameStamp().getSimulationTime(),t,e),!0}},t.exports=n},function(t,e,i){"use strict";t.exports=function(){return i(1456)}},function(t,e){t.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QtoRXhpZgAATU0AKgAAAAgABwESAAMAAAABAAEAAAEaAAUAAAABAAAAYgEbAAUAAAABAAAAagEoAAMAAAABAAIAAAExAAIAAAAeAAAAcgEyAAIAAAAUAAAAkIdpAAQAAAABAAAApAAAANAACvyAAAAnEAAK/IAAACcQQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykAMjAxNDowNToyMiAxNDozMDozNwAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAIAKADAAQAAAABAAAIAAAAAAAAAAAGAQMAAwAAAAEABgAAARoABQAAAAEAAAEeARsABQAAAAEAAAEmASgAAwAAAAEAAgAAAgEABAAAAAEAAAEuAgIABAAAAAEAAAoxAAAAAAAAAEgAAAABAAAASAAAAAH/2P/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicgIiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAHgAeAMBIQACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APOqK7zjCnRxySyLHEjPIxwqqMkn0AoGdXp3gO8mQS6ncx2EZGQhG+Q9P4QcDv1ORjpXRW+jeFNMIItHu5FYkPdSbvwKjCn8qQGjBrVlaDbZadawL6QwKv8AIVcXxXcdMHHpigY59WsL0bb7TbS4U9poFf8AmKqXHhbwhq+SbOSykYgmS0l2/gFOVA+gpW7Acvq3wu1O2jafSLmPU4QMlFHlyjqT8pJBxgdDkk9K4eWKWCV4po3jlQ7WR1Ksp9CD0NNMGhlFMQUUCCjFAzS0fRbnWLkxw4SJOZZm+6g/qfQf/XNdlbPpvhyDyrBA9yVw9y4+dvp6D2HoM5PNSOxUkv7m8fLOQDUsUJPJyTRcqxfit/arkdrntSuFi5HY7u1WRpxHIBFFwsTRSXVmwKsSBSatpmkeLbYxajEIrwLtjvIwBImOgP8AeX2PqcYPNAHk3iPwzfeGr4QXSh4XyYLhPuSj29CO47fQgnFxVJktBRTELitDSdKl1W78pDsjUbpZSOEX/H0FSUkdLealDY2y6fp67IU/Nj3JPc1nwq0jbmJJNK5SRrW8PStSCHpxU3HY0IYPatO3tsnpRcdjatbHOOK0l00bfu0XCxXuNOG37tc9e2jRNuXIIp3JsVzPa6pZSaXqkYkgk/NT2ZT2IryrxF4fuPD2pNbSnzIXG6CcDiRfX2I7jt9MEtCaMfFFUTYkRGkdURSzMQFA6k11U7x6Fpi2cW3z3+aZwfvN/gOg/wDrmobLSMiAGR9zck1tWsXSpuWkbNtF04rUgi9qVx2NGCLpxWvaQ8jilcdjo7KEccVrLEoXpUSY0ivcwLtPFcxqkIw3FXF3RLRxOoqYnLLwRUdzBB4n0V7CYKLqMFraRjjY/pn0PQ9fXqBVpkNHlskTwyvFIpSRGKspHII4INFVck2PD8Ki4lvZMbbZcqD/AHz0/Ln8cVSu7pry9ZicgGobLSL9onSt60TpUtmiRtW0fStWCPjpU3KSNCGOtW1GCKVx2N6zYDFaYYEdal6iaILmQBDzXMapIMNVR2E0cRqjAlqwLe7a0vlYHAJrRMhozvG1ki6hDqUIAjvUy4HaRcA9u4IPud1FURYpSv8AYfDcSchpiZGGfXgfoBWLacnJ71DZokb9mOlb9ovAqGzRI27Zela0CVLZaRoRJV2LilcdjRhm21bF3gdaLhYqXN58p5rnNRucg81SZLRyeoSZzzXM3jYORVJmbRfvD/aXg6dPmZ7dlnUA46cHP/AS1FWmQ0cz4kfyo4IAeERV/IVnWZ6Vm2aJHQ2Xaugs+1Q2aJG5a9q2IBwKhs0SNCJatKKVx2Hb9tRvcEDrTuFihc3RweaxLycnPNNMho568k61gXbda0TIaL2gN9otrq1Y/LLE8Z/EEUVaZm0cx4qb/TPxqjZt0rNs0SOhsm6V0Nm3Ss2zVI3bVulbFu3SobNEjThYYFWgwxSuOxDI+KpTSUXCxm3EvB5rHupetUmQ0Yl2/WsK7frWiZm0XvCr/wCm/jRVozaOe8T/ADrDMOjIrfmKzLOTpWbZpFHQWcnSt+zl6c1m2bJG7ay9K2LebpUNmiRpRTDHWrAn461Nx2IpJuOtUppvencGjLuJvesi6m681SZDRiXUvWsO7l681omZSRpeHH8qK4uD0SNn/IUVomZNGbqcZudEjfktHlCcenT9CK5q1kwcHsazkzWKN2zm6c1vWk/TmsmzaKNu1uOnNa8Fz05qGzRIvx3PHWpxdcdam5diN7n3qnNc9eaaYrGbcXHB5rJubjrzVJmbRi3U/XmsS5mycDvWqZlJHQWoNp4dlbkNKRGDj15P6A0VomZNFa0xIsts2MSrx9R0/r+lclewtZ3rKRgE1nJmsUW7WfpzW3a3PTmsmzaKNm2uunNakN305rNs1SL0d571L9s461Ny7DXvPeqkt3x1oTE0Z89115rKubnrzVpmbRj3Nz15qpZxteXqqOQDWsWYyR0eqOFMVqmNsK8/7x6/0/WitUYtFJMqwIOCDkGo9bsVv7X7VEBvHDgdjWcmaxOVikaJ9jcEVq29z05rFs3ijVgu+nNaUN5x1rNs1SLiXvvUovfepuXYa1771WkvPemmJooTXfHWs24uuvNWmZyRmSzGR9q8k10uj2y6dZm6kA8w8RqR1NaxMJIjclmLMSWJySe5orZMxaAVYgkMTHjcrcMvqKzkaxMfW9EBH2m25Q88fyrn0laNtrcEVizeJehusd6vxXnvWTNootJe+9SfbfeouaWGte+9QSXnvTTJaKct371RedpG2rkk1pEykje0bR8D7Vc8IPXv9K07iYzMDjaq8KvoK2iYSKxorVGLHCniokaQJ4pCmRgMp+8p6Gs/UdBhvVMttw3Up3FYtm8Vc5i4sbmzchkOBUa3BU4ORU2UiruG5Mt371J9r96zcGaKohpu/eoWuieBkmmoMTqIlgtLm7cBEODXS6foUVmolueW6hO5q15E67s0JpDIQMbVH3VHQVXNaxMZDDRWqMGAqRaiRcCQVIvByDg1jI6IkjiOdds8Sv79DWfceHrK4yY22k9mFYt2N0k1ZmdJ4SfP7twR7Gov+ESuvQ0e1YvYRZLH4SfP7xwB7mtG38PWVvgyNuI7KKOdsapxjsaCCOBdsEapx16mo2yTknJPrVxIkRmozW0TCRGaK2Rzvc//2QD/7RaUUGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAA8cAVoAAxslRxwCAAACAAAAOEJJTQQlAAAAAAAQzc/6fajHvgkFcHaurwXDTjhCSU0EOgAAAAAA5QAAABAAAAABAAAAAAALcHJpbnRPdXRwdXQAAAAFAAAAAFBzdFNib29sAQAAAABJbnRlZW51bQAAAABJbnRlAAAAAENscm0AAAAPcHJpbnRTaXh0ZWVuQml0Ym9vbAAAAAALcHJpbnRlck5hbWVURVhUAAAAAQAAAAAAD3ByaW50UHJvb2ZTZXR1cE9iamMAAAAMAFAAcgBvAG8AZgAgAFMAZQB0AHUAcAAAAAAACnByb29mU2V0dXAAAAABAAAAAEJsdG5lbnVtAAAADGJ1aWx0aW5Qcm9vZgAAAAlwcm9vZkNNWUsAOEJJTQQ7AAAAAAItAAAAEAAAAAEAAAAAABJwcmludE91dHB1dE9wdGlvbnMAAAAXAAAAAENwdG5ib29sAAAAAABDbGJyYm9vbAAAAAAAUmdzTWJvb2wAAAAAAENybkNib29sAAAAAABDbnRDYm9vbAAAAAAATGJsc2Jvb2wAAAAAAE5ndHZib29sAAAAAABFbWxEYm9vbAAAAAAASW50cmJvb2wAAAAAAEJja2dPYmpjAAAAAQAAAAAAAFJHQkMAAAADAAAAAFJkICBkb3ViQG/gAAAAAAAAAAAAR3JuIGRvdWJAb+AAAAAAAAAAAABCbCAgZG91YkBv4AAAAAAAAAAAAEJyZFRVbnRGI1JsdAAAAAAAAAAAAAAAAEJsZCBVbnRGI1JsdAAAAAAAAAAAAAAAAFJzbHRVbnRGI1B4bEBSAAAAAAAAAAAACnZlY3RvckRhdGFib29sAQAAAABQZ1BzZW51bQAAAABQZ1BzAAAAAFBnUEMAAAAATGVmdFVudEYjUmx0AAAAAAAAAAAAAAAAVG9wIFVudEYjUmx0AAAAAAAAAAAAAAAAU2NsIFVudEYjUHJjQFkAAAAAAAAAAAAQY3JvcFdoZW5QcmludGluZ2Jvb2wAAAAADmNyb3BSZWN0Qm90dG9tbG9uZwAAAAAAAAAMY3JvcFJlY3RMZWZ0bG9uZwAAAAAAAAANY3JvcFJlY3RSaWdodGxvbmcAAAAAAAAAC2Nyb3BSZWN0VG9wbG9uZwAAAAAAOEJJTQPtAAAAAAAQAEgAAAABAAIASAAAAAEAAjhCSU0EJgAAAAAADgAAAAAAAAAAAAA/gAAAOEJJTQPyAAAAAAAKAAD///////8AADhCSU0EDQAAAAAABAAAAHg4QklNBBkAAAAAAAQAAAAeOEJJTQPzAAAAAAAJAAAAAAAAAAABADhCSU0nEAAAAAAACgABAAAAAAAAAAI4QklNA/UAAAAAAEgAL2ZmAAEAbGZmAAYAAAAAAAEAL2ZmAAEAoZmaAAYAAAAAAAEAMgAAAAEAWgAAAAYAAAAAAAEANQAAAAEALQAAAAYAAAAAAAE4QklNA/gAAAAAAHAAAP////////////////////////////8D6AAAAAD/////////////////////////////A+gAAAAA/////////////////////////////wPoAAAAAP////////////////////////////8D6AAAOEJJTQQAAAAAAAACAAE4QklNBAIAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAA4QklNBDAAAAAAAAkBAQEBAQEBAQEAOEJJTQQtAAAAAAAGAAEAAAAUOEJJTQQIAAAAAAAaAAAAAQAAAkAAAAJAAAAAAgAAgAAAAACAAAE4QklNBB4AAAAAAAQAAAAAOEJJTQQaAAAAAANDAAAABgAAAAAAAAAAAAAIAAAACAAAAAAHAG0AYQB0AGMAYQBwADEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAABudWxsAAAAAgAAAAZib3VuZHNPYmpjAAAAAQAAAAAAAFJjdDEAAAAEAAAAAFRvcCBsb25nAAAAAAAAAABMZWZ0bG9uZwAAAAAAAAAAQnRvbWxvbmcAAAgAAAAAAFJnaHRsb25nAAAIAAAAAAZzbGljZXNWbExzAAAAAU9iamMAAAABAAAAAAAFc2xpY2UAAAASAAAAB3NsaWNlSURsb25nAAAAAAAAAAdncm91cElEbG9uZwAAAAAAAAAGb3JpZ2luZW51bQAAAAxFU2xpY2VPcmlnaW4AAAANYXV0b0dlbmVyYXRlZAAAAABUeXBlZW51bQAAAApFU2xpY2VUeXBlAAAAAEltZyAAAAAGYm91bmRzT2JqYwAAAAEAAAAAAABSY3QxAAAABAAAAABUb3AgbG9uZwAAAAAAAAAATGVmdGxvbmcAAAAAAAAAAEJ0b21sb25nAAAIAAAAAABSZ2h0bG9uZwAACAAAAAADdXJsVEVYVAAAAAEAAAAAAABudWxsVEVYVAAAAAEAAAAAAABNc2dlVEVYVAAAAAEAAAAAAAZhbHRUYWdURVhUAAAAAQAAAAAADmNlbGxUZXh0SXNIVE1MYm9vbAEAAAAIY2VsbFRleHRURVhUAAAAAQAAAAAACWhvcnpBbGlnbmVudW0AAAAPRVNsaWNlSG9yekFsaWduAAAAB2RlZmF1bHQAAAAJdmVydEFsaWduZW51bQAAAA9FU2xpY2VWZXJ0QWxpZ24AAAAHZGVmYXVsdAAAAAtiZ0NvbG9yVHlwZWVudW0AAAARRVNsaWNlQkdDb2xvclR5cGUAAAAATm9uZQAAAAl0b3BPdXRzZXRsb25nAAAAAAAAAApsZWZ0T3V0c2V0bG9uZwAAAAAAAAAMYm90dG9tT3V0c2V0bG9uZwAAAAAAAAALcmlnaHRPdXRzZXRsb25nAAAAAAA4QklNBCgAAAAAAAwAAAACP/AAAAAAAAA4QklNBBQAAAAAAAQAAAAUOEJJTQQMAAAAAAwIAAAAAQAAAKAAAACgAAAB4AABLAAAAAvsABgAAf/Y/+0ADEFkb2JlX0NNAAH/7gAOQWRvYmUAZIAAAAAB/9sAhAAMCAgICQgMCQkMEQsKCxEVDwwMDxUYExMVExMYEQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAQ0LCw0ODRAODhAUDg4OFBQODg4OFBEMDAwMDBERDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCACgAKADASIAAhEBAxEB/90ABAAK/8QBPwAAAQUBAQEBAQEAAAAAAAAAAwABAgQFBgcICQoLAQABBQEBAQEBAQAAAAAAAAABAAIDBAUGBwgJCgsQAAEEAQMCBAIFBwYIBQMMMwEAAhEDBCESMQVBUWETInGBMgYUkaGxQiMkFVLBYjM0coLRQwclklPw4fFjczUWorKDJkSTVGRFwqN0NhfSVeJl8rOEw9N14/NGJ5SkhbSVxNTk9KW1xdXl9VZmdoaWprbG1ub2N0dXZ3eHl6e3x9fn9xEAAgIBAgQEAwQFBgcHBgU1AQACEQMhMRIEQVFhcSITBTKBkRShsUIjwVLR8DMkYuFygpJDUxVjczTxJQYWorKDByY1wtJEk1SjF2RFVTZ0ZeLys4TD03Xj80aUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm9ic3R1dnd4eXp7fH/9oADAMBAAIRAxEAPwDkkkklaa6kkkiQBJMAckpKUpVV23WtppY625/0Kq2l7z/VYyXLZ6T9V8jLY3Kz3HCw3Dc0R+nsH/B1v/ma3f6a7/rdK6CrL6d0qk0dNpbjtdo9w1sf/wAdc79Lb/1CVppxcL6kdTtAf1C2vp1Z/Md+lu/7aqcKq/8Arl/9ha9H1Z+q2IJubdnvHe6wtb/2zjej/wBN9iq29UutOhKGH3P5cgqncqt6Fi6Y3TsSqOCKWE/572vf/wBJWG9eazRjWMHg1ob/ANSAuebWTzKM2pJNO+Ousfo9rHjwc0OH/SBUH/sDLBGV03Etnkmlgd/nsa16yG0+SI2g9ktFJ7/qd9U8wTji7p7z3psLmz/xOV6zf8z01idQ/wAXvWKAbOnW1dTqH5jf0N3/AGza51Nn9jI/62tpguZwSrdGffURMpfVT5pbVbRc6i+t9N7Pp02NLHt/rVv2vUV6vlN6V1ugY/VcduQ0fQefbYwn86m9kW1f2HLjev8A1IzemsfmdOc7qHT2jc6APtFTf+FqZ/SK2/6ahv8AxlH+ESvuiuzzSSQIcAQZB1BHCSKFJJJJKf/Q5JJOloBJ0A5KtMFKg6AAkkgAASSToGtaPpOcun6X0SjprW5vU2tszB7qsYw5lR7Ot/Ntyf8AwKj/AI1Q6N09nTaW9Sy2/rbxOPW7/BNI/nHD/uRa3/tiv/hFWzOoWX2EAoWmm7ndXtueYcST3VNu55lxlCqZKuVMQtNMq61arrTVsVqtiVppiytHZUpMrVmutC1UwronsrNeNPZGpplX6cfyStVNAYnkmdh+S2m4unCZ+MI4StVPPPodWZbojYvUbKXAEkELQvxudFlZVESjaKc76yfVKjqYf1LorG1Zp91+G2GsuP51lP5lOW7/ALayf5Fv6RcJBBIILXNJa5rgQQQdrmua73Ne130mr0XHzX0WAEqj9augs6pS/rHT2fr1bd2XQ3m9jR/PMb/3LpZ/7EU/8LXWlsqnh0k4IIBBkHUEJJy2n//R5RanQsBl9zszIE42KRDTw+36TGf1Kv52z/razWMfY9tdY3WPIaxvi5x2tC386yvAw68Kky2oQ537zjrZZ/berFsQDX6p1F91pEySVVpaqzCXv3HurtLULXU2aWK7UxApartTU200mqYrNbFCpitVsStNL1sVqpihW1WamoWmmzj1rSx6wqdAWjRCVqpO2sQmdWCERJMsqc/IqELIy6xqt3I4WPmRqpAVpDz2YyJS6d1F9FoEwQdETM7rHucWP3DsnWimr9buj14eU3qOI0Nws5xJY3iq/wCnZUP3ar/5+n/r1awF3mOKeq9Pu6bkOhmQ2Gv/AHHj3U3D/irfcuFsqtqsfTc3ZdU51drPBzTse3/OCIKCH//SyOhUg5L8p30cVkt/4x8sZ/ms9Ryq9SyTbcRPdX8b9X6Nu4dkPc8/Afomf9QsQvL7SVMStAbVAV+gKlQFoUBNJXAN2lqu0tVWkcK9SELXU2Kmq1W1BqCt1tQtNM2NVisIbAjsCFpps0mFdpes9hhWGWQlaqdFtghJ1ghUxd5qL79EtEcLLIt0KyMuwaqzffzqsvJtmU60ENDLdysfJPK0cl8yszIPKIK0hfp2SargJ7qv9bsUM6hXnMHszq5f/wAbVFdn+fX6L0EP2Wg+a0+sNGV9XjZy7EsZaP6rv0Fv/nxqcCtIf//Tyupu9LBx6v3KmD5locfyrDpMmVsdfdGngAPuWNQeE8lIDo0LRo7LNoPC0aDwmkrwHRp7K/Ss+gq/SU21wDeqVqsKrUVbrQtNNhgRWhDYjNCVppcKW+FE6KDnJWqkhtQbLvNQe9V7HpWilXXKhfZyi2vVG56NoIa971nXuVu53KoXOTgVpDUudBnwWzhH1+l5dB19SiwD4hpc3/pNWHe7lbHQXbgW9nNI+8QnArCH/9TE6/rr4gH71i0HhbfVh6mJTZ+9W374hYFJgx4IksgDqUOWjQ5ZVDloUP4TCV4Dq0OV+lyyqH8K/S9NJXAOpU5W63LOqerdb0LXU6DHIzXqkyxFFiFppsl6E9ygbEN1iVqpT3KtY9SfYq1j0bRTC16pXORrXqna9EFaQgucqNzke56o3PTgVpDXvdytnoJiXfutJ+4SsC10lbnTT6WBk2/u0vj4lpa3/pOTwVhD/9XHcPW6ZHelzm/I+9v/AFS50+y4g+K6PBIL30Hi5un9Zvub/wBHcsPqdBquJ800lnAZ0vWhS9ZFNivU2JpK8B2KbFepsWPTartNqYSvAdiqxWq7Vk1Wq1Xcm2uAdRlqKLVnMuRBchaabxtUHWqp6yi65K1Unfaq1lqG+5V7LUbQQytsVO2xK21VLbU4FaQxusVG6xEtsVK6xOBWELA77QB4rdvPo9HLPzsh7WD4D9K//qFj9NqNtwPmtPq1gNzMdv0cdsH+u+HO/wA1uxPBWEP/1sFpc0hzTDmkFp8xwpdWx25FIyGDR4kjwP5zf7LlEKxivb7qLP5u3gns7sf7X0VGS2QHl2k1uLT2VuqxE6tgPpsLgIhUa7EwlkAdeq1XKrlj1Wq3XcmErwHYruVllyx67lYZemkrwHXbepi/zWW2/wA0QXoWmnR9fzUXXqh6/mom/wA0rVTcfegWXKs+9AfeiCghNZcqttqHZd5qtZd5pwKwhe21VXOL3Bo5KjZar3SsF91gJEyU8FYQ6fS6mYtDsqwSKxIHi78xn9pyquc57i95l7iXOPiTqVazbWnbj1H9FTyRw5/Bd/Y+i1VSngsZD//XwgnhMFIKItsJ9rcyr0bP51o9jj+cB+b/AF2rns/AsosJAW4Ed7asxnp3QLez+A74/wAtRksgDybLI0Vmu5Gz+lWUvJAhZ8uYYcITSvGm7pMuR23rKbajNuTDa8U6jb/NTF/mswXqQvQtfTpeuom9UPXTG9K1U3HX+aE+9VHXoTrvNELS2H3KvZah73PMN1V/A6XZc8EiU8LCwwcKy+wEiVvu24dXoVfzzhD3D80H83+u5Jorw2enTBt4c/s34fy1XP5U4MZDCITFSKiVIGMv/9DDCkFEKQUJbgXClCYKQUZZAlbaHN9O4eozsfzh/wCSVTK6NVc0voIcO47j4hHCm0kEEGCOCOUwsgecv6ZdUTAKrFlrOWrsPUDxFrRYPHgoNmDhW+LD5j/yKHEfNPtg7aPKeqRyn9ZdE/oVTvoOafmEI/V49gClxx7K9uXSThesl6pPC3R9XndwEVnQqm/Tc0fMJcceyvbl1k86Ba86NKtUdNvtIkFdBXg4VXi8+Q/8kjeoGCKmhg8eSlxfRXABvq0cXo9dLQ+8ho7DufgFbdaGt9Okemzufzj/AORTOJJJJknknlQKIQWKiVMqJTwxliVEqRUSpAxl/9k4QklNBCEAAAAAAFUAAAABAQAAAA8AQQBkAG8AYgBlACAAUABoAG8AdABvAHMAaABvAHAAAAATAEEAZABvAGIAZQAgAFAAaABvAHQAbwBzAGgAbwBwACAAQwBTADYAAAABADhCSU0PoAAAAAAA+G1hbmlJUkZSAAAA7DhCSU1BbkRzAAAAzAAAABAAAAABAAAAAAAAbnVsbAAAAAMAAAAAQUZTdGxvbmcAAAAAAAAAAEZySW5WbExzAAAAAU9iamMAAAABAAAAAAAAbnVsbAAAAAEAAAAARnJJRGxvbmdMAgJNAAAAAEZTdHNWbExzAAAAAU9iamMAAAABAAAAAAAAbnVsbAAAAAQAAAAARnNJRGxvbmcAAAAAAAAAAEFGcm1sb25nAAAAAAAAAABGc0ZyVmxMcwAAAAFsb25nTAICTQAAAABMQ250bG9uZwAAAAAAADhCSU1Sb2xsAAAACAAAAAAAAAAAOEJJTQ+hAAAAAAAcbWZyaQAAAAIAAAAQAAAAAQAAAAAAAAABAAAAADhCSU0EBgAAAAAABwAIAQEAAQEA/+ER0mh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4NCjx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4NCgk8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPg0KCQk8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE0LTA1LTIyVDA5OjM0OjQ4KzAyOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE0LTA1LTIyVDE0OjMwOjM3KzAyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxNC0wNS0yMlQxNDozMDozNyswMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9qcGVnIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk0NTFBOUUwQUNFMUUzMTE4QjgyOUY3NThGQTE4QTkxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjY4NDJDMThEODNFMUUzMTE4QjgyOUY3NThGQTE4QTkxIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6Njg0MkMxOEQ4M0UxRTMxMThCODI5Rjc1OEZBMThBOTEiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+DQoJCQk8eG1wTU06SGlzdG9yeT4NCgkJCQk8cmRmOlNlcT4NCgkJCQkJPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6Njg0MkMxOEQ4M0UxRTMxMThCODI5Rjc1OEZBMThBOTEiIHN0RXZ0OndoZW49IjIwMTQtMDUtMjJUMDk6MzQ6NDgrMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpIi8+DQoJCQkJCTxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo2OTQyQzE4RDgzRTFFMzExOEI4MjlGNzU4RkExOEE5MSIgc3RFdnQ6d2hlbj0iMjAxNC0wNS0yMlQwOTozODo0MiswMjowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4NCgkJCQkJPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOkQ3NTFDMUI1OTFFMUUzMTE4QjgyOUY3NThGQTE4QTkxIiBzdEV2dDp3aGVuPSIyMDE0LTA1LTIyVDE0OjMwOjM3KzAyOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPg0KCQkJCQk8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY29udmVydGVkIiBzdEV2dDpwYXJhbWV0ZXJzPSJmcm9tIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AgdG8gaW1hZ2UvanBlZyIvPg0KCQkJCQk8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9qcGVnIi8+DQoJCQkJCTxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5NDUxQTlFMEFDRTFFMzExOEI4MjlGNzU4RkExOEE5MSIgc3RFdnQ6d2hlbj0iMjAxNC0wNS0yMlQxNDozMDozNyswMjowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4NCgkJCQk8L3JkZjpTZXE+DQoJCQk8L3htcE1NOkhpc3Rvcnk+DQoJCQk8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpENzUxQzFCNTkxRTFFMzExOEI4MjlGNzU4RkExOEE5MSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2ODQyQzE4RDgzRTFFMzExOEI4MjlGNzU4RkExOEE5MSIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjY4NDJDMThEODNFMUUzMTE4QjgyOUY3NThGQTE4QTkxIi8+DQoJCQk8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPg0KCQkJCTxyZGY6QmFnPg0KCQkJCQk8cmRmOmxpPjFGNjdDMjc4QzkwQUVCRUQ1NDE4RjhCRTJCRUM4NkJGPC9yZGY6bGk+DQoJCQkJPC9yZGY6QmFnPg0KCQkJPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+DQoJCTwvcmRmOkRlc2NyaXB0aW9uPg0KCTwvcmRmOlJERj4NCjwveDp4bXBtZXRhPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0ndyc/Pv/iDFhJQ0NfUFJPRklMRQABAQAADEhMaW5vAhAAAG1udHJSR0IgWFlaIAfOAAIACQAGADEAAGFjc3BNU0ZUAAAAAElFQyBzUkdCAAAAAAAAAAAAAAABAAD21gABAAAAANMtSFAgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEWNwcnQAAAFQAAAAM2Rlc2MAAAGEAAAAbHd0cHQAAAHwAAAAFGJrcHQAAAIEAAAAFHJYWVoAAAIYAAAAFGdYWVoAAAIsAAAAFGJYWVoAAAJAAAAAFGRtbmQAAAJUAAAAcGRtZGQAAALEAAAAiHZ1ZWQAAANMAAAAhnZpZXcAAAPUAAAAJGx1bWkAAAP4AAAAFG1lYXMAAAQMAAAAJHRlY2gAAAQwAAAADHJUUkMAAAQ8AAAIDGdUUkMAAAQ8AAAIDGJUUkMAAAQ8AAAIDHRleHQAAAAAQ29weXJpZ2h0IChjKSAxOTk4IEhld2xldHQtUGFja2FyZCBDb21wYW55AABkZXNjAAAAAAAAABJzUkdCIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAEnNSR0IgSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYWVogAAAAAAAA81EAAQAAAAEWzFhZWiAAAAAAAAAAAAAAAAAAAAAAWFlaIAAAAAAAAG+iAAA49QAAA5BYWVogAAAAAAAAYpkAALeFAAAY2lhZWiAAAAAAAAAkoAAAD4QAALbPZGVzYwAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGRlc2MAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAAAAAAAAAAAAAAAABkZXNjAAAAAAAAACxSZWZlcmVuY2UgVmlld2luZyBDb25kaXRpb24gaW4gSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAsUmVmZXJlbmNlIFZpZXdpbmcgQ29uZGl0aW9uIGluIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdmlldwAAAAAAE6T+ABRfLgAQzxQAA+3MAAQTCwADXJ4AAAABWFlaIAAAAAAATAlWAFAAAABXH+dtZWFzAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAACjwAAAAJzaWcgAAAAAENSVCBjdXJ2AAAAAAAABAAAAAAFAAoADwAUABkAHgAjACgALQAyADcAOwBAAEUASgBPAFQAWQBeAGMAaABtAHIAdwB8AIEAhgCLAJAAlQCaAJ8ApACpAK4AsgC3ALwAwQDGAMsA0ADVANsA4ADlAOsA8AD2APsBAQEHAQ0BEwEZAR8BJQErATIBOAE+AUUBTAFSAVkBYAFnAW4BdQF8AYMBiwGSAZoBoQGpAbEBuQHBAckB0QHZAeEB6QHyAfoCAwIMAhQCHQImAi8COAJBAksCVAJdAmcCcQJ6AoQCjgKYAqICrAK2AsECywLVAuAC6wL1AwADCwMWAyEDLQM4A0MDTwNaA2YDcgN+A4oDlgOiA64DugPHA9MD4APsA/kEBgQTBCAELQQ7BEgEVQRjBHEEfgSMBJoEqAS2BMQE0wThBPAE/gUNBRwFKwU6BUkFWAVnBXcFhgWWBaYFtQXFBdUF5QX2BgYGFgYnBjcGSAZZBmoGewaMBp0GrwbABtEG4wb1BwcHGQcrBz0HTwdhB3QHhgeZB6wHvwfSB+UH+AgLCB8IMghGCFoIbgiCCJYIqgi+CNII5wj7CRAJJQk6CU8JZAl5CY8JpAm6Cc8J5Qn7ChEKJwo9ClQKagqBCpgKrgrFCtwK8wsLCyILOQtRC2kLgAuYC7ALyAvhC/kMEgwqDEMMXAx1DI4MpwzADNkM8w0NDSYNQA1aDXQNjg2pDcMN3g34DhMOLg5JDmQOfw6bDrYO0g7uDwkPJQ9BD14Peg+WD7MPzw/sEAkQJhBDEGEQfhCbELkQ1xD1ERMRMRFPEW0RjBGqEckR6BIHEiYSRRJkEoQSoxLDEuMTAxMjE0MTYxODE6QTxRPlFAYUJxRJFGoUixStFM4U8BUSFTQVVhV4FZsVvRXgFgMWJhZJFmwWjxayFtYW+hcdF0EXZReJF64X0hf3GBsYQBhlGIoYrxjVGPoZIBlFGWsZkRm3Gd0aBBoqGlEadxqeGsUa7BsUGzsbYxuKG7Ib2hwCHCocUhx7HKMczBz1HR4dRx1wHZkdwx3sHhYeQB5qHpQevh7pHxMfPh9pH5Qfvx/qIBUgQSBsIJggxCDwIRwhSCF1IaEhziH7IiciVSKCIq8i3SMKIzgjZiOUI8Ij8CQfJE0kfCSrJNolCSU4JWgllyXHJfcmJyZXJocmtyboJxgnSSd6J6sn3CgNKD8ocSiiKNQpBik4KWspnSnQKgIqNSpoKpsqzysCKzYraSudK9EsBSw5LG4soizXLQwtQS12Last4S4WLkwugi63Lu4vJC9aL5Evxy/+MDUwbDCkMNsxEjFKMYIxujHyMioyYzKbMtQzDTNGM38zuDPxNCs0ZTSeNNg1EzVNNYc1wjX9Njc2cjauNuk3JDdgN5w31zgUOFA4jDjIOQU5Qjl/Obw5+To2OnQ6sjrvOy07azuqO+g8JzxlPKQ84z0iPWE9oT3gPiA+YD6gPuA/IT9hP6I/4kAjQGRApkDnQSlBakGsQe5CMEJyQrVC90M6Q31DwEQDREdEikTORRJFVUWaRd5GIkZnRqtG8Ec1R3tHwEgFSEtIkUjXSR1JY0mpSfBKN0p9SsRLDEtTS5pL4kwqTHJMuk0CTUpNk03cTiVObk63TwBPSU+TT91QJ1BxULtRBlFQUZtR5lIxUnxSx1MTU19TqlP2VEJUj1TbVShVdVXCVg9WXFapVvdXRFeSV+BYL1h9WMtZGllpWbhaB1pWWqZa9VtFW5Vb5Vw1XIZc1l0nXXhdyV4aXmxevV8PX2Ffs2AFYFdgqmD8YU9homH1YklinGLwY0Njl2PrZEBklGTpZT1lkmXnZj1mkmboZz1nk2fpaD9olmjsaUNpmmnxakhqn2r3a09rp2v/bFdsr20IbWBtuW4SbmtuxG8eb3hv0XArcIZw4HE6cZVx8HJLcqZzAXNdc7h0FHRwdMx1KHWFdeF2Pnabdvh3VnezeBF4bnjMeSp5iXnnekZ6pXsEe2N7wnwhfIF84X1BfaF+AX5ifsJ/I3+Ef+WAR4CogQqBa4HNgjCCkoL0g1eDuoQdhICE44VHhauGDoZyhteHO4efiASIaYjOiTOJmYn+imSKyoswi5aL/IxjjMqNMY2Yjf+OZo7OjzaPnpAGkG6Q1pE/kaiSEZJ6kuOTTZO2lCCUipT0lV+VyZY0lp+XCpd1l+CYTJi4mSSZkJn8mmia1ZtCm6+cHJyJnPedZJ3SnkCerp8dn4uf+qBpoNihR6G2oiailqMGo3aj5qRWpMelOKWpphqmi6b9p26n4KhSqMSpN6mpqhyqj6sCq3Wr6axcrNCtRK24ri2uoa8Wr4uwALB1sOqxYLHWskuywrM4s660JbSctRO1irYBtnm28Ldot+C4WbjRuUq5wro7urW7LrunvCG8m70VvY++Cr6Evv+/er/1wHDA7MFnwePCX8Lbw1jD1MRRxM7FS8XIxkbGw8dBx7/IPci8yTrJuco4yrfLNsu2zDXMtc01zbXONs62zzfPuNA50LrRPNG+0j/SwdNE08bUSdTL1U7V0dZV1tjXXNfg2GTY6Nls2fHadtr724DcBdyK3RDdlt4c3qLfKd+v4DbgveFE4cziU+Lb42Pj6+Rz5PzlhOYN5pbnH+ep6DLovOlG6dDqW+rl63Dr++yG7RHtnO4o7rTvQO/M8Fjw5fFy8f/yjPMZ86f0NPTC9VD13vZt9vv3ivgZ+Kj5OPnH+lf65/t3/Af8mP0p/br+S/7c/23////bAEMAAgEBAgEBAgICAgICAgIDBQMDAwMDBgQEAwUHBgcHBwYHBwgJCwkICAoIBwcKDQoKCwwMDAwHCQ4PDQwOCwwMDP/bAEMBAgICAwMDBgMDBgwIBwgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDP/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APzrz/jx3pep9cfzpMf3vy9acTub6dq/RD4sQf8AAqMYzSk4b8OPegNk/jikwG/MCMemOKVs7v8APNIThc+gFKBlqYCE5C9fypeh57GkA+bH459acBg1PMVysQt+uKCWJ/pXqH7Nv7GfxF/ax1Fk8F6C82lwymG61u+f7LpNkw6h7hgdzLkExwrJKAQdmK+9fgT/AMEhfhT8G4YdQ+Iuq3XxG1qPDtZqz6fo0DdQPLRvPn2n+KSRY3H3ocEilcaifmz8MfhP4p+NniVtH8G+G9e8VapHhpLXSbCW8e3U9Hk8sERpwfnfCjHJr60+D/8AwQr+L3jdIrjxhqvhL4c2cn34ru7/ALW1FB2IhtSYDx2a5RhwMA5x9/8A/C8tD+GXheHQfDOm6T4f0SzJ+z6dpdpHZ2cH+5FEqoucDoOa4LxP+1RLK7bbjH0NLmHynF/Dr/ght8E/BSRy+LvGPjnxldRjDpBLBo9jL6kxIks6/hc9+/WvZPCP7FP7MHwwVV0/4Q+Db3Z31sT67vPqRfSTA/TGPYDivFda/aQmuC3+kN+dYdx8dLq5+7JJ19anTqVyn2PoOq/C/wADIqaH8P8A4e6Ksf3V07w3ZWgX6COJRXS2P7S2m6Wm21htbdRxiKNUA/ACvgw/Fe/uDx5h/GpYviRqL/xP+dSuVbIOU++m/aV03VF23UVrcL3EsSuP1FZ+qT/Cv4gRtHrnw8+HeuRyfeXUfDVjdKw9/MiaviO1+Imor1L9OOa2tO+KF/Dj/WYHvQ4we6KV1sz6Q8VfsA/sp/FmPbqXwb8G2G7BB0Hz9A2/QWEkIH0xj2xXjvxJ/wCDev4GeP4ppvBfjjx94IvZVxDFcyW+tafCeefKdIp27dbnoPXmqei/Gy6tyu5pB+JFd14W/aCniK/6Qw/4FU8i6Nr5/wBIfM+tj41+N/8Awbs/HH4fJPdeCNS8G/FKwj4iisr0aPqkgz1a3uyIF4wcLdOeoweM/Fvxa+DXjD4A+Kl0Tx14V8ReDdXk3GK01rTpbGS5VThni8xQJUz/ABx7lPY1+9ngv9pWaNk3XGfqa9Ll+KPhv4w+EJvDvi/RtD8UeH73AuNM1mxivrOf/fhlVkb8QaOarHZ3/B/5fgHLB76H80fVcH8qMf734V+0/wC0x/wb9fB/4629zqvwn12++FmvybpF0+Vn1TQZ35bb5cj/AGi33Ngbo5WjjH3YDgCvzA/a+/4J8/Fr9hjV1j+InhWWz0i4mEFn4i0+T7boeoOSQojulA2O2G2xTrFMQpPl45qo4hN8r0fZ/wBailRaV1qjxY9fxxSqwwB70Bcrzz/WgcL0/XrW3MY8opbOMHH4UIMrn/IpuDvH1o3Y49qokPusfpRnKevPSlUZX/Z/nRtz8vcjmgBN2Cfm2846UpLZHGOfzoZdo/8ArUe360AJg84HfNBPyf7tKB8vNGdzDv3pXAT7uPY0Dls/e5/KnDjvmnBD6YqeYtRGjkY9sU7Bpdqnv0r0X9m79mHxV+1P44bR/DdvHDbWe2TU9Vugy2ekxNnDSMOWdtrbIl+dyrEYVXdI5i+VnFeEfBmrfELxTY6HoWmX2sa1qUnlWllZwmae4bGTtVewUFmY4CqpYkKCR9//ALL/APwSd8O/Di2t/EHxiuLfXdVUCSPwzZ3H/EutD1Aup0INy44zHGVhyCC1wrcesfBr4VeA/wBiPwVNYeF4jc6xexBNU127Vft+pkENtyMiKEMAVhQ7RtBYyPukbgPin+0dJeSSKJzjpgGp5i+U908Y/tE2XhnSbfTdLjtLDT9PiFva2lpEsFvaxrwsccaAKiDsqgAeleJeN/2j5rx5P37Hr3rxHX/idda7cFY3Y5PXNUrK3ku33SszVPMXyHc6r8VLzV5f3bSNu75qjHdXeoPmSQ8+lVdL0zIHHauk03S9u35anmK5CCx0ot97n3NbVjpGdvH6Vb07Seny1t2Gk/7NHMPkZQtNIxztrUtdEyPu1q2Gkbu3Stmy0bOOKOYfIYttoeR/WtC18P7v4a6Kw0HJ+7/9atzTvDW4/do5g5Dj4fC+SPl/SrkPhVh0BHuK76y8Jbv4f0rUtvBu4fc/SjmDkPObOxvLE5jkb1rpNB8c3ukuofzPlPWuq/4QjI+5+lVrvwPgfcp8xPIdb4E+OU1k8f75l/GvbPDPxk03xt4dutG1y0sdW0nVIGtb2xvYEuLW8icYeOWNwVdGBwVYEEda+T7rwnNZsWj3Rn2q1oviy70CZVZmUDvnilJRkrSQo3i7o8//AG6v+Df3w38S7S+8W/s93Vr4d1jDzz+DNQuj/Zl633itjcPlrVz8wEUpaAlkVWtkU5/J3x/8PNe+E/jfVPDPijRdU8O+ItFm8i/03Ubdre5tXwGG5GGcMpVlYZV1ZWUsrAn9/Phr8dJbFkBmOPQmp/2tP2RPhj/wUk+HK6b4vtV0/wAUWEJj0TxRYxr/AGno55YJk4E9uSTvt5DsbcWUxyBZVlc0NtV+K/zG1GXk/wAD+eIx4/Dmgpke56mvZP20/wBhzx7+wf8AFJfDXjWzhltb8PNouuWQZtN1+BSNzwseVkTcokgfEkRZc7keKSTx/wAsA/0rojNSV0c7i1oRMS52/nSZ549qkKkCmgZ/izWnMQ4gRtIJoHIpAuFC0gHyYI981RA4Jhx7U4ISOlO24H6U8LuNY83Y3URioAMU5U3CnhcV3f7Of7PmsftKfEu38P6WwtLaNRcalqMke6LTLYHDSEZG5z91I8gu5Ayqh3SOY0UTX/ZO/ZP1r9qbxs9rayNpXh3Syr6zrLR7ks0PIijHR7hxnanQAFmIUc/oK2t+GP2c/hza+FPCNlDpej2ALLGG3S3ErAB55n6ySvgbnPYKo2qqquPqOr+Hf2evhpZ+E/C1uthpOmIQis26a4kb780r4G+VyMs2AOgAVVVR80fFX4yy6ndSBZdzMT361HMXGB1fxS+OkuoXEn74tuPrXmMmr3GvXBaRm2ntnrWDavLqs5kkO7PIFdTothkLxWfOaKBf0bTuF4rrNH03lap6NYdK6zR9O+7xUcxoqZPpOm5A/wAK6TTNLwRxUWk6d0rptM04EDilzsrkG6bpeAOOlbljpmRU2m6Zx92tzTdNI2+lT7Qr2ZFp2k5KjHP863dO0feR8tWNN0zpXRaPo+dvp9KnmH7Mr6VoO/Hy11Gj+Gd4A29auaHoe/bx+ldtoHhvdt+X9KOcfIYuk+Ed235f0roLHwVkfd/Suw0PwruC/L+ldVpvg7hfl/Snzk+zPM18DfL9z9Khu/AgI+5+Yr2VPBwZfufpUF34PBH3f0q+cn2Z4JrHgfCn93+lcX4j8GcN8n6V9H614OGG+X9K4XxP4T2q3y/pT5iXTPne8guPD8+6Nm2g9PSuu+H/AMXptMnTMhXb71c8YeFtob5a8u8RadJpVy0kLbdp7d6vnM3TPpvxv4f8EfthfB2+8C/EDS4da0HUgrlC/lz2U6giO5t5MZinTcdrr2LKQyM6t+Kn/BQX/gn34o/YG+KUem6jK+ueD9cZ38O+I0i2Raii4LQzKOIruMEb4+jDDplSQv6T+APixJpV0gaQqwPrXtHibR/B/wC1z8GtU8A+OrFdU0DWowJFRwlxaSrkx3NvIQfLnjY5V8EdVYMjOjGz5o/8OS43Vmfz5spFNYDgHPNeu/tn/sfeJf2JPjfeeD/EDLqFnKhvNE1mKIx2+uWRYhZlXJ2SKfkliJJjkBGXRo5JPJtoda2UjJxISpH/AOqmbfT/APVVhlI6c0zyweo/WtOYzcSRUC//AKqcEJPTFOEYFOALVg5HRGJb8N+GL/xl4isNH0mzlv8AVNUnS1tLeM/NNI5woyeAPViQFGSSACa/RH4e+B9H/ZA+DMfh2wmgutUuMXOsaigIbULraRxkAiKMEpGpxhckje7lvJ/+CfvwXh+Hng2f4l6vCF1HVYpLbQkcfNbWvKy3Hs0pBRTwfLDEErNVL9oL4xNdXMy+ZleQBms3I1VMwvjR8YZNQu5R5pYsTXltnJJqtyZJM8ngelZNxqkmu6i0jHK545610mg2f3aycjZUze0Ky+7XZaHY5I4zWJoNl93NdnoVicrx2qOY0jTNjRLDIXius0bT/X0rN0OxBC11mj2WQvFRzmipl7SrDAHHaul0zTcY4qtpNhwtdJpen421HOaezJtNseB/hW9pun4H8qbYWHHNb2m2PA4NT7Qr2ZJpum52/LXUaLpnK/LVPSrHJH0rrNDsMlflpe0K9mavh3SVO35a9A8M6IDt+WsLw3Ycr8teieFtPAC8Ue0D2ZteG/D6sF+X9K7LTfDSlV+WofDOnABeK7TS9Pwn9axr4jkWgRo3epip4aBX7v6VXu/DChPu/pXZLbKopk9ksi9O1cMcbJM0dGLPLtb8MqFPy/pXA+KvD2Eb5f0r3DW9MXY3Fee+LNOGxq9WjW543OapRsz598a6CAG+WvHfHWi7Q/GfpX0Z4507h+K8X8fafzJx610KRhyHz74mjk0m6MsfBzXTfCv4uSaZeR/vMEHvWf48sdvmfjXlt9qkmhal5qs23dmrUzNwPqz9pf4B+H/+Cg/7Olx4Q1Se1sdesi174c1iRSTo99twCxUFjbygCOZADuTDAeZHEy/iX458Dax8NfGereHfEWnXGka9oN3JYahZzYL200bFWXIJVhnkMpKspDKSpBP63fAr4xtZ3MWZO4B/SvLP+Cyf7Klv8U/h/bfGzw5bq2s6BDFY+Ko4l+a9seEgvMDkvbsVjc4JMDoSVS1wdIyszF0z8zim0+1Ndd9TMu2mmIGtYyMnEeEx96u3/Z7+D8vx0+Lel+Ht0sNjIxudSnj4a3s48GVgezHKxqeQHlTPGa4sEA8fnX1/+xV4JT4Y/A3UPFV0u3UvFjlYCw+aOyhZlUc8jzJPMY9mVYTXO5HVGmdv+0F8SLfQdLXT7JIbO0tIVgggiG2OCJFCoijsqqoAA6ACvjf4g+MJNe1Ro1c8nnmu+/aC+JLXl5P+8zuJ7141pTG9umkblmORWTkbxpnS+H7XO3iu40C0xt4rlvD1tnb19K7rw/a421lKdjaNM6bQLXJHFdroNj92uc0C24Xiu30C16etZOobRpm9odmPlrr9EtOny1i6Jafdrr9Gs/u4Has3UNFTNTSbLlcda6XTLAkLx+lUNIs+F4/Sum0u04HFZ85oqZa06x29sVvaXZcLj1qvptpW5p1rwOP0qfaFezLul2eCPoK6nQ7QZWsnTLVcrXTaNFgil7Qr2R1Ph22yV4r0PwxAPlrhdAXBWu+8OMMr3o9oHsj0DwzEFK+/auusl2w1xvh+4CBa67Tpt8f4VzYh3VyZQsWqKKa77BXGSZ+tKCjfSvPfFqqQ1d1rd5tjb+KvPvFtyu1ufWvUwukSZRueXeOIx83414r8QExv4/OvYvG9z8r/AI14v49uFYP+NdiqGMqZ4r49jGXx3zXjXjaMNv8Axr2Xx5LuL9+a8c8aN9/61pGdzF0zA8F+MpNB1dUZvlB4yfevrj4D/Ea08TaNNpepw2+oafqFu9pd2lwu+G7gkQpJE6/xI6MykdwxFfDPiC4a1ufMU42mvV/gF8TGtb6D95jaR3raMjGVM+MP2x/2bbj9lH9ojX/BpaefS4GF7otzMcte6bMS0Dk/xOuGhdsAGWCXHGK8v2Z71+ln/BVv4Qx/Gf8AZl0rx/YxB9a+H8wW6ZR80+mXLIj5xyxinMLjsiPctxkmvzVI3Hpz61qpGEqZreDPCV1488WaXodi2271i7isonxkRNIwXef9lc7j7A19mfHzxJZ+DPDFvo+mr9n0/TbaOztYs/6uGNQiL+CqBXiH7CnhVdQ+Ld5rky7ofDWnSSxtjgTzZhQH6xm4P1QfUX/2n/G5murhd33ciueUjqjA8J+JHiVtX1lkDdWJPNL4cTAU1zAuzfavJJ97nFdd4cThawlM6I0zs/DsX3cDt613fh6DO3881xvhyPO2u+8Ow5K1jKodEaZ13h+DG3H6V3GgW2dv0rk/D8X3a7nQLfhaxdQ3jTOm0O14Wux0S2yBXOaFB0xXY6Hbn5eKylUNo0zd0i1xiul0u3xj/CsnR7XkcV1GlQA4rP2hoqZf0624HH/1q3NNteelVNNg6f41uWNuVxx70vaFqmXNNgwBXQaZF2rNsYCD0+lbVhGyDpUe0H7M6LQ22kV2Wg3WwrXEaaxTHzdu9dJpl4Ux9KftA9mei6Jf7Qv06Zrp9O1bYBzXnGmapt2jIrcstdwBz+tP2ncTpnfR6yuKr3mtLsPNcoPEKhfvVWvfEAx96lHlMvYRNDXNZ+U89q4PxXrWVb5qsa34i+VvmrhPFHiHKt81bKZLpnPeNdTyG+bNeOeOdS3B/wDGu28Y65lW5/WvJvGmqbt/zVsqhjKmefeN7vJbtXknjG43M/416J4xvM7+a8u8V3G8tW0ZmEqZwHidtxY/U1V+HnihtG1pVLcBhipPEkvLVxct/wDYNVjk3Y+bmto1DnlTPv74HaxpvxE8GX3h3Wo/tmj65ZTabfwZx51vNG0UqZ90Zhntmvya+Jnw8vvhL8Q9f8K6owk1Dw3qFxpk8gXas7QyMnmKP7rhQ6nuGByc1+gf7MPjow3duPM64HWvCf8Agrb8Ol0D9o/T/FFvHtt/G+jw3ErAYDXdti2lAHtCtmxPUmQ555O0ZGEoDP2R9NHhf4Ca1qxXy5ta1JkB/vQwRgJ+Ukk4rwX9ojxS09/Md38Rr6K0JP8AhE/2XvC9qPl8zTzefX7Q7z/ykH4Yr4++NerfaNWkXP3nx+tcspnXCmYfh753H+1zXe+HRgL7/wD664Lw2dyrXfeHOQD7VhKodMKZ3nhtM7a77w6nC/nXB+HG5XFd94cXdtrCVQ6Y0zuvDq/d213Xh2MNtrh/Drbdu3mu78Ppkr/KsZVDeNM7PQV+7XZaJExC1yOgjbtrs9Dj+79KxdQ3jTOn0iDha6nS4uRXPaNDwtdVpEQyKz9oaxpGzpsOe9bdlB9fWs/TEyRjritzT4sgf4Vn7Q09kW7KHaP1rVtIvaq1pCRWnbR5/wAKPaFezLNo236Y4rVs7jy6y4gRVhJdn0Io9oHszobXU9o+9V6HWtv8VcoL/wAscmhtY296PaE+yOubxDhetZ994jwp+btXMXOuY/iNZWoeIOPvVoqhnKmbOt+Jflb5q4jxH4k3Bvm/WodZ8QHDfNXG+INeJDZatFUM5Uin4r1rIf5v1rzLxbqmQ3PrW74l1fcG+avP/Eup53VtGoc8qZy3iq93Fq868Szkhv1rrvEl1u3fNXA+I7jLNnr9a2jUMZUzj/Elx97261wevSfMW/iBzXYeIps7hmuH8QSZVv1reNQ5Z0z1n9nnxY1vewfN/EO9d/8A8FOPDi+NP2WPDPiBF8y58M62sbE/8s7a6iZJD+M0VqP/ANQrwP4K60bfVVXd0bGPxr6j+M9mPHv7D3j6xYeZ5Gkf2l7j7HLHdkj04gP4ZreMzmlTPCvjFL/Yvww0ezXgWemW1vj0CQooH5Cvh/4oX3na83+9mvtj9p6X7PpJj7IgXH0FfCvxAn3eIMepNcs5nZCmafh59m0133htvu+nFedeHpeVz/nrXe+HZslcVzykdcaZ6N4cblef0rv/AA0c4PtXnPhuTbtHtXfeHZOV9a55VDphTPRvDjY2/lXdaB0X6Zrz/wAOTDC13Xh2b7v9K55VDpjTO+0EglfoM122hNkL+tcJoEu5V9uldroUvC/41jKZ0RpnaaJ0Wus0hBj8K5DRGJx/n0rrNIYYXk1nKoaxpnT6YvH6V0NigwOlc7pcv3e3HrXR6b0WodQ1VI1rRM1oW0ZHQCqdk+QK1LdS3/6qj2hXsgA2+1Nd8f41LMu3296qXD7f/rUe0D2ZHPc7B/8AXqnc3/FF1cYFZV7d7f8A9dX7Un2Q+81PH8VYep6sQDlutJqF5gVgapqBXPP41cahnKkR6xq5wea5HW9Wzu5q5q2ofe5rldbvuvPatI1DGVMyde1HO7muH8QXu8Nk8Vu67f8A3q4zX73Jb5s/jW8ahzypnOeILvdurhvEN1kMK6bxBeE7u1cTr8+d3at41DnnTOX8Qz7Q3NcTr8+C3+NdRr91979K4fX7jKtjpXRGRyzpl74Zaj5Ov4/26+1PhwR4l+C3ibTG+ZdS0O+syPUSW0kZ/wDQq+EvAV3t8R8eor7l/ZjuBd6OYT92WMofxBH9a6Y1DlqUz55/aek8/St/99Qw/EV8J+P32+IT/vda+5vjY/8Aavw70u7+8LrT7efPqGiVv618M/FFPs+vlu2+uWcjrp0y54en3ba77w5PkCvNfD9zkr/nNd34cufumuWVQ64Uz0vw3cbtueK9A8N3WCv9PrXmPh67yF/xrvvDlztxXNKZ2QpnpnhufIX6V3nh6fbt5/8ArV5n4cu/u8/jXeeHb3p/jXPKodUKZ6VoFxwv0rtdBuSAteceH7vOPeu20K6GFzWMqh0RpnoWiXGNtdbo8uNv+fSuC0S9zt/pXV6NedDWLqG0aR3Okz4A/nXRafc8AVxel3uQvzV0Gm3ykCs/aGqpHYWF2CK1Le9VRXK2eoYTrWhFqean2pfsjdnvgV/D1qjdXS7aqPqXy1Tn1Dk9KPai9kOvLoLWPfXeBjNPvb4YNY1/e5FV7Ql0yvqN3jNc7ql7jPJq7qd78vWuc1O/znnmtFUMpUyhq+ocfxEVymtXuA2K09XveTXKaze/erWNQxlTMnXL37w/lXG67dZzg1ua3fcNXG67e8Nz+tbxqHPOmYeu3f3q4nX7r71dBrt5ndzXE6/e4Lc10Rmcs6Zz+vXvDVw+v3WN1dF4gvc7ua4jX73Bb5q6YVDjqUy34Cn3+Ix/vCvub9mG6+z6R5x4EaFz9ACa+D/hj++8QBu28V9ufCq9/sP4ReINQJ2rY6Rd3R9gkDvn9K6oSOScDxG5k/4SP9njQJR83l2P2b3Hks0P8o6+LfjdZmDVHP8AdYkfnX2P8Fbr+3Pg3qmnt80mnXhcD+7HKgK/+PpJXy5+0ToP2e+n+X7rGuWpI66dM878P3eNtd14du8ba8z0K7w2D1H867bw9e7SorllM7adM9S8OXmNvPPau88N3mNteV+Hr/bt5ru/Dt9jb2rllUO2nTPVfD19gL81d34fv8kc15V4e1Hlee1dx4f1HO2uaVQ6o0z1TQb7O3mu00K/xt+avLdA1L7uDXaaHqf3fmrnlUOqNM9P0XUdyrzxXV6TqGSvze9eZ6Nq3A6V1mk6v0/xrF1DeNM9G0nUuOv/ANeug07VNo/+vXnum6vwK3LDV8d6zdQ1jSO+tdW6c1ch1XH8VcXa6zjHzVcTWcD71T7Q09idXJquR1H5VWn1T3rBfWAV61Xn1fcPvdKPaC9ka17qfFY9/qC5PvVO61fIJzWPf6qP71UqhDpFjUtQ25+auc1bUuvPak1DVchue1c9qmr4B5zWiqGTpEWr6jkH6Vyus6jyas6tqeQxzXLazquA30raNQwlTKOuah97muP1zU8lutaGt6pjdXH67qYIb5q6ITOWVMy9e1HIbmuL1/UN27/GtbXtUxuri9e1Ldu5xXTCoctSmY+vahjPNcTrt9w3NbWvah97muL12/LMdvUmuqEjjqUzuPgnb/adWRuu5819feLNR/4RL9k7xdcN8vn6YbEerfaXS3I/KU/hmvl39njRzcXsGF6kDpXv37XGtDw78ANF0hW2za1qSuR/fhgjZmH/AH8eA11U5HFUpnlH7N2qiz8Y3WmyNiPWLR0Uessf7xc/8BEo+rCvO/2pfCBjup2C+p6fWtPw/q83hzW7PULfmaxmS4RSeGKkHafY4wfYmvQ/2j/DEPiDQ1v7X95bXUK3EL4+9G67lP5EVz1JHXTgfArZsNVkj9811Og3/C89sVl/E7RW0fWmk29GOar6FqGdpz/9euOpI7qdM9S0DUMba7rQNUwF+leT6DqW3b81dtoGpbNvNclSZ2U6Z614e1Lhea7bQdVOVryXQdVyV+au10LV87ef/r1yyqHZTpnrWgaqCB82K7HQ9VxjmvJ9D1b7vNddomtkAYaueVQ64Uz1jRtX4HNdRpWsYA5ryvSNcxty1dNpWucLhqwlUOmNM9Q07WuB83vW5ZazgD5q8007XM4+atuz1wEDn9aydQ1VM9EttawOtW4dcwPvVwVtr3H3qtJ4gAH3qj2hfsjtxroA+9+tRTa0B/FXHnX8D71Ml18H+Kj2geyOluda2/xVlX+tYHWsK51zg81mXmvYz83arVQh0zV1HWslvmrn9U1ng/NVDUNcyD83b1rA1TWsZ5rSNQylTLGq6x15rl9Z1n730qPVda4bn9a5fWNaxnn9a6I1DmnTDWtXAz81cfrWrZDc1JrOs/e/xrktb1jJbn9a6ITOWpTINa1cc81xmuangtzVvW9W3bua4/WtVzuy1dVOZxVKZR13U/vc1y4lOoapHGOfm5FSa5qfXmp/hrpbaxrSvjcN3H0rrpyOOpTPpX9lzww0l3bnb6dqvftp+J11b4nWOjRtmHw7p8cbL6TzYlcj6oYB9VNd5+ztoVt4Z8Py6pfN5NnYwPc3D4+5EilmP4KpNfPHivxDceMfE2oavdjbdapcyXcig5CF2LbB7LnaPQAV2QkcNSBUjTJ+vJr1f4a3q+OPhldaPN811o5Jjz1eBySPrtbcPYFBXlSLn+ddB8PvFbeCPFdrf7Wa3GYblF5MkLffHuRwwH95FrnqSOqnA8R/aI+H7WV5P8nc9q8OsLhrC4aJuNp/MV95/tK/DOPUbNru38uaGVBIkicq6kZDA+hBBFfEvxH8MSaHq0kgUqA3PFcVSR3U4mpoep4KnNdloOq52815XouqYI5611+i6tkLzxXHOR3U6Z6voWr/AHea7LRNZzt5ryXQ9Z9W/Guu0bWfu/NXLOZ3U6Z65omt7cfN2rrtF1wELz+FeRaLruMYauq0jXduPmrllI64Uz1zSNb+781dHpmvYx8xryfSvEHC/NXRab4iAA+bt61zyqHTGmerad4gPHzfrWxZ+IR/e/WvL7DxDgdf1rWs/EHH3qyczdUz0y28Qjj5qtR+I+nP615zB4ix/FVqLxJ/tfrUe0LVM77/AISHI+9UcviHj7361xLeI93U/rUcviLj7360e0H7M6+41/A68Vm3fiHI+9+tctceIP8Aa/Ws288Q4/izVqoZumdHf6/x1rC1LXuD81Yd94gyPvVh6j4hxu+atY1DCVM1tV1373P61zOr6397ms/U9fyD8361zeq691/xrojI550y1rOt8HmuT1rWvvc/rUWr631+auW1nWs5+auqEzjqUxdb1jO7muQ1vV8huafrOscn5q5PWNY2Z5rqpyOGpTEv7xry4Ea53MQOK9r/AGePArXd5B8mdxHavIPh14ek17V1chtpYY47V9qfs4fD2HTLFby4McNvAhklkf5ViRRlmJ7AAEk+grspyOGpE0/j54gXwH8IrTQYG23niBgZQOsdtGQW+m9wijPBUSCvAJFwf5V1XxU8dP8AEjxzeaptkS3bEFnGw5ht0yEGOxPLkdNztiuYYZz7c1205HDUih8Qz7dqsQpjmowuasRrg/SsKkjopxPSPhjrEfjHwvL4cvMNcWqNJZFuskXJaP6rywH90kdEr56/aO+EDWlzNtj4ySOK9J0y+n0u+gureRobi3cSRuv8LDp9foeD06V6F4r0az+MXgs6hbxrHcINl1CP+WEmPz2nqD6cdQQOGpI9ClFn5vahaSaBqDRsGC579q19G1Pbtwa9H+OXwhksLqb93tYE9q8bVpdJujHJxg9a46kjvpwPSNF1j7vzV1eka3tx83avKtJ1fbt+aum0jWtuPmrjnI76cD1nR9cwBzXTaVr3T5q8l0nXOR81dJpmv/7X61yymdlOmetaZ4g7bq6DTfEXA+b9a8n03xDuA+at2x8QdPmrnlM6qdM9WsfEW3+Kta18Tf7X615ZZeIsD71alt4mwB8361hKodEaZ6fb+Jc/xVZj8R8ferzWDxLn+KrEfiPj735Go9oaezPRP+Ek/wBr9ajk8R5H3h+Brgm8S8fepknib/a/Wj2gOmdtceJMfxVQuvEme9cfN4n4+9iqN14lA/iq1MzdM6m98RZzz+tYeoeIsfxfrXO3viTj71ZF/wCIx/ereMznnTN3UvEPXk1zuqeIMhvm/WsfUfEOd3zGsHU/EHX5q6ITOWpTNHVNd4PzVzGsa4Wz81U9U13cOD+tc3qeuZLfNXVCRxVIljV9Yxnmsezjk13UViQFlzyR3qjLdPqdwIo/mY1658EvhXJqN3C3lnLEcYrrpyOGpA9A/Z2+FTXtxBmM7cg9Ote3fG7xUng/wnD4VsWC3V8iyX5U8xRdUiz2L8MR12gdVerXh+1s/gr4G/tK4jSS6ceXaQHrcS4799q9WPpgdSAfI9X1C41nUri8upmuLq5kMssjdXY8n6fQcAAAYFd1ORwVImfKufx4qCRf06ircq5P1FV35OPauynI8+pEdCMNViNcr9eahi5T+VWEXc1ZVGa04kka7vxrc8GeKLjwdrC3UK+ZG48u4gY/LOh6g+h7g9j6jIONEMN+lTxJ0+nNcNRno0onWfFj4Y2PxA8PrqWm7ZoLgEg4wyHurDsw7j8RkYJ+O/jF8HpdMupGWNlZST0r648E+MZ/CF43yfaLO5wLi2J+Vx/eHow7HvnB46XPih8JNP8AHuh/2hprJcQzA4bb8yHurDswyOP5ggnhqSPSpxPzpAm0u5Mcnyn+da2navjaM16Z8XfgdLptxLiFlP0ryG+0640KZlkVtqmud2l6nUrx1ex2em61nHzVv6Zr3+1Xmthqm3HzVsWGtYI+auOpGSO6jKEup6hp/iHGPmrcsfEW0D5q8tstewPvfrWtZeIMD71ccpM74RPUrPxJ0/oa0rbxJx979a8vtPEfvWhb+JN38Vc8pHTGmenQ+I+PvVNH4myPvfrXm8PiPP8AF+tWI/EpA+9U8xt7M9C/4SbH8VNk8TZ/iH51wX/CS/5zTH8TD+9SUw9mdxP4myPvfjmqNz4k4+9+tcbL4kwPvVTn8SjH3quMjKVM6278SZz81ZN94kwOv61zF14i/wBqsu88RZz81dEZHNOB0V/4hyDz+tYOpa91+asW+8QZ/i/WsXUNcJ6NXVTkcdSKRralrvJ+asZrmXUrjy4uSetVrS2uNdn2xhtpPXHWvXPhJ8F5dTnjzEWJI7V105HDUjch+EPwpk1G6jdo2ZmI7V9efC34d2Pw+8OtqmpHybe3UEnHzMeyKO7HoB/IZIg+GXwt0/wBof8AaWpFbe3hAySMsxxwqj+JjjoPQnoCRk+PPG9x41vkLKbeyteLa2ByIweNx9XI6nt0HHXrpyOGpEo+OvGNx451xrqYeTEqmO3gU5S3j/uj1J6k9yewAUYDrg/jVuUYJ+maglGT9c13U5HnVEVXTA+nSq8q4NWnGDn86rzjCV3U2edUiSQjBH0qZF/lUcfU1LG2Vz+lZ1DSluTRc1OvK1HGMGp415X864qkj0qJLGMN+lbHhXxPd+FL5pLcho5ABNA/Mcy+/uOcEcj6Eg5MQ2j8jU8PK1wVGejTR1viPwNpPxY0qSaxXbOq5lt3x5kPv7r/ALQ49cHIHzb8YP2c5LSWRlh465Ar2/T7ybT7tZreWSGaDlJEbaw/z+o46V1tt4m07xfbfZtajjt7hhtF0ifu3/3lH3T7jj/dFcdRnoU0fnT4o+G91oU7FUYYPpWCl1JZvtkDKffvX318T/2Z47+FprdEkjkXcjIQysOxBHBHuK+ePiJ+zpNYvJ/o7D8KzWKtpPVDlgebWm7M8btNZ/2q0rbXOOf50zXPhleaRI2xXX2IrDngurB/njbjuBVclKr8LMfbYig/fTOwttc/2v8A61XYddwM7q4KLV9vGfwNWo9Ywep/OueeBOmnmx3kev8AvUw19tv3zXCx64wH3v1qRfEGwda53gWdcc2jY7j+3mP8VNfxEQPvfrXFnXwaa+v/AO1il9RkV/asDsJdf/2qq3HiDJ+9XIya7jvVaXXNx4bP61vDAyOepm8TqbrXgB94/nWbd6+PX9ax4TdXz4jjbB7kVuaH8OLzVnXcrNu7YrX2NOn8TOf61Xrfw1/kZcmpSXj7Y1LHpW54Y+H954guF3qxBI4xXpXw9/Z6mvpI/wBwx59K+hvhj+zTHYwrNcRxxxxjc7OcKg7kk8Ae5o9snpFGscO171R3Z5L8Iv2eZLyWPMJwcckV9HeHPBmk/CfSY7i+UNcMuYrdMeZMf6L/ALR464ycAzT+J9P8H232fRY47i4UY+0un7tP90H7x9z8vswrk7+6l1C6kmuJJJppeXkdtzMf8/lW0GY1ES+LPFN54svhLcMFjjBWCBOI4V9vc4GWPJx6AAYz8NVqb7n05qtL92u2mzz6iK0gwtQTDI/OrMq/e+lQy8mu6mzzqxVnXn9ahkHLfSrEi5UZqF+ld1M82ruCDK/jUyHIx6k4qGMZH41YiPzfjU1CqJOo5qzGMVVT7v4Vaj6muGqelTJYhkfhViLkCoIug+lWIui/SuGoz0qZIozU0H3h9P8AGoVOAPck1YiOWauGoehT3NXQfEt54fO23m/cuctC43RP9V9fcYPvWvPc6F4wj8u+t/sEzcFseZC349V+hBA9a5qHqPzqeMctXHUZ30zP8Y/sx2usWzT2ixTQtna8RDofoRxXkPjH9liaFnK2+evQV7tYX82my+ZbzSwMQMlGK5+uOo9jW3beOJ5l23lva3i9CSnlufxXj/x2uWV76HdBJ7nxH4k/Zwmt2b/R2/75rktR+B11as22ORfoDX6Ezr4f1kf6RZz27N1+USKPx4P6VnXnwm8N6uN0V1ajd/z0Bj/9CAqVja0NpEyy3DVPiij88bj4W38LceZx7VXb4daip6N+VfoFc/s06Zd/6mW1kz/clVqpyfso27n5Yw34A1X9rVlpoZf6vYV9/vPgkfDrUS3Ib8qsW3wsv5jhvMr7uj/ZRgQ/NGo+oFXLf9mnTbQZmktI/XfKq/zNP+1qz00BcP4Vb3+8+G9N+B11csN0cjfUV1nhv9nK4nZf3Df9819mWfwl8N6SAZLq1P8A1zBk/wDQQa0YE8P6MP3FnPcMvqFjU/jyf0qHjK095Gsctw9L4Yo+bPBn7LE0zLutz+Ir1/wZ+zDa6TbrPdCKGJMEvIQij6k12s/jaeMbbO3tbFexVfMb824/QViX2oT6lN5lzNJO4HBkctgegz0H0qoSb1Zc420RqwXGheD4/Lsbf7fMvAbHlxA/U8t+Ax71j694lvNfO24l/dKcpCg2xJ9F9fc5PvUMnaoJurfSuqmcE9iCX731quTkfQ4qzJ99arM29WPvXZTOCoRSjhvzqvMNwNWZTw30qvP/AENd1M8+oV3OWH0qu44+tWXODVeQ4H0rupnnVUQSfd/Gq7jC/jU8p27vpUMpyD9a7qZ5lU//2Q==";
},function(t,e,i){"use strict";var r=i(1100),n=i(1458),a=i(1390),s=r.osg,fif(r),o=function(t){s.StateSet.call(this),this._colorUniform=s.Uniform.createFloat4(s.Vec4.createAndSet(1,0,0,0),"uColor"),t&&this._colorUniform.setFloat4(t),this._callbackColor=new n(this._colorUniform,1),this.init()};o.prototype=s.objectInherit(s.StateSet.prototype,{getColorUniform:function(){return this._colorUniform},setRenderBinVR:function(t){this.setRenderBinDetails(t?a.TRANSPARENT_BIN_NO_EARLYZ_POST:a.WIREFRAME,"RenderBin")},init:function(){this.setRenderBinDetails(a.WIREFRAME,"RenderBin"),this.setAttributeAndModes(new s.Depth(s.Depth.LEQUAL)),this.setAttributeAndModes(new s.BlendFunc(s.BlendFunc.ONE,s.BlendFunc.ONE_MINUS_SRC_ALPHA)),this.setShaderGeneratorName("wireframe"),this.addUniform(this._colorUniform),this.addUpdateCallback(this._callbackColor)},setWireframeColorSmooth:function(t){this._callbackColor.setColorTarget(t)},setWireframeColor:function(t){this._colorUniform.setFloat4(t)},setWireframeEnable:function(t,e){t?(this._callbackColor._finished===!0&&(this._colorUniform.setFloat3(e),this._colorUniform.getInternalArray()[3]=0),this._callbackColor.show(e[3])):this._callbackColor.hide()}}),t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(1454),a=i(1362),s=r.osg,fif(r),o=function(t,e){this._colorUniform=t,this._colorDelta=s.Vec4.create(),this._lastRatio=0,n.call(this,e),this._finished=!0,this._disableAfterFinished=!1,this._finishCallback=void 0,this._lastFrame=0};o.prototype=s.objectInherit(n.prototype,{hide:function(){s.Vec3.init(this._colorDelta)[3]=-this._colorUniform.getInternalArray()[3],this._disableAfterFinished=!0,this._lastRatio=0,this.reset()},show:function(t){s.Vec3.init(this._colorDelta)[3]=void 0!==t?t:1-this._colorUniform.getInternalArray()[3],this._disableAfterFinished=!1,this._lastRatio=0,this.reset()},setColorTarget:function(t){s.Vec4.sub(t,this._colorUniform.getInternalArray(),this._colorDelta),this._disableAfterFinished=!1,this._lastRatio=0,this.reset()},smoothStep:function(t){return t*t*(3-2*t)},setFinishCallback:function(t){this._finishCallback=t},finished:function(){this._disableAfterFinished===!0&&this._finishCallback&&this._finishCallback()},update:function(t,e){if(this._finished===!0)return!0;a.draw();var i=e.getFrameStamp(),r=i.getFrameNumber();if(this._lastFrame===r)return!0;this._lastFrame=r;var n=i.getSimulationTime(),s=this.interpolate(n,t,e);s=this.smoothStep(s);var o=s-this._lastRatio;this._lastRatio=s;var u=this._colorUniform.getInternalArray(),h=this._colorDelta;return u[0]+=h[0]*o,u[1]+=h[1]*o,u[2]+=h[2]*o,u[3]+=h[3]*o,!0}}),t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(1376),a=r.osg,fif(r),s=n.prototype,o=function(){n.apply(this,arguments),this.assignMatcapTexture(),this._outputs=[],this._index=o.DEFAULT},u=o;u.DIFFUSE=1,u.SPECULAR=2,u.ROUGHNESS=4,u.GEOMETRY=8,u.EMIT=16,u.ENVIRONMENT=32,u.MATCAP=64,u.WIREFRAME=128,u.DEFAULT=u.DIFFUSE|u.SPECULAR|u.ROUGHNESS|u.GEOMETRY|u.EMIT|u.ENVIRONMENT,o.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"Blending"},setOutputs:function(t,e){this._outputs[0]=t,this._outputs[1]=e},computeShader:function(t){return this._index=t,t&o.MATCAP?this.getMatcapFragment():this.getDefaultFragment()},createFragmentShaderGraph:function(){var t=this.computeShader(this._outputs[0]),e=this._outputs[1]!==this._outputs[0]?this.computeShader(this._outputs[1]):t,i=this.createVariable("vec3");return this.getNode("Blend").mode("MIX").inputs(t,e,this.getOrCreateUniform("float","uBlend")).outputs(i),[this.getFinalFrag(i)]},getDefaultFragment:function(){var t,e=this.createLighting(),i=this._index&u.ENVIRONMENT?this.getEnvironment():void 0;return e&&i?(t=this.createVariable("vec3"),this.getNode("Add").inputs(e,i).outputs(t)):t=e||i||this.getOrCreateConstantZero("vec3"),this._index&u.EMIT&&(t=this.applyEmissive(t)),t},getOrCreateMaterialDiffuseColor:function(){return this._index&u.DIFFUSE?s.getOrCreateMaterialDiffuseColor.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialSpecularColor:function(){return this._index&u.SPECULAR?s.getOrCreateMaterialSpecularColor.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialSpecularHardness:function(){return this._index&u.SPECULAR?s.getOrCreateMaterialSpecularHardness.call(this):this.getOrCreateConstantOne("float")},getOrCreateMaterialNormal:function(){return this._index&u.GEOMETRY?s.getOrCreateMaterialNormal.call(this):this.getOrCreateNormalizedNormal()},getMatcapFragment:function(){return this.getMatcapColor(this.getOrCreateMaterialNormal())}}),t.exports=o},function(t,e,i){"use strict";var r=i(1375),n=i(1461),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1376),a=r.osg,fif(r),s=function(){n.apply(this,arguments),this._isLighted=!1};s.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"Shadeless"},registerTextureMaterial:function(t,e){switch(t.getName()){case"AlphaMask":case"Opacity":case"DiffuseColor":case"EmitColor":case"DiffuseIntensity":n.prototype.registerTextureMaterial.call(this,t,e)}},registerTextureEnvironment:function(){},registerTextureShadow:function(){}}),t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(1375),a=i(1459),s=r.osg,fif(r),o=function(){n.apply(this,arguments),this._CompilerBlending=a,this._stackShader=[],this._indexShader=0,this._onSameShader=!0,this._gl=null};o.prototype=s.objectInherit(n.prototype,{setGraphicContext:function(t){this._gl=t},getNextIndexShader:function(){return this._indexShader===this._stackShader.length-1?0:this._indexShader+1},onSameShader:function(){this._onSameShader=!0},toNextShader:function(){this._indexShader=this.getNextIndexShader(),this._onSameShader=!1},getNextShader:function(){return this._stackShader[this.getNextIndexShader()]},getCurrentShader:function(){return this._stackShader[this._indexShader]},addShader:function(t){this._stackShader.push(t)},compileAllShaders:function(t,e,i,r){for(var n=this._stackShader,a=n.length,o=this._gl,u={getGraphicContext:function(){return o},applyProgram:function(){}},h=this.getShaderProcessor(),l=0,c=2*a;c>l;++l){var d=n[l%a],p=a>l?d:n[(l+1)%a],f=t+d+p;if(this._cache.has(f)!==!0){var g=new this._CompilerBlending(i,r,h);g.setOutputs(d,p);var m=g.createVertexShader(),v=g.createFragmentShader(),_=new s.Program(new s.Shader(s.Shader.VERTEX_SHADER,m),new s.Shader(s.Shader.FRAGMENT_SHADER,v));_.hash=f,_.setActiveUniforms(this.getActiveUniforms(e,i,r)),_.generated=!0,_.apply(u),this._cache.set(f,_)}}},getOrCreateProgram:function(t){var e=this.getNextShader(),i=this._onSameShader===!0?e:this.getCurrentShader(),r="",n=[],a=[];r+=this.getActiveAttributeList(t,n),r+=this.getActiveTextureAttributeList(t,a);var s=r+i+e,o=this._cache.get(s);return void 0!==o?o:(this.compileAllShaders(r,t,n,a),this._cache.get(s))}}),t.exports=o},function(t,e,i){"use strict";var r=i(1375),n=i(1464),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1376),a=i(1465),s=i(1466),o=r.osg,fif(r),u=r.osgShader,h=u.Compiler,l=u.nodeFactory;l.registerNodes(a),l.registerNodes(s);var c=function(){n.apply(this,arguments)};c.prototype=o.objectInherit(n.prototype,{getCompilerName:function(){return"PBR"},getTextureEnvironmentSpecular:function(){return this._texturesByName.TextureEnvironmentSpecularPBR},getTextureEnvironmentIntegrateBRDF:function(){return this._texturesByName.TextureEnvironmentIntegrateBRDF},getEnvironmentDiffuse:function(t,e){var i=this.getOrCreateUniform(e.diffuseSPH);i.globalDeclaration=function(){return"uniform vec3 "+i.getVariable()+"[9];"};var r=this.createVariable("vec3");this.getNode("DiffuseUE4v1").inputs({normal:this.getOrCreateMaterialNormal(),albedo:this.getOrCreateMaterialDiffusePBR(),envTransform:t,sphCoef:i}).outputs({color:r});var n=this.createVariable("vec3");return this.getNode("Mult").inputs(r,this.getOrCreateMaterialAOPBR()).outputs(n),n},getEnvironmentSpecular:function(t,e,i){var r;this.getTextureEnvironmentIntegrateBRDF()&&(r=this.getOrCreateSampler("sampler2D",i.textureIntegrateBRDF.getName()));var n={normal:this.getOrCreateMaterialNormal(),eye:this.getOrCreateNormalizedPosition(),roughness:this.getOrCreateMaterialRoughness(),specular:this.getOrCreateMaterialSpecularPBR(),envTransform:t,integrateBRDF:r,texSize:this.getOrCreateUniform(e.getOrCreateUniforms().size),frontNormal:this.getOrCreateNormalizedNormal(),lodRange:this.getOrCreateUniform(e.getOrCreateUniforms().lodRange)},a="";e.getIsCubemap()?(a="SpecularUE4v1Cubemap",n.texSpec=this.getOrCreateSampler("samplerCube",i.textureSpecularPBR.getName())):(a="SpecularUE4v1Panorama",n.texSpec=this.getOrCreateSampler("sampler2D",i.textureSpecularPBR.getName()));var s=this.createVariable("vec3");this.getNode(a).inputs(n).outputs({color:s});var o=this.createVariable("vec3");return this.getNode("Mult").inputs(s,this.getOrCreateMaterialAOSpecularPBR()).outputs(o),o},readChannel:function(t,e,i,r,a){var s=n.prototype.readChannel.apply(this,arguments);if(s)return s;switch(t){case"DiffusePBR":case"AlbedoPBR":case"SpecularPBR":s=this.createTextureChannelsRGB(e,i,r);break;case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"CavityPBR":s=this.createTextureChannelsR(e,i,r);break;case"AOPBR":s=this.createTextureChannelsAOPBR(e,i,r,a)}return s},createTextureChannelsAOPBR:function(t,e,i,r){var n=this.createTextureChannelsR(t,e,i);if(n){var a=t.getOrCreateUniforms(r).uOccludeSpecular;this._unifAOSpec=this.getOrCreateUniform(a.getType(),a.getName())}return n},getOrCreateMaterialSpecularF0:function(){var t=this.getVariable("materialSpecularf0");if(t)return t;t=this.createVariable("float","materialSpecularf0");var e=this.getOrCreateTextureChannel("SpecularF0");if(!e)return t.setValue("0.04");var i=this.createVariable("float").setValue("0.0"),r=this.createVariable("float").setValue("0.08");return this.getNode("Blend").mode("MIX").inputs(i,r,e).outputs(t),t},getOrCreateMaterialAOPBR:function(){return this.getOrCreateTextureChannelInvertWhiteFactor("AOPBR")||this.getOrCreateConstantOne("float")},getOrCreateMaterialAOSpecularPBR:function(){var t=this.getVariable("materialAO");if(t)return t;t=this.createVariable("float","materialAO");var e=this._unifAOSpec;return e?(this.getNode("SpecularOcclusion").inputs({occlude:e,ao:this.getOrCreateMaterialAOPBR(),normal:this.getOrCreateGeometryNormal(),eye:this.getOrCreateNormalizedPosition()}).outputs({ao:t}),t):t.setValue("1.0")},getOrCreateMaterialCavityPBR:function(){return this.getOrCreateTextureChannelInvertWhiteFactor("CavityPBR")||this.getOrCreateConstantOne("float")},getShadelessColor:function(){var t=this.createVariable("vec3"),e=this.getOrCreateTextureChannel("AlbedoPBR")||this.getOrCreateTextureChannel("DiffusePBR");return this.getNode("Mult").inputs(this.getVertexColor(e),this.getOrCreateMaterialAOPBR()).outputs(t),t},_getOrCreateMaterialAlbedo:function(){var t=this.getVariable("materialAlbedo");if(t)return t;t=this.createVariable("vec3","materialAlbedo");var e=this.getOrCreateTextureChannel("AlbedoPBR")||this.getOrCreateTextureChannel("DiffusePBR")||this.getOrCreateConstantZero("vec3");return this.getNode("SetFromNode").inputs(this.getVertexColor(e)).outputs(t),t},getOrCreateMaterialDiffusePBR:function(){var t=this.getVariable("materialDiffusePBR");if(t)return t;t=this.createVariable("vec3","materialDiffusePBR");var e=this.getOrCreateTextureChannel("MetalnessPBR");if(e){var i="%out = %albedo * (1.0 - %metal);";this.getNode("InlineCode").code(i).inputs({albedo:this._getOrCreateMaterialAlbedo(),metal:e}).outputs({out:t})}else this.getNode("SetFromNode").inputs(this._getOrCreateMaterialAlbedo()).outputs(t);return t},getOrCreateMaterialRoughness:function(){var t=this.getVariable("materialRoughness");if(t)return t;t=this.createVariable("float","materialRoughness");var e=this.getOrCreateTextureChannel("RoughnessPBR");e||(e=this.getOrCreateTextureChannel("GlossinessPBR"),e&&(e=this.getRoughnessFromGlossiness(e))),e=e?this.getMinRoughness(e):this.createVariable("float").setValue("0.2");var i=e;return this._texturesByName.NormalMap&&(i=this.createVariable("float"),this.getNode("AdjustRoughnessNmap").inputs({roughness:e,normal:this.getOrCreateNormalMap()}).outputs({roughness:i})),this.getNode("AdjustRoughnessGeometry").inputs({roughness:i,normal:this.getOrCreateNormalizedNormal()}).outputs({roughness:t}),t},getOrCreateMaterialSpecularPBR:function(){var t=this.getOrCreateTextureChannel("SpecularPBR");if(t)return t;var e=this.getVariable("materialSpecularPBR");if(e)return e;e=this.createVariable("vec3","materialSpecularPBR");var i=this.getOrCreateTextureChannel("MetalnessPBR");if(!i)return e.setValue("vec3(0.05)");var r="%out = mix( vec3(%f0), %albedo, %metal);";return this.getNode("InlineCode").code(r).inputs({metal:i,albedo:this._getOrCreateMaterialAlbedo(),f0:this.getOrCreateMaterialSpecularF0()}).outputs({out:e}),e},createCommonLightingVars:function(t,e){if(0===this._lights.length)return{};var i=n.prototype.createCommonLightingVars.call(this,t,e),r=this.createVariable("vec4","prepSpec");i.prepSpec=r;var a=o.objectMix({},t);return a.normal||(a.normal=this.getOrCreateMaterialNormal()),a.eyeVector||(a.eyeVector=this.getOrCreateNormalizedPosition()),this.getNode("PrepSpecLightPBR").inputs(a).outputs({prepSpec:r}),i},createLighting:function(){if(this._lights.length){var t={DIRECTION:"SunLightPBR",SPOT:"SpotLightPBR",POINT:"PointLightPBR",HEMI:"SunLightPBR"},e={};return e.materialambient=this.getOrCreateMaterialAmbient(),e.normal=this.getOrCreateMaterialNormal(),e.materialalbedopbr=this.getOrCreateMaterialDiffusePBR(),e.materialspecularf0=this.getOrCreateMaterialSpecularF0(),e.materialroughnesspbr=this.getOrCreateMaterialRoughness(),e.materialspecularpbr=this.getOrCreateMaterialSpecularPBR(),h.prototype.createLighting.call(this,e,t)}},getRoughnessFromGlossiness:function(t){var e=this.createVariable("float"),i="%out = 1.0 - %input;";return this.getNode("InlineCode").code(i).inputs({input:t}).outputs({out:e}),e},getMinRoughness:function(t){var e=this.createVariable("float"),i="%out = max(1.e-4, %input);";return this.getNode("InlineCode").code(i).inputs({input:t}).outputs({out:e}),e},getFinalFrag:function(t){var e=this.createVariable("vec3");return this.getNode("Mult").inputs(t,this.getOrCreateMaterialCavityPBR()).outputs(e),n.prototype.getFinalFrag.call(this,e)}}),t.exports=c},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=r.osgShader,s=a.node.NodeFunctions,o=a.utils,u=function(){s.apply(this)};u.prototype=n.objectInherit(s.prototype,{validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "lightsPBR.glsl"'}});var h=function(t){return"vec4"===t.getType()?t.getVariable()+".rgb":t},l=function(){u.apply(this)};l.prototype=n.objectInherit(u.prototype,{type:"PointLightPBR",validInputs:["normal","eyeVector","materialalbedopbr","prepSpec","materialspecularpbr","lightdiffuse","lightposition","lightattenuation","lightmatrix","lighted","lightEyePos","lightEyeDir","lightNDL"],computeShader:function(){return o.callFunction("computePointLightPBRShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,this._inputs.materialalbedopbr,this._inputs.prepSpec,this._inputs.materialspecularpbr,h(this._inputs.lightdiffuse),this._inputs.lightposition,this._inputs.lightattenuation,this._inputs.lightmatrix,this._inputs.lightEyePos,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var c=function(){u.apply(this)};c.prototype=n.objectInherit(u.prototype,{type:"SpotLightPBR",validInputs:["normal","eyeVector","materialalbedopbr","prepSpec","materialspecularpbr","lightdiffuse","lightdirection","lightattenuation","lightposition","lightspotCutOff","lightspotBlend","lightmatrix","lightinvMatrix","lighted","lightEyePos","lightEyeDir","lightNDL"],computeShader:function(){return o.callFunction("computeSpotLightPBRShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,this._inputs.materialalbedopbr,this._inputs.prepSpec,this._inputs.materialspecularpbr,h(this._inputs.lightdiffuse),this._inputs.lightdirection,this._inputs.lightattenuation,this._inputs.lightposition,this._inputs.lightspotCutOff,this._inputs.lightspotBlend,this._inputs.lightmatrix,this._inputs.lightinvMatrix,this._inputs.lightEyePos,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var d=function(){u.apply(this)};d.prototype=n.objectInherit(u.prototype,{type:"SunLightPBR",validInputs:["normal","eyeVector","materialalbedopbr","prepSpec","materialspecularpbr","lightdiffuse","lightposition","lightmatrix","lighted","lightEyeDir","lightNDL"],computeShader:function(){return o.callFunction("computeSunLightPBRShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,this._inputs.materialalbedopbr,this._inputs.prepSpec,this._inputs.materialspecularpbr,h(this._inputs.lightdiffuse),this._inputs.lightposition,this._inputs.lightmatrix,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var p=function(){s.apply(this)};p.prototype=n.objectInherit(s.prototype,{type:"prepSpecLightPBR",validInputs:["normal","eyeVector","materialroughnesspbr"],validOutputs:["prepSpec"],globalFunctionDeclaration:function(){return'#pragma include "lightsPBR.glsl"'},computeShader:function(){return o.callFunction("LightingFuncPrep",this._outputs.prepSpec,[this._inputs.normal,this._inputs.eyeVector,this._inputs.materialroughnesspbr])}}),t.exports={PrepSpecLightPBR:p,PointLightPBR:l,SpotLightPBR:c,SunLightPBR:d}},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=r.osgShader,s=a.node.NodeFunctions,o=a.utils,u=function(){s.apply(this)};u.prototype=n.objectInherit(s.prototype,{type:"DiffuseUE4v1",validInputs:["normal","albedo","envTransform","sphCoef"],validOutputs:["color"],computeShader:function(){var t=this._inputs;return o.callFunction("computeIBLDiffuseUE4",this._outputs.color,[t.normal,t.albedo,t.envTransform,t.sphCoef])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}});var h=function(){s.apply(this)};h.prototype=n.objectInherit(s.prototype,{type:"SpecularUE4v1Panorama",validInputs:["normal","eye","roughness","specular","envTransform","texSpec","lodRange","texSize","frontNormal"],validOutputs:["color"],computeShader:function(){var t=this._inputs,e=[t.normal,t.eye,t.roughness,t.specular,t.envTransform,t.texSpec,t.lodRange,t.texSize,t.frontNormal];return t.integrateBRDF&&e.push(t.integrateBRDF),o.callFunction("computeIBLSpecularUE4",this._outputs.color,e)},isMobileString:function(){return this._inputs.integrateBRDF?"":"#define MOBILE"},getDefines:function(){return[this.isMobileString(),"#define PANORAMA"]},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}});var l=function(){h.apply(this)};l.prototype=n.objectInherit(h.prototype,{type:"SpecularUE4v1Cubemap",getDefines:function(){return[this.isMobileString(),"#define CUBEMAP"]},getExtensions:function(){return["#extension GL_EXT_shader_texture_lod : require"]}});var c=function(){s.apply(this)};c.prototype=n.objectInherit(s.prototype,{type:"EnvironmentTransformPBR",validInputs:["inTransform"],validOutputs:["outTransform"],computeShader:function(){return o.callFunction("environmentTransformPBR",this._outputs.outTransform,[this._inputs.inTransform])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}});var d=function(){s.apply(this)};d.prototype=n.objectInherit(s.prototype,{type:"AdjustRoughnessNmap",validInputs:["roughness","normal"],validOutputs:["roughness"],computeShader:function(){return o.callFunction("adjustRoughnessNormalMap",this._outputs.roughness,[this._inputs.roughness,this._inputs.normal])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}});var p=function(){s.apply(this)};p.prototype=n.objectInherit(s.prototype,{type:"AdjustRoughnessGeometry",validInputs:["roughness","normal"],validOutputs:["roughness"],computeShader:function(){return o.callFunction("adjustRoughnessGeometry",this._outputs.roughness,[this._inputs.roughness,this._inputs.normal])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}});var f=function(){s.apply(this)};f.prototype=n.objectInherit(s.prototype,{type:"SpecularOcclusion",validInputs:["occlude","ao","normal","eye"],validOutputs:["ao"],computeShader:function(){var t=this._inputs;return o.callFunction("specularOcclusion",this._outputs.ao,[t.occlude,t.ao,t.normal,t.eye])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}}),t.exports={DiffuseUE4v1:u,SpecularUE4v1Panorama:h,SpecularUE4v1Cubemap:l,EnvironmentTransformPBR:c,AdjustRoughnessNmap:d,AdjustRoughnessGeometry:p,SpecularOcclusion:f}},function(t,e,i){"use strict";var r=i(1463),n=i(1468),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1464),a=r.osg,fif(r),s=function(){n.apply(this,arguments),this._isLighted=!1};s.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"ShadelessPBR"},registerTextureMaterial:function(t,e){switch(t.getName()){case"AlphaMask":case"Opacity":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":case"CavityPBR":case"AOPBR":n.prototype.registerTextureMaterial.call(this,t,e)}},registerTextureEnvironment:function(){},registerTextureShadow:function(){}}),t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(1463),a=i(1462),s=i(1470),o=r.osg,fif(r),u=function(){n.apply(this,arguments),this._CompilerBlending=s,this._stackShader=[],this._indexShader=0,this._onSameShader=!0,this._gl=null},h=a.prototype;u.prototype=o.objectInherit(n.prototype,{setGraphicContext:h.setGraphicContext,getNextIndexShader:h.getNextIndexShader,onSameShader:h.onSameShader,toNextShader:h.toNextShader,getNextShader:h.getNextShader,getCurrentShader:h.getCurrentShader,addShader:h.addShader,compileAllShaders:h.compileAllShaders,getOrCreateProgram:h.getOrCreateProgram}),t.exports=u},function(t,e,i){"use strict";var r=i(1100),n=i(1459),a=i(1464),s=r.osg,fif(r),o=n,u=o.prototype,h=a.prototype,l=function(){a.apply(this,arguments),this.assignMatcapTexture(),this._outputs=[],this._index=o.DEFAULT};l.prototype=s.objectInherit(a.prototype,{getCompilerName:function(){return"BlendingPBR"},_getOrCreateMaterialAlbedo:function(){return this._index&o.DIFFUSE?h._getOrCreateMaterialAlbedo.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialDiffusePBR:function(){return this._index&o.DIFFUSE?h.getOrCreateMaterialDiffusePBR.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialRoughness:function(){return this._index&o.ROUGHNESS?h.getOrCreateMaterialRoughness.call(this):this.getOrCreateConstant("float","defRough").setValue("0.2")},getOrCreateMaterialSpecularPBR:function(){return this._index&o.SPECULAR?h.getOrCreateMaterialSpecularPBR.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialSpecularF0:function(){return this._index&o.SPECULAR?h.getOrCreateMaterialSpecularF0.call(this):this.getOrCreateConstant("float","defF0").setValue("0.04")},setOutputs:u.setOutputs,computeShader:u.computeShader,createFragmentShaderGraph:u.createFragmentShaderGraph,getDefaultFragment:u.getDefaultFragment,getMatcapFragment:u.getMatcapFragment,getOrCreateMaterialNormal:u.getOrCreateMaterialNormal}),t.exports=l},function(t,e,i){"use strict";var r=i(1375),n=i(1472),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1376),a=r.osg,fif(r),s=function(){n.apply(this,arguments),this._isLighted=!1,this._isVertexColored=!1,this.assignMatcapTexture()};s.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"Matcap"},registerTextureMaterial:function(t,e){switch(t.getName()){case"AlphaMask":case"Opacity":case"NormalMap":case"BumpMap":n.prototype.registerTextureMaterial.call(this,t,e)}},registerTextureEnvironment:function(){},registerTextureShadow:function(){},createFragmentShaderGraph:function(){var t=this.getMatcapColor(this.getOrCreateGeometryNormal());return[this.getFinalFrag(t)]},declareVertexTransforms:function(t){this.declareVertexTransformLighted(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(1375),n=i(1474),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1376),a=r.osg,fif(r),s=function(){n.apply(this,arguments),this._isVertexColored=!1};s.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"Wireframe"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("InlineCode").code("%out = vec4( %color.rgb * %color.a, %color.a);").inputs({color:this.getOrCreateUniform("vec4","uColor")}).outputs({out:t}),[t]},declareVertexTransforms:function(t){var e=this.createVariable("vec4");this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","ModelViewMatrix"),vec:this.getOrCreateVertexAttribute()}).outputs({vec:e});var i=this.createVariable("vec4");this.getNode("InlineCode").code("%out = %pos; %out[3] += 0.005 / %proj[1][1];").inputs({proj:this.getOrCreateUniform("mat4","ProjectionMatrix"),pos:e}).outputs({out:i}),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","ProjectionMatrix"),vec:i}).outputs({vec:t})}}),t.exports=s},function(t,e,i){"use strict";var r=i(1097),n=i(1476),a=i(1477),s={FeatureName:"fov",ModelType:n,ViewListType:[a]};t.exports=r.create(s)},function(t,e,i){"use strict";var r=i(239),n=r.extend({defaults:{fov:45},getName:function(){return"Fov"},init:function(t){var e=t.getModel().get("options");e.scene&&e.scene.fov&&this.set("fov",e.scene.fov)},getJSON:function(){return{fov:this.get("fov")}}});t.exports=n},function(t,e,i){"use strict";var r=i(1100),n=i(258),a=i(1362),s=r.osg,fif(r),o=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),this.model.bind("change:fov",this.onFovChanged,this),this._dolly=!1,this.onFovChanged(),this._dolly=!0},onFovChanged:function(){var t=this.options.context.getViewer(),e=t.getCamera(),i=e.getViewport(),r=i.width()/i.height();if(s.Matrix.makePerspective(this.model.get("fov"),r,1,1e3,e.getProjectionMatrix()),this._dolly){var n=this.options.context.getViewer().getViewerOSGJS().getManipulator(),o=n.getCurrentManipulator();if(o){var u=o.getHomeBound();u&&n.setDistance(o.getHomeDistance(u))}}var h=t.getFeatures().manipulator;h&&h.getModel().saveCameraPosition(),a.draw()}});t.exports=o},function(t,e,i){"use strict";var r=i(1097),n=i(1479),a=i(1480),s={FeatureName:"quality",ModelType:n,ViewListType:[a]};t.exports=r.create(s)},function(t,e,i){"use strict";var r=i(284),n=i(239),a=i(1341),s=i(1093),o=n.extend({defaults:function(){var t=1;return r.any?t=0:s()&&(t=2),{level:t}},getBudget:function(){var t=a();return void 0!==t.pixelBudget?0===t.pixelBudget?1/0:t.pixelBudget:this.getBudgetFromLevel(this.get("level"))},getBudgetFromLevel:function(t){return 0===t?2048:1===t?8192:1/0},getName:function(){return"Quality"}});t.exports=o},function(t,e,i){"use strict";var r=i(258),n=i(1341),a=i(1360),s=function(t){return 0===(t&t-1)},o=function(t){return 1<<Math.floor(Math.log2(t))},u=function(t){return 1<<Math.ceil(Math.log2(t))},h=function(t){if(s(t))return t;var e=o(t);return t/e-1>.75?u(t):e},l=r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments);var t=this.options.context;this._viewer=t.getViewer(),this._fMaterial=t.getFeatures().material,this._version=t.getModel().get("options").version,this.model.bind("change:level",this.onLevelChanged,this),this.model.bind("updateTexelPolicy",this.updateTexelPolicy,this),this._qualityReady=!1,this._maxSize=a(1/0)},getMaterials:function(){return this._fMaterial.getModel().attributes},onLevelChanged:function(){this.updateTexelPolicy();var t=this._fMaterial._views[0];this._viewer.setFakeSecondaryProgress(t.requestAllHighResTextures(this._fMaterial.getModel().attributes),0),this._fMaterial._views[0].cleanAndApplyMaterials()},getOrCreateTexelInfos:function(){return this._fMaterial._views[0].getOrCreateTexelInfos()},getMaxSizeFromBudget:function(t){var e=t*t,i=this.getOrCreateTexelInfos();if(0===i.count||i.size<=e)return this._maxSize;var r=Math.min(this._maxSize,Math.sqrt(e/i.count));return r=h(r),this._version<2&&(1024>r?r=512:r>=1024&&2048>r&&(r=2048)),i.max<=r||i.size<=r*r?this._maxSize:r},updateTexelPolicy:function(){var t=this.getOrCreateTexelInfos();0===t.count||t.missingResolution||(this._qualityReady||(this._qualityReady=!0,this.initAvailableQuality()),n().maxTextureSize=this.getMaxSizeFromBudget(this.model.getBudget()))},initAvailableQuality:function(){var t=this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(0)),e=this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(1)),i={low:!0,mid:e!==t,high:e!==this._maxSize},r=this.model.get("level");i.high||2!==r||(r=1),i.mid||1!==r||(r=0),this.model.off(null,this.onLevelChanged,this),this.model.set("level",r),this.model.on("change:level",this.onLevelChanged,this),this.model.trigger("qualityReady",i)}});t.exports=l},function(t,e,i){"use strict";var r=i(1097),n=i(1482),a=i(1483),s={FeatureName:"autospin",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNode=function(){return this._views[0]._nodeAutospin},t.exports=o},function(t,e,i){"use strict";var r=i(235),n=i(1341),a=r.Model.extend({defaults:{enable:!1,paused:!1,speed:.6},getName:function(){return"Autospin"},init:function(){var t=n();void 0!==t.autospin&&(this.set("enable",!!t.autospin),this.set("speed",t.autospin))}});t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(258),a=i(1484),s=r.osg,fif(r),o=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:enable",this.onEnableChanged,this),t.bind("change:paused",this.onPausedChanged,this),t.bind("change:speed",this.onSpeedChanged,this),this._nodeAutospin=new s.MatrixTransform,this._nodeAutospin.setName("Feature - Autospin"),this._callbackAutospin=new a(t.get("speed"),1,1),this._nodeAutospin.addUpdateCallback(this._callbackAutospin),t.get("enable")===!1&&this._callbackAutospin.deactivate()},onEnableChanged:function(){this.model.get("enable")===!0?this._callbackAutospin.resume():this._callbackAutospin.deactivate()},onPausedChanged:function(){this.model.get("enable")!==!1&&(this.model.get("paused")===!0?this._callbackAutospin.pause():this._callbackAutospin.resume())},onSpeedChanged:function(){this._callbackAutospin.setSpeed(this.model.get("speed"))}});t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(1362),a=r.osg,fif(r),s=function(t,e,i){this._speed=void 0!==t?t:-.6,this._fadeStart=void 0!==e?e:2,this._fadeEnd=void 0!==i?i:2,this._enable=!0,this._rotation=0,this._lastTime=-1,this._startTime=0,this._endTime=0,this._checkIfFinished=!1};s.prototype={setSpeed:function(t){this._speed=t},setFadeStart:function(t){this._fadeStart=t},setFadeEnd:function(t){this._fadeEnd=t},deactivate:function(){this._enable=!1},resume:function(){this._enable=!0,this._checkIfFinished=!1;var t=Math.max((this._endTime-this._lastTime)/this._fadeEnd,0);this._startTime=this._lastTime-this._fadeStart*t,this._endTime=this._lastTime,n.draw()},pause:function(){var t=Math.min((this._lastTime-this._startTime)/this._fadeStart,1);this._endTime=this._lastTime+this._fadeEnd*t,this._checkIfFinished=!0},smoothStep:function(t){return t*t*(3-2*t)},update:function(){var t=a.Matrix.create();return function(e,i){if(this._enable===!1)return!0;n.draw();var r=i.getFrameStamp().getSimulationTime();if(this._checkIfFinished===!0&&this._endTime<r)return this._enable=!1,this._checkIfFinished=!1,this._lastTime=-1,!0;if(this._lastTime<0)return this._lastTime=r,this._startTime=r,!0;var s=r-this._lastTime;this._lastTime=r,this._endTime>r?this._rotation+=s*this.smoothStep((this._endTime-r)/this._fadeEnd):r-this._startTime<this._fadeStart?this._rotation+=s*this.smoothStep((r-this._startTime)/this._fadeStart):this._rotation+=s;
var o=e.getMatrix();a.Matrix.makeRotate(-this._rotation*this._speed,0,0,1,o);var u=e.getChildren();if(u.length>0){var h=u[0].getMinimumBound().center(),l=h[0],c=h[1],d=h[2];a.Matrix.makeTranslate(-l,-c,-d,t),a.Matrix.preMult(o,t),a.Matrix.makeTranslate(l,c,d,t),a.Matrix.postMult(t,o)}return e.dirtyBound(),!0}}()},t.exports=s},function(t,e,i){"use strict";var r=i(1097),n=i(1486),a=i(1487),s={FeatureName:"orientation",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNode=function(){return this._views[0]._nodeOrientation},o.prototype.getNodeGrid=function(){return this._views[0]._nodeGrid},t.exports=o},function(t,e,i){"use strict";var r=i(235),n=i(1100),a=n.osg,fif(n),s=r.Model.extend({defaults:{matrix:a.Matrix.create(),showGizmo:!1},getName:function(){return"Orientation"},init:function(t){var e=t.getModel().get("options").orientation.matrix;e&&this.set("matrix",e)},getJSON:function(){return{matrix:this.get("matrix")}}});t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(258),a=i(1488),s=i(1489),o=r.osg,fif(r),u=r.osgUtil,h=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:matrix",this.onMatrixChanged,this),t.bind("change:showGizmo",this.onGizmoShowChanged,this),t.bind("turn",this.onTurn,this),t.bind("reset",this.onReset,this);var e=this.options.context;this._viewer=e.getViewer();var i=this._viewer.getViewerOSGJS().getManipulator();this._nodeGrid=new s,this._nodeGrid.setName("Node grid"),this._nodeOrientation=new o.MatrixTransform,this._nodeOrientation.setName("Feature - Orientation"),this._nodeOrientation.addChild(this._nodeGrid),this._nodeGizmo=new o.MatrixTransform,this._nodeGizmo.setCullingActive(!1),this._nodeGizmo.editMask=u.NodeGizmo.PICK_ARC,this._gizmoTra=new o.MatrixTransform,this._gizmoTra.setReferenceFrame(o.Transform.ABSOLUTE_RF),this._gizmoTra.addChild(this._nodeGizmo),this._callbackOrientation=new a(i,.5,this,e.getScene().getRoot()),this._nodeOrientation.addUpdateCallback(this._callbackOrientation),this._callbackOrientation.rotateNode(this._nodeOrientation);var r=this.model.get("matrix");this._nodeOrientation.setMatrix(r),o.Matrix.makeRotateFromQuat(o.Matrix.getRotate(r,o.Quat.create()),this._nodeGizmo.getMatrix())},onReset:function(){o.Matrix.setRotateFromQuat(this.model.get("matrix"),o.Quat.identity),this.onMatrixChanged()},onTurn:function(t,e){var i="right"===e?1:-1,r="x"===t?i:0,n="y"===t?i:0,a="z"===t?i:0,s=o.Matrix.makeRotate(-Math.PI/2,r,n,a,o.Matrix.create());o.Matrix.postMult(s,this.model.get("matrix")),this.onMatrixChanged()},onGizmoShowChanged:function(){var t=this.model.get("showGizmo"),e=this._viewer.getFeaturesManager();if(e){var i=e.getNodeGizmo();i&&(o.Matrix.makeRotateFromQuat(o.Matrix.getRotate(this.model.get("matrix"),o.Quat.create()),this._nodeGizmo.getMatrix()),i.setForcePicking(t),i.setRotateInLocal(!t),i.setTranslateInLocal(!t),i.attachToMatrixTransform(t?this._nodeGizmo:null),this._nodeGrid.showGridTemporary(t?0:5),this._callbackOrientation.setGizmoMode(t))}},onMatrixChanged:function(){this.model.get("showGizmo")||this._nodeGrid.showGridTemporary(5);var t=this._callbackOrientation;t.setQuatTarget(o.Matrix.getRotate(this.model.get("matrix"),o.Quat.create()))}});t.exports=h},function(t,e,i){"use strict";var r=i(1100),n=i(1454),a=i(1362),s=r.osg,fif(r),o=function(t,e,i,r){this._model=i.model,this._manipulator=t,this._applyWithoutTranslation=!1,this._quatCurrent=s.Matrix.getRotate(this._model.get("matrix"),s.Quat.create()),this._quatTarget=s.Quat.create(),this._quatStart=s.Quat.create(),this._nodeGrid=i._nodeGrid,n.call(this,e),this._finished=!0,this._nodeGizmo=i._nodeGizmo,this._gizmoTra=i._gizmoTra,this._gizmoMode=!1,this._rootModel=r,this._features=i.options.context.getFeatures()};o.prototype=s.objectInherit(n.prototype,{setQuatTarget:function(t){s.Quat.copy(this._quatCurrent,this._quatStart),s.Quat.copy(t,this._quatTarget),this.reset(),this._gizmoMode=!1},setGizmoMode:function(t){this._gizmoMode=t},getQuatTarget:function(){return this._quatTarget},getQuatStart:function(){return this._quatStart},smoothStep:function(t){return t*t*(3-2*t)},update:function(t,e){if(this._gizmoMode)return s.Matrix.getRotate(this._nodeGizmo.getMatrix(),this._quatCurrent),this.rotateNode(t),!0;if(this._finished)return!0;a.draw();var i=e.getFrameStamp().getSimulationTime(),r=this.interpolate(i,t,e);return r=this.smoothStep(r),s.Quat.slerp(r,this._quatStart,this._quatTarget,this._quatCurrent),this.rotateNode(t),this._finished&&(s.Matrix.makeRotateFromQuat(this._quatCurrent,this._nodeGizmo.getMatrix()),this._gizmoMode=this._model.get("showGizmo")),!0},rotateNode:function(){var t=s.Matrix.create();return function(e){var i=e.getMatrix();s.Matrix.makeRotateFromQuat(this._quatCurrent,i);var r=this._gizmoTra.getMatrix(),n=this._rootModel.getMinimumBound(),a=n.center(),o=a[0],u=a[1],h=a[2];if(s.Matrix.makeTranslate(-o,-u,-h,r),s.Matrix.preMult(i,r),s.Matrix.makeTranslate(o,u,h,r),s.Matrix.postMult(r,i),this._nodeGrid){s.Matrix.inverse(i,t);var l=this._nodeGrid.getMatrix(),c=s.Matrix.create(),d=n.radius();s.Matrix.makeScale(d,d,d,c),s.Matrix.makeTranslate(a[0],a[1],a[2],l),s.Matrix.preMult(l,c),s.Matrix.postMult(t,l)}this.updateShadows(),e.dirtyBound()}}(),updateShadows:function(){var t=this._features.lighting;if(t)for(var e=t.getModel().get("lights"),i=0,r=e.length;r>i;++i)e[i].dirty()}}),t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(1458),a=i(1490),s=i(1491),o=i(1492),u=i(1493),h=i(1494),l=i(1388),c=i(1390),d=r.osg,fif(r),p=function(){var t=a(),e={"orientation-grid-vert":s+"\n #define SHADER_NAME Grid\n","orientation-grid-frag":o+"\n #define SHADER_NAME Grid\n"};t.addShaders(e);var i=new d.Program(new d.Shader(d.Shader.VERTEX_SHADER,t.getShader("orientation-grid-vert")),new d.Shader(d.Shader.FRAGMENT_SHADER,t.getShader("orientation-grid-frag")));return i},f=function(){var t=a(),e={"orientation-axis-vert":u+"\n #define SHADER_NAME OrientationAxis\n","orientation-axis-frag":h+"\n #define SHADER_NAME OrientationAxis\n"};t.addShaders(e);var i=new d.Program(new d.Shader(d.Shader.VERTEX_SHADER,t.getShader("orientation-axis-vert")),new d.Shader(d.Shader.FRAGMENT_SHADER,t.getShader("orientation-axis-frag")));return i},g=function(t){d.MatrixTransform.call(this),this._colorUniform=d.Uniform.createFloat4(d.Vec4.createAndSet(.5,.5,.5,0),"uColor"),t&&d.Vec4.copy(t,this._colorUniform.get()),this._callbackColor=new n(this._colorUniform,1),this._timeGrid=0,this.init()};g.prototype=d.objectInherit(d.MatrixTransform.prototype,{init:function(){this._visible=!1,this.addChild(d.createGridGeometry(-1,-1,0,2,0,0,0,2,0,10,10)),this.addChild(d.createAxisGeometry(1)),this._boundingSphereComputed=!0,this._boundingBoxComputed=!0;var t=this.getOrCreateStateSet();t.setAttributeAndModes(new d.Depth(d.Depth.LEQUAL)),t.setAttributeAndModes(new d.BlendFunc(d.BlendFunc.ONE,d.BlendFunc.ONE_MINUS_SRC_ALPHA)),t.setRenderBinDetails(c.GRID,"RenderBin"),t.addUniform(this._colorUniform),t.setAttributeAndModes(p()),this.getChildren()[1].getOrCreateStateSet().setAttributeAndModes(f()),this.addUpdateCallback(this._callbackColor),this.setNodeMask(0)},showGridTemporary:function(t){this._visible=!0,this.setNodeMask(l.NO_PICK_NO_SHADOW),this._callbackColor.show(),window.clearTimeout(this._timeGrid),t&&(this._timeGrid=window.setTimeout(this.hideGrid.bind(this),1e3*t))},isVisible:function(){return this._visible},hideGrid:function(){this._timeGrid=0,this._visible=!1,this._callbackColor.hide()}}),t.exports=g},function(t,e,i){"use strict";var r=i(1100),n=new r.osgShader.ShaderProcessor,a=function(){return n};t.exports=a},function(t,e){t.exports="attribute vec3 Vertex;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);\n}\n"},function(t,e){t.exports="uniform vec4 uColor;\n\nvoid main(void) {\n  gl_FragColor = vec4(uColor.xyz * uColor.a, uColor.a);\n}\n"},function(t,e){t.exports="attribute vec3 Vertex;\nattribute vec4 Color;\nvarying vec4 vColor;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvoid main(void) {\n    vColor = Color;\n    gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);\n}\n"},function(t,e){t.exports="uniform vec4 uColor;\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vec4( vec3(vColor) * uColor.a, uColor.a);\n}\n"},function(t,e,i){"use strict";var r=i(1097),n=i(1496),a=i(1497),s={FeatureName:"cameraAnimation",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNode=function(){return this._views[0]._nodeCameraAnimation},t.exports=o},function(t,e,i){"use strict";var r=i(235),n=i(1100),a=n.osg,fif(n),s=r.Model.extend({defaults:{eye:a.Vec3.create(),target:a.Vec3.create(),duration:1},getName:function(){return"Camera animation"},setTargetAndEye:function(t,e,i){return this.set("target",t),this.set("eye",e),this.trigger("setTargetAndEye",i)}});t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(258),a=i(1498),s=r.osg,fif(r),o=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:duration",this.onDurationChanged,this),t.bind("setTargetAndEye",this.onTargetAndEyeChanged,this);var e=this.options.context.getViewer().getViewerOSGJS().getManipulator();this._callbackCameraAnimation=new a(e,t.get("duration")),this._nodeCameraAnimation=new s.Node,this._nodeCameraAnimation.setName("Feature - CameraAnimation"),this._nodeCameraAnimation.addUpdateCallback(this._callbackCameraAnimation)},onDurationChanged:function(){this._callbackCameraAnimation.setDuration(this.model.get("duration"))},onTargetAndEyeChanged:function(t){this._callbackCameraAnimation.setTargetAndEye(this.model.get("target"),this.model.get("eye"),t)}});t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(1361),a=i(1454),s=i(1394),o=i(1362),u=r.osg,fif(r),h=r.osgAnimation,l=function(t,e){this._fpsDist=-1,this._manipulator=t,this._eyeEnd=u.Vec3.create(),this._eyeDeltaLen=0,this._targetEnd=u.Vec3.create(),this._targetDeltaLen=0,this._lastRatio=0,this._preventFlip=!1,a.call(this,e),this._finished=!0};l.prototype=u.objectInherit(a.prototype,{setTargetAndEye:function(){var t=u.Vec3.create();return function(e,i,r){if(this._preventFlip=r,this._finished){var n=this._manipulator.getManipulatorList()[s.FPS];this._fpsDist=n.getDistance()}u.Vec3.copy(i,this._eyeEnd),this._manipulator.getEyePosition(t),this._eyeDeltaLen=u.Vec3.length(u.Vec3.sub(i,t,t)),u.Vec3.copy(e,this._targetEnd),this._manipulator.getTarget(t),this._targetDeltaLen=u.Vec3.length(u.Vec3.sub(e,t,t)),this._lastRatio=0,this.reset()}}(),update:function(){var t=u.Vec3.create(),e=u.Vec3.create(),i=u.Vec3.create(),r=u.Vec3.create();return function(a,l){if(this._finished===!0)return!0;o.draw();var c=this._manipulator,d=c.getCurrentManipulatorIndex();d===s.FPS&&c.setManipulatorIndex(s.ORBIT);var p=l.getFrameStamp().getSimulationTime(),f=this.interpolate(p,a,l);f=h.easeOutQuart(f);var g=f-this._lastRatio;this._lastRatio=f;var m=this._manipulator;if(m.getEyePosition(t),m.getTarget(e),u.Vec3.sub(this._targetEnd,e,i),u.Vec3.normalize(i,i),u.Vec3.add(e,u.Vec3.mult(i,g*this._targetDeltaLen,r),r),m.setTarget(r),u.Vec3.sub(this._eyeEnd,t,i),u.Vec3.normalize(i,i),u.Vec3.add(t,u.Vec3.mult(i,g*this._eyeDeltaLen,r),r),m.setEyePosition(r,this._preventFlip),d===s.FPS){var v=c.getDistance();c.setManipulatorIndex(d),c.getCurrentManipulator().setDistance(this._finished?this._fpsDist:v)}return this._finished===!0&&n.resolvePromise(),!0}}()}),t.exports=l},function(t,e,i){"use strict";var r=i(219),n=i(1097),a=i(1500),s=i(1505),o={FeatureName:"environment",ModelType:a,ViewListType:[s]},u=n.create(o);u.prototype=r.extend({},n.prototype,{getNode:function(){return this._views[0].getNodeEnvironment()}}),t.exports=u},function(t,e,i){"use strict";var r=i(235),n=i(1501),a=i(1503),s=i(1413),o=i(1504),u=r.Model.extend({_trashbin:[],getRandomEnvironment:function(){var t=[{uid:"591b2c2db5744df1803a09d477f5a2c7",brightness:2.1385},{uid:"2fa15e0b1cee45a5b02605a288934e1b",brightness:4.063},{uid:"16cdcddf277d423d99094f8db0c731e9",brightness:2.0569},{uid:"956bb00775a044e7afdd1c17f6bdab63",brightness:2.246},{uid:"d348dfd2a8104ab0b8528f885d645eb3",brightness:2.1402}];return t[Math.round(Math.random()*(t.length-1))]},defaults:function(){var t=this.getRandomEnvironment();return{enable:s(),exposure:t.brightness,backgroundEnable:!1,backgroundExposure:1,rotation:0,uid:t.uid,blur:.1}},init:function(t){this._context=t,this._viewer=t.getViewer();var e=t.getModel().get("options").environment;e&&(void 0!==e.enable&&this.set("enable",e.enable),void 0!==e.exposure&&this.set("exposure",e.exposure),void 0!==e.rotation&&this.set("rotation",e.rotation),void 0!==e.uid&&this.set("uid",e.uid),void 0!==e.blur&&this.set("blur",e.blur),void 0!==e.backgroundExposure&&this.set("backgroundExposure",e.backgroundExposure));var i=t.getModel().get("user").uid;this.environmentCollection=this.createCollection(i),this.environmentCollection.fetch({remove:!1}),this.checkEnvironmentValidity(),s()&&this._viewer.getPromisePolygon().then(this.updateEnvironmentConfig.bind(this))},updateEnvironmentConfig:function(){var t=this.getEnvironment();if(t){var e=o(this._viewer.getRootUserData().source)[t.get("uid")];e?(this.set("exposure",parseFloat(e.environmentExposure)),this.set("backgroundExposure",parseFloat(e.brightness)),this.set("rotation",parseFloat(e.rotation))):this.set("exposure",parseFloat(t.get("brightness"))||1);var i=this._viewer.getRootUserData();s()&&"Tilt Brush"===i.authoringTool&&(this.set("uid","3e2ad3e1f1ea47679f045a7eb0e6af49"),this.set("exposure",.5))}},getEnvironmentCollection:function(){return this.environmentCollection},checkEnvironmentValidity:function(){var t=this.getEnvironmentCollection(),e=this.get("uid"),i=t.find(function(t){return e===t.get("uid")});if(!i){var r=this._context.getModel().get("uid"),n=parseInt(r.toLowerCase(),16)||0,a=t.at(n%t.length);a?this.set("uid",a.get("uid")):this.set("enable",!1)}},createCollection:function(t){return new n([],{filters:new a({userUID:t})})},getName:function(){return"Environment"},setEnvironment:function(t){return this.setEnvironmentUID(t.uid)},setEnvironmentUID:function(t){t&&this.set("uid",t)},getEnvironment:function(){var t=this.get("uid");return this.environmentCollection.find(function(e){return e.get("uid")===t})},getJSON:function(){var t={};return t.uid=this.get("uid"),t.enable=this.get("enable"),t.exposure=this.get("exposure"),t.rotation=this.get("rotation"),t.blur=this.get("blur"),t.backgroundExposure=this.get("backgroundExposure"),t}});t.exports=u},function(t,e,i){"use strict";var r=i(1502),n=i(248);t.exports=n.extend({model:r,url:function(){return"undefined"==typeof this.options.filters?"/i/environments":"/i/users/"+this.options.filters.get("userUID")+"/environments"}})},function(t,e,i){"use strict";var r=i(219),n=i(239),a=i(312);t.exports=n.extend(r.extend({},a,{url:function(){return"/i/environments/"+this.get("uid")}}))},247,function(t,e){"use strict";var i={"2e9c3708feb74137b0436f946b8b66b8":{rotation:1.6,environmentExposure:4.27,brightness:1.12},"5efd61a025f6400886ab975e2ac3d9c5":{rotation:3.15,environmentExposure:1.19,brightness:1.21},"80fba9759ab94307a782f38d359b8ea8":{rotation:1.57,environmentExposure:14.19,brightness:1},"268447ca0a954f44b06d1387863d114e":{rotation:6.25,environmentExposure:2.1,brightness:1},"003c1543cd754a19a0e14bc89726ccf5":{rotation:1.82,environmentExposure:1,brightness:1},"3e2ad3e1f1ea47679f045a7eb0e6af49":{rotation:.3,environmentExposure:.59,brightness:1},"2fa15e0b1cee45a5b02605a288934e1b ":{rotation:.68,environmentExposure:4,brightness:1},"9190e8da70694ef3b9d1d0c01541917e":{rotation:3.24,environmentExposure:2.5,brightness:.57},"749a0594343e4ff9a2875cb411d0ad1a":{rotation:4.73,environmentExposure:.5,brightness:1},f2dabeb04674446696486eea67028bd8:{rotation:4.71,environmentExposure:.76,brightness:1.5},df380da788ee444885722735039b0c09:{rotation:.27,environmentExposure:1.4,brightness:1.46},"16cdcddf277d423d99094f8db0c731e9":{rotation:3.73,environmentExposure:2.4,brightness:.53},c281dff366844cbc8b33179337037f42:{rotation:3.64,environmentExposure:7,brightness:.53}},r={substancepainter:i},n={},a=function(t){return r[t]||n};t.exports=a},function(t,e,i){"use strict";var r=i(219),n=i(284),a=i(236),s=i(1100),o=i(258),u=i(1361),h=i(1506),l=i(1099),c=i(1345),d=i(1420),p=i(1341),f=i(1362),g=p().panorama,m=s.osg,fif(s),v=o.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),this._viewer=this.options.context.getViewer(),this._environment=new h,this._environment.setName("Feature - Environment"),this._backgroundLoaded={},this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change:exposure",this.onExposureChanged,this),this.model.bind("change:backgroundExposure",this.onExposureChanged,this),this.model.bind("change:rotation",this.onRotationChanged,this),this.model.bind("change:uid",this.onUIDChanged,this),this.model.bind("change:backgroundEnable",this.onBackgroundEnableChanged,this),this.model.bind("change:blur",this.onBlurChanged,this),d.bind("change:mask",this.onEnvironmentChanged,this),this.model.bind("change",f.draw),this.initEnvironment(),this.initRotateEnvironment()},initEnvironment:function(){this.model.get("enable")&&(this.resourceDefer=a.defer(),this.options.context.getScene().addResourcePromise(this.resourceDefer.promise)),this.onRotationChanged(),this.onExposureChanged(),this.onEnableChanged()},initRotateEnvironment:function(){if(this._viewer.getViewerOSGJS()){this._mouseKeyboard=this._viewer.getViewerOSGJS().getEventProxy().StandardMouseKeyboard,this._rotEnv=!1,this.mx_=0;var t=this.options.context.getViewer().getCanvas();t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("mouseout",this.onMouseUp.bind(this)),t.addEventListener("mousemove",this.onMouseMove.bind(this)),this._viewer.getPromiseModelDisplayed().then(this.initOnTriplePan.bind(this))}},initOnTriplePan:function(){var t=this._viewer.getViewerOSGJS().getEventProxy();if(t.Hammer&&t.Hammer._hammer){var e=t.Hammer._hammer,i=e.handlers.panstart,r=e.handlers.panmove,n=e.handlers.panend,a=e.handlers.pinchend;if(1===i.length&&1===r.length&&1===n.length&&1===a.length){var s=i[0],o=r[0],u=n[0],h=a[0];e.off("panstart",s),e.off("panmove",o),e.off("panmove",u),this._evProxy={altKey:!0,shiftKey:!1,ctrlKey:!1},e.on("panstart",this.onPanStart.bind(this,s)),e.on("panmove",this.onPanMove.bind(this,o,h)),e.on("panend",this.onPanEnd.bind(this,u))}}},onPanStart:function(t,e){return e.pointers.length<3?t(e):(this._evProxy.pageX=e.center.x,void this.onMouseDown(this._evProxy))},onPanMove:function(t,e,i){return i.pointers.length<3?t(i):(this._evProxy.pageX=i.center.x,this._rotEnv||(this.onMouseDown(this._evProxy),e(i)),void this.onMouseMove(this._evProxy))},onPanEnd:function(t,e){this.onMouseUp(),t(e)},onMouseDown:function(t){t.altKey&&(this._rotEnv=!0,this._mouseKeyboard.setEnable(!1),this.mx_=t.pageX)},onMouseMove:function(){var t=m.Matrix.create(),e=m.Matrix.create();return function(i){if(this._rotEnv){var r=!i.ctrlKey,n=!i.shiftKey;f.draw();var a=(i.pageX-this.mx_)/100;if(this.mx_=i.pageX,r){var s=(this.model.get("rotation")+a)%(2*Math.PI);this.model.set("rotation",0>s?s+2*Math.PI:s)}if(n){var o=this.options.context,u=o.getFeatures().lighting;if(!u)return;var h=o.getScene().getRoot().getMinimumBound().center();m.Matrix.makeRotate(-a%(2*Math.PI),0,0,1,t),m.Matrix.preMult(t,m.Matrix.makeTranslate(-h[0],-h[1],-h[2],e)),m.Matrix.postMult(m.Matrix.makeTranslate(h[0],h[1],h[2],e),t);for(var l=u.getModel().get("lights"),c=0,d=l.length;d>c;++c){var p=l[c];p.isAttachedToCamera()||(m.Matrix.postMult(t,p.get("matrix")),p.dirty())}}}}}(),onMouseUp:function(){this._rotEnv=!1},onUIDChanged:function(){this.model.updateEnvironmentConfig(),this.onEnvironmentChanged()},getNodeEnvironment:function(){return this._environment},getResourceManager:function(){return this._resourceManager||l.instance},onEnableChanged:function(){this.model.get("enable")?this._environment.enable():this._environment.disable(),this.onEnvironmentChanged()},onExposureChanged:function(){this._environment.setExposure(this.model.get("exposure")),this._environment.setBackgroundExposure(this.model.get("backgroundExposure"))},onRotationChanged:function(){this._environment.updateRotation(this.model.get("rotation"))},onBlurChanged:function(){this.abortLastDownloadEnv(),this.model.get("backgroundEnable")&&this.onBackgroundEnableChanged()},onBackgroundEnableChanged:function(){return this.model.get("backgroundEnable")?this.setBackground():void 0},onEnvironmentChanged:function(){var t=this.getEnvironment();t&&this.model.get("enable")&&(this.onlyLowRes=!0,this.setEnvironment(t).then(function(){t.get("uid")===this.model.get("uid")&&(this.onlyLowRes=!1,this.setEnvironment(t))}.bind(this)))},getEnvironment:function(){return this.model.getEnvironment()},getName:function(){return"Environment3D"},abortLastDownloadEnv:function(){for(var t=this.model.get("uid"),e=this.model.get("blur"),i=this.getResourceManager()._resourceLoader._processing,r=0,n=i.length;n>r;++r){var a=i[r],s=a.getXHR();s&&(void 0!==a._envUID&&a._envUID!==t&&s.abort(),void 0!==a._envBlur&&a._envBlur!==e&&s.abort())}},setEnvironment:function(t){if(!t)return a.reject();this.abortLastDownloadEnv();var e=[];if(d.get("mask")&d.LIT){var i=d.get("mask")&d.PBR;this._environment.setIsPBR(i),this._environment.setDiffuseSPH(t.get("diffuseSPH")),i?this.setEnvironmentPBR(t,e):this.setEnvironmentOld(t,e)}return this.model.get("backgroundEnable")&&e.push(this.onBackgroundEnableChanged()),0===e.length&&e.push(a.resolve()),this.wrapPromises(e)},setEnvironmentPBR:function(t,e){var i=this._environment,a=t.get("textures"),s=!1;m.WebGLCaps.instance().getWebGLExtension("EXT_shader_texture_lod")&&(s=!0),g&&(s=!1);var o=r.find(a,{encoding:"luv",type:"specular_ue4",format:s?"cubemap":"panorama"}),u=this.getImageRes(o),h={cubemap:s,panoramaLUV:!s,cubemapLUV:s,size:u.width,minFilter:s?m.Texture.LINEAR_MIPMAP_LINEAR:m.Texture.LINEAR,magFilter:m.Texture.LINEAR,wrapS:m.Texture.CLAMP_TO_EDGE,wrapT:m.Texture.CLAMP_TO_EDGE,transferToGPU:!0},l=this.getResourceManager().getOrCreateTexture(u.file,h);this.markLastXHR(this.model.get("uid")),l.texture.setFlipY(!s);var c=this.getPromiseTexture(l);if(c.then(i.setSpecularPBRTexture.bind(i,l.texture,o.limitSize)),e.push(c),!n.any){var d=r.find(a,{type:"brdf_ue4"});h={integrateBRDFLUV:!0,minFilter:m.Texture.NEAREST,magFilter:m.Texture.NEAREST,wrapS:m.Texture.CLAMP_TO_EDGE,wrapT:m.Texture.CLAMP_TO_EDGE,transferToGPU:!0};var p=this.getResourceManager().getOrCreateTexture(this.getImageRes(d).file,h);this.markLastXHR(this.model.get("uid")),p.texture.setFlipY(!1);var f=this.getPromiseTexture(p);f.then(i.setIntegrateBRDFTexture.bind(i,p.texture)),e.push(f)}},getBackgroundResource:function(t,e,i){var n,a=r.find(t,{encoding:"luv",type:"background",format:"cubemap"});return n=void 0!==i?this.getClosestBlur(a,i):this.getImageRes(a,512),e.cubemap=!0,e.cubemapLUV=!0,e.size=n.width,e.minFilter=m.Texture.LINEAR,e.magFilter=m.Texture.LINEAR,e.wrapS=m.Texture.CLAMP_TO_EDGE,e.wrapT=m.Texture.CLAMP_TO_EDGE,e.transferToGPU=!0,n},setEnvironmentOld:function(t,e){var i=this._environment,r={},n=this.getBackgroundResource(t.get("textures"),r),a=this.getResourceManager().getOrCreateTexture(n.file,r);this.markLastXHR(this.model.get("uid"));var s=this.getPromiseTexture(a);s.then(i.setSpecularTexture.bind(i,a.texture)),e.push(s)},setBackground:function(){var t=this.getEnvironment();if(!t)return a.reject();var e={},i=this.getBackgroundResource(t.get("textures"),e,this.model.get("blur")),r=this._backgroundLoaded;if(this.getRequestLowRes()){if(r[i.file])return a.reject();i=this.getBackgroundResource(t.get("textures"),e,1)}var n=this._environment,s=this.getResourceManager().getOrCreateTexture(i.file,e);this.markLastXHR(this.model.get("uid"),this.model.get("blur"));var o=this.getPromiseTexture(s);return o.then(function(){n.setBackgroundTexture(s.texture,i.width),r[i.file]=s.texture}),this._viewer.getPromiseHighResLoaded().then(this._viewer.setFakeSecondaryProgress.bind(this._viewer,o,0)),o},markLastXHR:function(t,e){var i=this.getResourceManager()._resourceLoader._processing;if(i.length>0){var r=i[i.length-1];r._envUID=t,void 0===e||this.getRequestLowRes()||(r._envBlur=e)}},wrapPromises:function(t){var e=a.settle(t);return this.resourceDefer&&(e["finally"](this.resourceDefer.resolve.bind(this.resourceDefer)),this.resourceDefer=void 0),this._viewer.getPromiseHighResLoaded().then(this._viewer.setFakeSecondaryProgress.bind(this._viewer,e,0)),e},getPromiseTexture:function(t){return this.onlyLowRes?t.promise:a.all([t.promise,u.getPromise()])},getRequestLowRes:function(){return this.onlyLowRes&&!p().preload},getImageRes:function(t,e){var i=new c(t);if(this.getRequestLowRes())return i.findImageSmallest();var r=void 0!==e?e:1/0;return i.findImageNearestPowerOfTwoUpToResolution(r,r)},getClosestBlur:function(t,e){for(var i=t.images,r=0,n=1/0,a=0,s=i.length;s>a;++a){var o=Math.abs(i[a].blur-e);n>o&&(r=a,n=o)}return i[r]}});t.exports=v},function(t,e,i){"use strict";var r=i(1100),n=i(1507),a=i(1511),s=i(1512),o=i(1388),u=r.osg,fif(r),h=function(){u.Node.call(this),this._isPBR=!1,this._textureSpecular=void 0,this._textureSpecularUnit=6,this._textureSpecularPBR=void 0,this._textureIntegrateBRDF=void 0,this._textureSpecularPBRUnit=6,this._textureIntegrateBRDFUnit=8,this._environmentBackground=new n,this._uniforms=s(),this._adjustRotation=u.Matrix.makeRotate(Math.PI/2,1,0,0,u.Matrix.create()),this._root=new u.MatrixTransform,u.Matrix.preMult(this._root.getMatrix(),this._adjustRotation),this.getOrCreateStateSet()};h.prototype=u.objectInherit(u.Node.prototype,{getBackground:function(){return this._environmentBackground},getUniforms:function(){return this._uniforms},createCameraNode:function(){var t={},e=this,i=function(){this.cull=function(i,r){u.Matrix.getPerspective(e._mainCamera.getProjectionMatrix(),t),u.Matrix.makePerspective(t.fovy,t.aspectRatio,1,1e3,r.getCurrentProjectionMatrix()),u.Matrix.copy(e._mainCamera.getViewMatrix(),r.getCurrentModelViewMatrix()),u.Matrix.setTrans(r.getCurrentModelViewMatrix(),0,0,0);var n=r.getCurrentModelViewMatrix();return u.Matrix.mult(n,e._root.getMatrix(),e._uniforms.environmentTransform.getInternalArray()),!0}},r=new u.Camera;return r.setName("Environment - Camera"),r.setCullCallback(new i),r.setReferenceFrame(u.Transform.ABSOLUTE_RF),r},init:function(t){this._mainCamera=t,this._uniforms.getKeys().forEach(function(t){var e=this._uniforms[t];this.getStateSet().addUniform(e)}.bind(this));var e=this.createCameraNode();e.setNodeMask(o.NO_PICK_NO_SHADOW),this.addChild(e),e.addChild(this._root),this._root.addChild(this._environmentBackground),this.updateTextureUnits()},enable:function(){this.setTexturesStateSet()},removeTexturesStateSet:function(){var t=this.getStateSet();t&&(this._isPBR?(this._textureSpecularPBR&&t.removeTextureAttribute(this._textureSpecularPBRUnit,this._textureSpecularPBR.getTypeMember()),this._textureIntegrateBRDF&&t.removeTextureAttribute(this._textureIntegrateBRDFUnit,this._textureIntegrateBRDF.getTypeMember())):this._textureSpecular&&t.removeTextureAttribute(this._textureSpecularUnit,this._textureSpecular.getTypeMember()))},setTexturesStateSet:function(){var t=this.getStateSet();t&&(this._isPBR?(this._textureSpecularPBR&&t.setTextureAttributeAndModes(this._textureSpecularPBRUnit,this._textureSpecularPBR),this._textureIntegrateBRDF&&t.setTextureAttributeAndModes(this._textureIntegrateBRDFUnit,this._textureIntegrateBRDF)):this._textureSpecular&&t.setTextureAttributeAndModes(this._textureSpecularUnit,this._textureSpecular))},hide:function(){this.removeTexturesStateSet()},disable:function(){this.hide()},setExposure:function(t){this._uniforms.exposure.setFloat(t)},setBackgroundExposure:function(t){this._environmentBackground.setExposure(t)},updateRotation:function(t){u.Matrix.makeRotate(-t,0,0,1,this._root.getMatrix()),u.Matrix.preMult(this._root.getMatrix(),this._adjustRotation)},setBackgroundTexture:function(t,e){this._environmentBackground.setEnvironment(t,e)},showBackground:function(){this._environmentBackground.showEnvironment()},hideBackground:function(){this._environmentBackground.hide()},setDiffuseSPH:function(t){this.getUniforms().diffuseSPH.setInternalArray(this.initSPH(t))},setSpecularTexture:function(t){this._textureSpecular=new a(t,"Specular"),this.updateTextureUnits(),this.getUniforms().textureSpecular.setInt(this._textureSpecularUnit)},setSpecularPBRTexture:function(t,e){this._textureSpecularPBR=new a(t,"SpecularPBR");var i="TextureCubeMap"===t.className();this._textureSpecularPBR.setIsCubemap(i),this._textureSpecularPBR.updateLodRange(e),this.updateTextureUnits(),this.getUniforms().textureSpecularPBR.setInt(this._textureSpecularPBRUnit)},setIntegrateBRDFTexture:function(t){this._textureIntegrateBRDF=new a(t,"IntegrateBRDF"),this.updateTextureUnits(),this.getUniforms().textureIntegrateBRDF.setInt(this._textureIntegrateBRDFUnit)},updateTextureUnits:function(){this.setTexturesStateSet()},setIsPBR:function(t){this._isPBR=t},initSPH:function(t){for(var e=1/(2*Math.sqrt(Math.PI)),i=-(.5*Math.sqrt(3/Math.PI)),r=-i,n=i,a=.5*Math.sqrt(15/Math.PI),s=-a,o=.25*Math.sqrt(5/Math.PI),u=s,h=.25*Math.sqrt(15/Math.PI),l=[e,e,e,i,i,i,r,r,r,n,n,n,a,a,a,s,s,s,o,o,o,u,u,u,h,h,h],c=t.slice(0,27),d=0;27>d;++d)c[d]*=l[d];return c}}),t.exports=h},function(t,e,i){"use strict";var r=i(1100),n=i(1490),a=i(1508),s=i(1509),o=i(1510),u=i(1390),h=i(1362),l=r.osg,fif(r),c=5,d=function(){l.Node.call(this),this._geometry=l.createTexturedBoxGeometry(0,0,0,c,c,c),this._uniforms=o(),this._show="NONE",this._bgEnv=null,this._bgFixed=null,this._texRatio=1,this._canvasWidth=1,this._canvasHidth=1,this.init(),this.hide()};d.prototype=l.objectInherit(l.Node.prototype,{init:function(){var t=this._geometry,e=t.getOrCreateStateSet();e.setAttributeAndModes(new l.Depth(l.Depth.LEQUAL,1,1,!1),l.StateAttribute.PROTECTED),e.setRenderBinDetails(u.BACKGROUND,"RenderBin"),e.setAttributeAndModes(this.createShader());for(var i=this._uniforms,r=Object.keys(i),n=0,a=r.length;a>n;++n)e.addUniform(i[r[n]]);this.addChild(t)},getUniforms:function(){return this._uniforms},createShader:function(){var t={"environment-background-vert":a,"environment-background-frag":s};n().addShaders(t);var e=n(),i="\n#define SHADER_NAME Environment";return new l.Program(new l.Shader(l.Shader.VERTEX_SHADER,e.getShader("environment-background-vert")+i),new l.Shader(l.Shader.FRAGMENT_SHADER,e.getShader("environment-background-frag")+i))},rescale:function(t,e){t&&(this._canvasWidth=t),e&&(this._canvasHeight=e);var i=this._canvasWidth/this._canvasHeight,r=this._uniforms.scale.getInternalArray();i>=this._texRatio?(r[0]=1,r[1]=this._texRatio/i):(r[0]=i/this._texRatio,r[1]=1)},getBackground:function(){return this._bgFixed},getEnvironment:function(){return this._bgEnv},hide:function(){this._show="NONE",this._update()},showColor:function(){this._show="COLOR",this._update()},showEnvironment:function(){this._show="ENV",this._update()},setEnvironment:function(t,e){this._bgEnv=t,void 0!==e&&this._uniforms.size.setFloat(e),this._update()},setExposure:function(t){this._uniforms.backgroundExposure.setFloat(t)},showBackground:function(){this._show="FIXED",this._update()},setBackground:function(t){this._texRatio=t.getWidth()/t.getHeight(),this._bgFixed=t,this._update()},_update:function(){return h.draw(),"ENV"!==this._show?void this._geometry.setNodeMask(0):(this._geometry.setNodeMask(-1),void(this._bgEnv&&this._geometry.getOrCreateStateSet().setTextureAttributeAndModes(0,this._bgEnv)))}}),t.exports=d},function(t,e){t.exports="attribute vec3 Vertex;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\n\nuniform vec4 uHalton;\nuniform vec2 RenderSize;\n\nvarying vec3 vFragVertex;\n\nvoid main(void)\n{\n    vFragVertex = Vertex.rgb;\n\n    mat4 projectionMatrix = ProjectionMatrix;\n    vec2 halt = (abs(uHalton.z) == 2.0 ? 1.0 : 0.0) * (uHalton.xy / RenderSize);\n    projectionMatrix[2][0] += halt.x;\n    projectionMatrix[2][1] += halt.y;\n\n    gl_Position = (projectionMatrix * (ModelViewMatrix * vec4(Vertex, 1.0))).xyww;\n}\n";
},function(t,e){t.exports='varying vec3 vFragVertex;\n\n// common stuffs\nuniform int uOutputLinear;\nuniform float uRGBMRange;\n\nuniform samplerCube uTexture0;\nuniform float uEnvironmentExposure;\nuniform float uBackgroundExposure;\nuniform float uSize;\n\n#pragma include "functions.glsl"\n#pragma include "sketchfabTextures.glsl"\n\nvoid main(void) {\n\n  vec3 color = textureCubeFixed( uTexture0, normalize( vFragVertex.xyz ), uSize ) * uEnvironmentExposure * uBackgroundExposure;\n\n  if( uOutputLinear == 0 )\n    color = linearTosRGB(color);\n\n  gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n'},function(t,e,i){"use strict";var r,n=i(1100),a=n.osg,fif(n),s=function(){if(r)return r;var t={texture0:a.Uniform.createInt1(0,"uTexture0"),backgroundExposure:a.Uniform.createFloat(1,"uBackgroundExposure"),size:a.Uniform.createFloat(1,"uSize"),color:a.Uniform.createFloat3(a.Vec3.createAndSet(0,0,1),"uBackgroundColor"),scale:a.Uniform.createFloat2(a.Vec2.createAndSet(1,1),"uFixedScale")};return r=new a.Map(t)};t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(1512),a=r.osg,fif(r),s=function(t,e){this._texture=t,this._channel=e||"Specular",this._isCubemap=!1,this._commonUniforms=n()};s.uniforms={},s.prototype=a.objectLibraryClass(a.objectInherit(a.Texture.prototype,{attributeType:"Texture",channelType:["Specular","SpecularPBR","IntegrateBRDF"],getUniformName:function(t){return"uTextureEnvironment"+this.getChannel()+t},getOrCreateUniforms:function(){var t=s.uniforms,e=this.getChannel();if(!t[e]){var i=this._texture,r={size:a.Uniform.createFloat2([i.getWidth(),i.getHeight()],this.getUniformName("TextureSize"))};t[e]=new a.Map(r)}return t[e]},setIsCubemap:function(t){this._isCubemap=t},getIsCubemap:function(){return this._isCubemap},getCommonUniforms:function(){return this._commonUniforms},getTexture:function(){return this._texture},getChannel:function(){return this._channel},cloneType:function(){return new s(new a.Texture)},getHash:function(){return"osgSketchfabTextureEnvironment"+this.getChannel()},updateLodRange:function(t){var e=this.getOrCreateUniforms(),i=Math.log(this._texture.getWidth())/Math.LN2,r=i-Math.log(t)/Math.LN2;if(e.lodRange){var n=e.lodRange.getInternalArray();n[0]=i,n[1]=r}else e.lodRange=a.Uniform.createFloat2([i,r],this.getUniformName("LodRange"))},apply:function(t,e){var i=this._texture;void 0!==i&&i.apply(t);var r=this.getOrCreateUniforms(e),n=r.size.getInternalArray();n[0]=i.getWidth(),n[1]=i.getHeight()}}),"osgSketchfab","TextureEnvironment"),t.exports=s},function(t,e,i){"use strict";var r,n=i(1100),a=n.osg,fif(n),s=function(){if(r)return r;var t={environmentTransform:a.Uniform.createMatrix4(a.Matrix.create(),"uEnvironmentTransform"),exposure:a.Uniform.createFloat1(1,"uEnvironmentExposure"),diffuseSPH:a.Uniform.createFloat3Array(new Float32Array(27),"uDiffuseSPH"),textureSpecular:a.Uniform.createInt1(7,"sEnvironmentSpecular"),textureSpecularPBR:a.Uniform.createInt1(6,"sSpecularPBR"),textureIntegrateBRDF:a.Uniform.createInt1(7,"sIntegrateBRDF")};return r=new a.Map(t)};t.exports=s},function(t,e,i){"use strict";var r=i(1097),n=i(1514),a=i(1515),s={FeatureName:"outline",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNode=function(){return this._views[0]._nodeOutline},t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(235),a=r.osg,fif(r),s=n.Model.extend({defaults:{color:a.Vec3.createAndSet(1,0,1)},getName:function(){return"Outline"}});t.exports=s},function(t,e,i){"use strict";var r=i(258),n=i(1516),a=i(1517),s=r.extend({initialize:function(){r.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:color",this.onColorChanged,this);var e=this.options.context.getViewer().getViewerOSGJS();e.getState().getShaderGeneratorProxy().addShaderGenerator("outline",new a),this._nodeOutline=new n(e,t.get("color")),this._nodeOutline.setName("Feature - Outline")},onColorChanged:function(){this._nodeOutline.setColor(this.model.get("color"))}});t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(1388),a=i(1390),s=i(1357),o=i(1362),u=r.osg,fif(r),h=r.osgUtil,l=function(t,e){u.Node.call(this),this._viewer=t,this._color=void 0!==e?e:u.Vec3.createAndSet(1,0,1),this._timeoutDuration=1e4,this._nodeProxy=new u.Node,this._outlineScene=new u.Node,this._timer=void 0,this._sobel=void 0,this._paths=void 0,this._width=t.getCanvasWidth(),this._height=t.getCanvasHeight(),this.init()};l.prototype=u.objectInherit(u.Node.prototype,{setColor:function(t){this._color=t},clearOutlineScene:function(){for(var t=this._outlineScene,e=t.getChildren(),i=0,r=e.length;r>i;++i)e[i].removeChildren();t.removeChildren()},setScene:function(){var t=function(t){this._path=t};return t.prototype={update:function(t){return t.setMatrix(u.computeLocalToWorld(this._path)),!0}},function(e){this.clearOutlineScene();for(var i=this._outlineScene,r=0,n=e.length;n>r;++r){var a=e[r],o=new u.MatrixTransform;i.addChild(o),o.addChild(a[a.length-1]),s.checkPathIsAnimated(a)?o.addUpdateCallback(new t(a)):o.setMatrix(u.computeLocalToWorld(a))}}}(),hideOutline:function(){this._nodeProxy.setNodeMask(0),void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},showOutline:function(){this._nodeProxy.setNodeMask(n.NO_PICK_NO_SHADOW),void 0!==this._timer&&clearTimeout(this._timer);var t=this;this._timer=setTimeout(function(){t._timer=void 0,t._nodeProxy.setNodeMask(0),o.draw()},this._timeoutDuration)},getOrCreateTextureRTT:function(){var t=this._viewer,e=t.getCanvasWidth(),i=t.getCanvasHeight();if(this.textureRTT)return this.textureRTT.setTextureSize(e,i),this.textureRTT;var r=this.textureRTT=new u.Texture;return r.setTextureSize(e,i),r.setInternalFormat(u.Texture.RGBA),r.setMinFilter(u.Texture.NEAREST),r.setMagFilter(u.Texture.NEAREST),r},createCamera:function(t){var e=this.createSubGraphRTT(t);return e.getOrCreateStateSet().setShaderGeneratorName("outline",u.StateAttribute.OVERRIDE|u.StateAttribute.ON),e.setName("Outline Camera"),e},createSubGraphRTT:function(t){var e=this.getOrCreateTextureRTT(),i=new u.Camera;return i.setViewport(new u.Viewport(0,0,e.getWidth(),e.getHeight())),i.setClearColor(u.Vec4.create()),i.setRenderOrder(u.Camera.PRE_RENDER,0),i.attachTexture(u.FrameBufferObject.COLOR_ATTACHMENT0,e),i.attachRenderBuffer(u.FrameBufferObject.DEPTH_ATTACHMENT,u.FrameBufferObject.DEPTH_COMPONENT16),i.addChild(t),i},createComposer:function(t){var e=new h.Composer;return e.addPass(new h.Composer.Filter.InputTexture(this.getOrCreateTextureRTT())),e.addPass(t),e.renderToScreen(this._viewer.getCanvasWidth(),this._viewer.getCanvasHeight()),e.build(),e},createRttAndComposer:function(t){var e=this.createCamera(this._outlineScene);this._nodeProxy.addChild(e),this._nodeProxy.addChild(this.createComposer(t))},init:function(){this.addChild(this._nodeProxy),this._nodeProxy.setNodeMask(0);var t=new u.CullFace(u.CullFace.DISABLE);this._outlineScene.getOrCreateStateSet().setAttributeAndModes(t,u.StateAttribute.OVERRIDE|u.StateAttribute.ON);var e=this._sobel=new h.Composer.Filter.SobelFilter;e.setColor(this._color),e.setFactor(.25),e.getOrCreateStateSet().setAttributeAndModes(new u.BlendFunc(u.BlendFunc.ONE,u.BlendFunc.ONE_MINUS_SRC_ALPHA)),e.getOrCreateStateSet().setRenderBinDetails(a.OUTLINE,"RenderBin"),this.createRttAndComposer(e),this._nodeProxy.addUpdateCallback(this)},update:function(t){var e=this._viewer;if(e.getCanvasWidth()===this._width&&e.getCanvasHeight()===this._height)return!0;this._width=e.getCanvasWidth(),this._height=e.getCanvasHeight();var i=t.getChildren(),r=i[0],n=this.getOrCreateTextureRTT();return r.setViewport(new u.Viewport(0,0,n.getWidth(),n.getHeight())),r.attachTexture(u.FrameBufferObject.COLOR_ATTACHMENT0,n),t.removeChild(i[1]),t.addChild(this.createComposer(this._sobel)),!0}}),t.exports=l},function(t,e,i){"use strict";var r=i(1375),n=i(1518),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(1387),a=r.osg,fif(r),s=function(){n.apply(this,arguments)};s.prototype=a.objectInherit(n.prototype,{getCompilerName:function(){return"Outline"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.createVariable("vec4").setValue("vec4(1.0, 0.0, 1.0, 1.0)"),e=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(t).outputs(e),[e]}}),t.exports=s},function(t,e,i){"use strict";var r=i(1097),n=i(1520),a=i(1521),s={FeatureName:"ground",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNodeGround=function(){return this._views[0]._nodeGround},o.prototype.getNodeQuad=function(){return this._views[0]._nodeQuad},t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(239),a=r.osg,fif(r),s=n.extend({defaults:{enable:!1,color:a.Vec4.createAndSet(.8,.8,.8,.8),hardness:.5,size:10,height:0},getName:function(){return"Ground"},init:function(t){this._autoHeight=!1;var e=t.getModel().get("options");e.scene&&e.scene.ground&&this.set(e.scene.ground)},getJSON:function(){return{enable:this.get("enable"),height:this.get("height"),color:this.get("color"),hardness:this.get("hardness"),size:this.get("size")}}});t.exports=s},function(t,e,i){"use strict";var r=i(1100),n=i(258),a=i(1388),s=i(1454),o=i(1362),u=r.osg,fif(r),h=function(t,e,i){s.call(this,t),this._unif=e,this._show=!0,this._node=i};h.prototype=u.objectInherit(s.prototype,{setEnable:function(t){this.reset(),this._show=t,(t||0!==this._node.getNodeMask())&&this._node.setNodeMask(a.NO_PICK_NO_SHADOW)},finished:function(t){t.setNodeMask(this._show?a.NO_PICK_NO_SHADOW:0)},update:function(t,e){if(this._finished)return!0;o.draw();var i=e.getFrameStamp().getSimulationTime(),r=this.interpolate(i,t,e);return this._unif.setFloat(this._show?r:1-r),!0}});var l=function(t){u.StateAttribute.call(this),this._enable=!t};l.prototype=u.objectLibraryClass(u.objectInherit(u.StateAttribute.prototype,{attributeType:"SketchfabGround",cloneType:function(){return new l(!0)},getHash:function(){return"SketchfabGround"+this._enable},getEnable:function(){return this._enable}}),"osgSketchfab","Ground");var c=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:enable",this.onEnableChanged,this),t.bind("change:color",this.onColorChanged,this),t.bind("change:hardness",this.onHardnessChanged,this),t.bind("change:height",this.onMatrixChanged,this),t.bind("change:size",this.onMatrixChanged,this),t.bind("change",o.draw),this._nodeGround=new u.Node,this._nodeGround.setName("Feature - Ground"),this._nodeQuad=new u.MatrixTransform,this._nodeQuad.setName("Ground - Quad"),this._nodeQuad.setNodeMask(0),this._nodeQuad.addChild(u.createTexturedQuadGeometry(-1,-1,0,2,0,0,0,2,0)),this._color=u.Uniform.createFloat4([.7,.7,.7,1],"uColor"),this._hardness=u.Uniform.createFloat(0,"uHardness"),this._anim=u.Uniform.createFloat(0,"uAnim");var e=this._nodeQuad.getOrCreateStateSet();e.setAttributeAndModes(new u.BlendFunc(u.BlendFunc.ONE,u.BlendFunc.ONE_MINUS_SRC_ALPHA)),e.setAttributeAndModes(new l),e.addUniform(this._color),e.addUniform(this._hardness),e.addUniform(this._anim),this._nodeQuad._boundingSphereComputed=!0,this._nodeQuad._boundingBoxComputed=!0,this._updateCB=new h(.5,this._anim,this._nodeQuad),this._nodeQuad.addUpdateCallback(this._updateCB),this.options.context.getViewer().getPromiseModelDisplayed().then(this.onGroundChanged.bind(this))},onGroundChanged:function(){this.onEnableChanged(),this.onColorChanged(),this.onHardnessChanged(),this.onMatrixChanged()},onEnableChanged:function(){this._updateCB.setEnable(this.model.get("enable"))},onColorChanged:function(){this._color.setFloat3(this.model.get("color"))},onHardnessChanged:function(){this._hardness.setFloat(this.model.get("hardness"))},onMatrixChanged:function(){var t=u.Vec3.create();return function(){var e=this._nodeGround.children[0];if(e){var i=new u.ComputeBoundsVisitor;i.apply(e);var r=i.getBoundingBox();r.center(t);var n=r.radius()*this.model.get("size"),a=this._nodeQuad.getMatrix(),s=u.Matrix.create();u.Matrix.makeScale(n,n,1,s),u.Matrix.makeTranslate(t[0],t[1],t[2]+(this.model.get("height")-.5)*(r._max[2]-r._min[2]),a),u.Matrix.preMult(a,s),this._nodeQuad.dirtyBound()}}}()});t.exports=c},function(t,e,i){"use strict";var r=i(1097),n=i(1523),a=i(1527),s={FeatureName:"background",ModelType:n,ViewListType:[a]};t.exports=r.create(s)},function(t,e,i){"use strict";var r=i(1100),n=i(239),a=i(1524),s=i(1526),o=i(1341),u=i(1413),h=r.osg,fif(r),l="51af6a870cce449eb75b0345feebaebb",c=n.extend({_trashbin:[],defaults:function(){return{enable:u()?"environment":"fixed",uid:l,color:h.Vec3.createAndSet(.2,.2,.2),webVR:!1,backupEnableVR:u()?"environment":"fixed",backupColorVR:h.Vec3.createAndSet(.2,.2,.2)}},init:function(t){var e=t.getModel().get("user").uid;this.backgroundCollection=this.createCollection(e),this.backgroundCollection.fetch({remove:!1});var i=t.getModel().get("options").background;i&&(i.enable&&this.set("enable",i.enable),i.uid&&this.set("uid",i.uid),i.color&&this.set("color",i.color)),o().transparent&&this.set("enable","none");var r=t.getViewer();u()&&r.getPromisePolygon().then(function(){"Tilt Brush"===r.getRootUserData().authoringTool&&(this.set("enable","color"),this.set("color",h.Vec3.create()))}.bind(this))},createCollection:function(t){return new a([],{filters:new s({userUID:t})})},getName:function(){return"Background"},setBackground:function(t){return this.setBackgroundUID(t.uid)},setBackgroundUID:function(t){t&&this.set("uid",t)},getBackground:function(){if(this.backgroundCollection){var t=this.get("uid"),e=this.backgroundCollection.find(function(e){return e.get("uid")===t||e.get("id")===t});return e?e:void this.set("uid",l)}},getJSON:function(){var t={},e=this.getBackground(),i=this.get("webVR");return t.uid=e?e.get("uid"):l,t.enable=i?this.get("backupEnableVR"):this.get("enable"),t.color=i?this.get("backupColorVR"):this.get("color"),t}});t.exports=c},function(t,e,i){"use strict";var r=i(1525),n=i(248),a=i(240);t.exports=n.extend({model:r,url:function(){var t=this.options.filters.get("userUID")?"/i/users/"+this.options.filters.get("userUID")+"/backgrounds":"/i/backgrounds";return t+a.craft("?",{offset:this.options.offset})}})},function(t,e,i){"use strict";var r=i(224),n=i(239),a=i(1346);t.exports=n.extend({save:function(t,e){(null==t||"object"==typeof t)&&(e=t);var i=new FormData;return i.append("imageFile",this.get("imageFile")),i.append("modelUid",e.modelUID),r.ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"})},url:function(){return this.isNew()?"/i/backgrounds":"/i/backgrounds/"+this.get("uid")}}).extend(a)},247,function(t,e,i){"use strict";var r=i(219),n=i(236),a=i(1100),s=i(258),o=i(1099),u=i(1360),h=i(1362),l=a.osg,fif(a),c=s.extend({initialize:function(){s.prototype.initialize.apply(this,arguments),this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change:webVR",this.onVR,this),this.model.bind("change:uid",this.onBackgroundChanged,this),this.model.bind("change",h.draw),this._viewer=this.options.context.getViewer();var t=this.options.context.getFeatures().environment;t&&(this.resourceDefer=n.defer(),this.options.context.getScene().addResourcePromise(this.resourceDefer.promise),this._modelEnvironment=t.getModel(),this._nodeBackground=t.getNode().getBackground(),this._nodeBackground.addUpdateCallback(this),this.onEnableChanged())},onVR:function(){var t=this.model.get("webVR");t?(this.model.set("backupEnableVR",this.model.get("enable")),this.model.set("backupColorVR",l.Vec3.copy(this.model.get("color"),l.Vec3.create())),this.model.set("color",l.Vec3.createAndSet(.2,.2,.2)),this.model.set("enable","color")):(this.model.set("color",l.Vec3.copy(this.model.get("backupColorVR"),l.Vec3.create())),this.model.set("enable",this.model.get("backupEnableVR")))},getResourceManager:function(){return this._resourceManager||o.instance},onBackgroundChanged:function(){var t=this.model.getBackground();if(t){var e=this.options.context.getViewer(),i=Math.max(u(e.getWidth()),u(e.getHeight())),r=t.findImageNearestToResolution(i,i),n=r.url;return this.getResources(n)}},getResources:function(t){var e={minFilter:l.Texture.LINEAR,magFilter:l.Texture.LINEAR,transferToGPU:!0,convertNPOT:!1},i=this.getResourceManager()._resourceLoader._processing;i.length&&r.forEach(i,function(t){t._options&&t._options.cancelableBackground&&t._options.uid!==this.model.get("uid")&&t.abortImage()}.bind(this));var n=this.getResourceManager().getOrCreateTexture(t,r.extend({},e,{cancelableBackground:!0,uid:this.model.get("uid")}));n.promise.then(function(t){this._nodeBackground.setBackground(t),this._nodeBackground.rescale(this._viewWidth,this._viewHeight),this.model.trigger("backgroundUpdated",t),"fixed"===this.model.get("enable")&&this._nodeBackground.showBackground()}.bind(this));var a=this.options.context.getViewer();return this.resourceDefer?(n.promise["finally"](this.resourceDefer.resolve.bind(this.resourceDefer)),this.resourceDefer=void 0):a.getPromiseHighResLoaded().then(a.setFakeSecondaryProgress.bind(a,n.promise,0)),n.promise},onEnableChanged:function(){var t=this.model.get("enable");this._modelEnvironment.set("backgroundEnable","environment"===t),"color"===t?this._nodeBackground.showColor():"fixed"===t?this._nodeBackground.getBackground()?this._nodeBackground.showBackground():void 0!==this.model.get("uid")&&this.onBackgroundChanged():"environment"===t?this._nodeBackground.showEnvironment():"none"===t&&this._nodeBackground.hide(),this.resourceDefer&&this.resourceDefer.resolve()},requireBiggerTexture:function(){var t=this.options.context.getViewer(),e=Math.max(u(t.getWidth()),u(t.getHeight())),i=this.model.getBackground();if(i){var r=i.findImageNearestUpToResolution(e,e);if(void 0!==this._nodeBackground&&!this._nodeBackground.getBackground())return!1;if(r.width<this._nodeBackground.getBackground().getWidth())return!1}return!0},update:function(){if("fixed"!==this.model.get("enable"))return!0;var t=this._viewer.getCamera().getViewport(),e=t.width(),i=t.height();return(this._viewWidth!==e||this._viewHeight!==i)&&(this._viewWidth=e,this._viewHeight=i,this.requireBiggerTexture()===!0&&this.onBackgroundChanged(),this._nodeBackground.rescale(e,i)),!0}});t.exports=c},function(t,e,i){"use strict";var r=i(1097),n=i(1529),a=i(1531),s={FeatureName:"hotspot",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNode=function(){return this._views[0]._nodeHotspot},o.prototype.getNodeProxy=function(){return this._views[0]._proxyHotspot},t.exports=o},function(t,e,i){"use strict";var r=i(235),n=i(1100),a=i(219),s=i(1530),o=i(377),u=i(378),h=i(1099),l=i(1341),c=i(1357),d=n.osg,fif(n),p=n.osgAnimation,f=function(t){var e=d.Vec3.create(),i=d.Vec3.create();t.getFeaturesManager().getCameraWithoutAutospin(e,i),this.set("eye",e),this.set("target",i);var r=t.getScreenShot(128,1),n=r.toDataURL("image/jpeg");this.set("uidImage",void 0),this.set("imageFile",s(n)),this.set("preview",n)},g=r.Model.extend({defaults:{webVR:!1,visible:l().annotationsVisible,hotspots:new o([])},getName:function(){return"Hotspot"},getResourceManager:function(){return this._resourceManager||h.instance},init:function(t){var e=this.get("hotspots");e.on("remove",this.onRemove,this);var i=this._viewer=t.getViewer();this.hotspotsToBeDeleted=[];var r=t.getModel().get("options"),n=r.hotspot,o=n&&n.hotspots&&a.indexBy(n.hotspots,"uid"),u=this.getResourceManager().getOrCreateHotspotCollection().resource;u.each(function(t){t.collection=null;var r=t.get("images")[0];r&&(t.set("uidImage",r.uid),t.set("imageFile",s(r.url)),t.set("preview",r.url),t.set("refreshAction",f.bind(t,i)));var n=o&&o[t.get("uid")];n&&(t.set("geometryUid",n.geometryUid),t.set("indices",n.indices),t.set("barycentricWeights",n.barycentricWeights),t.set("localPosition",n.localPosition)),e.add(t)})},onRemove:function(t){t.isNew()||this.hotspotsToBeDeleted.push(t)},setUpdateCallback:function(t){this.callback=t},updateHotspotHit:function(t,e){this._viewer.getFeaturesManager().getScenePositionFromHit(e,t.get("position"));var i=e.nodepath[e.nodepath.length-1],r=void 0!==i._uniqueID?i._uniqueID:-1,n=i instanceof p.RigGeometry||i instanceof p.MorphGeometry,a=n||c.checkPathIsAnimated(e.nodepath);t.set("geometryUid",a?r:-1);var s=e.TriangleIntersection,o=t.get("indices");o[0]=n?s.i1:-1,o[1]=n?s.i2:-1,o[2]=n?s.i3:-1;var u=t.get("barycentricWeights");u[0]=n?s.r1:0,u[1]=n?s.r2:0,u[2]=n?s.r3:0;var h=t.get("localPosition");h[0]=a?e.point[0]:0,h[1]=a?e.point[1]:0,h[2]=a?e.point[2]:0},createHotspot:function(t){var e=this.get("hotspots"),i=new u;return i.set("uid","tmp_"+a.uniqueId()),this.updateHotspotHit(i,t),e.add(i,{sort:!1}),i.set("order",e.indexOf(i)),i.set("refreshAction",f.bind(i,this._viewer)),i.get("refreshAction")(),i},getJSON:function(){var t=[];return this.get("hotspots").each(function(e){t.push({uid:e.get("uid"),geometryUid:e.get("geometryUid"),indices:e.get("indices"),barycentricWeights:e.get("barycentricWeights"),localPosition:e.get("localPosition")})}),{hotspots:t}}});t.exports=g},function(t,e){"use strict";var i=function(t){var e,i=window.WebKitBlobBuilder||window.MozBlobBuilder||window.BlobBuilder;e=t.split(",")[0].indexOf("base64")>=0?window.atob(t.split(",")[1]):window.decodeURI(t.split(",")[1]);for(var r=t.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(e.length),a=new Uint8Array(n),s=0;s<e.length;s++)a[s]=e.charCodeAt(s);var o;if(void 0!==window.Blob)o=new Blob([a],{type:r});else if(void 0!==i){var u=new i;u.append(n),o=u.getBlob(r)}return o};t.exports=i},function(t,e,i){"use strict";var r=i(1100),n=i(258),a=i(1099),s=i(1490),o=i(1532),u=i(1388),h=i(1362),l=i(1390),c=i(1093),d=i(218),p=i(234),f=i(1389),g=i(1534),m=i(1535),v=i(1536),_=i(1537),b=i(1538),x=i(1539),A=i(1540),y=r.osg,fif(r),S=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),this._hotspots=this.model.get("hotspots"),this._hotspots.on("sort",h.draw),this._hotspots.on("remove",this.onHotspotRemoved,this),this._hotspots.on("add",this.onHotspotAdded,this),this._hotspots.on("select",this.onHotspotSelected,this),this.model.on("change:visible",this.onVisible,this),this._uidGeometryMap=null,this._lastSuccessHit=void 0;var t=this.options.context;this._viewer=t.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._mouseKeyboard=this._viewerOSGJS.getEventProxy().StandardMouseKeyboard,this._idDragging=-1,this._dragHotspotStarted=!1,this._lastHoveredIndex=-1,this._dragCamera=!1,this._coordOnLastDown=y.Vec2.create(),this._nodeHotspot=new y.Node,this._nodeHotspot.setName("Feature - Hotspot"),this._proxyHotspot=new y.Node,this._proxyHotspot.setName("Hotspot - Proxy"),this._proxyHotspot.setNodeMask(0),this._nodeHotspot.addChild(this._proxyHotspot),this.initHotspotProxy(),this.initEventHandlers(),this._hotspots.each(this.onHotspotAdded.bind(this)),f.setHotspot(this._hotspots.length>0),this._viewer.getPromiseModelDisplayed().then(this.hotspotReady.bind(this))},onVisible:function(){this._proxyHotspot.setNodeMask(this.model.get("visible")?u.NO_SHADOW:0),h.draw()},createShader:function(t,e,i,r){var n="#define SHADER_NAME "+r+"\n",a=s(),o={};return o["hotspot-"+i+"-vert"]=n+t,o["hotspot-"+i+"-frag"]=n+e,a.addShaders(o),new y.Program(new y.Shader(y.Shader.VERTEX_SHADER,a.getShader("hotspot-"+i+"-vert")),new y.Shader(y.Shader.FRAGMENT_SHADER,a.getShader("hotspot-"+i+"-frag")))},initEventHandlers:function(){var t=this._viewer.getCanvas();c()&&t.addEventListener("dblclick",this.onDoubleClick.bind(this)),t.addEventListener("mousemove",this.onPointerMove.bind(this)),t.addEventListener("touchmove",this.onPointerMove.bind(this)),t.addEventListener("mousedown",this.onPointerDown.bind(this)),t.addEventListener("touchstart",this.onPointerDown.bind(this)),t.addEventListener("touchend",this.onPointerUp.bind(this)),t.addEventListener("touchcancel",this.onPointerOut.bind(this)),t.addEventListener("mouseup",this.onPointerUp.bind(this)),t.addEventListener("mouseout",this.onPointerOut.bind(this))},hotspotReady:function(){this.onVisible();var t=this._viewer.getFeatures().postProcess.getCamera()._textureDepth;t&&this._proxyHotspot.getOrCreateStateSet().setTextureAttributeAndModes(0,t),this._uidGeometryMap=this._viewer.getOrCreateScene().getPolygonNode().getChildren()[0]._uidGeometryMap,h.draw()},initHotspotProxy:function(){this._proxyHotspot.addUpdateCallback(this);var t=this._proxyHotspot.getOrCreateStateSet();t.setRenderBinDetails(l.EDITOR_GIZMO,"RenderBin"),t.setAttributeAndModes(new y.Depth(y.Depth.DISABLE)),t.setAttributeAndModes(new y.BlendFunc(y.BlendFunc.ONE,y.BlendFunc.ONE_MINUS_SRC_ALPHA));var e=a.instance.getOrCreateTexture(o.HOTSPOT);t.addUniform(y.Uniform.createInt(0,"uTextureDepth")),t.addUniform(y.Uniform.createInt(1,"uTextureHotspot")),t.setTextureAttributeAndModes(1,e.texture),t.setAttributeAndModes(this.createShader(m,v,"hotspot","Hotspot")),t.setAttributeAndModes(new y.CullFace(y.CullFace.DISABLE)),g.initCardShader(this.createShader(_,b,"tooltip","VRTooltip")),g.initLineShader(this.createShader(x,A,"hotspotline","VRHotspotLine"))},onDoubleClick:function(t){var e=this._viewer.getOptions().widgetAPI.getTabbedWidget();if("annotations"===e.get()){var i=d.maxHotspotsPerModel[p.me().get("account")];if(this._hotspots.length>=i){var r="You have reached the maximum number of annotations allowed by your plan ("+i+").";return p.me().canUpgradeToPro()&&(r+='<br><a class="button btn-medium btn-primary upgrade-link" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">Upgrade to add more annotations</a>'),void this.osd.show(r)}var n=this._pickNearestSurface(t);n&&this.model.createHotspot(n)}},getColorHotspot:function(t){return this._proxyHotspot.getChildren()[t].getColor()},setHotspotHovered:function(t,e){e>=0&&y.Vec3.copy(t?g.COLOR_HOVERED:g.COLOR_NORMAL,this.getColorHotspot(e))},getCanvasCoord:function(t,e){return t.touches?(e[0]=t.touches[0].clientX,e[1]=t.touches[0].clientY):(e[0]=void 0===t.offsetX?t.layerX:t.offsetX,e[1]=void 0===t.offsetY?t.layerY:t.offsetY),e},updateCameraDragged:function(){var t=y.Vec2.create();return function(e){this._dragCamera=this._dragCamera||y.Vec2.distance(this._coordOnLastDown,this.getCanvasCoord(e,t))>5}}(),onPointerDown:function(t){this._idDragging=this._pickHotspot(t),this._dragHotspotStarted=!1,this._dragCamera=!1,this.getCanvasCoord(t,this._coordOnLastDown),c()&&this._idDragging>=0&&this._mouseKeyboard.setEnable(!1)},onPointerOut:function(){this._dragCamera=!0,this.onPointerUp()},onPointerUp:function(){this._dragCamera?this._idDragging>=0&&(this._lastSuccessHit&&this.model.updateHotspotHit(this._hotspots.at(this._idDragging),this._lastSuccessHit),y.Vec3.copy(g.COLOR_NORMAL,this.getColorHotspot(this._idDragging)),h.draw()):this._hotspots.trigger("select",this._hotspots.at(this._idDragging)),this._dragHotspotStarted=!1,this._dragCamera=!1,this._idDragging=-1},onPointerMove:function(t){if(this.updateCameraDragged(t),c()&&this._idDragging>=0)return void this.dragHotspot(t);var e=this._pickHotspot(t);this.getCanvasCoord(t,this._coordOnLastDown),this.setHotspotHovered(0,this._lastHoveredIndex),this.setHotspotHovered(1,e),this._lastHoveredIndex!==e&&(this._lastHoveredIndex=e,h.draw())},dragHotspot:function(t){this._dragHotspotStarted=!0;var e=this._pickNearestSurface(t),i=this._hotspots.at(this._idDragging);if(y.Vec3.copy(e?g.COLOR_DRAG_OK:g.COLOR_DRAG_FAIL,this.getColorHotspot(this._idDragging)),e)this._lastSuccessHit=e,this.model.updateHotspotHit(i,e);else{var r=this._viewer.getFeaturesManager(),n=void 0===t.offsetX?t.layerX:t.offsetX,a=void 0===t.offsetY?t.layerY:t.offsetY,s=r.canvasCoordToGL(n,a,y.Vec3.create());s[2]=r.getScreenPositionFromScenePoint(i.get("position"),y.Vec3.create())[2],r.getScenePositionFromScreenPoint(s,i.get("position")),i.set("geometryUid",-1)}h.draw()},onHotspotSelected:function(){var t=y.Vec3.create(),e=y.Vec3.create();return function(i){if(i){var r=this._viewer.getFeaturesManager();r&&(y.Vec3.copy(i.get("eye"),t),y.Vec3.copy(i.get("target"),e),r.applyAutospinToCamera(t,e),r.focusOnTargetAndEye(e,t,1.5),h.draw())}}}(),onHotspotAdded:function(t){this._proxyHotspot.addChild(new g(this._hotspots.indexOf(t))),h.draw()},onHotspotRemoved:function(){var t=this._proxyHotspot.getChildren();this._proxyHotspot.removeChild(t[t.length-1]),h.draw()},_pickNearestSurface:function(t){var e=void 0===t.offsetX?t.layerX:t.offsetX,i=void 0===t.offsetY?t.layerY:t.offsetY,r=this._viewer.getFeaturesManager();return r?r.computeNearestIntersection2D(e,i,u.PICK_GEOMETRY_SLOW,this._viewer.getOrCreateScene().getRoot()):void 0},_pickHotspot:function(){var t=y.Vec2.create(),e=y.Vec3.create();return function(i){var r=this._viewer.getFeaturesManager();if(!r)return-1;this.getCanvasCoord(i,t),r.canvasCoordToGL(t[0],t[1],t);for(var n=1/0,a=this._proxyHotspot.getChildren(),s=a.length,o=-1,u=0;s>u;++u){var h=a[u].getHotspotMatrix();e[0]=h[12],e[1]=h[13],e[2]=h[14],r.getScreenPositionFromScenePoint(e,e);var l=y.Vec2.distance(t,e);35>l&&n>l&&(n=l,o=u)}return o}}(),updateScenePositionHotspot:function(){var t=y.Vec3.create(),e=y.Matrix.create();return function(i){var r=i.get("lastComputedScenePosition"),n=i.get("geometryUid");if(0>n)return y.Vec3.copy(i.get("position"),r);var a=this._uidGeometryMap[n];if(!a)return y.Vec3.copy(i.get("position"),r);var s=i.get("indices"),o=s[0],u=s[1],h=s[2];if(a.getWorldMatrix(this._nodeHotspot,e),0>o)return void y.Matrix.transformVec3(e,i.get("localPosition"),r);var l=a.getVertexAttributeList().Vertex.getElements(),c=l.length/3;if(o>=c||u>=c||h>=c)return y.Vec3.copy(i.get("position"),r);var d=i.get("barycentricWeights"),p=d[0],f=d[1],g=d[2];if(y.Vec3.init(r),a.computeTransformedVertex)a.computeTransformedVertex(o,t),y.Vec3.mult(t,p,t),y.Vec3.add(t,r,r),a.computeTransformedVertex(u,t),y.Vec3.mult(t,f,t),y.Vec3.add(t,r,r),a.computeTransformedVertex(h,t),y.Vec3.mult(t,g,t),y.Vec3.add(t,r,r);else{var m=3*o,v=3*u,_=3*h;r[0]=p*l[m]+f*l[v]+g*l[_],r[1]=p*l[m+1]+f*l[v+1]+g*l[_+1],r[2]=p*l[m+2]+f*l[v+2]+g*l[_+2]}return y.Matrix.transformVec3(e,r,r),r}}(),update:function(){var t=y.Matrix.create(),e=y.Quat.create(),i=y.Vec3.create(),r=y.Vec3.create(),n=y.Vec3.create(),a=y.Matrix.create();return function(){this.model.callback&&this.model.callback();var s=this._hotspots,o=this._proxyHotspot.getChildren(),u=o.length,h=this._viewer.getFeatures(),l=h.webVR.getModel().get("worldFactor"),c=this.model.get("webVR");this._manipulator.getEyePosition(i);var d=this._viewer.getCamera(),p=.02*this._viewerOSGJS.getCanvasClientWidth()*y.Matrix.getScale(d.getProjectionMatrix(),n)[0];this._nodeHotspot.getWorldMatrix(void 0,a);var f=y.Matrix.create();y.Matrix.inverse(a,f),y.Matrix.transformVec3(f,i,r),y.Matrix.mult(d.getViewMatrix(),a,t),y.Matrix.inverse(t,t),y.Matrix.makeRotateFromQuat(y.Matrix.getRotate(t,e),t);for(var g=0;u>g;++g){var m=o[g],v=s.at(g);this.updateScenePositionHotspot(v),c?m.updatePositionVR(v,p,r,i,l,a):m.updatePosition(v,t,p,r)}return!0}}()});t.exports=S},function(t,e,i){"use strict";t.exports={HOTSPOT:i(1533)}},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAEACAMAAADyTj5VAAABQVBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////Z2dmMjIxUVFQsLCwUFBQICAj////////////////r6+uGhoYYGBgAAADr6+v////////z8/N7e3sAAAB7e3v///+5ubkTExO2trb////9/f1+fn59fX37+/tjY2NkZGR/f3+2trYSEhLz8/P///96enr///88PDxra2tVVVWioqKxsbGAgIAgICCRkZG/v7+FhYX////29vbY2Nji4uLMzMzt7e0YGBj///+Li4tWVlb///////8oKCgODg4HBwf///8VFRX///////8XFxe4uLhjY2MNDQ3z8/N5eXkYGBj///9TU1MrKysTExMFBQX///////////////9v9ljGAAAAa3RSTlMACyxIXGx3fAo5Zn+ADUd6e0oCOwMTZ3NnbnV8fmgVKHlwb3eAbzN+eHJ9cTVse2sngXV0fHh3dWx7d0tzOJGimbvEqoizzG7/993m1e55LmhvW251en99fHYMeG15eXVyeCludHx+PT4ObYnIUCAAABJrSURBVHgB7MvDmhwAEIDBMf+xbdt+/8dKssr2+N5f170cd5wut8fr8/t9Xo/b5XTc0TZsSIFgKIwQDgUDqocNKRKNcSeeiNjQO4RkSmYhlkrb0DmkTJYvuXyhWCqXS8VCPseXSlXjsCHV6nxoNFttodXs8CFW0zdsSN0e//QHw/aN4ajPP72utmFDGvNhMm0/MJ3xYaxr2JDmPWCxbD+xWgC9uaZhQ6rGgPWm/dRmDcSqeoYNKV0BFtv2C9sFUEkrGDbupfhn135pxz8pLcOGFIkB+/YbeyAWUTFsXEsA/em7fjgCJx3DhhSIA+f2W2cgHlAwbFy7AJ2/tNrHshs3EIVh5+y9vXLCSu9gYAZoQD/IgXP2+7+HSbGrUKhL+R6ls7lpPrUabCaAD3YPYkphzZPrjtL3zxPbnnN5EWElq2JRaZNFTB5NeFLOezVRbDMm14h7nRXU1d23oIqUYvDU1nJ8KJZ8cvnt0xDW7ICFNU8vF35yX5QOAEUVduKWXRSeMyCLA4/pNVIHoIqCmSrWsAEAWe7DzgCMKAnrcJrfzkpTLHn7enr8Q1hz4s4A/HA9Xf78nsh42ETR8VAk4alAD6qYAyCK2Ul54T4ompikhhcVSucJ4AjXGJ59FWveuZ4ehSWxsy6b53qy9OM9UaHXbQdOoohwpFh1MTvqQRUd2jVZFgXoxSyZKPb2LAewaWIDqsUzDH11adsOtMdFZg5AA6qdAVvFkncvv/vp4TJPNfPF5dJ3V+HJzZ83uipS9N7OivAMHwBR9NmDLg5dzOwwRFFuLZu+VidoN8ijosEcgA777UtZxZL3Lr/7Miw56DbuLN7Pl0t/WcWSCl0VczV0keHsJSTRIXg0EdHFEqCIYoN+63yIosM2v/6/iFCTD4D5nTjDsYolv15+91tYk+/fe367XPrrKlYGpxcSG7DLIgIGPYjCgJRqCnIfGXbLrRVVeOoL/q9GrEAWRYfoX+ujIqVQ5gD0MGdtijXXTxH8Hh7k3gD8frn063titlZlsZ1PHTjrNTokg64Kw1NUcUAHoJve+Xys1UTilpMqzpB9/pMiChz+tXvBvooln13yRBuAJ9dr7wsnQxcFAEwWDZpPtSYMPEUUB3iGJDxF7WN5ng6qyEAuO0BRxBwA8HUYq3jZAfjjcumfzxUDMF0kbima8Dk26HKNcuwpHQCiOIBmoQHbi3Xe9LXKeEwUBnjSQyENQF/Fyz4F/HW59O/niTOwicJjqQMmCQOSWQRMETMVEMXJl25A0Wts6Gvlb+pCBRCFvy0/d6mPOQAb9PlUMIXwIjDoLwLX218WHgNMEoWZLomlFU0cfh9rUPQaZ38+l2tk73yTa2wlxaCu1XwRCPOt1hSPvA30dPFt4Hr768IDmCQKzChiHTJNNGj+SFDkGnG2rogO0QehasKza2+Z1wGIt0rHIh7ZCJoDoG+HzN0mUSSbRw6SiIdvuUHLWo0t+a0KJgpg89fbkvBpGS/Q+YDqX4skPAUoQg0fgPnQFCd08ehWsA+AvhV8AhjX9KQJGK3uA3lD1GPoW8EH/ci5A4daYwCtAagi2FxfSTTgKHUAJtao+Xb9kGrMASjAaQdYxZp/bkcJwgD860cJ/whHIrrYlBrrAIjiwCOLEPEkVYQ2/31JGHiyJGYjZ7GGD8CEpEVIx8FhvMhx8FgGQBG7T8BhYg2PwVBFmueuco14BhibKuYmkCzsAGAkWTwDvao15gD4W860CO0DITPrBxA+fm3C4rbFN14jvnANc6KKGV3E/9i7b6eGoSCIwyY2ZHhSrZ4OOnKmJDvnbP//PTkeN3NSqZvf9p8xrt/tnpxcGML4qQzxQ09OToTQn4Rtp31QhHAgRPYzPClEOBDqs/C6xevyGTIixyL7YciOPERA5FfIhDjdYVEcED6ETJS8nRY2jNPCJEJ4Efp5+K59XIxwI7R6gfqThpuyXgDhQmgFI632/4KRdksWjCB8CL1i6LrzG3euPyuGughHwqiJu+31B8PhoN+7lSVjCFdCJIzWl9WsjwPCpxCZ6EWjE4RbQWUyQqY6Ozc/XSyVFqfzc7NVhBNBCCFOVzAQLIYgWAxBsBiCYDEEwWIIgsUQBIshCBZDECyGIFgMQbAYgmAxBMFiCILFEIS9GPLC3HngOIwDQfBnYiaKovT/51wQTLgRtNe83BsdCqPR0HLYUOKb0BOWoaKWnNMWEdMWsahQqk2ETyxipbacUzCJGr/xa5TcUrQ6l21q9Y3QEdjGkDffhJ7wDBWqAZk20QZP7moRKxEoLlH55NyocfHEJArfuDXSdueNF/+HEDqCbWOI+Cb0hG2oqKxMkwis3BaxMoDiEocsAIOQHQcmUVhhmDWKAntEeid0BPvGEPVN6AnbUDHgCnECh0mc3O3wCb15FnerCty5/5bgEKsR+lFjNImjP8nANGtMmEdtQDAJYIQwgfpO6Aj2jSHqm9ATrqGizkPsCRZRVm/RIp4EWCUcoghqE0SbkAwIBiH/MPSE5hHHZ443pHdCR7BvDFHfhJ5wDBUSoOwRA6JPAHOVMIjC2mMuMaHtECsJxmaNG4JHFJjy9YXQEewbQ9Q3oSc8Q8VKBY4togN+jRNah+ISF/QSSt0xbVCLPHx2+wCaS2QgrcOzQ5TvA87hWEmOP2sMWQX1hGeoEO2GT1znBAgesW4BFxSXuHjCWU2iAgOAtNV5A/x9NXlCNAj9p/QX3I75ZN8Y8r4ALEPFSgKKT8gTFYf4HNcuu4b+x1iTUEHDTufD7kOck8kmgFHaBMY7oSMwjSHGAjAMFXqCvkHcPLkNQu47LyguUXsvIQ0geUQFRnxucnOj8wBUu/PKJ9klMiv3HxJ0wxji3wUYhgrdC6dJrNQMZINYgr5aT0jVI1QJ6BEHUPXQ6dW4t/bVAGKdQHIIeU743oeOYN8Y8r4ALEOFFvcIyQWXRwy+KVs1ml2jwtCvXo0IHFbnarHoMO0a9XcPdnrvQ0ewbwx5XwCOoWIVX98ahCTD5RG6ANo/UEOHc8Dw+zhhep3rUKpXQwLEF0JGsGsMMRaAYagIcv9vETWsV165PCL1JwNmj95WtbqO69ns44ZTHm8bhFhGPCLI4dkhVCQ+3mvoCPaNIe8LwDNURID7yekRBc7ULoBgESv9ASyiwuzpAjjMGgG48wSaR8iTX3+rGK11IJs1am+lw4+d6wj2jSHvC8AzVBRYGbvE6dVYuaCYRGWlbZs2bo9Qa6pLZFaqQ0gj5YcaOoJ9Y8j7AvAMFQFWbo84Tp7cxayx0qG4ROfJjBs1EgDZJORFIJ8oQ5QpDlH15awXQkfwPzeGqA2j/g9rCGIQf9bmcewQv7Z358ZhADEQBDNT/mHJbr4DvhK58GBMXR0S6D98Y2LIiokhKyaGrJgYsmJiyIqJISsmhqyYGLJiYsiKiSErJoasmBiyYmLIiokhKyaGrNhsNpsfLoasmBiyYmLIiokhKyaGrJgYsmJiyIqJISsmhqyYGLJiYsiKiSErJoasmBiyYmLICuaxN9HEEAqWUiCG1AIxpBSIIa1ADGkFYkgqEENykcQQD9rFEL2JKoZYmIcCMSQUiCGpQAwphWJIKxBDUoEYUosihnjQqxiiNxHEEAvzUCCGlAIxJBWIIalADIlFEEMsEENqEcQQD3oXQyQ/ghhiYR4KxJBSIIakAjEkFYghqUAMSQViSCySGMJBz2II3kQQQyxYUoEYkgrEkFYEMcQCMSQViCGpQAxpRRJDOOhdDJH8CGIIBUsqEENSgRiSCsSQVCCGpAIxJBWIIa1IYggHvYshkh9BDKFgSQViSCoQQ1KBGJIKxJBUIIakAjGkFUUM4aB3MURvIoghFCypQAxJBWJIKhBDUoEYkgrEkFQghsSiiCEc9C6G6E0EMYSCJRWIIalADEkFYkgqFENKoRhSCsSQWAQxhIPexRC9iSCGULCkQjGkFIohqVAMKYViSCkUQ0KhGBKLIIZw0LMYojcQxBAKllgohpRCMaQUiiGlUAwphWJIKRRDYlHEEA56F0N8L4ohFOahQAwJBWJIKRRDQqEYUgrFkFIohrQiiSEc9C6GSH4kMcTCPBRB86BQDPmEN4oYYlHEEIsihlhUMYTP3sQQvYkshliYhyKIIRRBDKEoYohFEUMsihhiUcQQiyiGeNCzGKI3kcQQC/NQFDHEooghFkUMsShiiEURQyyKGGKRxBAO2sSQZ72JJIZYmIeiiCEWRQyxKGKIRRFDLIoYYlHEEIskhnDQsxiiN5HEEAvzUBQxxKKIIRZFDLEoYohFEUMsihhikcQQDvrLxJCJIXz2/xZDVkwMWTExZMXEkBUTQ1ZMDFkxMWTFxJAVE0NWTAxZMTFkxcSQFRNDVkwMWTExZMXEkM1mMzFkxcSQFRNDVkwMWTExZMXEkBUTQ1ZMDFkxMWTFxJAVE0NWTAxZMTFkxcSQFRNDVjCPvYkihlhUMcSCJRRBDKEoYohFEUMsihhiUcQQiy6GeJ6zGKI3UcQQiySGWLiEooghFkUMsShiiEURQyyKGGKRxBDOcxZD9CaKGGKRxBALl1AUMcSiiCEWRQyxKGKIRRFDLJoY4nm6GKI3UcQQiy6GWLCEIoghFEEMoShiiEURQyySGGLRxRDOcxZD9CaKGGKRxBALl1AUMcSiiCEWRQyxKGKIRRFDLJIYwnnOYojeRBFDLJIYYuESiiKGWBQxxKKIIRZFDLEoYohFEkM4z1kM0ZsoYohFEkMsXEJRxBCLIoZYFDHEooghFkUMsUhiiOe5iyECHlEMsShiCIV5KIoYQlHEEIokhlBEMYQiiCEUSQzhPHcxRMAjiiEWRQyhYAlFEkMoihhCkcQQiiqGUAQxhKKIIZznLoYIeEQxxKKIIRQsoUhiCEURQyiSGELRxBCKJIZQFDGE89zFEAGPKoZQBDGEgiUUSQyhSGIIRRJDKJoYQpHEEIoihnCeuxgi4BHFEIoihlCwhCKJIRRJDKFIYghFEkMokhhCkcQQznMXQ8Q1mhhCkcQQCpZQKIZ8zhtJDKFIYghFEkMokhjCee5iiN5EEUMsihhCYV6KJIZQJDHEooghFkUMoUhiCEUSQzjPXQzRmyhiCEUSQyhYUpHEEIokhlAkMcSiiCEUSQyhSGKI57mLIXoTQQyhSGIIBUsqkhhCkcQQiiiGUBQxhCKJIRRFDOE8dzFEb6KIIRRJDKFgSUUSQyyKGGKhGJIKxZBSBDHEooghnucuhuhNBAXj/YX597+RxZD33yqIIRRBDGH+XzFkxcSQFRNDVkwMWTExZMXEkBUTQ1ZMDFkxMWTFxJAVE0NWTAxZMTFkxcSQFRNDVkwM2Ww2E0NWTAxZMTFkxcSQFRNDVkwMWTExZMXEkBUTQ1ZMDFkxMWTFxJAVE0NWTAxZMTFkBfOyN1HEEIokhlAkMYTCJRRJDKEIYghFEkMoohhCEcQQP3sXQ/QmihhCkcQQiiSGULiUIokhFEUMoUhiCEUTQyiCGOJn72KI3kQRQyiSGEKRxBAKl1QUMcSiiCEUSQyhUAxpRRBD/OxdDJHjKGIIRRJDKJIYQuFSiiSGUBQxhCKJIRRNDKEoYoifvYsheBNJDKFIYohFEUMoXEqRxBCLIoZQJDGEooghFEkM8bN3MQSOI4khFFUMsQhiCAVLKJIYQpHEEIokhlAUMYSiiCF+9i6GyHE0MYRCMSQWQQyhYAlFEUMokhhC0cQQiiKGUBQxxM/exRA5jiaGWBQxxKKIIRTmoShiCEUSQyiiGEIRxBCKIob42bsYIseRxBALxZBUBDGEwrwURQyhSGIIhWJILIIYQhHEED97F0PkOJIYYqEYkooghlCYl6KIIRRJDKFoYghFEkMoghjiZ+9iiBxHEUMsFCNSEcQQCvNSJDGEIokhFEkMsShiiEUQQ/zsXQyR4yhiiEURQyyKGEJhXookhlAkMYQiiSEUSQyhSGIIn72LIXIcRQyxUAxJRdA8KMw/540khlAkMYQiiSEUSQzhs3cxRG+iiCEWRQyhSGIIBUsqkhhiUcQQiyKGUCQxhCKJIXz2LoboTRQxhCKJIRRJDKFwKUUSQyiSGGJRxBCKJIZQFDHEz97FEL2JIoZQJDHEooghFC6lSGIIhWJIK4IYYlHEEIsghvjZuxiiN1HEEIokhlAkMYTCJRVFDKEIYghFEUMsEENSUcUQP3sSQ5iqYLy/ENH4/je6GPLuWyGGhCKIIX7254shKyaGrJgYsmJiyIqJISsmhqyYGLJiYsiKiSErJoasmBiyYmLIiokhKyaGrJgYsmKz2Ww2m81ms9lsNpvN5i9hYcq53zAZMgAAAABJRU5ErkJggg==";
},function(t,e,i){"use strict";var r=i(1100),n=i(1388),a=i(1390),s=r.osg,fif(r),o=r.osgUtil,u=1.5,h=.2,l=.01,c=1,d=.5,p=s.Vec4.createAndSet(-.152,.152,-.342,-.432),f=0,g=1,m=2,v=3,_=4,b=s.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),x=s.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),A=o.GizmoGeometry.createCylinderGeometry(.0025,.0025,1,8,1,!1,!1),y=new s.MatrixTransform;y.getMatrix()[14]=.5,y.addChild(A),A._boundingBoxComputed=!0,A._boundingSphereComputed=!0;var S=function(t){s.Node.call(this),this._idHotspot=t,this._hotspotMT=new s.MatrixTransform,this._cardMT=new s.MatrixTransform,this._lineToCardMT=new s.MatrixTransform,this._hotspotMT.addChild(b),this._cardMT.addChild(x),this.addChild(this._hotspotMT),this.addChild(this._lineToCardMT),this.addChild(this._cardMT),this._cardMT.setNodeMask(0),this._lineToCardMT.setNodeMask(0),this._worldTeleportPos=void 0,this._cardInitialized=!1,this._texCard=new s.Texture,this._texCard.setTextureSize(1,1),this._canTeleport=!1,this._uAlpha=void 0,this._uPaginate=void 0,this._color=void 0,this._statusCard=f,this._lineToCardMT.addChild(y),this._cardMT._boundingBoxComputed=!0,this._cardMT._boundingSphereComputed=!0,this._hotspotMT._boundingBoxComputed=!0,this._hotspotMT._boundingSphereComputed=!0,this.init()};S.COLOR_NORMAL=s.Vec3.createAndSet(1,1,1),S.COLOR_HOVERED=s.Vec3.createAndSet(0,.8,1),S.COLOR_DRAG_OK=s.Vec3.createAndSet(0,.4,1),S.COLOR_DRAG_FAIL=s.Vec3.createAndSet(.8,.2,.2),S.initCardShader=function(t){var e=x.getOrCreateStateSet();e.setAttributeAndModes(t),e.addUniform(s.Uniform.createFloat4(p,"uRectangleClose")),e.setRenderBinDetails(a.EDITOR_GIZMO+1,"RenderBin")},S.initLineShader=function(t){var e=A.getOrCreateStateSet();e.setAttributeAndModes(t),e.addUniform(s.Uniform.createFloat4(s.Vec4.createAndSet(.03,.59,.78,.4),"uLineColor")),e.setRenderBinDetails(a.EDITOR_GIZMO+1,"RenderBin")},S.prototype=s.objectInherit(s.Node.prototype,{init:function(){var t=this.getOrCreateStateSet();t.addUniform(s.Uniform.createFloat(this._idHotspot,"uHotspotIndex"));var e=s.Uniform.createFloat3(s.Vec3.createAndSet(1,1,1),"uColor");this._color=e.getInternalArray(),t.addUniform(e);var i=this._cardMT.getOrCreateStateSet();i.setTextureAttributeAndModes(1,this._texCard);var r=s.Uniform.createFloat4("uPaginate");this._uPaginate=r.getInternalArray(),i.addUniform(r);var n=s.Uniform.createFloat1(1,"uAlpha");this._uAlpha=n.getInternalArray(),i.addUniform(n),this._texCard.setMinFilter(s.Texture.LINEAR_MIPMAP_LINEAR),this._texCard.setMagFilter(s.Texture.LINEAR)},getIndex:function(){return this._idHotspot},getHotspotMatrix:function(){return this._hotspotMT.getMatrix()},getColor:function(){return this._color},isFullyVisibleCard:function(){return 0!==this._cardMT.getNodeMask()&&1===this._uAlpha[0]},isVisibleCard:function(){return 0!==this._cardMT.getNodeMask()},canTeleport:function(){return this._canTeleport&&!this.isFullyVisibleCard()},setWorldTeleportPosition:function(){var t=s.Vec3.create(),e=s.Vec3.create(),i=s.Vec3.create(),r=s.Matrix.create();return function(n,a,o){if(!this.isFullyVisibleCard()){var h=this._cardMT.getMatrix();this.getWorldMatrix(void 0,r),this._worldTeleportPos=s.Vec3.copy(a,this._worldTeleportPos||s.Vec3.create()),s.Vec3.copy(a,i),i[2]+=u*o,s.Vec3.sub(n,i,e),e[2]=0,s.Vec3.normalize(e,e),s.Vec3.mult(e,c*o,e),s.Vec3.add(i,e,e),this.lookToWorld(h,e,i,o,r),s.Matrix.preMultScale(h,s.Vec3.set(1,.5625,1,t)),e[2]+=.28125*o;var l=this._lineToCardMT.getMatrix();this.lookToWorld(l,n,e,1,r),s.Matrix.preMultScale(l,s.Vec3.set(1,1,s.Vec3.distance(n,e),t)),this._cardMT.dirtyBound()}}}(),setVisibleCard:function(t){this._cardMT.setNodeMask(t?-1:0),this._lineToCardMT.setNodeMask(t?n.NO_PICK:0),this._uAlpha[0]=1},setHovered:function(t){s.Vec3.copy(t?S.COLOR_HOVERED:S.COLOR_NORMAL,this.getColor()),this.isFullyVisibleCard()||(this._cardMT.setNodeMask(t?n.NO_PICK:0),this._lineToCardMT.setNodeMask(t?n.NO_PICK:0),this._uAlpha[0]=.1)},getNbPage:function(){return Math.abs(this._uPaginate[3])},getCurrentPage:function(){return this._uPaginate[2]},setPage:function(t){var e=this.getNbPage(),i=Math.min(e-1,Math.max(0,t)),r=this._statusCard===v?h:l;this._uPaginate[0]=i>0?r:0;var n=this._statusCard===_?h:l;this._uPaginate[1]=e-1>i?n:0,this._uPaginate[2]=i,this._uPaginate[3]=Math.abs(this._uPaginate[3])*(this._statusCard===m?-1:1)},initCard:function(t){this._cardInitialized=!0,this._texCard.setImage(t),this._uPaginate[3]=Math.floor(t.width/1024),this.setPage(0)},updateCardHit:function(t){var e=t&&t.point;t&&-1!==t.nodepath.indexOf(this._cardMT)?e[0]<-.3?this._statusCard=v:e[0]>.3?this._statusCard=_:e[0]>p[0]&&e[0]<p[1]&&e[1]<p[2]&&e[1]>p[3]?this._statusCard=m:this._statusCard=g:this._statusCard=f,this.setPage(this.getCurrentPage())},onCardHit:function(){this._statusCard===f||this._statusCard===m?this.setVisibleCard(!1):this._statusCard===v?this.setPage(this.getCurrentPage()-1):this._statusCard===_?this.setPage(this.getCurrentPage()+1):this.setPage(this.getCurrentPage())},lookToWorld:function(){var t=s.Vec3.create(),e=s.Vec3.createAndSet(0,0,-1),i=s.Matrix.makeRotate(Math.PI,1,0,0,s.Matrix.create());return function(r,n,a,o,u){s.Matrix.makeLookAt(n,a,e,r),s.Matrix.mult(i,r,r),s.Matrix.preMult(r,u),s.Matrix.inverse(r,r),s.Matrix.preMultScale(r,s.Vec3.set(o,o,o,t))}}(),updatePositionVR:function(){var t=s.Vec3.create();return function(e,i,r,n,a,o){var u=this._hotspotMT.getMatrix(),h=e.get("lastComputedScenePosition"),l=s.Vec3.distance(r,h),c=l/i;s.Matrix.transformVec3(o,h,t),c=Math.max(.75*c,.1*a),this.lookToWorld(u,t,n,c,o);var p=this._worldTeleportPos?s.Vec2.distance(n,this._worldTeleportPos):1/0,f=d*a>p;this._canTeleport=!f,!this._cardInitialized&&e.get("cardCanvas")&&this.initCard(e.get("cardCanvas").canvas),this._hotspotMT.dirtyBound()}}(),updatePosition:function(){var t=s.Vec3.create();return function(e,i,r,n){var a=this._hotspotMT.getMatrix(),o=e.get("lastComputedScenePosition"),u=s.Vec3.distance(n,o)/r;s.Matrix.copy(i,a),s.Matrix.preMultScale(a,s.Vec3.set(u,u,u,t)),s.Matrix.setTrans(a,o[0],o[1],o[2]),this._hotspotMT.dirtyBound()}}()}),t.exports=S},function(t,e){t.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nuniform float uHotspotIndex;\n\n// icon size 48 pixel width and 2 pixel padding between them\nconst vec2 ICON_SIZE = 48.0 / vec2(512.0, -256.0);\nconst vec2 ICON_AND_PADDING = ICON_SIZE + 2.0 / vec2(512.0, -256.0);\n\nvoid main(void) {\n  vec2 offset = vec2(mod(uHotspotIndex, 10.0), floor(uHotspotIndex / 10.0));\n  vTexCoord0 = vec2(TexCoord0.x, 1.0 - TexCoord0.y) * ICON_SIZE + offset * ICON_AND_PADDING;\n\n  vViewPos = ModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = ProjectionMatrix * vViewPos;\n}\n"},function(t,e){t.exports="varying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureHotspot;\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\nuniform vec3 uColor;\n\nconst float BIAS_VISIBILITY = 0.05;\n\nvoid main(void) {\n  float fragDepth = (-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize), vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n  float alpha = (fragDepth - BIAS_VISIBILITY < depth) ? 1.0 : 0.1;\n\n  gl_FragColor = vec4(uColor, 1.0) * texture2D(uTextureHotspot, vTexCoord0);\n  gl_FragColor.a *= alpha;\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n"},function(t,e){t.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  vViewPos = ModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = ProjectionMatrix * vViewPos;\n}\n"},function(t,e){t.exports='varying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureHotspot;\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\n\nuniform vec4 uPaginate; // [ left hint, right hint, currentPage, nbPage (< 0 hover on close) ]\nuniform vec4 uRectangleClose;\nuniform float uAlpha;\n\n#pragma include "functions.glsl"\n\n// signed distance to a 2D rounded box\nfloat sdRoundBox( const in vec2 p, const in vec2 b, const in float r ) {\n    vec2 q = abs(p) - b;\n    vec2 m = vec2( min(q.x,q.y), max(q.x,q.y) );\n    float d = (m.x > 0.0) ? length(q) : m.y; \n    return d - r;\n}\n\nvoid main(void) {\n  float fragDepth = (-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize), vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n  float alpha = fragDepth < depth ? 1.0 : 0.1;\n\n  vec2 uv = vec2((uPaginate.z + vTexCoord0.x) / abs(uPaginate.w), vTexCoord0.y);\n  vec4 color = texture2D(uTextureHotspot, uv);\n  color.a *= alpha;\n\n  float lerpValue = step(-uPaginate.x, -vTexCoord0.x);\n  lerpValue += step(1.0 - uPaginate.y, vTexCoord0.x);\n\n  // vTexCoord is [0, 1]\n  float round = 0.02;\n  float left = uRectangleClose.x + 0.5 + round;\n  float right = uRectangleClose.y + 0.5 - round;\n  float top = uRectangleClose.z + 0.5 - round;\n  float bottom = uRectangleClose.w + 0.5 + round;\n  \n  vec2 halfSize = abs(vec2(left - right, top - bottom) * 0.5);  \n  vec2 center = vec2(halfSize.x + left, halfSize.y + bottom);\n\n  lerpValue += step(0.0, -uPaginate.w) * max(0.0, -sign(sdRoundBox( vTexCoord0 - center, halfSize, round)));\n\n  color.rgb = mix(color.rgb, color.rgb + vec3(0.03, 0.59, 0.78), max(min(lerpValue, 1.0), 0.0)); // min/max not necessary\n\n  color.rgb = sRGBToLinear(color.rgb);\n\n  color.a *= uAlpha;\n  color.rgb *= color.a;\n\n  gl_FragColor = linearTosRGB(color);\n}\n'},function(t,e){t.exports="attribute vec3 Vertex;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = ProjectionMatrix * (ModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(t,e){t.exports='uniform vec4 uLineColor;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n    vec4 color = sRGBToLinear(uLineColor);\n    color.rgb *= color.a;\n    gl_FragColor = linearTosRGB(color);\n}\n'},function(t,e,i){"use strict";var r=i(1097),n=i(1542),a=i(1553),s={FeatureName:"lighting",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNode=function(){return this._views[0].getNode()},o.prototype.getNodeLight=function(){return this._views[0].getNodeLight()},t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(239),a=i(1543),s=i(1552),o=i(1413),u=i(1341),h=r.osg,fif(r),l=n.extend({defaults:function(){return{enable:!o(),select:-1,lights:[new a(0),new a(1),new a(2)],webVR:!1}},getName:function(){return"Lighting"},getDefaultFalloff:function(){var t=this._root.getMinimumBound().radius();return 0>t?0:3.90625/(t*t)},setConfigAndDefaultFalloff:function(t){for(var e=this.get("lights"),i=this.getDefaultFalloff(),r=0,n=e.length;n>r;++r)t&&e[r].set(t[r]),e[r].set("falloff",i);this.dirtyScene()},initPresetThreePointLight:function(){this.setConfigAndDefaultFalloff(s.ThreePointLight())},initPresetFullMoonNight:function(){this.setConfigAndDefaultFalloff(s.FullMoonNight())},initPresetLowKeyLight:function(){this.setConfigAndDefaultFalloff(s.LowKeyLight())},initPresetEvilGenius:function(){this.setConfigAndDefaultFalloff(s.EvilGenius())},initPresetFairyCamp:function(){this.setConfigAndDefaultFalloff(s.FairyCamp())},initPreset2HeadLightV1:function(){this.setConfigAndDefaultFalloff(s.TwoHeadLightV1())},init:function(t){this._viewer=t.getViewer(),this._root=t.getScene().getRoot();var e=t.getModel().get("options"),i=e.lighting;if(i&&i.lights){this._ignoreSceneLights=!0;var r=this.get("lights");void 0!==i.enable&&this.set("enable",i.enable);for(var n=e.version,a=u(),s=0;3>s;++s){var o=i.lights[s];(void 0===o.castShadows||1>n&&o.attachedToCamera)&&(o.castShadows=!1),r[s].set(o),void 0!==a.shadowTextureSize&&r[s].set("shadowSize",a.shadowTextureSize)}r[0].get("falloff")&&r[1].get("falloff")&&r[2].get("falloff")||this.dirtyScene()}this._viewer.getPromiseModelDisplayed().then(this.initDepthTexture.bind(this))},initDepthTexture:function(){for(var t=this._viewer.getFeatures().postProcess.getCamera(),e=this.get("lights"),i=0;3>i;++i)e[i].setDepthTexture(t._textureDepth)},dirtyScene:function(){var t=new h.BoundingSphere;this._root.getMinimumBound(t),t.radius()>0?this.recomputeLightsPosition(t):this._viewer&&this._viewer.getPromiseModelDisplayed().then(this.recomputeLightsPosition.bind(this,t))},recomputeLightsPosition:function(t){var e=this.get("lights"),i=.8*t.radius(),r=t.center(),n=h.Matrix.create();h.Matrix.makeTranslate(r[0],r[1],r[2],n);for(var a=this.getDefaultFalloff(),s=0;3>s;++s){var o=e[s],u=o.get("matrix"),l=o.get("falloff");l||o.set("falloff",a),h.Matrix.postMult(n,u),("DIRECTION"===o.get("type")||"HEMI"===o.get("type"))&&h.Matrix.preMultTranslate(u,h.Vec3.createAndSet(0,0,i)),o.dirty()}},initLights:function(t){var e=0,i=this.get("lights");for(e=0;3>e;++e)i[e].setScene(this._root);var r=t.length;for(e=0;r>e;++e)t[e]._node.setNodeMask(0);if(this._ignoreSceneLights)return this.trigger("lightsReady");if(o()){if(0===r)return this.initPresetThreePointLight(),this.trigger("lightsReady");this.set("enable",!0)}else{for(e=0;3>e;++e)i[e].set("castShadows",!1);if(0===r)return this.initPreset2HeadLightV1(),this.trigger("lightsReady");if(r>3)return this.initPresetThreePointLight(),this.trigger("lightsReady")}t.sort(function(t,e){return h.Vec3.length(t.getDiffuse())-h.Vec3.length(e.getDiffuse())});var n=h.Vec3.create();for(e=0;3>e;++e){var a=t[e],s=i[e];if(a){var u=a.getLightType();s.set("type",u),s.set("attachedToCamera",!1),"SPOT"===u&&(s.set("angle",Math.min(90,a.getSpotCutoff())),s.set("hardness",a.getSpotBlend()));var l=a.getDiffuse(),c=Math.max(l[0],l[1],l[2],1);s.set("intensity",c),h.Vec3.mult(l,1/c,s.get("color"));var d=a.getGround(),p=Math.max(d[0],d[1],d[2],1);s.set("intensityGround",p),h.Vec3.mult(d,1/p,s.get("ground")),s.set("falloff",a.getQuadraticAttenuation());var f=a._node;f.setNodeMask(-1);var g=f.getWorldMatrices()[0];f.setNodeMask(0);var m=s.get("matrix");h.Matrix.getScale(g,n),h.Matrix.makeScale(n[0],n[1],n[2],m),h.Matrix.inverse(m,m),h.Matrix.postMult(g,m)}else s.set("falloff",this.getDefaultFalloff()),s.set("type","NONE")}return this.trigger("lightsReady")},getJSON:function(){var t={},e=this.get("lights");return t.enable=this.get("enable"),t.lights=[e[0].getJSON(),e[1].getJSON(),e[2].getJSON()],t}});t.exports=l},function(t,e,i){"use strict";var r=i(239),n=i(1100),a=i(1427),s=i(1544),o=i(1388),u=i(1420),h=i(1341),l=i(1362),c=i(1414),d=n.osg,fif(n),p=n.osgUtil;n.osgShadow.ShadowMap.prototype._preventTextureBindingDuringShadowCasting=function(){for(var t=c(),e=d.StateAttribute.OVERRIDE|d.StateAttribute.ON,i=0;t>i;i++)this._casterStateSet.setTextureAttributeAndModes(i,d.Texture.textureNull,e)};var f=r.extend({defaults:function(){return{type:"NONE",intensity:1,intensityGround:1,enable:!0,color:d.Vec3.createAndSet(1,1,1),ground:d.Vec3.createAndSet(.3,.2,.2),matrix:d.Matrix.create(),matrixPrev:d.Matrix.create(),falloff:0,angle:45,hardness:.5,attachedToCamera:!1,castShadows:!0,shadowBias:.005,shadowSize:1024}},initialize:function(){r.prototype.initialize.apply(this,arguments),u.bind("change:mask",this.dirty,this),this.createNode(arguments[0])},createNode:function(t){this._node=new d.MatrixTransform,this._node.setName("Lighting - Light "+t),this._node.getOrCreateStateSet().setAttributeAndModes(new d.Depth(d.Depth.DISABLE)),this._light=new a(t),this._light.setName("skfb"+this._light.getTypeMember()),d.Vec3.init(this._light.getAmbient()),this._light.setLinearAttenuation(0),this._lightSource=new d.LightSource,this._lightSource.setName("Lighting - LightSource "+t),this._lightSource.setLight(this._light),this._node.addChild(this._lightSource),this._mtQuad=new d.MatrixTransform,this._mtQuad.setName("Lighting - TransformIcon "+t),this._quadGeom=s.createIconGeometry(),this._quadGeom.setName("Lighting -  GeomIcon "+t),this._mtQuad.addChild(this._quadGeom),this._pointGeom=new s.createPointGeometry,this._dirGeom=new s.createDirectionalGeometry(5),this._spotGeom=new s.createSpotGeometry(5),this._hemiGeom=new s.createHemiGeometry(4),this._hemiGeom.getOrCreateStateSet().addUniform(d.Uniform.createFloat4(d.Vec4.createAndSet(0,0,1,1),"uGround")),this._scale=new d.MatrixTransform,this._scale.addChild(this._mtQuad),this._scale.addChild(this._dirGeom),this._scale.addChild(this._hemiGeom),this._scale.setName("Lighting - ScaleIcon "+t),this._geoProxy=new d.Node,this._geoProxy.setName("Lighting - GeometryProxy "+t),this._geoProxy.addChild(this._scale),this._geoProxy.addChild(this._spotGeom),this._geoProxy.addChild(this._pointGeom);var e=this._geoProxy.getOrCreateStateSet();e.addUniform(d.Uniform.createFloat4(d.Vec4.createAndSet(1,1,1,1),"uColor")),e.addUniform(d.Uniform.createInt(1,"uEnable")),e.addUniform(d.Uniform.createInt(0,"uAttachedToCamera")),e.addUniform(d.Uniform.createInt(0,"uTextureDepth")),this._node.addChild(this._geoProxy),this._dirty=!0,this._castShadows=!1,this._enableShadow=c()>12;var i=new n.osgShadow.ShadowSettings;i.setLight(this._light),i.setShadowCastShaderGeneratorName("ShadowCastSkfb"),i.setCastsShadowDrawTraversalMask(o.SHADOW_CAST),i.setCastsShadowBoundsTraversalMask(o.SHADOW_BOUNDS),i.userShadowCasterVisitor=!1;var r=h();i.kernelSizePCF=r.shadowPCF,this._cameraShadows=r.cameraShadows,i.fakePCF=!1,this._shadowMap=new n.osgShadow.ShadowMap(i),this._shadowMap.setTextureUnitBase(12),this._shadowMap.setEnabled(!1),this._scene=null},setDepthTexture:function(t){t&&this._geoProxy.getOrCreateStateSet().setTextureAttributeAndModes(0,t)},setScene:function(t){this._scene=t},getShadowMap:function(){return this._shadowMap},isCastingShadows:function(){return this._enableShadow&&this._castShadows},getLightSource:function(){return this._lightSource},getNodeScale:function(){return this._scale},getNodeQuad:function(){return this._mtQuad},getNode:function(){return this._node},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},updateNode:function(){if(this._dirty){this._dirty=!1;var t=this._node,e=this._light,i=this.get("type");if("NONE"===i)return t.editMask=0,t.setNodeMask(0),e.setEnabled(!1),void(this._castShadows=!1);var r="HEMI"===i&&u.get("mask")&u.PBR;r&&(i="DIRECTION");var n=this.get("enable"),a=this.get("falloff");e.setLightType(i),e.setSpotCutoff("SPOT"===i?this.get("angle"):180),e.setEnabled(n),e.setConstantAttenuation("DIRECTION"!==i?1:a),e.setQuadraticAttenuation("DIRECTION"!==i?a:0),e.setSpotBlend(this.get("hardness")),d.Matrix.copy(this.get("matrix"),t.getMatrix()),t.dirtyBound(),d.Vec3.mult(this.get("color"),this.get("intensity"),e.getDiffuse()),d.Vec3.copy(e.getDiffuse(),e.getSpecular()),d.Vec3.mult(this.get("ground"),this.get("intensityGround"),e.getGround()),this._castShadows=this.get("castShadows")&&("DIRECTION"===i||"SPOT"===i)&&!r,this.getShadowMap().setTextureSize(this.get("shadowSize")),this.getShadowMap().setBias(this.get("shadowBias")),this.isAttachedToCamera()?(t.setReferenceFrame(d.Transform.ABSOLUTE_RF),d.Matrix.makeIdentity(this._scale.getMatrix()),t.setCullingActive(!1),t.editMask=p.NodeGizmo.PICK_ARC,this._cameraShadows||(this._castShadows=!1)):(t.setReferenceFrame(d.Transform.RELATIVE_RF),t.setCullingActive(!0),t.editMask="POINT"===i?p.NodeGizmo.PICK_ARROW|p.NodeGizmo.PICK_PLANE:p.NodeGizmo.PICK_GIZMO),t.setNodeMask(o.PICK_GIZMO_LIGHT);var s=this._scene.getMinimumBound(),h=s.radius(),l=this.multUI_?this.multUI_:s.radius2()/1e3,c=Math.pow(a*l,.125);c=Math.min(Math.max(c,0),1);var f=.05*h*c+.8*h*(1-c);"SPOT"===i&&this._spotGeom.updateCone(e.getSpotCutoff()*Math.PI/180,f),"POINT"===i&&this._pointGeom.updateRadius(f),this._dirGeom.setNodeMask(n&&"DIRECTION"===i?o.NO_PICK_NO_SHADOW:0),this._spotGeom.setNodeMask(n&&"SPOT"===i?o.NO_PICK_NO_SHADOW:0),this._hemiGeom.setNodeMask(n&&"HEMI"===i?o.NO_PICK_NO_SHADOW:0),this._pointGeom.setNodeMask(n&&"POINT"===i?o.NO_PICK_NO_SHADOW:0),d.Vec3.copy(e.getGround(),this._hemiGeom.getOrCreateStateSet().getUniform("uGround").getInternalArray()),d.Vec3.copy(e.getDiffuse(),this._geoProxy.getOrCreateStateSet().getUniform("uColor").getInternalArray());var g=this._geoProxy.getOrCreateStateSet();g.getUniform("uEnable").setInt(0|n),g.getUniform("uAttachedToCamera").setInt(0|this.isAttachedToCamera()),this._quadGeom.setLightType(i)}},setLightUnit:function(t){this._light.getLightNumber()!==t&&(this._light.setLightNumber(t),this._light.setName("skfb"+this._light.getTypeMember()),this._shadowMap.dirty())},setIconVisibility:function(t){this._geoProxy.setNodeMask(t?-1:0)},isAttachedToCamera:function(){var t=this.get("type");return("DIRECTION"===t||"HEMI"===t)&&this.get("attachedToCamera")},resetPosition:function(){d.Matrix.makeIdentity(this._node.getMatrix()),this._scene&&d.Matrix.preMultTranslate(this._node.getMatrix(),this._scene.getMinimumBound().center()),l.draw()},getJSON:function(){var t={};return t.type=this.get("type"),t.enable=this.get("enable"),t.color=this.get("color"),t.intensity=this.get("intensity"),t.ground=this.get("ground"),t.intensityGround=this.get("intensityGround"),t.matrix=this.get("matrix"),t.falloff=this.get("falloff"),t.attachedToCamera=this.get("attachedToCamera"),t.angle=this.get("angle"),t.hardness=this.get("hardness"),t.castShadows=this.get("castShadows"),t.shadowBias=this.get("shadowBias"),t.shadowSize=this.get("shadowSize"),t}});t.exports=f},function(t,e,i){"use strict";var r=i(1100),n=i(1099),a=i(1490),s=i(1545),o=i(1550),u=i(1551),h=r.osg,fif(r),l={},c=function(t,e){if(l[t])return l[t];var i=t.toLowerCase(),r="#define SHADER_NAME "+e+"\n#define "+t+"\n",n=a(),s={};return s["lighting-"+i+"-vert"]=r+o,s["lighting-"+i+"-frag"]=r+u,n.addShaders(s),l[t]=new h.Program(new h.Shader(h.Shader.VERTEX_SHADER,n.getShader("lighting-"+i+"-vert")),new h.Shader(h.Shader.FRAGMENT_SHADER,n.getShader("lighting-"+i+"-frag"))),l[t]},d=function(){return c("LINE","LightingLineGizmo")},p=function(){return c("HEMI","LightingHemiGizmo")},f=function(){return c("ICON","LightingIcon")},g=new h.BlendFunc(h.BlendFunc.ONE,h.BlendFunc.ONE_MINUS_SRC_ALPHA),m={},v=function(t){if(m[t])return m[t];var e=s[t];e||(e=s.DIRECTION);var i=n.instance,r=i.getOrCreateTexture(e);return m[t]=r.texture,r.texture},_={};_.createIconGeometry=function(){var t=h.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),e=t.getOrCreateStateSet();return e.setTextureAttributeAndModes(1,v("DIRECTION")),e.addUniform(h.Uniform.createInt(1,"uTextureIcon")),e.setAttributeAndModes(g),e.setAttributeAndModes(f()),t.setLightType=function(t){e.setTextureAttributeAndModes(1,v(t))},t},_.createDirectionalGeometry=function(t){for(var e=void 0===t?-1:-t,i=e/15,r=5,n=6*r,a=2*Math.PI,s=new Float32Array(6*n),o=0;r>o;++o){var u=6*o,l=a*o/r;s[u]=s[u+3]=Math.cos(l)*i,s[u+1]=s[u+4]=Math.sin(l)*i,s[u+5]=e}var c=new h.DrawArrays(h.PrimitiveSet.LINES,0,n),p=new h.Geometry;return p.getAttributes().Vertex=new h.BufferArray(h.BufferArray.ARRAY_BUFFER,s,3),p.getPrimitives().push(c),p.getOrCreateStateSet().setAttributeAndModes(d()),p.getOrCreateStateSet().setAttributeAndModes(g),p},_.createSpotGeometry=function(t){var e=void 0===t?-1:-t,i=5,r=10*i,n=2*Math.PI,a=new h.Geometry,s=new Float32Array(6*r),o=a.getAttributes().Vertex=new h.BufferArray(h.BufferArray.ARRAY_BUFFER,s,3),u=0,l=new Uint16Array(r);for(u=0;r>u;++u)l[u]=2*u+1;var c=new h.DrawElements(h.PrimitiveSet.LINE_LOOP,new h.BufferArray(h.BufferArray.ELEMENT_ARRAY_BUFFER,l,1)),p=new Uint16Array(2*i),f=2*(r/i);for(u=0;i>u;++u)p[2*u]=u*f,p[2*u+1]=u*f+1;var m=new h.DrawElements(h.PrimitiveSet.LINES,new h.BufferArray(h.BufferArray.ELEMENT_ARRAY_BUFFER,p,1));return a.getPrimitives().push(m,c),a.getOrCreateStateSet().setAttributeAndModes(d()),a.getOrCreateStateSet().setAttributeAndModes(g),a.updateCone=function(t,i){var h=i?2*-i:e,l=Math.cos(t)*h,c=Math.sin(t)*h;for(u=0;r>u;++u){var d=6*u,p=n*u/r;s[d+3]=Math.cos(p)*c,s[d+4]=Math.sin(p)*c,s[d+5]=l}o.dirty(),a.dirtyBound()},a.updateCone(.1),a},_.createHemiGeometry=function(t){for(var e=void 0===t?-1:-t,i=50,r=3*i,n=new h.Geometry,a=new Float32Array(3*r),s=Math.PI,o=3*i,u=0;i>u;++u){var l=3*u,c=s*u/(i-1),d=Math.cos(c),f=Math.sin(c);a[l]=d*e,a[l+2]=-f*e,a[o+l+1]=d*e,a[o+l+2]=-f*e,c=2*s*u/(i-1),a[2*o+l]=Math.cos(c)*e,a[2*o+l+1]=Math.sin(c)*e}n.getAttributes().Vertex=new h.BufferArray(h.BufferArray.ARRAY_BUFFER,a,3);var m=new h.DrawArrays(h.PrimitiveSet.LINE_STRIP,0,i),v=new h.DrawArrays(h.PrimitiveSet.LINE_STRIP,i,i),_=new h.DrawArrays(h.PrimitiveSet.LINE_STRIP,2*i,i);n.getPrimitives().push(m,v,_);var b=n.getOrCreateStateSet();return b.setAttributeAndModes(p()),b.setAttributeAndModes(g),b.addUniform(h.Uniform.createFloat(-e,"uRadius")),n},_.createPointGeometry=function(){var t=2*Math.PI,e=50,i=3*e*3,r=new h.Geometry,n=new Float32Array(3*i),a=r.getAttributes().Vertex=new h.BufferArray(h.BufferArray.ARRAY_BUFFER,n,3),s=new h.DrawArrays(h.PrimitiveSet.LINE_STRIP,0,e),o=new h.DrawArrays(h.PrimitiveSet.LINE_STRIP,e,e),u=new h.DrawArrays(h.PrimitiveSet.LINE_STRIP,2*e,e);return r.getPrimitives().push(s,o,u),r.getOrCreateStateSet().setAttributeAndModes(d()),r.getOrCreateStateSet().setAttributeAndModes(g),r.updateRadius=function(i){for(var s=3*e,o=s+3*e,u=0;e>u;++u){var h=3*u,l=t*u/(e-1);n[h]=n[s+h]=n[o+h+1]=Math.cos(l)*i,n[h+1]=n[s+h+2]=n[o+h+2]=Math.sin(l)*i}a.dirty(),r.dirtyBound()},r.updateRadius(1),r},t.exports=_},function(t,e,i){"use strict";t.exports={DIRECTION:i(1546),SPOT:i(1547),POINT:i(1548),HEMI:i(1549)}},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAER0lEQVR4AezYQUgdxx/AcRukRAM1HrSCkB4tOSQhLxRC2iQYL2JLRIKKnnJoexAphtJbeOmtF2slIr3UsyAxgQZD/qf/IYb/IW1e0cMLheag8uAdtJGmNH/f81NYloEl+4xxTdNCv3OZmZ2d/e7s7G9mt+5f9o6jrnvoqbt61e017flEp20JuPrXCxQkaXmVAl2u6UrUNMGmExrNA2Pp52QXGLYJWDcQanvgdpTtA24I5xiwDtg0nE2gU4JwT71wM8peBG4J9y5JZxaBOSjIWwaWdiGwBMvyCsBcFoEStKnTagPo31lAP2xoVacNKGURWIX2KDsGlDWnC0SezcrCjGwHVrMIzMJMlK1XBCbiTBAIFE1AUX10ZAaYzSJwDqpyUaFbIE0g0B3V51SBc9lew0VYjAsLgLI5eWejujZD8uaUAQvCieHULALHVGEwKnQom3SqRtNTJpV1RPlBoOrYywu85VCiPAIrGqLCwZ16C8cbrAAjwsM0a1XJnM6dBPr8BH4MK9xJj4AhoZkDckZNmXfHvCmjcg4Ixw0BPHIyGsVFAQzXEvhUAA+877hHUHElNDpiXMnzlIw7ElpdUYkVjKhKsllLYBue+E3gPjzTFzc4bNqW2myZdjgM5jMBVTPatSkAXWkCF+Cegxp96XcAlXD589a8mDXng0IFsCgX1+WBa2kCecIRR8zahjD4l1XsjorL4UGwYjBcotXyziPAY++Gig/84Ptw+W27ZzsoDGmIc/XGbADrtebACvzf15riijc0xoNf8XJUnE903a0oMFBL4EOAsk+E18pha16etTAdOywILOnaKQ6c9D+AgjNx5bS9MR2HpjJAWf9uImGPIjAZT8cte2MrjguTwITm3a8FRcQxf9zeGY/XCFDc/WLUBuU46JbsnVI8k8pA204CLcbccCtOYSuXk42csLUUer9hTEtS4KrnyEcHRmVjNI5xKVwVBHqRJKx+U7IxFYejVHrFAndhXp+LQoof2LxszIsmVaLnPvPAXbHAU2hMnY93ZONOaq+NwFOxwEM4kdJwX0YgJZ0AHooFrsOm224Kydl9nANnEz3ftglcFwsctfUa3oItR4XX8LSCJPsfB5IUnJaMhJr06I3TK4mEofceTX/ztaDZxCtZDXcp0K8MlB2UfT/QZANYdOzFAl2WABZ07MuO6D2/CnzmzZ0EBgCKukNl9j1hi29VAVb01hZYhw1j6uOKBkPZdsUhHfdfgY/TBbpgWWuoGLSS8btgzHfeDv1d8hiopAtcg3xcyFncpy+jJ74ID77RfeBCzREoaNNuRpVA9m/Dn10U7hLy6XNgU5KqEdm/jgH/cUbOL2kjENKwQHhvs/8fuPSc72rtONBpTsmqWef28Q/JIZ8T+MNHr+Mf0Tu+cs8D3+j4R/0l+3P0Hyek/0gp/ceK6T9aPlTmC+g/Y0L/OSP6z5rRdd5wxM2c0mbumP4QAJ9CBEfGUf7qAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAD8klEQVR4Ae3ZT2gVVxTH8ZsnqZoqqShV/INQBUORIHYlFqqg+Ac3iguFQMCVGxtwE1BoEEEIgpCNghAsSBVXAVGEuIgQQkAQApUHkoU+IjaQVQiEx3sOn8JwGd7DNE0fk87G89ucN8Pkfs+ZOydzzoSv9tX+yZwz7rN87KM//CwspWBp/S5/O7dygJ/kb3xcOcA9uG2NkIt2eg90rxTgT9gv5Ka7wK//CvCh9HnXuzb3oF/ISWtMxwx83vWh9CE0qsHVbQIwDnO+FQSPtW6/CIJe4C/AhO4lMjC3SUWzxRx0SbRmY43xN1plbtNcSBVCdILrkKhIQB45aIq/+a9f/yIDxuGU4IARSQ45aI4/MeKA4BQw/iUARDdCtJ6D5vjFxaOAZQEaIbIctBx/tvjKAdY1QDxsLQcx/qMNi69bOcAnfQ0Q3y+Rg7pJg3qdccxZfR6oLBF/W8PifT6tHACNEFGDxlKN6LFZ+EL7DRiL6hKaF4f/BtAI0bqyxVsBWB5iix5DRrzw2IAjSssv3joAPBcEnTri+b0eqWm2GX2+adpuzyEXgLilNsSzV1Xx0iV7lNLjh9w0g3JjkTeWK0BUm2GUHRY0q901NQuOri7AbTzTISypQ+Yt6F49gBMSE9pjjes1Zl5dxX37M4SactwLA/kBDMf0T1uwM/W3mcSiV54qI/FbvPYa+mJdyA2gRxCcxY34PJQlBm0UUh30hojQbsZMfCgrOQHEuvZEYkfqDYlRZlrvjSTeiJs4knoP8gFIrBUEs6YEwUZVk0Kq3Y7EswdxP+4DBlKvLx+A2Zh2HqbeaVxJvWOqeB0RyiqxXvA43rRcAN7HWLmTepdxMt4UZAl/qp5d/yIC5gEQ49qOu6l3ERcaHrSq3YLglXlBUMJI6p3JB6CqTVBSMyoI9mV3u92AJ47FnbEY68UeDKVebz4AbBMEk+ZjEXqtpkto0iB6U+8SeuKxnACOC4J+nI/7vG66CaFPYjL2ki/VbInI+QDE8rPVoimlmNy6mvsuOOmKSZRjng7jUeptVs8LYDQev4X+rOq/JlrVkE5B0KGsam/q9+T/z2i9t+rOC1H7XHTZ6awkt3uGq/HXSP4AwQ9m1PUrLTkFmMDw6r0PlCLCW0w5r13ItMMNCxK3ta0ewI8RYb1bFjFv1F13PDQlwbQT8fqOnAHiS+l3GUKwVb9JNcCsJ85msW/Qmd9L6fK9Qcl2u3WuqCeg+MYkh9YsatQNx23Lkr5Wlx7DxpZvzfJsToGqivdmJZBDc1pce178gKL4EU3xQ6oCx3TFDyqjih7VKn5YnanIcX3xHyyK/2RT/EerqKI/24V3be/C/6HMKUpfAf4G8Nhuyum3E8AAAAAASUVORK5CYII="},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAADtElEQVR4Ae3X3YuWCRnH8d/M7AztTs3S7lbshkubyUIRs8zQWk4yLUzFtg7Ftm8NCr2wiWINDOFEB+qBlUKCkahlGhRBUQZ2EtqBeaCTlVpNZb6UKCjWmOOsDmWO8+nEE5l8Zu77uR+CmO/vH/gcXlfmK958HrPCN/3SmNuYMuawnZZ7sxRfFNtyv3XvjnuhkYAXnDd7p/U3AtDpCMBrfuizFntEs2jxiCVW2usGANuqBixxAThvpXb5r3uDQZcBTuiqDvC0azBlszZxZx7XpVeXBXchdgCc1VkNoNWfYMKzIqLdq37mOgAm7LPCHZzlbgJHqgFsgUk9IpqsccXM4KIVIuKjpoCh+gEfBl4U0eGA2n1fm4ghgPfUCxiFPSLa/crsHdAqYj9wtD5AL4x7WMSPzK1viFjkJvCuegCHYaOIl8y1aR8QsRvYVh7QDLctEE3OmHvHRHQC18oDnoVDIvoVq1fE74ElZQFfhi+J+J5ifUvEZmBtWcDPoU/EecU6JaIf+GlZwAVYIN6ieA+JJ4C/lgVMQYvoVrxu0Qr8uywARHxQ8fpEAHUD3q94PRUArsDD4p2K96R4E/D3soDfQLe4z78U64Zm8V5gpCxgN3xaxFHFOiRiFbC9LOBTsEfEBsX6gogfAANlAYvgkibRqUjT3i7uMw68tSwgzsJSEcfNvV+IWAaMSnnAV+C7Il41914WsQ8YrgfwBPzTG0WbS+bWOS3iUbeAh+oBxK/hiyLWmlufF7ERGJH6AM/BZa8THcbN3lXtot1V4Jl6AXEaVon4qtn7mojPAX+Q+gEDcEqTeNy02k17m2jyF+ClKgDxN1gmYlTtRkX0AxelGsAw7BCxXe12itgBrK0K0AXHRKxRu0ERR4GnqwK8Hq6L+JDafUTENeDBqgAxAR3i3WrXLR4AJqU6wGlYJB5Vu8fEQuBslYAj8D7RqnZttc+Q0oAfw8dn/RDOiXge2FslYBg2ifiEaTODKS+K2AQMVwnogTEdIp6xzvoZW6dXxIPGgJ4qAXESfqJJaq7ZXuCkVAtYBnxMau55gOeqBsRWGBSxy8EZ2yViENgqDQWcMLMT//+AecAGWC9iqYMAgIOWilgPbGgEoA9GtYqI1SYBk1aLiFajQF8jADEO+y0UEfd7Sq+n3C8iFtoPjEtjAK8At3xdi9y1FlvcAnilUYAYAvijVZ70gGj2Dp/xOwCGpHGAWGzEvRuxWBoLiHjZP8xswoAUX5TbgG/7s0ncdsZ3fFLKLf7Hmwf8B2VhfPK6+iDRAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAACaUlEQVR4Ae3YP2tTXxzA4U4uIXkLoa+gOEk6BBIkEHCoIP5ZRAV1CYiiCFkkQ6cs2bNm/9Ex4FIt4hIXqYIByZgEHBLN0Hq9z29xVXLuPR2E+zlzep6Q5Pac707RP1hRUVGRkmtGTq38BD+tnBq5pmQndIW+4Kq3En8q8dbViwM0fbVNXzXjA8peA/DOS1c03Xbffbc1XfHSOwB4rRwTULMGFl5p6vsoBQCpj/qaXlkArNViAW5IgJ5bTvytE7f0ABI3YgBuSmHtriPbdOSuNZC6mRdQ9ws+e2hh2xYe+gz8Us8DqNjAqRfOhHTmhVNgo5Id8B6+6UiEluj4BrzPCrgOPPYd4X33GOB6NsACnvsgax88BxbCAe7AF8/k6ZkvwJ1wwCd4Yi5Pc0+AT6GAihQeydsjIFUJAzyFEyfy9vtv8DQM8AbuSeUtdQ94EwaYwwMxegDMwwDn0BOjHnAeBkih478IqwOkYQCwE2kB/xjgDC5F2f4ScBYGmEE1CqAKzMIAY2hFAbSAcRigD90ogC7QDwO0YRIFMAHaYYCSDVRjfQM2SqH/jkdwmBtwCIzCzwN1YDfX9rsAdeFHMscwyAUYAMfZzoQ14CDz9gcAtazH8iEk9jNtvy8BhtnvBWVTWLocvP1lS2CqnOdqtmcFS/uB734JrOzlvZw2nEPiIOCzT4BzjRjX84YVMLC7xQ9vALDSiDWg2DMFOFT9y1PvEICpvbgjmiEAE10tVaXfT+2qlq4JAAyV4w+pao5t07HaxY3p6kY2/tTGSD18TBe6Str6xmZ+gB9mxvraLn5QGX8VgAJQAApAAfgfFtY7wE+okOwAAAAASUVORK5CYII="},function(t,e){t.exports="#ifdef ICON\nattribute vec2 TexCoord0;\nvarying vec2 vTexCoord0;\n#endif\n\n#ifdef HEMI\nvarying vec3 vVertex;\n#endif\n\nattribute vec3 Vertex;\n\nvarying vec4 vViewPos;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvoid main(void) {\n#ifdef ICON\n  vTexCoord0 = TexCoord0;\n#endif\n\n#ifdef HEMI\n  vVertex = Vertex;\n#endif\n\n  vViewPos = ModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = ProjectionMatrix * vViewPos;\n}\n"},function(t,e){t.exports="#ifdef HEMI\nuniform vec4 uGround;\nvarying vec3 vVertex;\nuniform float uRadius;\n#endif\n\n#ifdef ICON\nuniform sampler2D uTextureIcon;\nvarying vec2 vTexCoord0;\nuniform int uEnable;\n#endif\n\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\nuniform int uAttachedToCamera;\n\nuniform vec4 uColor;\n\nvoid main(void) {\n  float fragDepth = (-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize), vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n  float alpha = (uAttachedToCamera == 1 || fragDepth < depth) ? 1.0 : 0.1;\n\n#ifdef HEMI\n  gl_FragColor = vec4(mix(uGround.rgb, uColor.rgb, vVertex.z / uRadius), alpha);\n#endif\n\n#ifdef LINE\n  gl_FragColor = vec4(uColor.rgb, alpha);\n#endif\n\n#ifdef ICON\n  gl_FragColor = vec4(float(uEnable) * uColor.rgb, alpha) * texture2D(uTextureIcon, vTexCoord0);\n#endif\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n";
},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a={};a.ThreePointLight=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(-.9815804500275482,.1909922167095499,-.004668327333101102,0,.13548347102422797,.7131126062169096,.6878332937084056,0,.13469984856318096,.6745312327912614,-.7258536813891331,0,0,0,0,1),color:n.Vec3.createAndSet(.7806122448979592,.7985214493960848,1),intensity:.96},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(.7755211495104662,-.0666602860002539,.6277924441503967,0,.2690483737361956,.9344846523281437,-.233133882464682,0,-.5711216326246741,.3497067926613838,.7426474533145686,0,0,0,0,1),color:n.Vec3.createAndSet(1,.8783319450229073,.7091836734693877),intensity:1},{type:"HEMI",enable:!0,attachedToCamera:!1,matrix:n.Matrix.createAndSet(.6903299131022926,-.7076363669144057,-.15064986988498263,0,-.011089698239978026,.19785137301620165,-.9801692980238416,0,.7234097246160907,.6783108479272498,.12873524736872857,0,0,0,0,1),color:n.Vec3.createAndSet(.423469387755102,.7352665556018328,1),intensity:.12,ground:n.Vec3.createAndSet(.9642857142857143,.6484128636877489,.2607507288629738),intensityGround:.06}]},a.FullMoonNight=function(){return[{type:"HEMI",enable:!0,attachedToCamera:!1,matrix:n.Matrix.createAndSet(.9997395789367833,.0037284998571004493,-.02251383121813605,0,-.003172416108909601,.9996902441347245,.024685047253076783,0,.02259889562202194,-.024607195505995896,.9994417320914686,0,0,0,0,1),color:n.Vec3.createAndSet(.14431486880466474,.20264621883738915,.3928571428571429),intensity:1.5400000000000005,ground:n.Vec3.createAndSet(.9744897959183674,.6276245973191442,.3331164098292378),intensityGround:.06},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(.9321120105125691,.3015730438836578,-.2005514873067817,0,.11902736304545063,-.7780729183457072,-.6167941476566071,0,-.34205216956578893,.5510501183556175,-.7611465564236605,0,0,0,0,1),color:n.Vec3.createAndSet(1,.613390254060806,.19387755102040816),intensity:2.9799999999999995},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(.5165535747993983,-.2459126458378022,-.8201825254045677,0,-.40819067915319995,.771302442076031,-.48833688402577136,0,.7526970000035951,.5870430252243886,.29803978378898704,0,0,0,0,1),color:n.Vec3.createAndSet(1,1,1),intensity:.38}]},a.LowKeyLight=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(.022621146436927503,-.2660807408393079,-.9636852821789301,0,-.18898982664775527,.9454138725983617,-.26547213586781604,0,.9817184571747294,.1881319984823789,-.02890020742997683,0,0,0,0,1),color:n.Vec3.createAndSet(1,1,1),intensity:1},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(-.9330760233019924,.058913139300351657,.35482161258401,0,.19787524547993016,.9078715652207372,.36961413432105955,0,-.30035732380815566,.4150885003001482,-.8587706416461712,0,0,0,0,1),color:n.Vec3.createAndSet(1,1,1),intensity:.22},{type:"NONE",enable:!0}]},a.EvilGenius=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!1,matrix:n.Matrix.createAndSet(.9967621126545051,.025235816589958687,.07634424888336766,0,.000702423157861877,-.9521689363972996,.3055713061819492,0,.08040396369728874,-.3045282747481311,-.9491036468693457,0,0,0,0,1),color:n.Vec3.createAndSet(1,.3450645564348185,.056122448979591844),intensity:1.5400000000000005},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(-.7932202797763206,.039941473670798935,.6076234577701727,0,.16089796285361985,.9761307284151629,.14587887644631273,0,-.5872933111326324,.21347945972549276,-.780713191238742,0,0,0,0,1),color:n.Vec3.createAndSet(.15368596418159094,.7346938775510203,.20111518159950362),intensity:1.9000000000000008},{type:"HEMI",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(.9998681367204546,.01574007797565349,.003994886292083951,0,0,.24600379421877677,-.9692688652948499,0,-.016239124704439348,.9691410543235108,.24597135535169048,0,0,0,0,1),color:n.Vec3.createAndSet(.9897959183673469,.674842115105101,.02524989587671801),intensity:.02,ground:n.Vec3.createAndSet(.3,.2,.2),intensityGround:.98}]},a.FairyCamp=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(.7285122591021403,-.5166704810444328,-.44980162555865727,0,.2899427624247639,.827461680647148,-.4808745798834604,0,.6206473095530125,.21990630067806594,.752620844826062,0,0,0,0,1),color:n.Vec3.createAndSet(.8476936693044566,.8957603762037927,.9948979591836735),intensity:.9},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(.08433618912371937,-.8568665398386119,-.5085932953835439,0,-.8584235966554874,-.3216498975444721,.39956260099599905,0,-.5059608047162799,.40289089877364465,-.7626811835729392,0,0,0,0,1),color:n.Vec3.createAndSet(.37244897959183676,.538942107455227,1),intensity:1.7200000000000006},{type:"HEMI",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(.9766324883850551,-.001534767629049323,.21491074221438983,0,.14494434684687327,-.7336231034872216,-.6639188793421307,0,.15868244688039193,.6795548443783637,-.7162577012039377,0,0,0,0,1),color:n.Vec3.createAndSet(.3389212827988338,.7142857142857143,.346581781400607),intensity:.5,ground:n.Vec3.createAndSet(.9947417742607245,.48469387755102045,1),intensityGround:.14}]},a.TwoHeadLightV1=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.Matrix.createAndSet(Math.SQRT1_2,0,Math.SQRT1_2,0,-0,1,0,0,-Math.SQRT1_2,-0,Math.SQRT1_2,0,0,0,0,1),color:n.Vec3.createAndSet(.6,.48,.3),intensity:1},{enable:!0,attachedToCamera:!0,type:"DIRECTION",matrix:n.Matrix.createAndSet(Math.SQRT1_2,0,-Math.SQRT1_2,0,0,1,0,0,Math.SQRT1_2,0,Math.SQRT1_2,0,0,0,0,1),color:n.Vec3.createAndSet(.42,.42,.6),intensity:1},{type:"NONE",enable:!0}]},t.exports=a},function(t,e,i){"use strict";var r=i(1100),n=i(258),a=i(1388),s=i(1362),o=i(1390),u=i(1357),h=r.osg,fif(r),l=n.extend({initialize:function(t){n.prototype.initialize.apply(this,arguments),this.model.bind("change:select",this.onSelectChanged,this),this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change",s.draw),this._viewer=t.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._hasAnimation=!1,u.getPromise().then(function(t){t&&(this._hasAnimation=t)}.bind(this)),this._nodeFeature=new h.Node,this._nodeFeature.setName("Feature - Lighting"),this._lightNode=new h.Camera,this._lightNode.setName("Lighting - Camera"),this._lightNode.setNearFarRatio(5e-5),this._lightNode.getOrCreateStateSet().setRenderBinDetails(o.EDITOR_GIZMO,"RenderBin"),this._lightNode.setNodeMask(a.NO_SHADOW),this.initLightNode(),this.onEnableChanged(),this._viewer.getPromiseModelDisplayed().then(this.handleOpacity.bind(this))},getNode:function(){return this._nodeFeature},getNodeLight:function(){return this._lightNode},handleOpacity:function(){this._nodeFeature.addChild(this._lightNode);var t=this._viewer.getFeatures().material;if(t)for(var e=t.getModel().attributes,i=Object.keys(e),r=this.model.get("lights"),n=r.length,a=0,s=i.length;s>a;++a)for(var o=e[i[a]],u=o.getChannels().Opacity,h=0;n>h;++h)u.bind("change",r[h].dirty,r[h])},onEnableChanged:function(){var t=this.model.get("enable");if(this._lightNode.setNodeMask(t?a.NO_SHADOW:0),!t){var e=this.getGizmo();e&&e.attachToGeometry(null)}for(var i=this.model.get("lights"),r=0,n=i.length;n>r;++r){var s=i[r].get("enable");i[r].getLightSource().getLight().setEnabled(s&&t)}this.updateLights()},initLightNode:function(){var t=function(){};t.prototype={update:this.updateLights.bind(this)},this._lightNode.addUpdateCallback(new t);for(var e=this.model.get("lights"),i=0,r=e.length;r>i;++i){var n=e[i];n.setLightUnit(i),n.bind("change",n.dirty,n),n.bind("change",s.draw),this._lightNode.addChild(n.getNode())}},getGizmo:function(){var t=this._viewer.getFeaturesManager();return t?t.getNodeGizmo():null},onSelectChanged:function(){var t=this.getGizmo();if(t){var e=this.model.get("select");return-1===e?void t.attachToGeometry(null):void t.attachToMatrixTransform(this.model.get("lights")[e].getNode())}},updateSelection:function(){var t=this._viewer.getFeaturesManager().getNodeGizmo();if(t&&!t._isEditing){var e=t._attachedNode;if(-1!==this.model.get("select")||e){for(var i=-1,r=this.model.get("lights"),n=0;3>n;++n)if(r[n].getNode()===e){t.updateGizmoMask(),i=n;break}this.model.set("select",i)}}},updateLightIcons:function(){var t=h.Vec4.create(),e=h.Vec3.create(),i=h.Vec3.create(),r=h.Quat.create();return function(){var n=this.model.get("lights"),a=this._viewer.getCamera(),s=.02*this._viewerOSGJS.getCanvasClientWidth()*h.Matrix.getScale(a.getProjectionMatrix(),t)[0];this._manipulator.getEyePosition(i);for(var o=0;3>o;++o){var u=n[o];if("NONE"!==u.get("type")){var l=u.getNode(),c=u.getNodeQuad(),d=u.getNodeScale();if(u.isAttachedToCamera()){var p=u.get("matrix");h.Matrix.getTrans(p,e);var f=l.getMatrix();h.Matrix.copy(f,p),h.Matrix.setTrans(p,e[0],e[1],e[2]),h.Matrix.inverse(h.Matrix.setTrans(f,0,0,0),c.getMatrix()),h.Matrix.setTrans(f,10*(o-1),5,-s)}else{var g=l.getWorldMatrices()[0];h.Matrix.getTrans(g,e);var m=h.Vec3.distance(i,e)/s;h.Matrix.makeScale(m,m,m,d.getMatrix());var v=c.getMatrix();h.Matrix.mult(a.getViewMatrix(),g,v),h.Matrix.inverse(v,v),h.Matrix.makeRotateFromQuat(h.Matrix.getRotate(v,r),v),h.Matrix.copy(l.getMatrix(),u.get("matrix"))}c.dirtyBound(),l.dirtyBound(),d.dirtyBound()}}}}(),updateLights:function(){var t=this._viewer.getOptions().widgetAPI,e=t&&"lighting"===t.getTabbedWidget().get()&&this.model.get("enable"),i=this._viewer.getFeaturesManager();if(!i)return!0;var r=i.getNodeShadows(),n=this._viewer.getSuperSample()&&this._viewer.getSuperSample().isEnabled(),a=!!this._hasAnimation;i.getFeatures().autospin.getModel().get("enable")===!0&&(a=!0);for(var s="lit"===i.getFeatures().shadingStyle.getModel().get("style"),o=this.model.get("webVR"),u=this.model.get("lights"),l=0;3>l;++l){var c=u[l],d=a||c.isDirty();c.updateNode();var p=c.getShadowMap(),f=o&&c.isAttachedToCamera();if(!f&&s&&c.get("enable")&&c.isCastingShadows()){if(d=d||c.isAttachedToCamera()||n,!d){for(var g=c.get("matrix"),m=c.get("matrixPrev"),v=0;16>v;v++)if(g[v]!==m[v]){d=!0;break}h.Matrix.copy(g,m)}d&&p.requestRedraw(),r.addShadowTechnique(p)}else(d||f)&&r.removeShadowTechnique(p);c.setIconVisibility(e)}return e?(this.updateLightIcons(),this.updateSelection(),!0):!0}});t.exports=l},function(t,e,i){"use strict";var r=i(1097),n=i(1555),a=i(1556),s={FeatureName:"postProcess",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNodeIn=function(){return this._views[0]._nodeIn},o.prototype.getNodeOut=function(){return this._views[0]._nodeOut},o.prototype.getCamera=function(){return this._views[0]._camera},t.exports=o},function(t,e,i){"use strict";var r=i(239),n=i(1100),a=i(1341),s=i(1413),o=n.osg,fif(n),u=r.extend({defaults:{enable:a().postProcess,grainEnable:!1,grainAnimated:!1,grainFactor:.15,sharpenEnable:!1,sharpenFactor:.2,chromaticAberrationEnable:!1,chromaticAberrationFactor:.05,vignetteEnable:!1,vignetteLens:o.Vec2.createAndSet(.8,.25),bloomEnable:!1,bloomThreshold:0,bloomFactor:.5,bloomRadius:.7,toneMappingEnable:!1,toneMappingMethod:"default",toneMappingExposure:1,toneMappingBrightness:0,toneMappingContrast:0,toneMappingSaturation:1,colorBalanceEnable:!1,colorBalanceLow:o.Vec3.create(),colorBalanceMid:o.Vec3.create(),colorBalanceHigh:o.Vec3.create(),dofEnable:!1,dofBlurNear:.5,dofBlurFar:.5,dofFocusPoint:o.Vec3.create(),webVR:!1,doDistortionVR:!1,distortion:o.Vec2.createAndSet(.441,.156),projectionLeft:o.Vec4.createAndSet(1,1,-.5,-.5),unprojectionLeft:o.Vec4.createAndSet(1,1,-.5,-.5)},getName:function(){return"PostProcess"},getViewer:function(){return this._viewer},init:function(t){this._viewer=t.getViewer();var e=t.getModel().get("options");if(e.scene&&e.scene.postProcess){var i=e.scene.postProcess;void 0!==i.enable&&a().postProcess&&this.set("enable",i.enable),i.grain&&(this.set("grainEnable",i.grain.enable),this.set("grainAnimated",i.grain.animated),this.set("grainFactor",i.grain.factor)),i.sharpen&&(this.set("sharpenEnable",i.sharpen.enable),this.set("sharpenFactor",i.sharpen.factor)),i.chromaticAberration&&(this.set("chromaticAberrationEnable",i.chromaticAberration.enable),this.set("chromaticAberrationFactor",i.chromaticAberration.factor)),i.vignette&&(this.set("vignetteEnable",i.vignette.enable),this.set("vignetteLens",i.vignette.lens)),i.bloom&&(this.set("bloomEnable",i.bloom.enable),this.set("bloomFactor",i.bloom.factor),this.set("bloomThreshold",i.bloom.threshold),i.bloom.radius&&this.set("bloomRadius",i.bloom.radius)),i.toneMapping&&(this.set("toneMappingEnable",i.toneMapping.enable),this.set("toneMappingExposure",i.toneMapping.exposure),this.set("toneMappingBrightness",i.toneMapping.brightness),this.set("toneMappingContrast",i.toneMapping.contrast),this.set("toneMappingSaturation",i.toneMapping.saturation),this.set("toneMappingMethod",i.toneMapping.method)),i.colorBalance&&(this.set("colorBalanceEnable",i.colorBalance.enable),i.colorBalance.low&&this.set("colorBalanceLow",i.colorBalance.low),i.colorBalance.mid&&this.set("colorBalanceMid",i.colorBalance.mid),i.colorBalance.high&&this.set("colorBalanceHigh",i.colorBalance.high)),i.dof&&(this.set("dofEnable",i.dof.enable),this.set("dofBlurNear",i.dof.blurNear),this.set("dofBlurFar",i.dof.blurFar),this.set("dofFocusPoint",i.dof.focusPoint))}if(s()){var r=t.getViewer();r.getPromiseMaterialLoaded().then(function(){"Tilt Brush"===r.getRootUserData().authoringTool&&(this.set("bloomEnable",!0),this.set("bloomThreshold",.6),this.set("bloomFactor",1.6),this.set("bloomRadius",.2),this.set("toneMappingEnable",!0),this.set("toneMappingMethod","filmic"))}.bind(this))}},getJSON:function(){return{enable:this.get("enable"),grain:{enable:this.get("grainEnable"),animated:this.get("grainAnimated"),factor:this.get("grainFactor")},sharpen:{enable:this.get("sharpenEnable"),factor:this.get("sharpenFactor")},chromaticAberration:{enable:this.get("chromaticAberrationEnable"),factor:this.get("chromaticAberrationFactor")},vignette:{enable:this.get("vignetteEnable"),lens:this.get("vignetteLens")},bloom:{enable:this.get("bloomEnable"),factor:this.get("bloomFactor"),threshold:this.get("bloomThreshold"),radius:this.get("bloomRadius")},toneMapping:{enable:this.get("toneMappingEnable"),method:this.get("toneMappingMethod"),exposure:this.get("toneMappingExposure"),brightness:this.get("toneMappingBrightness"),contrast:this.get("toneMappingContrast"),saturation:this.get("toneMappingSaturation")},colorBalance:{enable:this.get("colorBalanceEnable"),low:this.get("colorBalanceLow"),mid:this.get("colorBalanceMid"),high:this.get("colorBalanceHigh")},dof:{enable:this.get("dofEnable"),blurNear:this.get("dofBlurNear"),blurFar:this.get("dofBlurFar"),focusPoint:this.get("dofFocusPoint")}}}});t.exports=u},function(t,e,i){"use strict";var r=i(1100),n=i(258),a=i(1389),s=i(1557),o=i(1490),u=i(1388),h=i(1362),l=i(1341),c=i(1559),d=i(1361),p=i(1447),f=i(1093),g=i(1359),m=i(284),v=i(1560),_=i(1561),b=i(1562),x=i(1563),A=i(1564),y=r.osg,fif(r),S=r.osgUtil,C=1,w=7,T=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments);var t=this.model,e={"postProcess.glsl":v,"postProcess-antiAlias.glsl":_,"postProcess-distortion.glsl":b,"postProcess-pingpong.frag":x,"dof.glsl":A};o().addShaders(e),this._dirty=!0,this._effectiveConfig={},a.bind("change:hasTransparency",this.dirty,this),a.bind("change:hasExtra",this.dirty,this),t.bind("change:webVR",this.onVR,this),t.bind("change:distortVR",this.dirty,this),t.bind("change:enable",this.dirty,this),t.bind("change:grainEnable",this.checkGrainEnable,this),t.bind("change:sharpenEnable",this.checkSharpenEnable,this),t.bind("change:chromaticAberrationEnable",this.checkChromaticAberrationEnable,this),t.bind("change:vignetteEnable",this.checkVignetteEnable,this),t.bind("change:bloomEnable",this.checkBloomEnable,this),t.bind("change:dofEnable",this.checkDofEnable,this),t.bind("change:toneMappingEnable",this.dirty,this),t.bind("change:colorBalanceEnable",this.dirty,this),t.bind("change:distortion",this.onDistortionChanged,this),t.bind("change:projectionLeft",this.onProjectionLeftChanged,this),t.bind("change:unprojectionLeft",this.onUnprojectionLeftChanged,this),t.bind("change:grainFactor",this.onGrainFactor,this),t.bind("change:sharpenFactor",this.onSharpenFactor,this),t.bind("change:chromaticAberrationFactor",this.onChromaticAberrationFactor,this),t.bind("change:vignetteLens",this.onVignetteLensChanged,this),t.bind("change:bloomFactor",this.onBloomFactorChanged,this),t.bind("change:bloomThreshold",this.onBloomThresholdChanged,this),t.bind("change:bloomRadius",this.onBloomRadiusChanged,this),t.bind("change:toneMappingExposure",this.onToneMappingExposureChanged,this),t.bind("change:toneMappingBrightness",this.onToneMappingBrightnessChanged,this),t.bind("change:toneMappingContrast",this.onToneMappingContrastChanged,this),t.bind("change:toneMappingSaturation",this.onToneMappingSaturationChanged,this),t.bind("change:toneMappingMethod",this.onToneMappingMethodChanged,this),t.bind("change:colorBalanceLow",this.onColorBalanceShiftChanged,this),t.bind("change:colorBalanceMid",this.onColorBalanceShiftChanged,this),t.bind("change:colorBalanceHigh",this.onColorBalanceShiftChanged,this),t.bind("change:dofFocusPoint",this.onDofFocusPoint,this),t.bind("change:dofBlurNear",this.onDofBlurNear,this),t.bind("change:dofBlurFar",this.onDofBlurFar,this),t.bind("change",h.draw),t.on("pingPongTexture0",this.onPingPongTexture0,this);var i=this._viewer=this.model._viewer;this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._hasTriangles=i.getOrCreateScene().getJSON().faceCount>0,c.setDoEarlyZ(this._hasTriangles),i.getCamera().getRenderer().setRenderStage(new c),this._lastUpdateTime=this._viewerOSGJS.getFrameStamp().getSimulationTime(),this._dofAutoFocus=!1,this._requestDrawPostProcess=!1,this._interpolatorDofFocal=new r.osgGA.OrbitManipulator.Interpolator(1),this._interpolatorDofBlurNear=new r.osgGA.OrbitManipulator.Interpolator(1),this._interpolatorDofBlurFar=new r.osgGA.OrbitManipulator.Interpolator(1),this._interpolatorDofCross=new r.osgGA.OrbitManipulator.Interpolator(1,.08),this._interpolatorDofCross._epsilon=-.01,this._tmpVec3=y.Vec3.create(),this._eyePos=y.Vec3.create(),this._dofLastPos=y.Vec3.create(),this._dofLastFocal=0,this._texturesRTT={},this._isOnMobile=!1,this._uniforms=this.createUniforms(),this.initSceneGraph(),this.hookCheckNeedToDoFrame(),this._viewer.getPromiseMaterialLoaded().then(function(){this._nodeBackground=this._viewer.getFeatures().environment.getNode().getBackground(),this._backgroundModel=i.getFeatures().background.getModel(),this._backgroundModel.bind("change:enable",this.dirty,this),this._backgroundModel.bind("backgroundUpdated",this.onBackgroundUpdated,this),this._backgroundModel.bind("change:color",this.onBackgroundColor,this)}.bind(this))},getPixelRatio:function(){return this._viewerOSGJS.getCanvasPixelRatio()},createUniforms:function(){var t=this.model;return{uDistortion:y.Uniform.createFloat2(t.get("distortion"),"uDistortion"),uProjectionLeft:y.Uniform.createFloat4(t.get("projectionLeft"),"uProjectionLeft"),uUnprojectionLeft:y.Uniform.createFloat4(t.get("unprojectionLeft"),"uUnprojectionLeft"),uTimeGrain:y.Uniform.createFloat(this._lastUpdateTime,"uTimeGrain"),uGrainFactor:y.Uniform.createFloat(t.get("grainFactor"),"uGrainFactor"),uSharpFactor:y.Uniform.createFloat(t.get("sharpenFactor"),"uSharpFactor"),uChromaFactor:y.Uniform.createFloat(t.get("chromaticAberrationFactor"),"uChromaFactor"),uLensRadius:y.Uniform.createFloat2(t.get("vignetteLens"),"uLensRadius"),uBloomFactor:y.Uniform.createFloat(t.get("bloomFactor"),"uBloomFactor"),uBloomThreshold:y.Uniform.createFloat(t.get("bloomThreshold"),"uBloomThreshold"),uBloomRadius:y.Uniform.createFloat(t.get("bloomRadius"),"uBloomRadius"),uToneExposure:y.Uniform.createFloat(t.get("toneMappingExposure"),"uToneExposure"),uToneBrightness:y.Uniform.createFloat(t.get("toneMappingBrightness"),"uToneBrightness"),uToneContrast:y.Uniform.createFloat(t.get("toneMappingContrast"),"uToneContrast"),uToneSaturation:y.Uniform.createFloat(t.get("toneMappingSaturation"),"uToneSaturation"),uToneMethod:y.Uniform.createInt(this.methodToInt(t.get("toneMappingMethod")),"uToneMethod"),uColorBalanceLow:y.Uniform.createFloat3(t.get("colorBalanceLow"),"uColorBalanceLow"),uColorBalanceMid:y.Uniform.createFloat3(t.get("colorBalanceMid"),"uColorBalanceMid"),uColorBalanceHigh:y.Uniform.createFloat3(t.get("colorBalanceHigh"),"uColorBalanceHigh"),uDofBlurNearFarFocal:y.Uniform.createFloat3(y.Vec3.createAndSet(t.get("dofBlurNear"),t.get("dofBlurFar"),.5),"uDofBlurNearFarFocal"),uDofCross:y.Uniform.createFloat3(y.Vec3.create(),"uDofCross"),uDofScale:y.Uniform.createFloat(1,"uDofScale"),uNearFar:this._viewer.getCamera().getRenderer().getCullVisitor().getNearFarUniform(),uRenderSize:y.Uniform.createFloat2(y.Vec2.create(),"RenderSize"),uOutputLinear:y.Uniform.createInt(1,"uOutputLinear"),uRGBMRange:y.Uniform.createFloat(w,"uRGBMRange"),uPixelRatio:y.Uniform.createFloat(1,"uPixelRatio"),uTime:y.Uniform.createFloat(this._lastUpdateTime,"uTime")}},methodToInt:function(t){return"reinhard"===t?1:"filmic"===t?2:0},dirty:function(){this._dirty=!0},hookCheckNeedToDoFrame:function(){var t=this._camera,e=this._viewerOSGJS,i=e.checkNeedToDoFrame,r=this._viewer.getSuperSample(),n=this;e.checkNeedToDoFrame=function(){var e=i.call(this),a=n._requestDrawPostProcess;return n._requestDrawPostProcess=!1,e||!a?(r.setSwitch(!n.model.get("webVR")),t.setNodeMask(-1),e):(r.setSwitch(!1),t.setNodeMask(0),!0)};var a=e.frame;e.frame=function(){a.call(this),t.setNodeMask(-1),this._hmd&&this._hmd.isPresenting&&(r.setSwitch(!1),t.setNodeMask(0),this.getCamera().getRenderer().draw())}},getSupportedFloatTexture:function(){var t=y.WebGLCaps.instance();return t.hasLinearHalfFloatRTT()?y.Texture.HALF_FLOAT:t.hasHalfFloatRTT()?y.Texture.HALF_FLOAT:t.hasLinearFloatRTT()?y.Texture.FLOAT:t.hasFloatRTT()?y.Texture.FLOAT:y.Texture.UNSIGNED_BYTE},initSceneGraph:function(){var t=this._uniforms;this._nodeIn=new y.Node,this._nodeIn.setName("PostProcess - node In"),this._nodeIn.addUpdateCallback(this);var e=this._nodeIn.getOrCreateStateSet();e.addUniform(t.uOutputLinear),e.addUniform(t.uRGBMRange),e.addUniform(t.uPixelRatio),e.addUniform(c.getDrawOpaqueUniform()),e.addUniform(t.uNearFar),e.addUniform(t.uDofBlurNearFarFocal),e.addUniform(t.uTime),this._nodeOut=new y.Node,this._nodeOut.setName("PostProcess - node Out"),this._camera=this.createMainCamera(),this._nodeIn.addChild(this._camera),this._camera.addChild(this._nodeOut)},isEffectiveGrain:function(){return!this.model.get("webVR")&&this.model.get("grainEnable")&&this.model.get("grainFactor")>=5e-4},isEffectiveSharpen:function(){return!this.model.get("webVR")&&this.model.get("sharpenEnable")&&this.model.get("sharpenFactor")>=5e-4},isEffectiveChromaticAberration:function(){return!this.model.get("webVR")&&this.model.get("chromaticAberrationEnable")&&this.model.get("chromaticAberrationFactor")>=.001},isEffectiveVignette:function(){return!this.model.get("webVR")&&this.model.get("vignetteEnable")&&this.model.get("vignetteLens")[1]<=.5*Math.sqrt(2)},isEffectiveBloom:function(){return(!this.model.get("webVR")||!m.any)&&this.model.get("bloomEnable")&&this.model.get("bloomFactor")>=.01},isEffectiveToneMapping:function(){return this.model.get("toneMappingEnable")},isEffectiveColorBalance:function(){return this.model.get("colorBalanceEnable")},isEffectiveDof:function(){return!this.model.get("webVR")&&this.model.get("dofEnable")&&(this.model.get("dofBlurNear")>=.01||this.model.get("dofBlurFar")>=.01)},checkGrainEnable:function(){this._effectiveConfig.useGrain!==this.isEffectiveGrain()&&this.dirty()},checkSharpenEnable:function(){this._effectiveConfig.useSharpen!==this.isEffectiveSharpen()&&this.dirty()},checkChromaticAberrationEnable:function(){this._effectiveConfig.useChromaticAberration!==this.isEffectiveChromaticAberration()&&this.dirty()},checkVignetteEnable:function(){this._effectiveConfig.useVignette!==this.isEffectiveVignette()&&this.dirty()},checkBloomEnable:function(){this._effectiveConfig.useBloom!==this.isEffectiveBloom()&&this.dirty()},checkDofEnable:function(){this._effectiveConfig.useDof!==this.isEffectiveDof()&&this.dirty()},onDistortionChanged:function(){this._uniforms.uDistortion.setFloat2(this.model.get("distortion"))},onProjectionLeftChanged:function(){this._uniforms.uProjectionLeft.setFloat4(this.model.get("projectionLeft"))},onUnprojectionLeftChanged:function(){this._uniforms.uUnprojectionLeft.setFloat4(this.model.get("unprojectionLeft"))},onGrainFactor:function(){this._uniforms.uGrainFactor.setFloat(this.model.get("grainFactor")),this.checkGrainEnable()},onSharpenFactor:function(){this._uniforms.uSharpFactor.setFloat(this.model.get("sharpenFactor")),this.checkSharpenEnable()},onChromaticAberrationFactor:function(){this._uniforms.uChromaFactor.setFloat(this.model.get("chromaticAberrationFactor")),this.checkChromaticAberrationEnable()},onVignetteLensChanged:function(){this._uniforms.uLensRadius.setFloat2(this.model.get("vignetteLens")),this.checkVignetteEnable()},onBloomFactorChanged:function(){this._uniforms.uBloomFactor.setFloat(this.model.get("bloomFactor")),this.checkBloomEnable()},onBloomThresholdChanged:function(){this._uniforms.uBloomThreshold.setFloat(this.model.get("bloomThreshold")),this.checkBloomEnable()},onBloomRadiusChanged:function(){this._uniforms.uBloomRadius.setFloat(this.model.get("bloomRadius")),this.checkBloomEnable()},onColorBalanceShiftChanged:function(){this._uniforms.uColorBalanceLow.setFloat3(this.model.get("colorBalanceLow")),this._uniforms.uColorBalanceMid.setFloat3(this.model.get("colorBalanceMid")),this._uniforms.uColorBalanceHigh.setFloat3(this.model.get("colorBalanceHigh"))},onToneMappingExposureChanged:function(){this._uniforms.uToneExposure.setFloat(this.model.get("toneMappingExposure"))},onToneMappingBrightnessChanged:function(){this._uniforms.uToneBrightness.setFloat(this.model.get("toneMappingBrightness"))},onToneMappingContrastChanged:function(){this._uniforms.uToneContrast.setFloat(this.model.get("toneMappingContrast"))},onToneMappingSaturationChanged:function(){this._uniforms.uToneSaturation.setFloat(this.model.get("toneMappingSaturation"))},onToneMappingMethodChanged:function(){this._uniforms.uToneMethod.setInt(this.methodToInt(this.model.get("toneMappingMethod")))},computeFocalDistance:function(){var t=y.Vec4.create();return function(){var e=this.model.get("dofFocusPoint");y.Vec3.copy(e,t)[3]=1;var i=this._viewer.getCamera();y.Matrix.transformVec4(i.getViewMatrix(),t,t),y.Matrix.transformVec4(i.getProjectionMatrix(),t,t);var r=this._uniforms.uNearFar.getInternalArray();return(t[3]-r[0])/(r[1]-r[0])}}(),showDofCross:function(){this._interpolatorDofCross.getCurrent()[0]=1,this._interpolatorDofCross.setTarget(0),y.Vec3.copy(this.model.get("dofFocusPoint"),this._dofLastPos),this._dofLastFocal=this._interpolatorDofFocal.getCurrent()[0],h.draw()},onDofFocusPoint:function(){this._interpolatorDofFocal.setTarget(this.computeFocalDistance()),this.showDofCross(),this._dofAutoFocus=!1},onDofBlurNear:function(){this._interpolatorDofBlurNear.setTarget(this.model.get("dofBlurNear")),this.checkDofEnable()},onDofBlurFar:function(){this._interpolatorDofBlurFar.setTarget(this.model.get("dofBlurFar")),this.checkDofEnable()},getOrCreateTextureRTT:function(t,e,i,r){e=e||"default",t=t||1,r=r||y.Texture.UNSIGNED_BYTE,i=i||y.Texture.NEAREST;var n=Math.max(1,Math.round(this._viewerOSGJS.getCanvasWidth()/t)),a=Math.max(1,Math.round(this._viewerOSGJS.getCanvasHeight()/t)),s=e+t+"_"+r+"_"+i,o=this._texturesRTT[s];return o?(o.setTextureSize(n,a),o):(o=this._texturesRTT[s]=new y.Texture,o.setInternalFormatType(r),o.setTextureSize(n,a),o.setInternalFormat(y.Texture.RGBA),o.setMinFilter(i),o.setMagFilter(i),o.setName(s),o.divisor=t,o)},getOrCreateTextureOpaque:function(t){return this.getOrCreateTextureRTT(1,"opaque",t)},getOrCreateTextureTransparent:function(){return this.getOrCreateTextureRTT(1,"transparent",y.Texture.NEAREST,this.getSupportedFloatTexture())},getOrCreateTextureDepth:function(){return this.getOrCreateTextureRTT(1,"depth",y.Texture.NEAREST)},getOrCreateTextureExtra:function(){return this.getOrCreateTextureRTT(1,"extra")},createMainCamera:function(){var t=new y.Camera;return t.setName("PostProcess - MainCamera"),t.setRenderOrder(y.Camera.PRE_RENDER,0),t.getOrCreateStateSet().addUniform(this._uniforms.uRenderSize),t.attachRenderBuffer(y.FrameBufferObject.DEPTH_ATTACHMENT,y.FrameBufferObject.DEPTH_COMPONENT16),t},createCameraAA:function(t,e){var i=new y.Camera;return i.setName("PostProcess - "+t),i.setRenderOrder(y.Camera.PRE_RENDER,0),i.attachTexture(y.FrameBufferObject.COLOR_ATTACHMENT0,e),i.setClearMask(0),i},createFilter:function(t,e,i,r){t=t||{};var n=new s([],[],o());n.setPostProcessConfiguration(t);var a=r||new S.Composer.Filter.Custom(n.createFragmentShader(),e);return i&&a.setVertexShader(i),a},addCompositeBackground:function(t,e){"fixed"===this._backgroundModel.get("enable")&&(t.useComposeBackground=!0,e.TextureFixed=this._nodeBackground.getBackground()||g.dummyTexture,e.uFixedScale=this._nodeBackground.getUniforms().scale,e.TextureDepth=this._camera._textureDepth)},addMergeOpacityPass:function(t,e){var i={isPassMergeOpacity:!0,RGBMTexture0:w,RGBMTextureTransparent:void 0,encodeRGBM:e.outputInSRGB?null:w},r={uOutputLinear:y.Uniform.createInt(e.outputInSRGB?0:1,"uOutputLinear"),Texture0:e.inputTexture,TextureTransparent:this._camera._textureTransparent};e.composeBackground&&this.addCompositeBackground(i,r);var n=this.getOrCreateTextureRTT(1,"mergeableOpacity",e.outputFiltering),a=t.addPass(this.createFilter(i,r),n);return a.setFragmentName("MergeOpacity"),e.composeBackground&&(this._stateSetCompositeBG=a.getStateSet()),n},getPackFunc:function(t){return["vec4 pack( const in vec4 col ) {","    vec4 rgbm;","    vec3 color = col.rgb / "+t+";","    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );","    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;","    rgbm.rgb = color / rgbm.a;","    return rgbm;","}"].join("\n")},getUnpackFunc:function(t){return["vec4 unpack( const in sampler2D tex, const in vec2 uv ) {","    vec4 col = texture2D(tex, uv);","    return vec4("+t+" * col.rgb * col.a, 1.0);","}"].join("\n")},updateDofScaleUniform:function(){var t=l().dofRes||2*this.getPixelRatio();this._uniforms.uDofScale.getInternalArray()[0]=.0015*this._viewerOSGJS._canvasHeight/t},addDofPass:function(t,e){this.updateDofScaleUniform();var i=l().dofRes||2*this.getPixelRatio(),r=this._uniforms.uDofScale,n={isPassDofGeneric:!0,blurPassName:"DownsampleInit"},a={Texture0:e.inputTexture,Texture1:this._camera._textureDepth,uDofScale:r},s=this.getOrCreateTextureRTT(i,"dofDownsample",y.Texture.NEAREST,this.getSupportedFloatTexture()),o=t.addPass(this.createFilter(n,a),s);o.setFragmentName("DofDownsampleInit"),n={isPassDofGeneric:!0,blurPassName:"DilateNearH"},a={Texture0:s,Texture1:this._camera._textureDepth,uDofScale:r};var u=this.getOrCreateTextureRTT(i,"dofTemp",y.Texture.NEAREST,this.getSupportedFloatTexture());o=t.addPass(this.createFilter(n,a),u),o.setFragmentName("DofNearDilateH"),n={isPassDofGeneric:!0,blurPassName:"DilateNearV"},a={Texture0:u,Texture1:this._camera._textureDepth,uDofScale:r},o=t.addPass(this.createFilter(n,a),s),o.setFragmentName("DofNearDilateV"),n={isPassDofGeneric:!0,blurPassName:"BlurCircular"},a={Texture0:s,Texture1:this._camera._textureDepth,uDofScale:r};var h=this.getOrCreateTextureRTT(i,"dofBlur",y.Texture.LINEAR);o=t.addPass(this.createFilter(n,a),h),o.setFragmentName("DofBlurCircular"),n={isPassDofCombine:!0,RGBMTexture0:w,RGBMTexture1:w,RGBMTexture2:w,encodeRGBM:e.outputInSRGB?null:w},a={uDofBlurNearFarFocal:this._uniforms.uDofBlurNearFarFocal,uOutputLinear:y.Uniform.createInt(e.outputInSRGB?0:1,"uOutputLinear"),
Texture0:e.inputTexture,Texture1:h,Texture2:s,Texture3:this._camera._textureDepth,uDofScale:r},e.composeBackground&&this.addCompositeBackground(n,a);var c=this.getOrCreateTextureRTT(1,"dof",e.outputFiltering);return o=t.addPass(this.createFilter(n,a),c),o.setFragmentName("DofCombine"),e.composeBackground&&(this._stateSetCompositeBG=o.getStateSet()),c},addBloomPass:function(t,e){var i=this.getPackFunc(C.toExponential()),r=this.getUnpackFunc(C.toExponential()),n=y.Texture.LINEAR,a="none"!==this._backgroundModel.get("enable"),s={isPassBright:!0,RGBMTexture0:w,encodeRGBM:C,testDepthBloom:a},o={uBloomThreshold:this._uniforms.uBloomThreshold,uOutputLinear:y.Uniform.createInt(1,"uOutputLinear"),Texture0:e.inputTexture};s&&(o.TextureDepth=this._camera._textureDepth);var u=t.addPass(this.createFilter(s,o),this.getOrCreateTextureRTT(1,"bloom",n));u.setFragmentName("BloomExtractBright");var h=2*this.getPixelRatio(),l=2*h,c=2*l,d=2*c,p=2*d,f=this._isOnMobile?void 0:this.getOrCreateTextureRTT(h,"blurH",n),g=this.getOrCreateTextureRTT(l,"blurH",n),m=this.getOrCreateTextureRTT(c,"blurH",n),v=this.getOrCreateTextureRTT(d,"blurH",n),_=this._isOnMobile?void 0:this.getOrCreateTextureRTT(p,"blurH",n);this._isOnMobile||(t.addPass(new S.Composer.Filter.VBlur(3,!0,r,i),this.getOrCreateTextureRTT(h,"blurV",n)),t.addPass(new S.Composer.Filter.HBlur(3,!0,r,i),f)),t.addPass(new S.Composer.Filter.VBlur(5,!0,r,i),this.getOrCreateTextureRTT(l,"blurV",n)),t.addPass(new S.Composer.Filter.HBlur(5,!0,r,i),g),t.addPass(new S.Composer.Filter.VBlur(7,!0,r,i),this.getOrCreateTextureRTT(c,"blurV",n)),t.addPass(new S.Composer.Filter.HBlur(7,!0,r,i),m),t.addPass(new S.Composer.Filter.VBlur(9,!0,r,i),this.getOrCreateTextureRTT(d,"blurV",n)),t.addPass(new S.Composer.Filter.HBlur(9,!0,r,i),v),this._isOnMobile||(t.addPass(new S.Composer.Filter.VBlur(11,!0,r,i),this.getOrCreateTextureRTT(p,"blurV",n)),t.addPass(new S.Composer.Filter.HBlur(11,!0,r,i),_));var b={isPassAdditive:!0,isOnMobile:this._isOnMobile,RGBMTexture0:w,RGBMTexture1:C,RGBMTexture2:C,RGBMTexture3:C,RGBMTexture4:C,RGBMTexture5:C,encodeRGBM:e.outputInSRGB?null:w},x={uBloomFactor:this._uniforms.uBloomFactor,uBloomRadius:this._uniforms.uBloomRadius,uOutputLinear:y.Uniform.createInt(e.outputInSRGB?0:1,"uOutputLinear"),Texture0:e.inputTexture,Texture1:f,Texture2:g,Texture3:m,Texture4:v,Texture5:_};e.composeBackground&&this.addCompositeBackground(b,x);var A=this.getOrCreateTextureRTT(1,"bloom",e.outputFiltering);return u=t.addPass(this.createFilter(b,x),A),u.setFragmentName("BloomMergeAdditive"),e.composeBackground&&(this._stateSetCompositeBG=u.getStateSet()),A},addMergeablePass:function(t,e){var i=this._effectiveConfig,r={isPassMergeable:!0,useChromaticAberration:i.useChromaticAberration,useVignetteMergeable:i.useVignetteMergeable,useToneMapping:i.useToneMapping,useColorBalance:i.useColorBalance,RGBMTexture0:w},n={uOutputLinear:y.Uniform.createInt(e.outputInSRGB?0:1,"uOutputLinear"),Texture0:e.inputTexture};e.composeBackground&&this.addCompositeBackground(r,n),r.useChromaticAberration&&(n.uChromaFactor=this._uniforms.uChromaFactor),r.useVignetteMergeable&&(n.uLensRadius=this._uniforms.uLensRadius),r.useToneMapping&&(n.uToneExposure=this._uniforms.uToneExposure,n.uToneBrightness=this._uniforms.uToneBrightness,n.uToneContrast=this._uniforms.uToneContrast,n.uToneSaturation=this._uniforms.uToneSaturation,n.uToneMethod=this._uniforms.uToneMethod),r.useColorBalance&&(n.uColorBalanceLow=this._uniforms.uColorBalanceLow,n.uColorBalanceMid=this._uniforms.uColorBalanceMid,n.uColorBalanceHigh=this._uniforms.uColorBalanceHigh);var a=this.getOrCreateTextureRTT(1,"mergeable",e.outputFiltering),s=t.addPass(this.createFilter(r,n),a);return s.setFragmentName("PostProcessMergeable"),e.composeBackground&&(this._stateSetCompositeBG=s.getStateSet()),a},addDistortionVR:function(t,e){var i=this._camera,r={isPassDistortionVR:!0,RGBMTexture0:null,useTextureExtra:!!i._textureExtra,encodeRGBM:null},n={uOutputLinear:y.Uniform.createInt(1,"uOutputLinear"),Texture0:e.inputTexture,TextureExtra:this._camera._textureExtra,uDistortion:this._uniforms.uDistortion,uProjectionLeft:this._uniforms.uProjectionLeft,uUnprojectionLeft:this._uniforms.uUnprojectionLeft},a=this.getOrCreateTextureRTT(1,"distortion",y.Texture.LINEAR),s=t.addPass(this.createFilter(r,n),a);return s.setFragmentName("DistortionVR"),a},addSuperSamplePass:function(t){var e=this._camera,i=this._backgroundModel.get("enable"),r="none"!==i,n=this._effectiveConfig.useSharpen,a=this._effectiveConfig.useVignetteSuperSample,u={isPassSuperSample:!0,background:i,useAntiAlias:r&&this._hasTriangles,useSharpen:n,useVignetteSuperSample:a,useTextureExtra:!!e._textureExtra,testDepthSharpen:n&&r,RGBMTexture0:null,encodeRGBM:null},h=this.getOrCreateTextureRTT(1,"antialias2",y.Texture.LINEAR),l=this.createCameraAA("antialias2",h),c=this.getOrCreateTextureRTT(1,"antiAlias1",y.Texture.LINEAR),d=this.createCameraAA("antialias1",c),p={uOutputLinear:y.Uniform.createInt(1,"uOutputLinear")};n&&(p.uSharpFactor=this._uniforms.uSharpFactor),a&&(p.uLensRadius=this._uniforms.uLensRadius);var f=d.getOrCreateStateSet(),g=l.getOrCreateStateSet(),m=2;(u.testDepthSharpen||!r)&&this.addTextureToPingPong(f,g,m++,"TextureDepth",e._textureDepth),u.useTextureExtra&&this.addTextureToPingPong(f,g,m++,"TextureExtra",e._textureExtra);var v=this._viewer.getSuperSample();v.canBeEnabled()&&v.setCanBeEnabled(r);var _=new s([],[],o());_.setPostProcessConfiguration(u),this._antialiasFilter=new S.Composer.Filter.PingPong(d,c,l,h,_.createFragmentShader(),p),this._antialiasFilter.setFragmentName("AntiAlias"),t.addPass(this._antialiasFilter),this.addFinalPass(t)},addTextureToPingPong:function(t,e,i,r,n){t.addUniform(y.Uniform.createInt(i,r)),e.addUniform(y.Uniform.createInt(i,r)),t.setTextureAttributeAndModes(i,n),e.setTextureAttributeAndModes(i,n)},addFinalPass:function(t){var e={},i=[];this._effectiveConfig.useGrain&&(e.uGrainFactor=this._uniforms.uGrainFactor,e.uTimeGrain=this._uniforms.uTimeGrain,i.push("#define GRAIN")),this._effectiveConfig.useDof&&(e.uDofCross=this._uniforms.uDofCross,i.push("#define DOF_CROSS"));var r=o().getShader("postProcess-pingpong.frag",i),n=new S.Composer.Filter.Custom(r,e);n.setFragmentName("PassTroughFinal"),t.addPass(n)},addAntiAliasPassVR:function(t,e){var i={isPassFinalPassVR:!0,useAntiAlias:!!this._hasTriangles,hasBackground:!0,RGBMTexture0:null,encodeRGBM:null},r={uOutputLinear:y.Uniform.createInt(1,"uOutputLinear"),Texture0:e.inputTexture};if(!this.model.get("doDistortionVR")){var n=this._camera;i.useTextureExtra=!!n._textureExtra,r.TextureExtra=this._camera._textureExtra}var a=t.addPass(this.createFilter(i,r));a.setFragmentName("AntiAliasVR")},onPingPongTexture0:function(t){this._antialiasFilter&&(this._antialiasFilter._cameraRtt0.setNodeMask(t?-1:0),this._antialiasFilter._cameraRtt1.setNodeMask(t?0:-1))},updateEffectiveConfig:function(){var t=this._effectiveConfig,e=this.model.get("enable");t.useTransparency=a.get("hasTransparency")||this.model.get("webVR")||f(),t.useDof=e&&this.isEffectiveDof(),t.useBloom=e&&this.isEffectiveBloom(),t.useGrain=e&&this.isEffectiveGrain(),t.useSharpen=e&&this.isEffectiveSharpen(),t.useChromaticAberration=e&&this.isEffectiveChromaticAberration(),t.useToneMapping=e&&this.isEffectiveToneMapping(),t.useColorBalance=e&&this.isEffectiveColorBalance(),t.hasPassMergeable=t.useChromaticAberration||t.useToneMapping||t.useColorBalance;var i=this._backgroundModel.get("enable");"fixed"!==i||t.hasPassMergeable||t.useBloom||t.hasTransparency||(t.hasPassMergeable=!0),t.useVignette=e&&this.isEffectiveVignette();var r=t.hasPassMergeable&&("environment"===i||"color"===i);return t.useVignetteMergeable=r&&t.useVignette,t.useVignetteSuperSample=!r&&t.useVignette,this._effectiveConfig},needDepthTexture:function(){if(f())return!0;var t=this._effectiveConfig;if(t.useDof||t.useBloom||t.useSharpen)return!0;if(this._viewer.getFeatures().hotspot.getModel().get("hotspots").length>0)return!0;var e=this._backgroundModel.get("enable");return"none"===e||"fixed"===e||this.model.get("webVR")},needExtraTexture:function(){return a.get("hasExtra")||this.model.get("webVR")},createComposer:function(){var t=this.updateEffectiveConfig(),e=!(t.useTransparency||t.useDof||t.useBloom||t.hasPassMergeable),i=this._camera,r=i._textureOpaque=this.getOrCreateTextureOpaque(e?y.Texture.LINEAR:y.Texture.NEAREST);i._textureExtra=this.needExtraTexture()?this.getOrCreateTextureExtra():void 0,i._textureTransparent=t.useTransparency?this.getOrCreateTextureTransparent():void 0,i._textureDepth=this.needDepthTexture()?this.getOrCreateTextureDepth():void 0;var n=new S.Composer,a=n.addPass(new S.Composer.Filter.InputTexture(r));a.setFragmentName("InputTexture");var s={inputTexture:r,inputInSRGB:e,outputFiltering:y.Texture.LINEAR,outputInSRGB:!0};return this._uniforms.uOutputLinear.setInt(e?0:1),this._uniforms.uRGBMRange.setFloat(e?-1:w),this.onBackgroundColor(),e||(t.useTransparency&&(s.outputInSRGB=s.composeBackground=!t.useDof&&!t.useBloom&&!t.hasPassMergeable,s.outputFiltering=!t.useBloom&&!t.hasPassMergeable||t.useDof?y.Texture.LINEAR:y.Texture.NEAREST,s.inputTexture=this.addMergeOpacityPass(n,s)),t.useDof&&(s.outputInSRGB=s.composeBackground=!t.useBloom&&!t.hasPassMergeable,s.outputFiltering=t.useBloom||t.hasPassMergeable?y.Texture.NEAREST:y.Texture.LINEAR,s.inputTexture=this.addDofPass(n,s)),t.useBloom&&(s.outputInSRGB=s.composeBackground=!t.hasPassMergeable,s.outputFiltering=t.hasPassMergeable?y.Texture.NEAREST:y.Texture.LINEAR,s.inputTexture=this.addBloomPass(n,s)),t.hasPassMergeable&&(s.outputInSRGB=s.composeBackground=!0,s.outputFiltering=y.Texture.LINEAR,s.inputTexture=this.addMergeablePass(n,s))),this.model.get("webVR")?(this.model.get("doDistortionVR")&&(s.inputTexture=this.addDistortionVR(n,s)),this.addAntiAliasPassVR(n,s)):this.addSuperSamplePass(n),n.renderToScreen(this._viewerOSGJS.getCanvasWidth(),this._viewerOSGJS.getCanvasHeight()),n.build(),n},resetCameraAttachments:function(){var t=this._camera;t.resetAttachments(),t.frameBufferObjectOpaque&&(t.frameBufferObjectOpaque.reset(),t.frameBufferObjectOpaque=void 0),t.frameBufferObjectTransparent&&(t.frameBufferObjectTransparent.reset(),t.frameBufferObjectTransparent=void 0),t.frameBufferObjectDepth&&(t.frameBufferObjectDepth.reset(),t.frameBufferObjectDepth=void 0),t.frameBufferObjectExtra&&(t.frameBufferObjectExtra.reset(),t.frameBufferObjectExtra=void 0),t.attachRenderBuffer(y.FrameBufferObject.DEPTH_ATTACHMENT,y.FrameBufferObject.DEPTH_COMPONENT16)},createPathStandard:function(){var t=this.createComposer();t.setNodeMask(u.NO_PICK_NO_SHADOW),t.setName("PostProcess - Composer"),this.resetCameraAttachments();var e=this._nodeIn;2===e.getChildren().length&&e.removeChild(e.getChildren()[1]),e.addChild(t)},onVR:function(){var t=this.model.get("webVR"),e=this._viewer.getSuperSample();e.setSwitch(!t),e.reset(),e.setCanBeEnabled(!t),this.dirty()},onEffectChanged:function(){return h.draw(),this.updateSizeUniforms(),this.createPathStandard()},onBackgroundUpdated:function(t){if(this._stateSetCompositeBG){var e=this._stateSetCompositeBG.getUniform("TextureFixed");e&&this._stateSetCompositeBG.setTextureAttributeAndModes(e.getInternalArray()[0],t)}},onBackgroundColor:function(){var t=c.getClearColor();if("color"!==this._backgroundModel.get("enable"))return void y.Vec4.init(t);y.Vec3.copy(this._backgroundModel.get("color"),t),t[3]=1,1===this._uniforms.uOutputLinear.getInternalArray()[0]&&p.srgbToLinear(t,t);var e=this._uniforms.uRGBMRange.getInternalArray()[0];e>0&&p.encodeRGBM(t,e,t)},updateGrain:function(t){if(this._effectiveConfig.useGrain&&this.model.get("grainAnimated")){this._requestDrawPostProcess=!0;var e=t.getSimulationTime(),i=l().grainSpeed/1e3;i>0&&e-this._lastUpdateTime>=i&&(this._uniforms.uTimeGrain.setFloat(e/1e3),this._lastUpdateTime=e)}},updateDof:function(t){if(this.isEffectiveDof()){var e=this._uniforms.uNearFar.getInternalArray();if(!(e[0]>e[1])){var i=this._viewerOSGJS.getManipulator();i.getEyePosition(this._tmpVec3);var r=i.getHomeBound(),n=r.radius(),a=y.Vec3.distance(this._tmpVec3,this._eyePos)/n,s=a>=.01?0:1,o=i.getHomeDistance(i.getHomeBound()),h=(y.Vec3.distance(this._tmpVec3,r.center())-n)/(o-n);s*=Math.max(0,Math.min(1,1-h)),this._interpolatorDofBlurNear.setTarget(this.model.get("dofBlurNear")*s),this._interpolatorDofBlurFar.setTarget(this.model.get("dofBlurFar")*s);var l=this._viewer.getFeaturesManager(),c=this._uniforms.uDofCross.getInternalArray();if(d.isFinished()&&this._dofInitialized){if(this._dofAutoFocus||a>.01){var p=this._viewerOSGJS.getCanvasClientWidth(),f=this._viewerOSGJS.getCanvasClientHeight();this._dofAutoFocus=a>1e-5;var g=this._dofAutoFocus?u.PICK_GEOMETRY_FAST:u.PICK_GEOMETRY_SLOW,m=l.computeNearestIntersection2D(.5*p,.5*f,g);if(m||(m=l.computeNearestIntersection2D(p*c[0],f*c[1],g)),m&&(l.getWorldPositionFromHit(m,this.model.get("dofFocusPoint")),this._interpolatorDofFocal.setTarget(this.computeFocalDistance())),y.Vec3.copy(this._tmpVec3,this._eyePos),this._dofAutoFocus)this._interpolatorDofCross.getCurrent()[0]=0;else{var v=y.Vec3.distance(this.model.get("dofFocusPoint"),this._dofLastPos),_=this._interpolatorDofFocal.getCurrent()[0];v>.1*n&&Math.abs(_-this._dofLastFocal)>.075&&s>.1&&this.showDofCross()}}}else this._dofInitialized=!0,this._interpolatorDofFocal.setTarget(this.computeFocalDistance()),y.Vec3.copy(this._tmpVec3,this._eyePos);l.getScreenPositionFromWorldPoint(this.model.get("dofFocusPoint"),c),c[0]/=this._viewerOSGJS.getCanvasWidth(),c[1]/=this._viewerOSGJS.getCanvasHeight();var b=t.getDeltaTime();this._interpolatorDofBlurNear.update(b),this._interpolatorDofBlurFar.update(b),this._interpolatorDofFocal.update(b),this._interpolatorDofCross.update(b);var x=this._uniforms.uDofBlurNearFarFocal.getInternalArray();x[0]=this._interpolatorDofBlurNear.getCurrent()[0],x[1]=this._interpolatorDofBlurFar.getCurrent()[0],x[2]=this._interpolatorDofFocal.getCurrent()[0],this._uniforms.uDofCross.getInternalArray()[2]=this._interpolatorDofCross.getCurrent()[0],this._interpolatorDofCross.isDone()||(this._requestDrawPostProcess=!0)}}},getNewSize:function(t,e){return Math.max(1,Math.round(e/t))},updateSizeUniforms:function(){var t=this._uniforms.uRenderSize.getInternalArray();t[0]=this._viewerOSGJS.getCanvasWidth(),t[1]=this._viewerOSGJS.getCanvasHeight(),this._uniforms.uPixelRatio.setFloat(this.getPixelRatio())},resizePostProcess:function(t,e,i,r){for(var n=this._nodeIn.getChildren()[1],a=n.getChildren(),s=0,o=a.length;o>s;++s){var u=a[s],l=1;u.isRenderToTextureCamera()&&(l=u.getAttachments()[y.FrameBufferObject.COLOR_ATTACHMENT0].texture.divisor,l||(y.warn("missing divisor for texture, the rtt texture wasn't created by the postprocess feature!"),l=1));var c=this.getNewSize(l,i),d=this.getNewSize(l,r),p=u.getStateSet(),f=p.getUniform("RenderSize");if(f){var g=f.getInternalArray();g[0]=c,g[1]=d}var m=u.getViewport();m&&m.setViewport(0,0,c,d);for(var v=0;v<p.getNumTextureAttributeLists();v++){var _=p.getTextureAttribute(v,"Texture");_&&(_.divisor||(y.warn("missing divisor for texture, the rtt texture wasn't created by the postprocess feature!"),_.divisor=1),_.setTextureSize(this.getNewSize(_.divisor,i),this.getNewSize(_.divisor,r)))}}this.updateSizeUniforms(),this.updateDofScaleUniform(),h.draw(),this.resetCameraAttachments()},updateDirtyEffect:function(){var t=this._viewerOSGJS.getCanvasWidth(),e=this._viewerOSGJS.getCanvasHeight();if(this._width&&this._height||(this._width=this._height=-1),t!==this._width||e!==this._height){this._dirty||this.resizePostProcess(this._width,this._height,t,e);var i=this._camera;i._textureOpaque&&i._textureOpaque.setTextureSize(t,e),i._textureTransparent&&i._textureTransparent.setTextureSize(t,e),i._textureDepth&&i._textureDepth.setTextureSize(t,e),i._textureExtra&&i._textureExtra.setTextureSize(t,e),this._width=t,this._height=e,this._dirty||this._viewerOSGJS.frame()}this._dirty&&(this.onEffectChanged(),this._dirty=!1)},update:function(t,e){var i=e.getFrameStamp();if(this._viewer.getSuperSample().isEnabled()&&this._uniforms.uTime.setFloat(i.getSimulationTime()/1e3),this.model.get("webVR")){var r=this._viewer.getFeatures().webVR.getModel(),n=r.get("worldFactor")/r.get("boundingBox").radius();this._camera.setNearFarRatio(n>0?.005*Math.max(.1,n):.005)}else this._camera.setNearFarRatio(.005);return this.updateGrain(i),this.updateDof(i),this.updateDirtyEffect(),!0}});t.exports=T},function(t,e,i){"use strict";var r=i(1100),n=i(1376),a=i(1558),s=r.osg,fif(r),o=r.osgShader,u=o.nodeFactory;u.registerNodes(a);var h=function(){n.apply(this,arguments),this.config={}};h.prototype=s.objectInherit(n.prototype,{getFragmentShaderName:function(){return""},setPostProcessConfiguration:function(t){this.config=t,this._customVertexShader=!0},createFragmentShaderGraph:function(){var t=this.config,e=[];return t.isPassMergeable?this.createFragmentMergeable(e):t.isPassMergeOpacity?this.createMergeOpacity(e):t.isPassDofGeneric?this.createFragmentDofGeneric(e):t.isPassDofCombine?this.createFragmentDofCombine(e):t.isPassBright?this.createFragmentBright(e):t.isPassAdditive?this.createFragmentAdditive(e):t.isPassSuperSample?this.createFragmentSuperSample(e):t.isPassDistortionVR?this.createFragmentDistortionVR(e):t.isPassFinalPassVR?this.createFragmentAntiAliasVR(e):e},getFetch0x0y0:function(){return this._fetch0x0y0?this._fetch0x0y0:(this._fetch0x0y0=this.textureFetch(this.getOrCreateSampler("sampler2D","Texture0"),this.getOrCreateVarying("vec2","FragTexCoord0")),this._fetch0x0y0)},createFragmentDistortionVR:function(t){return t.push(this.getFragColor(this.createDistortion())),t},createFragmentAntiAliasVR:function(t){var e=this.config.useAntiAlias?this.createAntiAlias():this.getFetch0x0y0();return this.config.useTextureExtra&&(e=this.createComposeExtra(e,this.createVariable("float").setValue("1.0"))),t.push(this.getFragColor(e)),t},createMergeOpacity:function(t){var e=this.createVariable("vec3"),i=this.textureFetch(this.getOrCreateSampler("sampler2D","TextureTransparent"),this.getOrCreateVarying("vec2","FragTexCoord0"));return this.getNode("InlineCode").code("%outcolor = %opaque.rgb * (1.0 - %transparent.a) + %transparent.rgb;").inputs({opaque:this.getFetch0x0y0(),transparent:i}).outputs({outcolor:e}),t.push(this.getFragColor(e)),t},createFragmentSuperSample:function(t){var e=this.config,i=e.useAntiAlias?this.createAntiAlias():this.getFetch0x0y0();e.useSharpen&&(i=this.createSharpen(i));var r="none"===e.background?this.getOrCreateAlpha():this.createVariable("float").setValue("1.0");return e.useVignetteSuperSample&&(r=i=this.createVignette(i,r)),e.useTextureExtra&&(i=r=this.createComposeExtra(i,r)),i=this.createSuperSample(i),t.push(this.getFragColor(i,r)),t},createFragmentDofGeneric:function(t){var e=this.getNode("glFragColor");return this.getNode("DofGeneric").setPassName(this.config.blurPassName).inputs({sampler:this.getOrCreateSampler("sampler2D","Texture0"),samplerDepth:this.getOrCreateSampler("sampler2D","Texture1"),uv:this.getOrCreateVarying("vec2","FragTexCoord0"),texSize:this.getOrCreateUniform("vec2","RenderSize"),time:this.getOrCreateUniform("float","uTime"),dofScale:this.getOrCreateUniform("float","uDofScale"),dofBlurNearFarFocal:this.getOrCreateUniform("vec3","uDofBlurNearFarFocal")}).outputs({color:e}),t.push(e),t},createFragmentDofCombine:function(t){var e=this.createVariable("vec3");return this.getNode("DofCombine").inputs({color:this.getFetch0x0y0(),samplerBlur:this.getOrCreateSampler("sampler2D","Texture1"),samplerCoc:this.getOrCreateSampler("sampler2D","Texture2"),samplerDepth:this.getOrCreateSampler("sampler2D","Texture3"),range:this.getOrCreateUniform("float","uRGBMRange"),uv:this.getOrCreateVarying("vec2","FragTexCoord0"),texSize:this.getOrCreateUniform("vec2","RenderSize"),dofScale:this.getOrCreateUniform("float","uDofScale"),dofBlurNearFarFocal:this.getOrCreateUniform("vec3","uDofBlurNearFarFocal")}).outputs({color:e}),t.push(this.getFragColor(e)),t},createFragmentBright:function(t){var e=this.createVariable("vec3");return this.getNode("ExtractBright").inputs({color:this.getFetch0x0y0(),threshold:this.getOrCreateUniform("float","uBloomThreshold"),alpha:this.config.testDepthBloom?this.getOrCreateAlpha():void 0}).outputs({color:e}),t.push(this.getFragColor(e)),t},getFactoredTex:function(t,e,i){var r=this.textureFetch(this.getOrCreateSampler("sampler2D","Texture"+t),e),n=this.createVariable("vec4");return this.getNode("Mult").inputs(r,i||this.createVariable("float").setValue("1.0")).outputs(n),n},getRadiusFactored:function(t,e){var i=this.createVariable("float").setValue(t.toExponential()),r=this.createVariable("float").setValue((2*e-t).toExponential()),n=this.createVariable("float");return this.getNode("Blend").mode("MIX").inputs(i,r,this.getOrCreateUniform("float","uBloomRadius")).outputs(n),n},createFragmentAdditive:function(t){var e=this.getOrCreateVarying("vec2","FragTexCoord0"),i=this.config.isOnMobile,r=[],n=i?1:.6;i||r.push(this.getFactoredTex(1,e,this.getRadiusFactored(1.1,n))),r.push(this.getFactoredTex(2,e,this.getRadiusFactored(i?1.5:.9,n))),r.push(this.getFactoredTex(3,e,this.getRadiusFactored(i?1:.6,n))),r.push(this.getFactoredTex(4,e,this.getRadiusFactored(i?.5:.3,n))),i||r.push(this.getFactoredTex(5,e,this.getRadiusFactored(.1,n)));var a=this.createVariable("vec4");this.getNode("Add").inputs(r).outputs(a);var s=this.createVariable("vec4");return this.getNode("Blend").mode("ADD").inputs(this.getFetch0x0y0(),a,this.getOrCreateUniform("float","uBloomFactor")).outputs(s),t.push(this.getFragColor(s)),t},createFragmentMergeable:function(t){var e,i=this.config;return i.useChromaticAberration?e=this.createChromaticAberration():(e=this.createVariable("vec3"),this.getNode("SetFromNode").inputs(this.getFetch0x0y0()).outputs(e)),i.useVignetteMergeable&&(e=this.createVignette(e)),i.useColorBalance&&(e=this.createColorBalance(e)),i.useToneMapping&&(e=this.createToneMapping(e)),t.push(this.getFragColor(e)),t},getFragColor:function(t,e){var i=this.getNode("glFragColor");this.config.useComposeBackground&&(t=this.createComposeBackgroundFixed(t,this.getOrCreateAlpha()));var r=this.getSrgbColor(t);return this.config.encodeRGBM?this.getNode("EncodeRGBM").inputs({color:r,range:this.createVariable("float").setValue(this.config.encodeRGBM.toExponential())}).outputs({color:i}):this.getNode("SetAlpha").inputs({color:r,alpha:e||this.getFetch0x0y0()}).outputs({color:i}),i},createSuperSample:function(t){var e=this.createVariable("vec3");return this.getNode("SuperSample").inputs({color:t,sampler:this.getOrCreateSampler("sampler2D","Texture1"),uv:this.getOrCreateVarying("vec2","FragTexCoord0"),texSize:this.getOrCreateUniform("vec2","RenderSize"),halton:this.getOrCreateUniform("vec4","uHalton")}).outputs({color:e}),e},createComposeExtra:function(t,e){var i=this.createVariable("vec4");return this.getNode("ComposeExtra").inputs({color:t,alpha:e,extra:this.textureFetch(this.getOrCreateSampler("sampler2D","TextureExtra"),this.getOrCreateVarying("vec2","FragTexCoord0"))}).outputs({color:i}),i},createComposeBackgroundColor:function(t,e,i){var r=this.createVariable("vec3");return this.getNode("ComposeBackgroundColor").inputs({color:t,backgroundColor:i||this.getOrCreateUniform("vec3","uBackgroundColor"),alpha:e}).outputs({color:r}),r},createComposeBackgroundFixed:function(t,e){var i=this.createVariable("vec3");this.getNode("InlineCode").code("%color = texture2D(%tex, (%uv - 0.5) * %scale + 0.5).rgb;").inputs({tex:this.getOrCreateSampler("sampler2D","TextureFixed"),uv:this.getOrCreateVarying("vec2","FragTexCoord0"),scale:this.getOrCreateUniform("vec2","uFixedScale")}).outputs({color:i});var r=this.createVariable("vec3");return this.getNode("sRGBToLinear").inputs({color:i}).outputs({color:r}),this.createComposeBackgroundColor(t,e,r)},createAntiAlias:function(){var t=this.createVariable("vec3");return this.getNode("AntiAlias").inputs({sampler:this.getOrCreateSampler("sampler2D","Texture0"),uv:this.getOrCreateVarying("vec2","FragTexCoord0"),texSize:this.getOrCreateUniform("vec2","RenderSize")}).outputs({color:t}),t},createDistortion:function(){var t=this.createVariable("vec3");return this.getNode("Distortion").inputs({sampler:this.getOrCreateSampler("sampler2D","Texture0"),uv:this.getOrCreateVarying("vec2","FragTexCoord0"),distortion:this.getOrCreateUniform("vec2","uDistortion"),projectionLeft:this.getOrCreateUniform("vec4","uProjectionLeft"),unprojectionLeft:this.getOrCreateUniform("vec4","uUnprojectionLeft"),samplerExtra:this.config.useTextureExtra?this.getOrCreateSampler("sampler2D","TextureExtra"):void 0}).outputs({color:t}),t},createSharpen:function(t){var e=this.createVariable("vec3");return this.getNode("Sharpen").inputs({color:t,sampler:this.getOrCreateSampler("sampler2D","Texture0"),uv:this.getOrCreateVarying("vec2","FragTexCoord0"),texSize:this.getOrCreateUniform("vec2","RenderSize"),factor:this.getOrCreateUniform("float","uSharpFactor"),pixelRatio:this.getOrCreateUniform("float","uPixelRatio"),alpha:this.config.testDepthSharpen?this.getOrCreateAlpha():void 0}).outputs({color:e}),e},createToneMapping:function(t){var e=this.createVariable("vec3");return this.getNode("ToneMapping").inputs({color:t,exposure:this.getOrCreateUniform("float","uToneExposure"),brightness:this.getOrCreateUniform("float","uToneBrightness"),contrast:this.getOrCreateUniform("float","uToneContrast"),saturation:this.getOrCreateUniform("float","uToneSaturation"),method:this.getOrCreateUniform("int","uToneMethod")}).outputs({color:e}),e},createColorBalance:function(t){var e=this.createVariable("vec3");return this.getNode("ColorBalance").inputs({color:t,lowRGB:this.getOrCreateUniform("vec3","uColorBalanceLow"),midRGB:this.getOrCreateUniform("vec3","uColorBalanceMid"),highRGB:this.getOrCreateUniform("vec3","uColorBalanceHigh")}).outputs({color:e}),e},createVignette:function(t,e){var i=t;if(e){var r=this.createVariable("vec4");this.getNode("SetAlpha").inputs({color:t,alpha:e}).outputs({color:r}),i=r}var n=this.createVariable(i.getType());return this.getNode("Vignette").inputs({color:i,uv:this.getOrCreateVarying("vec2","FragTexCoord0"),lens:this.getOrCreateUniform("vec2","uLensRadius")}).outputs({color:n}),n},createChromaticAberration:function(){var t=this.createVariable("vec3");return this.getNode("ChromaticAberration").inputs({sampler:this.getOrCreateSampler("sampler2D","Texture0"),uv:this.getOrCreateVarying("vec2","FragTexCoord0"),factor:this.getOrCreateUniform("float","uChromaFactor"),range:this.getOrCreateUniform("float","uRGBMRange")}).outputs({color:t}),t},getOrCreateAlpha:function(){var t=this.getVariable("alpha");return t?t:(t=this.createVariable("float","alpha"),this.getNode("TextureAlpha").inputs({sampler:this.getOrCreateSampler("sampler2D","TextureDepth"),uv:this.getOrCreateVarying("vec2","FragTexCoord0")}).outputs({color:t}),t)},textureFetch:function(t,e){var i=t.getVariable(),r=this.createVariable("vec4");this.getNode("TextureRGBA").inputs({sampler:t,uv:e}).outputs({color:r});var n=r,a=this.config["RGBM"+i];if(a){var s=this.createVariable("vec3");this.getNode("DecodeRGBM").inputs({color:r,range:this.createVariable("float").setValue(a.toExponential())}).outputs({color:s}),n=this.createVariable("vec4"),this.getNode("SetAlpha").inputs({color:s,alpha:this.createVariable("float").setValue("1.0")}).outputs({color:n})}return n}}),t.exports=h},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=r.osgShader,s=a.node.BaseOperator,o=a.utils,u=function(){s.apply(this)};u.prototype=n.objectInherit(s.prototype,{validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "postProcess.glsl"'}});var h=function(t){return t.getType&&"vec4"===t.getType()?t.getVariable()+".rgb":t},l=function(t){return t.getType&&"vec4"===t.getType()?t.getVariable()+".a":t},c=function(){u.apply(this)};c.prototype=n.objectInherit(u.prototype,{type:"AntiAlias",validInputs:["sampler","uv","texSize"],computeShader:function(){var t=this._inputs;return o.callFunction("fxaa",h(this._outputs.color),[t.sampler,t.uv,t.texSize])},globalFunctionDeclaration:function(){return'#pragma include "postProcess-antiAlias.glsl"'}});var d=function(){u.apply(this)};d.prototype=n.objectInherit(u.prototype,{type:"SuperSample",validInputs:["color","sampler","uv","texSize","halton"],computeShader:function(){var t=this._inputs;return o.callFunction("supersample",h(this._outputs.color),[h(t.color),t.sampler,t.uv,t.texSize,t.halton])},globalFunctionDeclaration:function(){return'#pragma include "postProcess-antiAlias.glsl"'}});var p=function(){u.apply(this)};p.prototype=n.objectInherit(u.prototype,{type:"ToneMapping",validInputs:["color","exposure","brightness","contrast","saturation","method"],computeShader:function(){var t=this._inputs;return o.callFunction("toneMapping",this._outputs.color,[h(t.color),t.exposure,t.brightness,t.contrast,t.saturation,t.method])}});var f=function(){u.apply(this)};f.prototype=n.objectInherit(u.prototype,{type:"ColorBalance",validInputs:["color","lowRGB","midRGB","highRGB"],computeShader:function(){var t=this._inputs;return o.callFunction("colorBalance",this._outputs.color,[h(t.color),t.lowRGB,t.midRGB,t.highRGB])}});var g=function(){u.apply(this)};g.prototype=n.objectInherit(u.prototype,{type:"ExtractBright",validInputs:["color","threshold"],computeShader:function(){var t=this._inputs,e=[h(t.color),t.threshold];return t.alpha&&e.push(t.alpha),o.callFunction("extractBright",this._outputs.color,e)}});var m=function(){u.apply(this)};m.prototype=n.objectInherit(u.prototype,{type:"Vignette",validInputs:["color","uv","lens"],computeShader:function(){var t=this._inputs;return o.callFunction("vignette",this._outputs.color,[t.color,t.uv,t.lens])}});var v=function(){u.apply(this)};v.prototype=n.objectInherit(u.prototype,{type:"ChromaticAberration",validInputs:["sampler","uv","factor","range"],computeShader:function(){var t=this._inputs;return o.callFunction("chromaticAberration",h(this._outputs.color),[t.sampler,t.uv,t.factor,t.range])}});var _=function(){u.apply(this)};_.prototype=n.objectInherit(u.prototype,{type:"Sharpen",validInputs:["color","sampler","uv","texSize","factor","pixelRatio"],computeShader:function(){var t=this._inputs,e=[h(t.color),t.sampler,t.uv,t.texSize,t.factor,t.pixelRatio];return t.alpha&&e.push(t.alpha),o.callFunction("sharpen",this._outputs.color,e)}});var b=function(){u.apply(this)};b.prototype=n.objectInherit(u.prototype,{type:"ComposeExtra",validInputs:["color","alpha","extra"],validOutputs:["color"],computeShader:function(){var t=this._inputs;return o.callFunction("composeExtra",this._outputs.color,[h(t.color),l(t.alpha),t.extra])}});var x=function(){u.apply(this)};x.prototype=n.objectInherit(u.prototype,{type:"ComposeBackgroundColor",validInputs:["color","alpha","backgroundColor"],validOutputs:["color"],computeShader:function(){var t=this._inputs;return o.callFunction("composeBackgroundColor",this._outputs.color,[h(t.color),l(t.alpha),t.backgroundColor])}});var A=function(){u.apply(this)};A.prototype=n.objectInherit(u.prototype,{type:"Distortion",validInputs:["sampler","uv","distortion","projectionLeft","unprojectionLeft"],computeShader:function(){var t=this._inputs,e=[t.sampler,t.uv,t.distortion,t.projectionLeft,t.unprojectionLeft];return t.samplerExtra&&e.push(t.samplerExtra),o.callFunction("distortion",h(this._outputs.color),e)},globalFunctionDeclaration:function(){return'#pragma include "postProcess-distortion.glsl"'}});var y=function(){u.apply(this)};y.prototype=n.objectInherit(u.prototype,{type:"DofCombine",validInputs:["color","samplerBlur","samplerCoc","samplerDepth","uv","range","texSize","dofScale","dofBlurNearFarFocal"],computeShader:function(){var t=this._inputs;return o.callFunction("dofCombine",h(this._outputs.color),[h(t.color),t.samplerBlur,t.samplerCoc,t.samplerDepth,t.uv,t.range,t.texSize,t.dofScale,t.dofBlurNearFarFocal])},globalFunctionDeclaration:function(){return'#pragma include "dof.glsl"'}});var S=function(){u.apply(this),this._passName="A"};S.prototype=n.objectInherit(u.prototype,{type:"DofGeneric",
validInputs:["sampler","samplerDepth","uv","texSize","time","dofScale","dofBlurNearFarFocal"],setPassName:function(t){return this._passName=t,this},computeShader:function(){var t=this._inputs;return o.callFunction("dof"+this._passName,this._outputs.color,[t.sampler,t.samplerDepth,t.uv,t.texSize,t.time,t.dofScale,t.dofBlurNearFarFocal])},globalFunctionDeclaration:function(){return'#pragma include "dof.glsl"'}}),t.exports={AntiAlias:c,SuperSample:d,ToneMapping:p,ColorBalance:f,ExtractBright:g,Vignette:m,Sharpen:_,ChromaticAberration:v,ComposeExtra:b,ComposeBackgroundColor:x,Distortion:A,DofCombine:y,DofGeneric:S}},function(t,e,i){"use strict";var r=i(1100),n=i(1414),a=i(1390),s=i(1405),o=r.osg,fif(r),u=s.vrConfig,h=!1,l=function(t,e){return t._binNum-e._binNum},c=function(t,e){for(var i=e?e._parent:void 0,r=0;i;)i.stateset&&r++,i=i.parent;return r>1&&r--,t.getStateSetStackSize()-r},d={DEFAULT:0,EARLYZ_OPAQUE:1,EARLYZ_TRANSPARENT:2,OPAQUE:3,TRANSPARENT:4,EXTRA:5},p={currentPass:d.DEFAULT,depth:void 0,blend:void 0,uDrawOpaque:o.Uniform.createInt(-1,"uDrawOpaque")},f=new o.Depth(o.Depth.LESS,0,1,!0),g=new o.Depth(o.Depth.LESS,0,1,!1),m=new o.ColorMask(!1,!1,!1,!1),v=new o.ColorMask(!0,!0,!0,!0),_=new o.ColorMask(!1,!1,!1,!0),b=new o.Depth(o.Depth.EQUAL,0,1,!1),x=new o.BlendFunc,A=new o.Depth(o.Depth.LEQUAL,0,1,!1),y=new o.BlendFunc(o.BlendFunc.ONE,o.BlendFunc.ONE_MINUS_SRC_ALPHA),S=new o.BlendFunc(o.BlendFunc.ONE,o.BlendFunc.ONE),C=o.StateAttribute.OVERRIDE|o.StateAttribute.ON,w=function(){var t=new o.StateSet;t.setShaderGeneratorName("earlyZ",C);for(var e=n(),i=0;e>i;i++)t.setTextureAttributeAndModes(i,o.Texture.textureNull,C);return t},T=w(),M=new o.CullFace(o.CullFace.BACK),E=new o.CullFace(o.CullFace.FRONT),k=new o.CullFace(o.CullFace.DISABLE),I=o.RenderLeaf.prototype.drawGeometry,N=function(t,e,i){if(!i)return e.applyAttribute(k),void I.call(t,e);var r=e.attributeMap.SketchfabMaterial,n=r?r.lastApplied:void 0,a=p.currentPass,s=a===d.TRANSPARENT,u=s&&n&&!n.getAdditive()&&n.getCullFace()===o.CullFace.DISABLE;u&&e.applyAttribute(E),I.call(t,e),u&&(e.applyAttribute(M),t._geometry.drawImplementation(e))};o.RenderLeaf.prototype.drawGeometry=function(t){var e=t.attributeMap.SketchfabMaterial,i=e?e.lastApplied:void 0,r=p.currentPass;if(i){if(!i.getOpaqueEarlyZ()&&(r===d.EARLYZ_OPAQUE||r===d.OPAQUE))return;r===d.EARLYZ_TRANSPARENT&&t.applyAttribute(i.getAdditive()?S:y)}p.depth&&t.applyAttribute(p.depth),p.blend&&t.applyAttribute(p.blend);var n=p.uDrawOpaque.getInternalArray();n[0]=r!==d.TRANSPARENT&&r!==d.EARLYZ_TRANSPARENT?1:0,p.uDrawOpaque.apply(t.getGraphicContext(),t.getLastProgramApplied().getUniformsCache().uDrawOpaque);for(var a=this._geometry.getPrimitiveSetList(),s=!1,l=0,c=a.length;c>l;++l)if(a[l].getMode()>=o.PrimitiveSet.TRIANGLES){s=!0;break}if(h.isVR){var f=t.getGraphicContext();f.viewport(0,0,u.leftRenderWidth,u.leftRenderHeight),this._projection=h.leftProjection,this._modelView=h.leftEye,N(this,t,s),f.viewport(u.leftRenderWidth,0,u.rightRenderWidth,u.rightRenderHeight),this._projection=h.rightProjection,this._modelView=h.rightEye,N(this,t,s)}else N(this,t,s)};var R=function(){o.RenderStage.apply(this,arguments),this._binArraySorted=[],R.prototype.init.call(this)},F=!0;R.setDoEarlyZ=function(t){F=t};var P=o.Vec4.create();R.getClearColor=function(){return P},R.getDrawOpaqueUniform=function(){return p.uDrawOpaque},R.prototype=o.objectLibraryClass(o.objectInherit(o.RenderStage.prototype,{constructor:R,init:function(){return o.RenderStage.prototype.init.call(this),this._binArraySorted.length=0,this._renderBufferDepth=void 0,this},isMainCamera:function(){var t=this.getCamera();return t&&"PostProcess - MainCamera"===t.getName()?!0:!1},sortBinArray:function(){var t=window.Object.keys(this._bins),e=this._bins,i=this._binArraySorted;i.length=0;for(var r=0,n=t.length;n>r;r++){var a=t[r];i.push(e[a])}i.sort(l)},drawTransparentBin:function(t,e){for(var i,r=e,n=this._binArraySorted,s=0,o=n.length;o>s;s++){i=n[s];var u=i.getBinNumber();if(u===a.TRANSPARENT_BIN)r=i.draw(t,r);else if(p.currentPass!==d.EARLYZ_TRANSPARENT&&(u===a.TRANSPARENT_BIN_NO_EARLYZ_POST||u===a.TRANSPARENT_BIN_NO_EARLYZ_PRE)){var h=p.depth;p.depth=void 0,r=i.draw(t,r),p.depth=h}}return r},drawOpaqueBin:function(t,e){for(var i,r=this.getDoEarlyZ(),n=e,s=this._binArraySorted,o=0,u=s.length;u>o&&(i=s[o],!(i.getBinNumber()>0));o++)n=i.draw(t,n);for(n=this.drawLeafs(t,n);u>o;o++){i=s[o];var h=i.getBinNumber();if(h===a.OPAQUE_BIN||h===a.TRANSPARENT_BIN&&r)n=i.draw(t,n);else if(p.currentPass===d.OPAQUE&&h===a.BACKGROUND){var l=p.depth;p.depth=void 0,n=i.draw(t,n),p.depth=l}}return n},drawExtraBin:function(t,e){for(var i,r=e,n=this._binArraySorted,s=0,o=n.length;o>s;s++){i=n[s];var u=i.getBinNumber();u>=a.EXTRA&&(r=i.draw(t,r))}return r},bindDepthRTT:function(t){this.getCamera().frameBufferObjectDepth.apply(t)},bindTransparencyRTT:function(t){this.getCamera().frameBufferObjectTransparent.apply(t)},bindOpaqueRTT:function(t){this.getCamera().frameBufferObjectOpaque.apply(t)},bindExtraRTT:function(t){this.getCamera().frameBufferObjectExtra.apply(t)},createFBO:function(t,e){if(e){var i=this.getViewport(),r=new o.FrameBufferObject;r.createFrameBufferObject(t),r.bindFrameBufferObject();var n=this._renderBufferDepth;return n||(n=r.createRenderBuffer(o.FrameBufferObject.DEPTH_COMPONENT16,i.width(),i.height()),this._renderBufferDepth=n),r.framebufferRenderBuffer(o.FrameBufferObject.DEPTH_ATTACHMENT,n),r.framebufferTexture2D(t,o.FrameBufferObject.COLOR_ATTACHMENT0,o.Texture.TEXTURE_2D,e),r.checkStatus(),r}},drawOpaqueShading:function(t,e){p.currentPass=d.OPAQUE,p.depth=this.getDoEarlyZ()?b:f,p.blend=x;var i=this.drawOpaqueBin(t,e);return p.blend=void 0,p.depth=void 0,p.currentPass=d.DEFAULT,i},drawEarlyOpaque:function(t,e,i){T.setAttributeAndModes(this.isWritingDepth()?v:m),t.insertStateSet(i,T),p.currentPass=d.EARLYZ_OPAQUE,p.depth=f,p.blend=x;var r=this.drawOpaqueBin(t,e);return p.blend=void 0,p.depth=void 0,p.currentPass=d.DEFAULT,t.removeStateSet(i),r},drawEarlyAlpha:function(t,e,i){T.setAttributeAndModes(_),t.insertStateSet(i,T),p.currentPass=d.EARLYZ_TRANSPARENT,p.depth=g;var r=this.drawTransparentBin(t,e);return p.depth=void 0,p.currentPass=d.DEFAULT,t.removeStateSet(i),r},drawTransparentShading:function(t,e){p.currentPass=d.TRANSPARENT,p.depth=A,p.blend=y;var i=this.drawTransparentBin(t,e);return p.blend=void 0,p.depth=void 0,p.currentPass=d.DEFAULT,i},drawExtra:function(t,e){p.currentPass=d.EXTRA;var i=this.drawExtraBin(t,e);return p.currentPass=d.DEFAULT,i},isWritingDepth:function(){return!!this.getCamera()._textureDepth},getDoEarlyZ:function(){return F||this.isWritingDepth()},drawImplementationSketchfab:function(t,e){var i=t.getGraphicContext(),r=e,n=this.getCamera(),a=!!n._textureDepth;a?(this.bindDepthRTT(t),i.clearColor(1,1,1,0)):(this.bindOpaqueRTT(t),i.clearColor(P[0],P[1],P[2],P[3])),i.depthMask(!0),i.clearDepth(this.clearDepth),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);var s=this.getDoEarlyZ();if(s){var o=c(t,r);r=this.drawEarlyOpaque(t,r,o),a&&n._textureTransparent&&(r=this.drawEarlyAlpha(t,r,o),t.applyAttribute(v))}return a&&(this.bindOpaqueRTT(t),i.clearColor(P[0],P[1],P[2],P[3]),i.clear(i.COLOR_BUFFER_BIT)),r=this.drawOpaqueShading(t,r),i.clearColor(0,0,0,0),n._textureTransparent&&(this.bindTransparencyRTT(t),i.clear(i.COLOR_BUFFER_BIT),r=this.drawTransparentShading(t,r)),n._textureExtra&&(this.bindExtraRTT(t),i.clear(i.COLOR_BUFFER_BIT),r=this.drawExtra(t,r)),r},drawImplementation:function(t,e){if(!this.isMainCamera())return o.RenderStage.prototype.drawImplementation.call(this,t,e);var i=this.getCamera();if(!i._textureOpaque)return e;i.frameBufferObjectOpaque||(i.frameBufferObjectOpaque=this.createFBO(t,i._textureOpaque)),i.frameBufferObjectTransparent||(i.frameBufferObjectTransparent=this.createFBO(t,i._textureTransparent)),i.frameBufferObjectDepth||(i.frameBufferObjectDepth=this.createFBO(t,i._textureDepth)),i.frameBufferObjectExtra||(i.frameBufferObjectExtra=this.createFBO(t,i._textureExtra)),void 0===this.viewport&&o.log("RenderStage does not have a valid viewport"),t.applyAttribute(this.viewport),0!==this.positionedAttribute.length&&this.applyPositionedAttribute(t,this.positionedAttribute),this.sortBinArray();var r=e;return r=this.drawImplementationSketchfab(t,r)}}),"sketchfab","RenderStageSketchfab"),o.RenderBin.prototype.drawLeafs=function(t,e){for(var i,r=this.stateGraphList,n=this._leafs,a=e,s=this.getStage().viewport,o=t.getGraphicContext(),u=0,l=n.length;l>u;u++)i=h=n[u],!i.isVR&&a&&a.isVR&&o.viewport(s._x,s._y,s._width,s._height),i.render(t,a),a=i;for(var c=0,d=r.length;d>c;c++)for(var p=r[c],f=0,g=p.leafs.length;g>f;f++)i=h=p.leafs[f],!i.isVR&&a&&a.isVR&&o.viewport(s._x,s._y,s._width,s._height),i.render(t,a),a=i;return a},t.exports=R},function(t,e){t.exports='#pragma include "functions.glsl"\n\nfloat getLuminance(const in vec3 color) {\n    // http://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color\n    const vec3 colorBright = vec3(0.2126, 0.7152, 0.0722);\n    return dot(color, colorBright);\n}\n\nfloat RGBToL(const in vec3 color) {\n    float fmin = min(min(color.r, color.g), color.b);\n    float fmax = max(max(color.r, color.g), color.b);\n    return (fmax + fmin) / 2.0;\n}\n\n// ------- TONE MAPPING ---------\n\nvec3 toneMapping(const in vec3 color, const in float expos, const in float bright, const in float contr, const in float satur, const in int method) {\n    vec3 col = color * expos;\n    float luminance = dot(col * (1.0 + bright), vec3(0.2126, 0.7152, 0.0722));\n    col = mix(vec3(luminance), col * (1.0 + bright), vec3(satur));\n    if (contr > 0.0)\n        col = (col - 0.5) / (1.0 - contr) + 0.5;\n    else if(contr < 0.0)\n        col = (col - 0.5) * (1.0 + contr) + 0.5;\n\n    // simple reinhard and filmic\n    // http://filmicgames.com/archives/190\n    if(method == 1) { // reinhard (on luminance)\n        col /= 1.0 + getLuminance(col);\n    } else if( method == 2) { // filmic\n        vec3 x = max(vec3(0.0), col - 0.004);\n        col = (x * (6.2 * x + 0.5) ) / ( x * (6.2 * x + 1.7) + 0.06);\n        col = pow(col, vec3(2.2)); // filmic curve already encode srgb to linear\n    }\n    return col;\n}\n\n// ------- COLOR BALANCE ---------\n\nvec3 colorBalance(const in vec3 color, const in vec3 lrgb, const in vec3 mrgb, const in vec3 hrgb) {\n    float cLen = length(color);\n    if(cLen < 1e-5)\n        return color;\n\n    // TODO : I have no idea what I am doing, we should use a curve widge\n    float lightness = RGBToL(color);\n    // \'  lightness=(lightness*0.9-1.0)/(lightness*2.0+1.0) +1.0;\n    lightness = (1.5 * lightness) / (lightness + 0.5);\n    // https://github.com/liovch/GPUImage/blob/master/framework/Source/GPUImageColorBalanceFilter\n    float a = 0.25;\n    float b = 0.333;\n    float scale = 0.7;\n    vec3 low = lrgb * clamp((lightness - b) / -a + 0.5, 0.0, 1.0);\n    vec3 mid = mrgb * clamp((lightness - b) / a + 0.5, 0.0, 1.0) * clamp((lightness + b - 1.0) / -a + 0.5, 0.0, 1.0);\n    vec3 high = hrgb * clamp((lightness + b - 1.0) / a + 0.5, 0.0, 1.0);\n    vec3 newColor = max(color + (low + mid + high) * scale, vec3(0.0));\n    // newColor can be negative\n    float len = length(newColor);\n    return len < 1e-5 ? newColor * cLen : newColor * cLen / len;\n}\n\n// ------- BLOOM ---------\n\nvec3 extractBright(const in vec3 color, const in float threshold) {\n    // TODO manage hdr pixel with high frequency? (use derivative??), for now we clamp the extracted pixel :(\n    return clamp(color * clamp(getLuminance(color) - threshold, 0.0, 1.0), 0.0, 1.0);\n}\n\nvec3 extractBright(const in vec3 color, const in float threshold, const in float alpha) {\n    return alpha == 0.0 ? vec3(0.0) : extractBright(color * alpha, threshold);\n}\n\n// ------- VIGNETTE ---------\n\nvec3 vignette(const in vec3 color, const in vec2 uv, const in vec2 lens) {\n    float factor = clamp(smoothstep(lens.x, lens.y, distance(uv, vec2(0.5))), 0.0, 1.0);\n    return color.rgb * factor;\n}\n\n// when applied in the aa/ss pass srgb (no background case, also for performance reason if vignette is the ONLY mergeable postprocess)\n// there is a colorspace conversion to match the exact same vignette behaviour as with the other vignette (mergeable pass)\nvec4 vignette(const in vec4 color, const in vec2 uv, const in vec2 lens) {\n    float factor = clamp(smoothstep(lens.x, lens.y, distance(uv, vec2(0.5))), 0.0, 1.0);\n    return vec4( linearTosRGB(sRGBToLinear(color.rgb) * factor), clamp(color.a + (1.0 - factor), 0.0, 1.0));\n}\n\n// ------- CHROMA ---------\n\nvec3 chromaticAberration(const in sampler2D tex, const in vec2 uv, const in float factor, const in float range) {\n    vec2 dist = uv - 0.5;\n    vec2 offset = factor * dist * length(dist);\n    vec3 col;\n    col.r = decodeRGBM(texture2D(tex, uv - offset), range).r;\n    col.g = decodeRGBM(texture2D(tex, uv), range).g;\n    col.b = decodeRGBM(texture2D(tex, uv + offset), range).b;\n    return col;\n}\n\n// ------- SHARPEN ---------\n\nvec3 sharpen(const in vec3 color, const in sampler2D tex,  const in vec2 uv, const in vec2 texSize, const in float sharp, const in float pixelRatio) {\n    vec4 sw = pixelRatio * vec4(-1.0, 1.0, 1.0, -1.0) / texSize.xxyy;\n\n    // use useAA, 4 texFetch already in cache. perhaps we could cache ourself.\n    vec3 rgbNW = texture2D(tex, uv + sw.xw).rgb;\n    vec3 rgbNE = texture2D(tex, uv + sw.yw).rgb;\n    vec3 rgbSW = texture2D(tex, uv + sw.xz).rgb;\n    vec3 rgbSE = texture2D(tex, uv + sw.yz).rgb;\n\n    return color.rgb + sharp * (4.0 * color.rgb - rgbNW - rgbNE - rgbSW - rgbSE);\n}\n\nvec3 sharpen(const in vec3 color, const in sampler2D tex,  const in vec2 uv, const in vec2 texSize, const in float sharp, const in float pixelRatio, const in float alpha) {\n    if(alpha == 0.0) return color;\n    return sharpen(color, tex, uv, texSize, sharp * alpha, pixelRatio);\n}\n\n// ------- COMPOSITION ---------\n\nvec4 composeExtra(const in vec3 color, const in float alpha, const in vec4 extra) {\n    return extra + vec4(color.rgb, alpha) * (1.0 - extra.a);\n}\n\nvec3 composeBackgroundColor(const in vec3 color, const in float alpha, const in vec3 background) {\n    return color + background * (1.0 - alpha);\n}\n'},function(t,e){t.exports='\n#pragma include "functions.glsl"\n\n// G3D version of FXAA\n// green (y) as luma\n// Quality 12\nvec3 fxaa(const in sampler2D tex, const in vec2 pos, const in vec2 texSize) {\n\n    vec2 fxaaQualityRcpFrame = 1.0 / texSize.xy;\n    float fxaaQualitySubpix = 0.75;\n    float fxaaQualityEdgeThreshold = 0.125;\n    float fxaaQualityEdgeThresholdMin = 0.0625;\n\n    vec2 posM = pos.xy;\n    vec4 rgbyM = texture2D(tex, posM);\n    float lumaM = rgbyM.y;\n\n    // Swizzler Offseter Util\n    vec4 sw = vec4(-1.0, 1.0, 1.0, -1.0) * fxaaQualityRcpFrame.xxyy;\n\n    float lumaS = texture2D(tex, posM + vec2(0.0, sw.z)).y;\n    float lumaE = texture2D(tex, posM + vec2(sw.y, 0.0)).y;\n    float lumaN = texture2D(tex, posM + vec2(0.0, sw.w)).y;\n    float lumaW = texture2D(tex, posM + vec2(sw.x, 0.0)).y;\n\n    float maxSM = max(lumaS, lumaM);\n    float minSM = min(lumaS, lumaM);\n\n    float maxESM = max(lumaE, maxSM);\n    float minESM = min(lumaE, minSM);\n\n    float maxWN = max(lumaN, lumaW);\n    float minWN = min(lumaN, lumaW);\n\n    float rangeMax = max(maxWN, maxESM);\n    float rangeMin = min(minWN, minESM);\n\n    float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    float range = rangeMax - rangeMin;\n    float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\n    bool earlyExit = range < rangeMaxClamped;\n    if(earlyExit)\n        return rgbyM.rgb;\n\n    float lumaNW = texture2D(tex, posM + sw.xw).y;\n    float lumaSE = texture2D(tex, posM + sw.yz).y;\n    float lumaNE = texture2D(tex, posM + sw.yw).y;\n    float lumaSW = texture2D(tex, posM + sw.xy).y;\n\n    float lumaNS = lumaN + lumaS;\n    float lumaWE = lumaW + lumaE;\n    float subpixRcpRange = 1.0/range;\n    float subpixNSWE = lumaNS + lumaWE;\n    float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    float edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\n    float lumaNESE = lumaNE + lumaSE;\n    float lumaNWNE = lumaNW + lumaNE;\n    float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\n    float lumaNWSW = lumaNW + lumaSW;\n    float lumaSWSE = lumaSW + lumaSE;\n    float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    float edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    float edgeVert = abs(edgeVert3) + edgeVert4;\n\n    float subpixNWSWNESE = lumaNWSW + lumaNESE;\n    float lengthSign = fxaaQualityRcpFrame.x;\n    bool horzSpan = edgeHorz >= edgeVert;\n    float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    float subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\n    float gradientN = lumaN - lumaM;\n    float gradientS = lumaS - lumaM;\n    float lumaNN = lumaN + lumaM;\n    float lumaSS = lumaS + lumaM;\n    bool pairN = abs(gradientN) >= abs(gradientS);\n    float gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\n\n    vec2 posB = posM.xy;\n    vec2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n\n    vec2 posN;\n    posN.x = posB.x - offNP.x;\n    posN.y = posB.y - offNP.y;\n    vec2 posP;\n    posP.x = posB.x + offNP.x;\n    posP.y = posB.y + offNP.y;\n    float subpixD = ((-2.0)*subpixC) + 3.0;\n    float lumaEndN = texture2D(tex, posN).y;\n    float subpixE = subpixC * subpixC;\n    float lumaEndP = texture2D(tex, posP).y;\n\n    if(!pairN) lumaNN = lumaSS;\n    float gradientScaled = gradient * 1.0/4.0;\n    float lumaMM = lumaM - lumaNN * 0.5;\n    float subpixF = subpixD * subpixE;\n    bool lumaMLTZero = lumaMM < 0.0;\n\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    bool doneN = abs(lumaEndN) >= gradientScaled;\n    bool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * 1.5;\n    if(!doneN) posN.y -= offNP.y * 1.5;\n    bool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * 1.5;\n    if(!doneP) posP.y += offNP.y * 1.5;\n\n    if(doneNP) {\n        if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n        if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * 2.0;\n        if(!doneN) posN.y -= offNP.y * 2.0;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * 2.0;\n        if(!doneP) posP.y += offNP.y * 2.0;\n\n        if(doneNP) {\n            if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n            if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * 4.0;\n            if(!doneN) posN.y -= offNP.y * 4.0;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * 4.0;\n            if(!doneP) posP.y += offNP.y * 4.0;\n\n            if(doneNP) {\n                if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n                if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * 12.0;\n                if(!doneN) posN.y -= offNP.y * 12.0;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * 12.0;\n                if(!doneP) posP.y += offNP.y * 12.0;\n\n            }\n\n        }\n\n    }\n\n    float dstN = posM.x - posN.x;\n    float dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n\n    bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    float spanLength = (dstP + dstN);\n    bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    float spanLengthRcp = 1.0/spanLength;\n\n    bool directionN = dstN < dstP;\n    float dst = min(dstN, dstP);\n    bool goodSpan = directionN ? goodSpanN : goodSpanP;\n    float subpixG = subpixF * subpixF;\n    float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    float subpixH = subpixG * fxaaQualitySubpix;\n\n    float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\n    return texture2D(tex, posM).xyz;\n}\n\n// access a linear texture as if a nearest texture\nvec4 textureNearest2D(const in sampler2D tex, const in vec2 uv, const in vec2 texSize)\n{\n  return texture2D(tex, (floor(uv*texSize)+0.5) / texSize, -99999.0);\n}\n\n// static in place amortized supersampling\nvec3 supersample(const in vec3 currFragColor,  const in sampler2D tex, const in vec2 uv, const in vec2 texSize, const in vec4 halton)\n{\n    float haltz = abs(halton.z);\n    if ( haltz == 1.0 ){\n         // jut return the color.\n        return currFragColor.rgb;\n    }\n\n    // same pixel for same projected interpolated vertex on prev frame\n    vec3 accumColorN = textureNearest2D(tex, uv.xy, texSize).rgb;\n\n    // mix frames\n    float lerpFac = 1.0 / halton.w;\n\n    if ( haltz == 3.0 ){\n        // No supersample, crude motion blur by accumulation\n       return mix( currFragColor, accumColorN, lerpFac);\n    }\n\n    // Supsersample, accumulation + jittering\n    // http://en.wikipedia.org/wiki/Moving_average#Cumulative_moving_average\n    // cumulative moving average over frameNum (which starts at 2)\n    // n is previous frame\n    // accumColorN = Accum(n)\n    // return value is accumColor( n +1 )\n    // Accum(n+1) = Accum(n) + ((x(n+1) - Accum(n)) / (n + 1)))\n    // formula above is equal to glsl  mix\n    return mix(accumColorN, currFragColor, lerpFac);\n\n}\n'},function(t,e){t.exports="// https://github.com/borismus/webvr-boilerplate/blob/master/src/distortion/barrel-distortion-fragment-v2.js\n\nvec2 barrel(const in vec2 v, const in vec4 projection, const in vec4 unprojection, const in vec2 distort) {\n  vec2 w = (v + unprojection.zw) / unprojection.xy;\n  float val = dot(w, w);\n  // float poly = (showCenter == 1 && val < 0.00010) ? 10000.0 : 1.0 + (distort.x + distort.y * val) * val;\n  float poly = 1.0 + (distort.x + distort.y * val) * val;\n  return projection.xy * (poly * w) - projection.zw;\n}\n\nvec2 getDistortUV(const in sampler2D tex, const in vec2 texCoord, const in vec2 distort, const in vec4 projectionLeft, const in vec4 unprojectionLeft) {\n\n  if (abs(texCoord.x - 0.5) < .001) {\n    return vec2(-1.0);\n  }\n\n  vec2 a;\n\n  if (texCoord.x < 0.5){\n    a = barrel(vec2(texCoord.x / 0.5, texCoord.y), projectionLeft, unprojectionLeft, distort);\n  } else {\n    // right projections are shifted and vertically mirrored relative to left\n    const vec3 swi = vec3(1.0, -1.0, 0.0);\n    vec4 projectionRight = (projectionLeft + swi.zzxz) * swi.xxyx;\n    vec4 unprojectionRight = (unprojectionLeft + swi.zzxz) * swi.xxyx;\n    a = barrel(vec2((texCoord.x - 0.5) / 0.5, texCoord.y), projectionRight, unprojectionRight, distort);\n  }\n\n  if (a.x < 0.0 || a.x > 1.0 || a.y < 0.0 || a.y > 1.0) {\n    return vec2(-1.0);\n  } \n\n  return vec2(a.x * 0.5 + (texCoord.x < 0.5 ? 0.0 : 0.5), a.y);\n}\n\nvec3 distortion(const in sampler2D tex, const in vec2 texCoord, const in vec2 distort, const in vec4 projectionLeft, const in vec4 unprojectionLeft, const in sampler2D texExtra) {\n  vec2 distortUV = getDistortUV(tex, texCoord, distort, projectionLeft, unprojectionLeft);\n  if(distortUV.x < 0.0) return vec3(0.0);\n  \n  vec3 color = texture2D(tex, distortUV).rgb;\n  vec4 extra = texture2D(texExtra, distortUV);\n  return extra.rgb + color.rgb * (1.0 - extra.a);\n}\n\nvec3 distortion(const in sampler2D tex, const in vec2 texCoord, const in vec2 distort, const in vec4 projectionLeft, const in vec4 unprojectionLeft) {\n  vec2 distortUV = getDistortUV(tex, texCoord, distort, projectionLeft, unprojectionLeft);\n  if(distortUV.x < 0.0) return vec3(0.0);\n  return texture2D(tex, distortUV).rgb;\n}"},function(t,e){t.exports="#ifdef GL_FRAGMENT_PRECISION_HIGH\n   precision highp float;\n#else\n   precision mediump float;\n#endif\n\nvarying vec2 FragTexCoord0;\nuniform sampler2D Texture0;\nuniform sampler2D Texture1;\nuniform vec4 uHalton;\n\n#ifdef GRAIN\n// https://www.shadertoy.com/view/ldt3WM\n\nuniform float uGrainFactor;\nuniform float uTimeGrain;\n// tri noise\n// https://www.shadertoy.com/view/4t2SDh\n// why trinoise: http://loopit.dk/banding_in_games.pdf \n// trinoise luvhttps://twitter.com/timothylottes/status/650078671974334465\n\n//note: uniformly distributed, normalized rand, [0;1[\nfloat nrand( const in vec2 n ) {\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\nfloat n2randFaster( const in vec2 n ) {\n    float t = fract( uTimeGrain );\n    float nrnd0 = nrand( n + 0.07*t );\n    //float nrnd0 = hash12( n + 0.07*t );\n\n    // Convert uniform distribution into triangle-shaped distribution.\n    float orig = nrnd0*2.0-1.0;\n    nrnd0 = orig*inversesqrt(abs(orig));\n    nrnd0 = max(-1.0,nrnd0); // Nerf the NaN generated by 0*rsqrt(0). Thanks @FioraAeterna!\n    nrnd0 = nrnd0-sign(orig)+0.5;\n\n    // Result is range [-0.5,1.5] which is\n    // useful for actual dithering.\n    // convert to [0,1] for histogram.\n    return (nrnd0+0.5) * 0.5;\n    // return nrnd0;\n}\n\n#endif\n\n#ifdef DOF_CROSS\nuniform vec2 RenderSize;\nuniform float uPixelRatio;\nuniform vec3 uDofCross;\n#endif\n\nvoid main() {\n    vec4 color = uHalton.z > 0.0 ? texture2D(Texture0, FragTexCoord0) : texture2D(Texture1, FragTexCoord0);\n\n    // TODO we could test\n    // http://www.reedbeta.com/blog/2013/01/12/quick-and-easy-gpu-random-numbers-in-d3d11/\n    #ifdef GRAIN\n    vec3 grain = vec3(n2randFaster(FragTexCoord0));\n    color.rgb = mix(color.rgb, color.rgb * ( color.rgb + 2.0 * grain * (1.0 - color.rgb) ), uGrainFactor);\n    #endif\n\n    #ifdef DOF_CROSS\n    float ratio = RenderSize.y / RenderSize.x;\n    float dist = distance(vec2(uDofCross.x, uDofCross.y * ratio), vec2(FragTexCoord0.x, FragTexCoord0.y * ratio));\n    float widthCircle = uPixelRatio / RenderSize.x;\n    color.rgb = mix(color.rgb, vec3(1.0), abs(dist - 60.0 * widthCircle) > widthCircle ? 0.0 : uDofCross.z);\n    #endif\n\n    gl_FragColor = color;\n}\n"},function(t,e){t.exports='#pragma include "functions.glsl"\n\nconst float MAX_BLUR = 16.0;\nconst float EPS_EARLY_OUT = 0.01; // early out (typically when we move the camera fast and the dof might be not effective)\n\nfloat texDepthToCoC(const in sampler2D texDepth, const in vec2 uv, const in vec3 dofBlurNearFarFocal) {\n    vec4 fetch = texture2D(texDepth, uv).rgba;\n    // background should be always max blurred so that the near blur can expand onto the background (because of special dilate background codepath below)\n    if(fetch.x == 1.0) return max(dofBlurNearFarFocal.x, dofBlurNearFarFocal.y);\n    float coc = dot(fetch, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n    coc = clamp((coc - dofBlurNearFarFocal.z) / coc, -1.0, 1.0);\n    return (coc < 0.0 ? coc * dofBlurNearFarFocal.x : coc * dofBlurNearFarFocal.y);\n}\n\n// ------- DOWNSAMPLE INIT ---------\nvec4 dofDownsampleInit(const in sampler2D tex, const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize, const in float ntime,\n    const in float dofScale, const in vec3 dofBlurNearFarFocal) {\n    \n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    return vec4(decodeRGBM(texture2D(tex, uv), 7.0), texDepthToCoC(texDepth, uv, dofBlurNearFarFocal) * 0.5 + 0.5);\n}\n\nfloat dilateNear(const in sampler2D tex, const in vec2 uv, const in vec2 offset, const in bool isBG) {\n    // TODO DOF both the weights and the formula can be tweaked, also we could add a bit of jitter or something\n\n    float coc = 0.0;\n    vec2 ofs = MAX_BLUR * offset / 5.0;\n\n    float coc0 = texture2D(tex, uv).a * 2.0 - 1.0;\n    float coc1 = texture2D(tex, uv - 5.0 * ofs).a * 2.0 - 1.0;\n    float coc2 = texture2D(tex, uv - 4.0 * ofs).a * 2.0 - 1.0;\n    float coc3 = texture2D(tex, uv - 3.0 * ofs).a * 2.0 - 1.0;\n    float coc4 = texture2D(tex, uv - 2.0 * ofs).a * 2.0 - 1.0;\n    float coc5 = texture2D(tex, uv - 1.0 * ofs).a * 2.0 - 1.0;\n    float coc6 = texture2D(tex, uv + 1.0 * ofs).a * 2.0 - 1.0;\n    float coc7 = texture2D(tex, uv + 2.0 * ofs).a * 2.0 - 1.0;\n    float coc8 = texture2D(tex, uv + 3.0 * ofs).a * 2.0 - 1.0;\n    float coc9 = texture2D(tex, uv + 4.0 * ofs).a * 2.0 - 1.0;\n    float coc10 = texture2D(tex, uv + 5.0 * ofs).a * 2.0 - 1.0;\n\n    if(isBG == true){\n        // avoid "shrink" effect on the out of focus far part on the model edges\n        // gaussian weights (sigma 10), (doesn\'t have to be gaussian though), but the sum must be 1.0\n        // http://dev.theomader.com/gaussian-kernel-calculator/\n        coc = abs(coc0) * 0.095474 +\n        (abs(coc1) + abs(coc10)) * 0.084264 +\n        (abs(coc2) + abs(coc9)) * 0.088139 +\n        (abs(coc3) + abs(coc8)) * 0.091276 +\n        (abs(coc4) + abs(coc7)) * 0.093585 +\n        (abs(coc5) + abs(coc6)) * 0.094998;\n    } else {\n        // blur only near field (expand)\n        coc = min(coc0, 0.0);\n        coc = min(coc1 * 0.3, coc);\n        coc = min(coc2 * 0.5, coc);\n        coc = min(coc3 * 0.75, coc);\n        coc = min(coc4 * 0.8, coc);\n        coc = min(coc5 * 0.95, coc);\n        coc = min(coc6 * 0.95, coc);\n        coc = min(coc7 * 0.8, coc);\n        coc = min(coc8 * 0.75, coc);\n        coc = min(coc9 * 0.5, coc);\n        coc = min(coc10 * 0.3, coc);\n        if(abs(coc0) > abs(coc))\n            coc = coc0;\n    }\n\n    return coc;\n}\n\n// ------- DILATE NEAR H ---------\nvec4 dofDilateNearH(const in sampler2D tex, const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize, const in float ntime,\n    const in float dofScale, const in vec3 dofBlurNearFarFocal) {\n    \n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n    \n    vec2 offset = vec2( dofScale / texSize.x, 0.0);\n    float coc = dilateNear(tex, uv, offset, texture2D(texDepth, uv).x == 1.0);\n\n    return vec4(texture2D(tex, uv).rgb, coc * 0.5 + 0.5);\n}\n\n// ------- DILATE NEAR V ---------\nvec4 dofDilateNearV(const in sampler2D tex, const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize, const in float ntime,\n    const in float dofScale, const in vec3 dofBlurNearFarFocal) {\n    \n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n    \n    vec2 offset = vec2(0.0, dofScale / texSize.y);\n    float coc = dilateNear(tex, uv, offset, texture2D(texDepth, uv).x == 1.0);\n\n    return vec4(texture2D(tex, uv).rgb, coc * 0.5 + 0.5);\n}\n\n\nfloat nrand(const in vec2 n) {\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\n\n// ------- BLUR CIRCULAR ---------\nvec4 dofBlurCircular(const in sampler2D tex, const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize, const in float ntime,\n    const in float dofScale, const in vec3 dofBlurNearFarFocal) {\n    \n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    const int NUM_TAPS = 16;\n    vec2 fTaps_Poisson[NUM_TAPS];\n    // https://github.com/bartwronski/PoissonSamplingGenerator\n    fTaps_Poisson[0] = vec2(-0.399691779231, 0.728591545584);\n    fTaps_Poisson[1] = vec2(-0.48622557676, -0.84016533712);\n    fTaps_Poisson[2] = vec2(0.770309468987, -0.24906070432);\n    fTaps_Poisson[3] = vec2(0.556596796154, 0.820359876432);\n    fTaps_Poisson[4] = vec2(-0.933902004071, 0.0600539051593);\n    fTaps_Poisson[5] = vec2(0.330144964342, 0.207477293384);\n    fTaps_Poisson[6] = vec2(0.289013230975, -0.686749271417);\n    fTaps_Poisson[7] = vec2(-0.0832470893559, -0.187351643125);\n    fTaps_Poisson[8] = vec2(-0.296314525615, 0.254474834305);\n    fTaps_Poisson[9] = vec2(-0.850977666059, 0.484642744689);\n    fTaps_Poisson[10] = vec2(0.829287915319, 0.2345063545);\n    fTaps_Poisson[11] = vec2(-0.773042143899, -0.543741521254);\n    fTaps_Poisson[12] = vec2(0.0561133030864, 0.928419742597);\n    fTaps_Poisson[13] = vec2(-0.205799249508, -0.562072714492);\n    fTaps_Poisson[14] = vec2(-0.526991665882, -0.193690188118);\n    fTaps_Poisson[15] = vec2(-0.051789270667, -0.935374050821);\n\n    vec4 centerFetch = texture2D(tex, uv);\n\n    float blurDist = MAX_BLUR * (centerFetch.a * 2.0 - 1.0) * dofScale;\n\n    float rnd = 6.28318 * nrand( uv + 0.07 * fract(ntime) );\n    float cosa = cos(rnd);\n    float sina = sin(rnd);\n    vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n    vec3 sumcol = vec3(0.0);\n    float total = 0.0;\n\n    for (int i = 0; i < NUM_TAPS; i++) {\n        vec2 ofs = fTaps_Poisson[i];\n\n        ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) );\n\n        vec2 texcoord = uv + blurDist * ofs / texSize.xy;\n        vec4 sample = texture2D(tex, texcoord);\n\n        // TODO DOF premult to avoid bleeding, can be tweaked (currently x^3)\n        // tradeoff between bleeding dof and out of focus object that shrinks too much\n        float cocWeight = abs(sample.a * 2.0 - 1.0);\n        cocWeight *= cocWeight * cocWeight;\n\n        sumcol += sample.rgb * cocWeight;\n        total += cocWeight;\n    }\n\n    sumcol /= total;\n\n    return encodeRGBM(sumcol, 7.0);\n}\n\n// ------- DOF COMBINE ---------\nvec3 dofCombine(const in vec3 color, const in sampler2D texBlur, const in sampler2D texCoc, const in sampler2D texDepth, const in vec2 uv,\n    const in float range, const in vec2 texSize, const in float dofScale, const in vec3 dofBlurNearFarFocal) {\n    \n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return color;\n\n    vec3 blur = decodeRGBM(texture2D(texBlur, uv), range);\n\n    vec2 off = vec2(1.0, -1.0) * dofScale;\n    blur += decodeRGBM(texture2D(texBlur, uv + off.xx / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.yy / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.xy / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.yx / texSize), range);\n    blur /= 5.0;\n\n    // try to merged the half coc haf res near blurred with the full res coc\n    float coc = abs(min(texture2D(texCoc, uv).a * 2.0 - 1.0, texDepthToCoC(texDepth, uv, dofBlurNearFarFocal)));\n\n    // TODO DOF can be tweaked, it merges full and half res buffers\n    return mix(color, blur, clamp(coc * coc * 16.0, 0.0, 1.0));\n}\n';
},function(t,e,i){"use strict";var r=i(1097),n=i(1566),a=i(1573),s={FeatureName:"webVR",ModelType:n,ViewListType:[a]},o=r.create(s);o.prototype.getNode=function(){return this._views[0]._nodeWebVR},o.prototype.getNodeProxy=function(){return this._views[0]._proxyVR},t.exports=o},function(t,e,i){"use strict";var r=i(1100),n=i(235),a=i(1341),s=i(1567),o=i(1570),u=i(1572),h=r.osg,fif(r),l=n.Model.extend({defaults:{enable:!1,worldFactor:-1,deviceInfo:void 0,hasNativeVR:!!navigator.getVRDisplays,modeLauncher:!1,hit:void 0,floorHeight:0,humanMatrix:h.Matrix.create(),humanInAir:!1,boundingBox:new h.BoundingBox,boundingSphere:new h.BoundingSphere},init:function(t){this._context=t,this._scene=t.getScene(),this._viewer=t.getViewer()},initWebVR:function(){this.set("deviceInfo",this._initDeviceInfo());var t=this._context.getModel().get("options").vr;if(t&&t.scale>0){this.set("worldFactor",t.scale),this.set("floorHeight",t.floorHeight);var e=this.get("humanMatrix"),i=t.initialCamera;h.Matrix.makeRotateFromQuat(i.rotation,e),h.Matrix.setTrans(e,i.position[0],i.position[1],i.position[2])}this.initBoundAndWorldFactor(),this.set("enable",a().cardboard>0)},isDiorama:function(){var t=Math.min(this.get("boundingSphere").radius(),this.get("boundingBox").radius());return t<2*this.get("worldFactor")},initBoundAndWorldFactor:function(){var t=this.get("boundingBox");if(!(t.valid()&&this.get("worldFactor")>0)){if(!t.valid()){var e=this._viewer.getViewerOSGJS().getManipulator().getNode();if(t.copy(e.getBoundingBox()),!a().graphOptimizer){var i=new u;e.accept(i),t.getMin()[2]=i._minHeight,t.getMax()[2]=i._maxHeight}var r=e.getBoundingSphere(),n=this.get("boundingSphere");n.set(h.Vec3.copy(r.center(),n.center()),r.radius())}if(t.valid()&&this.get("worldFactor")<=0){var s=t.getMin()[2],o=Math.min(this.get("boundingSphere").radius(),this.get("boundingBox").radius());this.set("worldFactor",.5*o),this.set("floorHeight",s),h.Matrix.makeTranslate(0,-o,s,this.get("humanMatrix"))}t.valid()&&this.get("worldFactor")>0&&this.trigger("vrReady")}},_initDeviceInfo:function(){var t=new o(!1),e=new s(t.getDeviceParams());return a().cardboard>1&&e.setViewer(s.Viewers.CardboardV2),e},getName:function(){return"WebVR"},getJSON:function(){var t=h.Matrix.copy(this.get("humanMatrix"),h.Matrix.create()),e=h.Matrix.getScale(t,h.Vec3.create());h.Vec3.set(1/e[0],1/e[1],1/e[2],e);var i=h.Matrix.preMultScale(t,e),r=h.Quat.create();return h.Quat.normalize(h.Matrix.getRotate(i,r),r),{scale:this.get("worldFactor"),initialCamera:{position:h.Matrix.getTrans(i,h.Vec3.create()),rotation:r},floorHeight:this.get("floorHeight")}}});t.exports=l},function(t,e,i){"use strict";function r(t){this.viewer=f.CardboardV1,this.updateDeviceParams(t)}var n=i(1100),a=i(1568),s=i(1569),o=n.osg,fif(n),u=180/Math.PI,h=Math.PI/180,l=function(t){this.id=t.id,this.label=t.label,this.fov=t.fov,this.interLensDistance=t.interLensDistance,this.baselineLensDistance=t.baselineLensDistance,this.screenLensDistance=t.screenLensDistance,this.distortionCoefficients=t.distortionCoefficients,this.inverseCoefficients=t.inverseCoefficients},c=function(t){this.width=t.width||s.getScreenWidth(),this.height=t.height||s.getScreenHeight(),this.widthMeters=t.widthMeters,this.heightMeters=t.heightMeters,this.bevelMeters=t.bevelMeters},d=new c({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),p=new c({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),f={CardboardV1:new l({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new l({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};r.prototype.updateDeviceParams=function(t){this.device=this.determineDevice_(t)||this.device},r.prototype.getDevice=function(){return this.device},r.prototype.setViewer=function(t){this.viewer=t},r.prototype.determineDevice_=function(t){if(!t)return s.isIOS()?(console.warn("Using fallback iOS device measurements."),p):(console.warn("Using fallback Android device measurements."),d);var e=.0254,i=e/t.xdpi,r=e/t.ydpi,n=s.getScreenWidth(),a=s.getScreenHeight();return new c({widthMeters:i*n,heightMeters:r*a,bevelMeters:.001*t.bevelMm})},r.prototype.getDistortedFieldOfViewLeftEye=function(){var t=this.viewer,e=this.device,i=new a(t.distortionCoefficients),r=t.screenLensDistance,n=(e.widthMeters-t.interLensDistance)/2,s=t.interLensDistance/2,o=t.baselineLensDistance-e.bevelMeters,h=e.heightMeters-o,l=u*Math.atan(i.distort(n/r)),c=u*Math.atan(i.distort(s/r)),d=u*Math.atan(i.distort(o/r)),p=u*Math.atan(i.distort(h/r));return{leftDegrees:Math.min(l,t.fov),rightDegrees:Math.min(c,t.fov),downDegrees:Math.min(d,t.fov),upDegrees:Math.min(p,t.fov)}},r.prototype.getFieldOfViewLeftEye=function(t){return t?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},r.prototype.getFieldOfViewRightEye=function(t){var e=this.getFieldOfViewLeftEye(t);return{leftDegrees:e.rightDegrees,rightDegrees:e.leftDegrees,upDegrees:e.upDegrees,downDegrees:e.downDegrees}},r.prototype.getProjectionMatrixLeftEye=function(t){var e=this.getFieldOfViewLeftEye(t),i=o.Matrix.create(),r=.1,n=1e3,a=Math.tan(h*e.leftDegrees)*r,s=Math.tan(h*e.rightDegrees)*r,u=Math.tan(h*e.downDegrees)*r,l=Math.tan(h*e.upDegrees)*r;return o.Matrix.makeFrustum(-a,s,-u,l,r,n,i),i},r.prototype.getUndistortedViewportLeftEye=function(){var t=this.getUndistortedParams_(),e=this.viewer,i=this.device,r=e.screenLensDistance,n=i.widthMeters/r,a=i.heightMeters/r,s=i.width/n,o=i.height/a,u=Math.round((t.eyePosX-t.outerDist)*s),h=Math.round((t.eyePosY-t.bottomDist)*o);return{x:u,y:h,width:Math.round((t.eyePosX+t.innerDist)*s)-u,height:Math.round((t.eyePosY+t.topDist)*o)-h}},r.prototype.getUndistortedFieldOfViewLeftEye=function(){var t=this.getUndistortedParams_();return{leftDegrees:u*Math.atan(t.outerDist),rightDegrees:u*Math.atan(t.innerDist),downDegrees:u*Math.atan(t.bottomDist),upDegrees:u*Math.atan(t.topDist)}},r.prototype.getUndistortedParams_=function(){var t=this.viewer,e=this.device,i=new a(t.distortionCoefficients),r=t.screenLensDistance,n=t.interLensDistance/2/r,s=e.widthMeters/r,o=e.heightMeters/r,u=s/2-n,l=(t.baselineLensDistance-e.bevelMeters)/r,c=t.fov,d=i.distortInverse(Math.tan(h*c)),p=Math.min(u,d),f=Math.min(n,d),g=Math.min(l,d),m=Math.min(o-l,d);return{outerDist:p,innerDist:f,topDist:m,bottomDist:g,eyePosX:u,eyePosY:l}},r.Viewers=f,t.exports=r},function(t,e){"use strict";var i=function(t){this.coefficients=t};i.prototype.distortInverse=function(t){for(var e=t/.9,i=.9*t,r=t-this.distort(e);Math.abs(i-e)>1e-4;){var n=t-this.distort(i),a=i-n*((i-e)/(n-r));e=i,i=a,r=n}return i},i.prototype.distort=function(t){return t*this.distortionFactor_(t)},i.prototype.distortionFactor_=function(t){for(var e=1,i=1,r=t*t,n=0;n<this.coefficients.length;n++){var a=this.coefficients[n];i*=r,e+=a*i}return e},t.exports=i},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a={};a.base64=function(t,e){return"data:"+t+";base64,"+e},a.isMobile=function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t},a.isFirefox=function(){return/firefox/i.test(navigator.userAgent)},a.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},a.isIFrame=function(){try{return window.self!==window.top}catch(t){return!0}},a.appendQueryParameter=function(t,e,i){var r=t.indexOf("?")<0?"?":"&";return t+=r+e+"="+i},a.getQueryParameter=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},a.isLandscapeMode=function(){return 90===window.orientation||-90===window.orientation},a.getScreenWidth=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},a.getScreenHeight=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},a.projectionMatrixToVector_=function(t,e){var i=e||{},r=i.xScale||1,a=i.yScale||1,s=i.xTrans||0,o=i.yTrans||0,u=n.Vec4.create();return u[0]=t[0]*r*.5,u[1]=t[5]*a*.5,u[2]=.5*(t[8]-1-s),u[3]=.5*(t[9]-1-o),u},a.leftProjectionVectorToRight_=function(t){return n.Vec4.createAndSet(t[0],t[1],-t[2]-1,t[3])},t.exports=a},function(t,e,i){"use strict";var r=i(1571),n=i(1569),a="https://storage.googleapis.com/cardboard-dpdb/dpdb.json",s=function(t){this.xdpi=t.xdpi,this.ydpi=t.ydpi,this.bevelMm=t.bevelMm},o=!1,u=function(t){o&&console.log(t)},h=function(t){o&&console.error(t)},l=function(t){o&&console.warn(t)},c=function(t,e){if(this.dpdb=r,this.recalculateDeviceParams_(),t){this.onDeviceParamsUpdated=e,u("Fetching DPDB...");var i=new XMLHttpRequest,n=this;i.open("GET",a,!0),i.addEventListener("load",function(){n.loading=!1,i.status>=200&&i.status<=299?(u("Successfully loaded online DPDB."),n.dpdb=JSON.parse(i.response),n.recalculateDeviceParams_()):h("Error loading online DPDB!")}),i.send()}};c.prototype.getDeviceParams=function(){return this.deviceParams},c.prototype.recalculateDeviceParams_=function(){u("Recalculating device params.");var t=this.calcDeviceParams_();u("New device parameters:"),u(t),t?(this.deviceParams=t,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):h("Failed to recalculate device parameters.")},c.prototype.calcDeviceParams_=function(){var t=this.dpdb;if(!t)return h("DPDB not available."),null;if(1!==t.format)return h("DPDB has unexpected format version."),null;if(!t.devices||!t.devices.length)return h("DPDB does not have a devices section."),null;var e=navigator.userAgent||navigator.vendor||window.opera,i=n.getScreenWidth(),r=n.getScreenHeight();if(u("User agent: "+e),u("Pixel width: "+i),u("Pixel height: "+r),!t.devices)return h("DPDB has no devices section."),null;for(var a=0;a<t.devices.length;a++){var o=t.devices[a];if(o.rules)if("ios"===o.type||"android"===o.type){if(n.isIOS()===("ios"===o.type)){for(var c=!1,d=0;d<o.rules.length;d++){var p=o.rules[d];if(this.matchRule_(p,e,i,r)){u("Rule matched:"),u(p),c=!0;break}}if(c){var f=o.dpi[0]||o.dpi,g=o.dpi[1]||o.dpi;return new s({xdpi:f,ydpi:g,bevelMm:o.bw})}}}else l("Device["+a+"] has invalid type.");else l("Device["+a+"] has no rules section.")}return l("No DPDB device match."),null},c.prototype.matchRule_=function(t,e,i,r){if(!t.ua&&!t.res)return!1;if(t.ua&&e.indexOf(t.ua)<0)return!1;if(t.res){if(!t.res[0]||!t.res[1])return!1;var n=t.res[0],a=t.res[1];if(Math.min(i,r)!==Math.min(n,a)||Math.max(i,r)!==Math.max(n,a))return!1}return!0},t.exports=c},function(t,e){"use strict";var i={format:1,last_updated:"2016-01-26T23:11:18Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3}]};t.exports=i},function(t,e,i){"use strict";var r=i(1100),n=r.osg,fif(r),a=function(){n.ComputeBoundsVisitor.call(this),this._minHeight=1/0,this._maxHeight=-(1/0),this._tmpMatrix=n.Matrix.create(),this._geometries=[]};a.prototype=n.objectInherit(n.ComputeBoundsVisitor.prototype,{apply:function(t){if(t instanceof n.Transform)return void this.applyTransform(t);if(t instanceof n.Geometry){var e=t.getVertexAttributeList().Vertex.getElements();t.computeTransformedVertices&&(e=t.computeTransformedVertices());for(var i=this._matrixStack.length,r=i>0?this._matrixStack[i-1]:n.Matrix.identity,a=r[3],s=r[7],o=r[11],u=r[15],h=r[2],l=r[6],c=r[10],d=r[14],p=0,f=e.length;f>p;p+=3){var g=e[p],m=e[p+1],v=e[p+2],_=(h*g+l*m+c*v+d)/(a*g+s*m+o*v+u);this._minHeight=Math.min(this._minHeight,_),this._maxHeight=Math.max(this._maxHeight,_)}}else this.traverse(t)}}),t.exports=a},function(t,e,i){"use strict";var r=i(219),n=i(1100),a=i(258),s=i(1405),o=i(1362),u=i(1569),h=i(1390),l=i(1388),c=i(1093),d=i(1341),p=i(1401),f=i(1534),g=i(1574),m=i(1589),v=i(1592),_=i(1595),b=i(1598),x=i(1603),A=n.osg,fif(n),y=new p({device:"VWR",listen:!0}),S=1.8,C=1.02,w=a.extend({initialize:function(){a.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:enable",this.onEnable,this),t.bind("change:worldFactor",this.onWorldFactor,this),t.bind("change:floorHeight",this.onFloorHeight,this),t.bind("doubleTap",this.onDoubleTap,this),t.bind("snapHumanOnFloor",this.snapHumanOnFloor,this),this._hasPresentVR=!1,this._standaloneViewer=!d().messaging,y.on("message:requestPresent",this.onRequestPresent,this),this._viewer=this.options.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._cullConfig=s.vrConfig,this._lastSelectedHotspot=void 0,this._lastHoveredHotspot=void 0,this._lastFloorHeight=0,this._lastTime=0,this._lastWorldFactor=-1,this._lastMouse=A.Vec2.create(),this._interpolatorAlpha=new n.osgGA.OrbitManipulator.Interpolator(1),this._interpolatorAlpha.setDelay(.1),this._cardboardButtonPress=this.cardboardButtonPress.bind(this),this._cardboardPressed=!1,this._nodeWebVR=new A.Node,this._nodeWebVR.setName("Feature - WebVR"),this._proxyVR=new A.Node,this._proxyVR.setName("WebVR - Proxy"),this._proxyVR.setNodeMask(0),this._floorMT=new _(t),this._humanMT=new g(t),this._menuMT=new x(this._manipulator,t),this._teleportNode=new m,this._cursorMT=new v,this._controllerMT=new b(t,this._viewer.getCanvas()),this._dataDownloaded=!1,this._scaleControlEnabled=!0,this.onFloorHeight(),this.initGraphNodes(),this.hookComputeCanvasSize();var e=this._viewer.getCanvas();this.model.get("hasNativeVR")&&(window.addEventListener("keydown",this.onKeyDown.bind(this)),e.addEventListener("mousedown",this.onMouseDown.bind(this))),c()&&e.addEventListener("mousemove",this.onMouseMove.bind(this)),this._viewer.getPromiseModelDisplayed().then(this.initWebVR.bind(this))},onRequestPresent:function(t){this._standaloneViewer?A.log("Launcher onRequestPresent"):A.log("Viewer onRequestPresent"),this.startEnable(!0,!0),t.removeFromHash()},initWebVR:function(){this._nodeWebVR.addUpdateCallback(this)},setProxyVisible:function(t){this._proxyVR.setNodeMask(t?l.NO_SHADOW:0)},onDoubleTap:function(t){if(!this.model.get("enable")&&-1===t.nodepath.indexOf(this._humanMT)){var e=this._viewer.getFeaturesManager(),i=A.Vec3.create();e.getWorldPositionFromHit(t,i),A.Matrix.setTrans(this._humanMT.getMatrix(),i[0],i[1],i[2]),o.draw()}},onKeyDown:function(t){var e=this.model.get("worldFactor");if(!(0>=e)){var i=1;if(79===t.which)i=1.2;else{if(80!==t.which)return;i=1/1.2}this.model.set("worldFactor",e*i)}},onMouseMove:function(t){this._lastMouse[0]=void 0===t.offsetX?t.layerX:t.offsetX,this._lastMouse[1]=void 0===t.offsetY?t.layerY:t.offsetY},onMouseDown:function(){this._cardboardPressed=!0,this._controllerMT._teleportPressed=!0},onFloorHeight:function(){var t=this.model.get("floorHeight"),e=.05*this.model.get("worldFactor");Math.abs(this._humanMT.getMatrix()[14]-this._lastFloorHeight)<=e&&(this._humanMT.getMatrix()[14]=t),this._floorMT.getMatrix()[14]=t,this._lastFloorHeight=t},initGraphNodes:function(){this._nodeWebVR.addChild(this._proxyVR),this._proxyVR.addChild(this._floorMT),this._proxyVR.addChild(this._humanMT),this._proxyVR.addChild(this._menuMT),this._proxyVR.addChild(this._teleportNode),this._proxyVR.addChild(this._cursorMT),this._proxyVR.addChild(this._controllerMT);var t=this._proxyVR.getOrCreateStateSet();t.setRenderBinDetails(h.TRANSPARENT_BIN_NO_EARLYZ_POST,"RenderBin"),t.setAttributeAndModes(new A.Depth(A.Depth.LESS,0,1,!1)),t.setAttributeAndModes(new A.CullFace(A.CullFace.DISABLE))},resetCameraToHuman:function(){var t=A.Vec3.create(),e=A.Vec3.create(),i=A.Matrix.create();return function(){var r=this.getConfigWebVR(),n=r.capabilities.hasPosition&&r.stageParameters,a=A.Matrix.copy(this._humanMT.getMatrix(),i);A.Matrix.getScale(a,t),A.Vec3.set(1/t[0],1/t[1],1/t[2],t),A.Matrix.preMultScale(a,t);var s=this._manipulator.getFirstPersonManipulator(),o=s.getPostMultRotate();A.Quat.normalize(A.Matrix.getRotate(a,o),o),s.setResetInitialRotationVR(!0),A.Matrix.getTrans(a,e),n&&A.Matrix.isIdentity(n.sittingToStandingTransform)&&this.handleBuggyStandingTransform(r,3),e[2]+=this.getEyeLevel(),this._viewer.getFeaturesManager().focusOnTargetAndEye(void 0,e)}}(),requestData:function(t){var e=this.model.get("modeLauncher");!t||e||this._dataDownloaded||(this._dataDownloaded=!0,this._teleportNode.initTextureTeleport(),this._floorMT.initTextureFloor(),this._menuMT.initMeshMenu())},notifyPresentVR:function(){var t=this.model.get("enable"),e=this.model.get("modeLauncher");this._hasPresentVR=t,e&&(this._scaleControlEnabled=!1);var i;this._standaloneViewer?!t&&e&&(A.log("Launcher sending requestPresent"),i=y.createMessage({data:"requestPresent"}),i.appendToHash(),A.log("Launcher sent requestPresent")):(A.log("Viewer enable after Promise"+t),t||(A.log("Viewer SendingExit"),i=y.createMessage({data:"exit"}),i.appendToHash(),A.log("Viewer SentExit")))},startEnable:function(t,e){var i=this._viewer.getFeatures();this.setProxyVisible(t),this.requestData(t),this.updateDistortion(),i.postProcess.getModel().set("webVR",t),i.background.getModel().set("webVR",t),i.manipulator.getModel().set("webVR",t),i.hotspot.getModel().set("webVR",t),i.shadingStyle.getModel().set("webVR",t),i.lighting.getModel().set("webVR",t),this._cullConfig.doVR=t,this._controllerMT.setListenToEvents(t),this._menuMT.checkModelAnnotations(i),t?(this._floorMT.updateNodeVR(this.model.get("boundingBox"),this.model.get("boundingSphere"),this.model.get("worldFactor")),this.resetCameraToHuman()):this._viewer.getFeaturesManager().focusOnHomePosition(),this._standaloneViewer?A.log("Launcher StartEnable: enabled:"+t+" doPresentVR: "+e):A.log("Viewer StartEnable: enabled:"+t+" doPresentVR: "+e),t&&!e||this._hasPresentVR===t||(this.model.get("hasNativeVR")?this._viewerOSGJS.setPresentVR(t).then(this.notifyPresentVR.bind(this),this.notifyPresentVR.bind(this)):this.notifyPresentVR())},onEnable:function(){var t=this.model.get("enable");this.startEnable(t,this._standaloneViewer)},handleBuggyStandingTransform:function(t,e){0!==e&&(A.warn("VR: Handling buggy standing transform Vive"),navigator.getVRDisplays().then(function(i){for(var r=0;r<i.length;++r)if(i[r].displayName===t.displayName){t=i[r];break}var n=t.capabilities.hasPosition&&t.stageParameters;return n&&A.Matrix.isIdentity(n.sittingToStandingTransform)?void setTimeout(this.handleBuggyStandingTransform.bind(this,t,--e),5e3):void 0}.bind(this)))},cardboardButtonPress:function(){return this._cardboardPressed=!0,!0},handleSingleClick:function(){this._cardboardPressed=!0},updateDistortion:function(){if(!this.model.get("hasNativeVR")){var t=this._viewer.getFeatures().postProcess.getModel();t.set("doDistortionVR",!0);var e=this.model.get("deviceInfo"),i=e.getProjectionMatrixLeftEye(),r=e.getProjectionMatrixLeftEye(!0),n=e.getUndistortedViewportLeftEye(),a=e.device,s={xScale:n.width/(a.width/2),yScale:n.height/a.height,xTrans:2*(n.x+n.width/2)/(a.width/2)-1,yTrans:2*(n.y+n.height/2)/a.height-1};t.set("distortion",e.viewer.distortionCoefficients),t.set("projectionLeft",u.projectionMatrixToVector_(i)),t.set("unprojectionLeft",u.projectionMatrixToVector_(r,s))}},snapHumanOnFloor:function(){this._humanMT.getMatrix()[14]-=this._humanMT.computeDistanceToFloor()},getEyeLevel:function(){var t=this.getConfigWebVR(),e=t.capabilities.hasPosition&&t.stageParameters;return e?this.getPosVR()[2]:this.model.get("worldFactor")*S},snapOnFloor:function(){var t=this.model.get("worldFactor"),e=this._manipulator.getEyePosition(A.Vec3.create()),i=A.Vec3.copy(e,A.Vec3.create());i[2]-=5*t;var r=this._viewer.getFeaturesManager(),n=r.computeNearestIntersection3D(e,i,l.PICK_GEOMETRY_FAST,this._nodeWebVR);if(n){var a=A.Vec3.create();r.getWorldPositionFromHit(n,a),a[2]+=this.getEyeLevel(),r.focusOnTargetAndEye(void 0,a)}},onWorldFactor:function(){var t=this.model.get("worldFactor");this._lastWorldFactor>0&&this._lastWorldFactor!==t&&(A.Vec3.mult(this.getPosVR(),t/this._lastWorldFactor,this.getPosVR()),this.model.get("enable")&&this.snapOnFloor()),this._lastWorldFactor=t;var e=this.getConfigWebVR(),i=this._cullConfig,r=e.getEyeParameters("left"),n=e.getEyeParameters("right");i.leftRenderWidth=r.renderWidth,i.leftRenderHeight=r.renderHeight,i.rightRenderWidth=n.renderWidth,i.rightRenderHeight=n.renderHeight,this.perspectiveMatrixFromVRFieldOfView(r.fieldOfView,.1,1e3,i.leftProjection),this.perspectiveMatrixFromVRFieldOfView(n.fieldOfView,.1,1e3,i.rightProjection),A.Matrix.makeTranslate(-t*r.offset[0],-t*r.offset[1],-t*r.offset[2],i.leftOffsetView),A.Matrix.makeTranslate(-t*n.offset[0],-t*n.offset[1],-t*n.offset[2],i.rightOffsetView);var a=this._viewerOSGJS.getEventProxy().WebVR;a.setWorldScale(t),o.draw()},perspectiveMatrixFromVRFieldOfView:function(t,e,i,r){var n=r||A.Matrix.create(),a=Math.PI/180,s=Math.tan(t.upDegrees*a)*e,o=Math.tan(t.downDegrees*a)*e,u=Math.tan(t.leftDegrees*a)*e,h=Math.tan(t.rightDegrees*a)*e;return A.Matrix.makeFrustum(-u,h,-o,s,e,i,n),n},hookComputeCanvasSize:function(){var t=this._viewerOSGJS,e=t.computeCanvasSize,i=this,r=this._cullConfig;t.computeCanvasSize=function(n){var a=i.model.get("enable");if(!a)return e.call(t,n);i.model.get("hasNativeVR")&&i.onWorldFactor();var s=Math.floor(r.leftRenderWidth+r.rightRenderWidth),o=Math.floor(Math.max(r.leftRenderHeight,r.rightRenderHeight)),u=Math.max(s,o);if(!a&&u>4096){var h=4096/u;s=Math.floor(s*h),o=Math.floor(o*h)}var l=!1;return this._canvasWidth!==s&&(n.width=s,this._canvasWidth=s,l=!0),this._canvasHeight!==o&&(n.height=o,this._canvasHeight=o,l=!0),l}},getConfigWebVR:function(){var t=this._viewerOSGJS,e=t.getVRDisplay();if(e)return e;if(this._defaultHMD)return this._defaultHMD;var i=this.model.get("deviceInfo"),r=.5*i.viewer.interLensDistance,n=i.getUndistortedViewportLeftEye(),a=t._devicePixelRatio/Math.max(t._devicePixelRatio,window.devicePixelRatio||1),s={
left:{fieldOfView:i.getFieldOfViewLeftEye(!1),offset:A.Vec3.createAndSet(-r,0,0),renderWidth:n.width*a,renderHeight:n.height*a},right:{fieldOfView:i.getFieldOfViewRightEye(!1),offset:A.Vec3.createAndSet(r,0,0),renderWidth:n.width*a,renderHeight:n.height*a}};return this._defaultHMD={getEyeParameters:function(t){return s[t]},capabilities:{hasPosition:!1}},this._defaultHMD},getPosVR:function(){var t=A.Vec3.create();return function(){return this._manipulator.getCurrentManipulator()._vrPos||A.Vec3.init(t)}}(),updateHitHotspot:function(){var t=A.Vec3.create(),e=A.Vec3.create(),i=A.Vec3.create(),n=A.Vec3.create(),a=function(t){return t instanceof f};return function(s,o,u,h,c){var d=this._viewer.getFeaturesManager(),p=this.model.get("worldFactor"),f=this._viewer.getFeatures().hotspot.getNodeProxy(),g=s&&-1!==s.nodepath.indexOf(f);if(this._lastHoveredHotspot&&this._lastHoveredHotspot.setHovered(!1),!g)return this._lastHoveredHotspot&&this._lastHoveredHotspot.updateCardHit(),this._lastHoveredHotspot=void 0,void this._teleportNode.setHotspotHint(!1);var m=this._lastHoveredHotspot=r.find(s.nodepath,a);if(m.updateCardHit(s),m.setHovered(!0),m.isFullyVisibleCard())return m;d.getWorldPositionFromScenePoint(A.Matrix.getTrans(m.getHotspotMatrix(),t),e),A.Vec3.sub(e,o,t),t[2]=0,A.Vec3.normalize(t,t),A.Vec3.mult(t,2.5*p,t),A.Vec3.sub(e,t,i),i[2]=e[2]+p,A.Vec3.copy(i,n),n[2]-=3.5*p;var v=d.computeNearestIntersection3D(i,n,l.PICK_GEOMETRY_FAST,this._nodeWebVR);return v?d.getWorldPositionFromHit(v,h,c):(A.Vec3.copy(i,h),h[2]-=this.getEyeLevel(),A.Vec3.set(0,0,1,c)),this._teleportNode.setHotspotHint(m.canTeleport(),h,e,p),m.setWorldTeleportPosition(e,h,p),m}}(),handleHitPicking:function(t,e,i,r,n,a,s){var o,u=this._viewer.getFeaturesManager(),h=this.model.get("worldFactor"),c=this._floorMT.getBoundingSphere(),d=A.Vec3.distance(e,c.center())+c.radius();return t?o=u.computeNearestIntersection2D(this._lastMouse[0],this._lastMouse[1],l.PICK_GEOMETRY_FAST):this._controllerMT.isActiveControllerTracked()?(o=this._controllerMT.raycastFromController(this._nodeWebVR,u,d,a,s),o?(u.getWorldPositionFromHit(o,r,n),this._controllerMT.updatePointerScaleFromHit(r,h),this._cursorMT.setColor(A.Vec3.createAndSet(.1,.66,.85))):(this._controllerMT.resetPointerScale(),A.Vec3.copy(s,r))):(A.Vec3.copy(e,a),A.Vec3.copy(i,s),A.Vec3.mult(i,d,s),A.Vec3.add(a,s,s),o=u.computeNearestIntersection3DHotspotFirst(a,s,l.PICK_GEOMETRY_FAST,this._nodeWebVR),o?u.getWorldPositionFromHit(o,r,n):(A.Vec3.mult(i,3*h,r),A.Vec3.add(e,r,r))),o},update:function(){var t=A.Vec3.create(),e=A.Vec3.create(),i=A.Vec3.create(),r=A.Vec3.create(),n=A.Vec3.create(),a=A.Vec3.create(),s=A.Vec3.create(),u=A.Vec3.create();return function(h,l){var c=this._viewer.getFeaturesManager(),p=this._viewer.getFeatures(),f=this.model.get("enable"),g=this.model.get("modeLauncher"),m=this._viewer.getOptions().widgetAPI,v=!(!m||"vr"!==m.getTabbedWidget().get());if(this.setProxyVisible(f||v),p.background.getModel().set("webVR",f||v),p.postProcess.getModel().set("webVR",f||v),!f&&!v)return!0;var _=this.model.get("worldFactor"),b=l.getFrameStamp(),x=b.getSimulationTime(),y=b.getDeltaTime(),S=this.getConfigWebVR();this._manipulator.getEyePosition(i),this._manipulator.getTarget(r),A.Vec3.sub(r,i,r),A.Vec3.normalize(r,r);var w=this._viewer.getCamera(),T=.02*this._viewerOSGJS.getCanvasClientWidth()*A.Matrix.getScale(w.getProjectionMatrix(),u)[0],M=this._controllerMT.checkValueChange();this._scaleControlEnabled&&0!==M&&(M=this.model.get("worldFactor")*(Math.sign(M)>0?C:1/C),this.model.set("worldFactor",M)),this._controllerMT.updateNodeVR(_,A.Vec3.sub(i,this.getPosVR(),u),S,y);var E=this.handleHitPicking(!f&&v,i,r,e,t,n,a);this.model.set("hit",E),A.Vec3.copy(e,s);var k,I=f&&!g&&this._controllerMT.isTeleportPressed(),N=!g&&this._controllerMT.isClickPressed(),R=this._controllerMT.isMenuPressed(this._menuMT.isVisible()),F=E&&-1===E.nodepath.indexOf(this._menuMT)&&(I||N)&&this._menuMT.isVisible(),P=f&&d().vrMenu&&(R||F),D=this._menuMT.updateNodeVR(E,I||N,P,w,y,_);if(f&&!D&&!P&&!g){k=this.updateHitHotspot(E,n,a,s,t),this._teleportNode.updateWorldNormal(b,t);var L=E&&Math.abs(t[2])>.5,O=k?k.canTeleport():L,V=E&&-1!==E.nodepath.indexOf(this._floorMT),B=k?k.canTeleport():L&&(!this.model.isDiorama()||V);I&&x-this._lastTime>.5&&(O&&(this._lastTime=x,s[2]+=this.getEyeLevel(),c.focusOnTargetAndEye(A.Vec3.add(s,r,u),s)),k&&(k.isFullyVisibleCard()?k.onCardHit():(this._lastSelectedHotspot&&this._lastSelectedHotspot.setVisibleCard(!1),this._lastSelectedHotspot=k,k&&k.setVisibleCard(!0)))),this._interpolatorAlpha.setTarget(B?1:0),this._interpolatorAlpha.update(b.getDeltaTime())}var U=A.Vec3.distance(i,e)/T,G=D||P?0:this._interpolatorAlpha.getCurrent()[0];return this._cursorMT.setVisible(f),this._teleportNode.setVisible(!g&&f&&!D&&!R),this._humanMT.setVisible(v),this._floorMT.setVisible(!g),this._floorMT.updateNodeVR(this.model.get("boundingBox"),this.model.get("boundingSphere"),_),this._humanMT.updateNodeVR(E,x),this._teleportNode.updateNodeVR(G,E,b,s,_,U,t),this._cursorMT.updateNodeVR(g||k?1:1-G,w,e,U),o.draw(),!0}}()});t.exports=w},function(t,e,i){"use strict";var r=i(1100),n=i(1490),a=i(1390),s=i(1388),o=i(1093),u=i(1575),h=i(1583),l=i(1584),c=i(1585),d=i(1586),p=i(1587),f=i(1588),g=r.osg,fif(r),m=r.osgUtil,v=.1,_=g.Vec3.createAndSet(.1,.4,.8),b=g.Vec3.createAndSet(1,.7,.1),x=g.Vec3.createAndSet(1,0,0),A=function(t){g.MatrixTransform.call(this),this._model=t,this.setMatrix(t.get("humanMatrix")),this.setName("WebVR - Human"),this.setNodeMask(s.NO_SHADOW),this.editMask=m.NodeGizmo.NO_FULL_CIRCLE|m.NodeGizmo.PICK_PLANE_Z|m.NodeGizmo.PICK_ARROW|m.NodeGizmo.PICK_ARC_Z,this._humanMT=new g.MatrixTransform,g.Matrix.makeRotate(Math.PI,0,0,1,this._humanMT.getMatrix()),this._geoHuman=new g.Geometry,this._humanMT.addChild(this._geoHuman),this._uColorCylinder=g.Uniform.createFloat3(g.Vec3.copy(_,g.Vec3.create()),"uColor"),this._uColorHint=g.Uniform.createFloat3(g.Vec3.copy(b,g.Vec3.create()),"uColor"),this._hintToFloorMT=new g.MatrixTransform,this._geoHintToFloor=g.createTexturedBoxGeometry(0,0,-.5,.02,.02,1),this._hintToFloorMT.addChild(this._geoHintToFloor),this._hintToFloorMT.setNodeMask(s.NO_PICK),this._geoCylinder=m.GizmoGeometry.createCylinderGeometry(1,1,1,50,1,!1,!1),this._geoCylinder.setNodeMask(s.NO_PICK);for(var e=0,i=this._geoCylinder.getAttributes().Vertex.getElements(),r=i.length/3;r>e;++e)i[3*e+2]+=.5;this._cylinderMT=new g.MatrixTransform,g.Matrix.makeScale(1,1,.5,this._cylinderMT.getMatrix()),this._cylinderMT.addChild(this._geoCylinder),this.addChild(this._humanMT),this.addChild(this._cylinderMT),this.addChild(this._hintToFloorMT),this._boundingBoxComputed=!0,this._boundingSphereComputed=!0,this.init()};A.prototype=g.objectInherit(g.MatrixTransform.prototype,{init:function(){this.getOrCreateStateSet().setAttributeAndModes(new g.CullFace(g.CullFace.BACK));var t=this._humanMT.getOrCreateStateSet();t.setAttributeAndModes(this.createShader("human","VRHuman",h,l)),t.setRenderBinDetails(a.OPAQUE_BIN,"RenderBin"),o()&&u.getHuman(this.initHumanMesh.bind(this));var e=this._geoHintToFloor.getOrCreateStateSet();e.setAttributeAndModes(this.createShader("hintToFloor","VRHintToFloor",p,f)),e.addUniform(this._uColorHint),e.setRenderBinDetails(a.TRANSPARENT_BIN_NO_EARLYZ_POST,"RenderBin");var i=this._geoCylinder.getOrCreateStateSet();i.setAttributeAndModes(this.createShader("humanCylinder","VRHumanCylinder",c,d)),i.addUniform(this._uColorCylinder),i.addUniform(g.Uniform.createFloat(1,"uAlpha")),i.setRenderBinDetails(a.TRANSPARENT_BIN_NO_EARLYZ_POST,"RenderBin")},initHumanMesh:function(t){var e=this._geoHuman;e.getAttributes().Vertex=new g.BufferArray(g.BufferArray.ARRAY_BUFFER,t.VERTEX,3),e.getAttributes().Color=new g.BufferArray(g.BufferArray.ARRAY_BUFFER,t.COLOR,4),e.getPrimitives().push(new g.DrawElements(g.PrimitiveSet.TRIANGLES,new g.BufferArray(g.BufferArray.ELEMENT_ARRAY_BUFFER,t.TRIANGLES,1))),e.getPrimitives().push(new g.DrawElements(g.PrimitiveSet.TRIANGLE_STRIP,new g.BufferArray(g.BufferArray.ELEMENT_ARRAY_BUFFER,t.STRIP,1)))},setVisible:function(t){this.setNodeMask(t?s.NO_SHADOW:0)},createShader:function(t,e,i,r){var a="#define SHADER_NAME "+e+"\n",s=n(),o={};return o["webVR-"+t+"-vert"]=a+i,o["webVR-"+t+"-frag"]=a+r,s.addShaders(o),new g.Program(new g.Shader(g.Shader.VERTEX_SHADER,s.getShader("webVR-"+t+"-vert")),new g.Shader(g.Shader.FRAGMENT_SHADER,s.getShader("webVR-"+t+"-frag")))},computeDistanceToFloor:function(){var t=g.Vec3.create(),e=g.Vec3.create();return function(){var i=this.getMatrix(),r=this._model,n=r._viewer.getFeaturesManager(),a=r.get("worldFactor"),o=r.get("floorHeight");g.Matrix.getTrans(i,t),g.Vec3.copy(t,e);var u=v*a;t[2]+=u,e[2]-=100*a,this.setVisible(!1);var h=n.computeNearestIntersection3D(t,e,s.PICK_GEOMETRY_SLOW);return this.setVisible(!0),u=h?g.Vec3.distance(t,n.getWorldPositionFromHit(h,e)):t[2]-o,Math.max(0,u-v*a)}}(),updateNodeVR:function(){var t=g.Vec3.create();return function(e,i){if(0!==this.getNodeMask()){var r=this.getMatrix(),n=this._model,a=n._viewer.getFeaturesManager(),s=n.get("worldFactor"),o=n.get("floorHeight");g.Vec3.lerp(.5*Math.sin(10*i)+.5,b,x,this._uColorHint.getInternalArray()),g.Matrix.getScale(r,t),g.Vec3.set(s/t[0],s/t[1],s/t[2],t),g.Matrix.preMultScale(r,t),r[14]=Math.max(r[14],o);var u=a._nodeGizmo._attachedNode===this||e&&-1!==e.nodepath.indexOf(this._humanMT);g.Vec3.copy(u?b:_,this._uColorCylinder.getInternalArray());var h=this.computeDistanceToFloor()/s,l=h>.05;g.Matrix.makeScale(1,1,l?h:1e-7,this._hintToFloorMT.getMatrix()),this._model.set("humanInAir",l),this.dirtyBound()}}}()}),t.exports=A},function(t,e,i){"use strict";t.exports={getBaseVR:function(t){i.e(14,function(){t(i(1576))})},getController:function(t){i.e(15,function(){t(i(1581))})},getHuman:function(t){i.e(16,function(){t(i(1582))})}}},,,,,,,,function(t,e){t.exports="attribute vec3 Vertex;\nattribute vec4 Color;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvarying vec3 vColor;\n\nvoid main(void) {\n  vColor = Color.rgb;\n  gl_Position = ProjectionMatrix * (ModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(t,e){t.exports='varying vec3 vColor;\n\nuniform int uOutputLinear;\nuniform float uRGBMRange;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec3 color = uOutputLinear == 0 ? linearTosRGB(vColor) : vColor;\n\n  gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n'},function(t,e){t.exports="attribute vec3 Vertex;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvarying float vHeight;\n\nvoid main(void) {\n  vHeight = Vertex.z;\n  gl_Position = ProjectionMatrix * (ModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(t,e){t.exports='uniform vec3 uColor;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * uAlpha * smoothstep(1.0, 0.0, pow(vHeight, 0.3));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},1585,function(t,e){t.exports='uniform vec3 uColor;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * smoothstep(1.0, 0.0, vHeight + 1.0);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(t,e,i){"use strict";var r=i(1100),n=i(1490),a=i(1388),s=i(1099),o=i(1575),u=i(1359),h=i(1590),l=i(1591),c=i(1585),d=i(1586),p=r.osg,fif(r),f=r.osgUtil,g=function(){p.Node.call(this),this.setName("WebVR - Teleport"),this.setVisible(!0),this._interpolatorNormal=new r.osgGA.OrbitManipulator.Interpolator(3),this._interpolatorNormal.setDelay(.08),this._geoCircle1=p.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._geoCircle2=p.createTexturedQuadGeometry(-.5,-.5,.15,1,0,0,0,1,0),this._geoCircle3=p.createTexturedQuadGeometry(-.5,-.5,.15,1,0,0,0,1,0),this._uAlpha1=p.Uniform.createFloat(1,"uAlpha"),this._uAlpha2=p.Uniform.createFloat(1,"uAlpha"),this._uAlpha3=p.Uniform.createFloat(1,"uAlpha"),this._uScale1=p.Uniform.createFloat(1,"uScale"),this._uScale2=p.Uniform.createFloat(.99,"uScale"),this._uScale3=p.Uniform.createFloat(.99,"uScale"),this._geoCylinder=f.GizmoGeometry.createCylinderGeometry(1,1,1,50,1,!1,!1);for(var t=0,e=this._geoCylinder.getAttributes().Vertex.getElements(),i=e.length/3;i>t;++t)e[3*t+2]+=.5;this._cylinderMT=new p.MatrixTransform,p.Matrix.makeScale(.38,.38,.125,this._cylinderMT.getMatrix()),this._cylinderMT.addChild(this._geoCylinder),this._hotspotHintMT=new p.MatrixTransform,this._hotspotHintMT.addChild(this._geoCylinder),this._hotspotHintMT.setNodeMask(0),this._teleportMT=new p.MatrixTransform,this._teleportMT.addChild(this._geoCircle1),this._teleportMT.addChild(this._geoCircle2),this._teleportMT.addChild(this._geoCircle3),this._teleportMT.addChild(this._cylinderMT),this.addChild(this._teleportMT),this.addChild(this._hotspotHintMT),this.init()};g.prototype=p.objectInherit(p.Node.prototype,{init:function(){var t=this.getOrCreateStateSet();t.setAttributeAndModes(this.createShader("teleportCircle","VRTeleportCircle",h,l)),t.addUniform(p.Uniform.createInt(0,"uTextureTeleportCircle")),t.setTextureAttributeAndModes(0,u.dummyTexture),this._geoCircle1.getOrCreateStateSet().addUniform(this._uScale1),this._geoCircle2.getOrCreateStateSet().addUniform(this._uScale2),this._geoCircle3.getOrCreateStateSet().addUniform(this._uScale3),this._geoCircle1.getOrCreateStateSet().addUniform(this._uAlpha1),this._geoCircle2.getOrCreateStateSet().addUniform(this._uAlpha2),this._geoCircle3.getOrCreateStateSet().addUniform(this._uAlpha3);var e=this._cylinderMT.getOrCreateStateSet();e.addUniform(p.Uniform.createFloat3(p.Vec3.createAndSet(.7,.7,.3),"uColor")),e.addUniform(this._uAlpha1);var i=this._hotspotHintMT.getOrCreateStateSet();i.addUniform(p.Uniform.createFloat3(p.Vec3.createAndSet(.1,.66,.85),"uColor")),i.addUniform(this._uAlpha1),this._geoCylinder.getOrCreateStateSet().setAttributeAndModes(this.createShader("teleportCylinder","VRTeleportCylinder",c,d))},initTextureTeleport:function(){o.getBaseVR(this.replaceTextureTeleport.bind(this))},replaceTextureTeleport:function(t){this.getOrCreateStateSet().setTextureAttributeAndModes(0,s.instance.getOrCreateTexture(t.TELEPORT_CIRCLE).texture)},setVisible:function(t){this.setNodeMask(t?a.NO_PICK_NO_SHADOW:0)},setHotspotHint:function(){var t=p.Vec3.create(),e=p.Vec3.createAndSet(0,0,1),i=p.Quat.create();return function(r,n,a,s){if(this._hotspotHintMT.setNodeMask(r?-1:0),n){p.Vec3.sub(a,n,t);var o=p.Vec3.length(t);p.Vec3.normalize(t,t),p.Quat.makeRotateFromTo(e,t,i);var u=this._hotspotHintMT.getMatrix();p.Matrix.makeRotateFromQuat(i,u);var h=.02;p.Matrix.preMultScale(u,p.Vec3.set(h*s,h*s,o,t)),p.Matrix.setTrans(u,n[0],n[1],n[2])}}}(),createShader:function(t,e,i,r){var a="#define SHADER_NAME "+e+"\n",s=n(),o={};return o["webVR-"+t+"-vert"]=a+i,o["webVR-"+t+"-frag"]=a+r,s.addShaders(o),new p.Program(new p.Shader(p.Shader.VERTEX_SHADER,s.getShader("webVR-"+t+"-vert")),new p.Shader(p.Shader.FRAGMENT_SHADER,s.getShader("webVR-"+t+"-frag")))},updateWorldNormal:function(t,e){this._interpolatorNormal.setTarget(e[0],e[1],e[2]),this._interpolatorNormal.update(t.getDeltaTime()),p.Vec3.normalize(this._interpolatorNormal.getCurrent(),e)},updateNodeVR:function(){var t=p.Vec3.createAndSet(0,0,1),e=p.Vec3.create();return function(i,r,n,s,o,u,h){var l=this._teleportMT.getMatrix();if(r){var c=Math.acos(p.Vec3.dot(t,h));p.Vec3.cross(h,t,e),p.Matrix.makeRotate(-c,e[0],e[1],e[2],l);var d=Math.min(Math.max(o,u),50*u);p.Matrix.preMultScale(l,p.Vec3.set(d,d,d,e)),p.Matrix.setTrans(l,s[0],s[1],s[2]+.05*o),this.setNodeMask(a.NO_PICK_NO_SHADOW)}else this.setNodeMask(0);var f=n.getSimulationTime(),g=f%.99,m=(f+.2)%.99;this._uScale2.setFloat(g),this._uScale3.setFloat(m),this._uAlpha1.setFloat(i),this._uAlpha2.setFloat(i*(1-g*g)),this._uAlpha3.setFloat(i*(1-m*m)),this._teleportMT.dirtyBound()}}()}),t.exports=g},function(t,e){t.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nuniform float uScale;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n\n  vec3 posLocal = Vertex.xyz * vec3(uScale, uScale, 1.0 - uScale);\n  gl_Position = ProjectionMatrix * (ModelViewMatrix * vec4(posLocal, 1.0));\n}\n"},function(t,e){t.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureTeleportCircle;\nuniform float uScale;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec3 tex = sRGBToLinear(texture2D(uTextureTeleportCircle, vTexCoord0).rgb);\n  vec4 color = uScale == 1.0 ? vec4(tex.rrr, 1.0) * uAlpha * tex.g : vec4(uAlpha * tex.b);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(t,e,i){"use strict";var r=i(1100),n=i(1490),a=i(1388),s=i(1390),o=i(1593),u=i(1594),h=r.osg,fif(r),l=function(){h.MatrixTransform.call(this),this.setName("WebVR - Cursor"),this.setVisible(!0),this._geom=h.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._uAlpha=h.Uniform.createFloat(1,"uAlpha"),this._uColor=h.Uniform.createFloat3(h.Vec3.createAndSet(.7,.7,.7),"uCursorColor"),this.addChild(this._geom),this.init()};l.prototype=h.objectInherit(h.MatrixTransform.prototype,{init:function(){var t=h.StateAttribute.OVERRIDE|h.StateAttribute.ON,e=this.getOrCreateStateSet();e.setAttributeAndModes(this.createShader(),t),e.setRenderBinDetails(s.EDITOR_GIZMO+2,"RenderBin"),e.addUniform(this._uColor),e.addUniform(this._uAlpha)},setVisible:function(t){this.setNodeMask(t?a.NO_PICK_NO_SHADOW:0)},createShader:function(){var t="#define SHADER_NAME VRCursor\n",e=n(),i={};return i["webVR-cursor-vert"]=t+o,i["webVR-cursor-frag"]=t+u,e.addShaders(i),new h.Program(new h.Shader(h.Shader.VERTEX_SHADER,e.getShader("webVR-cursor-vert")),new h.Shader(h.Shader.FRAGMENT_SHADER,e.getShader("webVR-cursor-frag")))},setColor:function(t){h.Vec3.copy(t,this._uColor.getInternalArray())},updateNodeVR:function(){var t=h.Vec3.create(),e=h.Quat.create();return function(i,r,n,a){var s=this.getMatrix();h.Matrix.inverse(r.getViewMatrix(),s),h.Matrix.makeRotateFromQuat(h.Matrix.getRotate(s,e),s),h.Matrix.preMultScale(s,h.Vec3.set(a,a,a,t)),h.Matrix.setTrans(s,n[0],n[1],n[2]),this._uAlpha.setFloat(i),this.dirtyBound()}}()}),t.exports=l},function(t,e){t.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vVertex;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvoid main(void) {\n  vVertex = Vertex.xy;\n\n  vec3 posLocal = Vertex.xyz * 0.5;\n  posLocal += vec3(0.0, 0.0, 0.1);\n\n  gl_Position = ProjectionMatrix * (ModelViewMatrix * vec4(posLocal, 1.0));\n}\n"},function(t,e){t.exports='varying vec2 vVertex;\n\nuniform float uAlpha;\nuniform int uOutputLinear;\nuniform vec3 uCursorColor;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uCursorColor, 1.0) * uAlpha * smoothstep(0.0, 1.0, 1.0 - 2.0 * length(vVertex));\n\n  gl_FragColor = linearTosRGB(color);\n}\n'},function(t,e,i){"use strict";var r=i(1100),n=i(1490),a=i(1388),s=i(1099),o=i(1390),u=i(1093),h=i(1575),l=i(1359),c=i(1596),d=i(1597),p=r.osg,fif(r),f=function(t){p.MatrixTransform.call(this),this._model=t,this._postMultRotate=t._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),this.setName("WebVR - Floor"),this.setNodeMask(a.NO_SHADOW),this._cam=new p.Camera,this._cam.setNearFarRatio(5e-5),this._geom=p.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._uScaleToMeter=p.Uniform.createFloat(1,"uScaleToMeter"),this._cam.addChild(this._geom),this.addChild(this._cam),this.init()};f.prototype=p.objectInherit(p.MatrixTransform.prototype,{init:function(){var t=this.getOrCreateStateSet();t.setAttributeAndModes(this.createShader()),t.addUniform(p.Uniform.createInt(0,"uTextureFloor")),t.setTextureAttributeAndModes(0,l.dummyTexture),t.addUniform(this._uScaleToMeter),t.setRenderBinDetails(o.TRANSPARENT_BIN_NO_EARLYZ_PRE,"RenderBin"),t.setAttributeAndModes(new p.Depth(p.Depth.LEQUAL,1,1,!1)),t.setAttributeAndModes(new p.CullFace(p.CullFace.BACK)),u()&&this.initTextureFloor()},initTextureFloor:function(){h.getBaseVR(this.replaceTextureFloor.bind(this))},replaceTextureFloor:function(t){this.getOrCreateStateSet().setTextureAttributeAndModes(0,s.instance.getOrCreateTexture(t.FLOOR).texture)},setVisible:function(t){this.setNodeMask(t?a.NO_SHADOW:0)},createShader:function(){var t="#define SHADER_NAME VRFloor\n",e=n(),i={};return i["webVR-floor-vert"]=t+c,i["webVR-floor-frag"]=t+d,e.addShaders(i),new p.Program(new p.Shader(p.Shader.VERTEX_SHADER,e.getShader("webVR-floor-vert")),new p.Shader(p.Shader.FRAGMENT_SHADER,e.getShader("webVR-floor-frag")))},updateNodeVR:function(){var t=p.Vec3.create();return function(e,i,r){var n=this.getMatrix(),a=i.center(),s=e.getMin()[2],o=15*Math.min(i.radius(),e.radius()),u=n[14];p.Matrix.makeRotateFromQuat(this._postMultRotate,n),p.Matrix.preMultScale(n,p.Vec3.set(o,o,o,t)),n[12]=a[0],n[13]=a[1],n[14]=Math.min(u,s),this._uScaleToMeter.setFloat(o/r),this._model.set("floorHeight",n[14]),this.dirtyBound()}}()}),t.exports=f},function(t,e){t.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  gl_Position = (ProjectionMatrix * (ModelViewMatrix * vec4(Vertex.xyz, 1.0))).xyww;\n}\n"},function(t,e){t.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureFloor;\nuniform float uScaleToMeter;\nuniform int uOutputLinear;\n\n#define PI 3.14159265359\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  float fade = smoothstep(0.0, 1.0, 1.0 - length(vTexCoord0 * 2.0 - 1.0));\n  vec4 color = vec4(fade * sRGBToLinear(texture2D(uTextureFloor, (vTexCoord0 * 1.0 - 0.5) * uScaleToMeter).r));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(t,e,i){"use strict";var r=i(1100),n=i(1490),a=i(1388),s=i(1390),o=i(1575),u=i(219),h=i(235),l=i(1599),c=i(1600),d=i(1601),p=i(1602),f=r.osg,fif(r),g=20,m=.05,v=.8,_=1.2,b={viveClick:1,viveTeleport:0,viveScale:0,viveMenu:3,oculusClick:0,oculusTeleport:0,oculusMenu:1,oculusScaleUp:5,oculusScaleDown:4},x=function(){this.buttons=[],this.initialized=!1};x.prototype.watch=function(t,e){this.buttons.push({id:t,button:e,isPressed:!1})},x.prototype.update=function(){x=this,this.buttons.forEach(function(t){t.button.pressed!==t.isPressed&&(t.button.pressed?x.trigger("buttondown",t.id):x.trigger("buttonup",t.id),t.isPressed=t.button.pressed)})},u.extend(x.prototype,h.Events);var A=function(t,e){f.MatrixTransform.call(this),this.setName("WebVR - Controller"),this.setNodeMask(a.NO_PICK_NO_SHADOW),this._pointerMT=new f.MatrixTransform,this._proxyController=new f.Node,this._geomPointer=f.createTexturedQuadGeometry(-.5,0,0,1,0,0,0,1,0),this._geomController=new f.createTexturedBoxGeometry(0,-.1,0,.1,.2,.1),this.addChild(this._proxyController),this.addChild(this._pointerMT),this._pointerMT.addChild(this._geomPointer),this._proxyController.addChild(this._geomController),this._activeController=void 0,this._isActiveControllerTracked=!1,this._model=t,this._postMultRotate=t._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),this._uPointerAlpha=f.Uniform.createFloat1(1,"uAlpha"),this._hitScaleOffset=g,this._canvas=e,this._dataDownloaded=!1,this._clicked=!1,this._timeSinceLastClick=0,this._menuPressed=!1,this._clickPressed=!1,this._teleportPressed=!1,this._valueChange=0,this._enable=!0,this._cbPointerDown=this.onMouseDown.bind(this),this._cbPointerUp=this.onMouseUp.bind(this),this.init()};A.prototype=f.objectInherit(f.MatrixTransform.prototype,{init:function(){var t=this._proxyController.getOrCreateStateSet();t.setAttributeAndModes(this.createShader("controller","VRController",l,c)),t.setRenderBinDetails(s.OPAQUE_BIN,"RenderBin"),t.addUniform(f.Uniform.createFloat3(f.Vec3.createAndSet(.93,.93,.93),"uMatColor"));var e=this._geomPointer.getOrCreateStateSet();e.addUniform(this._uPointerAlpha),e.setAttributeAndModes(this.createShader("laser","VRLaser",d,p))},setEventListeners:function(){this._canvas.addEventListener("touchstart",this._cbPointerDown),this._canvas.addEventListener("touchend",this._cbPointerUp),this._canvas.addEventListener("mousedown",this._cbPointerDown),this._canvas.addEventListener("mouseup",this._cbPointerUp)},removeEventListeners:function(){this._canvas.removeEventListener("touchstart",this._cbPointerDown),this._canvas.removeEventListener("touchend",this._cbPointerUp),this._canvas.removeEventListener("mousedown",this._cbPointerDown),this._canvas.removeEventListener("mouseup",this._cbPointerUp)},setListenToEvents:function(t){t?this.setEventListeners():this.removeEventListeners()},isActiveControllerTracked:function(){return this._isActiveControllerTracked},replaceControllerMesh:function(t){var e=this._geomController;this._proxyController.removeChild(e);var i=t.BODY;this._geomController=new f.Geometry,this._geomController.getAttributes().Vertex=new f.BufferArray(f.BufferArray.ARRAY_BUFFER,i.VERTEX,3),this._geomController.getAttributes().Normal=new f.BufferArray(f.BufferArray.ARRAY_BUFFER,i.NORMAL,3),this._geomController.getAttributes().Color=new f.BufferArray(f.BufferArray.ARRAY_BUFFER,i.COLOR,1),this._geomController.getPrimitives().push(new f.DrawElements(f.PrimitiveSet.TRIANGLES,new f.BufferArray(f.BufferArray.ELEMENT_ARRAY_BUFFER,i.TRIANGLES,1))),this._geomController.getPrimitives().push(new f.DrawElements(f.PrimitiveSet.TRIANGLE_STRIP,new f.BufferArray(f.BufferArray.ELEMENT_ARRAY_BUFFER,i.STRIP,1))),this._proxyController.addChild(this._geomController);var r=t.BUTTON;this._geomControllerButtons=new f.Geometry,this._geomControllerButtons.getAttributes().Vertex=new f.BufferArray(f.BufferArray.ARRAY_BUFFER,r.VERTEX,3),this._geomControllerButtons.getAttributes().Normal=new f.BufferArray(f.BufferArray.ARRAY_BUFFER,r.NORMAL,3),this._geomControllerButtons.getAttributes().Color=new f.BufferArray(f.BufferArray.ARRAY_BUFFER,r.COLOR,1),this._geomControllerButtons.getPrimitives().push(new f.DrawElements(f.PrimitiveSet.TRIANGLES,new f.BufferArray(f.BufferArray.ELEMENT_ARRAY_BUFFER,r.TRIANGLES,1))),this._geomControllerButtons.getPrimitives().push(new f.DrawElements(f.PrimitiveSet.TRIANGLE_STRIP,new f.BufferArray(f.BufferArray.ELEMENT_ARRAY_BUFFER,r.STRIP,1))),this._proxyController.addChild(this._geomControllerButtons),this._geomControllerButtons.getOrCreateStateSet().addUniform(f.Uniform.createFloat3(f.Vec3.createAndSet(.03,.59,.78),"uMatColor"))},setEnable:function(t){this._enable=t},onMouseDown:function(){this._clicked=!0},onMouseUp:function(){this._clicked=!1},handleClickEvent:function(t){if(this._clicked){if(this._timeSinceLastClick>_)return this._menuPressed=!0,this._clicked=!1,void(this._timeSinceLastClick=0);this._timeSinceLastClick+=t}else this._timeSinceLastClick>0&&this._timeSinceLastClick<_&&(this._clickPressed=!0,this._teleportPressed=!0,this._timeSinceLastClick=0)},onButtonUp:function(t){if(this._enable)if(this._isActiveControllerTracked)switch(t){case b.viveClick:this._clickPressed=!0;break;case b.viveScale:case b.viveTeleport:0!==this._valueChange?this._valueChange=0:this._teleportPressed=!0;break;case b.viveMenu:this._menuPressed=!0}else switch(t){case b.oculusClick:case b.oculusTeleport:this._clickPressed=!0,this._teleportPressed=!0;break;case b.oculusMenu:this._menuPressed=!0;break;case b.oculusScaleUp:case b.oculusScaleDown:this._valueChange=0}},onButtonDown:function(t){if(this._isActiveControllerTracked)switch(t){case b.viveScale:var e=this._activeController.axes[0];e>v?this._valueChange=1:-v>e&&(this._valueChange=-1)}else switch(t){case b.oculusScaleUp:this._valueChange=1;break;case b.oculusScaleDown:this._valueChange=-1}},createShader:function(t,e,i,r){var a="#define SHADER_NAME "+e+"\n",s=n(),o={};return o["webVR-"+t+"-vert"]=a+i,o["webVR-"+t+"-frag"]=a+r,s.addShaders(o),new f.Program(new f.Shader(f.Shader.VERTEX_SHADER,s.getShader("webVR-"+t+"-vert")),new f.Shader(f.Shader.FRAGMENT_SHADER,s.getShader("webVR-"+t+"-frag")))},getAndSetActiveController:function(){if(navigator.getGamepads){for(var t=!this._activeController,e=navigator.getGamepads(),i=0,r=e.length;r>i;++i)if(e[i]&&(this._activeController=e[i],this._activeController.pose)){var n=this._activeController.pose.orientation;this._isActiveControllerTracked=!(n[0]===n[1]&&n[1]===n[2]&&n[2]===n[3]&&0===n[3])}if(t&&this._activeController&&this._activeController.buttons.length>0){this.eventWatcher=new x;for(var a=0;a<this._activeController.buttons.length;++a)this._activeController.buttons[a]&&this.eventWatcher.watch(a,this._activeController.buttons[a]);this.eventWatcher.off(),this.eventWatcher.on("buttonup",this.onButtonUp,this),this.eventWatcher.on("buttondown",this.onButtonDown,this),this.eventWatcher.on("mousedown",this.onButtonDown,this)}}},applyPoseMatrix:function(){var t=f.Quat.create(),e=f.Vec3.create(),i=f.Matrix.create();return function(r,n,a,s,o){if(n){var u=o.stageParameters&&o.stageParameters.sittingToStandingTransform,h=n.orientation;h&&(u&&(h=f.Matrix.getRotate(u,t),f.Quat.mult(h,n.orientation,h)),h=f.Quat.set(h[0],-h[2],h[1],h[3],t),f.Quat.mult(this._postMultRotate,h,h),f.Matrix.preMult(r,f.Matrix.makeRotateFromQuat(h,i)));var l=n.position;l&&(u&&(l=f.Matrix.transformVec3(u,l,e)),l=f.Vec3.set(l[0]*a,-l[2]*a,l[1]*a,e),f.Quat.transformVec3(this._postMultRotate,l,l),f.Matrix.setTrans(r,l[0]+s[0],l[1]+s[1],l[2]+s[2]))}}}(),updatePointerScaleFromHit:function(t,e){var i=f.Matrix.getTrans(this.getMatrix(),f.Vec3.create()),r=f.Vec3.distance(t,i);this._hitScaleOffset=r/e},resetPointerScale:function(){this._hitScaleOffset=g},isMenuPressed:function(){return this._menuPressed?(this._menuPressed=!1,!0):!1},isTeleportPressed:function(){return this._teleportPressed?(this._teleportPressed=!1,!0):!1},isClickPressed:function(){return this._clickPressed?(this._clickPressed=!1,!0):!1},checkValueChange:function(){return this._valueChange},checkAndResetValueChange:function(){var t=this._valueChange;return this._valueChange=0,t},updateNodeVR:function(t,e,i,r){this.getAndSetActiveController(),this.handleClickEvent(r),this._isActiveControllerTracked&&!this._dataDownloaded&&(this._dataDownloaded=!0,o.getController(this.replaceControllerMesh.bind(this))),this.eventWatcher&&this.eventWatcher.update();var n=this.getMatrix();f.Matrix.makeScale(m,this._hitScaleOffset,1,this._pointerMT.getMatrix()),f.Matrix.makeScale(t,t,t,n),void 0!==this._activeController&&this._isActiveControllerTracked===!0?(this.setNodeMask(a.NO_PICK_NO_SHADOW),this.applyPoseMatrix(n,this._activeController.pose,t,e,i)):this.setNodeMask(0),this.dirtyBound()},raycastFromController:function(){var t=f.Vec3.createAndSet(0,g,0);return function(e,i,r,n,s){f.Matrix.getTrans(this.getMatrix(),n),f.Vec3.set(0,r/this._model.get("worldFactor"),0,s),f.Matrix.transformVec3(this.getMatrix(),s,s);var o=i.computeNearestIntersection3DHotspotFirst(n,s,a.PICK_GEOMETRY_FAST,e);return o||f.Matrix.transformVec3(this.getMatrix(),t,s),o}}()}),t.exports=A},function(t,e){t.exports="attribute vec3 Vertex;\nattribute vec3 Normal;\nattribute float Color;\n\nuniform mat4 NormalMatrix;\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvarying vec4 FragEyeVector;\nvarying vec3 vNormal;\nvarying float vAO;\n\nvoid main(void) {\n  FragEyeVector = ModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  vNormal = vec3(NormalMatrix * vec4(Normal.xyz, 0.0));\n  vAO = Color;\n  gl_Position = ProjectionMatrix * FragEyeVector;\n}\n"},function(t,e){t.exports='varying vec4 FragEyeVector;\nvarying vec3 vNormal;\nvarying float vAO;\n\nuniform int uOutputLinear;\nuniform float uRGBMRange;\nuniform vec3 uMatColor;\n\n#pragma include "lightsPBR.glsl"\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec3 color = vec3(0.0);\n\n  // MATERIAL\n  vec3 eyeVector = -normalize(FragEyeVector.xyz);\n  vec3 normal = normalize(vNormal);\n\n  vec3 albedo = vec3(1.0);\n  float f0 = 0.04;\n  float metalness = 0.0;\n  float roughness = 0.5;\n  vec3 diffuse = sRGBToLinear(uMatColor) * (1.0 - metalness);\n\n  vec3 specular = mix(vec3(f0), albedo, metalness);\n  vec4 prepSpec = LightingFuncPrep(normal, eyeVector, roughness);\n\n  // LIGHT 1\n  vec3 eyeLightDir = normalize(vec3(0.0, 0.3, 0.9));\n  vec3 lightColor = vec3(0.7, 0.7, 0.9);\n  // compute NdL\n  float NdotL = dot(eyeLightDir, normal);\n  if (NdotL > 0.0){\n      color += computeLight(lightColor, diffuse, normal, eyeVector, eyeLightDir, specular, prepSpec, NdotL);\n  }\n\n  // emissive\n  color += vec3(0.07);\n\n  color *= vAO;\n\n  color = uOutputLinear == 0 ? linearTosRGB(color) : color;\n\n  gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n';
},function(t,e){t.exports="attribute vec3 Vertex;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\n\nvarying vec3 vVertex;\n\nvoid main(void) {\n  vVertex = Vertex;\n  gl_Position = ProjectionMatrix * (ModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(t,e){t.exports='varying vec3 vVertex;\n\nuniform int uOutputLinear;\nuniform float uAlpha;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(0.1, 0.66, 0.85, 1.0) * (smoothstep(1.0, 0.0, vVertex.y) * smoothstep(1.0, 0.0, abs(vVertex.x * 4.0))) * uAlpha;\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(t,e,i){"use strict";var r=i(1100),n=i(1490),a=i(1388),s=i(1390),o=i(1575),u=i(1341),h=i(1401),l=i(1604),c=i(1605),d=i(1606),p=i(1607),f=i(1099),g=i(1359),m=r.osg,fif(r),v=r.osgDB,_=r.osgAnimation,b=r.osgText,x="Desktop",A="Mobile",y="Item_",S="Text",C="Group",w="Item_Home",T="Item_HelpPopup",M="Item_HelpButton",E="Item_ExitMenu",k="Item_PreviousAnnotation",I="Item_NextAnnotation",N=.05,R=2.5,F=-.2,P=.2,D=-2,L=.05,O=m.Vec4.createAndSet(.1,.66,.85,1),V=m.Vec4.createAndSet(.1,.1,.1,1),B=_.easeOutCubic,U=["Group_Exit","Group_Help","Group_Home","Group_Annotation"],G=new h({device:"VWR"}),z=function(t,e,i,r,n){this._startPos=t,this._targetPos=e,this._duration=i,this._easingFunc=r,this._result=m.Vec3.create(),this._hasStarted=!1,this._reverse=!1,this._finished=!0,this._node=n};z.prototype={isFinished:function(){return this._finished},reverse:function(){this._reverse=!this._reverse;var t=this._targetPos;this._targetPos=this._startPos,this._startPos=t},start:function(t){this._started=-t*L,this._hasStarted=!1,this._finished=!1,this._node._uAlpha.getInternalArray()[0]=this._reverse?1:0,m.Matrix.setTrans(this._node.getMatrix(),this._startPos[0],this._startPos[1],this._startPos[2])},update:function(t,e){if(!this._finished){var i=e.getFrameStamp().getSimulationTime();if(this._started<0)return this._started+=e.getFrameStamp().getDeltaTime(),!0;this._hasStarted||(this._started=i,this._hasStarted=!0);var r=(i-this._started)/this._duration;return r>1&&(this._reverse?t.setNodeMask(0):t.setNodeMask(a.NO_SHADOW),this._finished=!0,r=1),this._easingFunc&&(r=this._easingFunc(r)),this.interpolate(r,t),!0}},interpolate:function(t,e){m.Vec3.lerp(t,this._startPos,this._targetPos,this._result),m.Matrix.setTrans(e.getMatrix(),this._result[0],this._result[1],this._result[2]),e._uAlpha.getInternalArray()[0]=this._reverse?1-t:t}};var j=function(t,e){this._name=t,this._node=e,this._initialPosition=m.Matrix.getTrans(e.getMatrix(),m.Vec3.create()),this._node.setStateSet(),this._stateset=this._node.getOrCreateStateSet(),this._uColor=m.Uniform.createFloat4(m.Vec4.createAndSet(.1,.1,.1,1),"uColor"),this._name&&this._node||m.warn("something goes wrong with an Item "+this._name)},H=function(t){m.NodeVisitor.call(this,m.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._items=[],this._nonItemsGeoms=[],this._itemsByName={},this._menuGroups=[],this._annotationGroup=void 0,this._isMobile=t,this._startVisiting=!1,this._isInteractiveChildren=!0};H.prototype=m.objectInherit(m.NodeVisitor.prototype,{apply:function(t){if(this._startVisiting){if(t.getTypeID()===m.Geometry.typeID)t.setStateSet(),t.getTypeID()!==m.Geometry.typeID||this._isInteractiveChildren&&-1===t.getName().indexOf(S)||this._nonItemsGeoms.push(t);else if(t.getTypeID()===m.MatrixTransform.typeID){var e=t.getName();if(e&&-1!==e.indexOf(y)){this._isInteractiveChildren=!0,this.traverse(t),this._isInteractiveChildren=!1;var i=new j(e,t);return this._items.push(i),void(this._itemsByName[e]=i)}if(e&&-1!==e.indexOf(C)){var r=new j(e,t);this._menuGroups.push(r),this._itemsByName[e]=r,-1!==e.toLowerCase().indexOf("annotation")&&(this._annotationGroup=r)}}}else{if(t.getName()===x)return this._isMobile?void t.setNodeMask(0):(this._startVisiting=!0,this.traverse(t),void(this._startVisiting=!1));if(t.getName()===A)return this._isMobile?(this._startVisiting=!0,this.traverse(t),void(this._startVisiting=!1)):void t.setNodeMask(0);t.getTypeID()===m.Geometry.typeID&&this._nonItemsGeoms.push(t)}this.traverse(t)}});var W=function(t,e){m.MatrixTransform.call(this),this.setName("WebVR - Menu"),this._visible=!1,this._helpVisible=!1,this._hoveredItem=void 0,this._previousHoveredItem=void 0,this._manipulator=t,this._webvr=e,this._shaderPrograms={},this._hasModelAnnotations=!1};W.prototype=m.objectInherit(m.MatrixTransform.prototype,{initMeshMenu:function(){o.getBaseVR(this.replaceMeshMenu.bind(this))},setVisible:function(t){t&&this.setNodeMask(a.NO_SHADOW),this.launchUpdateCallbacks(!t),this._visible=t,t||this.hoverItem(void 0)},createTextElement:function(t){var e=new b.Text(t);e.setCharacterSize(2.9),e.setFontResolution(80),e.setPosition(e.getPosition()),m.Vec4.set(1,1,1,1,e.getColor()),e.setColor(e.getColor()),e.setFont("Open Sans"),e.drawText();var i=e._geometry.getOrCreateStateSet();return i.setAttributeAndModes(this.getOrCreateShader("caption","VRMenuCaption",d,c)),i.addUniform(m.Uniform.createInt(0,"uTextureCaption")),i.setTextureAttributeAndModes(0,g.dummyTexture),i.setRenderBinDetails(s.TRANSPARENT_BIN_NO_EARLYZ_POST,"RenderBin"),e._geometry.setStateSet(i),e._dirty=!1,e},replaceMeshMenu:function(t){v.parseSceneGraph(t.MENU).then(function(t){var e=this.getOrCreateShader("text","VRMenuText",d,l);this._nodeModelOsgjs=t;var i=t.getOrCreateStateSet();i.setAttributeAndModes(e),i.addUniform(m.Uniform.createFloat4(m.Vec4.createAndSet(1,1,1,1),"uColor")),i.addUniform(m.Uniform.createFloat1(1,"uAlpha"));var r=new H(!1);r.apply(t),this._items=r._items,this._itemsByName=r._itemsByName,this._nonItemsGeoms=r._nonItemsGeoms,this._menuGroups=r._menuGroups,this._annotationNode=r._annotationGroup;var n,a;for(n=0,a=this._items.length;a>n;n++)this.initShading(this._items[n]);for(n=0,a=this._nonItemsGeoms.length;a>n;n++)this.initBasicShading(this._nonItemsGeoms[n]);for(n=0,a=this._menuGroups.length;a>n;n++){var s=this._menuGroups[n]._node;s._uAlpha=m.Uniform.createFloat1(1,"uAlpha");var o=s.getOrCreateStateSet();o.setAttributeAndModes(e),o.addUniform(this._menuGroups[n]._node._uAlpha);var u=m.Matrix.getTrans(s.getMatrix(),m.Vec3.create()),h=m.Vec3.copy(u,m.Vec3.create());u[2]+=D;var c=new z(u,h,P,B,s);s.addUpdateCallback(c)}!this._hasModelAnnotations&&this._annotationNode&&this._annotationNode._node.setNodeMask(0),this.addChild(t)}.bind(this)),this._textMT=new m.MatrixTransform,m.Matrix.setTrans(this._textMT.getMatrix(),0,7.5,.25),this._prevAnnotationCaption=this.createTextElement("Previous Annotation"),this._prevAnnotationCaption.setNodeMask(0),this._textMT.addChild(this._prevAnnotationCaption),this._nextAnnotationCaption=this.createTextElement("Next Annotation"),this._nextAnnotationCaption.setNodeMask(0),this._textMT.addChild(this._nextAnnotationCaption),this.addChild(this._textMT),this.getOrCreateStateSet().setRenderBinDetails(s.TRANSPARENT_BIN_NO_EARLYZ_POST,"RenderBin"),this.setNodeMask(0)},getOrCreateShader:function(t,e,i,r){if(this._shaderPrograms[t])return this._shaderPrograms[t];var a="#define SHADER_NAME "+e+"\n",s=n(),o={};o["webVR-menu-"+t+"-vert"]=a+i,o["webVR-menu-"+t+"-frag"]=a+r,s.addShaders(o);var u=new m.Program(new m.Shader(m.Shader.VERTEX_SHADER,s.getShader("webVR-menu-"+t+"-vert")),new m.Shader(m.Shader.FRAGMENT_SHADER,s.getShader("webVR-menu-"+t+"-frag")));return this._shaderPrograms[t]=u,u},initBasicShading:function(t){var e=t.getOrCreateStateSet();t.setNodeMask(a.NO_PICK_NO_SHADOW),e.removeAttribute("Material")},initShading:function(t){var e=t._stateset;if(e.addUniform(t._uColor),t._name===T){e.setAttributeAndModes(this.getOrCreateShader("help","VRMenuHelp",d,p)),e.addUniform(m.Uniform.createInt(0,"uTextureHelp")),e.setTextureAttributeAndModes(0,g.dummyTexture),e.setRenderBinDetails(s.TRANSPARENT_BIN_NO_EARLYZ,"RenderBin"),t._node._uAlpha=m.Uniform.createFloat1(1,"uAlpha"),e.addUniform(t._node._uAlpha),o.getBaseVR(this.replaceTextureHelp.bind(this));var i=m.Matrix.getTrans(t._node.getMatrix(),m.Vec3.create());t._node.addUpdateCallback(new z(i,i,.4,_.easeOutCubic,t._node)),t._node.setNodeMask(0),this.setHelpVisible(!1)}},replaceTextureHelp:function(t){var e=this._itemsByName[T]._node.getOrCreateStateSet();e.setTextureAttributeAndModes(0,f.instance.getOrCreateTexture(t.MENU_HELP).texture)},isVisible:function(){return this._visible},toggleHelpVisible:function(){this.setHelpVisible(!this._helpVisible)},checkModelAnnotations:function(t){this._hasModelAnnotations=t.hotspot._views[0]._hotspots.length&&!1},setHelpVisible:function(t){var e=this._itemsByName[T];e&&(this._helpVisible=t,t?(e._node.setNodeMask(a.NO_SHADOW),e._node.getUpdateCallback()._reverse=!1,e._node.getUpdateCallback().start(0)):(e._node.getUpdateCallback()._reverse=!0,e._node.getUpdateCallback().start(0)))},setHoveredVisual:function(t,e){m.Vec4.copy(e?O:V,t._uColor.getInternalArray())},hoverItem:function(t){return t?void(t!==this._hoveredItem&&t._name!==T&&(this._hoveredItem&&this.setHoveredVisual(this._hoveredItem,!1),this._prevAnnotationCaption.setNodeMask(t._name===k?a.NO_SHADOW:0),this._nextAnnotationCaption.setNodeMask(t._name===I?a.NO_SHADOW:0),this._hoveredItem=t,this.setHoveredVisual(t,!0))):void(this._hoveredItem&&(this.setHoveredVisual(this._hoveredItem,!1),this._hoveredItem=void 0,this._prevAnnotationCaption.setNodeMask(0),this._nextAnnotationCaption.setNodeMask(0)))},activateItem:function(t,e,i){var r;if(t)for(var n=t.nodepath.length;n-- >0&&!(r=this._itemsByName[t.nodepath[n].getName()]););if(r)if(e){switch(r._name){case w:if(u().isApp){var a=G.createMessage({data:"exit"});a.appendToHash()}else this._webvr.set("enable",!1);break;case k:break;case I:break;case E:this.setVisible(!1);break;case M:case T:this.toggleHelpVisible()}this.hoverItem(void 0,i)}else this.hoverItem(r,i);else this.hoverItem(void 0,i);return!0},updateTargetMatrix:function(){var t=m.Quat.create(),e=m.Vec3.create(),i=m.Vec3.create(),r=m.Vec3.create(),n=m.Matrix.makeRotate(.5*Math.PI,1,0,0,m.Matrix.create());return function(a,s){var o=m.Matrix.create();m.Matrix.inverse(a.getViewMatrix(),o);var u=m.Quat.copy(this._manipulator.getCurrentManipulator()._vrRot,t);u[0]=u[1]=0,m.Quat.normalize(u,u);var h=m.Matrix.makeRotateFromQuat(u,this.getMatrix());m.Matrix.mult(h,n,h);var l=N*s;m.Matrix.preMultScale(h,m.Vec3.set(l,l,l,i)),this._manipulator.getEyePosition(e),this._manipulator.getTarget(i),m.Vec3.sub(i,e,r),r[2]=0,m.Vec3.normalize(r,r),m.Vec3.mult(r,R*s,r),m.Vec3.add(e,r,r),m.Matrix.setTrans(h,r[0],r[1],e[2]+F*s),this.dirtyBound()}}(),launchUpdateCallbacks:function(){var t,e=m.Vec3.create(),i=m.Vec3.create();return function(r){for(var n=0,s=this._menuGroups.length;s>n;n++){var o=U.indexOf(this._menuGroups[n]._name);r&&(o=Math.abs(o-3)),(this._hasModelAnnotations||-1===this._menuGroups[n]._name.toLowerCase().indexOf("annotation"))&&(t=this._menuGroups[n]._node.getUpdateCallback(),t._reverse!==r&&t.reverse(),(0===o&&!r||r&&3===o)&&(e=i),this._menuGroups[n]._node.setNodeMask(a.NO_PICK_NO_SHADOW),t.start(o))}}}(),updateNodeVR:function(t,e,i,r,n,a){if(!this._items)return!1;if(!this.isVisible())return i?(this.updateTargetMatrix(r,a),this.setVisible(!0),!0):!1;if(i||e&&!t){if(!this._helpVisible)return this.setVisible(!1),!1;this.setHelpVisible(!1)}return this.activateItem(t,e,n),!this._helpVisible&&this._itemsByName[T]._node.getUpdateCallback().isFinished()&&this._itemsByName[T]._node.setNodeMask(0),!0}}),t.exports=W},function(t,e){t.exports='varying vec2 vTexCoord0;\n\nuniform float uRGBMRange;\nuniform vec4 uColor;\nuniform int uOutputLinear;\nuniform float uAlpha;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n    vec4 color = sRGBToLinear(uColor.rgba);\n    color.a *= uAlpha;\n    color.rgb *= color.a;\n\n    gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(t,e){t.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureCaption;\nuniform int uOutputLinear;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n    vec4 texcolor = texture2D(uTextureCaption, vTexCoord0);\n    texcolor.a = texcolor.r;\n    texcolor.rgb *= texcolor.a;\n\n    gl_FragColor = uOutputLinear == 0 ? linearTosRGB(texcolor) : texcolor;\n}\n'},function(t,e){t.exports="attribute vec3 Vertex;\nattribute vec2 TexCoord0;\n\nuniform mat4 ModelViewMatrix;\nuniform mat4 ProjectionMatrix;\nvarying vec2 vTexCoord0;\n\nvoid main(void) { \n  vTexCoord0 = TexCoord0;\n  gl_Position = ProjectionMatrix * (ModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(t,e){t.exports='varying vec2 vTexCoord0;\nuniform sampler2D uTextureHelp;\nuniform int uOutputLinear;\nuniform float uAlpha;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n    vec4 color = texture2D(uTextureHelp, vTexCoord0);\n    color.a *= uAlpha;\n    color.rgb *= color.a;\n\n    gl_FragColor = uOutputLinear == 0 ? color : sRGBToLinear(color);\n}\n'},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var r=i(1097),n=i(1683),a={FeatureName:"saveUI",ModelName:"Material",ViewListType:[n]};t.exports=r.create(a)},function(t,e,i){"use strict";var r=i(236),n=i(224),a=i(219),s=i(1100),o=i(1345),u=i(258),h=i(267),l=i(1530),c=i(301),d=s.osg;t.exports=u.extend({savingEnabled:!1,initialize:function(){u.prototype.initialize.apply(this,arguments),n(".save-model").click(this.onSave.bind(this));var t=this.options.context.getModel();t&&!this.maintenance&&this.listenTo(t,"status:loaded",this.enableSaving.bind(this))},onSave:function(t){t.preventDefault(),c.isMaintenance()?c.showPopup():this.save()},save:function(){if(!this.savingEnabled)return r.reject();if(n(".save-model").hasClass("progress"))return r.reject();n(".save-model").addClass("progress");var t=this.options.context.getModel().get("uid"),e=this.options.context.getModel().get("user").uid,i={modelUID:t,userUID:e},a=this,s=[];return r.settle([this.saveBackgroundImages(i,s),this.saveMaterialImages(i,s),this.saveTexturesColorspace(i,s),this.saveHotspots(i,s),this.saveAnimations(i,s)]).then(function(){return s.length>0?r.reject():a.saveOptions()}).then(function(){return s.length>0?r.reject():r.settle([a.deleteTextures(s),a.deleteBackgroundImages(s),a.deleteAnimations(s),a.deleteEnvironments(s)])}).then(function(){return s.length>0?r.reject():(n(".save-model").removeClass("progress"),n(".save-model").addClass("success"),void setTimeout(function(){n(".save-model").removeClass("success")},4e3))})["catch"](function(t){if(n(".save-model").removeClass("progress"),503===event.target.status)c.showPopup();else{var e="";if(s.length)e=s.join("<br/>");else{if(e="An unexpected error happened while saving the following settings : <br/><ul>",t&&t.responseJSON&&t.responseJSON.detail){var i=t.responseJSON.detail;d.error(i);for(var r="string"==typeof i?[i]:Object.keys(i),a=0;a<r.length;++a)e+="<li>&bullet; "+r[a]+"</li>"}e+="</ul>"}e+="<br/>Please contact the support team at support@sketchfab.com.";var o=new h({title:"Error",text:e,buttons:{ok:!0},safe:!0});o.open().then(o.close.bind(o))}})},deleteUnusedResources:function(t,e,i){if(0===t.length)return r.resolve();var n="Errors while deleting the following "+e+" :<br/><ul>",s=!1,o=a.map(t,function(t){return r.resolve(t.destroy())["catch"](function(e){var i=e&&e.responseJSON&&e.responseJSON.detail;n+="<li>&bullet; "+t.get("name")+" : "+i+"</li>",t.trigger("restore",t),s=!0})});return t.length=0,r.all(o).then(function(){return s?(i.push(n+"</ul>"),r.reject()):void 0})},deleteTextures:function(t){var e=this.options.context.getViewer().getFeatures().material.getModel()._deletedTextures||[],i=a.map(e,function(t){return new o({uid:t})});return e.length=0,this.deleteUnusedResources(i,"material textures",t)},deleteAnimations:function(t){return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().animation.getModel().get("animations")._trashbin,"animations",t)},deleteEnvironments:function(t){return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().environment.getModel()._trashbin,"environments",t)},deleteBackgroundImages:function(t){return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().background.getModel()._trashbin,"backgrounds",t)},saveBackgroundImages:function(t,e){var i=this,n=[],a=this.options.context.getViewer().getFeatures().background;return a.getModel().backgroundCollection.each(function(r){if(r.isNew()){var a=i.saveImage(r,t);a&&(a["catch"](function(t){var i=0;if(t.responseJSON.detail.imageFile)for(i=0;i<t.responseJSON.detail.imageFile.length;i++)t.responseJSON.detail.imageFile[i].match("The image should be less than 4mb")&&e.push("Background image is too big (max: 4MB)")}),n.push(a))}}),r.all(n)},saveImage:function(t,e){return r.resolve(t.save(e).then(function(e){t.set("uid",e.uid)}))},_saveImageToBlob:function(t,e,i,r){var n,a=t.getImage(),s=t.getTextureProxy().getImage().getImage();if(s.toBlob){var o=this;return void s.toBlob(function(t){t.name=e.name,a.set("imageFile",t),i(o.saveImage(a,r))},e.type,.95)}if(s.toDataURL)n=l(s.toDataURL(e.type,.95)),n.name=e.name,a.set("imageFile",n),i(this.saveImage(a,r));else{var u=s;s=document.createElement("canvas"),s.width=u.width,s.height=u.height,s.getContext("2d").drawImage(u,0,0)}n=l(s.toDataURL(e.type,.95)),n.name=e.name,a.set("imageFile",n),i(this.saveImage(a,r))},saveMaterialImages:function(t,e){var i=this,n=[],s={},o=this.options.context.getViewer().getFeatures().material,u="Errors while saving the following texture materials :<br/><ul>",h=!1;return a.each(o.getModel().attributes,function(e){var o=e.getChannels();a.each(o,function(e){var a=e.getTexture();if(a){var o=a.getImage();if(o&&o.isNew()){var l=o.getUID();if(1!==s[l]){s[l]=1;var c=new r(function(e){var r=o.get("imageFile");if(0===r.size)i._saveImageToBlob(a,r,e,t);else if(window.File){var n=new FileReader;n.onload=function(){this.readyState===FileReader.DONE?e(i.saveImage(o,t)):i._saveImageToBlob(a,r,e,t)},n.onerror=function(){i._saveImageToBlob(a,r,e,t)},n.readAsArrayBuffer(r)}});n.push(c["catch"](function(t){var e=t&&t.responseJSON&&t.responseJSON.detail;u+="<li>&bullet; "+o.getName()+" : "+e+"</li>",h=!0}))}}}})}),r.all(n).then(function(){return h?(e.push(u+"</ul>"),r.reject()):void 0})},saveOptions:function(){var t=this.options.context,e=t.getViewer(),i=e.getOptionsJSON();if(e.getFeaturesManager().registerOptionsJSON(i),i.animation)for(var n=e.getFeatures().animation.getModel().get("animations")._trashbin,a=0;a<n.length;a++)n[a]&&i.animation.order.splice(a,0,n[a].get("uid"));return r.resolve(t.getModel().save({options:i},{patch:!0}))},saveHotspot:function(t,e,i){return t.save(e)["catch"](function(e){if(i.push("Annotation #"+(+t.get("order")+1)+" could not be saved."),e.responseJSON&&e.responseJSON.detail){var r=0;if(e.responseJSON.detail.name)for(r=0;r<e.responseJSON.detail.name.length;r++)e.responseJSON.detail.name[r].match("This field is required.")&&i.push("Title is required."),e.responseJSON.detail.name[r].match("Ensure this value has at most 64 characters")&&i.push("Title is too long (64 characters max).");if(e.responseJSON.detail.content)for(r=0;r<e.responseJSON.detail.content.length;r++)e.responseJSON.detail.content[r].match("Ensure this value has at most 256 characters")&&i.push("Description is too long (256 characters max).")}})},deleteHotspot:function(t,e,i,r){return t.remove(e)["catch"](function(){r.push(t),i.push("An annotation cound not be deleted. Please try saving your settings again.")})},saveHotspots:function(t,e){var i=this.options.context.getViewer().getFeatures().hotspot,s=i.getModel(),o=s.get("hotspots"),u=[],h=[],l=this;return a.each(s.hotspotsToBeDeleted,function(i){u.push(l.deleteHotspot(i,t,e,h))}),s.hotspotsToBeDeleted=h,r.all(u).then(function(){var i=[];return o.each(function(r){r.set("order",o.indexOf(r)),i.push(l.saveHotspot(r,t,e))}),r.all(i)}).then(function(){var t=new FormData,e=!1;return o.each(function(i){var r=i.get("uid");r&&(e=!0,t.append(r,i.get("order")))}),e===!1?r.resolve():r.resolve(n.ajax({type:"POST",url:"/i/hotspots/order",data:t,cache:!1,contentType:!1,processData:!1,error:function(t){d.error(t)}}))})},saveTexturesColorspace:function(t,e){var i="Errors while changing the following texture colorspace :<br/><ul>",n=!1,a=[];return this.model.imageCollection.each(function(t){!t.isNew()&&t.hasChanged("colorSpace")&&a.push(t.saveColorspace()["catch"](function(e){var r=e&&e.responseJSON&&e.responseJSON.detail;i+="<li>&bullet; "+t.get("name")+" : "+r+"</li>",n=!0}))}),r.all(a).then(function(){return n?(e.push(i+"</ul>"),r.reject()):void 0})},saveAnimations:function(t,e){var i=this.options.context.getViewer().getFeatures().animation,n=i.getModel(),a="Errors while saving the following animations :<br/><ul>",s=!1,o=n.get("animations").map(function(e){return e.save(t)["catch"](function(t){var i=t&&t.responseJSON&&t.responseJSON.detail;a+="<li>&bullet; "+e.get("name")+" : "+i+"</li>",s=!0})});return r.all(o).then(function(){return s?(e.push(a+"</ul>"),r.reject()):void 0})},enableSaving:function(){this.savingEnabled=!0,n(".save-model").removeClass("btn-disabled")}})},,,,,,,,,function(t,e,i){"use strict";var r=i(219),n=i(224),a=i(284);i(275);var s=i(258),o=i(255),u=i(352),h=i(1093),l=i(225),c=i(242),d=i(1693),p=i(310),f=i(1695),g=i(1697),m=i(1698),v=i(1699),_=i(1702),b=i(1703),x=i(1705),A=i(1707),y=i(1706),S=i(1708),C=i(1709),w=i(1361),T=i(1357),M=i(1710),E=i(1399),k=i(1341),I=i(1459),N=i(218),R=N.shortcuts;i(418);var F=3500;t.exports=s.extend({subviews:{},events:{'click [data-action="start"]':"onStart",'click [data-action="stop"]':"onStop",click:"globalCloseEvent",touchend:"globalCloseEvent"},templates:{viewerMode:c.getFromMacro("skfb_front/macros/viewer","help_viewer_mode"),viewerVr:c.getFromMacro("skfb_front/macros/viewer","help_vr_mode")},initialize:function(){s.prototype.initialize.apply(this,arguments),this.proxySettings=new p({shadingStyle:null,viewerMode:null,wireframeColor:null,wireframeEnable:null,hasWireframe:null,annotationsVisible:null,textureQuality:null,speed:null,cycleMode:null,fps:null}),this.initializeMandatorySubviews(),this.initializeShortcuts(),this.delegateGlobalMoveEvent(),this.delegateSubviews(),this.isVR()&&a.apple.device&&this.hackIosCanvasRender()},_createSubview:function(t,e,i){return this.subviews[t]=new e(r.extend({},{viewer:this,widgets:this.subviews},i)),this.subviews[t]},globalCloseEvent:function(t){n(t.target).hasClass("has-menu")||n(t.target).parents(".has-menu").length||(this.subviews.hotspots&&this.subviews.hotspots.toggleAnnotationList(null,!1),this.subviews.gui.closeMenus())},delegateGlobalMoveEvent:function(){var t=function(t){"canvas"===t.target.tagName.toLowerCase()&&(clearTimeout(this._showGuiTimeout),clearTimeout(this._hideGuiTimeout),this._hideGuiTimeout=setTimeout(function(){this.$el.addClass("moving")}.bind(this),150))},e=function(t){"canvas"===t.target.tagName.toLowerCase()&&(clearTimeout(this._hideGuiTimeout),clearTimeout(this._showGuiTimeout),t.preventDefault(),this._showGuiTimeout=setTimeout(function(){this.$el.hasClass("moving")&&this.$el.removeClass("moving")}.bind(this),500))},i=function(t){var e=t.relatedTarget||t.toElement;a.any||(clearTimeout(this.globalIdleTimeout),e||(this.globalIdleTimeout=setTimeout(this.onGlobalIdleTimeout.bind(this),F)))},s=function(){clearTimeout(this.globalIdleTimeout),(this.$el.hasClass("idle")||this.$el.hasClass("moving"))&&(this.$el.removeClass("idle moving"),r.each(this.subviews,function(t){t.trigger("idle",!1)}))};if(!h()){var o;this.$el.on("touchmove",this.preventScroll.bind(this)),this.$el.on("mousedown touchstart",t.bind(this)),this.$el.on("mouseup touchend",e.bind(this)),this.$el.on("mousewheel",function(t){"canvas"===t.target.tagName.toLowerCase()&&(this.$el.addClass("moving"),clearTimeout(o),o=setTimeout(function(){this.$el.removeClass("moving")}.bind(this),300))}.bind(this)),n(document).on("mouseout",i.bind(this)),n(document).on("mouseenter mousein",s.bind(this))}},preventScroll:function(t){this.subviews&&this.subviews.helpOverlay&&!this.subviews.helpOverlay.isVisible()&&t.preventDefault()},onGlobalIdleTimeout:function(){h()||(this.$el.addClass("idle"),r.each(this.subviews,function(t){t.trigger("idle",!0)}))},initializeMandatorySubviews:function(){this._createSubview("gui",f,{el:this.$el}),this._createSubview("loading",g,{el:this.$(".loading-container")}),this._createSubview("hint",m,{el:this.$el,fallback:!u()}),this._createSubview("generalControls",v,{el:this.$(".general-controls"),fallback:!u()}),this._createSubview("header",_,{el:this.$(".titlebar")}),this._createSubview("snapshot",b,{el:this.$el}),this._createSubview("helpOverlay",x,{el:this.$(".help.overlay")}),this._createSubview("hotspotsOverlay",A,{el:this.$(".hotspots-overlay")}),this._createSubview("helperVrOverlay",y.extend({setUrl:function(t){this.$(".url").attr("href",t).text(t)}}),{el:this.$(".helper-vr-overlay")}),this._createSubview("osd",S,{el:this.$el})},initializeShortcuts:function(){this.viewerRenderingShortcuts=new d(R.viewerRendering),this.viewerRenderingShortcuts.on("defaultRenderingMode",function(){this.proxySettings.set("shadingStyle","lit")}.bind(this)),this.viewerRenderingShortcuts.on("shadelessRenderingMode",function(){this.proxySettings.set("shadingStyle","shadeless")}.bind(this)),this.viewerRenderingShortcuts.on("matcapRenderingMode",function(){this.proxySettings.set("shadingStyle","matcap")}.bind(this)),this.viewerRenderingShortcuts.on("demoRenderingMode",function(){this.proxySettings.set("shadingStyle","blending")}.bind(this)),this.viewerRenderingShortcuts.on("toggleWireframe",function(){this.proxySettings.set("wireframeEnable",!this.proxySettings.get("wireframeEnable"))}.bind(this)),this.viewerRenderingShortcuts.listen()},initializeHotspotsSubviews:function(t){i.e(17,function(){var e=i(1713);this._createSubview("hotspots",e,{el:this.$el,container:this.$(".hotspots"),fallback:!u()}),"function"==typeof t&&t()}.bind(this))},initializeAnimationSubviews:function(t){i.e(18,function(){var e=i(1716),r=this.scene.getFeatures().animation.getModel();this._createSubview("animationControls",e,{el:this.$(".animation-controls"),model:r,currentModel:this._currentModel}),"function"==typeof t&&t()}.bind(this))},delegateSubviews:function(){this.isCardboard()?(this.subviews.gui.disable(),this.subviews.header.disable()):(this.subviews.loading.on("loaded",setTimeout.bind(window,this.subviews.gui.enable.bind(this.subviews.gui),500)),this.subviews.header.enable()),this.subviews.loading.on("loaded",function(){var t=k().transparent;t||this.$el.addClass("transparent-pattern")}.bind(this))},onStart:function(){this.start(),this._startTracked||(this._startTracked=!0)},start:function(){return this.$el.addClass("started"),o.modelEmbedPlayButtonClicked(this._currentUid),this.$el.hasClass("transparent")||this.$el.addClass("transparent-pattern"),this._options&&this.load(),this.scene&&this.scene.getViewerOSGJS&&this.scene.getViewerOSGJS().done()&&(this.scene.getViewerOSGJS().setDone(!1),this.scene.getViewerOSGJS().run()),this.trigger("started"),this},onStop:function(){this.stop()},stop:function(){var t=this._currentModel?this._currentModel.get("uid"):this._currentUid;return o.modelEmbedStopButtonClicked(t),this.$el.removeClass("started"),this.scene.getViewerOSGJS&&this.scene.getViewerOSGJS().setDone(!0),this.subviews.hotspots&&this.subviews.hotspots.triggerHotspotCycle(!1),this.trigger("started"),this},load:function(){if(this._options){var t=this._options;this._options=null,this.scene&&(this.scene.drop(),this.scene=null),this.subviews.loading.reset(),this.$el.removeClass("model-loaded"),this.$el.addClass("model-loading"),p.get(t.uid).then(this.onModelLoad.bind(this,t))}},lookat:function(t,e,i){void 0===i&&(i=1);var r=this.scene.getFeatures(),n=r.cameraAnimation.getModel();n.set("duration",i),n.setTargetAndEye(e,t)},hasVR:function(){return!!navigator.getVRDisplays},isVR:function(){return this.scene?this.scene.getFeatures().webVR.getModel().get("enable"):k().cardboard>0},isCardboard:function(){return k().cardboard>0},onModelLoad:function(t,e){this._currentModel=e,e.hit();var i=this.scene=this.createScene(e,t);this.subviews.loading.handleLoading({model:e,scene:i}),i.run(e),this.initViewerFeatures();var r=this.scene.getFeatures();this._createSubview("unsupportedAnimation",C,{el:this.$(".animation-not-supported"),model:r.animation.getModel()}),w.getPromise().then(function(){if(k().annotation>0){var t=this.getHotspotModel().get("hotspots");t.trigger("select",t.at(k().annotation-1))}k().annotationCycleAutostart===!0&&(this.subviews.hotspots.trackHotspotCycle(!0),this.subviews.hotspots.triggerHotspotCycle(!0))}.bind(this)),this.subviews.hint.show(),this.trigger("model-loaded")},setScene:function(t){if(this.scene)throw new Error("It is currently impossible to reset a scene");return this._options=t,this._currentUid=t.uid,this},createScene:function(t,e){if(u()){var i={};i.el=this.$(".webgl"),i.features=e.features,i.widgetAPI=e.widgetAPI;var r=new E(i);return r.getPromisePolygon().then(function(t){o.modelViewerPolygonLoaded(t.time)}),r.getPromiseWireframe().then(function(t){o.modelViewerWireframeLoaded(t.time)}),r.getPromiseLowResLoaded().then(function(t){o.modelViewerLowResTexturesLoaded(t.time,t.count)}),r.getPromiseHighResLoaded().then(function(t){o.modelViewerHighResTexturesLoaded(t.time,t.count)}),r.getPromiseModelDisplayed().then(function(t){o.modelViewerModelDisplayed(t.time)}),r}return o.modelViewerFallbackDisplayed(t.get("uid")),new M({model:t,el:this.$(".fallback"),features:e.features})},initViewerFeatures:function(){T.getPromise().then(function(t){t&&this.initializeAnimation()}.bind(this)),this.initializeHotspots(),this.initializeShadingStyle(),this.initializeViewerMode(),this.initializeTextureQuality(),this.initializeVr()},getHotspotModel:function(){var t=this.scene.getFeatures().hotspot;return t&&t.getModel()},initializeHotspots:function(){var t=this.getHotspotModel();t&&!this.isVR()&&this.initializeHotspotsSubviews(function(){var e=this.subviews.hotspots;t.setUpdateCallback(e.refreshHotspots.bind(e));var i=t.get("hotspots");i.on("add remove sort change:title change:description change:position",e.refreshHotspots,e),i.on("add remove sort change:name",e.updateHotspotsControls,e),i.on("add remove",r.debounce(this.subviews.generalControls.renderSettings,100),this.subviews.generalControls),i.on("select",e.onHotspotSelected,e),this.proxySettings.on("change:annotationsVisible",function(){this.proxySettings.get("annotationsVisible")===!0?e.showAnnotations():e.hideAnnotations()}.bind(this)),this.proxySettings.set("annotationsVisible",k().annotationsVisible),e.updateHotspotsControls()}.bind(this))},initializeAnimation:function(){var t=this.scene.getFeatures().animation,e=t.getModel();this.initializeAnimationSubviews(function(){this.$el.addClass("has-animation"),this.subviews.generalControls.setHasAnimations(!0),this.proxySettings.set("speed",e.get("speed")),this.proxySettings.set("cycleMode",e.get("cycleMode")),this.proxySettings.set("fps",e.get("fps")),this.proxySettings.on("change:speed",function(t,i){e.set("speed",i)}),this.proxySettings.on("change:cycleMode",function(t,i){e.set("cycleMode",i)}),this.proxySettings.on("change:fps",function(t,i){e.set("fps",i)}),e.on("change:fps",function(t,e){this.proxySettings.set("fps",e)}.bind(this)),this.$(".osd").addClass("padded"),this.$(".timeline").removeClass("disabled")}.bind(this))},initializeTextureQuality:function(){var t=this,e=this.scene.getFeatures().quality;if(e){var i=e.getModel();i.on("qualityReady",this.subviews.generalControls.settings.onTextureQualityReady.bind(this.subviews.generalControls.settings)),this.proxySettings.on("change:textureQuality",function(){var e=parseInt(this.get("textureQuality"),10);window.requestAnimationFrame(function(){i.set("level",e)});var r=t.subviews.generalControls.getSettingLabelForValue("textureQuality",e+"");t.$(".control-badge").text(r).addClass("active")})}},initializeViewerMode:function(){var t=this.scene.getFeatures().manipulator;if(t){var e=t.getModel(),i=e.get("indexManipulator");this.proxySettings.set("viewerMode",i),
this.subviews.gui.renderSetting("viewerMode",i),this.proxySettings.on("change:viewerMode",function(){e.set("indexManipulator",parseInt(this.proxySettings.get("viewerMode"),10)),this.scene.getFeaturesManager().focusOnSavedCamera(1),this.$("canvas").focus()}.bind(this))}},initializeShadingStyle:function(){var t=this.scene.getFeatures().shadingStyle;if(t){var e=t.getModel(),i=this,r=function(){i.proxySettings.set("shadingStyle",e.get("style")),i.proxySettings.set("wireframeColor",e.get("wireframeColor")),i.proxySettings.set("wireframeEnable",e.get("wireframeEnable")),i.proxySettings.set("hasWireframe",e.get("hasWireframe")),i.subviews.gui.renderSetting("wireframeColor",i.proxySettings.get("wireframeColor")),i.subviews.gui.renderSetting("wireframeEnable",i.proxySettings.get("wireframeEnable")?1:0),i.subviews.gui.renderSetting("shadingStyle",i.proxySettings.get("shadingStyle")),i.subviews.gui.renderSetting("hasWireframe",i.proxySettings.get("hasWireframe")?1:0)};r(),this.proxySettings.listenTo(e,"change",r),this.proxySettings.on("change:shadingStyle",function(){e.set("style",this.get("shadingStyle"))}),this.proxySettings.on("change:wireframeColor",function(){this.get("wireframeEnable")?e.setWireframeColorSmooth(this.get("wireframeColor")):e.set("wireframeColor",this.get("wireframeColor"))}),this.proxySettings.on("change:wireframeEnable",function(){e.set("wireframeEnable",!!this.get("wireframeEnable"))}),this.listenTo(e,"nextBlendingShader",function(t){var e={};e[I.MATCAP|I.WIREFRAME]="Matcap + Wireframe",e[I.MATCAP|I.GEOMETRY|I.WIREFRAME]="Matcap + Normal + Wireframe",e[I.DEFAULT&~I.DIFFUSE]="No diffuse",e[I.DEFAULT]="Default",this.subviews.osd.show(e[t],{duration:5e3,position:"top",style:"compact"})}.bind(this))}},initializeVr:function(){if(this.isVR()){this.$el.addClass("vr-mode");var t=1===l.get("show_vr_hint",1)?!0:!1;if(t){var e=this.templates.viewerVr([this.subviews.generalControls.hasFullscreen()]);this.subviews.osd.show(e,{duration:8e3})}l.set("show_vr_hint",0,{expires:504e5,path:"/"})}},hackIosCanvasRender:function(){r.defer(function(){n("canvas")[0].style.width=n("canvas")[0].clientWidth+1+"px",r.defer(function(){n("canvas")[0].style.width=n("canvas")[0].clientWidth-1+"px",n("canvas")[0].style.width=""})})}})},function(t,e,i){"use strict";var r=i(219),n=i(224),a=i(235),s=i(1694),o=function(t,e){if(Array.isArray(t))this.shortcuts=t||[];else{if(!r.isObject(t))throw new Error("Shortcut manager needs a shortcut object to function");this.shortcutGroup=t,this.shortcuts=t.shortcuts||[]}this.options=e||{},this.handlers={},this.options=r.defaults({},this.options,{listen:!1}),this.options.listen&&this.listen()},u=new s;u.stopCallback=function(t,e){return(" "+e.className+" ").indexOf(" mousetrap ")>-1?!1:"button"===document.activeElement.tagName.toLowerCase()?!0:"INPUT"===e.tagName||"SELECT"===e.tagName||"TEXTAREA"===e.tagName||e.contentEditable&&"true"===e.contentEditable},r.extend(o.prototype,a.Events),o.prototype.listen=function(t){void 0===t?this.shortcuts.forEach(this._listen.bind(this)):Array.isArray(t)?(this.shortcuts=this.shortcuts.concat(t),t.forEach(this._listen.bind(this))):this._listen(t)},o.prototype.stopListening=function(){r.each(this.handlers,function(t,e){u.unbind(this._getShortcut(t),e),delete this.handlers[t]}.bind(this))},o.prototype.getTitle=function(){return this.shortcutGroup?this.shortcutGroup.name||"":""},o.prototype.getShortDescriptionById=function(t){var e="";return this.shortcuts.forEach(function(i){i.id===t&&(e=this._formatKeyCombination(i.keyCombinations).replace("<br />",""))}.bind(this)),e},o.prototype.generateHelpSection=function(){var t=n("<div />"),e=this.getTitle();return e&&t.append("<h2>"+e+"</h2>"),this.shortcuts.forEach(function(e){e.name&&t.append("<b>"+e.name+"</b>"),t.append(this._formatKeyCombination(e.keyCombinations))}.bind(this)),t.html()||""},o.prototype.hasKeyCombination=function(t){var e=!1;return this.shortcuts.forEach(function(i){e||(Array.isArray(i.shortcuts)?i.shortcuts.forEach(function(i){e=i===t}):e=i.shortcuts===t)}),e},o.prototype._formatKeyCombination=function(t){var e="";return e=Array.isArray(t)?t.join("</kbd> or <kbd>"):t,e="<kbd>"+e+"</kbd><br />"},o.prototype._listen=function(t){this._validate(t)&&!this.handlers[t.id]&&(this.handlers[t.id]=this._notify.bind(this,t),u.bind(t.keyCombinations,this.handlers[t.id]))},o.prototype._getShortcut=function(t){return r.find(this.shortcuts,function(e){return e.id===t})},o.prototype._validate=function(t){return void 0!==t.keyCombinations&&void 0!==t.id},o.prototype._notify=function(t,e){this.trigger(t.id,t,e)},t.exports=o},function(t,e,i){var r;!function(n,a,s){function o(t,e,i){return t.addEventListener?void t.addEventListener(e,i,!1):void t.attachEvent("on"+e,i)}function u(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return A[t.which]?A[t.which]:y[t.which]?y[t.which]:String.fromCharCode(t.which).toLowerCase()}function h(t,e){return t.sort().join(",")===e.sort().join(",")}function l(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}function c(t){return t.preventDefault?void t.preventDefault():void(t.returnValue=!1)}function d(t){return t.stopPropagation?void t.stopPropagation():void(t.cancelBubble=!0)}function p(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function f(){if(!x){x={};for(var t in A)t>95&&112>t||A.hasOwnProperty(t)&&(x[A[t]]=t)}return x}function g(t,e,i){return i||(i=f()[t]?"keydown":"keypress"),"keypress"==i&&e.length&&(i="keydown"),i}function m(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus"),t.split("+"))}function v(t,e){var i,r,n,a=[];for(i=m(t),n=0;n<i.length;++n)r=i[n],C[r]&&(r=C[r]),e&&"keypress"!=e&&S[r]&&(r=S[r],a.push("shift")),p(r)&&a.push(r);return e=g(r,a,e),{key:r,modifiers:a,action:e}}function _(t,e){return null===t||t===a?!1:t===e?!0:_(t.parentNode,e)}function b(t){function e(t){t=t||{};var e,i=!1;for(e in x)t[e]?i=!0:x[e]=0;i||(S=!1)}function i(t,e,i,r,n,a){var s,o,u=[],l=i.type;if(!m._callbacks[t])return[];for("keyup"==l&&p(t)&&(e=[t]),s=0;s<m._callbacks[t].length;++s)if(o=m._callbacks[t][s],(r||!o.seq||x[o.seq]==o.level)&&l==o.action&&("keypress"==l&&!i.metaKey&&!i.ctrlKey||h(e,o.modifiers))){var c=!r&&o.combo==n,d=r&&o.seq==r&&o.level==a;(c||d)&&m._callbacks[t].splice(s,1),u.push(o)}return u}function r(t,e,i,r){m.stopCallback(e,e.target||e.srcElement,i,r)||t(e,i)===!1&&(c(e),d(e))}function n(t){"number"!=typeof t.which&&(t.which=t.keyCode);var e=u(t);if(e)return"keyup"==t.type&&A===e?void(A=!1):void m.handleKey(e,l(t),t)}function s(){clearTimeout(_),_=setTimeout(e,1e3)}function f(t,i,n,a){function o(e){return function(){S=e,++x[t],s()}}function h(i){r(n,i,t),"keyup"!==a&&(A=u(i)),setTimeout(e,10)}x[t]=0;for(var l=0;l<i.length;++l){var c=l+1===i.length,d=c?h:o(a||v(i[l+1]).action);g(i[l],d,a,t,l)}}function g(t,e,r,n,a){m._directMap[t+":"+r]=e,t=t.replace(/\s+/g," ");var s,o=t.split(" ");return o.length>1?void f(t,o,e,r):(s=v(t,r),m._callbacks[s.key]=m._callbacks[s.key]||[],i(s.key,s.modifiers,{type:s.action},n,t,a),void m._callbacks[s.key][n?"unshift":"push"]({callback:e,modifiers:s.modifiers,action:s.action,seq:n,level:a,combo:t}))}var m=this;if(t=t||a,!(m instanceof b))return new b(t);m.target=t,m._callbacks={},m._directMap={};var _,x={},A=!1,y=!1,S=!1;m._handleKey=function(t,n,a){var s,o=i(t,n,a),u={},h=0,l=!1;for(s=0;s<o.length;++s)o[s].seq&&(h=Math.max(h,o[s].level));for(s=0;s<o.length;++s)if(o[s].seq){if(o[s].level!=h)continue;l=!0,u[o[s].seq]=1,r(o[s].callback,a,o[s].combo,o[s].seq)}else l||r(o[s].callback,a,o[s].combo);var c="keypress"==a.type&&y;a.type!=S||p(t)||c||e(u),y=l&&"keydown"==a.type},m._bindMultiple=function(t,e,i){for(var r=0;r<t.length;++r)g(t[r],e,i)},o(t,"keypress",n),o(t,"keydown",n),o(t,"keyup",n)}for(var x,A={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},S={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},C={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},w=1;20>w;++w)A[111+w]="f"+w;for(w=0;9>=w;++w)A[w+96]=w;b.prototype.bind=function(t,e,i){var r=this;return t=t instanceof Array?t:[t],r._bindMultiple.call(r,t,e,i),r},b.prototype.unbind=function(t,e){var i=this;return i.bind.call(i,t,function(){},e)},b.prototype.trigger=function(t,e){var i=this;return i._directMap[t+":"+e]&&i._directMap[t+":"+e]({},t),i},b.prototype.reset=function(){var t=this;return t._callbacks={},t._directMap={},t},b.prototype.stopCallback=function(t,e){var i=this;return(" "+e.className+" ").indexOf(" mousetrap ")>-1?!1:_(e,i.target)?!1:"INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable},b.prototype.handleKey=function(){var t=this;return t._handleKey.apply(t,arguments)},b.init=function(){var t=b(a);for(var e in t)"_"!==e.charAt(0)&&(b[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},b.init(),n.Mousetrap=b,"undefined"!=typeof t&&t.exports&&(t.exports=b),r=function(){return b}.call(e,i,e,t),!(r!==s&&(t.exports=r))}(window,document)},function(t,e,i){"use strict";var r=i(224),n=i(1696),a=i(255);t.exports=n.extend({VIEWER_MODE_ORBIT:0,VIEWER_MODE_FPS:1,HOTSPOT_CYCLE_PAUSE:1e4,events:{"click .has-menu":"toggleMenu","touchstart .has-menu":"toggleMenuTouch",keydown:"onKeydown",mousewheel:"onMousewheel","mousedown  .webgl .canvas":"cameraMoveStart","touchstart .webgl .canvas":"cameraMoveStart","mousedown  .webgl":"mouseDownEvent","mouseup    .webgl":"mouseUpEvent","touchstart .webgl":"mouseDownEvent","touchend   .webgl":"mouseUpEvent","mousedown  .fallback":"mouseDownEvent","touchstart .fallback":"mouseDownEvent","click      .watermark":"onWatermarkClick","touchend   .watermark":"onWatermarkClick"},constructor:function(){this.globalCloseEvent=this.globalCloseEvent.bind(this),this.globalMouseUpEvent=this.globalMouseUpEvent.bind(this),this.onKeydown=this.onKeydown.bind(this),n.prototype.constructor.apply(this,arguments)},delegateEvents:function(){n.prototype.delegateEvents.apply(this,arguments);var t=r(document);t.on("keydown",this.onKeydown),t.on("mousedown",this.globalCloseEvent),t.on("mouseup",this.globalMouseUpEvent),t.on("mousewheel.delegateEvents"+this.cid,".annotation",this.preventScroll)},undelegateEvents:function(){n.prototype.undelegateEvents.apply(this,arguments);var t=r(document);t.off("keydown",this.onKeydown),t.off("mousedown",this.globalCloseEvent),t.off("mouseup",this.globalMouseUpEvent),t.off("mousewheel.delegateEvents"+this.cid,".annotation",this.preventScroll)},enable:function(){this.$(".gui").addClass("enabled")},disable:function(){this.$(".gui").removeClass("enabled")},closeMenus:function(){this.$(".gui").find(".has-menu").removeClass("active"),this.viewer.subviews.generalControls&&this.viewer.subviews.generalControls.settings&&this.viewer.subviews.generalControls.settings.togglePane(!1)},cameraMoveStart:function(){this.viewer.$(".webgl").addClass("camera-moving"),this.viewer.subviews.hotspots&&this.viewer.subviews.hotspots.pauseHotspotCycleInterval()},cameraMoveEnd:function(){this.viewer.$(".webgl").removeClass("camera-moving"),this.viewer.subviews.hotspots&&this.viewer.subviews.hotspots._hotspotCycleIntervalPaused&&this.viewer.subviews.hotspots.beginHotspotCycleInterval(this.HOTSPOT_CYCLE_PAUSE)},onMousewheel:function(){var t;if(this.viewer.scene){var e=this.viewer.scene.getFeatures();e.hasOwnProperty("manipulator")&&(t=e.manipulator.getModel().get("indexManipulator"))}if(t===this.VIEWER_MODE_FPS){var i=this.viewer.scene.getViewerOSGJS().getManipulator().getCurrentManipulator()._stepFactor,r=Math.round(i/4*100);this.viewer.subviews.osd.show("Walking speed: "+r,{duration:1e3})}},onKeydown:function(t){var e=document.activeElement,i="",r=["BODY","CANVAS"],n=32,a=27;if(t.which===n&&e&&(i=e.tagName,-1!==r.indexOf(i)&&(this.recenter(),t.preventDefault())),t.which>=96&&t.which<=105&&this.timeline&&this.timeline.setCurrentAnimation(t.which-96),t.which===a){if(this.viewer.subviews.hotspots){if(!this.viewer.subviews.hotspots._hotspots.length)return;this.viewer.subviews.hotspots.currentHotspot=null,this.viewer.subviews.hotspots.applyCurrentHotspot(),this.viewer.subviews.hotspots.unrevealHotspots(),this.viewer.subviews.hotspots.stopHotspotCycleInterval()}this.closeMenus()}},preventParentScroll:function(t,e){var i=r(".hotspot-controls .list"),n=i.height(),a=i.children()[0].scrollHeight,s=i.children()[0].scrollTop;(s===a-n&&0>e||0===s&&e>0)&&t.preventDefault()},preventScroll:function(t){t.preventDefault()},globalMouseUpEvent:function(){this.cameraMoveEnd()},globalCloseEvent:function(t){r(t.target).hasClass("has-menu")||r(t.target).parents(".has-menu").length||this.closeMenus(t)},toggleMenu:function(t){t.preventDefault(),t.stopPropagation();var e=r(t.currentTarget);e.hasClass("active")?t.currentTarget===t.target&&e.attr("data-title",e.attr("title")).removeClass("active"):(this.closeMenus(),e.attr("title",e.attr("data-title")).removeAttr("data-title").addClass("active"))},toggleMenuTouch:function(t){t.preventDefault(),t.stopPropagation(),this.toggleMenu(t)},renderSetting:function(t,e){this.viewer.$('[data-setting="'+t+'"]').removeClass("active"),("wireframeColor"!==t||this.viewer.proxySettings.get("wireframeEnable")!==!1)&&this.viewer.$('[data-setting="'+t+'"][data-value="'+e+'"]').addClass("active")},getPointerPosition:function(t){var e,i=t.originalEvent?t.originalEvent:t,r={};return i.touches&&i.touches.length||i.changedTouches&&i.changedTouches.length?(e=i.touches&&i.touches.length?i.touches:i.changedTouches,e=e[0],r.x=e.pageX,r.y=e.pageY,r.type="Touch"):(r.x=t.pageX,r.y=t.pageY,r.type="Mouse"),r},mouseDownEvent:function(t){this.mouseDownPosition=this.getPointerPosition(t),this.viewer.subviews.hint.hide(),"touchstart"===t.type&&(t.target===t.currentTarget||this.scene&&this.scene.getCanvas&&t.target===this.viewer.scene.getCanvas())&&t.preventDefault()},mouseUpEvent:function(t){if(this.mouseDownPosition){var e=20,i=this.getPointerPosition(t);if(this.viewer.$el.hasClass("started")){if(Math.abs(this.mouseDownPosition.x-i.x)>e||Math.abs(this.mouseDownPosition.y-i.y)>e){var r=this.viewer._currentModel?this.viewer._currentModel.get("uid"):this.viewer._currentUid;a.modelEmbedModelInteraction(r,i.type)}this.mouseDownPosition=null}}},recenter:function(){this.viewer.scene&&this.viewer.scene.getViewerOSGJS().getManipulator().computeHomePosition()},onWatermarkClick:function(){var t=r(".watermark").find("a").attr("href"),e=t.split("models/").pop().split("/")[0];a.modelEmbedWatermarkClicked(e)}})},function(t,e,i){"use strict";var r=i(258);t.exports=r.extend({constructor:function(t){this.viewer=t.viewer,this.widgets=t.widgets,r.prototype.constructor.apply(this,arguments)},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.$el.addClass("disabled")},isEnabled:function(){return this.$el.hasClass("disabled")}})},function(t,e,i){"use strict";var r=i(1100),n=i(1696),a=i(1401),s=i(1341),o=r.osg,fif(r),u=new a({device:"VWR"});t.exports=n.extend({reset:function(){this._primaryProgress=0,this._secondaryProgress=0,this._lowerSecondaryProgress=0,this._actualSecondaryProgress=0},handleLoading:function(t){t.scene.on("primary-progress",function(t){if(this.setPrimaryProgress(t.progress),s().isApp){var e=u.createMessage({data:{progress:t.progress+""}});this.previousMessage&&this.previousMessage.removeFromHash(),e.appendToHash(),this.previousMessage=e}}.bind(this)),t.scene.on("secondary-progress",function(t){this.setSecondaryProgress(t.progress)}.bind(this)),t.scene.on("success",function(){this.viewer.$el.removeClass("model-loading").addClass("model-loaded"),t.model.trigger("status:loaded"),this.trigger("loaded")}.bind(this)),t.scene.on("fail",function(){o.error("Viewer instanciation failed")}.bind(this))},setPrimaryProgress:function(t){var e=Math.min(Math.max(0,t),1);this._primaryProgress=e,this.updateMainProgressBar(this._primaryProgress),1===this._primaryProgress&&(this._lowerSecondaryProgress=this._actualSecondaryProgress,this.setSecondaryProgress(this._secondaryProgress))},setSecondaryProgress:function(t){var e=Math.min(Math.max(0,t),1);this._actualSecondaryProgress=e,this._secondaryProgress=(this._actualSecondaryProgress-this._lowerSecondaryProgress)/(1-this._lowerSecondaryProgress),1===this._lowerSecondaryProgress&&(this._secondaryProgress=1),this.updateSecondaryProgressBar(this._secondaryProgress)},updateMainProgressBar:function(t){var e=1===this._primaryProgress;t=Math.max(t,this._previousPrimaryValue||0),this._previousPrimaryValue=t,this.$(".main-progress").toggleClass("loading",!e),this.$(".main-progress-display").attr("value",t),this.$(".main-progress-percentage").text(Math.floor(100*t)+" %")},updateSecondaryProgressBar:function(t){t=Math.max(t,0),this.$(".secondary-progress-percentage").text(Math.floor(100*t)+" %"),this.$(".secondary-progress-display").css("width",100*t+"%");var e=1===this._primaryProgress,i=1===this._secondaryProgress;this.$(".secondary-progress").toggleClass("visible",e&&!i)}})},function(t,e,i){"use strict";var r=i(219),n=i(1696),a=i(225);t.exports=n.extend({initialize:function(){n.prototype.initialize.apply(this,arguments),this.$hint=this.$(".viewer-hint"),this.options.fallback&&this.$hint.addClass("fallback-position")},show:function(t){t=r.defaults(r.extend({},t),{force:!1});var e=1===a.get("show_viewer_hint",1)?!0:!1;(e||t.force)&&this.$hint.addClass("active")},hide:function(t){t=r.defaults(r.extend({},t),{remember:!0}),this.$hint.removeClass("active"),t.remember&&a.set("show_viewer_hint",0,{expires:15552e6,path:"/"})}})},function(t,e,i){"use strict";var r=i(224),n=i(219),a=i(284),s=i(255),o=i(1693),u=i(1700),h=i(1701),l=i(218),c=l.shortcuts,d=new o(c.viewerRendering),p={shadingStyle:{label:"Rendering",settings:[{label:"Default",value:"lit",shortcut:d.getShortDescriptionById("defaultRenderingMode")},{label:"Shadeless",value:"shadeless",shortcut:d.getShortDescriptionById("shadelessRenderingMode")},{label:"MatCap",value:"matcap",shortcut:d.getShortDescriptionById("matcapRenderingMode")}],paneTemplate:n.template(['    <div class="setting-list-header">','       <a class="back control-menu-back">Back</a>','       <span class="setting-list-header-help">Key</span>',"   </div>",'    <ul class="setting-list" data-setting="<%= name %>">',"        <%= listItems %>","    </ul>",'    <p class="wireframe-title wireframe-setting-group">Wireframe <span class="shortcut" title="Keyboard shortcut">'+d.getShortDescriptionById("toggleWireframe")+"</span></p>",'    <div class="wireframe-colors wireframe-setting-group">','        <a class="colors-none" data-setting="wireframeEnable" data-value="0" title="Off"></a><!--','        --><a class="colors-black" data-setting="wireframeColor" data-value="00000099" title="Black"></a><!--','        --><a class="colors-white" data-setting="wireframeColor" data-value="ffffff99" title="White"></a><!--','        --><a class="colors-red" data-setting="wireframeColor" data-value="ff507f99" title="Red"></a><!--','        --><a class="colors-blue" data-setting="wireframeColor" data-value="4d9cff99" title="Blue"></a><!--','        --><a class="colors-green" data-setting="wireframeColor" data-value="2d9e8499" title="Green"></a><!--','        --><a class="colors-yellow" data-setting="wireframeColor" data-value="ebc71299" title="Yellow"></a>',"    </div>"].join(""))},annotationsVisible:{label:"Annotations",type:"bool",group:"annotation",settings:[{label:"Visible",value:!0},{label:"Hidden",value:!1}]},cycleMode:{label:"Anim. Cycle",group:"animation",settings:[{label:"One",value:"one"},{label:"All",value:"all"},{label:"None",value:"none"}]},speed:{label:"Anim. Speed",group:"animation",settings:[{label:"x0.1",value:"0.1"},{label:"x0.5",value:"0.5"},{label:"x1",value:"1"},{label:"x2",value:"2"}]},viewerMode:{label:"Navigation",settings:[{label:"Orbit",value:"0"},{label:"First Person",value:"1"},{label:"Virtual Reality",value:"2"}]},textureQuality:{label:"Textures",group:"textureQuality",settings:[{label:"LD",value:"0"},{label:"SD",value:"1"},{label:"HD",value:"2"}]}};t.exports=u.extend({events:{"click .help":"onHelpClick","touchstart .help":"onHelpClick","click .vr":"onVrClick","click .fullscreen":"onFullscreenClick","touchstart .watermark":"onWatermarkClick"},constructor:function(){this.fullScreenChange=this.fullScreenChange.bind(this),this.onVrClick=this.onVrClick.bind(this),this.onFullscreenClick=this.onFullscreenClick.bind(this),this.fullScreenChange=this.fullScreenChange.bind(this),u.prototype.constructor.apply(this,arguments)},initialize:function(){u.prototype.initialize.apply(this,arguments),this.enableVR=!1,this.hasFullscreen()||window.self!==window.top||(this.viewer.$el.addClass("no-fullscreen"),this.viewer.$el.find(".controls .settings").addClass("shift-menu-left")),this.viewer.on("model-loaded",function(){this.renderSettings()}.bind(this))},delegateEvents:function(){u.prototype.delegateEvents.apply(this,arguments),this.onFullScreenChange(this.fullScreenChange),this.viewer.proxySettings.on("change",this.renderSettings,this),a.apple.device||(this.$el.find(".vr").on("touchstart",this.onVrClick),this.$el.find(".fullscreen").on("touchstart",this.onFullscreenClick))},undelegateEvents:function(){u.prototype.undelegateEvents.apply(this,arguments),this.offFullScreenChange(this.fullScreenChange),this.viewer.proxySettings.off("change",this.renderSettings,this),a.apple.device||(this.$el.find(".vr").off("touchstart",this.onVrClick,this),this.$el.find(".fullscreen").off("touchstart",this.onFullscreenClick))},setHasAnimations:function(t){this.hasAnimations=t},getSettingLabelForValue:function(t,e){return p[t].settings.find(function(t){return t.value===e}).label},onWatermarkClick:function(t){t&&"touchstart"===t.type&&t.preventDefault(),window.open(t.currentTarget.href)},onHelpClick:function(t){t.preventDefault(),t.stopPropagation(),s.modelViewerHelpButtonCliked(),this.viewer.subviews.helpOverlay.show()},renderSettings:function(){this.settings||(this.settings=new h({el:this.$(".settings-menu"),viewer:this.viewer,settings:p})),this.settings.render()},onVrClick:function(t){if(t.preventDefault(),t.stopPropagation(),this.viewer.hasVR()){var e=this.viewer.scene.getFeatures().webVR.getModel();e.set("enable",!e.get("enable")),s.modelViewerVrButtonClicked("nativeVR")}else a.any?(this.fullscreenVR(t),s.modelViewerVrButtonClicked("mobile")):(this.openVrInstructions(),s.modelViewerVrButtonClicked("desktop"))},openVrWindow:function(){this.viewer._currentModel&&window.open(this.viewer._currentModel.get("embedUrl")+"?cardboard=1&autostart=1","skfbCardboard","menubar=no,toolbar=no")},openVrInstructions:function(){this.viewer._currentModel.sharing().then(function(){var t=this.viewer._currentModel.get("sharing").shortUrl;this.viewer.subviews.helperVrOverlay.setUrl(t),this.viewer.subviews.helperVrOverlay.show()}.bind(this))},onFullscreenClick:function(t,e){t.preventDefault(),t.stopPropagation(),this.hasFullscreen()?this.isFullscreen()?this.exitFullscreen():this.requestFullscreen():e?this.openVrWindow():this.openFakeFullscreen()},openFakeFullscreen:function(){this.viewer._currentModel&&(a.any?window.open(this.viewer._currentModel.get("embedUrl")):window.open(this.viewer._currentModel.get("embedUrl"),"skfbFullscreenFallback","menubar=no,toolbar=no"))},onFullScreenChange:function(t){var e=r(document);e.on("fullscreenchange",t),e.on("webkitfullscreenchange",t),e.on("msfullscreenchange",t),e.on("mozfullscreenchange",t)},offFullScreenChange:function(t){var e=r(document);e.off("fullscreenchange",t),e.off("webkitfullscreenchange",t),e.off("msfullscreenchange",t),e.off("mozfullscreenchange",t)},fullScreenChange:function(){r('[data-action="fullscreen"] > .icon').toggleClass("icon-fullscreen-icon").toggleClass("icon-fullscreen-off-icon"),this.viewer.$el.toggleClass("fullscreen",this.isFullscreen());var t=this.viewer.scene.getFeatures().webVR;if(t){var e=t.getModel();this.isFullscreen()?this.enableVR===!0&&e.set("enable",!0):this.enableVR===!0&&(e.set("enable",!1),this.enableVR=!1)}},fullscreenVR:function(t){return this.enableVR=!0,this.onFullscreenClick(t,!0)},hasFullscreen:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled},isFullscreen:function(){return document.mozFullScreen||document.webkitIsFullScreen},requestFullscreen:function(){this.viewer.el.requestFullscreen?this.viewer.el.requestFullscreen():this.viewer.el.webkitRequestFullscreen?this.viewer.el.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):this.viewer.el.msRequestFullscreen?this.viewer.el.msRequestFullscreen():this.viewer.el.mozRequestFullScreen&&this.viewer.el.mozRequestFullScreen()},exitFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}})},function(t,e,i){"use strict";var r=i(1696);t.exports=r.extend({})},function(t,e,i){"use strict";var r=i(224),n=i(219),a=i(259),s=i(255),o=i(1696),u=n.template(['<div class="setting" data-setting="<%= name %>" data-setting-group="<%= group %>" data-setting-type="<%= type %>">','   <p class="setting-label"><%= label %></p>','   <p class="setting-value" data-value="<%= value %>" ><%= prettyValue %></p>',"</div>"].join("")),h=n.template(['   <a class="control-menu-back back">Back</a>','   <ul class="setting-list" data-setting="<%= name %>" data-setting-type="<%= type %>">',"       <%= listItems %>","   </ul>"].join("")),l=n.template('<li class="setting-item <% if (selected) { %>selected<% } %>" data-value="<%= value %>"><%= prettyValue %><span class="shortcut" title="Keyboard shortcut"><%= shortcut %></span></li>');t.exports=o.extend({initialize:function(t){this.settings=t.settings,this.viewer=t.viewer,this.settings||console.warn("No settings object given to SettingsMenu"),o.prototype.initialize.apply(this,arguments),this.$list=this.$(".control-menu-list"),this.$pane=this.$(".control-menu-pane"),this.$el.on("click touchend",".setting",this.onSettingClick.bind(this)),this.$el.on("click touchend",".back",this.togglePane.bind(this,!1)),this.$el.on("click touchend",".setting-item",this.onSettingValueClick.bind(this)),this.$el.on("click touchend",".wireframe-colors a",this.onColorClick.bind(this)),this.$el.on("click touchend",'[data-setting="viewerMode"] li',this.onViewerModeChange.bind(this)),this.viewer.proxySettings.on("change",this.render.bind(this))},onViewerModeChange:function(t){t&&"touchend"===t.type&&t.preventDefault();var e=this.viewer.proxySettings.get("viewerMode");"0"===e?this.viewer.subviews.osd.show("Click and hold to rotate",{position:"top",duration:3e3}):this.viewer.subviews.osd.show("Mouse to look around, keyboard to move",{position:"top",duration:3e3})},onColorClick:function(t){t&&"touchend"===t.type&&t.preventDefault();var e=r(t.currentTarget),i=e.attr("data-value"),n=e.attr("data-setting"),a=this.viewer.proxySettings.get(n);i===a&&(i="0",e=e.parent().find('[data-value="'+i+'"]')),this.viewer.proxySettings.set(n,i),"0"!==i?this.viewer.proxySettings.set("wireframeEnable",!0):this.viewer.proxySettings.set("wireframeEnable",!1),e.parent().find(".active").removeClass("active"),e.addClass("active"),s.modelViewerWireframeColorSelected(i)},onSettingClick:function(t){t&&"touchend"===t.type&&t.preventDefault&&t.preventDefault();var e=r(t.currentTarget).attr("data-setting"),i=this.settings[e];i.name=e,this.renderSettingPane(i),this.togglePane(!0)},onSettingValueClick:function(t){t.preventDefault(),t.stopPropagation();var e=r(t.currentTarget),i=e.attr("data-value"),n=e.closest("[data-setting]").attr("data-setting"),a=e.closest("[data-setting]").attr("data-setting-type")||"string",o=this.settings[n];switch("shadingStyle"===n?s.modelViewerShadingSelected(i):"cycleMode"===n?s.modelViewerAnimationRepeatModeSelected(i):"annotationsVisible"===n?s.modelViewerAnnotationsToggled(this.viewer._currentModel.get("uid"),"false"!==i):"viewerMode"===n&&s.modelViewerViewerModeSelected(i),this.viewer.proxySettings.once("change",function(){o.value=i,this.renderSettingPane(o),this.updateSetting(o),"shadingStyle"!==n&&this.togglePane()}.bind(this)),a){case"number":i=parseInt(i,10);break;case"bool":i="true"===i}this.viewer.proxySettings.set(n,i)},onSettingChangeWhileOpen:function(){this.renderSettingPane(this._currentSetting)},renderSettingPane:function(t){var e="",i="",r="string",a=this.viewer.proxySettings.get(t.name),s=this.getSettingFromValue(t.name,a);this._currentSetting&&this.viewer.proxySettings.off("change:"+this._currentSetting.name,this.onSettingChangeWhileOpen,this),this._currentSetting=t,this._currentSetting&&this.viewer.proxySettings.on("change:"+this._currentSetting.name,this.onSettingChangeWhileOpen,this),n.each(t.settings,function(t){e+=l({value:t.value,type:t.type||r,prettyValue:t.label,selected:s===t,shortcut:t.shortcut||""})});var o=t.paneTemplate||h;i=o({listItems:e,name:t.name,type:t.type||r}),this.$pane.html(i),"blending"!==this.viewer.proxySettings.get("shadingStyle")&&this.viewer.proxySettings.get("hasWireframe")?this.$(".wireframe-setting-group").show():this.$(".wireframe-setting-group").hide();var u=this.$('[data-setting="wireframeColor"], [data-setting="wireframeEnable"]');if(this.viewer.proxySettings.get("wireframeEnable")){var c=this.viewer.proxySettings.get("wireframeColor"),d=this.$('[data-setting="wireframeColor][data-value="'+c+'"]');d.length&&(u.removeClass("active"),d.addClass("active"))}else u.removeClass("active"),this.$('[data-setting="wireframeEnable"]').addClass("active");"viewerMode"!==this._currentSetting.name||this.viewer.hasVR()?this.$('[data-value="2"]').show():this.$('[data-value="2"]').hide()},updateSetting:function(t){var e=(this.getSettingFromValue(t.name,t.value)||{}).label||"Unknown Value",i=this.$list.find('[data-setting="'+t.name+'"]');i.find(".setting-value").html(e)},getSettingFromValue:function(t,e){var i;return(this.settings[t].settings||[]).forEach(function(t){(t.value===e||t.value+""==e+"")&&(i=t)}),i},togglePane:function(t,e){e&&"touchend"===e.type&&e.preventDefault(),this.$el.toggleClass("detail",t),a(this.$(".control-menu-wrapper"),function(){this.$el.hasClass("detail")||this.clearPane()}.bind(this))},clearPane:function(){this.$pane.html("")},render:function(){var t="",e=this.viewer.scene.getFeatures().quality.getModel(),i=this.viewer.scene.getFeatures().manipulator.getModel(),r=this.viewer.scene.getFeatures().hotspot.getModel(),a=this.viewer.scene.getFeatures().animation.getModel();n.each(this.settings,function(e,i){var r=this.getSettingFromValue(i,this.viewer.proxySettings.get(i))||e.settings[0];t+=u({name:i,label:e.label,value:r.value,prettyValue:r.label,group:e.group,type:r.type})}.bind(this)),this.$list.html(t),o.prototype.render.apply(this,arguments),a&&a.get("animations").length?this.$('[data-setting-group="animation"]').show():this.$('[data-setting-group="animation"]').hide(),e&&this._qualityReady?this.$('[data-setting-group="textureQuality"]').show():this.$('[data-setting-group="textureQuality"]').hide(),r&&r.get("hotspots").length?this.$('[data-setting-group="annotation"]').show():this.$('[data-setting-group="annotation"]').hide();var s=this.getSettingFromValue("viewerMode",i.get("indexManipulator"));if(this.$('[data-setting="viewerMode"] .setting-value').attr("data-value",s.value).text(s.label),a){var h=this.getSettingFromValue("speed",a.get("speed"));this.$('[data-setting="speed"] .setting-value').attr("data-value",h.value).text(h.label);var l=this.getSettingFromValue("cycleMode",a.get("cycleMode"));
this.$('[data-setting="cycleMode"] .setting-value').attr("data-value",l.value).text(l.label)}e&&window.requestAnimationFrame(function(){var t=this.getSettingFromValue("textureQuality",e.get("level"));this.$('[data-setting="textureQuality"] .setting-value').attr("data-value",t.value).text(t.label)}.bind(this))},onTextureQualityReady:function(t){var e=this.viewer.scene.getFeatures().quality;if(e){if(!t.low&&!t.mid&&!t.high)return void this.$('[data-setting="textureQuality"]').remove();this._qualityReady=!0;var i=["low","mid","high"],r=0;i.forEach(function(e,i){if(!t[e]){var n=this.settings.textureQuality.settings;n.splice(i-r,1),r++}}.bind(this)),n.last(this.settings.textureQuality.settings).label="HD";var a=2;t.low&&!t.high&&(a=t.mid?1:0);var s=e.getModel(),o=s.get("level");this.viewer.proxySettings.set("textureQuality",o),this.render()}}})},function(t,e,i){"use strict";var r=i(1696);t.exports=r.extend({events:{"click .close":"close"},close:function(t){t&&t.preventDefault&&t.preventDefault(),this.viewer.stop()}})},function(t,e,i){"use strict";var r=i(219),n=i(236),a=i(1100),s=i(1696),o=i(1704),u=i(1682),h=i(267),l=i(1530),c=a.osg;t.exports=s.extend({events:{"mouseover .snapshot .button":"showGuides","mouseout .snapshot .button":"hideGuides"},initialize:function(){s.prototype.initialize.apply(this,arguments),this.$el.find(".snapshot .button").on("click",this.onSnapshot.bind(this))},onSnapshot:function(t){var e=this.viewer.scene;t.preventDefault();var i=this.$el.find(".snapshot"),r=this.$el.find(".snapshot-flash"),a=this.$el.find(".img-container");if(!i.hasClass("progress")){i.addClass("progress"),r.addClass("active"),setTimeout(function(){r.removeClass("active")},2e3);var s=!0,o=e.getFeatures();if(o.manipulator){o.manipulator&&o.manipulator.getModel().saveCameraPosition();var h=e.getFeatures().saveUI;h||(h=new u,h.init(e.getFeaturesManager()._context),h._views[0].enableSaving()),s=h._views[0].save(t)}n.all([e.getScreenShot(),s]).then(this.onTakeScreenshot.bind(this,i,a))}},onTakeScreenshot:function(t,e,i){var r=i[0],n=l(r.toDataURL("image/jpeg")),a=new o({imageFile:n}),s=this.viewer._currentModel,u=a.save({modelUID:s.get("uid")}),d=e.find("img");d&&(d.remove(),null!==this.previewTimeout&&(window.clearTimeout(this.previewTimeout),this.previewTimeout=null));var p=new Image;p.src=r.toDataURL("image/jpeg"),e.prepend(p),e.removeClass("invisible"),this.previewTimeout=setTimeout(function(){e.addClass("invisible")},4e3),u.done(function(){t.removeClass("progress"),t.addClass("success"),setTimeout(function(){t.removeClass("success")},2e3)}).fail(function(){var e=new h({title:"Save settings error",text:"An unexpected error happened. The thumbnail has NOT been saved.",buttons:{ok:!0}});e.open().then(function(){e.close()}),c.error("Error while saving snapshot"),t.removeClass("progress")})},showGuides:r.debounce(function(){this.$(".snapshot-guides").addClass("active")},100),hideGuides:r.debounce(function(){this.$(".snapshot-guides").removeClass("active")},100)})},function(t,e,i){"use strict";var r=i(224),n=i(239);t.exports=n.extend({save:function(t,e){(null==t||"object"==typeof t)&&(e=t);var i=new FormData;return i.append("imageFile",this.get("imageFile")),i.append("source",this.get("source")),i.append("modelUid",e.modelUID),r.ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"})},url:function(){return"/i/thumbnails"}})},function(t,e,i){"use strict";var r=i(224),n=i(219),a=i(1693),s=i(218).shortcuts,o=i(1706);t.exports=o.extend({events:n.extend({},o.prototype.events,{"click .tabs a":"onTabClick","touchstart .tabs a":"onTabClick",'click [data-action="reset-camera"]':"onResetCameraClick",'touchstart [data-action="reset-camera"]':"onResetCameraClick"}),initialize:function(){o.prototype.initialize.apply(this,arguments),this.renderingShortcuts=new a(s.viewerRendering),this.annotationShortcuts=new a(s.annotationControl),this.animationShortcuts=new a(s.animationControl),this.render()},onResetCameraClick:function(t){t.preventDefault(),this.hide(),this.viewer.scene.getFeaturesManager().focusOnSavedCamera(2)},render:function(){var t=this.renderingShortcuts.generateHelpSection(),e=this.annotationShortcuts.generateHelpSection(),i=this.animationShortcuts.generateHelpSection();this.$(".rendering-shortcuts").html(t),this.$(".annotation-shortcuts").html(e),this.$(".animation-shortcuts").html(i)},onTabClick:function(t){t.preventDefault();var e=r(t.currentTarget),i=e.attr("data-target"),n=this.$("[data-tab].active"),a=this.$('[data-tab="'+i+'"]');this.$(".tabs li").removeClass("active"),e.parent().addClass("active"),n.removeClass("active"),a.addClass("active")}})},function(t,e,i){"use strict";var r=i(1696);t.exports=r.extend({events:{"click .close":"hide","touchstart .close":"hide"},show:function(t){t&&t.preventDefault&&t.preventDefault(),this.$el.removeClass("hidden")},hide:function(t){t&&t.preventDefault&&t.preventDefault(),this.$el.addClass("hidden")},isVisible:function(){return!this.$el.hasClass("hidden")}})},function(t,e,i){"use strict";var r=i(219),n=i(321),a=i(1706),s=a.extend({events:r.extend({},a.prototype.events,{"click .tabs a":"onTabClick",'click [data-action="reset-camera"]':"onResetCameraClick"}),setModel:function(t){this.model=t,this.render()},render:function(){this.model&&(this.$(".hotspot-title").html(this.model.get("name")),this.$(".hotspot-content").html(this.model.get("content").rendered),this.handleLazyLoading())}});r.extend(s.prototype,n),t.exports=s},function(t,e,i){"use strict";var r=i(219),n=i(259),a=i(1696);t.exports=a.extend({events:r.extend({},a.prototype.events,{"click .osd":"hide"}),show:function(t,e){e=r.extend({duration:1/0,position:"center",style:"default"},e),e.duration=Math.max(0,e.duration),window.clearTimeout(this.osdTimeout),this.$(".osd .content").html(t);var i=this.$(".osd");i.removeClass("osd-default"),i.removeClass("osd-compact"),i.addClass("osd-"+e.style),i.removeClass("osd-top"),i.removeClass("osd-center"),i.removeClass("osd-bottom"),i.addClass("osd-"+e.position),e.duration>0&&e.duration<1/0&&(i.addClass("hud"),this.osdTimeout=setTimeout(this.hide.bind(this),e.duration)),i.hasClass("active")||(i.removeClass("hidden"),i.addClass("active"))},hide:function(){var t=this.$(".osd");t.removeClass("active"),n(t[0],function(){t.addClass("hidden"),t.removeClass("hud"),this.$(".osd .content").empty()}.bind(this))}})},function(t,e,i){"use strict";var r=i(219),n=i(1696);t.exports=n.extend({events:r.extend({},n.prototype.events,{"click .close":"close","touchstart .close":"close"}),initialize:function(){n.prototype.initialize.apply(this,arguments),this.toggle(),this.model.on("change:notSupported",this.toggle,this)},toggle:function(){var t=this.model.get("notSupported");this.$el.toggleClass("hidden",!t)},close:function(t){t&&t.preventDefault&&t.preventDefault(),this.$el.addClass("hidden"),setTimeout(function(){this.$el.remove()}.bind(this),300)}})},function(t,e,i){"use strict";var r=i(224),n=i(219),a=i(258),s=i(1407),o=i(1711),u=1,h=2,l=a.extend({_isLoaded:!1,_context:null,isMoving:!1,startX:0,sensitivity:20,sprite:{current:0,steps:15,ratio:null,width:0},size:u,autospinTimer:null,events:n.extend({},a.prototype.events,{mousedown:"onMouseDown",mouseup:"onMouseUp","mousemove ":"onMouseMove",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove"}),initialize:function(){a.prototype.initialize.apply(this,arguments),this._bindedResizeEvent=this.onWindowResize.bind(this),this.$viewport=r(),this.$image=r()},delegateEvents:function(){a.prototype.delegateEvents.apply(this,arguments),r(window).on("resize",this._bindedResizeEvent)},undelegateEvents:function(){a.prototype.undelegateEvents.apply(this,arguments),r(window).off("resize",this._bindedResizeEvent),this.autospinTimer&&clearInterval(this.autospinTimer)},isViewerReady:function(){return this._isLoaded},run:function(){var t=new s;this._context=t,this.$el.show(),this.$el.siblings(".webgl").hide(),this.$el.siblings(".osd").hide();var e=this.model.get("uid"),i=new o([],{uid:e});return i.fetch().then(function(){i.length>0?this.displayFallback(i):this.displayNoFallbackError()}.bind(this)).fail(function(){this.displayNoFallbackError()}.bind(this)),this._isLoaded=!0,!0},getContext:function(){return this._context},getFeatures:function(){return{}},hasFallback:function(){var t=this.model.get("fallback");return t&&t.length>0},displayFallback:function(t){this.$viewport=r(".fallback-viewport"),this.$image=this.$viewport.find("img.fallback-sprite");var e=t.at(0).get("images"),i=e[0].url;this.$image.on("load",function(t){var e=t.target.naturalHeight,i=t.target.naturalWidth/this.sprite.steps;this.sprite.ratio=e?i/e:0,r(t.target).css("display","block"),this.trigger("secondary-progress",{progress:1}),this.trigger("success"),this.displayFallbackWarning(),this.onWindowResize()}.bind(this)),this.$image.on("error",function(t){console.error("Fallback loading failed. URL : "+i+" ERROR : "+t.toString()),this.trigger("fail"),this.displayFallbackLoadingError()}.bind(this)),this.$image.attr("src",i)},displayFallbackLoadingError:function(){this.$el.find(".fallback-error-loading").show()},displayNoFallbackError:function(){this.$el.find(".fallback-error-nofallback").show()},displayFallbackWarning:function(){this.$el.find(".fallback-warning").show(),this.fallbackWarning=setTimeout(function(){this.$el.find(".fallback-warning").fadeOut()}.bind(this),5e3)},onWindowResize:function(){var t,e,i=this.$el.width(),r=this.$el.height(),n=i/r;this.size===h?n<this.sprite.ratio?(t=i,e=Math.floor(t/this.sprite.ratio)):(e=r,t=Math.floor(e*this.sprite.ratio)):n<this.sprite.ratio?(e=r,t=Math.floor(e*this.sprite.ratio)):(t=i,e=Math.floor(t/this.sprite.ratio)),this.$viewport.width(t).height(e).css({"margin-top":Math.round(-1*e/2),"margin-left":Math.round(-1*t/2)}),this.sprite.width=Math.round(this.$image.prop("scrollHeight")*this.sprite.ratio),this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)},onMouseDown:function(t){t.preventDefault(),this.isMoving=!0,this.startX=t.clientX},onMouseMove:function(t){t.preventDefault(),this.move(t.clientX)},onMouseUp:function(t){t.preventDefault(),this.isMoving=!1},onTouchStart:function(t){t.preventDefault(),this.isMoving=!0;var e=t.originalEvent.touches[0];this.startX=e.clientX},onTouchMove:function(t){t.preventDefault(),this.move(t.originalEvent.touches[0].clientX)},onTouchEnd:function(t){t.preventDefault(),this.isMoving=!1},move:function(t){this.isMoving&&(this.autospinTimer&&this.stopAutospin(),t>this.startX+this.sensitivity&&(this.startX=t,this.moveRight()),t<this.startX-this.sensitivity&&(this.startX=t,this.moveLeft()))},moveRight:function(){0===this.sprite.current?this.sprite.current=this.sprite.steps-1:this.sprite.current=this.sprite.current-1,this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)},moveLeft:function(){this.sprite.current=(this.sprite.current+1)%this.sprite.steps,this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)},startAutospin:function(){var t=500;this.autospinTimer=setInterval(n.bind(function(){this.moveLeft()},this),t)},stopAutospin:function(){clearInterval(this.autospinTimer),this.autospinTimer=null},toggleAutospin:function(){this.autospinTimer?this.stopAutospin():this.startAutospin()}});t.exports=l},function(t,e,i){"use strict";var r=i(248),n=i(1712);t.exports=r.extend({model:n,parse:function(t){return t.results.images},url:function(){return"/i/models/"+this.options.uid+"/fallback"}})},247]));
//# sourceMappingURL=viewer-eb6b3cb050fba6ee9ce5.js.map
